define("MSG/ui_b9aa768d",["require","exports","./vendor_a1b6b414","./model_8c0b0872"],(function(t,e,n,o){"use strict";function r(t){return("undefined"!=typeof window?window:self)[t]}var a=r("Map"),i=r("Set"),s={__proto__:null,get cssScope(){return UX},get default(){return $X},get plugins(){return jX},get willUpdate(){return PX},get willRender(){return RX},get willUnmount(){return LX},get events(){return OX},get handleGifReportSend(){return DX}};function u(t){return 0===t||t>0&&t<Date.now()}function c(t){return t&&(!t.settings||u(t.settings.dontDisturbUntil))}function p(t){return Array.isArray(t)?t:t instanceof a||t instanceof i?Array.from(t.values()):null!=t?[t]:[]}function l(t,e){void 0===e&&(e=function(t){return t});var n=new i;return t.filter((function(t){var o=e(t);if(!n.has(o))return n.add(o),!0}))}function m(t){var e=0,n={},o=function(e,o){return n[t(e)]-n[t(o)]},r=function(o){var r=t(o);return r in n||(n[r]=e++),o};return function(t){return t.map(r).sort(o)}}function d(t){return t<10?"0"+t:t.toString()}function _(t){var e=new Date(t),n=e.getHours(),o=e.getMinutes();return d(n)+":"+d(o)}var f=_,g=new a;function v(t,e){return g.has(e)?g.get(e)(t):f(t)}function h(t){var e=Math.floor(t/1e3),n=Math.floor(e/3600),o=Math.floor(e%3600/60),r=Math.floor(e%60);return""+(0!==n?n+":":"")+d(o)+":"+d(r)}g.set("HH:MM",_),g.set("DD.MM.YYYY",(function(t){var e=new Date(t);return d(e.getDate())+"."+d(e.getMonth()+1)+"."+e.getFullYear()}));var C=h,k=new a;k.set("H:MM:SS",h);var b,y={"<":"&lt;",">":"&gt;","&":"&amp;"},S={ru:E,uk:E,en:x,hy:x,mo:x,ro:x,de:x,uz:I,az:I,kk:I,ka:I,ky:I,tg:I,tr:I};function w(t,e){var n={};return function(o,r){var a=e[o];if(null==a)return"".concat(t,".").concat(o);if(r){var i=n[o];return i||(i=n[o]=function(t){var e=[],n=0;for(;n<t.length;){var o=M(e,t,n);if(o===t.length)break;n===o&&o++,n=o}return A(e)}(String(a))),B(i,r)}return a}}function E(t){return(t=Math.abs(t))%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2}function x(t){return 1===t?0:1}function I(t){return 0}function B(t,e){var n,o,r;switch(t.type){case 0:return t.text;case 1:return t.argName in e?e[t.argName]:"";case 2:return n=Number(e[t.argName]),r=t.plural?function(t){var e=R(),n=e in S?S[e]:E;return n(t)}(n):n,(o=t.values[r])?B(o,e):"";case 3:return n=e[t.argName],(o=t.values[n])?B(o,e):"";case 4:return t.children.map((function(t){return B(t,e)})).join("")}}function M(t,e,n){var o=T(e,n,"|[]");if(-1===o)return-1===(o=T(e,n,"]"))?(t.push(j(e.substr(n))),e.length):(t.push(j(e.substr(n,o-n))),o);if(o>n)return t.push(j(e.substr(n,o-n))),o;if("["===e[o]){var r="";if(-1===(o=T(e,n=o+1,":?]")))return n--,t.push(j(e.substr(n))),e.length;var a=e.substr(n,o-n).trim();if("]"===e[o])return t.push(function(t){return{type:1,argName:t}}(a)),o+1;var i=e[o],s="?"===i,u=[],c={};if("?"!==i&&":"!==i)return o=T(e,n,"]"),t.push(j(e.substr(n-1,o))),e.length;for(;n<e.length;){n=o+1;var p=[];if(s){if(!((o=T(e,n,"="))>n))return o=T(e,n,"]"),t.push(j(e.substr(n,o))),e.length;r=e.substr(n,o-n),n=o+1}for(;n<e.length&&(o=M(p,e,n))!==e.length&&"|"!==e[o]&&"]"!==e[o];)n===o&&o++,n=o;if(s?c[r]=A(p):u.push(A(p)),o===e.length||"]"===e[o])break}return s?t.push(function(t,e){return{type:3,argName:t,values:e}}(a,c)):t.push(function(t,e){return{type:2,argName:t,values:e,plural:/Plural$/.test(t)}}(a,u)),o===e.length?e.length:o+1}return o}function A(t){return 0===t.length?j(""):1===t.length?t[0]:{type:4,children:t}}function T(t,e,n){for(var o=e;o<t.length;o++)if(-1!==n.indexOf(t[o]))return o;return-1}function j(t){return{type:0,text:t.replace(/<>&/g,P)}}function P(t){return y[t]||t}function R(){return null==b&&(b=document.documentElement.getAttribute("lang")||""),b}function L(t,e){return t.root.state.service[e]}var O=[],z=null,D=null;function U(t,e){D||(D=t.subscribe((function(){z||(z=Promise.resolve().then((function(){z=null;for(var e=t.getState(),n=0;n<O.length;n++)O[n](e)})))})));var n=function(t){return e(t)};return O.push(n),function(){var t=O.indexOf(n);-1!==t&&O.splice(t,1),!O.length&&D&&(D(),D=null)}}var N,q,H="undefined"!=typeof matchMedia?matchMedia("(max-width: 650px)"):null,F={aliases:{today:"сегодня",yesterday:"вчера"},months:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]};function V(t,e){return N?N(t,e):t}var K=function(t){function e(e,o,r){var a=t.call(this,n.__assign(n.__assign(n.__assign({},e.getState()),r),{isSmallScreen:null==H?void 0:H.matches,isTouchDevice:"ontouchstart"in document}))||this;a.app=e,a.app=e;var i=U(e,(function(t){return a.set(t)})),s=function(){return a.set({isSmallScreen:H.matches})};return H&&(H.addEventListener?H.addEventListener("change",s):H.addListener&&H.addListener(s)),a._unsubscribe=function(){i(),H&&(H.removeEventListener?H.removeEventListener("change",s):H.removeListener&&H.removeListener(s))},a.updatePTS(o),a}return n.__extends(e,t),e.prototype.l10n=function(t,e){return V(t,e)},e.prototype.updatePTS=function(t){N=w("msg",function(t){var e=Object.keys(t);return 1===e.length?t[e[0]]:t}(t)),this.set({l10n:function(t,e){return V(t,e)}}),F={aliases:{today:V("date-today"),yesterday:V("date-yesterday")},months:[V("date-month-january"),V("date-month-february"),V("date-month-march"),V("date-month-april"),V("date-month-may"),V("date-month-june"),V("date-month-july"),V("date-month-august"),V("date-month-september"),V("date-month-october"),V("date-month-november"),V("date-month-december")]}},e.prototype.isMobile=function(){return!!this.get().isMobile},e.prototype.dispose=function(){this._unsubscribe()},e}(n.Store),W=K;function G(){return q}var Y,X=864e5,Q=6e4*(new Date).getTimezoneOffset();function J(t){var e=t instanceof Date?t.getTime():t;return Math.floor(e/X)}function $(t,e){return void 0===e&&(e=0),(J((t instanceof Date?t.getTime():t)-Q)+e)*X+Q}function Z(t,e){void 0===e&&(e={});var o=n.__assign(n.__assign({},F),e);"number"==typeof t&&(t=new Date(t));var r,a=new Date,i=J($(a)),s=J(o.normalizeDateStart?$(t):t);if(s===i?r=o.aliases.today:s===i-1?r=o.aliases.yesterday:(r="".concat(t.getDate()," ").concat(o.months[t.getMonth()]),t.getFullYear()!==a.getFullYear()&&(r+=" ".concat(t.getFullYear()))),o.addTime){var u="string"==typeof o.addTime?o.addTime:", ";r+="".concat(u).concat(tt(t.getHours()),":").concat(tt(t.getMinutes()))}return r}function tt(t){return t<10?"0".concat(t):String(t)}function et(t){var e;return null===(e=G().get().animojis.animoji)||void 0===e?void 0:e.get(t)}var nt={mention:!0,hashtag:!0,link:!0,userSticker:!0},ot=((Y={})[n.TokenFormat.Bold]="STRONG",Y[n.TokenFormat.Italic]="EMPHASIZED",Y[n.TokenFormat.Strike]="STRIKETHROUGH",Y[n.TokenFormat.Underline]="UNDERLINE",Y[n.TokenFormat.Heading]="HEADING",Y[n.TokenFormat.Monospace]="MONOSPACED",Y[n.TokenFormat.Marked]="CODE",Y),rt={},at=[];function it(t,e){void 0===e&&(e={replaceTextEmoji:!1});var o={},r={format:0,text:"",elements:[],pending:o,options:e},a=e.replaceTextEmoji;return t.forEach((function(e,i){var s,u=e;!a||e.format&n.TokenFormat.Monospace||(u=function(t){var e=t.value,o=t.emoji;if(o){for(var r=0,a="",i=0,s=[],u=0;u<o.length;u++){var c=o[u],p=c.to-c.from,l=0;c.emoji&&(a+=e.slice(r,c.from)+c.emoji,r=c.to,l=c.emoji.length-p),s.push(n.__assign(n.__assign({},c),{from:c.from+i,to:c.to+i+l})),i+=l}var m=a+e.slice(r);return t.value=m,t.emoji=s,t}return t}(u));var c=e.value,p=u.format&n.TokenFormat.Monospace;if(function(t,e,n){for(var o=t.pending,r=t.format^e,a=r&e,i=r&t.format,s=0,u=void 0;s<at.length;s++)i&(u=at[s])&&(o[u]=null),a&u&&n>0?ct(t,u,{type:ot[u],from:t.text.length,length:n}):o[u]&&(o[u].length+=n)}(r,u.format,c.length),u.type!==n.TokenType.Link||u.auto&&p)u.type===n.TokenType.Mention&&u.mention&&!p&&pt(r,u.mention,c);else{var l=i>0?t[i-1]:null,m=function(t){if(t.type===n.TokenType.Link&&"@"===t.link[0])return lt(t.link.slice(1))}(u);(null==l?void 0:l.type)!==n.TokenType.Link||l.auto||u.auto||u.link!==l.link||!o[n.TokenFormat.Link]?m?pt(r,m,c):ct(r,n.TokenFormat.Link,{type:"LINK",from:r.text.length,length:c.length,attributes:{url:e.link}}):o[n.TokenFormat.Link].length+=c.length}(null===(s=e.emoji)||void 0===s?void 0:s.length)&&function(t,e,o){var r;if(!(null===(r=e.emoji)||void 0===r?void 0:r.length))return;e.emoji.forEach((function(e){var r,a=e.emojiData;a&&function(t){return"string"==typeof t.lottieUrl&&"number"==typeof t.id}(a)&&ct(t,n.TokenFormat.None,{entityId:a.id,entityName:"ANIMOJI",type:"ANIMOJI",from:o+e.from,length:e.to-e.from,attributes:{animojiSetId:(null===(r=a.setId)||void 0===r?void 0:r.toString())||"",animojiLottieUrl:a.lottieUrl}})}))}(r,u,r.text.length),r.format=u.format,r.text+=c,c.length})),{text:r.text,elements:r.elements}}function st(t,e,o){var r=o?n.__assign(n.__assign({},nt),o):nt,a=n.parse$1(t,r);return e&&(a=ut(a,e)),a}function ut(t,e){var r,a,i={add:0},s=0,u=0;e=e.filter(Boolean);for(var c=[],p=0;p<e.length;p++){var l=e[p];if(s=l.from||0,u=l.length||0,l.type in rt)i.add=rt[l.type],t=n.setFormat$1(t,i,s,u);else if("ANIMOJI"===l.type&&(null===(r=l.attributes)||void 0===r?void 0:r.animojiLottieUrl)){var m={pos:s,data:{id:l.entityId,cid:o.createAnimojiCid(l.entityId),lottieUrl:l.attributes.animojiLottieUrl,setId:l.attributes.animojiSetId&&parseInt(l.attributes.animojiSetId,10)}};c.push(m)}else if("LINK"===l.type&&(null===(a=l.attributes)||void 0===a?void 0:a.url)){var d=mt(t,s);if(d&&0===d.offset){var _=t[d.index];if(_.type===n.TokenType.Link&&_.value.length===u&&_.link===l.attributes.url)continue}t=n.setLink(t,l.attributes.url,s,u)}else"USER_MENTION"===l.type&&(t=n.setLink(t,"@".concat(l.entityId||l.entityName||""),s,u))}return c.length&&(t=n.updateEmojiData(t,c)),t}function ct(t,e,n){t.pending[e]=n,t.elements.push(n)}function pt(t,e,o){var r=lt(e);ct(t,n.TokenFormat.Link,{type:"USER_MENTION",entityId:"number"==typeof r?r:void 0,entityName:"string"==typeof r?r:void 0,from:t.text.length,length:o.length})}function lt(t){return"number"==typeof t?t:/^[0-9]+$/.test(t)?Number(t):t}function mt(t,e){for(var n=0,o=void 0;n<t.length;n++){if(e<(o=t[n].value.length))return{index:n,offset:e};e-=o}}Object.keys(ot).forEach((function(t){at.push(Number(t)),rt[ot[t]]=Number(t)}));var dt="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",_t=1e3,ft=new a,gt=new a,vt=window.devicePixelRatio||1,ht={nano:16,micro:20,small:32,medium:48,normal:64,big:96,large:128,xl:190,xxl:320};function Ct(t){return ft.get(yt(t))||null}function kt(t){var e=yt(t);return e?(gt.has(e)||gt.set(e,new Promise((function(t,n){var o=new Image,r=function(){gt.delete(e),o.onerror=o.onload=null};o.onerror=function(){r(),n(new Error("Failed to load image"))},o.onload=function(){r(),function(t,e){if(ft.set(t,e),ft.size>_t)for(var n=Array.from(ft.keys());n.length>_t;)ft.delete(n.shift())}(e,{url:e,width:o.naturalWidth,height:o.naturalHeight}),t(Ct(e))},o.src=e}))),gt.get(e)):Promise.reject(new Error("Unknown resource type"))}function bt(t){return"string"==typeof t?t:t?t.gif&&t.previewUrl?t.previewUrl:t.preview?t.preview.url:t.baseUrl?xt(t.baseUrl,1440,!1,!1):t.file&&t.file.thumbnail?t.file.thumbnail:t.thumbnail||t.url:void 0}function yt(t){return function(t){if(t&&"object"==typeof t&&t.file){if(t.file.baseUrl)return xt(t.file.baseUrl,1440,!1,!1);var e=t.file.url||t.file.objectUrl;return!e&&t.file instanceof Blob&&(e=URL.createObjectURL(t.file)),e}}(t)||bt(t)}function St(t){return t&&"object"==typeof t&&"PHOTO"===t._type&&t.file&&!t.file.width?bt(t):yt(t)}var wt=[{width:32},{width:48},{width:50,hdpi:!0},{width:64,hdpi:!0},{width:72},{width:96},{width:128,hdpi:!0},{width:176,hdpi:!0},{width:192},{width:223},{width:224,hdpi:!0},{width:288,hdpi:!0},{width:320},{width:480},{width:492},{width:600},{width:720}],Et=[{width:240},{width:180},{width:320},{width:480},{width:600},{width:720},{width:960},{width:1080},{width:1280},{width:1440}];function xt(t,e,n,o){return void 0===n&&(n=!0),void 0===o&&(o=!1),t?("string"==typeof e&&(e=ht[e]||96),t+"&fn="+function(t,e){for(var n=e?wt:Et,o=t*Math.floor(vt),r=vt>1,a=e?"sqr":"w",i=n[0].width,s=n.length-1;s>=0;s--){var u=n[s],c=u.width,p=u.hdpi;if(o===c){i=c;break}if(p&&r&&c===t){i=c+"_2x";break}var l=n[s-1];if(l&&l.width<t){i=c;break}}return a+"_"+i}(e,n)+(o?"&ext=jpg":"")):""}function It(t,e){return void 0===e&&(e=96),t.baseUrl?xt(t.baseUrl,e,!0):t.avatarUrl}function Bt(t,e){if(void 0===e&&(e=96),"DIALOG"===t.type){var n=function(t){return t.participants.find((function(t){return!t.user.current})).user}(t);return It(n,e)}return t.iconUrl&&/^blob:/.test(t.iconUrl)?t.iconUrl:t.fullIconUrl?xt(t.fullIconUrl,e,!0):t.iconUrl}var Mt=void 0!==a,At=void 0!==i;function Tt(t,e){return null==e?0:Array.isArray(e)?e.length:Mt&&e instanceof a||At&&e instanceof i?e.size:1}function jt(t,e,n){return Mt&&e instanceof a||At&&e instanceof i?e.has(n):Array.isArray(e)||"string"==typeof e&&null!=n?-1!==e.indexOf(n):null!=e&&e===n}function Pt(t,e){return String(e).toLowerCase()}function Rt(t,e){return String(e).toUpperCase()}function Lt(t,e,n,o){return e?e.slice(n,o):e}function Ot(t,e,n){var o=new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:n});return t.dispatchEvent(o),t}function zt(t,e){if(!e)return!1;var n=e.split(".").map((function(t){return parseInt(t,10)})),o=new Date;return n[0]===o.getDate()&&n[1]===o.getMonth()+1}function Dt(t,e){return e&&e.file&&("loading"===e.status||"processing"===e.status)}function Ut(t){return t.own&&!t.current&&!t.deleted}function Nt(t,e){return p(e).filter(Ut)}function qt(){var t,e=Array.from(arguments);return e.splice(0,1),(t=Math.min).call.apply(t,[null].concat(e))}function Ht(){var t,e=Array.from(arguments);return e.splice(0,1),(t=Math.max).call.apply(t,[null].concat(e))}function Ft(t,e,n){return void 0===n&&(n=2),parseFloat(e).toFixed(n)}function Vt(t,e){return-1!==navigator.userAgent.indexOf(e)}function Kt(t,e){return e.title||e.placeholder||t.store.l10n("empty-chat-placeholder")}function Wt(t,e,n){return e?It(e,n):null}function Gt(t,e,n){return Bt(e,n)}function Yt(t,e){return e.official||e.groupChatInfo&&e.groupChatInfo.groupOptions.includes("GroupPremium")}function Xt(t,e,n){return v(e,n)}function Qt(t,e,n){return void 0===n&&(n="H:MM:SS"),function(t,e){return k.has(e)?k.get(e)(t):C(t)}(e,n)}function Jt(t,e,n){return Z(e,{normalizeDateStart:!0,addTime:n})}function $t(t,e,n,o,r){return void 0===o&&(o=!0),void 0===r&&(r=!1),xt(e,n,o,r)}function Zt(t,e,n){return t.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!0,composed:!0,detail:n})),t}function te(t,e,n){return t.dispatchEvent(new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:n})),t}function ee(t,e,n,o){return t.addEventListener(e,n,o),t}function ne(t,e,n,o){return t.removeEventListener(e,n,o),t}function oe(t,e){var n=t.componentModel&&t.componentModel.input.slots[e];return n&&n.element}function re(t,e){n.updateText(e._1,t.store.data.l10n(t.props.key,t.state.params))}var ae={__proto__:null,cssScope:"e-xnr2g3",default:function(t,e){var o=t.componentView;return e._1=n.appendChild(o,n.text(t.store.data.l10n(t.props.key,t.state.params))),n.subscribeStore(t,["l10n"]),re},props:function(){return{key:""}},didChange:function(t){var e=t.props,n=Object.keys(e).reduce((function(t,n){return/^data-/.test(n)&&(t[n.slice(5)]=e[n]),t}),{});t.setState({params:n})}};var ie={mouseover:function(t,e){var n=oe(t,"bubble");(!t.props.useHover&&n.contains(e.target)||t.props.useHover)&&se(t,!0)},mouseleave:function(t){se(t,!1)},click:function(t,e){t.store.get().isTouchDevice?se(t,!t.state.active,!0):"click"!==e.type||!t.state.active&&!t.props.infobubble||!e.target.closest("[name=bubble]")&&t.props.useHover?t.props.useHover||se(t,!0):se(t,!1,!0)}};function se(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!1);var o=e?t.props.showDelay:t.props.hideDelay,r=t.store.get().isTouchDevice;clearTimeout(t._delayTimeout),r&&e&&t.root.addEventListener("touchstart",t._outerTouch),t._delayTimeout=setTimeout((function(){e&&function(t){var e=t.props,n=e.xAxis,o=e.yAxis,r=e.forced;if(n&&o&&r)t.setState({xAxis:n,yAxis:o});else{var a,i,s=t.getBoundingClientRect(),u=function(t){var e=oe(t,"bubble"),n=e&&e.firstChild;return{height:n?n.offsetHeight:0,width:n?n.offsetWidth:0}}(t),c=function(t){var e=t.props.container,n=e?t.root.querySelector(e):null;return n?n.getBoundingClientRect():{top:0,left:0,bottom:window.innerHeight,right:window.innerWidth}}(t);a=n&&r?n:"left"===n?s.left+u.width>c.right?"right":"left":s.right-u.width<c.left?"left":"right",i=o&&r?o:"bottom"===o?s.bottom+u.height>c.bottom?"top":"bottom":s.top-u.height<c.top?"bottom":"top",t.setState({xAxis:a}),t.setState({yAxis:i})}}(t),t.setState({active:e}),t.addEventListener("transitionend",(function(){Zt(t,"active-menu",e);var n=t.props.bubbleId;if(!e&&n){var o=t.store.get().config.user.HIDDEN_BUBBLES||[];Zt(t,"update-user-settings",{name:"HIDDEN_BUBBLES",value:o.concat([n])})}}),!1)}),n?0:o)}var ue="e6mkawv";function ce(t,e,o){n.updateClass(t,e,"bubble-okmsg"+("left"===o.state.xAxis?" __x-left-okmsg":"")+("right"===o.state.xAxis?" __x-right-okmsg":"")+("top"===o.state.yAxis?" __y-top-okmsg":"")+("bottom"===o.state.yAxis?" __y-bottom-okmsg":"")+(o.state.active?" __active-okmsg":""))}function pe(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"element",ue)),e._2=n.mountSlot(t,"element");var r=e._3=n.appendChild(o,n.elem("div",ue));ce(r,e._4=n.obj(),t);var a=n.appendChild(r,n.createSlot(t,"bubble",ue));return n.setAttribute(a,"data-tsid","root_attachment"),e._6=n.mountSlot(t,"bubble"),le}function le(t,e){ce(e._3,e._4,t)}pe.dispose=function(t){t._2=n.unmountSlot(t._2),t._6=n.unmountSlot(t._6)};var me={__proto__:null,cssScope:ue,default:pe,props:function(){return{yAxis:null,xAxis:null,container:null,showDelay:150,hideDelay:450,tooltip:!1,useHover:!0,forced:!1,infobubble:!1,bubbleId:null,active:!1}},events:ie,willMount:function(t){t.setState({yAxis:t.props.yAxis,xAxis:t.props.xAxis,active:t.props.active}),t._outerTouch=function(e){t.contains(e.target)||(se(t,!1,!0),t.root.removeEventListener("touchstart",t._outerTouch))}},willUnmount:function(t){se(t,!1),t.root.removeEventListener("touchstart",t._outerTouch)}},de="e80wbkv";function _e(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",de)),e._2=n.mountSlot(t,"")}_e.dispose=function(t){t._2=n.unmountSlot(t._2)};var fe={__proto__:null,cssScope:de,default:_e},ge={"add-circle":t.toUrl("./icons/add-circle_8f78b13f.svg"),add:t.toUrl("./icons/add_2301f84a.svg"),"alert-off":t.toUrl("./icons/alert-off_c0e83b94.svg"),"alert-off_12":t.toUrl("./icons/alert-off_12_90350c2d.svg"),"alert-on":t.toUrl("./icons/alert-on_b48439b4.svg"),"arrow-down":t.toUrl("./icons/arrow-down_c2d3b1bd.svg"),"arrow-next":t.toUrl("./icons/arrow-next_f6afc807.svg"),"arrow-prev":t.toUrl("./icons/arrow-prev_3e9ab558.svg"),"arrow-right":t.toUrl("./icons/arrow-right_3ca62331.svg"),attach:t.toUrl("./icons/attach_289b7a31.svg"),"audio-call-s":t.toUrl("./icons/audio-call-s_936bf3dc.svg"),"audio-call_12":t.toUrl("./icons/audio-call_12_e63a5897.svg"),back:t.toUrl("./icons/back_9f229c9b.svg"),bday:t.toUrl("./icons/bday_80c5d91a.svg"),block:t.toUrl("./icons/block_d08b2c2e.svg"),bot:t.toUrl("./icons/bot_ecbe2305.svg"),calendar:t.toUrl("./icons/calendar_a062b46b.svg"),"call-add":t.toUrl("./icons/call-add_77b28838.svg"),channel:t.toUrl("./icons/channel_7d03d476.svg"),check:t.toUrl("./icons/check_c24cde08.svg"),clean:t.toUrl("./icons/clean_5d22323a.svg"),clear:t.toUrl("./icons/clear_cafea7c0.svg"),complaint:t.toUrl("./icons/complaint_38a0b235.svg"),copy:t.toUrl("./icons/copy_dfc98603.svg"),"create-chat":t.toUrl("./icons/create-chat_5c4baa1f.svg"),"create-sticker":t.toUrl("./icons/create-sticker_14bb162e.svg"),crop:t.toUrl("./icons/crop_718a6b41.svg"),dailyphoto:t.toUrl("./icons/dailyphoto_daa05871.svg"),dailyphoto_12:t.toUrl("./icons/dailyphoto_12_aaae9ec7.svg"),delete:t.toUrl("./icons/delete_028200c3.svg"),"dnd-file":t.toUrl("./icons/dnd-file_233142ba.svg"),"dnd-media":t.toUrl("./icons/dnd-media_bc5c5ab1.svg"),download:t.toUrl("./icons/download_db617177.svg"),edit:t.toUrl("./icons/edit_83465bd9.svg"),"emoji-ok":t.toUrl("./icons/emoji-ok_4fc41444.svg"),"emoji-popular":t.toUrl("./icons/emoji-popular_24bffefb.svg"),"emoji-set-0":t.toUrl("./icons/emoji-set-0_0f186183.svg"),"emoji-set-1":t.toUrl("./icons/emoji-set-1_64a255ab.svg"),"emoji-set-2":t.toUrl("./icons/emoji-set-2_c4235822.svg"),"emoji-set-3":t.toUrl("./icons/emoji-set-3_0dc12423.svg"),"emoji-set-4":t.toUrl("./icons/emoji-set-4_e1a60daf.svg"),"emoji-set-5":t.toUrl("./icons/emoji-set-5_3d3dee00.svg"),"emoji-set-6":t.toUrl("./icons/emoji-set-6_4d85692a.svg"),"emoji-set-7":t.toUrl("./icons/emoji-set-7_630b62f8.svg"),"emoji-set-8":t.toUrl("./icons/emoji-set-8_e37382dd.svg"),"emoji-set-9":t.toUrl("./icons/emoji-set-9_54dca190.svg"),error:t.toUrl("./icons/error_48fc2721.svg"),"favorite-off":t.toUrl("./icons/favorite-off_5834317c.svg"),favorite:t.toUrl("./icons/favorite_cfe301bb.svg"),file:t.toUrl("./icons/file_17dd1fb6.svg"),file_12:t.toUrl("./icons/file_12_79d0fbb4.svg"),flower:t.toUrl("./icons/flower_a49a3813.svg"),forward:t.toUrl("./icons/forward_1ba992c7.svg"),forward_12:t.toUrl("./icons/forward_12_60b925de.svg"),fullscreen:t.toUrl("./icons/fullscreen_0b2ed2ba.svg"),gif:t.toUrl("./icons/gif_4d002607.svg"),gift:t.toUrl("./icons/gift_07a2f162.svg"),"h-flip":t.toUrl("./icons/h-flip_7edc6557.svg"),help:t.toUrl("./icons/help_8fa3fead.svg"),holiday:t.toUrl("./icons/holiday_aa0ed841.svg"),home:t.toUrl("./icons/home_280806b0.svg"),"in-favorite":t.toUrl("./icons/in-favorite_79e7bdbf.svg"),"in-favorite_12":t.toUrl("./icons/in-favorite_12_66019faf.svg"),"incoming-audio-call":t.toUrl("./icons/incoming-audio-call_a298b1ce.svg"),"incoming-video-call":t.toUrl("./icons/incoming-video-call_cb42ff2d.svg"),info:t.toUrl("./icons/info_71049633.svg"),klass:t.toUrl("./icons/klass_defc2529.svg"),leave:t.toUrl("./icons/leave_7859436e.svg"),like:t.toUrl("./icons/like_b7da6047.svg"),location:t.toUrl("./icons/location_31e857ca.svg"),location_12:t.toUrl("./icons/location_12_3ce25efe.svg"),looked:t.toUrl("./icons/looked_68743c23.svg"),"media-mixed":t.toUrl("./icons/media-mixed_40698267.svg"),"media-mixed_12":t.toUrl("./icons/media-mixed_12_696e5ce7.svg"),"media-share":t.toUrl("./icons/media-share_2ebc369f.svg"),"media-share_12":t.toUrl("./icons/media-share_12_a5b38dfd.svg"),"media-share_24":t.toUrl("./icons/media-share_24_38760978.svg"),mention:t.toUrl("./icons/mention_44570103.svg"),menu:t.toUrl("./icons/menu_78918377.svg"),microphone:t.toUrl("./icons/microphone_ad5e2ccd.svg"),microphone_12:t.toUrl("./icons/microphone_12_6099dd94.svg"),"missed-audio-call":t.toUrl("./icons/missed-audio-call_b6bda791.svg"),"missed-video-call":t.toUrl("./icons/missed-video-call_b38e4f8b.svg"),"mob-online":t.toUrl("./icons/mob-online_28aa0a34.svg"),money:t.toUrl("./icons/money_d4191f8b.svg"),more:t.toUrl("./icons/more_edec5d86.svg"),music:t.toUrl("./icons/music_3d526d00.svg"),music_12:t.toUrl("./icons/music_12_09d10404.svg"),next:t.toUrl("./icons/next_9034f5f1.svg"),off:t.toUrl("./icons/off_5142e84c.svg"),official:t.toUrl("./icons/official_78989d17.svg"),"outgoing-audio-call":t.toUrl("./icons/outgoing-audio-call_3dbf5af1.svg"),"outgoing-video-call":t.toUrl("./icons/outgoing-video-call_1fccbf1a.svg"),participants:t.toUrl("./icons/participants_6188565b.svg"),pause:t.toUrl("./icons/pause_e328e5b8.svg"),"photo-add":t.toUrl("./icons/photo-add_d7206a2f.svg"),photo:t.toUrl("./icons/photo_bba65832.svg"),photo_12:t.toUrl("./icons/photo_12_24b49631.svg"),photocamera:t.toUrl("./icons/photocamera_7516aead.svg"),"picture-in-picture":t.toUrl("./icons/picture-in-picture_7a7c43d4.svg"),pin:t.toUrl("./icons/pin_398ecb5f.svg"),play:t.toUrl("./icons/play_4590cd12.svg"),plus:t.toUrl("./icons/plus_227fad85.svg"),popular:t.toUrl("./icons/popular_918e9a1d.svg"),preview:t.toUrl("./icons/preview_c06a1cd8.svg"),previous:t.toUrl("./icons/previous_e21cc0ac.svg"),read:t.toUrl("./icons/read_8ce7db11.svg"),readed:t.toUrl("./icons/readed_364ca6df.svg"),refresh:t.toUrl("./icons/refresh_1db551db.svg"),remove:t.toUrl("./icons/remove_24d79cf7.svg"),reply:t.toUrl("./icons/reply_1ac95ee8.svg"),"rotate-l":t.toUrl("./icons/rotate-l_cc070b48.svg"),search:t.toUrl("./icons/search_1797a3a7.svg"),send:t.toUrl("./icons/send_4f4590fc.svg"),settings:t.toUrl("./icons/settings_d4da4c0f.svg"),"shield-admin":t.toUrl("./icons/shield-admin_72cfb3f0.svg"),"shield-safety":t.toUrl("./icons/shield-safety_071dcbde.svg"),"shield-superadmin":t.toUrl("./icons/shield-superadmin_14bd5047.svg"),smiles:t.toUrl("./icons/smiles_4b3b6d9e.svg"),stars:t.toUrl("./icons/stars_3a24c6aa.svg"),stickerset:t.toUrl("./icons/stickerset_9965aac5.svg"),stop:t.toUrl("./icons/stop_485db85b.svg"),"to-message":t.toUrl("./icons/to-message_e61c4b16.svg"),"toolbar-bold":t.toUrl("./icons/toolbar-bold_9f7cf69b.svg"),"toolbar-heading":t.toUrl("./icons/toolbar-heading_ed2c0af7.svg"),"toolbar-italics":t.toUrl("./icons/toolbar-italics_1c1f56b6.svg"),"toolbar-link":t.toUrl("./icons/toolbar-link_72a8ac46.svg"),"toolbar-mark":t.toUrl("./icons/toolbar-mark_b91e05ce.svg"),"toolbar-monospace":t.toUrl("./icons/toolbar-monospace_34150da4.svg"),"toolbar-strike":t.toUrl("./icons/toolbar-strike_fa4c3101.svg"),"toolbar-underline":t.toUrl("./icons/toolbar-underline_12e841c6.svg"),tv:t.toUrl("./icons/tv_110706ac.svg"),unblock:t.toUrl("./icons/unblock_2157858e.svg"),undo:t.toUrl("./icons/undo_6cd5ab88.svg"),unpin:t.toUrl("./icons/unpin_c605f2db.svg"),unread:t.toUrl("./icons/unread_236556c6.svg"),unreaded:t.toUrl("./icons/unreaded_e5153d11.svg"),"user-blocked":t.toUrl("./icons/user-blocked_4cced795.svg"),"user-photo":t.toUrl("./icons/user-photo_1eac082e.svg"),user:t.toUrl("./icons/user_f39bae7e.svg"),user_12:t.toUrl("./icons/user_12_52885f2a.svg"),"video-call_12":t.toUrl("./icons/video-call_12_95c936d1.svg"),video:t.toUrl("./icons/video_49a33660.svg"),"views-off":t.toUrl("./icons/views-off_528dfc2b.svg"),vk:t.toUrl("./icons/vk_b559bc9a.svg"),"voice-speed-10":t.toUrl("./icons/voice-speed-10_1881c9b3.svg"),"voice-speed-15":t.toUrl("./icons/voice-speed-15_e1d9fa83.svg"),"voice-speed-20":t.toUrl("./icons/voice-speed-20_ca78746e.svg"),"volume-max":t.toUrl("./icons/volume-max_f3f82e3d.svg"),"volume-min":t.toUrl("./icons/volume-min_8cd00237.svg"),"volume-off":t.toUrl("./icons/volume-off_5b8898e6.svg"),wait:t.toUrl("./icons/wait_7465a068.svg")},ve={close:"clear",showRead:"looked","canceled-audio-call":"outgoing-audio-call","canceled-video-call":"outgoing-video-call",replay:"undo",link:"media-share_12",url:"media-share_12",report:"complaint","media-file":"file","media-music":"music","media-audio":"microphone",downloadVideo:"download"},he={},Ce={},ke=[];function be(t,e){var n=e&&he[e];n&&(n=n.cloneNode(!0)),t.setState({icon:n}),ye(t)}function ye(t){var e=t.state;if(e._listener){var n=ke.indexOf(e._listener);-1!==n&&ke.splice(n,1),e._listener=null}}function Se(t){return t.state.icon}function we(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountInnerHTML(t,r,Se),Ee}function Ee(t,e){n.updateInnerHTML(e._1)}we.dispose=function(t){t._1=n.clearInnerHTML(t._1)};var xe={__proto__:null,cssScope:"e-utlnif",default:we,didChange:function(t,e){var n=e.icon;if(n)if(n.current){var o=ve[n.current]||n.current;o in he?be(t,o):function(t,e){var n=t.state;n._listener||(n._listener=function(){var e=ve[t.props.icon]||t.props.icon;e&&!he[e]||be(t,e)},ke.push(n._listener));Ce[e]||function(t,e){Ce[t]=function(t){return new Promise((function(e,n){var o=new XMLHttpRequest;o.open("GET",t),o.onerror=n,o.onload=function(){200===o.status?e(o.responseText):n(new Error(o.statusText))},o.send(null)}))}(e).then((function(e){return he[t]=function(t){var e=document.createElement("div"),n=document.createDocumentFragment();e.innerHTML=t.trim();for(;e.firstChild;)n.appendChild(e.firstChild);return n}(e),Ce[t]=null,ke.slice().forEach((function(t){return t()})),e})).catch((function(e){throw console.warn(e),Ce[t]=null,e}))}(e,function(t,e){if(e in ge)return ge[e];var n=t.store.get().staticRoot;return"".concat(n,"/images/icons/").concat(e,".svg")}(t,e))}(t,o)}else be(t,null)},willUnmount:function(t){ye(t)}};var Ie="e6xzvbp";var Be={__proto__:null,cssScope:Ie,default:function(t){var e=t.componentView,o=n.appendChild(e,n.elem("div",Ie));n.setClass(o,"dots-okmsg"),n.setAttribute(o,"data-tsid","loader_dots");var r=n.appendChild(o,n.elem("i",Ie));n.setClass(r,"dot-okmsg");var a=n.appendChild(o,n.elem("i",Ie));n.setClass(a,"dot-okmsg");var i=n.appendChild(o,n.elem("i",Ie));n.setClass(i,"dot-okmsg")},props:function(){return{type:1,size:"medium",paused:!1,inverted:!1}}},Me=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],Ae=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];
/*!
    Version: 0.5
    Author: Mario Klingemann
    Contact: mario@quasimondo.com
    Website: http://www.quasimondo.com/BoxBlurForCanvas
    Twitter: @quasimondo

    In case you find this class useful - especially in commercial projects -
    I am not totally unhappy for a small donation to my PayPal account
    mario@quasimondo.de

    Or support me on flattr:
    https://flattr.com/thing/140066/Superfast-Blur-a-pretty-fast-Box-Blur-Effect-for-CanvasJavascript

    Copyright (c) 2011 Mario Klingemann

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.
    */function Te(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1),e|=0,(n|=0)>3&&(n=3),n<1&&(n=1);for(var o,r,a,i,s,u,c,p,l,m,d,_,f=t.width,g=t.height,v=t.getContext("2d"),h=v.getImageData(0,0,f,g),C=h.data,k=f-1,b=g-1,y=e+1,S=[],w=[],E=[],x=Me[e],I=Ae[e],B=[],M=[];n-- >0;){for(_=d=0,s=0;s<g;s++){for(o=C[_]*y,r=C[_+1]*y,a=C[_+2]*y,u=1;u<=e;u++)c=_+((u>k?k:u)<<2),o+=C[c++],r+=C[c++],a+=C[c++];for(i=0;i<f;i++)S[d]=o,w[d]=r,E[d]=a,0===s&&(B[i]=((c=i+y)<k?c:k)<<2,M[i]=(c=i-e)>0?c<<2:0),p=_+B[i],l=_+M[i],o+=C[p++]-C[l++],r+=C[p++]-C[l++],a+=C[p++]-C[l++],d++;_+=f<<2}for(i=0;i<f;i++){for(o=S[m=i]*y,r=w[m]*y,a=E[m]*y,u=1;u<=e;u++)o+=S[m+=u>b?0:f],r+=w[m],a+=E[m];for(d=i<<2,s=0;s<g;s++)C[d]=o*x>>>I,C[d+1]=r*x>>>I,C[d+2]=a*x>>>I,0===i&&(B[s]=((c=s+y)<b?c:b)*f,M[s]=(c=s-e)>0?c*f:0),p=i+B[s],l=i+M[s],o+=S[p]-S[l],r+=w[p]-w[l],a+=E[p]-E[l],d+=f<<2}}v.putImageData(h,0,0)}var je=50,Pe=function(t){void 0===t&&(t=200);var e={},n=[],o=0;function r(){for(;o>t&&n.length;){var r=n.shift();r in e&&(URL.revokeObjectURL(e[r]),o--,delete e[r])}}function a(t){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}return{get:function(t){if(t in e)return a(t),e[t]},set:function(t,n){t in e||o++,e[t]=n,a(t),r()},remove:function(t){-1===n.indexOf(t)&&n.push(t),r()}}}(300);var Re="e-qgmoaf";function Le(t,e,o){n.updateAttribute(t,e,"style","background-image: url("+o.state.src+")")}function Oe(t,e,o){var r=o._4=n.insert(e,n.elem("div",Re)),a=o._5=n.obj();return n.setClass(r,"fill-okmsg"),Le(r,a,t),ze}function ze(t,e){Le(e._4,e._5,t)}function De(t){return t.state.src?Oe:null}function Ue(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,De),Ne}function Ne(t,e){n.updateBlock(e._1)}Oe.dispose=function(t){t._5=t._4=null},Ue.dispose=function(t){t._1=n.clearBlock(t._1)};var qe={__proto__:null,cssScope:Re,default:Ue,props:function(){return{src:null}},didChange:function(t,e){var n,o,r=e.src;if(r)if(r.current){var a=Pe.get(r.current);a?t.setState({src:a}):(n=r.current,o=3,new Promise((function(t,e){var r=new Image,a=function(){r.onload=r.onerror=null};r.onerror=function(){a(),e()},r.onload=function(){a();var e=document.createElement("canvas"),n=e.getContext("2d"),i=Math.min(1,je/r.naturalWidth,je/r.naturalHeight);e.width=Math.max(1,i*r.naturalWidth),e.height=Math.max(1,i*r.naturalHeight),n.drawImage(r,0,0,e.width,e.height),Te(e,o),e.toBlob((function(e){return t(URL.createObjectURL(e))}))},r.crossOrigin="anonymous",r.src=n}))).then((function(e){Pe.set(r.current,e),r.current===t.props.src&&t.setState({src:e})})).catch((function(e){t.setState({src:null}),e&&console.error("blur error:",e)}))}else t.setState({src:null})},willUnmount:function(t){var e=t.props.src;e&&Pe.remove(e)}};var He="ef5d6xb";function Fe(t,e){e.large=t.props.width*t.props.height>=25600&&t.props.width>=128&&t.props.height>=128,e.ifExpr=!e.large}function Ve(t,e,n){e.src=n.props.src}function Ke(t,e,o,r){n.updateAttribute(t,e,"title",r.ifExpr?o.store.data.l10n("censor.warning"):void 0)}function We(t,e){e.stopPropagation(),Zt(t,"uncensor")}function Ge(t,e,n,o){e.size=o.large?"large":"medium"}function Ye(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"censor.warning"}))}function Xe(t,e){return e.large?Ye:null}function Qe(t,e){var o=t.componentView;Fe(t,e);var r=e._4=n.appendChild(o,n.createComponent("msg-img-fill",qe,t)),a=e._5=n.propsSet(r);Ve(0,a,t),n.mountComponent(r,a);var i=e._6=n.appendChild(o,n.elem("div",He)),s=n.createInjector(i),u=e._7=n.obj();n.setClass(i,"wrap-okmsg"),Ke(i,u,t,e),e._8=n.addEvent(i,"click",We,t,e);var c=e._9=n.insert(s,n.createComponent("msg-icon",xe,t)),p=e._a=n.propsSet(c,{icon:"views-off"});return Ge(0,p,0,e),n.mountComponent(c,p),e._b=n.mountBlock(t,s,Xe),n.subscribeStore(t,["l10n"]),Je}function Je(t,e){var o=e._4,r=e._5,a=e._9,i=e._a;Fe(t,e),Ve(0,r,t),n.updateComponent(o,r),Ke(e._6,e._7,t,e),Ge(0,i,0,e),n.updateComponent(a,i),n.updateBlock(e._b)}Ye.dispose=function(t){t._e=n.unmountComponent(t._e)},Qe.dispose=function(t){t._4=n.unmountComponent(t._4),t._8=n.removeEvent("click",t._8),t._9=n.unmountComponent(t._9),t._b=n.unmountBlock(t._b)};var $e={__proto__:null,cssScope:He,default:Qe,props:function(){return{src:null,width:null,height:null}}};var Ze={mouseenter:function(t){en(t)||t.setState({playing:!0,loadingVideo:!0})},mouseleave:function(t){!en(t)&&t.state.playing&&t.setState({playing:!1})}};function tn(t,e){console.log("failed to load",t.state.src,e);var n=t.props.src;t.setState({error:!0,src:n.gif&&n.file?n.previewUrl:dt}),!1===navigator.onLine&&window.addEventListener("online",t._onOnline)}function en(t){var e=t.props,n=e.src,o=e.gifAutoplay;return!(null==n?void 0:n.gif)||o}var nn="e-cti6js";function on(t,e){e.videoBlob=n.get(t.props.src,"file")&&jt(0,n.get(t.props.src,"file","type"),"video"),e.videoSrc=e.videoBlob?n.get(t.props.src,"file","objectUrl"):n.get(t.props.src,"mp4Url"),e.isVideo=n.get(t.props.src,"gif")||e.videoBlob,e.ratio=t.props.height/t.props.width,e.ifExpr=e.isVideo&&!t.props.censored&&!t.state.loading&&t.state.playing,e.ifExpr_1=e.isVideo&&t.state.loading}function rn(t,e,o,r){n.updateClass(t,e,"wrap-okmsg"+(r.ifExpr?" __playing-okmsg":"")+(r.ifExpr_1?" __loading-okmsg":"")),n.updateAttribute(t,e,"style","width:"+o.props.width+"px;padding-bottom: "+100*r.ratio+"%;")}function an(t,e,o){e.src=n.get(o.props.src,"previewData"),e.height=o.props.height,e.width=o.props.width}function sn(t,e){var o=e._g,r=e._h;an(0,r,t),n.updateComponent(o,r)}function un(t,e,o){return o._g?sn(t,o):function(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-img-censor",$e,t)),a=o._h=n.propsSet(r);an(0,a,t),n.mountComponent(r,a)}(t,e,o),n.stopAnimation(o._g,!0),cn}function cn(t,e){sn(t,e)}function pn(t){return t.props.censored?un:null}function ln(t,e,o){var r=o._p=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{size:"medium",inverted:!0}))}function mn(t,e){return e.ifExpr_1?ln:null}function dn(t,e,o,r){n.updateAttribute(t,e,"src",r.videoSrc),n.updateAttribute(t,e,"width",o.props.width||null),n.updateAttribute(t,e,"height",o.props.height||null),n.updateProperty(t,e,"autoplay",!o.props.censored&&(o.props.autoplay||null))}function _n(t,e){t.setState({loading:!1})}function fn(t,e,o){o._m=n.mountBlock(t,e,mn);var r=o._r=n.insert(e,n.elem("video",nn));n.setPendingRef(o._1,"video",r);var a=o._s=n.obj();r.loop="loop",r.muted="muted",r.playsInline=!0,dn(r,a,t,o),o._t=n.addEvent(r,"playing",_n,t,o);var i=n.insert(e,n.elem("div",nn));return n.setClass(i,"gif_ic-okmsg"),gn}function gn(t,e){var o=e._r;n.updateBlock(e._m),n.setPendingRef(e._1,"video",o),dn(o,e._s,t,e)}function vn(t,e){return e.isVideo?fn:null}function hn(t,e,o){n.updateAttribute(t,e,"src",o.state.src),n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height),n.updateClass(t,e,o.props["сensored"]?"censored-okmsg":"")}function Cn(t,e,o){var r=o._y=n.insert(e,n.elem("img",nn)),a=o._z=n.obj();return n.setAttribute(r,"alt",""),hn(r,a,t),o._10=n.addEvent(r,"error",tn,t,o),kn}function kn(t,e){hn(e._y,e._z,t)}function bn(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"photo",class:"stub-okmsg"}))}function yn(t){return t.state.src?Cn:t.props.fallback?bn:null}function Sn(t,e){var o=t.componentView,r=e._1=n.obj();on(t,e);var a=e._9=n.appendChild(o,n.elem("div",nn)),i=n.createInjector(a);return rn(a,e._a=n.obj(),t,e),e._b=n.mountBlock(t,i,pn),e._j=n.mountBlock(t,i,vn),e._v=n.mountBlock(t,i,yn),n.finalizePendingRefs(t,r),wn}function wn(t,e){on(t,e),rn(e._9,e._a,t,e),n.updateBlock(e._b),n.updateBlock(e._j),n.updateBlock(e._v),n.finalizePendingRefs(t,e._1)}un.dispose=function(t,e){n.animate(t._g,n.createAnimation("global:msg-fade-out 0.9s",nn),(function(){return function(t){var e=t._g;t._g=n.unmountComponent(e),n.domRemove(e),t._h=null}(t)}))},ln.dispose=function(t){t._p=n.unmountComponent(t._p)},fn.dispose=function(t){t._m=n.unmountBlock(t._m),t._t=n.removeEvent("playing",t._t),t._s=t._r=null},Cn.dispose=function(t){t._10=n.removeEvent("error",t._10),t._z=t._y=null},bn.dispose=function(t){t._13=n.unmountComponent(t._13)},Sn.dispose=function(t){t._b=n.unmountBlock(t._b),t._j=n.unmountBlock(t._j),t._v=n.unmountBlock(t._v)};var En={__proto__:null,cssScope:nn,default:Sn,props:function(){return{width:374,height:280}},events:Ze,willMount:function(t){t._onOnline=function(){t.setState({src:St(t.props.src)}),window.removeEventListener("online",t._onOnline)}},willUnmount:function(t){window.removeEventListener("online",t._onOnline)},didChange:function(t,e){var n,o=e.src,r=e.gifAutoplay;if(o){var a=null===(n=o.prev)||void 0===n?void 0:n.file;if(a&&!a.objectUrl&&!a.url){var i=t.state.src;requestAnimationFrame((function(){return URL.revokeObjectURL(i)}))}t.setState({error:!1,src:St(o.current)})}r&&t.setState({playing:r.current})},didRender:function(t){var e=t.refs.video;e&&(t.state.playing?(e.muted=!0,e.play()):t.props.gifAutoplay||isNaN(e.duration)||(e.pause(),e.currentTime=0))},handleError:tn};var xn="e6o1svb";function In(t,e,o){n.updateAttribute(t,e,"data-long",n.get(o.props.attachment,"longitude")),n.updateAttribute(t,e,"data-lat",n.get(o.props.attachment,"latitude")),n.updateAttribute(t,e,"data-zoom",n.get(o.props.attachment,"zoom")),n.updateAttribute(t,e,"data-map-url",o.state.url)}function Bn(t,e){In(e._1,e._2,t)}var Mn={__proto__:null,cssScope:xn,default:function(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("div",xn));n.setRef(t,"hook",r);var a=e._2=n.obj();return n.setClass(r,"h-mod-okmsg"),n.setAttribute(r,"data-module","Map"),n.setAttribute(r,"data-height","282"),n.setAttribute(r,"data-l","t,location"),In(r,a,t),Bn},didMount:function(e){new Promise((function(e,n){t(["OK/Map"],e,n)})).then((function(t){var n=t.default;null!==e.map&&(e.setState({url:"//maps.ok.ru/osm/{z}/{x}/{y}.png?tkn=71siNpscl7_elUwb6eznxqv4ItAkrLpgH945OyC323aLpg5V5TOCnA"}),e.map=new n,e.map.activate(e.refs.hook))}))},willUnmount:function(t){t.map&&t.map.deactivate(),t.map=null}};function An(t){return!isNaN(parseFloat(t))&&isFinite(t)}function Tn(t,e,n){return Math.min(n,Math.max(e,t))}var jn="undefined"!=typeof IntersectionObserver,Pn=new a;function Rn(t,e){var o=n.ne(t);return jn&&requestAnimationFrame((function(){if(!o.disposed){e=e||t.canvas.closest(".js-lottie-observer")||null;var n=Pn.get(e);n||(n={observer:new IntersectionObserver(Ln),refs:new a},Pn.set(e,n)),n.observer.observe(t.canvas),n.refs.set(t.canvas,o),o.on("dispose",On)}})),o}var Ln=function(t){t.forEach((function(t){var e=function(t){var e;return Pn.forEach((function(n){var o=n.refs;o.has(t)&&(e=o.get(t))})),e}(t.target);e&&(t.isIntersecting?e.play():e.pause())}))};function On(){var t=this;Pn.forEach((function(e,n){e.refs.delete(t.canvas)&&(e.observer.unobserve(t.canvas),e.refs.size||(e.observer.disconnect(),Pn.delete(n)))}))}var zn=o.debounce((function(){var t=0;n.ce().registry.forEach((function(e){return t+=e.players.length})),OK.logger.success("messagesLayer","lottie-count",String(function(t){if(t>=1e4)t=1e4;else if(t>20){var e=1e3;t<100?e=10:t<1e3&&(e=100),t=Math.round(t/e)*e}return t}(t)))}),1e3);function Dn(){zn()}function Un(t){Nn(t);var e=t.refs.canvas,n=t.props,o=n.url,r=n.width,a=n.height,i=n.id,s=n.loop;if(e&&o){var u=Rn({id:i,movie:o,canvas:e,width:r,height:a,loop:s});u.on("rendered",(function(){t.setState({rendered:!0}),te(t,"rendered"),e.style.backgroundImage="none"})),u.on("end",(function(){return te(t,"end")})),Dn(),t.setState({player:u})}else e&&(e.width=r,e.height=a)}function Nn(t){var e=t.state.player;e&&(e.dispose(),t.setState({player:null,rendered:!1}))}window.addEventListener("focus",(function(){return n.ae()})),window.addEventListener("blur",(function(){return n.fe()})),window.__lottieInternals=n.ce;var qn="e7sl4ll";function Hn(t,e,o){n.updateClass(t,e,o.state.rendered?"rendered-okmsg":"")}function Fn(t,e){Hn(e._1,e._2,t)}var Vn={__proto__:null,cssScope:qn,default:function(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("canvas",qn));return n.setRef(t,"canvas",r),Hn(r,e._2=n.obj(),t),Fn},extend:{dispose:function(){Nn(this)}},didChange:function(t,e){var n=e.width,o=e.height,r=e.autoplay,a=t.state.player;a&&((n||o)&&a.resize(t.props.width,t.props.height),r&&(r.current?a.play():a.pause()))},didRender:function(t,e){var n=e.staticUrl;if(n&&!t.state.rendered){var o=t.refs.canvas;o&&(o.style.backgroundImage=n.current?"url(".concat(t.props.staticUrl,")"):"none")}},didMount:function(t){return Un(t),function(){return Nn(t)}},didUpdate:function(t,e){e.url&&Un(t)}};function Kn(t){for(var e=0,n=t.length;e<n&&"/"===t[e];)e++;for(;e<n&&"/"===t[n-1];)n--;return t.substring(e,n)||""}function Wn(t){var e=location.origin||"".concat(location.protocol,"//").concat(location.host);if(/^[a-z]+:/.test(t)){if(t.slice(0,e.length)!==e)return"";t=t.slice(e.length)}var n=t.match(/^\/?messages\/(.+)/);if(null===n)return"";var o=Kn(n[1]);return o.length<4?"":o}function Gn(t){return!!t&&(/[a-z]+:/.test(t)&&(t=Wn(t)),/^\/?:/.test(t))}function Yn(t){return(t=Kn(t.replace(/^\/?messages/,""))||"/").match(/^c/)?-parseInt(t.replace(/^c/,""),10):An(t)?Number(t):t}function Xn(t){var e;"DIALOG"===t.type?e=t.participants.find((function(t){return!t.user.current})).user.id:e="c"+Math.abs(t.id);return"/messages/".concat(e)}function Qn(t){return t?t.replace(/&amp;/g,"&"):t}function Jn(t,e,n){void 0===n&&(n=!1),"undefined"!=typeof OK?(n&&OK.Layers.unregisterLast(),Zt(t,"navigate-url",{url:Qn(e)})):location.href=e}function $n(t,e,n){void 0===n&&(n=!1),e.profileUrl?Jn(t,e.profileUrl.replace(/^\w+:\/\/[^/]+/,""),n):Jn(t,"/group/".concat(e.id),n)}function Zn(t){try{return new URL(t)}catch(n){var e=document.createElement("a");return e.href=t,e}}function to(t){return Zn(t).pathname.split("/").filter(Boolean)}function eo(t,e){if(void 0===e&&(e=oo()),!e||e.collapsed)return!1;var n=document.createRange();return n.selectNodeContents(t),ro(e,n)}function no(t){return"IMG"===t.nodeName&&t.alt.length>0&&(t.classList.contains("user-sticker")||t.classList.contains("emoji"))}function oo(){var t=window.getSelection();return t.rangeCount?t.getRangeAt(0):null}function ro(t,e){if(!(t instanceof Range&&e instanceof Range))return!1;var n=t.compareBoundaryPoints(Range.START_TO_END,e);return-1===t.compareBoundaryPoints(Range.END_TO_START,e)&&1===n}var ao={":-)":"04",":)":"04",":-(":"06",":(":"06",";-)":"09",";)":"09",":-D":"11",":D":"11","=)":"04",":-@":"02",":@":"02","^o)":"01",":-S":"03",":S":"03","*-)":"07",":-|":"08",":|":"08",":-I":"08",":I":"08","8oI":"10","8o|":"10",":'(":"13",":-P":"14",":P":"14",":-$":"26",":$":"26",":-O":"27",":O":"27","|-)":"28","(ch)":"41","(lo)":"44","(sr)":"45","|-(":"46","(H)":"47","(hu)":"48","(tr)":"49","(md)":"50","(fr)":"51","(dt)":"52","(sc)":"53","(Y)":"12","(y)":"12","(N)":"15","(n)":"15","(v)":"34","(L)":"16","(U)":"17","(K)":"24","(F)":"23","(*)":"32","(^)":"19","(G)":"21","(B)":"25","(D)":"29","(CC)":"22","(pi)":"30","(pl)":"33","(ic)":"36","($)":"baks","(co)":"35","(so)":"38","(te)":"40","(nt)":"39","(I)":"18","(E)":"20","(Z)":"42","(X)":"43","(S)":"31"};function io(t,e){if(n.ie){var o=function(t){var e=G().get().config,n=null==e?void 0:e.server["animated-emojis-places"];return t&&(null==n?void 0:n.includes(t))&&e.server["animated-emojis"]}(e);if(o)return function(t,e){var o,r=null===(o=t[e])||void 0===o?void 0:o.emoji;if(r)return n.__assign(n.__assign({},r),{id:e,staticUrl:r.staticUrl||yo(e)})}(o,t)}}var so,uo=new i,co=null,po=0,lo=4,mo="/favicon.ico";try{so=window}catch(t){so=self}function _o(t){return uo.add(t),!1!==navigator.onLine&&null===co&&go(),function(){return function(t){so.removeEventListener("online",t),uo.delete(t),0===uo.size&&ho()}(t)}}function fo(t,e){var n,o=0,r=null,a=function(e){var o=yt(e);o!==n&&(n=o,t.addEventListener("load",s),t.addEventListener("error",u),t.src=n||dt)},i=function(){null!==r&&(r(),r=null),a(e)},s=function(){n!==dt&&(o=0,c(),te(t,"load-success"))},u=function(){null===r&&o<4&&(o++,r=_o(i),a(dt))},c=function(){t.removeEventListener("load",s),t.removeEventListener("error",u)};return i(),{update:function(t){!e||"string"==typeof e||e.objectUrl||e.url||URL.revokeObjectURL(n),e=t,o=0,null===r&&a(e)},destroy:function(){null!==r&&(r(),r=null),c()}}}function go(){var t=this;ho(),co=so.setTimeout((function(){return n.__awaiter(t,void 0,void 0,(function(){var t;return n.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=function(t){var e=-1===t.indexOf("?")?"?":"&";return"".concat(t).concat(e,"_=").concat(Math.random())}(mo),[4,fetch(t,{credentials:"include"})];case 1:return e.sent(),po=0,vo(),ho(),[3,3];case 2:return e.sent(),ho(),uo.size&&go(),[3,3];case 3:return[2]}}))}))}),function(t){return 1e3*(Math.pow(2,Math.min(t,lo))+Math.random())}(po++))}function vo(){if(uo.size){var t=Array.from(uo);uo.clear(),t.forEach((function(t){return t()}))}}function ho(){so.clearTimeout(co),co=null}so.addEventListener("online",vo);var Co="Mac OS"===o.getOSVersion(),ko=[20,32,48];function bo(t){t.setState({error:!1,loading:!1})}function yo(t,e,o){if(void 0===o&&(o=20),o=function(t){for(var e=0,n=ko.length-1;e<=n;e++)if(ko[e]>=t||e===n)return ko[e];return 20}(o),e&&e!==t){var r=function(t,e){var n=Zo(t);return(null==n?void 0:n.fileName)?"".concat(Ho,"/").concat(Fo,"/ok/").concat(e,"/").concat(n.fileName):""}(e,o);if(r)return r}return t.startsWith("#u")?"//i.mycdn.me/getSmile?smileId=".concat(t.slice(2,-2)):"".concat(Ho,"/").concat(Fo,"/").concat(o,"/").concat(n.getFilename(t),"@2x.png")}function So(t){var e=t.props,n=e.emoji,o=e.src,r=e.size,a=e.rawEmoji;return o||(n?yo(n,a,r):"")}var wo="e-c1vofl";function Eo(t,e,n){e.url=n.state.lottieUrl,e.width=n.props.width||n.props.size,e.height=n.props.height||n.props.size,e.staticUrl=n.state.src,e.id=n.state.lottieId}function xo(t,e,o){var r=o._4=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._5=n.propsSet(r,{autoplay:!0,loop:!0});return Eo(0,a,t),n.mountComponent(r,a),Io}function Io(t,e){var o=e._4,r=e._5;Eo(0,r,t),n.updateComponent(o,r)}function Bo(t){return t.state.lottieUrl?xo:null}function Mo(t,e,o){n.updateAttribute(t,e,"width",o.props.width||o.props.size),n.updateAttribute(t,e,"height",o.props.height||o.props.size),n.updateAttribute(t,e,"alt",o.state.alt),n.updateClass(t,e,o.state.error||o.state.loading?"hidden-okmsg":"")}function Ao(t,e){t.setState({error:!0})}function To(t,e,o){return o._i=n.insert(e,n.text(t.state.alt)),jo}function jo(t,e){n.updateText(e._i,t.state.alt)}function Po(t){return(t.state.error||t.state.loading&&t.state.isMacos)&&t.state.alt?To:null}function Ro(t,e,o){var r=o._a=n.insert(e,n.elem("img",wo)),a=o._b=n.obj();return n.setAttribute(r,"loading","lazy"),Mo(r,a,t),o._c=n.mountUse(t,r,fo,t.state.src),o._d=n.addEvent(r,"load-success",bo,t,o),o._e=n.addEvent(r,"error",Ao,t,o),o._f=n.mountBlock(t,e,Po),Lo}function Lo(t,e){Mo(e._a,e._b,t),n.updateUse(e._c,t.state.src),n.updateBlock(e._f)}function Oo(t){return t.state.lottieUrl?null:Ro}function zo(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,Bo),e._7=n.mountBlock(t,r,Oo),Do}function Do(t,e){n.updateBlock(e._1),n.updateBlock(e._7)}xo.dispose=function(t){t._4=n.unmountComponent(t._4),t._5=null},To.dispose=function(t){t._i=null},Ro.dispose=function(t){t._c=n.unmountUse(t._c),t._d=n.removeEvent("load-success",t._d),t._e=n.removeEvent("error",t._e),t._f=n.unmountBlock(t._f),t._b=t._a=null},zo.dispose=function(t){t._1=n.clearBlock(t._1),t._7=n.clearBlock(t._7)};var Uo,No={__proto__:null,cssScope:wo,default:zo,imageOnline:fo,state:function(){return{isMacos:Co,error:!1,loading:!1}},didChange:function(t,e){var n=e.emoji,o=e.rawEmoji,r=e.src,a=e.size,i=e.alt,s=e.lottieUrl,u=e.lottieId;if((n||r||a)&&t.setState({src:So(t),loading:!0,error:!1}),s&&t.setState({lottieUrl:s.current,lottieId:u.current||t.props.rawEmoji||t.props.alt||t.props.emoji}),n||i||o){var c=t.props.rawEmoji||t.props.alt||t.props.emoji;if(!t.props.lottieUrl){var p=io(c,t.props.sourceName);p&&t.setState({lottieUrl:p.url,lottieId:p.id})}t.setState({alt:c})}},onLoad:bo,createUrl:yo},qo=window.devicePixelRatio>1?"@2x":"",Ho="//st.mycdn.me/static/emoji",Fo="15-0-0",Vo="/".concat(Fo),Ko="/".concat(Fo,"/ok"),Wo=new a,Go=["😂","😘","👍","😊","🌹","😄","😡","😀","😉","😔","😍","😃","😜","🙈","😭","😁","💩","😒","😳","😞","😝","😅","🌺","😏","😢","😆","💔","😛","🌼","😚","🙏","🌙","👊","🌷","💐","😋","🎁","👏","👌","💋"].map((function(t){return{type:"EMOJI",value:t}}));function Yo(){Uo||(Uo=n.list.map((function(t,e){var o={id:e,emoji:t,baseUrl:Vo,fileName:"".concat(n.getFilename(t)).concat(qo,".png")};return Wo.set(t,o),o})),Object.keys(ao).forEach((function(t){var e=ao[t],n={id:t,emoji:t,baseUrl:Ko,ok:!0,fileName:"".concat(e).concat(qo,".png")};Wo.set(t,n)})))}function Xo(){return Yo(),Uo}function Qo(t){if(Array.isArray(t)){var e=Xo()[t[0]];return e.skin=t[1].map(Qo),e}return Xo()[t]}function Jo(t,e){var n=$o(function(t){return t.map((function(t){return String.fromCodePoint(t)})).join("")}(e));return n&&Wo.set(t,n),n}function $o(t){return Yo(),Wo.get(t)}function Zo(t){var e,o=$o(t);if(!o)if(function(t){var e=t.charCodeAt(1);return t.charCodeAt(0)<255&&8419!==e&&65039!==e}(t))Wo.set(t,("#"===(e=t)[0]&&(e=e.slice(2,-2)),o={id:e,emoji:"#u".concat(e,"s#"),url:"//i.mycdn.me/getSmile?smileId=".concat(e),user:!0}));else{var r=n.getCodePoints(t);o=Jo(t,function(t){return 65039===t[t.length-1]?t.slice(0,-1):t.concat(65039)}(r))||Jo(t,function(t){var e=t.indexOf(9794);return-1===e&&(e=t.indexOf(9792)),-1!==e&&(t=t.slice()).splice(e,0,8205),t}(r))||Jo(t,function(t){var e=t.indexOf(8419),n=t.indexOf(65039);return e===t.length-1&&-1===n&&(t=t.slice()).splice(1,0,65039),t}(r))}return o}function tr(t){return{render:function(e,o,r,a){if(null!==e){var i={emoji:e,rawEmoji:r,size:t.size,sourceName:t.context,lottieUrl:null==a?void 0:a.lottieUrl,lottieId:null==a?void 0:a.cid};return o?o.setProps(i):o=n.endorphin("msg-emoji",No,{props:i}),o}(null==o?void 0:o.componentModel)&&n.unmountComponent(o)},getParams:function(){return t},context:function(e,o){var r=t;t=n.__assign(n.__assign({},t),e),o(),t=r}}}var er,nr,or,rr,ar={swipeThreshold:20,tapDelay:250,longTapDelay:400,singleTapDelay:200},ir="ontouchstart"in document?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"};function sr(t){var e=n.__assign(n.__assign({},ar),t),o=null,r=null,a=null;function i(t){var n=this;if(cr(t)&&!("button"in t&&t.button>0)){t.stopPropagation();var r=ur(t);pr(this,"pointer:start",o={start:r,end:r,timestamp:Date.now(),moveCoords:[],moved:!1},t),a=window.setTimeout((function(){p(),o&&(pr(n,"pointer:end",o,t),pr(n,"pointer:long-tap",o,t),o=null)}),e.longTapDelay)}}function s(t){if(o){var n=ur(t);Math.abs(o.start.x-n.x)<e.swipeThreshold&&Math.abs(o.start.y-n.y)<e.swipeThreshold||(p(),o.end=n,o.moved=!0,o.moveCoords.push(o.end),cr(t)?pr(this,"pointer:move",o,t):(pr(this,"pointer:end",o,t),o=null))}}function u(t){var n=this;if(p(),o){if(o.moved){var a=!0;if(o.moveCoords.length>1){var i=void 0,s=0,u=function(t){t=t.slice(-7).reverse();for(var e=0,n=0,o=t.length-1,r=0;r<o;r++)e+=t[r].x-t[r+1].x,n+=t[r].y-t[r+1].y;return{x:e,y:n}}(o.moveCoords);if(Math.abs(u.y)>Math.abs(u.x)?(s=u.y,i=["down","up"]):(s=u.x,i=["right","left"]),Math.abs(s)>e.swipeThreshold)(m=pr(this,"pointer:swipe",o,t,{direction:s>0?i[0]:i[1],velocity:s})).defaultPrevented&&(a=!1)}a&&pr(this,"pointer:end",o,t)}else{var l=Date.now(),m=pr(this,"pointer:end",o,t);if(l-o.timestamp<=e.tapDelay&&!m.defaultPrevented&&pr(this,"pointer:tap",o,t),r)c(),pr(this,"pointer:double-tap",o,t);else{var d=o;r=window.setTimeout((function(){pr(n,"pointer:single-tap",d,t),c()}),e.singleTapDelay)}}o=null}}function c(){r&&(window.clearTimeout(r),r=null)}function p(){a&&(window.clearTimeout(a),a=null)}return{willMount:function(t){t.addEventListener(ir.start,i),t.addEventListener(ir.move,s),t.addEventListener(ir.end,u)},willUnmount:function(t){t.removeEventListener(ir.start,i),t.removeEventListener(ir.move,s),t.removeEventListener(ir.end,u)}}}function ur(t){return lr(t)?{x:t.touches[0].pageX,y:t.touches[0].pageY}:{x:t.pageX,y:t.pageY}}function cr(t){return!lr(t)||1===t.touches.length}function pr(t,e,o,r,a){var i=n.__assign({start:o.start,end:o.end,moved:o.moved,originalEvent:r},a),s=new CustomEvent(e,{cancelable:!0,bubbles:!0,detail:i});return t.dispatchEvent(s),s.defaultPrevented&&r&&r.preventDefault(),s}function lr(t){return t.touches&&t.touches.length>0}function mr(){var t;if(!nr&&!or){var e=G().get().config,n=(null==e?void 0:e.server["keywords-animation"])||new a;er=new a,nr=[],or=new a,rr=new a;var o=function(e){if(n.hasOwnProperty(e)){var o=n[e];o.words.split(",").forEach((function(t){nr.push({phrase:t.trim(),theme:e})}));var r=null===(t=o.anims)||void 0===t?void 0:t.split(",").map((function(t){return t.trim()}));r&&or.set(e,r);var a=o.bg;a&&rr.set(e,a)}};for(var r in n)o(r)}}function dr(t){var e=t.nodeName;return"INPUT"===e||"TEXTAREA"===e||t.isContentEditable}function _r(t,e){return(t.animationName||"").includes("".concat(e,"-panel"))}function fr(t,e){try{localStorage.setItem(t,e)}catch(t){console.warn(t)}}var gr=864e5;function vr(t,e,n,o,r){var a=function(t){return t?";expires="+new Date(Date.now()+t*gr).toUTCString():""}(n)+function(t){return t?";path="+t:""}(o)+function(t){return t?";domain="+t:""}(r);document.cookie=t+"="+encodeURIComponent(e)+a}function hr(t){return(e=t,e.getRootNode?e.getRootNode():document).activeElement||document.activeElement;var e}function Cr(t){if("nodeName"in t){var e=t.nodeName;return"A"===e||"BUTTON"===e}return!1}function kr(t){return Array.from(t.querySelectorAll('a, button, [tabindex="0"], input:not([type=hidden])'))}function br(t){try{return(null==t?void 0:t.matches(":focus-visible"))||!1}catch(t){return!1}}!function(t){for(var e=document.cookie.split(";"),n=0;n<e.length;n++){var o=e[n].trim();if(0===o.indexOf(t+"="))return o.substring(t.length+1)}}("_okSat");var yr=function(){};function Sr(t,e){var n,o,r=null!==(n=null==e?void 0:e.dispatch)&&void 0!==n?n:yr,a=null!==(o=null==e?void 0:e.abort)&&void 0!==o?o:yr;return r({type:"start"}),new Promise((function(n,o){var i=!1,s=new XMLHttpRequest;s.responseType="blob",s.onprogress=function(t){a()?i||(i=!0,s.abort()):i||r({type:"progress",loaded:t.loaded,total:t.total})},s.onabort=function(){r({type:"abort"}),o(new wr)},s.onerror=function(){var e=new Error("Failed to load file ".concat(t));r({type:"error",error:e}),o(e)},s.onload=function(){var o,a=e.fileName||function(t){if(!t)return"";var e={};t.split(";").forEach((function(t){var n,o=t.trim().split("="),r=o[0],a=o[1];e[r.trim()]=null!==(n=null==a?void 0:a.trim())&&void 0!==n?n:null}));var n="";e["filename*"]?n=e["filename*"].replace(/^utf-8''/,""):e.filename&&(n=e.filename.slice(1,-1));return n&&decodeURIComponent(n.replace(/\+/g," "))}(s.getResponseHeader("Content-Disposition"))||"file";try{o=new File([s.response],a,{type:"application/octet-stream"})}catch(t){(o=new Blob([s.response],{type:"application/octet-stream"})).name=a,o.lastModified=Date.now(),o.lastModifiedDate=new Date}if(r({type:"complete",file:o}),n(o),null==e?void 0:e.save){var i=URL.createObjectURL(o);Er({fileName:e.fileName,url:t,localUrl:i,file:o}),setTimeout((function(){return URL.revokeObjectURL(i)}),1e4)}},s.withCredentials=!1,s.open("GET",t,!0),s.send()}))}var wr=function(t){function e(e){return t.call(this,e||"Request aborted")||this}return n.__extends(e,t),e}(Error);function Er(t){var e;if(navigator.msSaveBlob&&t.file)navigator.msSaveBlob(t.file,t.file.name);else{var n=document.createElement("a");n.href=t.localUrl||t.url,n.download=t.fileName||(null===(e=t.file)||void 0===e?void 0:e.name)||"file",document.body.appendChild(n),requestAnimationFrame((function(){return document.body.removeChild(n)})),n.click()}}var xr=new a,Ir=new a;function Br(t){var e;return null===(e=t.props.message.attaches)||void 0===e?void 0:e.find((function(t){return"VIDEO"===t._type}))}function Mr(t,e){var o,r=xr.get(t),a=n.__assign(n.__assign({},r),e);xr.set(t,a),null===(o=Ir.get(t))||void 0===o||o.forEach((function(t){Tr(t,a)}))}function Ar(t){var e,n=xr.get(t);(null==n?void 0:n.timer)&&clearTimeout(null==n?void 0:n.timer),xr.delete(t),null===(e=Ir.get(t))||void 0===e||e.forEach((function(t){Tr(t,null)}))}function Tr(t,e){t.setState({videoDownload:e})}function jr(){var t=new Date,e="".concat(t.getFullYear(),"-").concat(tt(t.getMonth()+1),"-").concat(tt(t.getDate())),n="".concat(tt(t.getHours()),":").concat(tt(t.getMinutes()),":").concat(tt(t.getSeconds()));return"video-".concat(e,"_").concat(n,".mp4")}var Pr=new a;function Rr(e,n){var o=Pr.get(e);return o?Promise.resolve(o):(Pr.set(e,null),new Promise((function(e,n){t(["OK/ShortcutMenu"],e,n)})).then((function(t){var o=t.default||t;if(o&&null===Pr.get(e)){var r=new o("tt_sm"),a="".concat(Date.now(),"-").concat(n.id);return e.setAttribute("id",a),e.setAttribute("data-holder",a),e.setAttribute("data-nocache","1"),e.setAttribute("data-position","auto"),e.setAttribute("data-hideonscroll","1"),e.setAttribute("data-blockid","tt_ + ".concat(Date.now())),e.setAttribute("data-module","ShortcutMenu"),e.setAttribute("data-url","/dk?cmd=ShortcutMenu&t=UserMenu&id=".concat(n.id,"&st.cmd=userMain")),e.classList.add("h-mod"),e.classList.add("sc-menu_w"),r.activate(e),Pr.set(e,r),r}})))}function Lr(t){var e=Pr.get(t);Pr.delete(t),e&&(t.removeAttribute("id"),t.removeAttribute("data-holder"),t.removeAttribute("data-nocache"),t.removeAttribute("data-position"),t.removeAttribute("data-hideonscroll"),t.removeAttribute("data-blockid"),t.removeAttribute("data-module"),t.removeAttribute("data-url"),t.classList.remove("h-mod"),t.classList.remove("sc-menu_w"),e.deactivate())}var Or=3,zr="mentionId",Dr=[sr(),{didMount:function(t){var e=function(e){"downloadVideo"===e.detail.action&&function(t){n.__awaiter(this,void 0,void 0,(function(){var e,o,r,a,i,s,u;return n.__generator(this,(function(n){switch(n.label){case 0:return(e=Br(t))?(o=e.videoId,r=t.props.message,a=r.chatId,i=r.id,Mr(o,{id:o,status:"pending",total:0,loaded:0}),(s=e.urlData)?[3,2]:[4,t.store.app.message.getVideoUrlData(a,i,o,e.token)]):(console.warn("Nothing to download: no video attach"),[2]);case 1:s=n.sent(),n.label=2;case 2:return u=s?function(t){var e,n=0;return Object.keys(t).forEach((function(o){var r=o.match(/^MP4_(\d+)/);if(r){var a=Number(r[1]);a>n&&(n=a,e=t[o])}})),e&&/^http:/.test(e)&&(e="https:"+e.slice(5)),e}(s):void 0,u?(Mr(o,{status:"loading",url:u}),[2,Sr(u,{fileName:jr(),dispatch:function(t){switch(t.type){case"abort":case"complete":Ar(o);break;case"progress":Mr(o,{status:"loading",loaded:t.loaded,total:t.total});break;case"error":Ar(o),Er({url:u,fileName:jr()})}},abort:function(){return!xr.has(o)},save:!0})]):(function(t,e){var n=L(t,"toast");n.show(V(e))}(t,"download-video.unavailable"),Ar(o),[2])}}))}))}(t)},o=function(){var e=Br(t);e&&Ar(e.videoId)};t.addEventListener("run-message-action",e),t.addEventListener("abort-download",o);var r=Br(t);return r&&function(t,e){var n=xr.get(t);Ir.has(t)||Ir.set(t,new i),Ir.get(t).add(e),n&&Tr(e,n)}(r.videoId,t),function(){t.removeEventListener("run-message-action",e),t.removeEventListener("abort-download",o),r&&function(t,e){var n=Ir.get(t);n&&n.delete(e)}(r.videoId,t)}}}],Ur={mouseenter:function(t){(0,t.setState)({active:!0})},mouseleave:function(t){(0,t.setState)({active:!1})},click:function(t,e){!t.store.get().isMobile&&t.props.selectMode&&na(t,e)},keydown:function(t,e){"Enter"===e.key?t.state.focusMode||(e.preventDefault(),e.stopPropagation(),function(t){t.setState({focusMode:!0}),n.afterUpdate(t,(function(){var e=kr(t)[0];e&&"focus"in e&&e.focus()}))}(t)):"Escape"===e.key&&t.state.focusMode&&(e.preventDefault(),e.stopPropagation(),t.focus())},focusout:function(t,e){ua(t,e.relatedTarget)},"pointer:double-tap":function(t,e){t.store.get().isMobile||ia(t,e)},"pointer:move":function(t,e){},"pointer:end":function(t,e){t.store.get().isMobile&&t.state.scheduleReply&&ia(t,e),t.setState({offset:0,scheduleReply:!1})},"pointer:single-tap":function(t,e){var n=t.store.get().isMobile,o=e.detail.originalEvent;t===o.target&&n&&t.props.selectMode&&na(t,o)},"pointer:long-tap":function(t,e){var n=t.store.get().isMobile,o=e.detail.originalEvent;n&&o.target.closest("msg-message")&&na(t,o)},"runtime-error":function(t,e){var n=t.props.message;e.detail&&n&&(e.detail.chatId=n.chatId,e.detail.messageId=n.id)},"message-react":function(t,e){var n=t.props.message;e.detail&&n&&(e.detail.chatId=n.chatId,e.detail.messageId=n.id)},lottieAnimationEnd:function(t){t.setState({wordsAnimateUrl:""})}},Nr={get text(){var t=this.props.message;return t&&t.text||""}};function qr(t,e){return t===e||!(!t||!e)&&(t.text===e.text&&t.elements===e.elements&&t.link===e.link)}var Hr,Fr={command:!1,hashtag:!0,link:!0,markdown:!1,mention:!1,textEmoji:!0,userSticker:!0};function Vr(){return Hr||(Hr=document.querySelector("msg-app")),Hr}function Kr(t){var e,n,r,a=lt(t);if("number"==typeof a){if(n=a,r=Vr().store.app.chat._contacts.currentUser.id,!(e=o.xor64(r,n)))return"/"}else e=a;return"".concat(document.location.origin,"/messages/").concat(e,"?").concat(zr,"=").concat(a)}var Wr=tr({size:20}),Gr={emoji:Wr.render,link:function(t){if(t.type===n.TokenType.HashTag)return t.value;if(t.type===n.TokenType.Mention)return Kr(t.mention);if(t.type===n.TokenType.Command)return"/".concat(t.command);if(t.type===n.TokenType.Link){var e=t.link;return"@"===e[0]?Kr(e.slice(1)):e}return""},replaceTextEmoji:!0,inline:!0};function Yr(t,e){var o=e[0],r=e[1];Wr.context({size:r?48:20},(function(){n.render(t,o,Gr);for(var e=t.querySelectorAll("a"),r=0;r<e.length;r++)e[r].setAttribute("tabindex","-1"),e[r].setAttribute("rel","nofollow noopener")}))}function Xr(t,e){var n=e.target;if(n&&n.classList.contains("mention")){var o=function(t){var e=Vr();if(e){var n=t.getAttribute("href").split("?")[1];if(n){var o=new URLSearchParams(n).get(zr);if(o&&An(o))return e.store.get().contacts.get(Number(o))}}}(n);o&&Rr(n,o).then((function(t){t&&t.showMenu()}))}}function Qr(t,e){return Yr(t,e),{update:function(n){(function(t,e){return t[0]!==e[0]||t[1]!==e[1]})(e,n)&&Yr(t,n),e=n},destroy:function(){for(var e=t.querySelectorAll("msg-lottie"),n=0;n<e.length;n++)e[n].dispose()}}}function Jr(t,e,o){var r=n.getText$1(t),a={add:n.TokenFormat.Highlight};return o&&(r=r.toLowerCase(),e=e.map((function(t){return t.toLowerCase()}))),e.forEach((function(e){var o=r.indexOf(e);-1!==o&&(t=n.setFormat$1(t,a,o,e.length,!0))})),t}function $r(t,e,o){var r=(t.text||"").trim(),a=n.parse$1(r,o);return t.elements&&(a=ut(a,t.elements)),e&&(a=Jr(a,e,!0)),a}function Zr(t){if(t.type===n.TokenType.Text&&t.emoji){for(var e=0,o=0;o<t.emoji.length;o++){var r=t.emoji[o];if(r.from!==e)break;e=r.to}if(e===t.value.length)return t.emoji.length}return null}function ta(t){var e,n=t.props,o=n.message,r=n.highlights,a=n.allowCommands,i=t.store.get().config;Fr.command=!!a,Fr.textEmoji=i.server["text-emoji-mode"];var s=o.link&&"FORWARD"===o.link.type?o.link.message:o,u=$r(s,r,Fr),c=function(t){for(var e=0,n=0;n<t.length;n++){var o=Zr(t[n]);if(null===o||0!==t[n].format)return 0;e+=o}return e}(u);t.setState({tokens:u,largeEmoji:c>0&&c<=Or&&!(null===(e=s.attaches)||void 0===e?void 0:e.length)})}function ea(t,e){e.stopPropagation();var n=t.props.message.link.message;eo(t.refs.contents)||Zt(t,"highlight-message",{messageTime:n.time,messageId:n.id})}function na(t,e){e.stopPropagation(),eo(t)?e.preventDefault():function(t,e){void 0===e&&(e=!1);var n=t.props,o=n.message,r=n.selected;Zt(t,r?"unselect-message":"select-message",{messageId:o.id,group:e})}(t,e.shiftKey)}function oa(e,n,o,r){r.stopPropagation();var a=o.props.message.attaches.find((function(t){return"STICKER"===t._type}));"MASS_SEND"===n&&a?Zt(o,"open-send-action-congrats-friends",{actionDestinationType:"MASS_SEND",type:"ACTION_STICKERS",stickerHash:a.stickerId.toString(16)}):(Zt(o,"open-congrats-menu",{tab:e}),new Promise((function(e,n){t(["OK/logger"],e,n)})).then((function(t){t.success("messagesLayer.congrats","show.attach",e)})))}function ra(t){t.setState({menuOpen:!1,focusMode:!1})}function aa(t){var e=t.text,o=t.zoom,r=t.elements,a=n.parse$1(e,Fr),i=!1;if(1===a.length&&(!(null==r?void 0:r.length)||r.every((function(t){return"ANIMOJI"===(null==t?void 0:t.type)})))){var s=Zr(a[0]);s&&(i=s<=Or)}return!!o||i}function ia(t,e){var n,o,r=t.store.get(),a=r.selectedChat,i=r.isMobile,s=e.detail.originalEvent;if("CHANNEL"===a.type){var u=null===(n=null==a?void 0:a.owner)||void 0===n?void 0:n.current,c=null===(o=null==a?void 0:a.admins)||void 0===o?void 0:o.find((function(t){return t.user.current})),p=c&&c.permissions;if(!u&&!c||c&&!p.manageMessages)return}t.props.message.id&&!t.props.message.error&&t.props.message.actions.find((function(t){return"reply"===t.type}))&&(!i&&s.target.closest("msg-parsed-text, msg-video-player, img, .text, msg-button, msg-icon")||Zt(t,"message-dblclick",{message:t.props.message}))}function sa(t){Zt(t,"message-controls",{message:t.props.message})}function ua(t,e){e&&t!==e&&function(t,e){if(t.contains(e))return!0;var n=e.closest("[data-message-context]");if(n){var o=n.getAttribute("data-message-context"),r=t.props.message;return o===String(r.id||r.uid)}return!1}(t,e)||t.setState({focusMode:!1})}function ca(t,e,n){n.stopPropagation(),n.preventDefault();var o,r="dailyphoto";to(t).indexOf(r)>-1&&(o=r,OK.logger.success("messagesLayer","tt-link",o)),OK.Layers.unregisterLast(),Jn(e,t)}var pa=tr({size:20}),la=n.__assign(n.__assign({},Gr),{emoji:pa.render});function ma(t){var e=t.props,o=e.singleLine,r=e.emojiSize,a=e.emojiContext,i=e.messageElements,s=t.props.highlights,u=t.state.text||"";o&&(u=u.replace(/[\r\n]+/g," "));var c=n.parse$1(u,t.props);i&&(c=ut(c,i)),s&&(Array.isArray(s)||(s=[s]),c=function(t,e,o){var r=n.getText$1(t),a={add:n.TokenFormat.Highlight};return o&&(r=r.toLowerCase(),e=e.map((function(t){return t.toLowerCase()}))),e.forEach((function(e){var o=r.indexOf(e);-1!==o&&(t=n.setFormat$1(t,a,o,e.length,!0))})),t}(c,s,!0)),pa.context({size:r||20,context:a},(function(){return n.render(t,c,la)}))}var da="e-xdu8xj";function _a(t,e){n.insert(e,n.text("\n        ...\n    "))}function fa(t){return-1!==t.props.focusHighlight&&Tt(0,t.state.tokens)&&0!==n.get(t.state.tokens,0,"start")?_a:null}function ga(t,e){t.setState({open:!0})}function va(t,e,o){var r=n.insert(e,n.elem("span",da));n.setClass(r,"art-okmsg"),n.setAttribute(r,"data-tsid","smile_art_in_message"),o._a=n.addEvent(r,"click",ga,t,o);var a=o._b=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{key:"smile-art"}));var i=o._d=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(i,n.propsSet(i,{icon:"arrow-right",class:"arrow-okmsg",size:"small"}))}function ha(t){return t.state.tokens}function Ca(t,e){e.chooseExpr=n.get(e.value,"type")==n.get(e.value,"types","LINK")?0:n.get(e.value,"type")==n.get(e.value,"types","MENTION")?1:n.get(e.value,"type")==n.get(e.value,"types","EMOJI")?2:n.get(e.value,"type")==n.get(e.value,"types","USER_STICKER")?3:n.get(e.value,"type")==n.get(e.value,"types","HASHTAG")?4:n.get(e.value,"type")==n.get(e.value,"types","COMMAND")||n.get(e.value,"type")==n.get(e.value,"types","MENTION_COMMAND")?5:n.get(e.value,"format")?6:7,e.caseExpr=0===e.chooseExpr,e.url=e.caseExpr?n.get(e.value,"opts","link",0,"url"):void 0,e.isOkDomain=e.caseExpr?t.props.openInsidePortal&&n.call(t.state,"containsDomain",[e.url,n.get(t.store.data.config,"server","ok-domains")]):void 0,e.ifExpr=!e.isOkDomain}function ka(t,e,o,r){n.updateAttribute(t,e,"href",r.url),n.updateAttribute(t,e,"title",n.get(r.value,"opts","link",0,"text")),n.updateClass(t,e,n.get(r.value,"className")),n.updateAttribute(t,e,"target",r.ifExpr?"_blank":void 0),n.updateAttribute(t,e,"rel",r.ifExpr?"nofollow noopener":void 0)}function ba(t,e,n,o){ca(o.url,t,e)}function ya(t,e){e.isOkDomain&&n.setPendingEvent(e._u,"click",ba,e)}function Sa(t,e,o){var r=o._t=n.insert(e,n.elem("a",da)),a=n.createInjector(r),i=o._u=n.pendingEvents(t,r),s=o._v=n.obj();return n.setAttribute(r,"data-tsid","link_in_message"),ka(r,s,0,o),ya(0,o),o._y=n.insert(a,n.text(n.get(o.value,"value"))),n.finalizePendingEvents(i),wa}function wa(t,e){ka(e._t,e._v,0,e),ya(0,e),n.updateText(e._y,n.get(e.value,"value")),n.finalizePendingEvents(e._u)}function Ea(t,e,o){return o._12=n.insert(e,n.text(n.get(o.value,"value"))),xa}function xa(t,e){n.updateText(e._12,n.get(e.value,"value"))}function Ia(t,e,o,r){e.url=n.get(r.value,"lottie","url"),e.staticUrl=n.get(r.value,"lottie","staticUrl"),e.id=n.get(r.value,"lottie","id"),e.source=o.props.emojiContext}function Ba(t,e,o){var r=o._18=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._19=n.propsSet(r,{class:"emoji-okmsg",width:16,height:16,autoplay:!0,loop:!0});return Ia(0,a,t,o),n.mountComponent(r,a),Ma}function Ma(t,e){var o=e._18,r=e._19;Ia(0,r,t,e),n.updateComponent(o,r)}function Aa(t,e,o,r){n.updateAttribute(t,e,"src",o.store.data.emojiRoot+n.get(r.value,"baseUrl")+"/"+(o.state.largeEmoji?48:20)+"/"+n.get(r.value,"fileName")),n.updateAttribute(t,e,"alt",n.get(r.value,"value")),n.updateClass(t,e,"emoji-okmsg js-emoji"+(o.state.largeEmoji?" large-okmsg":"")+(n.get(r.value,"ok")?" emoji-ok-okmsg":""))}function Ta(t,e,o){return Aa(o._1c=n.insert(e,n.elem("img",da)),o._1d=n.obj(),t,o),ja}function ja(t,e){Aa(e._1c,e._1d,t,e)}function Pa(t,e,o){return o._1g=n.insert(e,n.text(n.get(o.value,"value"))),Ra}function Ra(t,e){n.updateText(e._1g,n.get(e.value,"value"))}function La(t,e){return n.get(e.value,"lottie")?Ba:n.get(e.value,"fileName")?Ta:Pa}function Oa(t,e,o){return o._15=n.mountBlock(t,e,La),za}function za(t,e){n.updateBlock(e._15)}function Da(t,e,o,r){n.updateAttribute(t,e,"src",o.props.userStickerUrl+n.get(r.value,"opts","code")),n.updateAttribute(t,e,"alt",n.get(r.value,"value"))}function Ua(t,e,o){var r=o._1j=n.insert(e,n.elem("img",da)),a=o._1k=n.obj();return n.setClass(r,"user-sticker-okmsg js-user-sticker"),Da(r,a,t,o),Na}function Na(t,e){Da(e._1j,e._1k,t,e)}function qa(t,e,o,r){n.updateAttribute(t,e,"href",n.get(r.value,"value"))}function Ha(t,e,o){var r=o._1n=n.insert(e,n.elem("a",da)),a=o._1o=n.obj();return n.setClass(r,"hashtag-okmsg"),qa(r,a,0,o),o._1p=n.appendChild(r,n.text(n.get(o.value,"value"))),Fa}function Fa(t,e){qa(e._1n,e._1o,0,e),n.updateText(e._1p,n.get(e.value,"value"))}function Va(t,e,o,r){n.updateAttribute(t,e,"href",n.get(r.value,"value"))}function Ka(t,e,o){var r=o._1s=n.insert(e,n.elem("a",da)),a=o._1t=n.obj();return n.setClass(r,"command-okmsg"),Va(r,a,0,o),o._1u=n.appendChild(r,n.text(t.props.value)),Wa}function Wa(t,e){Va(e._1s,e._1t,0,e),n.updateText(e._1u,t.props.value)}function Ga(t,e,o,r){n.updateClass(t,e,n.get(r.value,"className"))}function Ya(t,e,o){var r=o._1x=n.insert(e,n.elem("span",da)),a=o._1y=n.obj();return n.setAttribute(r,"data-tsid","formatted_text"),Ga(r,a,0,o),o._1z=n.appendChild(r,n.text(n.get(o.value,"value"))),Xa}function Xa(t,e){Ga(e._1x,e._1y,0,e),n.updateText(e._1z,n.get(e.value,"value"))}function Qa(t,e,o){return o._22=n.insert(e,n.text(n.get(o.value,"value"))),Ja}function Ja(t,e){n.updateText(e._22,n.get(e.value,"value"))}function $a(t,e){return[Sa,Ea,Oa,Ua,Ha,Ka,Ya,Qa][e.chooseExpr]}function Za(t,e,o){return Ca(t,o),o._q=n.mountBlock(t,e,$a),ti}function ti(t,e){Ca(t,e),n.updateBlock(e._q)}function ei(t,e,o){return o._h=n.mountIterator(t,e,ha,Za),ni}function ni(t,e){n.updateIterator(e._h)}function oi(t){return!t.state.smileArt||t.state.open||t.props.disableArt?ei:va}function ri(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,fa),e._6=n.mountBlock(t,r,oi),n.subscribeStore(t,["config","emojiRoot"]),ai}function ai(t,e){n.updateBlock(e._1),n.updateBlock(e._6)}va.dispose=function(t){t._a=n.removeEvent("click",t._a),t._b=n.unmountComponent(t._b),t._d=n.unmountComponent(t._d)},Sa.dispose=function(t){t._u=n.detachPendingEvents(t._u),t._v=t._y=t._t=null},Ea.dispose=function(t){t._12=null},Ba.dispose=function(t){t._18=n.unmountComponent(t._18),t._19=null},Ta.dispose=function(t){t._1d=t._1c=null},Pa.dispose=function(t){t._1g=null},Oa.dispose=function(t){t._15=n.unmountBlock(t._15)},Ua.dispose=function(t){t._1k=t._1j=null},Ha.dispose=function(t){t._1o=t._1p=t._1n=null},Ka.dispose=function(t){t._1t=t._1u=t._1s=null},Ya.dispose=function(t){t._1y=t._1z=t._1x=null},Qa.dispose=function(t){t._22=null},Za.dispose=function(t){t._q=n.unmountBlock(t._q)},ei.dispose=function(t){t._h=n.unmountIterator(t._h)},ri.dispose=function(t){t._1=n.clearBlock(t._1),t._6=n.clearBlock(t._6)};var ii={__proto__:null,cssScope:da,default:ri,props:function(){return{cutFormattingChars:!0,highlights:null,focusHighlight:-1,disableFormatting:!0,disableLinks:!1,disableArt:!1,disableMentioning:!1,userStickerUrl:"https://i.mycdn.me/getSmile?smileId=",userStickerSize:"",allowLargeEmoji:0,trimLinks:0,emojiSize:20,emojiContext:"msg-parsed-text",messageElements:[],largeWithText:!1,allowHashtags:!1,allowCommands:!1,openInsidePortal:!1}},state:function(){return{text:"",open:!1,containsDomain:function(t,e){var n=Zn(t).host;return e.trim().split(/\s*,\s*/).indexOf(n)>-1}}},didSlotUpdate:function(t,e,n){if(""===e){var o=n.textContent.trim();t.setState({text:o}),ma(t)}},didChange:function(t){ma(t)},willUnmount:function(t){for(var e=t.querySelectorAll("msg-lottie"),n=0;n<e.length;n++)e[n].dispose()},navOk:ca};function si(t){if(t.state.ellipsis){var e=t.state.open,n=e?"AUDIO_TRANSCRIPTION_COLLAPSE":"AUDIO_TRANSCRIPTION_EXPAND";t.root.state.service.log.action(n),t.setState({open:!e})}}function ui(t){if(!t.state.open){var e,n=t.refs.text&&(e=t.refs.text).offsetWidth<e.scrollWidth;t.setState({ellipsis:n})}}var ci="e-fxu5id";function pi(t,e,o){n.updateClass(t,e,"accordion-okmsg"+(o.props.compact?" __compact-okmsg":"")+(o.state.open?" __open-okmsg":""))}function li(t,e){t.props.compact||n.setPendingEvent(e._2,"click",si,e)}function mi(t,e,n){e.highlights=n.props.highlights,e.class=n.state.open?"":"__preview-okmsg"}function di(t){return n.get(t.props.attachment,"transcription")}function _i(t,e,n){e.class=n.state.ellipsis||n.state.open?"":"__hidden-okmsg"}function fi(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-icon",xe,t)),a=o._e=n.propsSet(r,{icon:"arrow-right"});return _i(0,a,t),n.mountComponent(r,a),gi}function gi(t,e){var o=e._d,r=e._e;_i(0,r,t),n.updateComponent(o,r)}function vi(t){return t.props.compact?null:fi}function hi(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("div",ci)),a=n.createInjector(r),i=e._2=n.pendingEvents(t,r);pi(r,e._3=n.obj(),t),li(t,e);var s=e._6=n.insert(a,n.createComponent("msg-parsed-text",ii,t)),u=s.componentModel.input;n.setRef(t,"text",s);var c=e._7=n.propsSet(s);return mi(0,c,t),e._8=n.mountInnerHTML(t,u,di),n.mountComponent(s,c),e._a=n.mountBlock(t,a,vi),n.finalizePendingEvents(i),Ci}function Ci(t,e){var o=e._6,r=e._7;pi(e._1,e._3,t),li(t,e),mi(0,r,t),n.updateInnerHTML(e._8),n.updateComponent(o,r),n.updateBlock(e._a),n.finalizePendingEvents(e._2)}fi.dispose=function(t){t._d=n.unmountComponent(t._d),t._e=null},hi.dispose=function(t){t._2=n.detachPendingEvents(t._2),t._8=n.unmountInnerHTML(t._8),t._6=n.unmountComponent(t._6),t._a=n.unmountBlock(t._a)};var ki={__proto__:null,cssScope:ci,default:hi,didMount:function(t){t.props.resize&&(t._resizeHandler=function(){return o.throttle((function(){return ui(t)}),100)},window.addEventListener("resize",t._resizeHandler)),ui(t)},willUnmount:function(t){t._resizeHandler&&window.removeEventListener("resize",t._resizeHandler)},didChange:function(t,e){var n=e.open;n&&n.current&&t.setState({open:n.current})},onClick:si},bi=window.devicePixelRatio||1;function yi(t,e,n,o){void 0===o&&(o=function(t,e){return t[e]});for(var r=[],a=0;a<e;)r.push(Object.assign({},{height:o(t,a,e,n)},n)),a++;return r}function Si(t,e,n,o){var r=t.canvas.offsetHeight;t.save(),t.fillStyle=n;var a=o.width+o.gap,i=0;e.forEach((function(e){var n=e.height*r,o=(r-n)*e.align;t.fillRect(i,o,e.width,n),i+=a})),t.restore()}function wi(t,e,n){var o,r=t.store.app;"string"==typeof e?(r.config.setUserSettings(((o={})[e]=n,o)),Zt(t,"update-user-settings",{name:e,value:n,settings:Ei(t)})):e&&"object"==typeof e&&(r.config.setUserSettings(e),Zt(t,"update-user-settings",{data:e,settings:Ei(t)}))}function Ei(t){return t.store.app.config.getUserSettings()}var xi="dark-theme",Ii="light",Bi="dark";function Mi(){var t=window.CSS&&window.CSS.supports.bind(window.CSS)||window.supportsCSS;return!!t&&t("color","var(--primary)")}function Ai(t){return Ti(t)===Bi}function Ti(t){var e=t.store.get().config;if(!e.server["dark-theme"]||!Mi())return Ii;var n=e.user.THEME;return n?(OK.logger.success("messagesLayer",xi,"get-"+n),n):(OK.logger.success("messagesLayer",xi,"get-none"),Ii)}function ji(t){!function(t,e){OK.logger.success("messagesLayer",xi,"set-"+e),wi(t,"THEME",e),Pi(e===Bi)}(t,Ti(t)===Ii?Bi:Ii)}function Pi(t){for(var e=document.getElementsByClassName("js-msg-dark-theme"),n=0;n<e.length;n++)e[n].classList.toggle("__dark",t)}var Ri={width:2,gap:1,align:.5};var Li={mousedown:function(t,e){1===e.which&&function(t,e){var n=t.getBoundingClientRect(),o=function(e){var o=n.width?(e.pageX-n.left)/n.width:0;Zt(t,"position-change",{position:Math.min(Math.max(0,o),1)})};o(e);var r=function(){Zt(t,"seek-end"),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",r)}(t,e)}};var Oi="efg4vnv";function zi(t,e,o){n.updateAttribute(t,e,"style","width:"+100*o.state.progress+"%")}function Di(t,e){zi(e._1,e._2,t)}var Ui={__proto__:null,cssScope:Oi,default:function(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("div",Oi)),a=e._2=n.obj();n.setClass(r,"progress-holder-okmsg"),zi(r,a,t);var i=n.appendChild(r,n.elem("canvas",Oi));n.setRef(t,"progress",i);var s=n.appendChild(o,n.elem("canvas",Oi));return n.setRef(t,"background",s),n.setClass(s,"background-okmsg"),Di},props:function(){return{wave:null,progress:0}},events:Li,methods:{resize:function(){this.setState({needUpdate:!0})}},willMount:function(t){t.setState({isDark:Ai(t)})},didChange:function(t,e){var n=e.progress;n&&t.setState({progress:n.current,needUpdate:!0})},didRender:function(t,e){(e.wave||t.state.needUpdate)&&(t.setState({needUpdate:!1}),requestAnimationFrame((function(){return function(t){var e=t.state.isDark,n=e?"#EBEBEB":"#333",o=e?"#808080":"#999",r=t.props,a=r.wave;void 0===a&&(a=[]);var i=t.refs,s=i.background,u=i.progress,c=Ri.width+Ri.gap,p=t.offsetWidth,l=t.offsetHeight,m=Math.floor(p/c);s.width=u.width=p*bi,s.height=u.height=l*bi,s.style.cssText=u.style.cssText="width:"+p+"px; height:"+l+"px";var d=yi(a,m,Ri,(function(t,e){return function(t,e,n){void 0===n&&(n=.1);var o=e*(t.length-1),r=Math.floor(o),a=Math.ceil(o);return Math.max(t[r]+(t[a]-t[r])*(o-r),n)}(t,e/m)})),_=s.getContext("2d"),f=u.getContext("2d");_.save(),_.scale(bi,bi),f.save(),f.scale(bi,bi),Si(_,d,o,Ri),Si(f,d,n,Ri),_.restore(),f.restore()}(t)})))}};function Ni(t,e){n.updateText(e._1,Qt(0,t.props.duration,t.props.format))}var qi={__proto__:null,cssScope:"e-ngnyrx",default:function(t,e){var o=t.componentView;return e._1=n.appendChild(o,n.text(Qt(0,t.props.duration,t.props.format))),Ni}},Hi=[1,1.5,2],Fi="PAUSE",Vi="PLAYING",Ki=null;var Wi={play:function(){$i(this)}};function Gi(t){!function(t){t.state.playerState===Vi?Zi(t):$i(t)}(t)}function Yi(t,e){var n=t.refs.audio;n.currentTime=e.detail.position*n.duration||0,Ji(t)}function Xi(t){t.store.get().config.server["voice-speed-enabled"]&&"PLAYING"!==t.state.playerState&&$i(t)}function Qi(t){var e=t.props.attachment,n=t.store.get().config;Zi(t,!0),n.server["voice-speed-enabled"]&&Zt(t,"play-next",{attachment:e})}function Ji(t){var e=t.refs.audio,n=e.duration?e.currentTime/e.duration:0;t.setState({progress:n}),1===n&&Qi(t)}function $i(t){var e=t.store.get().config;Ki&&Ki!==t&&Zi(e.server["voice-speed-enabled"]?Ki:t,!0),os(t,ns(t)),t.setState({playerState:Vi}),t.refs.audio.play(),Ki=t;var n=function(){Ji(t),t.state.playerState===Vi&&requestAnimationFrame(n)};n()}function Zi(t,e){var n=t.refs.audio;e&&(n.currentTime=0,t.setState({progress:0})),t.setState({playerState:Fi}),n.pause()}function ts(t){if(!t)return null;if("string"!=typeof t)return t;var e=atob(t.split(",")[1]);return e.split("").map((function(t){return t.charCodeAt(0)/127}))}function es(t){var e=ns(t);os(t,Hi[(Hi.indexOf(e)+1)%Hi.length])}function ns(t){var e=t.store.get().config;return e.server["voice-speed-enabled"]?e.user.VOICE_SPEED:1}function os(t,e){wi(t,"VOICE_SPEED",e),t.refs.audio.playbackRate=e}var rs="ew8szxv";function as(t,e){e.transcriptionEnabled=n.get(t.store.data.config,"server","audio-transcription-enabled")&&n.get(t.store.data.config,"user","AUDIO_TRANSCRIPTION_ENABLED"),e.transcribed="AUDIO"===n.get(t.props.attachment,"_type")&&n.get(t.props.attachment,"transcription")&&e.transcriptionEnabled,e.hasVoiceProcessing="PROCESSING"===n.get(t.props.attachment,"transcriptionStatus")&&e.transcriptionEnabled,e.duration=t.state.progress?n.get(t.props.attachment,"duration")*t.state.progress:n.get(t.props.attachment,"duration"),e.hasFocus=void 0}function is(t,e,o,r){n.updateClass(t,e,"container-okmsg"+(r.hasVoiceProcessing?" __processing-okmsg":""))}function ss(t,e,n){e["aria-label"]="PLAYING"===n.state.playerState?"Пауза":"Воспроизвести сообщение",e.tabindex=n.props.focusMode?0:-1}function us(t,e,n){e.icon="PLAYING"===n.state.playerState?"pause":"play"}function cs(t,e,n){e.wave=n.state.wave,e.progress=n.state.progress}function ps(t,e,n,o){e.duration=Math.floor(o.duration)}function ls(t,e,o){e.title="Скорость воспроизведения "+n.get(o.store.data.config,"user","VOICE_SPEED"),e.tabindex=o.props.focusMode?0:-1}function ms(t,e,o){e.icon="voice-speed-"+10*n.get(o.store.data.config,"user","VOICE_SPEED")}function ds(t,e,o){var r=o._s=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._t=n.propsSet(r,{size:"small",shape:"circle"});ls(0,i,t),o._u=n.addEvent(r,"click",es,t,o);var s=o._v=n.insert(a,n.createComponent("msg-icon",xe,t),""),u=o._w=n.propsSet(s,{size:"medium"});return ms(0,u,t),n.mountComponent(s,u),n.mountComponent(r,i),_s}function _s(t,e){var o=e._s,r=e._t,a=e._v,i=e._w;ls(0,r,t),ms(0,i,t),n.updateComponent(a,i),n.updateComponent(o,r)}function fs(t){return n.get(t.store.data.config,"server","voice-speed-enabled")&&t.state.progress?ds:null}function gs(t,e,o){n.updateAttribute(t,e,"src",n.get(o.props.attachment,"url"))}function vs(t,e,n,o){e.attachment=n.props.attachment,e.resize=n.props.resize,e.open=!n.props.compact&&(n.props.search||o.hasFocus),e.highlights=n.props.highlights,e.compact=n.props.compact}function hs(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-message-voice-text",ki,t)),a=o._16=n.propsSet(r);return vs(0,a,t,o),n.mountComponent(r,a),Cs}function Cs(t,e){var o=e._15,r=e._16;vs(0,r,t,e),n.updateComponent(o,r)}function ks(t,e){return e.transcribed?hs:null}function bs(t,e){var o=t.componentView,r=n.createInjector(o);as(t,e);var a=e._7=n.insert(r,n.elem("div",rs)),i=n.createInjector(a);is(a,e._8=n.obj(),0,e);var s=e._9=n.insert(i,n.createComponent("button",fe,t)),u=s.componentModel.input,c=e._a=n.propsSet(s,{class:"play-button-okmsg",size:"large",shape:"circle"});ss(0,c,t),e._b=n.addEvent(s,"click",Gi,t,e);var p=e._c=n.insert(u,n.createComponent("msg-icon",xe,t),""),l=e._d=n.propsSet(p,{size:"medium"});us(0,l,t),n.mountComponent(p,l),n.mountComponent(s,c);var m=n.insert(i,n.elem("div",rs));n.setClass(m,"audio-middle-okmsg");var d=e._g=n.appendChild(m,n.createComponent("msg-audio-wave",Ui,t)),_=e._h=n.propsSet(d);cs(0,_,t),e._i=n.addEvent(d,"position-change",Yi,t,e),e._j=n.addEvent(d,"seek-end",Xi,t,e),n.mountComponent(d,_);var f=e._k=n.appendChild(m,n.createComponent("msg-duration",qi,t)),g=e._l=n.propsSet(f,{"aria-hidden":"true"});ps(0,g,0,e),n.mountComponent(f,g);var v=n.appendChild(m,n.elem("div",rs));n.setClass(v,"status-okmsg");var h=e._n=n.appendChild(v,n.createComponent("msg-l10n",ae,t));n.mountComponent(h,n.propsSet(h,{key:"message-voice-processing"})),e._p=n.mountBlock(t,i,fs);var C=e._z=n.insert(i,n.elem("audio",rs));n.setRef(t,"audio",C);var k=e._10=n.obj();return n.setAttribute(C,"preload","metadata"),gs(C,k,t),e._11=n.addEvent(C,"ended",Qi,t,e),e._12=n.mountBlock(t,r,ks),n.subscribeStore(t,["config"]),ys}function ys(t,e){var o=e._9,r=e._a,a=e._c,i=e._d,s=e._g,u=e._h,c=e._k,p=e._l;as(t,e),is(e._7,e._8,0,e),ss(0,r,t),us(0,i,t),n.updateComponent(a,i),n.updateComponent(o,r),cs(0,u,t),n.updateComponent(s,u),ps(0,p,0,e),n.updateComponent(c,p),n.updateBlock(e._p),gs(e._z,e._10,t),n.updateBlock(e._12)}ds.dispose=function(t){t._u=n.removeEvent("click",t._u),t._v=n.unmountComponent(t._v),t._s=n.unmountComponent(t._s),t._t=t._w=null},hs.dispose=function(t){t._15=n.unmountComponent(t._15),t._16=null},bs.dispose=function(t){t._b=n.removeEvent("click",t._b),t._c=n.unmountComponent(t._c),t._9=n.unmountComponent(t._9),t._i=n.removeEvent("position-change",t._i),t._j=n.removeEvent("seek-end",t._j),t._g=n.unmountComponent(t._g),t._k=n.unmountComponent(t._k),t._n=n.unmountComponent(t._n),t._p=n.unmountBlock(t._p),t._11=n.removeEvent("ended",t._11),t._12=n.clearBlock(t._12)};var Ss={__proto__:null,cssScope:rs,default:bs,props:function(){return{attachment:{}}},state:function(){return{progress:0,playerState:Fi,activeAudioAttach:null}},extend:Wi,onToggle:Gi,onPositionChange:Yi,onSeekEnd:Xi,onEnded:Qi,didMount:function(t){var e=ns(t);e||(e=1),os(t,e)},didChange:function(t,e){if("attachment"in e){var n=e.attachment.current;n&&n.wave&&!t.state.wave&&t.setState({wave:ts(n.wave)})}},incrementVoiceSpeed:es},ws=2*Math.PI,Es=1600;function xs(t){cancelAnimationFrame(t._raf),t._raf=null}function Is(t,e,n){void 0===n&&(n=0);var o=t.props.radius*ws,r=e*o,a=e?"stroke-dasharray: "+(r+", "+(o-r))+"; stroke-dashoffset: "+n*o:"stroke: none";t.setState({progressCss:a})}var Bs="e-mwylyn",Ms="http://www.w3.org/2000/svg";function As(t,e,o){n.updateAttribute(t,e,"width",o.props.size),n.updateAttribute(t,e,"height",o.props.size),n.updateAttribute(t,e,"viewBox","0 0 "+o.props.size+" "+o.props.size)}function Ts(t,e,o){n.updateAttribute(t,e,"cx",o.props.size/2),n.updateAttribute(t,e,"cy",o.props.size/2),n.updateAttribute(t,e,"r",o.props.radius),n.updateAttribute(t,e,"stroke-width",o.props.thickness),n.updateAttribute(t,e,"style",o.state.progressCss)}function js(t,e){As(e._1,e._2,t),Ts(e._3,e._4,t)}var Ps={__proto__:null,cssScope:Bs,default:function(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elemNS("svg",Ms,Bs)),a=e._2=n.obj();return n.setAttribute(r,"version","1.1"),n.setAttribute(r,"xmlns","http://www.w3.org/2000/svg"),As(r,a,t),Ts(e._3=n.appendChild(r,n.elemNS("circle",Ms,Bs)),e._4=n.obj(),t),js},props:function(){return{size:28,radius:13,thickness:2,progress:0,min:.03,cancelable:!1,spin:!1,indeterminate:!1}},init:function(t){t._raf=null},didChange:function(t,e){var n=e.indeterminate;n&&(n.current?function(t){var e=0,n=function(o){e||(e=o),t.setState({time:(o-e)%Es}),t._raf=requestAnimationFrame(n)};n()}(t):xs(t))},willRender:function(t){var e,n,o,r=t.props,a=r.indeterminate,i=r.min,s=r.progress;if(a){var u=t.state.time||0,c=2*(e=u,n=0,o=1,(e/=Es/2)<1?o/2*e*e*e+n:o/2*((e-=2)*e*e+2)+n);Is(t,i+(c<1?c:2-c)*(.7-i),-Math.max(c-1,0))}else Is(t,Math.max(s||0,i))},willUnmount:function(t){xs(t)}};function Rs(t,e){e.chooseExpr="GIF"===t.props.type?0:"AUDIO"===t.props.type?1:"AUDIO_ON"===t.props.type?2:"AUDIO_OFF"===t.props.type?3:4,e.caseExpr=0===e.chooseExpr,e.caseExpr_1=1===e.chooseExpr,e.caseExpr_2=2===e.chooseExpr,e.caseExpr_3=3===e.chooseExpr,e.caseExpr_4=4===e.chooseExpr}function Ls(t,e,n,o){e.icon=o.caseExpr_4?"play":o.caseExpr_3?"volume-off":o.caseExpr_2?"volume-max":o.caseExpr_1?"volume-min":o.caseExpr?"gif":void 0}function Os(t,e){var o=t.componentView;Rs(t,e);var r=e._8=n.appendChild(o,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=e._a=n.insert(a,n.createComponent("msg-icon",xe,t),""),s=e._b=n.propsSet(i);return Ls(0,s,0,e),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{shape:"circle",size:"small",class:"badge-okmsg"})),zs}function zs(t,e){var o=e._a,r=e._b;Rs(t,e),Ls(0,r,0,e),n.updateComponent(o,r)}Os.dispose=function(t){t._a=n.unmountComponent(t._a),t._8=n.unmountComponent(t._8)};var Ds,Us={__proto__:null,cssScope:"e-z5a8ex",default:Os,props:function(){return{type:"LIVE"}}},Ns=1e3;var qs={play:function(){this.state.video&&Xs(this,"video")},overlay:function(){var e=this;new Promise((function(e,n){t(["OK/StickerOverlays"],e,n)})).then((function(t){return t.play(e.refs.container)}))},pause:function(){var t=this.state,e=t.video,n=t.playbackState;e&&"video"===n&&Xs(this,"first-frame")},setVisabily:function(t){this.setState({isVisible:t}),t||Xs(this,"first-frame")}};function Hs(t,e){e.stopPropagation(),t.overlay()}function Fs(t){t.setState({firstFrame:"loaded"}),Js(t)}function Vs(t){t.setState({video:"loaded"}),t.state.sound||t.refs.video&&(t.refs.video.muted=!0),Js(t)}function Ks(t){var e=t.state.playCount+1,n=t.props,o=n.sticker,r=n.loop;t.state.hoverLoop||r||o.loop&&e<o.loop?Qs(t):(e=0,Xs(t,"last-frame")),t.setState({playCount:e})}function Ws(t){"last-frame"===t.state.playbackState&&t.props.loop&&(Xs(t,"video"),t._playTimeout=window.setTimeout((function(){return t.play()}),Ns))}function Gs(t,e){e.stopPropagation(),$s(t),Zt(t,"toggle-sticker-sound",!0)}function Ys(t,e){e.stopPropagation(),Zs(t),Zt(t,"toggle-sticker-sound",!1)}function Xs(t,e){if(clearTimeout(t._playTimeout),t.setState({playbackState:e}),"video"===e)Qs(t);else{var n=t.refs.video;n&&(Zs(t),n.paused||n.pause())}}function Qs(t){var e=t.refs.video;if(e){isNaN(e.duration)||(e.currentTime=0);var n=e.play();n&&n.catch&&n.catch((function(){return Xs(t,"first-frame")}))}}function Js(t){var e=t.props,n=e.autoplay,o=e.sticker,r=e.unread,a=t.state,i=a.firstFrame,s=a.video;n&&(i&&s&&Xs(t,"video"),o.overlayUrl&&r&&t.overlay())}function $s(t){var e;(null===(e=t.props.sticker)||void 0===e?void 0:e.audio)&&(function(t){return t&&Ds&&t!==Ds}(t)&&Zs(Ds),t.setState({sound:!0}),t.refs.video&&(t.refs.video.muted=!1),t.play(),Ds=t)}function Zs(t){t.setState({sound:!1}),t.refs.video&&(t.refs.video.muted=!0)}var tu="eralufl";function eu(t,e){e.sizes=t.store.data.isSmallScreen?t.state.smallSizes:t.state.sizes,e.ratio=n.get(t.props.sticker,"width")/n.get(t.props.sticker,"height"),e.userSticker="user"===t.props.size,e.parentSize="parent"===t.props.size,e.height=e.userSticker||e.parentSize?n.get(e.sizes,t.props.size):Math.min(n.get(t.props.sticker,"height"),n.get(e.sizes,t.props.size)||240),e.width=e.userSticker||e.parentSize?n.get(e.sizes,t.props.size):e.height*e.ratio,e.chooseExpr=t.state.lottieUrl?0:1,e.caseExpr_1=1===e.chooseExpr,e.ifExpr=e.caseExpr_1&&n.get(t.props.sticker,"mp4Url"),e.showVideo=e.ifExpr?null==t.props.hideVideo||!t.props.hideVideo&&t.state.isVisible:void 0,e.ifExpr_1=n.get(t.props.sticker,"audio")&&"xsmall"!==t.props.size,e.audioState=e.ifExpr_1?t.state.sound?"AUDIO_ON":"AUDIO_OFF":void 0,e.badgeType=e.ifExpr_1?"video"===t.state.playbackState?e.audioState:"AUDIO":void 0}function nu(t,e,o){n.updateClass(t,e,"container-okmsg js-sticker_play"+(n.get(o.props.sticker,"mp4Url")?" clickable-okmsg":"")),n.updateAttribute(t,e,"data-state",o.state.playbackState),n.updateAttribute(t,e,"data-overlay-url",n.get(o.props.sticker,"overlayUrl"))}function ou(t,e,o,r){e.url=o.state.lottieUrl,e.width=r.width,e.height=r.height,e.autoplay=o.props.autoplay,e.staticUrl=n.get(o.props.sticker,"url"),e.id=n.get(o.props.sticker,"stickerId"),e.class=o.state.lottieRendered||n.get(o.props.sticker,"url")?"rendered-okmsg":""}function ru(t,e){t.setState({lottieRendered:!0})}function au(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._m=n.propsSet(r,{loop:!0});return ou(0,a,t,o),o._n=n.addEvent(r,"rendered",ru,t,o),n.mountComponent(r,a),iu}function iu(t,e){var o=e._l,r=e._m;ou(0,r,t,e),n.updateComponent(o,r)}function su(t,e,o,r){n.updateClass(t,e,"first-frame-okmsg"+("user"===o.props.size?" __round-okmsg":"")),n.updateAttribute(t,e,"src",n.get(o.props.sticker,"firstUrl")||n.get(o.props.sticker,"url")),n.updateAttribute(t,e,"width",r.width),n.updateAttribute(t,e,"height",r.height),n.updateAttribute(t,e,"sticker-id",n.get(o.props.sticker,"stickerId"))}function uu(t,e){t.setState({firstFrame:"error"})}function cu(t,e,o){var r=n.insert(e,n.elem("span",tu));n.setClass(r,"play-okmsg");var a=o._y=n.appendChild(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input;o._10=n.addEvent(a,"click",Hs,t,o);var s=o._11=n.insert(i,n.createComponent("msg-icon",xe,t),"");n.mountComponent(s,n.propsSet(s,{icon:"play",size:"small"})),n.mountComponent(a,n.propsSet(a,{size:"small",class:"primary-okmsg",shape:"circle",title:""}))}function pu(t){return!t.store.data.isMobile&&n.get(t.props.sticker,"overlayUrl")?cu:null}function lu(t){Zt(t,"show-assets",{tab:"sticker-constructor"})}function mu(t,e,o){var r=o._17=n.insert(e,n.createComponent("msg-bubble",me,t)),a=r.componentModel.input,i=o._19=n.insert(a,n.createComponent("msg-button",fe,t),"element"),s=i.componentModel.input;o._1b=n.addEvent(i,"click",lu,t,o);var u=o._1c=n.insert(s,n.createComponent("msg-icon",xe,t),"");n.mountComponent(u,n.propsSet(u,{icon:"create-sticker"})),n.mountComponent(i,n.propsSet(i,{slot:"element",class:"inverted-okmsg",shape:"circle","data-tsid":"create_own_sticker"}));var c=n.insert(a,n.elem("div",tu),"bubble");n.setClass(c,"tooltip-okmsg"),n.setAttribute(c,"slot","bubble");var p=o._1g=n.appendChild(c,n.createComponent("msg-l10n",ae,t));n.mountComponent(p,n.propsSet(p,{key:"create-own-sticker"})),n.mountComponent(r,n.propsSet(r,{yAxis:"top",xAxis:"left",tooltip:!0,hideDelay:0,forced:!0}))}function du(t,e){return e.userSticker&&n.get(t.store.data.config,"server","user-stickers-enabled")&&!Vt(0,"Trident")?mu:null}function _u(t,e,o){!o._1r&&function(t,e,o){var r=o._1r=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{spin:!0,indeterminate:!0}))}(t,e,o),n.animate(o._1r,n.createAnimation("global:msg-pop-in 0.15s",tu))}function fu(t,e){return"loaded"!==t.state.video&&e.showVideo?_u:null}function gu(t,e,o,r){n.updateAttribute(t,e,"src",n.get(o.props.sticker,"mp4Url")),n.updateAttribute(t,e,"width",r.width),n.updateAttribute(t,e,"height",r.height)}function vu(t,e){t.setState({video:"error"})}function hu(t,e){var o=e._1y;n.setPendingRef(e._1,"video",o),gu(o,e._1z,t,e)}function Cu(t,e,o){return o._1y?hu(t,o):function(t,e,o){var r=o._1y=n.insert(e,n.elem("video",tu));n.setPendingRef(o._1,"video",r);var a=o._1z=n.obj();r.playsInline=!0,n.setAttribute(r,"preload","metadata"),r.muted=!0,gu(r,a,t,o),o._20=n.addEvent(r,"ended",Ks,t,o),o._21=n.addEvent(r,"loadedmetadata",Vs,t,o),o._22=n.addEvent(r,"error",vu,t,o)}(t,e,o),n.stopAnimation(o._1y,!0),ku}function ku(t,e){hu(t,e)}function bu(t,e){return e.showVideo?Cu:null}function yu(t,e,o,r){n.updateAttribute(t,e,"src",n.get(o.props.sticker,"url")),n.updateAttribute(t,e,"width",r.width),n.updateAttribute(t,e,"height",r.height)}function Su(t,e,o){var r=n.insert(e,n.elem("span",tu));n.setClass(r,"play-okmsg");var a=o._2a=n.appendChild(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input,s=o._2c=n.insert(i,n.createComponent("msg-icon",xe,t),"");n.mountComponent(s,n.propsSet(s,{icon:"play",size:"nano"})),n.mountComponent(a,n.propsSet(a,{size:"small",class:"primary-okmsg",shape:"circle"}))}function wu(t){return t.props.loop||t.props.playOnHover?null:Su}function Eu(t,e,o){o._1m=n.mountBlock(t,e,fu),o._1t=n.mountBlock(t,e,bu);var r=o._23=n.insert(e,n.elem("img",tu)),a=o._24=n.obj();return n.setClass(r,"last-frame-okmsg"),n.setAttribute(r,"alt",""),yu(r,a,t,o),o._25=n.addEvent(r,"transitionend",Ws,t,o),o._26=n.mountBlock(t,e,wu),xu}function xu(t,e){n.updateBlock(e._1m),n.updateBlock(e._1t),yu(e._23,e._24,t,e),n.updateBlock(e._26)}function Iu(t,e){return e.ifExpr?Eu:null}function Bu(t,e,o){var r=o._q=n.insert(e,n.elem("img",tu)),a=o._r=n.obj();return n.setAttribute(r,"alt",""),n.setAttribute(r,"data-tsid","img"),su(r,a,t,o),o._s=n.addEvent(r,"load",Fs,t,o),o._t=n.addEvent(r,"error",uu,t,o),o._u=n.mountBlock(t,e,pu),o._14=n.mountBlock(t,e,du),o._1j=n.mountBlock(t,e,Iu),Mu}function Mu(t,e){su(e._q,e._r,t,e),n.updateBlock(e._u),n.updateBlock(e._14),n.updateBlock(e._1j)}function Au(t,e){return[au,Bu][e.chooseExpr]}function Tu(t,e,n,o){e.type=o.badgeType}function ju(t,e){t.state.sound&&n.setPendingEvent(e._2k,"click",Ys,e)}function Pu(t,e){t.state.sound||n.setPendingEvent(e._2k,"click",Gs,e)}function Ru(t,e,o){var r=o._2j=n.insert(e,n.createComponent("msg-asset-badge",Us,t)),a=o._2k=n.pendingEvents(t,r),i=o._2l=n.propsSet(r,{title:""});return Tu(0,i,0,o),ju(t,o),Pu(t,o),n.finalizePendingEvents(a),n.mountComponent(r,i),Lu}function Lu(t,e){var o=e._2j,r=e._2l;Tu(0,r,0,e),ju(t,e),Pu(t,e),n.finalizePendingEvents(e._2k),n.updateComponent(o,r)}function Ou(t,e){return e.ifExpr_1?Ru:null}function zu(t,e){var o=t.componentView,r=e._1=n.obj();eu(t,e);var a=e._g=n.appendChild(o,n.elem("span",tu)),i=n.createInjector(a);return n.setRef(t,"container",a),nu(a,e._h=n.obj(),t),e._i=n.mountBlock(t,i,Au),e._2g=n.mountBlock(t,i,Ou),n.appendChild(o,n.createSlot(t,"",tu)),e._2r=n.mountSlot(t,""),n.subscribeStore(t,["isSmallScreen","isMobile","config"]),n.finalizePendingRefs(t,r),Du}function Du(t,e){eu(t,e),nu(e._g,e._h,t),n.updateBlock(e._i),n.updateBlock(e._2g),n.finalizePendingRefs(t,e._1)}au.dispose=function(t){t._n=n.removeEvent("rendered",t._n),t._l=n.unmountComponent(t._l),t._m=null},cu.dispose=function(t){t._10=n.removeEvent("click",t._10),t._11=n.unmountComponent(t._11),t._y=n.unmountComponent(t._y)},mu.dispose=function(t){t._1b=n.removeEvent("click",t._1b),t._1c=n.unmountComponent(t._1c),t._19=n.unmountComponent(t._19),t._1g=n.unmountComponent(t._1g),t._17=n.unmountComponent(t._17)},_u.dispose=function(t,e){n.animate(t._1r,n.createAnimation("global:msg-pop-out 0.15s",tu),(function(){return function(t){var e=t._1r;t._1r=n.unmountComponent(e),n.domRemove(e)}(t)}))},Cu.dispose=function(t,e){n.animate(t._1y,n.createAnimation("global:msg-fade-out 0.3s",tu),(function(){return function(t){t._20=n.removeEvent("ended",t._20),t._21=n.removeEvent("loadedmetadata",t._21),t._22=n.removeEvent("error",t._22),t._1y=n.domRemove(t._1y),t._1z=null}(t)}))},Su.dispose=function(t){t._2c=n.unmountComponent(t._2c),t._2a=n.unmountComponent(t._2a)},Eu.dispose=function(t){t._1m=n.unmountBlock(t._1m),t._1t=n.unmountBlock(t._1t),t._25=n.removeEvent("transitionend",t._25),t._26=n.unmountBlock(t._26),t._24=t._23=null},Bu.dispose=function(t){t._s=n.removeEvent("load",t._s),t._t=n.removeEvent("error",t._t),t._u=n.unmountBlock(t._u),t._14=n.unmountBlock(t._14),t._1j=n.unmountBlock(t._1j),t._r=t._q=null},Ru.dispose=function(t){t._2k=n.detachPendingEvents(t._2k),t._2j=n.unmountComponent(t._2j),t._2l=null},zu.dispose=function(t){t._i=n.unmountBlock(t._i),t._2g=n.unmountBlock(t._2g),t._2r=n.unmountSlot(t._2r)};var Uu={__proto__:null,cssScope:tu,default:zu,props:function(){return{size:"default",soundIfAllowed:!1}},state:function(){return{sizes:{xsmall:64,small:100,promo:120,postcardPreview:140,default:192,postcard:240,user:216,parent:"100%"},smallSizes:{xsmall:64,small:100,promo:120,postcardPreview:140,default:160,postcard:200,user:180,parent:"100%"},playbackState:"first-frame",playCount:0}},events:{click:function(t,e){e.stopPropagation(),t.play(),t.props.sticker.overlayUrl&&t.overlay()},mouseenter:function(t){t.props.playOnHover&&(t.setState({hoverLoop:!0}),"video"!==t.state.playbackState&&t.play())},mouseleave:function(t){t.setState({hoverLoop:!1})}},extend:qs,didChange:function(t,e){var o,r=e.sticker,a=e.autoplay,i=e.soundIfAllowed,s=e.hideVideo;if(r){var u=n.ie?null===(o=r.current)||void 0===o?void 0:o.lottieUrl:null;u!==t.state.lottieUrl&&t.setState({lottieUrl:u,lottieRendered:!1}),r.prev&&r.current.stickerId===r.prev.stickerId||(Xs(t,"first-frame"),t.setState({playCount:0}))}a&&(a.current?Js(t):!a.current&&a.prev&&t.pause()),i&&i.current&&$s(t),s&&s.current&&(Xs(t,"first-frame"),t.setState({video:null}))},willUnmount:function(t){Ds===t&&(Ds=null)},onPlayOverlay:Hs,onFirstFrameLoaded:Fs,onVideoLoaded:Vs,onVideoEnded:Ks,onLastFrameTransitionEnd:Ws,onPlay:Gs,onStop:Ys};var Nu="e-um3ygr";function qu(t,e){e.ifExpr=!t.props.icon&&!t.props.imgSrc}function Hu(t,e,o){var r=n.insert(e,n.elem("span",Nu));n.setClass(r,"tico_tx-okmsg"),n.appendChild(r,n.createSlot(t,"",Nu)),o._8=n.mountSlot(t,"")}function Fu(t){return"right"==t.props.position?Hu:null}function Vu(t,e,o){n.updateAttribute(t,e,"src",o.props.imgSrc)}function Ku(t,e,o){var r=o._d=n.insert(e,n.elem("img",Nu)),a=o._e=n.obj();return n.setClass(r,"tico_ico-okmsg"),n.setAttribute(r,"alt",""),Vu(r,a,t),Wu}function Wu(t,e){Vu(e._d,e._e,t)}function Gu(t){return t.props.imgSrc?Ku:null}function Yu(t,e,n){e.icon=n.props.icon,e.size=n.props.size}function Xu(t,e,o){var r=o._i=n.insert(e,n.createComponent("msg-icon",xe,t)),a=o._j=n.propsSet(r);return Yu(0,a,t),n.mountComponent(r,a),Qu}function Qu(t,e){var o=e._i,r=e._j;Yu(0,r,t),n.updateComponent(o,r)}function Ju(t){return t.props.icon?Xu:null}function $u(t,e,o,r){n.updateClass(t,e,"tico_tx-okmsg"+(r.ifExpr?" __"+o.props.size:""))}function Zu(t,e,o){var r=o._n=n.insert(e,n.elem("span",Nu));return $u(r,o._o=n.obj(),t,o),n.appendChild(r,n.createSlot(t,"",Nu)),o._q=n.mountSlot(t,""),tc}function tc(t,e){$u(e._n,e._o,t,e)}function ec(t){return"left"==t.props.position?Zu:null}function nc(t,e){var o=t.componentView,r=n.createInjector(o);return qu(t,e),e._3=n.mountBlock(t,r,Fu),e._a=n.mountBlock(t,r,Gu),e._f=n.mountBlock(t,r,Ju),e._k=n.mountBlock(t,r,ec),oc}function oc(t,e){qu(t,e),n.updateBlock(e._3),n.updateBlock(e._a),n.updateBlock(e._f),n.updateBlock(e._k)}Hu.dispose=function(t){t._8=n.unmountSlot(t._8)},Ku.dispose=function(t){t._e=t._d=null},Xu.dispose=function(t){t._i=n.unmountComponent(t._i),t._j=null},Zu.dispose=function(t){t._q=n.unmountSlot(t._q),t._o=t._n=null},nc.dispose=function(t){t._3=n.clearBlock(t._3),t._a=n.clearBlock(t._a),t._f=n.clearBlock(t._f),t._k=n.clearBlock(t._k)};var rc={__proto__:null,cssScope:Nu,default:nc,props:function(){return{icon:"",imgSrc:"",size:"medium",position:"left",multiline:!1}}};var ac="e-be2swn";function ic(t,e){e.ratio=t.props.height/t.props.width,e.thumbnail=n.get(t.props.video,"thumbnail")||n.get(t.props.video,"media","thumbnail")}function sc(t,e,o,r){n.updateAttribute(t,e,"href",n.get(o.props.video,"externalUrl")),n.updateClass(t,e,"poster-okmsg"+(!r.thumbnail&&n.get(o.props.video,"file","width")?" __empty-okmsg":"")),n.updateAttribute(t,e,"style","width:"+o.props.width+"px;")}function uc(t,e,o,r){n.updateAttribute(t,e,"style","padding-bottom: "+100*r.ratio+"%;"+(o.props.maxHeight?"max-height:"+o.props.maxHeight+"px":""))}function cc(t,e,o,r){n.updateAttribute(t,e,"src",r.thumbnail),n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height)}function pc(t,e,n,o){e.src=o.thumbnail}function lc(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-img-fill",qe,t)),a=o._h=n.propsSet(r);return pc(0,a,0,o),n.mountComponent(r,a),mc}function mc(t,e){var o=e._g,r=e._h;pc(0,r,0,e),n.updateComponent(o,r)}function dc(t){return t.props.fill?lc:null}function _c(t,e,o){var r=o._b=n.insert(e,n.elem("img",ac)),a=o._c=n.obj();return n.setAttribute(r,"alt",""),cc(r,a,t,o),o._d=n.mountBlock(t,e,dc),fc}function fc(t,e){cc(e._b,e._c,t,e),n.updateBlock(e._d)}function gc(t,e){return e.thumbnail?_c:null}function vc(t){Zt(t,"play-click")}function hc(t,e,o){e.duration=n.get(o.props.video,"duration")}function Cc(t,e,o){var r=n.insert(e,n.elem("div",ac));n.setClass(r,"duration-okmsg");var a=o._w=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"video",size:"nano"}));var i=o._y=n.appendChild(r,n.createComponent("msg-duration",qi,t)),s=i.componentModel.input,u=o._z=n.propsSet(i);hc(0,u,t);var c=o._10=n.insert(s,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(c,n.propsSet(c,{icon:"video",size:"small"})),n.mountComponent(i,u),kc}function kc(t,e){var o=e._y,r=e._z;hc(0,r,t),n.updateComponent(o,r)}function bc(t){return n.get(t.props.video,"duration")?Cc:null}function yc(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._o=n.addEvent(r,"click",vc,t,o);var i=o._p=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(i,n.propsSet(i,{icon:"play"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"play-okmsg"})),o._s=n.mountBlock(t,e,bc),Sc}function Sc(t,e){n.updateBlock(e._s)}function wc(t){return t.props.controls?yc:null}function Ec(t,e){var o=t.componentView,r=n.createInjector(o);ic(t,e);var a=e._4=n.insert(r,n.elem("a",ac)),i=n.createInjector(a),s=e._5=n.obj();n.setAttribute(a,"target","_blank"),n.setAttribute(a,"tabindex","-1"),sc(a,s,t,e);var u=e._6=n.insert(i,n.elem("div",ac)),c=e._7=n.obj();return n.setClass(u,"sizer-okmsg"),uc(u,c,t,e),e._8=n.mountBlock(t,i,gc),e._j=n.mountBlock(t,r,wc),xc}function xc(t,e){ic(t,e),sc(e._4,e._5,t,e),uc(e._6,e._7,t,e),n.updateBlock(e._8),n.updateBlock(e._j)}lc.dispose=function(t){t._g=n.unmountComponent(t._g),t._h=null},_c.dispose=function(t){t._d=n.unmountBlock(t._d),t._c=t._b=null},Cc.dispose=function(t){t._w=n.unmountComponent(t._w),t._10=n.unmountComponent(t._10),t._y=n.unmountComponent(t._y),t._z=null},yc.dispose=function(t){t._o=n.removeEvent("click",t._o),t._p=n.unmountComponent(t._p),t._m=n.unmountComponent(t._m),t._s=n.unmountBlock(t._s)},Ec.dispose=function(t){t._8=n.unmountBlock(t._8),t._j=n.clearBlock(t._j)};var Ic={__proto__:null,cssScope:ac,default:Ec,props:function(){return{video:null,width:null,height:null,maxHeight:380,fill:!1,controls:!1}}};function Bc(t,e){e.stopPropagation(),t.state.playing?Mc(t):Ac(t)}function Mc(t){(0,t.setState)({playing:!1})}function Ac(t){!function(t){var e;return null===(e=null==t?void 0:t.urlData)||void 0===e?void 0:e.EXTERNAL}(t.props.video)?function(t){t.setState({loading:!0}),Zt(t,"get-video-url-data",t.props.video)}(t):function(t){var e=t.props.video,n=t.store.get().config,o="".concat(e.urlData.EXTERNAL),r=o.indexOf("?")>-1?"&":"?",a=(null==n?void 0:n.server)&&n.server["video-autoplay"]&&n.user.AUTOPLAY_IN_FEED?"".concat(o).concat(r,"autoplay=1&white=1&muted=1&silent=1"):"".concat(o).concat(r,"autoplay=1&white=1");t.setState({external:a,played:!0,loading:!1})}(t)}var Tc="e-c0jw1j";function jc(t,e,n){e.icon=n.state.playing?"pause":"play"}function Pc(t,e,o){var r=n.insert(e,n.elem("div",Tc));n.setClass(r,"start-okmsg"),o._5=n.addEvent(r,"click",Bc,t,o);var a=o._6=n.appendChild(r,n.createComponent("msg-icon",xe,t)),i=o._7=n.propsSet(a);return jc(0,i,t),n.mountComponent(a,i),Rc}function Rc(t,e){var o=e._6,r=e._7;jc(0,r,t),n.updateComponent(o,r)}function Lc(t){return n.get(t.props.video,"videoId")&&"processing"!==n.get(t.props.video,"status")&&!t.state.played?Pc:null}function Oc(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{indeterminate:!0,size:64,radius:28,thickness:3,spin:!0}))}function zc(t){return t.state.loading?Oc:null}function Dc(t,e,o){n.updateClass(t,e,"video-container-okmsg"+(o.state.played?" played-okmsg":""))}function Uc(t,e,n){e.video=n.props.video,e.width=n.props.width,e.height=n.props.height,e.maxHeight=n.props.maxHeight,e.fill=n.props.fill}function Nc(t,e,o){var r=n.insert(e,n.elem("div",Tc));return n.setClass(r,"error-okmsg"),o._m=n.appendChild(r,n.text(n.get(t.state.error,"localizedMessage")||n.get(t.state.error,"message"))),qc}function qc(t,e){n.updateText(e._m,n.get(t.state.error,"localizedMessage")||n.get(t.state.error,"message"))}function Hc(t){return t.state.error?Nc:null}function Fc(t,e,o){n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height),n.updateAttribute(t,e,"src",o.state.external)}function Vc(t,e,o){var r=o._r=n.insert(e,n.elem("iframe",Tc)),a=o._s=n.obj();return n.setAttribute(r,"frameborder","0"),n.setAttribute(r,"tabindex","-1"),n.setAttribute(r,"allow","autoplay; encrypted-media; picture-in-picture; fullscreen"),r.allowFullscreen="allowfullscreen",Fc(r,a,t),Kc}function Kc(t,e){Fc(e._r,e._s,t)}function Wc(t){return t.state.external?Vc:null}function Gc(t,e){var o=t.componentView,r=n.createInjector(o);e._1=n.mountBlock(t,r,Lc),e._9=n.mountBlock(t,r,zc);var a=e._e=n.insert(r,n.elem("div",Tc)),i=n.createInjector(a);Dc(a,e._f=n.obj(),t);var s=e._g=n.insert(i,n.createComponent("msg-video-poster",Ic,t)),u=e._h=n.propsSet(s);return Uc(0,u,t),n.mountComponent(s,u),e._i=n.mountBlock(t,i,Hc),e._o=n.mountBlock(t,i,Wc),Yc}function Yc(t,e){var o=e._g,r=e._h;n.updateBlock(e._1),n.updateBlock(e._9),Dc(e._e,e._f,t),Uc(0,r,t),n.updateComponent(o,r),n.updateBlock(e._i),n.updateBlock(e._o)}Pc.dispose=function(t){t._5=n.removeEvent("click",t._5),t._6=n.unmountComponent(t._6),t._7=null},Oc.dispose=function(t){t._c=n.unmountComponent(t._c)},Nc.dispose=function(t){t._m=null},Vc.dispose=function(t){t._s=t._r=null},Gc.dispose=function(t){t._1=n.clearBlock(t._1),t._9=n.clearBlock(t._9),t._g=n.unmountComponent(t._g),t._i=n.unmountBlock(t._i),t._o=n.unmountBlock(t._o)};var Xc={__proto__:null,cssScope:Tc,default:Gc,props:function(){return{video:null,width:320,height:300,maxHeight:380}},didChange:function(t,e){var n,o=e.video,r=e.autoplay;if(o){var a=t.state.loading;if(o.current){var i=o.current,s=i.urlData,u=i.messageId,c=t.props.autoplay;(a&&(null==s?void 0:s.EXTERNAL)||c&&u&&!(null===(n=o.prev)||void 0===n?void 0:n.messageId))&&Ac(t)}}(null==r?void 0:r.prev)&&!(null==r?void 0:r.current)&&Mc(t)},willRender:function(t){var e=t.state.loading,n=t.props,o=n.video,r=n.autoplay;(e&&(null==o?void 0:o.urlData)||!e&&r&&o.messageId)&&Ac(t)},onTogglePlayback:Bc},Qc="eqgvi6y";function Jc(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"preview",Qc)),e._2=n.mountSlot(t,"preview");var r=n.appendChild(o,n.elem("div",Qc));n.setClass(r,"info-okmsg"),n.appendChild(r,n.createSlot(t,"title",Qc)),e._5=n.mountSlot(t,"title"),n.appendChild(r,n.createSlot(t,"description",Qc)),e._7=n.mountSlot(t,"description")}Jc.dispose=function(t){t._2=n.unmountSlot(t._2),t._5=n.unmountSlot(t._5),t._7=n.unmountSlot(t._7)};var $c={__proto__:null,cssScope:Qc,default:Jc},Zc={click:function(t){var e=t.props.attachment,n=t.store.get().isMobile,o=e.callType;if(Zt(t,"log-action",{name:"ACTION_CALL_UI_CLICK",value:"BUBBLE_CELL_".concat(o)}),!n){var r=e.contactIds&&e.contactIds[0];Zt(t,"open-video-call-layer",{isVideo:"VIDEO"===o,friendId:r,chatId:r?void 0:e.chatId})}}};function tp(t,e){switch(t){case"MISSED":case"REJECTED":return e?"outgoing":"missed";case"CANCELED":return e?"canceled":"missed";default:return e?"outgoing":"incoming"}}var ep=[0],np=[];function op(){np.push(ep),ep=[0]}function rp(){ep=np.pop()}function ap(t,e){e.callType=Pt(0,n.get(t.props.attachment,"callType")),e.res=t.state.hangupType+"-"+e.callType+"-call"}function ip(t,e,n,o){e.icon=o.res}function sp(t,e,n,o){e.key=o.res}function up(t,e,o){var r=o._7=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=o._8=n.propsSet(r,{size:"medium"});ip(0,i,0,o);var s=o._9=n.insert(a,n.createComponent("msg-l10n",ae,t),""),u=o._a=n.propsSet(s);return sp(0,u,0,o),n.mountComponent(s,u),n.mountComponent(r,i),cp}function cp(t,e){var o=e._7,r=e._8,a=e._9,i=e._a;ip(0,r,0,e),sp(0,i,0,e),n.updateComponent(a,i),n.updateComponent(o,r)}function pp(t,e,n,o){e.icon=o.res}function lp(t,e,n,o){e.key=o.res}function mp(t,e,o){e.duration=n.get(o.props.attachment,"duration")}function dp(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-duration",qi,t),"description"),a=o._n=n.propsSet(r,{slot:"description"});return mp(0,a,t),n.mountComponent(r,a),ep[0]=1,_p}function _p(t,e){var o=e._m,r=e._n;mp(0,r,t),n.updateComponent(o,r)}function fp(t,e,o){var r=o._q=n.insert(e,n.createComponent("msg-l10n",ae,t),"description");n.mountComponent(r,n.propsSet(r,{key:"callback",class:"link-okmsg pl-okmsg",slot:"description","data-tsid":"recall_in_message"})),ep[0]=1}function gp(t){return n.get(t.props.attachment,"duration")>0?dp:t.store.data.isMobile?null:fp}function vp(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-attach-template",$c,t)),a=r.componentModel.input,i=o._f=n.insert(a,n.createComponent("msg-icon",xe,t),"preview"),s=o._g=n.propsSet(i,{size:"large",slot:"preview"});pp(0,s,0,o),n.mountComponent(i,s);var u=o._h=n.insert(a,n.createComponent("msg-l10n",ae,t),"title"),c=o._i=n.propsSet(u,{slot:"title"});return lp(0,c,0,o),n.mountComponent(u,c),o._j=n.mountBlock(t,a,gp),n.mountComponent(r),hp}function hp(t,e){var o=e._f,r=e._g,a=e._h,i=e._i;pp(0,r,0,e),n.updateComponent(o,r),lp(0,i,0,e),n.updateComponent(a,i),n.updateBlock(e._j),n.updateIncomingSlot(e._e,"description",ep[0])}function Cp(t){return t.props.compact?up:vp}function kp(t,e){var o=t.componentView;op();var r=n.createInjector(o);return ap(t,e),e._4=n.mountBlock(t,r,Cp),rp(),n.subscribeStore(t,["isMobile"]),bp}function bp(t,e){op(),ap(t,e),n.updateBlock(e._4),rp()}up.dispose=function(t){t._9=n.unmountComponent(t._9),t._7=n.unmountComponent(t._7),t._8=t._a=null},dp.dispose=function(t){t._m=n.unmountComponent(t._m),t._n=null,ep[0]=1},fp.dispose=function(t){t._q=n.unmountComponent(t._q),ep[0]=1},vp.dispose=function(t){t._f=n.unmountComponent(t._f),t._h=n.unmountComponent(t._h),t._j=n.unmountBlock(t._j),t._e=n.unmountComponent(t._e),t._g=t._i=null},kp.dispose=function(t){op(),t._4=n.clearBlock(t._4),rp()};var yp={__proto__:null,cssScope:"e-fas1d2",default:kp,events:Zc,didChange:function(t){var e=t.props,n=e.attachment,o=e.isMine;t.setState({hangupType:tp(n.hangupType,o)})}};function Sp(t){return Math.abs(t)%16}function wp(t){if(t&&t.length>0){var e=t.replace(/[^A-Za-zА-Яа-я0-9 ]+/gm,"");e&&e.trim().length>0&&(t=e);var n=t.trim().split(/\s+/).slice(0,2),o=[];return n.forEach((function(t){var e=t.charAt(0);o.push(function(t){return t>="\ud800"&&t<="\udbff"}(e)?t.substring(0,2):t.substring(0,1))})),o.join("")}return""}var Ep={nano:16,micro:20,small:32,medium:48,normal:64,big:92,large:128,xl:190};function xp(t){t.setState({loaded:!0})}function Ip(t){t.state.url||t.setState({error:!0,url:dt}),!1===navigator.onLine&&(console.log("failed to load %s, wait for online",t.props.url),function(t){t._waitingOnline||(t._waitingOnline=!0,window.addEventListener("online",t._onOnline))}(t))}function Bp(t,e){t.setState({error:!1,loaded:e})}function Mp(t,e){!e||function(t){return/^data:/.test(t)||Ct(t)}(e)?Ap(t,e||dt):function(t,e){kt(e).then((function(n){return n.url===yt(t.props.url)?(Ap(t,e),e):null})).catch((function(e){return Ip(t),Promise.reject(e)}))}(t,e)}function Ap(t,e){Bp(t,!0),t.setState({url:e})}function Tp(t){var e=t.crop,n=64/((e.x2-e.x1)*t.width),o=t.height*n,r=t.width*n;return"height: "+o+"px;\n            width: "+r+"px;\n            left: -"+e.x1*r+"px;\n            top: -"+e.y1*o+"px;"}var jp="e7594yt";function Pp(t,e,o){n.updateClass(t,e,"stub-okmsg __msg-bg-color-"+o.state.colorIndex)}function Rp(t,e,o){var r=o._4=n.insert(e,n.elem("div",jp));return Pp(r,o._5=n.obj(),t),o._6=n.appendChild(r,n.text(t.state.initials)),Lp}function Lp(t,e){Pp(e._4,e._5,t),n.updateText(e._6,t.state.initials)}function Op(t,e,o){n.updateAttribute(t,e,"src",o.state.url),n.updateAttribute(t,e,"style",o.state.imgStyle)}function zp(t,e,o){var r=o._9=n.insert(e,n.elem("img",jp)),a=o._a=n.obj();return n.setAttribute(r,"alt",""),Op(r,a,t),o._b=n.addEvent(r,"error",Ip,t,o),o._c=n.addEvent(r,"load",xp,t,o),Dp}function Dp(t,e){Op(e._9,e._a,t)}function Up(t){return t.props.url&&t.state.loaded&&!t.state.error?t.state.url?zp:null:Rp}function Np(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,Up),qp}function qp(t,e){n.updateBlock(e._1)}Rp.dispose=function(t){t._5=t._6=t._4=null},zp.dispose=function(t){t._b=n.removeEvent("error",t._b),t._c=n.removeEvent("load",t._c),t._a=t._9=null},Np.dispose=function(t){t._1=n.clearBlock(t._1)};var Hp={__proto__:null,cssScope:jp,default:Np,props:function(){return{url:"",id:0,caption:"",size:"medium",masked:!1,cropInfo:null}},state:function(){return{sizes:Ep}},init:function(t){t._onOnline=function(){!function(t){t._waitingOnline=!1,window.removeEventListener("online",t._onOnline)}(t),Mp(t,t.props.url||dt)},Bp(t),t._waitingOnline=!1},didChange:function(t,e){var n=e.url,o=e.caption,r=e.id,a=e.cropInfo;n&&Mp(t,n.current),o&&t.setState({initials:wp(o.current||V("empty-chat-placeholder"))}),r&&t.setState({colorIndex:Sp(r.current)}),a&&a.current&&t.setState({imgStyle:Tp(a.current)})},willUnmount:function(t){window.removeEventListener("online",t._onOnline)},onLoad:xp,onError:Ip},Fp=function(t){var e=this;this.routes=[],this.options=Object.assign({debug:!1,relative:"",listen:!0},t),this.always((function(){return null})),this._repative=t.relativePath,t.listen&&(this._onLocationChange=function(){return e._onLocationChange()},window.addEventListener("popstate",this._onLocationChange),window.addEventListener("DOMContentLoaded",this._onLocationChange))};function Vp(t){return t.replace(/\/$/,"")}Fp.prototype.applyState=function(t){this._onLocationChange(t)},Fp.prototype.pushState=function(t,e){void 0===t&&(t="/"),void 0===e&&(e={}),(t=this.resolveUrl(t))!==location.pathname?history.pushState(e,document.title,t):history.replaceState(e,document.title,t),this._onLocationChange()},Fp.prototype.resolveUrl=function(t){return this.options.relative+Vp(t)},Fp.prototype.popState=function(){history.back()},Fp.prototype.replaceState=function(t,e){void 0===t&&(t="/"),void 0===e&&(e={}),(t=this.resolveUrl(t))!==location.pathname&&(history.replaceState(e,document.title,t),this._onLocationChange())},Fp.prototype.on=function(t,e){return this.routes.push({route:t,handler:e}),this},Fp.prototype.default=function(t){return this.routes.push({route:"",handler:t}),this},Fp.prototype.always=function(t){return this.alwaysFunc=t,this},Fp.prototype._getRouteParser=function(t){var e,n=[];return t instanceof RegExp?e=t:(e=t.replace(/([:*])(\w+)/g,(function(t,e,o){return n.push(o),"([^/]+.*)"})).replace(/\*/g,"(?:.*)"),e=new RegExp(e+"(?:/$|$)")),{paramNames:n,regexp:e}},Fp.prototype._collectRouteParams=function(t,e){return t.slice(1,t.length).reduce((function(t,n,o){null!=n&&(t[null!=e[o]?e[o]:o]=decodeURIComponent(n));return t}),{})},Fp.prototype._onLocationChange=function(t){var e,n=decodeURI(t||location.pathname);if(this.options.debug&&(e="pushChange, "+n,console.log("%c[Router]%c "+e,"color: rgb(255, 105, 100);","color: inherit")),n=function(t,e){var n=t.match(/^(\/group\/\d+)\/messages/);if(n)return Vp(t);var o=t.match(/^(\/.+?)\/messages/);if(o)return Vp(t);var r=e.relative;void 0===r&&(r="");if(r)return 0===t.indexOf(r)?t.slice(r.length)||"/":null;return t}(n,this.options),!n)return this.alwaysFunc(n);for(var o=0;o<this.routes.length;o++){var r=this._getRouteParser(this.routes[o].route),a=n.match(r.regexp);if(a){var i=this._collectRouteParams(a,r.paramNames);this.routes[o].handler.call(null,{path:n,state:history.state,params:i,applied:!0});break}}this.alwaysFunc(n)};var Kp=null,Wp=function(t,e,n,o){var r=this;this.controller=t,this.chatService=e,this.confirmService=n,this.toastService=o,this.prefix="/messages",this._router=new Fp({relative:this.prefix,listen:!1}),this.state={};var a=this.controller.store.get(),i=a.isMobile,s=a.selectedChat;this._router.on("/",(function(){var t=r.controller.componentView.querySelector("ok-messenger-page");if(i){if(r.controller.isModalActive())return void r.controller.exitModalMode();r.chatService.addLeftColActiveReason("mobile")}r.chatService.resetSearch(),r.chatService.resetSelected(),t&&t.focus()})).on(/\/:contacts/,(function(){r.openModal("view-contacts")})).on(/\/:new-chat(?:\/(\d+))?/,(function(t){var e=t.params;r.openModal("new-chat",{withId:e[0]})})).on(/\/:aside(?:\/(\d+))?/,(function(){r.state&&s||r.goTo("/")})).on(/\/:forward(?:\/(\d+))?/,(function(){r.state&&s||r.goTo("/")})).on("/group/:groupId/messages/start/:startPayload",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode(),r.controller.openGroupchat({groupId:Number(e.groupId),startPayload:e.startPayload})})).on("/:object/messages/start/:startPayload",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode(),r.resolveEntity("http://ok.ru/"+e.object+"/messages/start/"+e.startPayload)})).on("/group/:groupId/messages",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode(),r.chatService.removeLeftColActiveReason("mobile"),r.controller.openGroupchat({groupId:Number(e.groupId)})})).on("/:object/messages",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode(),r.chatService.removeLeftColActiveReason("mobile");var n=i?"m.ok.ru":"ok.ru";r.resolveEntity("http://"+n+"/"+e.object+"/messages/start")})).on("/group/:groupId",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode(),r.chatService.removeLeftColActiveReason("mobile"),r.controller.openGroupchat({groupId:Number(e.groupId)})})).on("/join/:chat",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode(),r.resolveEntity("join/"+e.chat)})).on("/c:chatId",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode();var n=-parseInt(e.chatId.split("?")[0],10);r.chatService.removeLeftColActiveReason("mobile"),r.closeInfo(n),r.resolveChat(n)})).on("/g:chatId",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode();var n=-parseInt(e.chatId.split("?")[0],10);r.chatService.removeLeftColActiveReason("mobile"),r.closeInfo(n),r.resolveChat(n)})).on("/:chat",(function(t){var e=t.params;r.controller.minifyCall(),r.controller.exitModalMode();var n=e.chat.split("?")[0];r.chatService.removeLeftColActiveReason("mobile"),r.closeInfo(n),r.resolveEntity(n)})),Kp=this};Wp.prototype.applyState=function(t){return this._router.applyState(t)},Wp.prototype.pushState=function(t){return Zt(this.controller,"history-change",{url:t})},Wp.prototype.popState=function(){return Zt(this.controller,"history-back")},Wp.prototype.replaceState=function(t){return Zt(this.controller,"history-replace",{url:t})},Wp.prototype.getChat=function(t){return this.chatService.get(t)},Wp.prototype.resolveChat=function(t){t=An(t)?Number(t):t;var e=this.state.chat||this.chatService.get(t);e?(this.selectChat(e),Jp(e)):$p(t,this.state)},Wp.prototype.resolveEntity=function(t){var e=this;An(t)?this.chatService.getDialog(Number(t)).then((function(t){e.resolveChat(t&&t.id)})):this.resolveChat(t)},Wp.prototype.selectChat=function(t){this.state.peek?this.chatService.peek(t,this.state.messagesTime):this.chatService.select(t.id,this.state.messagesTime)},Wp.prototype.fetchEntity=function(t){return this.chatService.fetchEntity(t)},Wp.prototype.openModal=function(t,e){this.chatService.removeLeftColActiveReason("mobile"),this.controller.enterModalMode(t,e)},Wp.prototype.closeInfo=function(t){this.chatService.resetSearch(),this.chatService.resetPostingForward(t)};var Gp=function(){return Kp.toastService.show(V("error.link.not.found"))};function Yp(t){if("number"==typeof t&&(t=Kp.getChat(t)),!t)return"/";if("DIALOG"===t.type){var e=0;if(Array.isArray(t.participants)){var n=(t.participants.find((function(t){return!t.user.current}))||{}).user;e=n&&n.id}else{var o=Kp.controller.store.get().auth.profile.id;e=Object.keys(t.participants).map(Number).find((function(t){return t!==o}))}if(e)return"/"+e}if(t.link&&-1===t.link.indexOf("join/"))return"/"+t.link.substr(t.link.lastIndexOf("/")+1);var r=""+Math.abs(t.id);return t.groupChatInfo&&t.groupChatInfo.isModerator?"/g"+r:"/c"+r}function Xp(t){t!==Kp.url&&(Kp.state={}),Kp.applyState(t)}function Qp(t,e){if(!Kp)throw new Error("Router is not configured");var n=Wn(document.location.pathname),o=Kn(n)!==Kn(t),r=Kp.controller.refs.page,a=r&&r.refs.chat,i=function(){var o=Gn(t),r=Gn(n);o&&!r&&(Kp.state=Object.assign({},e,{useBack:!0,prev:Kp.state.prev||Yn(n)}));var a=t.startsWith(Kp.prefix)?Kn(t):""+Kp.prefix+t;Kp.url=a,o&&r||e&&e.replace?Kp.replaceState(a):Kp.pushState(a)};o&&a?a.cancelActiveModal().then((function(t){t&&i()})):i()}function Jp(t){if(t.groupChatInfo&&t.groupChatInfo.isModerator){var e=Kp.controller,n=e.store.get().config;n.server["moderated-groups"]&&n.server["moderated-groups-filter"]&&Zt(e,"filter-groups",t.groupChatInfo.groupId)}}function $p(t,e,n){return void 0===e&&(e={}),void 0===n&&(n=Gp),t=An(t)?Number(t):t,Kp.fetchEntity(t).then((function(n){var o=e.useBack?Yn(document.location.pathname):null;if(Kp.state={peek:n.peek,prev:o,chat:n.chat,messagesTime:e.messagesTime},n.chat){var r=Yp(n.chat),a=n.chat;"PRIVATE"===a.access&&a.link&&!Kp.chatService.isParticipant(a)?Kp.confirmService.show({header:V("join-chat-confirm-header"),body:V(a.title?"join-chat-confirm-body":"join-chat-confirm-body-empty",{type:a.type,name:a.title}),buttons:[{label:V("join-chat-confirm-button"),action:function(){return Kp.chatService.join(Wn(a.link)).then((function(){Qp("/"+t)}))}},V("confirm-cancel-button")]}):(Qp(r,e),Jp(a))}})).catch((function(t){"chat_with_myself"!==t?(console.warn(t),n(t)):Kp.toastService.show(V("error.its-you"))}))}function Zp(t,e,n){if(void 0===e&&(e={}),void 0===n&&(n=Gp),An(t)){if((t=Number(t))===Kp.controller.store.get().auth.profile.id)return void Kp.toastService.show(V("error.its-you"));Kp.chatService.getDialog(t).then((function(t){$p(t.link||t.id,e)}))}else $p(t,e,n)}function tl(){An(Kp.state.prev)?Kp.state.prev>0?Zp(Kp.state.prev):$p(Kp.state.prev):Qp("/")}function el(t){var e=t.props.attachment,n=null==e?void 0:e.user;n&&Zp(n.id,{useBack:!0})}var nl=[0],ol=[];function rl(){ol.push(nl),nl=[0]}function al(){nl=ol.pop()}function il(t,e){e.name=n.get(t.props.attachment,"user","name")||n.get(t.props.attachment,"name")}function sl(t,e,o,r){e.url=n.get(o.props.attachment,"photoUrl"),e.id=n.get(o.props.attachment,"contactId"),e.caption=r.name}function ul(t,e){var o=t.componentView;rl(),il(t,e);var r=e._3=n.appendChild(o,n.createComponent("msg-attach-template",$c,t)),a=r.componentModel.input;e._4=n.addEvent(r,"click",el,t,e);var i=e._5=n.insert(a,n.createComponent("msg-avatar",Hp,t),"preview"),s=e._6=n.propsSet(i,{slot:"preview",size:"medium"});sl(0,s,t,e),n.mountComponent(i,s);var u=e._7=n.insert(a,n.createComponent("msg-parsed-text",ii,t),"title"),c=u.componentModel.input;return e._9=n.insert(c,n.text(e.name)),n.mountComponent(u,n.propsSet(u,{slot:"title",disableFormatting:!0,disableLinks:!0,class:"name-okmsg link-okmsg"})),n.mountComponent(r),al(),cl}function cl(t,e){var o=e._5,r=e._6;rl(),il(t,e),sl(0,r,t,e),n.updateComponent(o,r),nl[0]|=n.updateText(e._9,e.name),n.updateIncomingSlot(e._7,"",nl[0]),al()}ul.dispose=function(t){rl(),t._4=n.removeEvent("click",t._4),t._5=n.unmountComponent(t._5),t._7=n.unmountComponent(t._7),t._3=n.unmountComponent(t._3),al()};var pl={__proto__:null,cssScope:"eft61d6",default:ul,onOpenDialog:el};function ll(t,e,n){n.stopPropagation(),n.preventDefault(),OK.logger.success("messagesLayer","tt-link","dailyphoto-attach"),Jn(e,t+"?msgeLIR=1")}var ml="e-dbew5e",dl={content:{body:Rl,defaults:{attach:null,answer:!1,compact:!1}},wrap:{body:rm,defaults:{attach:null,answer:!1,compact:!1,expired:!1,mine:!1,toast:!1}},header:{body:dm,defaults:{}}};function _l(t){t.class="answer-wr-okmsg"}function fl(t){t.class="reply-origin-okmsg"}function gl(t,e,o){o._7=n.mountPartial(t,e,n.getPartial(t,"header",dl),{":a":o[":a"],":e":o[":e"]});var r=o._8=n.insert(e,n.elem("div",ml)),a=n.createInjector(r),i=o._9=n.pendingEvents(t,r),s=o._a=n.obj(),u=o._b=n.obj();_l(s),o._c=n.mountPartial(t,a,n.getPartial(t,"content",dl),{attach:t.props.answer,answer:"true",":a":s,":e":i});var c=o._e=n.insert(a,n.elem("div",ml)),p=n.createInjector(c),l=o._f=n.pendingEvents(t,c),m=o._g=n.obj(),d=o._h=n.obj();return fl(m),o._i=n.mountPartial(t,p,n.getPartial(t,"content",dl),{attach:t.props.attachment,compact:"true",":a":m,":e":l}),n.finalizePendingEvents(l),n.finalizeAttributes(c,m,d),n.finalizePendingEvents(i),n.finalizeAttributes(r,s,u),vl}function vl(t,e){var o=e._9,r=e._a,a=e._f,i=e._g;n.updatePartial(e._7,n.getPartial(t,"header",dl),{":a":e[":a"],":e":e[":e"]}),_l(r),n.updatePartial(e._c,n.getPartial(t,"content",dl),{attach:t.props.answer,answer:"true",":a":r,":e":o}),fl(i),n.updatePartial(e._i,n.getPartial(t,"content",dl),{attach:t.props.attachment,compact:"true",":a":i,":e":a}),n.finalizePendingEvents(a),n.finalizeAttributes(e._e,i,e._h),n.finalizePendingEvents(o),n.finalizeAttributes(e._8,r,e._b)}function hl(t,e,o){return o._r=n.mountPartial(t,e,n.getPartial(t,"header",dl),{":a":o[":a"],":e":o[":e"]}),Cl}function Cl(t,e){n.updatePartial(e._r,n.getPartial(t,"header",dl),{":a":e[":a"],":e":e[":e"]})}function kl(t){return t.props.compact?null:hl}function bl(t,e,o){return o._m=n.mountBlock(t,e,kl),o._u=n.mountPartial(t,e,n.getPartial(t,"content",dl),{attach:t.props.attachment,compact:t.props.compact,":a":o[":a"],":e":o[":e"]}),yl}function yl(t,e){n.updateBlock(e._m),n.updatePartial(e._u,n.getPartial(t,"content",dl),{attach:t.props.attachment,compact:t.props.compact,":a":e[":a"],":e":e[":e"]})}function Sl(t){return n.get(t.props.attachment,"replyOrigin")&&t.props.answer?gl:bl}function wl(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();return e._2=n.mountBlock(t,r,Sl),n.finalizePendingRefs(t,a),El}function El(t,e){n.updateBlock(e._2),n.finalizePendingRefs(t,e._1)}function xl(t,e){e.expired=n.get(e.attach,"expirationMillis")<Date.now(),e.mine=n.get(e.attach,"user","current"),e.url="/profile/"+n.get(e.attach,"ownerId")+"/dailyphoto/"+n.get(e.attach,"dailyMediaId")}function Il(t,e,o){return o._18=n.mountPartial(t,e,n.getPartial(t,"wrap",dl),{attach:o.attach,answer:o.answer,compact:o.compact,expired:o.expired,mine:o.mine,toast:!0,":a":o[":a"],":e":o[":e"]}),Bl}function Bl(t,e){n.updatePartial(e._18,n.getPartial(t,"wrap",dl),{attach:e.attach,answer:e.answer,compact:e.compact,expired:e.expired,mine:e.mine,toast:!0,":a":e[":a"],":e":e[":e"]})}function Ml(t,e,n){t.href=n.url}function Al(t,e,n,o){ll(o.url,t,e)}function Tl(t,e,o){var r=o._1b=n.insert(e,n.elem("a",ml)),a=n.createInjector(r),i=o._1c=n.pendingEvents(t,r),s=o._1d=n.obj(),u=o._1e=n.obj();return Ml(s,0,o),n.setPendingEvent(i,"click",Al,o),o._1g=n.mountPartial(t,a,n.getPartial(t,"wrap",dl),{attach:o.attach,answer:o.answer,compact:o.compact,expired:o.expired,mine:o.mine,":a":s,":e":i}),n.finalizePendingEvents(i),n.finalizeAttributes(r,s,u),jl}function jl(t,e){var o=e._1c,r=e._1d;Ml(r,0,e),n.setPendingEvent(o,"click",Al,e),n.updatePartial(e._1g,n.getPartial(t,"wrap",dl),{attach:e.attach,answer:e.answer,compact:e.compact,expired:e.expired,mine:e.mine,":a":r,":e":o}),n.finalizePendingEvents(o),n.finalizeAttributes(e._1b,r,e._1e)}function Pl(t,e){return e.expired&&!e.mine?Il:Tl}function Rl(t,e,o){return xl(0,o),o._13=n.mountBlock(t,e,Pl),Ll}function Ll(t,e){xl(0,e),n.updateBlock(e._13)}function Ol(t,e){e.width=n.get(e.attach,"width"),e.height=n.get(e.attach,"height"),e.style="background-image: url("+n.get(t.props.attachment,"previewData")+");",e.ifExpr=e.compact&&e.expired}function zl(t,e,o,r){n.updateClass(t,e,"wrap-okmsg"+(r.answer?" __answer-okmsg":"")),n.updateAttribute(t,e,"title",r.ifExpr?o.store.data.l10n(r.mine?"daily-media-expired-your":"daily-media-expired"):void 0)}function Dl(t,e,n){Zt(t,"show-toast",t.store.data.l10n("daily-media-expired",t,e,n))}function Ul(t,e){e.toast&&n.setPendingEvent(e._1q,"click",Dl,e)}function Nl(t,e,o,r){n.updateAttribute(t,e,"style",r.style)}function ql(t,e,o,r){n.updateAttribute(t,e,"src",n.get(r.attach,"baseUrl")+"&fn=w_240"),n.updateAttribute(t,e,"width",r.width),n.updateAttribute(t,e,"height",r.height)}function Hl(t,e,o){var r=o._1z=n.insert(e,n.elem("img",ml)),a=o._20=n.obj();return n.setAttribute(r,"alt",""),ql(r,a,0,o),Fl}function Fl(t,e){ql(e._1z,e._20,0,e)}function Vl(t,e){return!e.expired||e.mine?Hl:null}function Kl(t,e,o,r){n.updateClass(t,e,"expired-msg-okmsg"+(r.mine?" __mine-okmsg":""))}function Wl(t,e,o){var r=o._2a=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"dailyphoto",size:"large"}))}function Gl(t,e){return e.compact?Wl:null}function Yl(t,e,o){var r=o._2k=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"daily-media-expired"}))}function Xl(t,e){return e.mine?null:Yl}function Ql(t,e,o){var r=o._2q=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"daily-media-expired-your"}))}function Jl(t,e){return e.mine?Ql:null}function $l(t,e,o){var r=n.insert(e,n.elem("div",ml)),a=n.createInjector(r);return n.setClass(r,"expired-msg_txt-okmsg"),o._2h=n.mountBlock(t,a,Xl),o._2n=n.mountBlock(t,a,Jl),Zl}function Zl(t,e){n.updateBlock(e._2h),n.updateBlock(e._2n)}function tm(t,e){return e.compact?null:$l}function em(t,e,o){var r=o._25=n.insert(e,n.elem("div",ml)),a=n.createInjector(r);return Kl(r,o._26=n.obj(),0,o),o._27=n.mountBlock(t,a,Gl),o._2d=n.mountBlock(t,a,tm),nm}function nm(t,e){Kl(e._25,e._26,0,e),n.updateBlock(e._27),n.updateBlock(e._2d)}function om(t,e){return e.expired?em:null}function rm(t,e,o){Ol(t,o);var r=o._1p=n.insert(e,n.elem("div",ml)),a=n.createInjector(r),i=o._1q=n.pendingEvents(t,r);zl(r,o._1r=n.obj(),t,o),Ul(0,o);var s=o._1u=n.insert(a,n.elem("div",ml)),u=o._1v=n.obj();return n.setClass(s,"bg-okmsg"),Nl(s,u,0,o),o._1w=n.mountBlock(t,a,Vl),o._22=n.mountBlock(t,a,om),n.finalizePendingEvents(i),am}function am(t,e){Ol(t,e),zl(e._1p,e._1r,t,e),Ul(0,e),Nl(e._1u,e._1v,0,e),n.updateBlock(e._1w),n.updateBlock(e._22),n.finalizePendingEvents(e._1q)}function im(t,e){e.owner=n.get(t.props.attachment,"user")}function sm(t,e,o){var r=o._33=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"your-moment"}))}function um(t,e,o){var r=o._37=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"opponents-moment"}))}function cm(t,e){return n.get(e.owner,"current")?sm:um}function pm(t,e,o){var r=n.insert(e,n.elem("div",ml)),a=n.createInjector(r);return n.setClass(r,"text-okmsg"),o._30=n.mountBlock(t,a,cm),lm}function lm(t,e){n.updateBlock(e._30)}function mm(t){return n.get(t.store.data.config,"server","hide-daily-moment-title")?null:pm}function dm(t,e,o){return im(t,o),o._2w=n.mountBlock(t,e,mm),_m}function _m(t,e){im(t,e),n.updateBlock(e._2w)}gl.dispose=function(t){t._7=n.unmountPartial(t._7),t._9=n.detachPendingEvents(t._9),t._c=n.unmountPartial(t._c),t._f=n.detachPendingEvents(t._f),t._i=n.unmountPartial(t._i),t._a=t._b=t._g=t._h=t._e=t._8=null},hl.dispose=function(t){t._r=n.unmountPartial(t._r)},bl.dispose=function(t){t._m=n.unmountBlock(t._m),t._u=n.unmountPartial(t._u)},wl.dispose=function(t){t._2=n.clearBlock(t._2)},Il.dispose=function(t){t._18=n.unmountPartial(t._18)},Tl.dispose=function(t){t._1c=n.detachPendingEvents(t._1c),t._1g=n.unmountPartial(t._1g),t._1d=t._1e=t._1b=null},Rl.dispose=function(t){t._13=n.unmountBlock(t._13)},Hl.dispose=function(t){t._20=t._1z=null},Wl.dispose=function(t){t._2a=n.unmountComponent(t._2a)},Yl.dispose=function(t){t._2k=n.unmountComponent(t._2k)},Ql.dispose=function(t){t._2q=n.unmountComponent(t._2q)},$l.dispose=function(t){t._2h=n.unmountBlock(t._2h),t._2n=n.unmountBlock(t._2n)},em.dispose=function(t){t._27=n.unmountBlock(t._27),t._2d=n.unmountBlock(t._2d),t._26=t._25=null},rm.dispose=function(t){t._1q=n.detachPendingEvents(t._1q),t._1w=n.unmountBlock(t._1w),t._22=n.unmountBlock(t._22),t._1r=t._1v=t._1u=t._1p=null},sm.dispose=function(t){t._33=n.unmountComponent(t._33)},um.dispose=function(t){t._37=n.unmountComponent(t._37)},pm.dispose=function(t){t._30=n.unmountBlock(t._30)},dm.dispose=function(t){t._2w=n.unmountBlock(t._2w)};var fm={__proto__:null,cssScope:ml,partials:dl,default:wl,navOk:ll};var gm={click:function(t,e){!e.defaultPrevented&&Cm(t)&&vm(t)},keydown:function(t,e){Cm(t)&&("Enter"===e.key?(e.preventDefault(),vm(t)):"Escape"===e.key&&(e.preventDefault(),hm(t)))},"cancel-download-file":function(t){return Cm(t)&&hm(t)}};function vm(t){var e,n=t.props.attachment;n.file&&n.file.path?Zt(t,"open-file",{path:n.file.path}):function(t){return t&&t.fileId}(n)&&!function(t){var e=t&&t.download;return e&&"loading"===e.status}(n)&&Zt(t,"download-file",{fileId:(e=n).fileId,chatId:e.chatId,messageId:e.messageId})}function hm(t){t.setState({pendingPreview:null})}function Cm(t){return!t.props.disabled&&!eo(t.componentView)}var km="eaiiv2r";function bm(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",km)),e._2=n.mountSlot(t,"")}bm.dispose=function(t){t._2=n.unmountSlot(t._2)};var ym={__proto__:null,cssScope:km,default:bm,props:function(){return{attachment:null,streaming:!1,disabled:!1}},events:gm},Sm=["Б","КБ","МБ","ГБ","ТБ","ПБ","ЕБ","ЗБ","ЙБ"],wm=Math.log10||function(t){return Math.log(t)*Math.LOG10E};function Em(t){if(!isFinite(t))throw new TypeError("Expected a finite number, got "+typeof t+": "+t);var e=function(t){return t=Math.abs(t),t<1?0:Math.min(Math.floor(wm(t)/3),Sm.length-1)}(t);return function(t,e){return(t/Math.pow(1e3,e)).toPrecision(3).replace(".",",")}(t,e)+" "+Sm[e]}function xm(t,e){"string"==typeof e&&(e=e.split("."));for(var n=0;n<e.length;n++){if(null==t)return t;t instanceof a?t=t.get(e[n]):"object"==typeof t&&(t=t[e[n]])}return t}function Im(t){var e={};return Object.keys(t).forEach((function(n){Array.isArray(t[n])?t[n].forEach((function(t){e[t]=(e[t]||[]).concat(n)})):e[t[n]]=n})),e}function Bm(t,e,n){n&&(t[e]=n)}var Mm=128,Am=64,Tm=64,jm=374,Pm=250,Rm=104,Lm=498,Om=374,zm=210,Dm={containerWidth:374,targetRowHeight:200,targetRowHeightTolerance:.1,containerPadding:0,boxSpacing:0,minWidth:64,minHeight:64,maxHeight:498},Um={width:374,height:280};function Nm(t,e){var o=n.__assign(n.__assign({},Dm),e);t=t.map((function(t){return function(t,e){if("PHOTO"===t._type||"VIDEO"===t._type||"AUDIO"===t._type){var o=void 0,r=void 0;if("AUDIO"===t._type)o=374,r=60;else if(function(t){return t&&"VIDEO"===t._type&&(t.deleted||t.file&&!("width"in t.file))}(t))o=Um.width,r=Um.height;else{var a="file"in t&&"width"in t.file?t.file:null;o=a?a.width:t.width,r=a?a.height:t.height}o&&r||(o=400,r=300);var i=o/r,s=Tn(i,e.minHeight/e.maxHeight,e.containerWidth/e.minWidth);return n.__assign(n.__assign({},t),{ratio:i,optimalRatio:s})}return t}(t,o)}));var r=n.layout(t.map((function(t){return t.optimalRatio})),o),a=function(t,e){var n=[],o=[n];return e.boxes.forEach((function(r,a){a>0&&e.boxes[a-1].top!==r.top&&o.push(n=[]),n.push({box:r,item:t[a]})})),o}(t,r).map(Hm);return n.__assign(n.__assign({},r),{rows:a})}function qm(t,e){void 0===e&&(e=!0);var n=t&&t.attaches||[];return e&&!n.length&&t.link&&t.link.message&&(n="REPLY"===t.link.type&&t.link.message.text?[]:t.link.message.attaches||[]),n.filter((function(t){return"INLINE_KEYBOARD"!==t._type}))}function Hm(t){var e=n.__assign({},Dm),o=0,r=0,a=Fm(t),i=Math.min(e.containerWidth,t.reduce((function(t,n){return t+(n.box.width<e.minWidth?n.box.width*a:n.box.width)}),0));return t.forEach((function(t){t.box.width<e.minWidth?o+=e.minWidth/i-t.box.width/i:r++})),t.map((function(t){var s=t.box.width<e.minWidth?t.box.width*a/i:t.box.width/i-o/r;return n.__assign(n.__assign({},t),{box:n.__assign(n.__assign({},t.box),{gridWidth:Vm(s)})})}))}function Fm(t){var e=t.map((function(t){return t.box.width})),n=e.indexOf(Math.min.apply(Math,e));return e[n]<Dm.minWidth?Dm.minWidth/e[n]:1}function Vm(t){return parseFloat(""+t).toFixed(3)}function Km(t,e){void 0===e&&(e=!1);var n=t.props.attachment,o=t.props.grid||!1,r=t.props.width||0,a=e?Rm:t.store.get().isMobile?Pm:jm,i=o||e?Am:Mm,s=function(t){var e,n,o=t.file,r=(null==t?void 0:t.width)||(null===(e=null==t?void 0:t.preview)||void 0===e?void 0:e.width)||(null==o?void 0:o.width)||Om,a=t.height||(null===(n=null==t?void 0:t.preview)||void 0===n?void 0:n.height)||(null==o?void 0:o.height)||zm;return{height:a,width:r}}(n),u=s.height,c=s.width,p=Math.max(r/c,1),l=Math.min(Math.min(a/c,Lm/u),1);c*=l,u*=l;var m=Math.max(Tm/u,i/c,1)*p;return{width:Math.min(Math.round(c*m),a),height:Math.round(u*m)}}function Wm(t){if("SHARE"===t._type){var e=t.url;return(null==e?void 0:e.startsWith("https://tt.me/joincall/"))||(null==e?void 0:e.startsWith("https://tamtam.chat/joincall/"))}}var Gm=function(t){return t>10?String(t):"0".concat(t)};function Ym(t){return t?t.file?t.file.name:t.name:null}function Xm(t){return t.file?t.file.size:t.size}function Qm(t,e){e.stopPropagation(),e.preventDefault();var n=t.props.attachment;n.fileId?Zt(t,"cancel-download-file",n.fileId):Zt(t,"remove-attach",n)}function Jm(t,e){var n,o=t.props.attachment,r=o.file,a=o.download;r&&r.path?n={localPath:r.path}:a&&a.hasLocal&&(n={id:a.id,url:a.url,localUrl:a.localUrl,name:o.name}),n&&(e.preventDefault(),e.stopPropagation(),Zt(t,"open-downloaded-item",n))}function $m(t){var e=Xm(t);return null!=e?Em(e):null}var Zm="e-f8v7j6",td=[0,0,0,0,0],ed=[];function nd(){ed.push(td),td=[0,0,0,0,0]}function od(){td=ed.pop()}function rd(t,e){var o;e.isDownloaded="complete"==n.get(t.props.attachment,"download","status"),e.isDownloading="loading"==n.get(t.props.attachment,"download","status"),e.isUploading=!n.get(t.props.attachment,"fileId"),e.preview=n.get(t.props.attachment,"preview","imageUrl")||n.get(t.props.attachment,"preview","url")||n.get(t.props.attachment,"preview","thumbnail"),e.isMedia=jt(0,["PHOTO","VIDEO","STICKER"],n.get(t.props.attachment,"preview","_type")),e.extension=(o=t.state.name).slice(2+(o.lastIndexOf(".")-1>>>0)),e.name=e.extension?Lt(0,t.state.name,0,-1*n.get(e.extension,"length")):t.state.name,e.previewWidth=n.get(t.props.attachment,"preview","width"),e.previewHeight=n.get(t.props.attachment,"preview","height"),e.filePreviewEnabled=n.get(t.store.data.config,"server","file-preview"),e.isBig=!t.props.compact&&e.preview&&e.isMedia&&e.previewWidth>64&&e.previewHeight>64&&e.filePreviewEnabled,e.width=e.isBig?t.state.width:e.previewWidth,e.height=e.isBig?t.state.height:e.previewHeight,e.chooseExpr=e.preview?0:t.state.name?1:2,e.caseExpr=0===e.chooseExpr,e.ifExpr=e.caseExpr&&e.isBig,e.chooseExpr_1=e.caseExpr?"STICKER"===n.get(t.props.attachment,"preview","_type")?0:"VIDEO"===n.get(t.props.attachment,"preview","_type")?1:2:-1,e.caseExpr_2=1===e.chooseExpr_1,e.ifExpr_1=e.caseExpr_2&&!e.filePreviewEnabled,e.caseExpr_3=2===e.chooseExpr_1,e.chooseExpr_2=e.caseExpr_3?e.filePreviewEnabled?0:1:-1,e.caseExpr_5=1===e.chooseExpr_2,e.ratio=e.caseExpr_5?n.get(t.props.attachment,"preview","height")/n.get(t.props.attachment,"preview","width"):void 0,e.coeff=e.caseExpr_5?e.ratio>=1?64/n.get(t.props.attachment,"preview","width"):64/n.get(t.props.attachment,"preview","height"):void 0,e.caseExpr_6=1===e.chooseExpr,e.ifExpr_2=e.caseExpr_6&&n.get(e.extension,"length")>3,e.chooseExpr_3=e.caseExpr_6?e.extension?1:0:-1,e.caseExpr_7=0===e.chooseExpr_3,e.caseExpr_8=1===e.chooseExpr_3,e.caseExpr_9=2===e.chooseExpr,e.chooseExpr_4=e.isUploading?0:e.isDownloading?1:"VIDEO"!==n.get(t.props.attachment,"preview","_type")||e.isBig||e.filePreviewEnabled?"VIDEO"!==n.get(t.props.attachment,"preview","_type")&&"PHOTO"!==n.get(t.props.attachment,"preview","_type")||e.isDownloaded||!e.filePreviewEnabled?-1:3:2,e.caseExpr_a=0===e.chooseExpr_4,e.progress=e.caseExpr_a?n.get(t.props.attachment,"progress"):void 0,e.progressFallback=e.caseExpr_a?"loading"==n.get(t.props.attachment,"status")?0:1:void 0,e.caseExpr_b=1===e.chooseExpr_4,e.progress_1=e.caseExpr_b?n.get(t.props.attachment,"download","progress"):e.caseExpr_a?n.get(t.props.attachment,"progress"):void 0}function ad(t,e,n){e.attachment=n.props.attachment,e.disabled=!n.props.allowDownload,e.tabindex=n.props.focusMode?0:null,e["aria-label"]="Скачать файл "+n.state.name}function id(t,e,n,o){e.big=o.isBig}function sd(t,e,o,r){n.updateClass(t,e,"preview-okmsg"+(r.ifExpr?" __big-okmsg":"")+(r.caseExpr_6?" __file-okmsg":"")+(r.ifExpr_2?" __s-okmsg":"")+(r.caseExpr_7?" __stub-okmsg":"")+(r.caseExpr_9?" __empty-okmsg":"")),n.updateAttribute(t,e,"style",r.ifExpr_1?"background-image: url("+r.preview+")":void 0)}function ud(t,e,o,r){e.sticker=n.get(o.props.attachment,"preview"),e.size=r.isBig?"":"thumbnail"}function cd(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-sticker",Uu,t)),a=o._1f=n.propsSet(r,{autoplay:!0,loop:!0});return ud(0,a,t,o),n.mountComponent(r,a),td[0]=1,pd}function pd(t,e){var o=e._1e,r=e._1f;ud(0,r,t,e),n.updateComponent(o,r)}function ld(t,e,o,r){n.updateAttribute(t,e,"src",r.preview),n.updateAttribute(t,e,"width",r.width),n.updateAttribute(t,e,"height",r.height)}function md(t,e,o){e.duration=n.get(o.props.attachment,"preview","duration")}function dd(t,e,o){var r=o._1l=n.insert(e,n.elem("img",Zm)),a=o._1m=n.obj();n.setAttribute(r,"alt",""),ld(r,a,0,o);var i=n.insert(e,n.elem("div",Zm));n.setClass(i,"duration-okmsg");var s=o._1o=n.appendChild(i,n.createComponent("msg-icon",xe,t));n.mountComponent(s,n.propsSet(s,{icon:"video",size:"nano"}));var u=o._1q=n.appendChild(i,n.createComponent("msg-duration",qi,t)),c=o._1r=n.propsSet(u);return md(0,c,t),n.mountComponent(u,c),td[0]=1,_d}function _d(t,e){var o=e._1q,r=e._1r;ld(e._1l,e._1m,0,e),md(0,r,t),n.updateComponent(o,r)}function fd(t,e){return e.filePreviewEnabled?dd:null}function gd(t,e,n,o){e.src=o.preview,e.width=o.width,e.height=o.height}function vd(t,e){var o=e._1x,r=e._1y;gd(0,r,0,e),n.updateComponent(o,r)}function hd(t,e,o){return o._1x?vd(0,o):function(t,e,o){var r=o._1x=n.insert(e,n.createComponent("msg-img-censor",$e,t)),a=o._1y=n.propsSet(r);gd(0,a,0,o),n.mountComponent(r,a),td[0]=1}(t,e,o),n.stopAnimation(o._1x,!0),Cd}function Cd(t,e){vd(0,e)}function kd(t){return t.props.censored?hd:null}function bd(t,e,o){return o._1i=n.mountBlock(t,e,fd),o._1s=n.mountBlock(t,e,kd),yd}function yd(t,e){n.updateBlock(e._1i),n.updateBlock(e._1s)}function Sd(t,e,n,o){e.src=o.preview,e.censored=n.props.censored,e.width=o.width,e.height=o.height}function wd(t,e,o){var r=o._24=n.insert(e,n.createComponent("msg-img",En,t)),a=o._25=n.propsSet(r,{attach:!0,gifAutoplay:"true"});return Sd(0,a,t,o),n.mountComponent(r,a),td[0]=1,Ed}function Ed(t,e){var o=e._24,r=e._25;Sd(0,r,t,e),n.updateComponent(o,r)}function xd(t,e,n,o){e.src=o.preview}function Id(t,e,o){var r=o._2b=n.insert(e,n.createComponent("msg-img-fill",qe,t)),a=o._2c=n.propsSet(r);return xd(0,a,0,o),n.mountComponent(r,a),td[0]=1,Bd}function Bd(t,e){var o=e._2b,r=e._2c;xd(0,r,0,e),n.updateComponent(o,r)}function Md(t){return t.props.fill?Id:null}function Ad(t,e,o,r){e.src=r.preview,e.censored=o.props.censored,e.width=n.get(o.props.attachment,"preview","width")*r.coeff,e.height=n.get(o.props.attachment,"preview","height")*r.coeff}function Td(t,e,o){o._28=n.mountBlock(t,e,Md);var r=o._2d=n.insert(e,n.createComponent("msg-img",En,t)),a=o._2e=n.propsSet(r,{class:"non-max-width-okmsg",attach:!0,gifAutoplay:"true"});return Ad(0,a,t,o),n.mountComponent(r,a),td[0]=1,jd}function jd(t,e){var o=e._2d,r=e._2e;n.updateBlock(e._28),Ad(0,r,t,e),n.updateComponent(o,r)}function Pd(t,e){return[wd,Td][e.chooseExpr_2]}function Rd(t,e,o){return o._21=n.mountBlock(t,e,Pd),Ld}function Ld(t,e){n.updateBlock(e._21)}function Od(t,e){return[cd,bd,Rd][e.chooseExpr_1]}function zd(t,e,o){return o._1b=n.mountBlock(t,e,Od),Dd}function Dd(t,e){n.updateBlock(e._1b)}function Ud(t,e,o){return o._2k=n.insert(e,n.text(o.extension)),td[0]=1,Nd}function Nd(t,e){td[0]|=n.updateText(e._2k,e.extension)}function qd(t,e){return e.caseExpr_8?Ud:null}function Hd(t,e,o){return o._2h=n.mountBlock(t,e,qd),Fd}function Fd(t,e){n.updateBlock(e._2h)}function Vd(t,e){return e.caseExpr?zd:e.caseExpr_6?Hd:null}function Kd(t,e,o,r){e.progress=r.progress?n.get(r.progress,"loaded")/n.get(r.progress,"total"):r.progressFallback,e.indeterminate="processing"===n.get(o.props.attachment,"status")}function Wd(t,e,o){var r=o._2p=n.insert(e,n.createComponent("msg-progress",Ps,t)),a=o._2q=n.propsSet(r,{class:"upload-okmsg preview-action-okmsg",size:32,spin:!0,cancelable:!0,"data-l":"t,abort"});return Kd(0,a,t,o),o._2r=n.addEvent(r,"click",Qm,t,o),n.mountComponent(r,a),td[0]=1,Gd}function Gd(t,e){var o=e._2p,r=e._2q;Kd(0,r,t,e),n.updateComponent(o,r)}function Yd(t,e,o,r){e.progress=r.progress_1&&n.get(r.progress_1,"loaded")/n.get(r.progress_1,"total")}function Xd(t,e,o){var r=o._2u=n.insert(e,n.createComponent("msg-progress",Ps,t)),a=o._2v=n.propsSet(r,{class:"preview-action-okmsg",size:32,spin:!0,cancelable:!0,"data-l":"t,abort"});return Yd(0,a,0,o),o._2w=n.addEvent(r,"click",Qm,t,o),n.mountComponent(r,a),td[0]=1,Qd}function Qd(t,e){var o=e._2u,r=e._2v;Yd(0,r,0,e),n.updateComponent(o,r)}function Jd(t,e,o){var r=o._2z=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._31=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"play",size:"medium"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"preview-action-okmsg inverted-okmsg"})),td[0]=1}function $d(t,e,o){var r=o._36=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._38=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"download",size:"medium"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"preview-action-okmsg inverted-okmsg __over-okmsg"})),td[0]=1}function Zd(t,e){return[Wd,Xd,Jd,$d][e.chooseExpr_4]}function t_(t,e,o){n.updateAttribute(t,e,"title",o.state.name)}function e_(t,e,o){var r=n.insert(e,n.elem("div",Zm));return n.setClass(r,"extension-okmsg"),o._3l=n.appendChild(r,n.text(o.extension)),td[2]=1,n_}function n_(t,e){td[2]|=n.updateText(e._3l,e.extension)}function o_(t,e){return e.extension?e_:null}function r_(t,e,o,r){n.updateClass(t,e,"details-okmsg "+(r.isUploading?n.get(o.props.attachment,"status"):n.get(o.props.attachment,"download","status")||""))}function a_(t,e,o){e.key="download-actions."+(n.get(o.props.attachment,"download","hasLocal")||n.get(o.props.attachment,"file","path")?"show-downloaded":"save")}function i_(t,e,o){var r=n.insert(e,n.elem("span",Zm));return n.setClass(r,"size-okmsg"),o._47=n.appendChild(r,n.text(t.state.duration)),td[4]=1,s_}function s_(t,e){td[4]|=n.updateText(e._47,t.state.duration)}function u_(t){return t.state.duration?i_:null}function c_(t,e){var o=t.componentView;nd(),rd(t,e);var r=e._12=n.appendChild(o,n.createComponent("msg-download-hook",ym,t)),a=r.componentModel.input;n.setRef(t,"hook",r);var i=e._13=n.propsSet(r,{role:"button"});ad(0,i,t);var s=e._14=n.insert(a,n.createComponent("msg-attach-template",$c,t),""),u=s.componentModel.input,c=e._15=n.propsSet(s,{"aria-hidden":"true"});id(0,c,0,e);var p=e._16=n.insert(u,n.elem("div",Zm),"preview"),l=n.createInjector(p),m=e._17=n.obj();n.setAttribute(p,"data-l","t,preview"),n.setAttribute(p,"slot","preview"),sd(p,m,0,e),e._18=n.mountBlock(t,l,Vd),e._2m=n.mountBlock(t,l,Zd);var d=e._3b=n.insert(u,n.elem("div",Zm),"title"),_=n.createInjector(d),f=e._3c=n.obj();n.setAttribute(d,"slot","title"),n.setClass(d,"title-okmsg"),t_(d,f,t);var g=e._3d=n.insert(_,n.createComponent("msg-parsed-text",ii,t)),v=g.componentModel.input;e._3f=n.insert(v,n.text(e.name)),n.mountComponent(g,n.propsSet(g,{class:"name-okmsg",disableFormatting:!0,disableLinks:!0,disableMentioning:!0})),e._3h=n.mountBlock(t,_,o_),e._3n=n.insert(u,n.text("\n"));var h=e._3o=n.insert(u,n.elem("div",Zm),"description"),C=e._3p=n.obj();n.setAttribute(h,"slot","description"),r_(h,C,t,e);var k=n.appendChild(h,n.elem("div",Zm));n.setClass(k,"line-okmsg status-idle-okmsg");var b=e._3r=n.appendChild(k,n.createComponent("msg-l10n",ae,t));n.mountComponent(b,n.propsSet(b,{key:"download-actions.start",class:"link-okmsg pl-okmsg"}));var y=n.appendChild(k,n.elem("span",Zm));n.setClass(y,"size-okmsg"),e._3u=n.appendChild(y,n.text(t.state.size));var S=n.appendChild(h,n.elem("div",Zm));n.setClass(S,"line-okmsg status-progress-okmsg pl-okmsg"),n.setAttribute(S,"data-l","t,abort"),e._3w=n.addEvent(S,"click",Qm,t,e);var w=n.appendChild(S,n.elem("span",Zm));n.setClass(w,"size-okmsg"),n.setAttribute(w,"style","min-width: 8.5em"),e._3y=n.appendChild(w,n.text(t.state.progress+" / "+t.state.size));var E=n.appendChild(h,n.elem("div",Zm)),x=n.createInjector(E);n.setClass(E,"line-okmsg status-completed-okmsg");var I=e._40=n.insert(x,n.createComponent("msg-l10n",ae,t)),B=e._41=n.propsSet(I,{class:"link-okmsg pl-okmsg"});return a_(0,B,t),e._42=n.addEvent(I,"click",Jm,t,e),n.mountComponent(I,B),e._43=n.mountBlock(t,x,u_),n.mountComponent(s,c),n.mountComponent(r,i),od(),n.subscribeStore(t,["config"]),p_}function p_(t,e){var o=e._12,r=e._13,a=e._14,i=e._15,s=e._40,u=e._41;nd(),rd(t,e),ad(0,r,t),id(0,i,0,e),sd(e._16,e._17,0,e),n.updateBlock(e._18),n.updateBlock(e._2m),t_(e._3b,e._3c,t),td[1]|=n.updateText(e._3f,e.name),n.updateIncomingSlot(e._3d,"",td[1]),n.updateBlock(e._3h),td[3]|=n.updateText(e._3n,"\n"),r_(e._3o,e._3p,t,e),td[4]|=n.updateText(e._3u,t.state.size),td[4]|=n.updateText(e._3y,t.state.progress+" / "+t.state.size),a_(0,u,t),n.updateComponent(s,u),n.updateBlock(e._43),n.updateIncomingSlot(a,"preview",td[0]),n.updateIncomingSlot(a,"title",td[2]),n.updateIncomingSlot(a,"",td[3]),n.updateIncomingSlot(a,"description",td[4]),n.updateComponent(a,i),n.updateComponent(o,r),od()}cd.dispose=function(t){t._1e=n.unmountComponent(t._1e),t._1f=null,td[0]=1},dd.dispose=function(t){t._1o=n.unmountComponent(t._1o),t._1q=n.unmountComponent(t._1q),t._1m=t._1l=t._1r=null,td[0]=1},hd.dispose=function(t,e){n.animate(t._1x,n.createAnimation("global:msg-fade-out 0.9s",Zm),(function(){return function(t){var e=t._1x;t._1x=n.unmountComponent(e),n.domRemove(e),t._1y=null,td[0]=1}(t)}))},bd.dispose=function(t){t._1i=n.unmountBlock(t._1i),t._1s=n.unmountBlock(t._1s)},wd.dispose=function(t){t._24=n.unmountComponent(t._24),t._25=null,td[0]=1},Id.dispose=function(t){t._2b=n.unmountComponent(t._2b),t._2c=null,td[0]=1},Td.dispose=function(t){t._28=n.unmountBlock(t._28),t._2d=n.unmountComponent(t._2d),t._2e=null,td[0]=1},Rd.dispose=function(t){t._21=n.unmountBlock(t._21)},zd.dispose=function(t){t._1b=n.unmountBlock(t._1b)},Ud.dispose=function(t){t._2k=null,td[0]=1},Hd.dispose=function(t){t._2h=n.unmountBlock(t._2h)},Wd.dispose=function(t){t._2r=n.removeEvent("click",t._2r),t._2p=n.unmountComponent(t._2p),t._2q=null,td[0]=1},Xd.dispose=function(t){t._2w=n.removeEvent("click",t._2w),t._2u=n.unmountComponent(t._2u),t._2v=null,td[0]=1},Jd.dispose=function(t){t._31=n.unmountComponent(t._31),t._2z=n.unmountComponent(t._2z),td[0]=1},$d.dispose=function(t){t._38=n.unmountComponent(t._38),t._36=n.unmountComponent(t._36),td[0]=1},e_.dispose=function(t){t._3l=null,td[2]=1},i_.dispose=function(t){t._47=null,td[4]=1},c_.dispose=function(t){nd(),t._18=n.unmountBlock(t._18),t._2m=n.unmountBlock(t._2m),t._3d=n.unmountComponent(t._3d),t._3h=n.unmountBlock(t._3h),t._3r=n.unmountComponent(t._3r),t._3w=n.removeEvent("click",t._3w),t._42=n.removeEvent("click",t._42),t._40=n.unmountComponent(t._40),t._43=n.unmountBlock(t._43),t._14=n.unmountComponent(t._14),t._12=n.unmountComponent(t._12),od()};var l_,m_={__proto__:null,cssScope:Zm,default:c_,props:function(){return{attachment:{},streaming:!1,allowDownload:!0,censored:!1}},state:function(){return{progress:0}},didChange:function(t,e){var n,o,r,a,i,s=e.attachment;if(s){var u=s.current;if(t.setState({name:u?Ym(u):null}),u){if(t.setState({size:$m(u)}),u.preview&&"MUSIC"===u.preview._type&&function(t){return t&&t.download&&"complete"===t.download.status}(u)?t.setState({duration:(n=u.preview.duration,o=Math.floor(n/3600),r=Math.floor((n-3600*o)/60),a=n-3600*o-60*r,i=o?"".concat(Gm(o),":"):"","".concat(i).concat(Gm(r),":").concat(Gm(a)))}):t.setState({duration:null}),function(t){var e=t.props.attachment,n=e.download;if(e.fileId)n&&"loading"===n.status?t.setState({progress:parseInt(Em(xm(n,"progress.loaded")||0),10)}):t.setState({progress:0});else{var o="processing"===e.status?Xm(e):xm(e,"progress.loaded");t.setState({progress:parseInt(Em(o||0),10)})}}(t),t.store.get().config.server["file-preview"]){var c=Km(t);t.setState({width:c.width,height:c.height})}}else t.setState({size:null,downloadedSize:null})}},onAbort:Qm,onShowFile:Jm},d_=[],__=!1;function f_(e){"playRestricted"in e.props.attachment||new Promise((function(e,n){t(["OK/music2/app"],e,n)})).then((function(t){if(function(t){var e=L(t,"player");e.reset()}(e),e.state.playing)t.pause();else{var n=e.props.attachment,o=n.trackId,r=n.context;t.v2?t.activate().then((function(e){var n=e.getState().player;n.track&&n.track.id===Number(o)?t.togglePlaying():e.player.play(Number(o),{ctx:r})})):t.play({qid:"track:".concat(o,":").concat(r)})}})).catch((function(){!function(t){var e=L(t,"player");e.playAttach(t.props.attachment)}(e)}))}function g_(t){l_=t,d_.forEach((function(e){return v_(e,t)}))}function v_(t,e){var n=t.props.attachment;t.setState({playing:e&&n.trackId===e.id&&e.playing})}var h_="e-4tjqsh",C_=[0,0],k_=[];function b_(){k_.push(C_),C_=[0,0]}function y_(){C_=k_.pop()}function S_(t,e){e.player=n.get(t.store.data.audioPlayer,"message","id")===n.get(t.props.attachment,"messageId")?t.store.data.audioPlayer:null,e.playing=t.state.playing||e.player&&!n.get(e.player,"paused"),e.ifExpr=n.get(t.props.attachment,"playRestricted")}function w_(t,e,o){e.class=n.get(o.props.attachment,"playRestricted")?"__restricted-okmsg":""}function E_(t,e,o){n.updateAttribute(t,e,"style","background-image: url("+n.get(o.props.attachment,"imageUrl")+")")}function x_(t,e,n,o){e.tabindex=n.props.focusMode?0:-1,e.title=o.playing?"Пауза":"Воспроизвести"}function I_(t,e,n,o){e.icon=o.ifExpr?"remove":o.playing?"pause":"play"}function B_(t,e,o){n.updateAttribute(t,e,"title",n.get(o.props.attachment,"title"))}function M_(t,e,o){e.duration=1e3*n.get(o.props.attachment,"duration")}function A_(t,e){var o=t.componentView;b_(),S_(t,e);var r=e._5=n.appendChild(o,n.createComponent("msg-attach-template",$c,t)),a=r.componentModel.input,i=e._6=n.propsSet(r);w_(0,i,t);var s=e._7=n.insert(a,n.elem("div",h_),"preview"),u=e._8=n.obj();n.setClass(s,"preview-okmsg"),n.setAttribute(s,"slot","preview"),E_(s,u,t);var c=e._9=n.appendChild(s,n.createComponent("button",fe,t)),p=c.componentModel.input,l=e._a=n.propsSet(c,{"data-l":"t,play"});x_(0,l,t,e),e._b=n.addEvent(c,"click",f_,t,e);var m=e._c=n.insert(p,n.createComponent("msg-icon",xe,t),""),d=e._d=n.propsSet(m,{size:"medium"});I_(0,d,0,e),n.mountComponent(m,d),n.mountComponent(c,l);var _=e._f=n.insert(a,n.elem("div",h_),"title"),f=e._g=n.obj();n.setClass(_,"name-okmsg"),n.setAttribute(_,"slot","title"),B_(_,f,t),e._h=n.appendChild(_,n.text(n.get(t.props.attachment,"title")));var g=n.insert(a,n.elem("div",h_),"description");n.setClass(g,"info-okmsg"),n.setAttribute(g,"slot","description");var v=n.appendChild(g,n.elem("div",h_));n.setClass(v,"artist-okmsg"),e._k=n.appendChild(v,n.text(n.get(t.props.attachment,"artistName")));var h=e._l=n.appendChild(g,n.createComponent("msg-duration",qi,t)),C=e._m=n.propsSet(h,{class:"size-okmsg","aria-hidden":"true"});return M_(0,C,t),n.mountComponent(h,C),n.mountComponent(r,i),y_(),n.subscribeStore(t,["audioPlayer"]),T_}function T_(t,e){var o=e._5,r=e._6,a=e._9,i=e._a,s=e._c,u=e._d,c=e._l,p=e._m;b_(),S_(t,e),w_(0,r,t),E_(e._7,e._8,t),x_(0,i,t,e),I_(0,u,0,e),n.updateComponent(s,u),n.updateComponent(a,i),B_(e._f,e._g,t),C_[0]|=n.updateText(e._h,n.get(t.props.attachment,"title")),C_[1]|=n.updateText(e._k,n.get(t.props.attachment,"artistName")),M_(0,p,t),n.updateComponent(c,p),n.updateIncomingSlot(o,"title",C_[0]),n.updateIncomingSlot(o,"description",C_[1]),n.updateComponent(o,r),y_()}A_.dispose=function(t){b_(),t._b=n.removeEvent("click",t._b),t._c=n.unmountComponent(t._c),t._9=n.unmountComponent(t._9),t._l=n.unmountComponent(t._l),t._5=n.unmountComponent(t._5),y_()};var j_={__proto__:null,cssScope:h_,default:A_,didMount:function(e){l_?v_(e,l_):new Promise((function(e,n){t(["OK/music2/app"],e,n)})).then((function(t){t.activate().then((function(n){var o=n.getState().player;o.track&&(l_=o.track,v_(e,l_)),__||(t.on("current-track-changed",g_),__=!0)}))})),d_.push(e)},willUnmount:function(t){var e=d_.indexOf(t);e>-1&&(d_[e]=d_[d_.length-1],d_.pop())},onPreviewClick:f_},P_="e-4ygqcv",R_=[0,0],L_=[];function O_(){L_.push(R_),R_=[0,0]}function z_(){R_=L_.pop()}function D_(t,e){e.preview=n.get(t.props.attachment,"image")||n.get(t.props.attachment,"media","image")||n.get(t.props.attachment,"media"),e.imageUrl=n.get(e.preview,"url")||n.get(e.preview,"media","image")||n.get(e.preview,"thumbnail")||n.get(e.preview,"image","url")||n.get(t.props.attachment,"thumbnail"),e.compact=t.props.compact&&e.imageUrl,e.rich=!t.props.compact&&e.imageUrl}function U_(t,e,o,r){n.updateClass(t,e,"content-okmsg"+(r.imageUrl?"":" __no-media-okmsg")+(r.compact?" __compact-okmsg":"")+(r.rich?" __rich-okmsg":""))}function N_(t,e,o){var r=n.insert(e,n.elem("div",P_));return n.setClass(r,"host-okmsg"),o._c=n.appendChild(r,n.text(n.get(t.props.attachment,"host"))),q_}function q_(t,e){n.updateText(e._c,n.get(t.props.attachment,"host"))}function H_(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{class:"host-okmsg",key:"photo"}))}function F_(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{class:"host-okmsg",key:"video"}))}function V_(t){return n.get(t.props.attachment,"host")?N_:"PHOTO"===n.get(t.props.attachment,"_type")?H_:"VIDEO"===n.get(t.props.attachment,"_type")?F_:null}function K_(t,e,o){var r=o._p=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._r=n.insert(a,n.text(n.get(t.props.attachment,"title"))),n.mountComponent(r,n.propsSet(r,{class:"title-okmsg",disableFormatting:!0,disableLinks:!0,disableMentioning:!0})),W_}function W_(t,e){R_[0]|=n.updateText(e._r,n.get(t.props.attachment,"title")),n.updateIncomingSlot(e._p,"",R_[0])}function G_(t){return n.get(t.props.attachment,"title")?K_:null}function Y_(t,e,o){var r=o._w=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._y=n.insert(a,n.text(n.get(t.props.attachment,"description"))),n.mountComponent(r,n.propsSet(r,{class:"descr-okmsg",disableFormatting:!0,disableLinks:!0,disableMentioning:!0})),X_}function X_(t,e){R_[1]|=n.updateText(e._y,n.get(t.props.attachment,"description")),n.updateIncomingSlot(e._w,"",R_[1])}function Q_(t){return n.get(t.props.attachment,"description")?Y_:null}function J_(t,e,n,o){e.src=o.imageUrl}function $_(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-img",En,t)),a=o._14=n.propsSet(r,{height:64,width:64});return J_(0,a,0,o),n.mountComponent(r,a),Z_}function Z_(t,e){var o=e._13,r=e._14;J_(0,r,0,e),n.updateComponent(o,r)}function tf(t,e,o,r){e.video=n.get(o.props.attachment,"media"),e.width=n.get(r.preview,"width"),e.height=n.get(r.preview,"height")}function ef(t,e,o){var r=o._17=n.insert(e,n.createComponent("msg-video-player",Xc,t)),a=o._18=n.propsSet(r,{fill:!0,"data-tsid":"share_attachment_vid"});return tf(0,a,t,o),n.mountComponent(r,a),nf}function nf(t,e){var o=e._17,r=e._18;tf(0,r,t,e),n.updateComponent(o,r)}function of(t,e,o,r){e.src=r.imageUrl,e.width=n.get(r.preview,"width"),e.height=n.get(r.preview,"height")}function rf(t,e,o){var r=n.insert(e,n.elem("div",P_));n.setClass(r,"spacer-okmsg");var a=o._1c=n.appendChild(r,n.createComponent("msg-img",En,t)),i=o._1d=n.propsSet(a);return of(0,i,0,o),n.mountComponent(a,i),af}function af(t,e){var o=e._1c,r=e._1d;of(0,r,0,e),n.updateComponent(o,r)}function sf(t,e){return e.compact?$_:"VIDEO"==n.get(t.props.attachment,"media","_type")?ef:e.rich?rf:null}function uf(t,e,o){n.updateAttribute(t,e,"href",function(t,e){return e}(0,n.get(o.props.attachment,"url"))),n.updateAttribute(t,e,"title",n.get(o.props.attachment,"description")||n.get(o.props.attachment,"title")||n.get(o.props.attachment,"host"))}function cf(t,e,o){var r=o._1h=n.insert(e,n.elem("a",P_)),a=o._1i=n.obj();return n.setClass(r,"link-okmsg url-okmsg"),n.setAttribute(r,"target","_blank"),n.setAttribute(r,"rel","nofollow noopener"),n.setAttribute(r,"tabindex","-1"),n.setAttribute(r,"data-tsid","share_attachment_link"),n.setAttribute(r,"data-l","t,share-url"),uf(r,a,t),pf}function pf(t,e){uf(e._1h,e._1i,t)}function lf(t){return n.get(t.props.attachment,"url")?cf:null}function mf(t,e){var o=t.componentView;O_(),D_(t,e);var r=e._6=n.appendChild(o,n.elem("div",P_)),a=n.createInjector(r);return U_(r,e._7=n.obj(),0,e),e._8=n.mountBlock(t,a,V_),e._m=n.mountBlock(t,a,G_),e._t=n.mountBlock(t,a,Q_),e._10=n.mountBlock(t,a,sf),e._1e=n.mountBlock(t,a,lf),z_(),df}function df(t,e){O_(),D_(t,e),U_(e._6,e._7,0,e),n.updateBlock(e._8),n.updateBlock(e._m),n.updateBlock(e._t),n.updateBlock(e._10),n.updateBlock(e._1e),z_()}N_.dispose=function(t){t._c=null},H_.dispose=function(t){t._f=n.unmountComponent(t._f)},F_.dispose=function(t){t._j=n.unmountComponent(t._j)},K_.dispose=function(t){t._p=n.unmountComponent(t._p),t._r=null},Y_.dispose=function(t){t._w=n.unmountComponent(t._w),t._y=null},$_.dispose=function(t){t._13=n.unmountComponent(t._13),t._14=null},ef.dispose=function(t){t._17=n.unmountComponent(t._17),t._18=null},rf.dispose=function(t){t._1c=n.unmountComponent(t._1c),t._1d=null},cf.dispose=function(t){t._1i=t._1h=null},mf.dispose=function(t){O_(),t._8=n.unmountBlock(t._8),t._m=n.unmountBlock(t._m),t._t=n.unmountBlock(t._t),t._10=n.unmountBlock(t._10),t._1e=n.unmountBlock(t._1e),z_()};var _f={__proto__:null,cssScope:P_,default:mf},ff="ew9cn22";function gf(t,e,o){e.indeterminate="pending"===n.get(o.props.data,"status"),e.spin="pending"===n.get(o.props.data,"status"),e.progress="loading"===n.get(o.props.data,"status")?n.get(o.props.data,"loaded")/n.get(o.props.data,"total"):0}function vf(t){Zt(t,"abort-download")}function hf(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("span",ff));n.setClass(r,"progress-okmsg");var a=e._2=n.appendChild(r,n.createComponent("msg-progress",Ps,t)),i=e._3=n.propsSet(a,{size:16,radius:7,thickness:1});gf(0,i,t),n.mountComponent(a,i);var s=e._4=n.appendChild(r,n.createComponent("button",fe,t)),u=s.componentModel.input;e._5=n.addEvent(s,"click",vf,t,e);var c=e._6=n.insert(u,n.createComponent("msg-icon",xe,t),"");n.mountComponent(c,n.propsSet(c,{icon:"close"})),n.mountComponent(s);var p=n.appendChild(o,n.elem("span",ff));return n.setClass(p,"label-okmsg"),e._a=n.appendChild(p,n.text(t.store.data.l10n("download-video.label"))),n.subscribeStore(t,["l10n"]),Cf}function Cf(t,e){var o=e._2,r=e._3;gf(0,r,t),n.updateComponent(o,r),n.updateText(e._a,t.store.data.l10n("download-video.label"))}hf.dispose=function(t){t._2=n.unmountComponent(t._2),t._5=n.removeEvent("click",t._5),t._6=n.unmountComponent(t._6),t._4=n.unmountComponent(t._4)};var kf={__proto__:null,cssScope:ff,default:hf},bf=[sr({swipeThreshold:20,tapDelay:200,longTapDelay:600,singleTapDelay:100})],yf={click:function(t,e){If(t,e)},uncensor:function(t,e){e.stopPropagation(),L(t,"chat").uncensor(t.props.attachment)},"pointer:single-tap":function(t,e){If(t,e.detail.originalEvent)}};function Sf(t,e){var n=t.props.attachment;n&&(e.stopPropagation(),Zt(t,"remove-attach",n))}function wf(t,e){var n=t.setId;n&&Zt(e,"open-sticker-pack-layer",{setId:n})}function Ef(t,e){e.stopPropagation();var n=t.props.attachment;t.setState({gifSaved:!0}),Zt(t,"show-toast",V("gif-saved-album")),Zt(t,"add-to-gifs",{chatid:n.chatId,messageid:n.messageId,photoid:n.photoId})}function xf(t,e){e.stopPropagation();var n=t.props.attachment;Zt(t,"save-photo",{chatId:n.chatId,messageId:n.messageId,photoId:n.photoId})}function If(t,e){var n,o=t.props.attachment;e.stopPropagation(),"SHARE"!==o._type||"Одноклассники"!==(n=o.host)&&"OK.RU"!==n.toUpperCase()?"PHOTO"===o._type&&o.mediaId?Bf(t,o.chatId,o.messageId,o.photoId):"LOCATION"===o._type&&o.messageId&&Zt(t,"view-location",{attach:o}):function(t,e){var n=t.props.attachment,o=t.store.get().isMobile,r=Zn(n.url),a=r.pathname,i=a.split("/").filter(Boolean),s=function(t){return void 0===t&&(t=[]),t.length>1&&An(t[1])}(i),u=s?2:1,c=s?3:2,p=s?4:3,l=i.length>u?i[u]:null,m="video"===i[0],d="album"===l,_="pphoto"===l,f="topic"===l,g="statuses"===l,v="market"===l&&o;v&&i[c]&&(a=a.replace("market","statuses"),g=!0,v=!1);(m||d||_||f||g||v)&&e.preventDefault();if(m)!function(t,e){var n="st.layer.cmd=";Jn(t,"".concat(e,"?").concat(n))}(t,a);else if(d||_){var h=d?i[c]:"-1",C=d?i[p]:i[c],k="group"===i[0];C&&!o?Bf(t,n.chatId,n.messageId,C,h,k):Zt(t,"navigate-url",{url:Qn(a)})}else f||g?o?Zt(t,"navigate-url",{url:Qn(a)}):Zt(t,"open-media-topic",{topicId:i[c],type:f?"GROUP_THEME":"USER"}):v&&Zt(t,"navigate-url",{url:Qn(a)})}(t,e)}function Bf(t,e,n,o,r,a){Zt(t,"open-photo-layer",{chatId:e,messageId:n,photoId:o,albumId:r,isGroup:a})}var Mf="e6xal3l",Af={thumbnail:{body:$g,defaults:{video:!1}},tico:{body:vv,defaults:{}},controls:{body:Cv,defaults:{}},progress:{body:Av,defaults:{}},bubble:{body:Vv,defaults:{}}},Tf=[0,0,0];function jf(t,e){e.keyboard=n.find(n.get(t.props.message,"attaches"),(function(t){return"INLINE_KEYBOARD"===n.get(t,"_type")})),e.uploading=n.get(t.props.attachment,"file")&&n.get(t.props.attachment,"status")&&"completed"!==n.get(t.props.attachment,"status"),e.censored=(t.store.data.whiteList||[])&&n.call(n.get(t,"root","state","service","chat"),"isCensored",[t.props.attachment]),e.chooseExpr=n.get(t.props.attachment,"deleted")?0:"STICKER"===n.get(t.props.attachment,"_type")?1:"SHARE"===n.get(t.props.attachment,"_type")?2:"CALL"===n.get(t.props.attachment,"_type")?3:t.props.compact?4:"AUDIO"===n.get(t.props.attachment,"_type")?5:"CONTACT"===n.get(t.props.attachment,"_type")?6:"FILE"===n.get(t.props.attachment,"_type")?7:"LOCATION"===n.get(t.props.attachment,"_type")?8:"MUSIC"===n.get(t.props.attachment,"_type")?9:"PHOTO"===n.get(t.props.attachment,"_type")?10:"VIDEO"===n.get(t.props.attachment,"_type")?11:"DAILY_MEDIA"===n.get(t.props.attachment,"_type")?12:-1,e.caseExpr_1=1===e.chooseExpr,e.openSetOnClick=e.caseExpr_1?jt(0,n.get(t.store.data.config,"server","sticker-type-open-set"),n.get(t.props.attachment,"stickerType"))&&n.get(t.props.attachment,"setId"):void 0,e.userSticker=e.caseExpr_1?"CONSTRUCTOR"===n.get(t.props.attachment,"authorType"):void 0,e.isPostcard=e.caseExpr_1?"POSTCARD"==n.get(t.props.attachment,"stickerType"):void 0,e.stickerSize=e.caseExpr_1?t.props.compact?"small":e.isPostcard?"parent":e.userSticker?"user":"default":void 0}function Pf(t,e,n){t.class="wrap-okmsg"+(n.caseExpr_1?" __sticker-okmsg":"")+(e.props.offset?" __offset-okmsg":"")+(n.keyboard&&!e.props.compact?" __center-okmsg":"")}function Rf(t,e,n){e.data=n.props.downloadProgress}function Lf(t,e){var o=e._l,r=e._m;Rf(0,r,t),n.updateComponent(o,r)}function Of(t,e,o){return o._l?Lf(t,o):function(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-message-download-progress",kf,t)),a=o._m=n.propsSet(r);Rf(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._l,n.createAnimation("download-progress .1s ease-out",Mf)),zf}function zf(t,e){Lf(t,e)}function Df(t){return"pending"===n.get(t.props.downloadProgress,"status")||"loading"===n.get(t.props.downloadProgress,"status")?Of:null}function Uf(t,e,o){e["data-type"]=n.get(o.props.attachment,"_type")}function Nf(t,e,o){var r=o._r=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=o._t=n.insert(a,n.createComponent("msg-l10n",ae,t),""),s=o._u=n.propsSet(i,{key:"attachment-deleted","data-tsid":"attachment_deleted"});return Uf(0,s,t),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{icon:"remove",size:"medium",class:"deleted-okmsg"})),qf}function qf(t,e){var o=e._t,r=e._u;Uf(0,r,t),n.updateComponent(o,r)}function Hf(t,e,o,r){e.sticker=o.props.attachment,e.autoplay=!o.props.compact&&o.props.isVisible,e.size=r.stickerSize,e["sticker-id"]=n.get(o.props.attachment,"stickerId"),e.title=r.openSetOnClick?o.store.data.l10n("other-stickers"):void 0}function Ff(t,e,n){wf(t.props.attachment,t)}function Vf(t,e){e.openSetOnClick&&n.setPendingEvent(e._z,"click",Ff,e)}function Kf(t,e,o){var r=o._y=n.insert(e,n.createComponent("msg-sticker",Uu,t)),a=o._z=n.pendingEvents(t,r),i=o._10=n.propsSet(r,{playOnHover:!0,showSet:!0,"data-tsid":"sticker_in_message","aria-label":"Приложение: стикер"});return Hf(0,i,t,o),Vf(0,o),n.finalizePendingEvents(a),n.mountComponent(r,i),Wf}function Wf(t,e){var o=e._y,r=e._10;Hf(0,r,t,e),Vf(0,e),n.finalizePendingEvents(e._z),n.updateComponent(o,r)}function Gf(t,e,n){e.attachment=n.props.attachment,e.compact=n.props.compact||n.state.forcedCompact}function Yf(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-attach-share",_f,t)),a=o._16=n.propsSet(r,{"aria-label":"Приложение: ссылка","data-tsid":"share_attachment"});return Gf(0,a,t),n.mountComponent(r,a),Xf}function Xf(t,e){var o=e._15,r=e._16;Gf(0,r,t),n.updateComponent(o,r)}function Qf(t,e,n){e.attachment=n.props.attachment,e.isMine=n.props.isMine,e.compact=n.props.compact}function Jf(t,e,o){var r=o._19=n.insert(e,n.createComponent("msg-attach-call",yp,t)),a=o._1a=n.propsSet(r,{"aria-label":"Приложение: звонок","data-tsid":"call_attachment"});return Qf(0,a,t),n.mountComponent(r,a),$f}function $f(t,e){var o=e._19,r=e._1a;Qf(0,r,t),n.updateComponent(o,r)}function Zf(t,e,o){return o._1g=n.mountPartial(t,e,n.getPartial(t,"thumbnail",Af),{attachment:t.props.attachment,video:"VIDEO"===n.get(t.props.attachment,"_type"),":a":o._e,":e":o._d}),tg}function tg(t,e){n.updatePartial(e._1g,n.getPartial(t,"thumbnail",Af),{attachment:t.props.attachment,video:"VIDEO"===n.get(t.props.attachment,"_type"),":a":e._e,":e":e._d})}function eg(t,e,n){e.attachment=n.props.attachment}function ng(t,e,o){var r=o._1j=n.insert(e,n.createComponent("msg-attach-daily-media",fm,t)),a=o._1k=n.propsSet(r,{compact:!0});return eg(0,a,t),n.mountComponent(r,a),og}function og(t,e){var o=e._1j,r=e._1k;eg(0,r,t),n.updateComponent(o,r)}function rg(t,e,o){return o._1n=n.mountPartial(t,e,n.getPartial(t,"tico",Af),{attachment:t.props.attachment,":a":o._e,":e":o._d}),ag}function ag(t,e){n.updatePartial(e._1n,n.getPartial(t,"tico",Af),{attachment:t.props.attachment,":a":e._e,":e":e._d})}function ig(t){return"PHOTO"===n.get(t.props.attachment,"_type")||"VIDEO"===n.get(t.props.attachment,"_type")?Zf:"DAILY_MEDIA"===n.get(t.props.attachment,"_type")?ng:rg}function sg(t,e,o){return o._1d=n.mountBlock(t,e,ig),ug}function ug(t,e){n.updateBlock(e._1d)}function cg(t,e,o){e.attachment=o.props.attachment,e.search=o.props.search,e.highlights=o.props.highlights,e.focusMode=o.props.focusMode,e["aria-label"]="Приложение: аудиосообщение, длительность "+Qt(0,n.get(o.props.attachment,"duration"))}function pg(t,e,o){var r=o._1q=n.insert(e,n.createComponent("msg-message-audio-attach",Ss,t)),a=o._1r=n.propsSet(r,{"data-tsid":"audio_attachment"});return cg(0,a,t),n.mountComponent(r,a),lg}function lg(t,e){var o=e._1q,r=e._1r;cg(0,r,t),n.updateComponent(o,r)}function mg(t,e,n){e.attachment=n.props.attachment}function dg(t,e,o){var r=o._1u=n.insert(e,n.createComponent("msg-attach-contact",pl,t)),a=o._1v=n.propsSet(r,{"aria-label":"Приложение: контакт","data-tsid":"contact_attachment"});return mg(0,a,t),n.mountComponent(r,a),_g}function _g(t,e){var o=e._1u,r=e._1v;mg(0,r,t),n.updateComponent(o,r)}function fg(t,e,n,o){e.attachment=n.props.attachment,e.focusMode=n.props.focusMode,e.censored=o.censored}function gg(t,e,o){var r=o._1y=n.insert(e,n.createComponent("msg-attach-file",m_,t));n.setPendingRef(o._1,"fileAttach",r);var a=o._1z=n.propsSet(r,{fill:!0,"aria-label":"Приложение: файл","data-tsid":"file_attachment",autoplay:!0});return fg(0,a,t,o),n.mountComponent(r,a),vg}function vg(t,e){var o=e._1y,r=e._1z;n.setPendingRef(e._1,"fileAttach",o),fg(0,r,t,e),n.updateComponent(o,r)}function hg(t,e,n){e.attachment=n.props.attachment}function Cg(t,e,o){var r=o._22=n.insert(e,n.createComponent("msg-message-attachment-location-portal",Mn,t)),a=o._23=n.propsSet(r,{"aria-label":"Приложение: геолокация"});return hg(0,a,t),n.mountComponent(r,a),kg}function kg(t,e){var o=e._22,r=e._23;hg(0,r,t),n.updateComponent(o,r)}function bg(t,e,o){e.attachment=o.props.attachment,e.focusMode=o.props.focusMode,e["aria-label"]="Приложение: музыка, длительность "+Qt(0,1e3*n.get(o.props.attachment,"duration"))}function yg(t,e,o){var r=o._26=n.insert(e,n.createComponent("msg-attach-music",j_,t)),a=o._27=n.propsSet(r,{"data-tsid":"music_attachment"});return bg(0,a,t),n.mountComponent(r,a),Sg}function Sg(t,e){var o=e._26,r=e._27;bg(0,r,t),n.updateComponent(o,r)}function wg(t,e,o,r){e.src=o.props.attachment,e.width=o.state.width,e.height=o.state.height,e.compact=o.props.compact,e.censored=r.censored,e.gifAutoplay=o.props.isVisible,e["data-tsid-id"]=n.get(o.props.attachment,"photoId")}function Eg(t){Zt(t,"attachment-click",t.props.attachment)}function xg(t,e,o){return o._2h=n.mountPartial(t,e,n.getPartial(t,"progress",Af),{":a":o._e,":e":o._d}),Ig}function Ig(t,e){n.updatePartial(e._2h,n.getPartial(t,"progress",Af),{":a":e._e,":e":e._d})}function Bg(t,e){return e.uploading?xg:null}function Mg(t,e,o){var r=n.insert(e,n.elem("div",Mf));n.setClass(r,"photo-okmsg"),n.setAttribute(r,"aria-label","Приложение: фото");var a=o._2b=n.appendChild(r,n.createComponent("msg-img",En,t)),i=o._2c=n.propsSet(a,{attach:!0,"data-tsid":"photo_attachment"});return wg(0,i,t,o),o._2d=n.addEvent(a,"click",Eg,t,o),n.mountComponent(a,i),o._2e=n.mountBlock(t,e,Bg),Ag}function Ag(t,e){var o=e._2b,r=e._2c;wg(0,r,t,e),n.updateComponent(o,r),n.updateBlock(e._2e)}function Tg(t,e,o){e.video=o.props.attachment,e.width=o.state.width,e.height=o.state.height,e.autoplay=n.get(o.store.data.config,"user","AUTOPLAY_IN_FEED")&&n.get(o.store.data.config,"server","video-autoplay")&&o.props.isVisible}function jg(t,e,o){return o._2p=n.mountPartial(t,e,n.getPartial(t,"progress",Af),{":a":o._e,":e":o._d}),Pg}function Pg(t,e){n.updatePartial(e._2p,n.getPartial(t,"progress",Af),{":a":e._e,":e":e._d})}function Rg(t,e){return e.uploading?jg:null}function Lg(t,e,o){var r=o._2k=n.insert(e,n.createComponent("msg-video-player",Xc,t));n.setPendingRef(o._1,"videoPlayer",r);var a=o._2l=n.propsSet(r,{fill:!0,"data-tsid":"video_attachment","aria-label":"Приложение: видео"});return Tg(0,a,t),n.mountComponent(r,a),o._2m=n.mountBlock(t,e,Rg),Og}function Og(t,e){var o=e._2k,r=e._2l;n.setPendingRef(e._1,"videoPlayer",o),Tg(0,r,t),n.updateComponent(o,r),n.updateBlock(e._2m)}function zg(t,e,n){e.attachment=n.props.attachment}function Dg(t,e,o){var r=o._2s=n.insert(e,n.createComponent("msg-attach-daily-media",fm,t)),a=o._2t=n.propsSet(r,{"data-tsid":"daily-media-attachment","aria-label":"Приложение: моменты дня"});return zg(0,a,t),n.mountComponent(r,a),Ug}function Ug(t,e){var o=e._2s,r=e._2t;zg(0,r,t),n.updateComponent(o,r)}function Ng(t,e){return[Nf,Kf,Yf,Jf,sg,pg,dg,gg,Cg,yg,Mg,Lg,Dg][e.chooseExpr]}function qg(t,e,o){return o._2z=n.mountPartial(t,e,n.getPartial(t,"bubble",Af),{":a":o[":a"],":e":o[":e"]}),Hg}function Hg(t,e){n.updatePartial(e._2z,n.getPartial(t,"bubble",Af),{":a":e[":a"],":e":e[":e"]})}function Fg(t,e){return"PHOTO"!==n.get(t.props.attachment,"_type")||t.props.compact||!n.get(t.props.attachment,"messageId")||e.censored||n.get(t.store.data.config,"server","plus-photo-disabled")?null:qg}function Vg(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();jf(t,e);var i=e._c=n.insert(r,n.elem("div",Mf)),s=n.createInjector(i),u=e._d=n.pendingEvents(t,i),c=e._e=n.obj(),p=e._f=n.obj();return Pf(c,t,e),e._g=n.mountBlock(t,s,Df),e._o=n.mountBlock(t,s,Ng),n.finalizePendingEvents(u),n.finalizeAttributes(i,c,p),e._2u=n.mountBlock(t,r,Fg),n.subscribeStore(t,["whiteList","config","l10n"]),n.finalizePendingRefs(t,a),Kg}function Kg(t,e){var o=e._e;jf(t,e),Pf(o,t,e),n.updateBlock(e._g),n.updateBlock(e._o),n.finalizePendingEvents(e._d),n.finalizeAttributes(e._c,o,e._f),n.updateBlock(e._2u),n.finalizePendingRefs(t,e._1)}function Wg(t,e){e.width=t.props.width||n.get(t.props.attachment,"width")||n.get(t.props.attachment,"file","width"),e.height=t.props.height||n.get(t.props.attachment,"height")||n.get(t.props.attachment,"file","height"),e.ratio=e.height/e.width,e.coefficient=e.ratio>1?104/e.width:96/e.height}function Gg(t){t.class="thumbnail-okmsg"}function Yg(t,e,n,o){e.src=n.props.attachment,e.censored=o.censored,e.compact=n.props.compact,e.width=n.state.width,e.height=n.state.height}function Xg(t,e,o){return o._3i=n.mountPartial(t,e,n.getPartial(t,"controls",Af),{":a":o._3b,":e":o._3a}),Qg}function Qg(t,e){n.updatePartial(e._3i,n.getPartial(t,"controls",Af),{":a":e._3b,":e":e._3a})}function Jg(t,e){return e.video?Xg:null}function $g(t,e,o){Wg(t,o);var r=o._39=n.insert(e,n.elem("div",Mf)),a=n.createInjector(r),i=o._3a=n.pendingEvents(t,r),s=o._3b=n.obj(),u=o._3c=n.obj();Gg(s);var c=o._3d=n.insert(a,n.createComponent("msg-img",En,t)),p=o._3e=n.propsSet(c,{attach:!0,"data-tsid":"photo_attachment"});return Yg(0,p,t,o),n.mountComponent(c,p),o._3f=n.mountBlock(t,a,Jg),n.finalizePendingEvents(i),n.finalizeAttributes(r,s,u),Zg}function Zg(t,e){var o=e._3b,r=e._3d,a=e._3e;Wg(t,e),Gg(o),Yg(0,a,t,e),n.updateComponent(r,a),n.updateBlock(e._3f),n.finalizePendingEvents(e._3a),n.finalizeAttributes(e._39,o,e._3c)}function tv(t,e){e.type=n.get(t.props.attachment,"_type"),e.chooseExpr_1="AUDIO"===e.type?0:"CONTACT"===e.type?1:"FILE"===e.type?2:"LOCATION"===e.type?3:"MUSIC"===e.type?4:-1,e.caseExpr_d=0===e.chooseExpr_1,e.caseExpr_e=1===e.chooseExpr_1,e.caseExpr_f=2===e.chooseExpr_1,e.caseExpr_g=3===e.chooseExpr_1,e.caseExpr_h=4===e.chooseExpr_1}function ev(t,e,n,o){e.icon=o.caseExpr_h?"music_12":o.caseExpr_g?"location_12":o.caseExpr_f?"file_12":o.caseExpr_e?"user_12":o.caseExpr_d?"microphone_12":void 0}function nv(t){return n.get(t.props.attachment,"transcription")}function ov(t,e,o){return o._42=n.mountInnerHTML(t,e,nv),rv}function rv(t,e){n.updateInnerHTML(e._42)}function av(t,e,o){var r=o._45=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"audio"})),Tf[0]=1}function iv(t,e){return n.get(t.props.attachment,"transcription")&&e.transcriptionEnabled?ov:av}function sv(t,e,o){return o._3z=n.mountBlock(t,e,iv),uv}function uv(t,e){n.updateBlock(e._3z)}function cv(t,e,o){return o._49=n.insert(e,n.text(n.get(t.props.attachment,"name"))),Tf[0]=1,pv}function pv(t,e){Tf[0]|=n.updateText(e._49,n.get(t.props.attachment,"name"))}function lv(t,e,o){return o._4c=n.insert(e,n.text(n.get(t.props.attachment,"name"))),Tf[0]=1,mv}function mv(t,e){Tf[0]|=n.updateText(e._4c,n.get(t.props.attachment,"name"))}function dv(t,e,o){var r=o._4f=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"location"})),Tf[0]=1}function _v(t,e,o){return o._4j=n.insert(e,n.text(n.get(t.props.attachment,"artistName"))),n.insert(e,n.text(" — ")),o._4l=n.insert(e,n.text(n.get(t.props.attachment,"title"))),Tf[0]=1,fv}function fv(t,e){Tf[0]|=n.updateText(e._4j,n.get(t.props.attachment,"artistName")),Tf[0]|=n.updateText(e._4l,n.get(t.props.attachment,"title"))}function gv(t,e){return[sv,cv,lv,dv,_v][e.chooseExpr_1]}function vv(t,e,o){tv(t,o);var r=o._3u=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=o._3v=n.propsSet(r,{size:"small"});return ev(0,i,0,o),o._3w=n.mountBlock(t,a,gv),n.mountComponent(r,i),hv}function hv(t,e){var o=e._3u,r=e._3v;tv(t,e),ev(0,r,0,e),n.updateBlock(e._3w),n.updateIncomingSlot(o,"",Tf[0]),n.updateComponent(o,r)}function Cv(t,e,o){var r=o._4p=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._4r=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"play"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"play-okmsg"}))}function kv(t,e){e.unsupportedVideo="VIDEO"===n.get(t.props.attachment,"_type")&&n.get(t.props.attachment,"file")&&!n.get(t.props.attachment,"file","width")}function bv(t,e,o){e.progress=n.get(o.props.attachment,"progress","loaded")/n.get(o.props.attachment,"progress","total"),e.indeterminate="processing"===n.get(o.props.attachment,"status")||n.get(o.props.attachment,"gif")}function yv(t,e,o){var r=o._52=n.insert(e,n.createComponent("msg-progress",Ps,t)),a=o._53=n.propsSet(r,{spin:!0,cancelable:!0});return bv(0,a,t),o._54=n.addEvent(r,"click",Sf,t,o),n.mountComponent(r,a),Sv}function Sv(t,e){var o=e._52,r=e._53;bv(0,r,t),n.updateComponent(o,r)}function wv(t,e,o){var r=o._57=n.insert(e,n.createComponent("msg-icon",xe,t));o._59=n.addEvent(r,"click",Sf,t,o),n.mountComponent(r,n.propsSet(r,{icon:"error"}))}function Ev(t){return"error"!==n.get(t.props.attachment,"status")?yv:wv}function xv(t,e,o){e.key="video-preview-after-"+("processing"===n.get(o.props.attachment,"status")?"processing":"upload")}function Iv(t,e,o){var r=o._5e=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._5f=n.propsSet(r,{class:"label-okmsg"});return xv(0,a,t),n.mountComponent(r,a),Bv}function Bv(t,e){var o=e._5e,r=e._5f;xv(0,r,t),n.updateComponent(o,r)}function Mv(t,e){return e.unsupportedVideo?Iv:null}function Av(t,e,o){kv(t,o);var r=n.insert(e,n.elem("div",Mf)),a=n.createInjector(r);return n.setClass(r,"progress-okmsg"),o._4z=n.mountBlock(t,a,Ev),o._5b=n.mountBlock(t,a,Mv),Tv}function Tv(t,e){kv(t,e),n.updateBlock(e._4z),n.updateBlock(e._5b)}function jv(t,e){e.ifExpr=!t.state.gifSaved}function Pv(t,e,n,o){e.class="save-btn-okmsg"+(n.state.gifSaved?" __saved-okmsg":""),e["data-tsid"]=o.ifExpr?"added_gif":"save_gif"}function Rv(t,e){e.ifExpr&&n.setPendingEvent(e._5q,"click",Ef,e)}function Lv(t,e,n){e.icon=n.state.gifSaved?"check":"plus"}function Ov(t,e,o){var r=o._5p=n.insert(e,n.createComponent("msg-button",fe,t),"element"),a=r.componentModel.input,i=o._5q=n.pendingEvents(t,r),s=o._5r=n.propsSet(r,{slot:"element",shape:"circle","data-l":"t,addtoGifs"});Pv(0,s,t,o),Rv(0,o);var u=o._5u=n.insert(a,n.createComponent("msg-icon",xe,t),""),c=o._5v=n.propsSet(u);return Lv(0,c,t),n.mountComponent(u,c),n.finalizePendingEvents(i),n.mountComponent(r,s),Tf[1]=1,zv}function zv(t,e){var o=e._5p,r=e._5r,a=e._5u,i=e._5v;Pv(0,r,t,e),Rv(0,e),Lv(0,i,t),n.updateComponent(a,i),n.finalizePendingEvents(e._5q),n.updateComponent(o,r)}function Dv(t,e,o){var r=o._5z=n.insert(e,n.createComponent("msg-button",fe,t),"element"),a=r.componentModel.input;o._61=n.addEvent(r,"click",xf,t,o);var i=o._62=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"plus"})),n.mountComponent(r,n.propsSet(r,{slot:"element",shape:"circle",class:"save-btn-okmsg __hover-okmsg","data-l":"t,saveToAlbum","data-tsid":"save_album"})),Tf[1]=1}function Uv(t){return n.get(t.props.attachment,"gif")?Ov:n.get(t.store.data.config,"server","album-save")?Dv:null}function Nv(t,e,o){var r=o._6a=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"gif-save"})),Tf[2]=1}function qv(t,e,o){var r=o._6e=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"saved-to-album"})),Tf[2]=1}function Hv(t,e,o){var r=o._6i=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"album-save"})),Tf[2]=1}function Fv(t){return n.get(t.props.attachment,"gif")&&!t.state.gifSaved?Nv:n.get(t.props.attachment,"gif")&&t.state.gifSaved?qv:Hv}function Vv(t,e,o){jv(t,o);var r=o._5k=n.insert(e,n.createComponent("msg-bubble",me,t)),a=r.componentModel.input;o._5m=n.mountBlock(t,a,Uv);var i=n.insert(a,n.elem("div",Mf),"bubble"),s=n.createInjector(i);return n.setClass(i,"tooltip-okmsg"),n.setAttribute(i,"slot","bubble"),o._67=n.mountBlock(t,s,Fv),n.mountComponent(r,n.propsSet(r,{yAxis:"top",xAxis:"left",container:"msg-attach",tooltip:!0,hideDelay:0,forced:!0})),Kv}function Kv(t,e){var o=e._5k;jv(t,e),n.updateBlock(e._5m),n.updateBlock(e._67),n.updateIncomingSlot(o,"element",Tf[1]),n.updateIncomingSlot(o,"bubble",Tf[2])}Of.dispose=function(t,e){n.animate(t._l,n.createAnimation("download-progress .1s ease-out reverse",Mf),(function(){return function(t){var e=t._l;t._l=n.unmountComponent(e),n.domRemove(e),t._m=null}(t)}))},Nf.dispose=function(t){t._t=n.unmountComponent(t._t),t._r=n.unmountComponent(t._r),t._u=null},Kf.dispose=function(t){t._z=n.detachPendingEvents(t._z),t._y=n.unmountComponent(t._y),t._10=null},Yf.dispose=function(t){t._15=n.unmountComponent(t._15),t._16=null},Jf.dispose=function(t){t._19=n.unmountComponent(t._19),t._1a=null},Zf.dispose=function(t){t._1g=n.unmountPartial(t._1g)},ng.dispose=function(t){t._1j=n.unmountComponent(t._1j),t._1k=null},rg.dispose=function(t){t._1n=n.unmountPartial(t._1n)},sg.dispose=function(t){t._1d=n.unmountBlock(t._1d)},pg.dispose=function(t){t._1q=n.unmountComponent(t._1q),t._1r=null},dg.dispose=function(t){t._1u=n.unmountComponent(t._1u),t._1v=null},gg.dispose=function(t){t._1y=n.unmountComponent(t._1y),t._1z=null},Cg.dispose=function(t){t._22=n.unmountComponent(t._22),t._23=null},yg.dispose=function(t){t._26=n.unmountComponent(t._26),t._27=null},xg.dispose=function(t){t._2h=n.unmountPartial(t._2h)},Mg.dispose=function(t){t._2d=n.removeEvent("click",t._2d),t._2b=n.unmountComponent(t._2b),t._2e=n.unmountBlock(t._2e),t._2c=null},jg.dispose=function(t){t._2p=n.unmountPartial(t._2p)},Lg.dispose=function(t){t._2k=n.unmountComponent(t._2k),t._2m=n.unmountBlock(t._2m),t._2l=null},Dg.dispose=function(t){t._2s=n.unmountComponent(t._2s),t._2t=null},qg.dispose=function(t){t._2z=n.unmountPartial(t._2z)},Vg.dispose=function(t){t._d=n.detachPendingEvents(t._d),t._g=n.unmountBlock(t._g),t._o=n.unmountBlock(t._o),t._2u=n.clearBlock(t._2u)},Xg.dispose=function(t){t._3i=n.unmountPartial(t._3i)},$g.dispose=function(t){t._3a=n.detachPendingEvents(t._3a),t._3d=n.unmountComponent(t._3d),t._3f=n.unmountBlock(t._3f),t._3b=t._3c=t._3e=t._39=null},ov.dispose=function(t){t._42=n.unmountInnerHTML(t._42)},av.dispose=function(t){t._45=n.unmountComponent(t._45),Tf[0]=1},sv.dispose=function(t){t._3z=n.unmountBlock(t._3z)},cv.dispose=function(t){t._49=null,Tf[0]=1},lv.dispose=function(t){t._4c=null,Tf[0]=1},dv.dispose=function(t){t._4f=n.unmountComponent(t._4f),Tf[0]=1},_v.dispose=function(t){t._4j=t._4l=null,Tf[0]=1},vv.dispose=function(t){t._3w=n.unmountBlock(t._3w),t._3u=n.unmountComponent(t._3u),t._3v=null},Cv.dispose=function(t){t._4r=n.unmountComponent(t._4r),t._4p=n.unmountComponent(t._4p)},yv.dispose=function(t){t._54=n.removeEvent("click",t._54),t._52=n.unmountComponent(t._52),t._53=null},wv.dispose=function(t){t._59=n.removeEvent("click",t._59),t._57=n.unmountComponent(t._57)},Iv.dispose=function(t){t._5e=n.unmountComponent(t._5e),t._5f=null},Av.dispose=function(t){t._4z=n.unmountBlock(t._4z),t._5b=n.unmountBlock(t._5b)},Ov.dispose=function(t){t._5q=n.detachPendingEvents(t._5q),t._5u=n.unmountComponent(t._5u),t._5p=n.unmountComponent(t._5p),t._5r=t._5v=null,Tf[1]=1},Dv.dispose=function(t){t._61=n.removeEvent("click",t._61),t._62=n.unmountComponent(t._62),t._5z=n.unmountComponent(t._5z),Tf[1]=1},Nv.dispose=function(t){t._6a=n.unmountComponent(t._6a),Tf[2]=1},qv.dispose=function(t){t._6e=n.unmountComponent(t._6e),Tf[2]=1},Hv.dispose=function(t){t._6i=n.unmountComponent(t._6i),Tf[2]=1},Vv.dispose=function(t){t._5m=n.unmountBlock(t._5m),t._67=n.unmountBlock(t._67),t._5k=n.unmountComponent(t._5k)};var Wv={__proto__:null,cssScope:Mf,partials:Af,default:Vg,plugins:bf,events:yf,didChange:function(t,e){var n=e.attachment;if(n){var o=n.current;!o||"PHOTO"!==o._type&&"VIDEO"!==o._type||t.setState(Km(t,t.props.compact)),"SHARE"===(null==o?void 0:o._type)&&t.setState({forcedCompact:Wm(o)})}},onRemoveAttach:Sf,onStickerShowcase:wf,onAddtoGifs:Ef,onSaveToAlbum:xf};function Gv(t,e){return n.__assign({chatId:t.props.chat.id},e)}function Yv(t){return!(t.metaKey||t.altKey||t.ctrlKey)&&(t.preventDefault(),!0)}function Xv(t,e){var n=t.props.user;e.stopPropagation(),Yv(e)&&Zt(t,"view-profile",{userId:n.id,profileUrl:n.profileUrl})}var Qv="e-uzgcpj",Jv=[0],$v=[];function Zv(){$v.push(Jv),Jv=[0]}function th(){Jv=$v.pop()}function eh(t,e,n){e.title=n.store.data.l10n("chat-owner")}function nh(t,e,o){var r=o._5=n.insert(e,n.createComponent("msg-icon",xe,t)),a=o._6=n.propsSet(r,{size:"medium",icon:"shield-safety"});return eh(0,a,t),n.mountComponent(r,a),oh}function oh(t,e){var o=e._5,r=e._6;eh(0,r,t),n.updateComponent(o,r)}function rh(t,e,n){e.title=n.store.data.l10n("superadmin")}function ah(t,e,o){var r=o._9=n.insert(e,n.createComponent("msg-icon",xe,t)),a=o._a=n.propsSet(r,{size:"medium",icon:"shield-superadmin"});return rh(0,a,t),n.mountComponent(r,a),ih}function ih(t,e){var o=e._9,r=e._a;rh(0,r,t),n.updateComponent(o,r)}function sh(t,e,n){e.title=n.store.data.l10n("admin")}function uh(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-icon",xe,t)),a=o._e=n.propsSet(r,{size:"medium",icon:"shield-admin"});return sh(0,a,t),n.mountComponent(r,a),ch}function ch(t,e){var o=e._d,r=e._e;sh(0,r,t),n.updateComponent(o,r)}function ph(t){return t.props.owner?nh:t.props.superadmin?ah:t.props.admin?uh:null}function lh(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{size:"medium",icon:"channel"}))}function mh(t,e,o){var r=o._n=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{size:"medium",icon:"bot"}))}function dh(t){return t.props.channel?lh:t.props.bot?mh:null}function _h(t,e,o){var r=o._s=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"official",size:"medium"}))}function fh(t){return t.props.official?_h:null}function gh(t,e,n){e.disableFormatting=!n.props.formatting,e.disableLinks=!n.props.formatting,e.highlights=n.props.highlights,e.emojiContext=n.props.emojiContext}function vh(t,e,o){n.updateAttribute(t,e,"href",n.get(o.props.user,"profileUrl")),n.updateAttribute(t,e,"title",o.store.data.l10n("go-to-profile"))}function hh(t,e,o){var r=o._11=n.insert(e,n.elem("a",Qv)),a=o._12=n.obj();n.setAttribute(r,"data-l","t,goToProfile"),vh(r,a,t),o._13=n.addEvent(r,"click",Xv,t,o);var i=o._14=n.appendChild(r,n.createComponent("msg-icon",xe,t));return n.mountComponent(i,n.propsSet(i,{icon:"user"})),Ch}function Ch(t,e){vh(e._11,e._12,t)}function kh(t){return t.props.user?hh:null}function bh(t,e){var o=t.componentView;Zv();var r=n.createInjector(o),a=n.insert(r,n.elem("div",Qv)),i=n.createInjector(a);n.setClass(a,"container-okmsg"),e._2=n.mountBlock(t,i,ph),e._g=n.mountBlock(t,i,dh),e._p=n.mountBlock(t,i,fh);var s=e._u=n.insert(i,n.createComponent("msg-parsed-text",ii,t)),u=s.componentModel.input,c=e._v=n.propsSet(s,{emojiSize:16});return gh(0,c,t),e._w=n.insert(u,n.text(t.state.text||t.store.data.l10n("empty-chat-placeholder"))),n.mountComponent(s,c),e._y=n.mountBlock(t,r,kh),th(),n.subscribeStore(t,["l10n"]),yh}function yh(t,e){var o=e._u,r=e._v;Zv(),n.updateBlock(e._2),n.updateBlock(e._g),n.updateBlock(e._p),gh(0,r,t),Jv[0]|=n.updateText(e._w,t.state.text||t.store.data.l10n("empty-chat-placeholder")),n.updateIncomingSlot(o,"",Jv[0]),n.updateComponent(o,r),n.updateBlock(e._y),th()}nh.dispose=function(t){t._5=n.unmountComponent(t._5),t._6=null},ah.dispose=function(t){t._9=n.unmountComponent(t._9),t._a=null},uh.dispose=function(t){t._d=n.unmountComponent(t._d),t._e=null},lh.dispose=function(t){t._j=n.unmountComponent(t._j)},mh.dispose=function(t){t._n=n.unmountComponent(t._n)},_h.dispose=function(t){t._s=n.unmountComponent(t._s)},hh.dispose=function(t){t._13=n.removeEvent("click",t._13),t._14=n.unmountComponent(t._14),t._12=t._11=null},bh.dispose=function(t){Zv(),t._2=n.unmountBlock(t._2),t._g=n.unmountBlock(t._g),t._p=n.unmountBlock(t._p),t._u=n.unmountComponent(t._u),t._y=n.clearBlock(t._y),th()};var Sh={__proto__:null,cssScope:Qv,default:bh,props:function(){return{size:"medium",formatting:!1,highlights:null,official:!1,user:null,channel:!1,bot:!1,admin:!1,superadmin:!1,owner:!1}},didSlotUpdate:function(t,e,n){""===e&&t.setState({text:n.textContent})},onOpenProfile:Xv};var wh="e-5ce74d";function Eh(t,e,o){var r=o._4=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"user"}))}function xh(t,e,o){e.size=o.props.size,e.url=Wt(0,o.props.user,o.props.size),e.id=n.get(o.props.user,"id"),e.caption=n.get(o.props.user,"name")||n.get(o.props.user,"names",0,"name")}function Ih(t,e,o){n.updateClass(t,e,"online-okmsg"+(o.props.inverse?" __inverse-okmsg":"")),n.updateAttribute(t,e,"data-view-type",n.get(o.props.user,"presence","on"))}function Bh(t,e,o){return Ih(o._g=n.insert(e,n.elem("span",wh)),o._h=n.obj(),t),Mh}function Mh(t,e){Ih(e._g,e._h,t)}function Ah(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"mob-online",size:"small",class:"mob-okmsg"}))}function Th(t){return"WEB"===n.get(t.props.user,"presence","on")?Bh:Ah}function jh(t,e,o){return o._d=n.mountBlock(t,e,Th),Ph}function Ph(t,e){n.updateBlock(e._d)}function Rh(t){return n.get(t.props.user,"presence","on")&&"INVISIBLE"!==n.get(t.props.user,"presence","on")&&t.props.showStatus?jh:null}function Lh(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-avatar",Hp,t)),a=o._9=n.propsSet(r);return xh(0,a,t),n.mountComponent(r,a),o._a=n.mountBlock(t,e,Rh),Oh}function Oh(t,e){var o=e._8,r=e._9;xh(0,r,t),n.updateComponent(o,r),n.updateBlock(e._a)}function zh(t){return n.get(t.props.user,"deleted")?Eh:Lh}function Dh(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,zh),Uh}function Uh(t,e){n.updateBlock(e._1)}Eh.dispose=function(t){t._4=n.unmountComponent(t._4)},Bh.dispose=function(t){t._h=t._g=null},Ah.dispose=function(t){t._k=n.unmountComponent(t._k)},jh.dispose=function(t){t._d=n.unmountBlock(t._d)},Lh.dispose=function(t){t._8=n.unmountComponent(t._8),t._a=n.unmountBlock(t._a),t._9=null},Dh.dispose=function(t){t._1=n.clearBlock(t._1)};var Nh={__proto__:null,cssScope:wh,default:Dh,props:function(){return{size:"medium",user:null,showStatus:!1,inverse:!1,masked:!1}}};function qh(t){if(!eo(t)){var e=t.props.message.link;if(e){var n=e.message;if("GROUP"===(null==n?void 0:n.type))!t.store.get().chats.has(e.chatId)&&n.sender&&$n(t,n.sender);var o=e.chatLink||e.chatId||n.sender.link,r=n.time,a=n.type,i=function(){return Zt(t,"show-toast",V("error.link.not.found"))};o?$p(o,{useBack:!0,messagesTime:r},(function(){"CHANNEL"===a||"CHANNEL_ADMIN"===a?Zt(t,"show-toast",V("chat-or-channel-unavailable")):n.sender.id?Zp(n.sender.id,{useBack:!0},i):i()})):n.sender.id&&Zp(n.sender.id,{useBack:!0})}}}var Hh="e-4r7gp7",Fh=[0,0],Vh=[];function Kh(){Vh.push(Fh),Fh=[0,0]}function Wh(){Fh=Vh.pop()}function Gh(t,e){e.link=n.get(t.props.message,"link"),e.chooseExpr="CHANNEL"==n.get(e.link,"message","type")||"CHANNEL_ADMIN"==n.get(e.link,"message","type")?0:1,e.caseExpr_1=1===e.chooseExpr,e.sender=e.caseExpr_1?n.get(e.link,"message","sender"):void 0}function Yh(t,e,o){var r=o._9=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"forward"}))}function Xh(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"forwarded-message-title",class:"label-okmsg","data-tsid":"forwarded_msg_title"}))}function Qh(t){return t.props.icon?Yh:Xh}function Jh(t,e,o,r){e.url=n.get(r.link,"chatIconUrl"),e.id=n.get(r.link,"chatId"),e.caption=n.get(r.link,"chatName")}function $h(t,e,o,r){e.official=n.get(r.link,"official")}function Zh(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-avatar",Hp,t)),a=o._m=n.propsSet(r,{class:"avatar-okmsg",size:"micro"});Jh(0,a,0,o),n.mountComponent(r,a);var i=o._n=n.insert(e,n.createComponent("msg-name",Sh,t)),s=i.componentModel.input,u=o._o=n.propsSet(i,{size:"small","data-tsid":"channel_of_forwarded_msg"});return $h(0,u,0,o),o._p=n.insert(s,n.text(n.get(o.link,"chatName"))),n.mountComponent(i,u),tC}function tC(t,e){var o=e._l,r=e._m,a=e._n,i=e._o;Jh(0,r,0,e),n.updateComponent(o,r),$h(0,i,0,e),Fh[0]|=n.updateText(e._p,n.get(e.link,"chatName")),n.updateIncomingSlot(a,"",Fh[0]),n.updateComponent(a,i)}function eC(t,e,n,o){e.user=o.sender}function nC(t,e,o,r){e.official=n.get(r.sender,"official"),e.class=n.get(r.sender,"deleted")?"__deleted-okmsg":""}function oC(t,e,o){var r=o._10=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"deleted-user"})),Fh[1]=1}function rC(t,e,o){return o._14=n.insert(e,n.text(n.get(o.sender,"name"))),Fh[1]=1,aC}function aC(t,e){Fh[1]|=n.updateText(e._14,n.get(e.sender,"name"))}function iC(t,e){return n.get(e.sender,"deleted")?oC:rC}function sC(t,e,o){var r=o._t=n.insert(e,n.createComponent("msg-user-card",Nh,t)),a=o._u=n.propsSet(r,{class:"avatar-okmsg",size:"nano",showStatus:!1});eC(0,a,0,o),n.mountComponent(r,a);var i=o._v=n.insert(e,n.createComponent("msg-name",Sh,t)),s=i.componentModel.input,u=o._w=n.propsSet(i,{size:"small","data-tsid":"author_of_forwarded_msg"});return nC(0,u,0,o),o._x=n.mountBlock(t,s,iC),n.mountComponent(i,u),uC}function uC(t,e){var o=e._t,r=e._u,a=e._v,i=e._w;eC(0,r,0,e),n.updateComponent(o,r),nC(0,i,0,e),n.updateBlock(e._x),n.updateIncomingSlot(a,"",Fh[1]),n.updateComponent(a,i)}function cC(t,e){return[Zh,sC][e.chooseExpr]}function pC(t,e){var o=t.componentView;Kh();var r=n.createInjector(o);Gh(t,e),e._6=n.mountBlock(t,r,Qh);var a=n.insert(r,n.elem("div",Hh)),i=n.createInjector(a);return n.setClass(a,"author-okmsg"),e._h=n.addEvent(a,"click",qh,t,e),e._i=n.mountBlock(t,i,cC),Wh(),lC}function lC(t,e){Kh(),Gh(t,e),n.updateBlock(e._6),n.updateBlock(e._i),Wh()}Yh.dispose=function(t){t._9=n.unmountComponent(t._9)},Xh.dispose=function(t){t._d=n.unmountComponent(t._d)},Zh.dispose=function(t){t._l=n.unmountComponent(t._l),t._n=n.unmountComponent(t._n),t._m=t._o=t._p=null},oC.dispose=function(t){t._10=n.unmountComponent(t._10),Fh[1]=1},rC.dispose=function(t){t._14=null,Fh[1]=1},sC.dispose=function(t){t._t=n.unmountComponent(t._t),t._x=n.unmountBlock(t._x),t._v=n.unmountComponent(t._v),t._u=t._w=null},pC.dispose=function(t){Kh(),t._6=n.clearBlock(t._6),t._h=n.removeEvent("click",t._h),t._i=n.unmountBlock(t._i),Wh()};var mC={__proto__:null,cssScope:Hh,default:pC,onOpenSender:qh},dC="ep288gn";function _C(t,e,o){n.updateAttribute(t,e,"data-blockid",o.props.blockId||"tt_"+Date.now()),n.updateAttribute(t,e,"data-url","/dk?cmd=ShortcutMenu&t="+("GROUP"===n.get(o.props.user,"type")?"AltGroupControlMenu":"UserMenu")+"&id="+n.get(o.props.user,"id")+"&st.cmd=userMain")}function fC(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",dC)),e._2=n.mountSlot(t,"");var r=e._3=n.appendChild(o,n.elem("span",dC));n.setRef(t,"hook",r);var a=e._4=n.obj();return n.setAttribute(r,"data-nocache","1"),n.setAttribute(r,"data-position","auto"),n.setAttribute(r,"data-hideonscroll","1"),n.setClass(r,"h-mod-okmsg sc-menu_w-okmsg"),n.setAttribute(r,"data-module","ShortcutMenu"),_C(r,a,t),gC}function gC(t,e){_C(e._3,e._4,t)}fC.dispose=function(t){t._2=n.unmountSlot(t._2)};var vC={__proto__:null,cssScope:dC,default:fC,didMount:function(e){e.store.get().isMobile||new Promise((function(e,n){t(["OK/ShortcutMenu"],e,n)})).then((function(t){var n=t.default||t;null!==e.sm&&n&&(e.sm=new n("tt_sm"),e.sm.activate(e.refs.hook))}))},willUnmount:function(t){t.sm&&t.sm.deactivate(),t.sm=null},createShortcutMenuOnElement:Rr,removeShortcutMenuFromElement:Lr};function hC(t,e){var n=t.props.message;if(Yv(e)&&n.sender&&!n.sender.deleted&&!eo(t.refs.name)){var o=t.props.message;"GROUP"===o.type?$n(t,o.sender):Zp(o.sender.id,{useBack:!0})}}var CC="e-fcdmmv",kC=[0],bC=[];function yC(){bC.push(kC),kC=[0]}function SC(){kC=bC.pop()}function wC(t,e){e.sender=n.get(t.props.message,"sender"),e.ifExpr=!t.props.dialog&&t.props.dyed}function EC(t,e,o,r){n.updateClass(t,e,"author-okmsg"+(o.props.inChat?" __msg-color-"+o.state.colorIndex:"")+(r.ifExpr?" __msg-color-"+o.state.dye:"")),n.updateAttribute(t,e,"href","GROUP"===n.get(r.sender,"type")?n.get(r.sender,"profileUrl")||"/group/"+n.get(r.sender,"id"):"/messages/"+n.get(r.sender,"id"))}function xC(t,e){!n.get(e.sender,"deleted")&&t.props.clickable&&n.setPendingEvent(e._5,"click",hC,e)}function IC(t,e,o,r){e.user=r.sender,e.blockId=n.get(o.props.message,"id")}function BC(t,e,o,r){e.official=o.props.pinned&&n.get(r.sender,"official"),e.class=n.get(r.sender,"deleted")?"__deleted-okmsg":""}function MC(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"you"})),kC[0]=1}function AC(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"deleted-user"})),kC[0]=1}function TC(t,e,o){return o._p=n.insert(e,n.text(n.get(o.sender,"name"))),kC[0]=1,jC}function jC(t,e){kC[0]|=n.updateText(e._p,n.get(e.sender,"name"))}function PC(t,e){return t.props.isMine?MC:n.get(e.sender,"deleted")?AC:TC}function RC(t,e){var o=t.componentView;yC(),wC(t,e);var r=e._4=n.appendChild(o,n.elem("a",CC)),a=n.createInjector(r),i=e._5=n.pendingEvents(t,r),s=e._6=n.obj();n.setAttribute(r,"tabindex","-1"),n.setAttribute(r,"data-tsid","author_of_message_not_me"),EC(r,s,t,e),xC(t,e);var u=e._9=n.insert(a,n.createComponent("msg-sc-menu",vC,t)),c=u.componentModel.input,p=e._a=n.propsSet(u);IC(0,p,t,e);var l=n.insert(c,n.elemWithText("span","От: ",CC),"");n.setClass(l,"visually-hidden-okmsg");var m=e._c=n.insert(c,n.createComponent("msg-name",Sh,t),""),d=m.componentModel.input,_=e._d=n.propsSet(m,{size:"small"});return BC(0,_,t,e),e._e=n.mountBlock(t,d,PC),n.mountComponent(m,_),n.mountComponent(u,p),n.finalizePendingEvents(i),SC(),LC}function LC(t,e){var o=e._9,r=e._a,a=e._c,i=e._d;yC(),wC(t,e),EC(e._4,e._6,t,e),xC(t,e),IC(0,r,t,e),BC(0,i,t,e),n.updateBlock(e._e),n.updateIncomingSlot(a,"",kC[0]),n.updateComponent(a,i),n.updateComponent(o,r),n.finalizePendingEvents(e._5),SC()}MC.dispose=function(t){t._h=n.unmountComponent(t._h),kC[0]=1},AC.dispose=function(t){t._l=n.unmountComponent(t._l),kC[0]=1},TC.dispose=function(t){t._p=null,kC[0]=1},RC.dispose=function(t){yC(),t._5=n.detachPendingEvents(t._5),t._e=n.unmountBlock(t._e),t._c=n.unmountComponent(t._c),t._9=n.unmountComponent(t._9),SC()};var OC={__proto__:null,cssScope:CC,default:RC,onOpenDialog:hC,didChange:function(t,e){var n=e.message;if(n){var o=n.current;(null==o?void 0:o.sender)&&t.props.dyed&&t.setState({dye:Sp(o.sender.id)})}}};var zC=[0],DC=[];function UC(){DC.push(zC),zC=[0]}function NC(){zC=DC.pop()}function qC(t,e){e.hasFwd="FORWARD"==n.get(t.props.message,"link","type"),e.msg=e.hasFwd?n.get(t.props.message,"link","message"):t.props.message,e.msgElements=e.hasFwd?n.get(t.props.message,"link","message","elements"):n.get(t.props.message,"elements"),e.attachments=n.filter(n.get(e.msg,"attaches"),(function(t){return"INLINE_KEYBOARD"!==n.get(t,"_type")&&"SEND_ACTION"!==n.get(t,"_type")&&!("DAILY_MEDIA"===n.get(t,"_type")&&n.get(t,"replyOrigin"))})),e.dailyMediaReply=n.find(n.get(e.msg,"attaches"),(function(t){return"DAILY_MEDIA"===n.get(t,"_type")&&n.get(t,"replyOrigin")})),e.attachment=n.get(e.attachments,0),e.sticker="STICKER"===n.get(e.attachment,"_type"),e.media=n.filter(e.attachments,(function(t){return"PHOTO"===n.get(t,"_type")||"VIDEO"===n.get(t,"_type")})),e.clickable=void 0,e.ifExpr=Tt(0,e.media)>1}function HC(t,e,n,o){e.message=n.props.message,e.clickable=o.clickable,e.class=Tt(0,o.media)||o.sticker?"__media-okmsg":""}function FC(t,e,n){e.message=n.props.message}function VC(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-message-forward",mC,t)),a=o._i=n.propsSet(r);return FC(0,a,t),n.mountComponent(r,a),KC}function KC(t,e){var o=e._h,r=e._i;FC(0,r,t),n.updateComponent(o,r)}function WC(t,e){return e.hasFwd?VC:null}function GC(t,e,o,r){e["data-ref"]=n.get(r.msg,"id")||"",e.highlights=o.props.highlights,e.messageElements=n.filter(r.msgElements,(function(t){return"USER_MENTION"!==n.get(t,"type")}))}function YC(t,e,o){var r=o._n=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input,i=o._o=n.propsSet(r,{allowLargeEmoji:0,disableLinks:!0,disableMentioning:!0,largeWithText:!1,"data-tsid":"replied_text"});return GC(0,i,t,o),o._p=n.insert(a,n.text(n.get(o.msg,"text"))),n.mountComponent(r,i),XC}function XC(t,e){var o=e._n,r=e._o;GC(0,r,t,e),zC[0]|=n.updateText(e._p,n.get(e.msg,"text")),n.updateIncomingSlot(o,"",zC[0]),n.updateComponent(o,r)}function QC(t,e){return n.get(e.msg,"text")?YC:null}function JC(t,e,n,o){e.message=o.msg,e.attachment=o.attachment||o.dailyMediaReply,e.class=(o.ifExpr?"__more-okmsg":"")+(Tt(0,o.media)?" __media-okmsg":""),e["data-remaining"]=o.ifExpr?"+"+(Tt(0,o.media)-1):void 0}function $C(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-attach",Wv,t)),a=o._v=n.propsSet(r,{"data-tsid":"replied_attachment",offset:!0,compact:!0});return JC(0,a,0,o),n.mountComponent(r,a),ZC}function ZC(t,e){var o=e._u,r=e._v;JC(0,r,0,e),n.updateComponent(o,r)}function tk(t,e){return n.get(e.msg,"text")||!e.attachment&&!e.dailyMediaReply?null:$C}function ek(t,e){var o=t.componentView;UC();var r=n.createInjector(o);qC(t,e);var a=e._c=n.insert(r,n.createComponent("msg-message-header",OC,t));n.setRef(t,"header",a);var i=e._d=n.propsSet(a);return HC(0,i,t,e),n.mountComponent(a,i),e._e=n.mountBlock(t,r,WC),e._k=n.mountBlock(t,r,QC),e._r=n.mountBlock(t,r,tk),NC(),nk}function nk(t,e){var o=e._c,r=e._d;UC(),qC(t,e),HC(0,r,t,e),n.updateComponent(o,r),n.updateBlock(e._e),n.updateBlock(e._k),n.updateBlock(e._r),NC()}VC.dispose=function(t){t._h=n.unmountComponent(t._h),t._i=null},YC.dispose=function(t){t._n=n.unmountComponent(t._n),t._o=t._p=null},$C.dispose=function(t){t._u=n.unmountComponent(t._u),t._v=null},ek.dispose=function(t){UC(),t._c=n.unmountComponent(t._c),t._e=n.clearBlock(t._e),t._k=n.clearBlock(t._k),t._r=n.clearBlock(t._r),NC()};var ok={__proto__:null,cssScope:"e-oz3h1u",default:ek,props:function(){return{message:null,highlights:[]}}};function rk(t,e){e.type=n.get(t.props.typings,0,"type")}function ak(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"recording-audio-in-dialog"}))}function ik(t,e,o){var r=o._a=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"sending-photo-in-dialog"}))}function sk(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"sending-video-in-dialog"}))}function uk(t,e,o){var r=o._i=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"sending-file-in-dialog"}))}function ck(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"searching-sticker-in-dialog"}))}function pk(t,e,o){var r=o._q=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"typing-in-dialog"}))}function lk(t,e){return"AUDIO"==e.type?ak:"PHOTO"==e.type?ik:"VIDEO"==e.type?sk:"FILE"==e.type?uk:"STICKER"==e.type?ck:pk}function mk(t,e){var o=t.componentView,r=n.createInjector(o);return rk(t,e),e._3=n.mountBlock(t,r,lk),dk}function dk(t,e){rk(t,e),n.updateBlock(e._3)}ak.dispose=function(t){t._6=n.unmountComponent(t._6)},ik.dispose=function(t){t._a=n.unmountComponent(t._a)},sk.dispose=function(t){t._e=n.unmountComponent(t._e)},uk.dispose=function(t){t._i=n.unmountComponent(t._i)},ck.dispose=function(t){t._m=n.unmountComponent(t._m)},pk.dispose=function(t){t._q=n.unmountComponent(t._q)},mk.dispose=function(t){t._3=n.clearBlock(t._3)};var _k={__proto__:null,cssScope:"e-4o8oks",default:mk,props:function(){return{typings:[]}}};function fk(t,e){e.count=Tt(0,t.props.typings),e.value=void 0}function gk(t){return t.props.typings}function vk(t,e){return n.get(e.value,"user","id")}function hk(t,e,o){return o._b=n.insert(e,n.text(", ")),Ck}function Ck(t,e){n.updateText(e._b,", ")}function kk(t,e){return e.index<e.count-1?hk:null}function bk(t,e,o){return o._7=n.insert(e,n.text(n.get(o.value,"user","name"))),o._8=n.mountBlock(t,e,kk),yk}function yk(t,e){n.updateText(e._7,n.get(e.value,"user","name")),n.updateBlock(e._8)}function Sk(t,e){var o=t.componentView,r=n.createInjector(o);return fk(t,e),e._4=n.mountKeyIterator(t,r,gk,vk,bk),wk}function wk(t,e){fk(t,e),n.updateKeyIterator(e._4)}hk.dispose=function(t){t._b=null},bk.dispose=function(t){t._8=n.unmountBlock(t._8),t._7=null},Sk.dispose=function(t){t._4=n.clearKeyIterator(t._4)};var Ek={__proto__:null,cssScope:"e-rw67gc",default:Sk,props:function(){return{typings:[]}}},xk="e9tqwz5";function Ik(t,e,n){e.typings=n.props.users}function Bk(t,e,o){var r=o._a=n.insert(e,n.createComponent("msg-dialog-typing-label",_k,t),""),a=o._b=n.propsSet(r);return Ik(0,a,t),n.mountComponent(r,a),Mk}function Mk(t,e){var o=e._a,r=e._b;Ik(0,r,t),n.updateComponent(o,r)}function Ak(t,e,n){e.typings=n.props.users}function Tk(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-chat-typing-label",Ek,t),""),a=o._f=n.propsSet(r);return Ak(0,a,t),n.mountComponent(r,a),jk}function jk(t,e){var o=e._e,r=e._f;Ak(0,r,t),n.updateComponent(o,r)}function Pk(t){return"DIALOG"===t.props.type?Bk:"CHAT"===t.props.type?Tk:null}function Rk(t,e,o){return o._7=n.mountBlock(t,e,Pk),Lk}function Lk(t,e){n.updateBlock(e._7)}function Ok(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("i",xk));n.setClass(r,"dot-okmsg");var a=n.appendChild(o,n.elem("i",xk));n.setClass(a,"dot-okmsg");var i=n.appendChild(o,n.elem("i",xk));return n.setClass(i,"dot-okmsg"),n.appendChild(o,n.createSlot(t,"",xk)),e._g=n.mountSlot(t,"",Rk),zk}function zk(t,e){n.updateDefaultSlot(e._g)}Bk.dispose=function(t){t._a=n.unmountComponent(t._a),t._b=null},Tk.dispose=function(t){t._e=n.unmountComponent(t._e),t._f=null},Rk.dispose=function(t){t._7=n.unmountBlock(t._7)},Ok.dispose=function(t){t._g=n.unmountSlot(t._g)};var Dk={__proto__:null,cssScope:xk,default:Ok},Uk="er9iij1";function Nk(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("div",Uk));n.setClass(r,"main-okmsg"),n.appendChild(r,n.createSlot(t,"",Uk)),e._3=n.mountSlot(t,"");var a=n.appendChild(o,n.elem("div",Uk));n.setClass(a,"controls-okmsg"),n.setAttribute(a,"role","toolbar"),n.appendChild(a,n.createSlot(t,"controls",Uk)),e._6=n.mountSlot(t,"controls")}Nk.dispose=function(t){t._3=n.unmountSlot(t._3),t._6=n.unmountSlot(t._6)};var qk={__proto__:null,cssScope:Uk,default:Nk};var Hk="e6lo1tr";function Fk(t,e){n.insert(e,n.text("Chat title"),"title")}function Vk(t,e,o){n.insert(e,n.createSlot(t,"favorite",Hk)),o._e=n.mountSlot(t,"favorite")}function Kk(t){return t.props.favorite?Vk:null}function Wk(t,e,o){n.updateClass(t,e,"message-okmsg"+(o.props.double?" __shift-okmsg":""))}function Gk(t,e,o){var r=n.insert(e,n.elem("div",Hk));n.setClass(r,"text-okmsg");var a=n.appendChild(r,n.createSlot(t,"",Hk));n.setClass(a,"text-okmsg"),o._n=n.mountSlot(t,"")}function Yk(t){return t.props.compact?null:Gk}function Xk(t,e,o){n.insert(e,n.createSlot(t,"badge",Hk)),o._t=n.mountSlot(t,"badge")}function Qk(t){return t.props.badge?Xk:null}function Jk(t,e,o){n.insert(e,n.createSlot(t,"image-subj",Hk)),o._y=n.mountSlot(t,"image-subj")}function $k(t){return t.props.double?Jk:null}function Zk(t,e){var o=t.componentView,r=n.createInjector(o);n.insert(r,n.createSlot(t,"image",Hk)),e._2=n.mountSlot(t,"image");var a=n.insert(r,n.elem("div",Hk));n.setClass(a,"content-okmsg");var i=n.appendChild(a,n.elem("div",Hk)),s=n.createInjector(i);n.setClass(i,"title-okmsg"),n.insert(s,n.createSlot(t,"title",Hk)),e._9=n.mountSlot(t,"title",Fk),e._a=n.mountBlock(t,s,Kk);var u=e._g=n.appendChild(a,n.elem("div",Hk)),c=n.createInjector(u);return Wk(u,e._h=n.obj(),t),e._i=n.mountBlock(t,c,Yk),e._p=n.mountBlock(t,c,Qk),e._u=n.mountBlock(t,r,$k),tb}function tb(t,e){n.updateDefaultSlot(e._9),n.updateBlock(e._a),Wk(e._g,e._h,t),n.updateBlock(e._i),n.updateBlock(e._p),n.updateBlock(e._u)}Vk.dispose=function(t){t._e=n.unmountSlot(t._e)},Gk.dispose=function(t){t._n=n.unmountSlot(t._n)},Xk.dispose=function(t){t._t=n.unmountSlot(t._t)},Jk.dispose=function(t){t._y=n.unmountSlot(t._y)},Zk.dispose=function(t){t._2=n.unmountSlot(t._2),t._9=n.unmountSlot(t._9),t._a=n.unmountBlock(t._a),t._i=n.unmountBlock(t._i),t._p=n.unmountBlock(t._p),t._u=n.clearBlock(t._u)};var eb={__proto__:null,cssScope:Hk,default:Zk,props:function(){return{size:"medium",foldable:!1,compact:!1,double:!1,favorite:!1,badge:!1}}};var nb="ee2kydj";function ob(t,e){e.chooseExpr="DIALOG"==n.get(t.props.chat,"type")?0:1,e.caseExpr=0===e.chooseExpr,e.participant=e.caseExpr?n.find(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})):void 0}function rb(t,e,o,r){e.user=n.get(r.participant,"user"),e.size=o.props.size,e.showStatus=o.props.showStatus,e.masked=o.props.masked}function ab(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-user-card",Nh,t)),a=o._9=n.propsSet(r);return rb(0,a,t,o),n.mountComponent(r,a),ib}function ib(t,e){var o=e._8,r=e._9;rb(0,r,t,e),n.updateComponent(o,r)}function sb(t,e,o){e.url=Gt(0,o.props.chat,o.props.size),e.id=n.get(o.props.chat,"id"),e.caption=n.get(o.props.chat,"title")||n.get(o.props.chat,"placeholder"),e.size=o.props.size}function ub(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-avatar",Hp,t)),a=o._d=n.propsSet(r);return sb(0,a,t),n.mountComponent(r,a),cb}function cb(t,e){var o=e._c,r=e._d;sb(0,r,t),n.updateComponent(o,r)}function pb(t,e){return[ab,ub][e.chooseExpr]}function lb(t,e){var o=t.componentView,r=n.createInjector(o);return ob(t,e),e._5=n.mountBlock(t,r,pb),n.insert(r,n.createSlot(t,"",nb)),e._g=n.mountSlot(t,""),mb}function mb(t,e){ob(t,e),n.updateBlock(e._5)}ab.dispose=function(t){t._8=n.unmountComponent(t._8),t._9=null},ub.dispose=function(t){t._c=n.unmountComponent(t._c),t._d=null},lb.dispose=function(t){t._5=n.clearBlock(t._5),t._g=n.unmountSlot(t._g)};var db={__proto__:null,cssScope:nb,default:lb,props:function(){return{chat:null,size:"medium",showStatus:!0,masked:!1}}};function _b(t,e){var n=t.store.get().config,o=t.props.user,r=t.state.chatLink;n.server["chat-title-click"]&&(o||r)&&(e.stopPropagation(),o?Zt(t,"view-profile",{userId:o.id,profileUrl:o.profileUrl}):r&&Zt(t,"navigate-url",{url:r}))}var fb="ef53cxx",gb=[0],vb=[];function hb(){vb.push(gb),gb=[0]}function Cb(){gb=vb.pop()}function kb(t,e,n){e.official=n.props.official,e.channel=n.props.channel,e.bot=n.props.bot,e.user=n.props.user}function bb(t,e,o){n.updateAttribute(t,e,"href",o.state.chatLink)}function yb(t,e){e.stopPropagation()}function Sb(t,e,o){var r=o._a=n.insert(e,n.elem("a",fb)),a=o._b=n.obj();n.setAttribute(r,"target","_blank"),n.setClass(r,"link-okmsg"),n.setAttribute(r,"data-l","t,chatLink"),bb(r,a,t),o._c=n.addEvent(r,"click",yb,t,o);var i=o._d=n.appendChild(r,n.createComponent("msg-icon",xe,t));return n.mountComponent(i,n.propsSet(i,{icon:"link",size:"medium"})),wb}function wb(t,e){bb(e._a,e._b,t)}function Eb(t){return t.state.chatLink?Sb:null}function xb(t,e){var o=t.componentView;hb();var r=n.appendChild(o,n.elem("h1",fb)),a=n.createInjector(r);n.setAttribute(r,"id","msg-chat-title"),n.setAttribute(r,"data-tsid","chat_title"),e._2=n.addEvent(r,"click",_b,t,e);var i=e._3=n.insert(a,n.createComponent("msg-name",Sh,t)),s=i.componentModel.input,u=e._4=n.propsSet(i,{emojiContext:"chat-title"});return kb(0,u,t),e._5=n.insert(s,n.text(t.state.text)),n.mountComponent(i,u),e._7=n.mountBlock(t,a,Eb),Cb(),Ib}function Ib(t,e){var o=e._3,r=e._4;hb(),kb(0,r,t),gb[0]|=n.updateText(e._5,t.state.text),n.updateIncomingSlot(o,"",gb[0]),n.updateComponent(o,r),n.updateBlock(e._7),Cb()}Sb.dispose=function(t){t._c=n.removeEvent("click",t._c),t._d=n.unmountComponent(t._d),t._b=t._a=null},xb.dispose=function(t){hb(),t._2=n.removeEvent("click",t._2),t._3=n.unmountComponent(t._3),t._7=n.unmountBlock(t._7),Cb()};var Bb={__proto__:null,cssScope:fb,default:xb,didSlotUpdate:function(t,e,o){if(""===e){var r="",a=o.textContent,i=n.parse$1(a||"",{link:!0}).find((function(t){return t.type===n.TokenType.Link}));(null==i?void 0:i.type)===n.TokenType.Link&&(r=i.link),t.setState({text:a,chatLink:r})}},onClick:_b},Mb=function(t,e){this._elems=[],this._timer=null,this.updateInterval=e||3e4,this.updateFn=t,this._update=this._update.bind(this,this._update)};Mb.prototype.add=function(t){this._elems.push(t),this._startTimer()},Mb.prototype.remove=function(t){var e=this._elems.indexOf(t);-1!==e&&this._elems.splice(e,1),this._elems.length||(clearTimeout(this._timer),this._timer=null)},Mb.prototype._startTimer=function(){!this._timer&&this._elems.length&&(this._timer=setTimeout(this._update,this.updateInterval))},Mb.prototype._update=function(){var t=this,e=Date.now();this._timer=null,this._elems.forEach((function(n){return t.updateFn(n,e)})),this._startTimer()};var Ab=6e4,Tb=60*Ab,jb=55*Ab,Pb=Tb+15*Ab,Rb=Tb+40*Ab,Lb=4*Tb;function Ob(t,e){void 0===e&&(e=Date.now());var n=[V("date-month-january"),V("date-month-february"),V("date-month-march"),V("date-month-april"),V("date-month-may"),V("date-month-june"),V("date-month-july"),V("date-month-august"),V("date-month-september"),V("date-month-october"),V("date-month-november"),V("date-month-december")];t=zb(t);var o=(e=zb(e))-t;if(o<jb){var r=Math.ceil(o/Ab);return 1===r||0===r?V("date-label-minute-ago"):V("date-label-minutes-ago",{num:r,numPlural:r})}if(o<Pb)return V("date-label-hour-ago");if(o<Rb)return V("date-label-hour-and-half-ago");if(o<Lb){var a=Math.ceil(o/Tb);return V("date-label-hours-ago",{num:a,numPlural:a})}var i=new Date(t),s=new Date(e),u=V("at")+" "+Db(i.getHours())+":"+Db(i.getMinutes());if(!Ub(i,s))if(function(t,e){var n=new Date(e);return n.setDate(n.getDate()-1),Ub(t,n)}(i,s))u=V("date-yesterday")+" "+u;else{var c=i.getFullYear()===s.getFullYear(),p=c?"":" "+i.getFullYear();u=i.getDate()+" "+n[i.getMonth()]+p+" "+(c?u:"")}return u}function zb(t){return t instanceof Date?t.getTime():Number(t)}function Db(t){return t<10?"0"+t:String(t)}function Ub(t,e){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}var Nb=new Mb(qb);function qb(t,e){void 0===e&&(e=Date.now());var n=t.props.date;t.setState({value:n?Ob(n,e):""})}var Hb="e9wzhkl";function Fb(t,e,o){n.updateAttribute(t,e,"title",o.state.value)}function Vb(t,e){Fb(e._1,e._2,t),n.updateText(e._3,t.state.value)}var Kb={__proto__:null,cssScope:Hb,default:function(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("span",Hb));return Fb(r,e._2=n.obj(),t),e._3=n.appendChild(r,n.text(t.state.value)),Vb},props:function(){return{date:null}},willMount:function(t){Nb.add(t),qb(t)},willUnmount:function(t){Nb.remove(t)},didChange:function(t,e){e.date&&qb(t)}};function Wb(t,e,o){var r=o._4=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"was-online-recently"}))}function Gb(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"online"}))}function Yb(t,e,o){e["data-gender"]=n.get(o.props.user,"gender")}function Xb(t,e,o){e.date=1e3*n.get(o.props.user,"presence","seen")}function Qb(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-relative-date",Kb,t)),a=o._k=n.propsSet(r);return Xb(0,a,t),n.mountComponent(r,a),Jb}function Jb(t,e){var o=e._j,r=e._k;Xb(0,r,t),n.updateComponent(o,r)}function $b(t,e,o){var r=o._n=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"was-online-recently"}))}function Zb(t){return n.get(t.props.user,"presence","seen")>0&&1e3*n.get(t.props.user,"presence","seen")<=Date.now()?Qb:$b}function ty(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._d=n.propsSet(r,{key:"was-online"});return Yb(0,a,t),n.mountComponent(r,a),n.insert(e,n.text(" ")),o._f=n.insert(e,n.text(" ")),o._g=n.mountBlock(t,e,Zb),ey}function ey(t,e){var o=e._c,r=e._d;Yb(0,r,t),n.updateComponent(o,r),n.updateText(e._f," "),n.updateBlock(e._g)}function ny(t){return"INVISIBLE"===n.get(t.props.user,"presence","on")?Wb:n.get(t.props.user,"presence","on")||n.get(t.props.user,"current")?Gb:ty}function oy(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,ny),ry}function ry(t,e){n.updateBlock(e._1)}Wb.dispose=function(t){t._4=n.unmountComponent(t._4)},Gb.dispose=function(t){t._8=n.unmountComponent(t._8)},Qb.dispose=function(t){t._j=n.unmountComponent(t._j),t._k=null},$b.dispose=function(t){t._n=n.unmountComponent(t._n)},ty.dispose=function(t){t._c=n.unmountComponent(t._c),t._g=n.unmountBlock(t._g),t._d=t._f=null},oy.dispose=function(t){t._1=n.clearBlock(t._1)};var ay={__proto__:null,cssScope:"e-cxog8l",default:oy,props:function(){return{user:null}}};function iy(t,e){e.total=Tt(0,n.get(t.props.chat,"participants")),e.online=n.filter(n.get(t.props.chat,"participants"),(function(t){return n.get(t,"user","presence","on")||n.get(t,"user","current")})),e.chooseExpr="DIALOG"==n.get(t.props.chat,"type")?0:"CHANNEL"==n.get(t.props.chat,"type")||n.get(t.props.chat,"participantsCount")>e.total||!n.find(n.get(t.props.chat,"participants"),(function(t){return n.get(t,"user","current")}))?1:1===e.total?2:e.total===Tt(0,e.online)?3:4,e.caseExpr=0===e.chooseExpr}function sy(t,e,o){e.user=n.get(n.find(n.get(o.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})),"user")}function uy(t,e,o){var r=o._9=n.insert(e,n.createComponent("msg-online-label",ay,t)),a=o._a=n.propsSet(r);return sy(0,a,t),n.mountComponent(r,a),cy}function cy(t,e){var o=e._9,r=e._a;sy(0,r,t),n.updateComponent(o,r)}function py(t,e,o){e.key="CHANNEL"!==n.get(o.props.chat,"type")?"participants-count":"subscribers-count",e["data-count"]=n.get(o.props.chat,"participantsCount"),e["data-countPlural"]=n.get(o.props.chat,"participantsCount")}function ly(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._h=n.propsSet(r);return py(0,a,t),n.mountComponent(r,a),my}function my(t,e){var o=e._g,r=e._h;py(0,r,t),n.updateComponent(o,r)}function dy(t){return n.get(t.props.chat,"participantsCount")?ly:null}function _y(t,e,o){return o._d=n.mountBlock(t,e,dy),fy}function fy(t,e){n.updateBlock(e._d)}function gy(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"empty-chat-participants-label"}))}function vy(t,e,n,o){e["data-count"]=o.total}function hy(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._p=n.propsSet(r,{key:"participants-count-online-all"});return vy(0,a,0,o),n.mountComponent(r,a),Cy}function Cy(t,e){var o=e._o,r=e._p;vy(0,r,0,e),n.updateComponent(o,r)}function ky(t,e,n,o){e["data-count"]=o.total,e["data-countPlural"]=o.total,e["data-online"]=Tt(0,o.online)}function by(t,e,o){var r=o._s=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._t=n.propsSet(r,{key:"participants-count-online"});return ky(0,a,0,o),n.mountComponent(r,a),yy}function yy(t,e){var o=e._s,r=e._t;ky(0,r,0,e),n.updateComponent(o,r)}function Sy(t,e){return[uy,_y,gy,hy,by][e.chooseExpr]}function wy(t,e){var o=t.componentView,r=n.createInjector(o);return iy(t,e),e._6=n.mountBlock(t,r,Sy),Ey}function Ey(t,e){iy(t,e),n.updateBlock(e._6)}uy.dispose=function(t){t._9=n.unmountComponent(t._9),t._a=null},ly.dispose=function(t){t._g=n.unmountComponent(t._g),t._h=null},_y.dispose=function(t){t._d=n.unmountBlock(t._d)},gy.dispose=function(t){t._k=n.unmountComponent(t._k)},hy.dispose=function(t){t._o=n.unmountComponent(t._o),t._p=null},by.dispose=function(t){t._s=n.unmountComponent(t._s),t._t=null},wy.dispose=function(t){t._6=n.clearBlock(t._6)};var xy={__proto__:null,cssScope:"e-69veep",default:wy,props:function(){return{chat:null}}},Iy=new Mb(By,5e3);function By(t){var e=c(t.props.chat);t.state.canDisturb!==e&&(t.setState({canDisturb:e}),Zt(t,"chat-alerts-updated"))}var My="e-ytyvop";function Ay(t,e,o){n.insert(e,n.createSlot(t,"on",My)),o._5=n.mountSlot(t,"on")}function Ty(t,e,o){n.insert(e,n.createSlot(t,"off",My)),o._9=n.mountSlot(t,"off")}function jy(t){return t.state.canDisturb?Ay:Ty}function Py(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,jy),Ry}function Ry(t,e){n.updateBlock(e._1)}Ay.dispose=function(t){t._5=n.unmountSlot(t._5)},Ty.dispose=function(t){t._9=n.unmountSlot(t._9)},Py.dispose=function(t){t._1=n.clearBlock(t._1)};var Ly={__proto__:null,cssScope:My,default:Py,props:function(){return{chat:null}},didChange:function(t,e){e.chat&&By(t)},willMount:function(t){Iy.add(t)},willUnmount:function(t){Iy.remove(t)}};function Oy(t){var e=t.props.chat;if(e.settings){var n=0!==e.settings.dontDisturbUntil?0:-1;Zt(t,"show-toast",V("alerts")+" "+V(n?"alerts-disabled":"alerts-enabled")),Zt(t,"update-chat-settings",{chatId:e.id,settings:{dontDisturbUntil:n}})}}var zy="e-d95f6l";function Dy(t,e){e.inParticipants=n.find(n.get(t.props.chat,"participants"),(function(t){return n.get(t,"user","current")}))}function Uy(t){Zt(t,"leave-chat",{chatId:n.get(t.props.chat,"id")})}function Ny(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function qy(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._8=n.addEvent(r,"click",Uy,t,o);var i=o._9=n.insert(a,n.createComponent("msg-tico",rc,t),""),s=i.componentModel.input,u=o._b=n.insert(s,n.createComponent("msg-l10n",ae,t),""),c=o._c=n.propsSet(u,{key:"leave-chat"});return Ny(0,c,t),n.mountComponent(u,c),n.mountComponent(i,n.propsSet(i,{icon:"leave",size:"medium"})),n.mountComponent(r,n.propsSet(r,{class:"__wide-okmsg"})),Hy}function Hy(t,e){var o=e._b,r=e._c;Ny(0,r,t),n.updateComponent(o,r)}function Fy(t){Zt(t,"forward-init",{type:"CHANNEL"})}function Vy(t,e,n){e.chat=n.props.chat}function Ky(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._j=n.addEvent(r,"click",Fy,t,o);var i=o._k=n.insert(a,n.createComponent("msg-tico",rc,t),""),s=i.componentModel.input,u=o._m=n.insert(s,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(u,n.propsSet(u,{key:"share-channel-link"})),n.mountComponent(i,n.propsSet(i,{icon:"channel",size:"medium"})),n.mountComponent(r,n.propsSet(r,{class:"__wide-okmsg"}));var c=o._q=n.insert(e,n.createComponent("msg-button",fe,t)),p=c.componentModel.input;o._s=n.addEvent(c,"click",Oy,t,o);var l=o._t=n.insert(p,n.createComponent("msg-chat-alerts",Ly,t),""),m=l.componentModel.input,d=o._u=n.propsSet(l);Vy(0,d,t);var _=o._v=n.insert(m,n.createComponent("msg-icon",xe,t),"on");n.mountComponent(_,n.propsSet(_,{icon:"alert-on",size:"medium",slot:"on"}));var f=o._x=n.insert(m,n.createComponent("msg-icon",xe,t),"off");return n.mountComponent(f,n.propsSet(f,{icon:"alert-off",size:"medium",slot:"off"})),n.mountComponent(l,d),n.mountComponent(c,n.propsSet(c,{shape:"circle",class:"secondary-okmsg __alerts-okmsg"})),Wy}function Wy(t,e){var o=e._t,r=e._u;Vy(0,r,t),n.updateComponent(o,r)}function Gy(t){Zt(t,"remove-chat",{chatId:n.get(t.props.chat,"id")})}function Yy(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function Xy(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._15=n.addEvent(r,"click",Gy,t,o);var i=o._16=n.insert(a,n.createComponent("msg-tico",rc,t),""),s=i.componentModel.input,u=o._18=n.insert(s,n.createComponent("msg-l10n",ae,t),""),c=o._19=n.propsSet(u,{key:"remove-chat"});return Yy(0,c,t),n.mountComponent(u,c),n.mountComponent(i,n.propsSet(i,{icon:"leave",size:"medium"})),n.mountComponent(r,n.propsSet(r,{class:"__wide-okmsg"})),Qy}function Qy(t,e){var o=e._18,r=e._19;Yy(0,r,t),n.updateComponent(o,r)}function Jy(t){Zt(t,"join-chat",n.get(t.props.chat,"link"))}function $y(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function Zy(t,e,o){var r=n.insert(e,n.elem("span",zy));n.setClass(r,"subscribe-okmsg");var a=o._1f=n.appendChild(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input;o._1h=n.addEvent(a,"click",Jy,t,o);var s=o._1i=n.insert(i,n.createComponent("msg-l10n",ae,t),""),u=o._1j=n.propsSet(s,{key:"join-chat"});return $y(0,u,t),n.mountComponent(s,u),n.mountComponent(a,n.propsSet(a,{class:"primary-okmsg",shape:"square"})),tS}function tS(t,e){var o=e._1i,r=e._1j;$y(0,r,t),n.updateComponent(o,r)}function eS(t){Zt(t,"bot-start")}function nS(t,e,o){var r=n.insert(e,n.elem("span",zy));n.setClass(r,"subscribe-okmsg");var a=o._1o=n.appendChild(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input;o._1q=n.addEvent(a,"click",eS,t,o);var s=o._1r=n.insert(i,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(s,n.propsSet(s,{key:"bot-start"})),n.mountComponent(a,n.propsSet(a,{class:"primary-okmsg",shape:"square"}))}function oS(t,e,n){e.chat=n.props.chat}function rS(t,e,o){var r=o._1w=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._1y=n.addEvent(r,"click",Oy,t,o);var i=o._1z=n.insert(a,n.createComponent("msg-chat-alerts",Ly,t),""),s=i.componentModel.input,u=o._20=n.propsSet(i);oS(0,u,t);var c=o._21=n.insert(s,n.createComponent("msg-tico",rc,t),"on"),p=c.componentModel.input,l=o._23=n.insert(p,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(l,n.propsSet(l,{key:"alerts-off"})),n.mountComponent(c,n.propsSet(c,{icon:"alert-off",size:"medium",slot:"on"}));var m=o._26=n.insert(s,n.createComponent("msg-tico",rc,t),"off"),d=m.componentModel.input,_=o._28=n.insert(d,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(_,n.propsSet(_,{key:"alerts-on"})),n.mountComponent(m,n.propsSet(m,{icon:"alert-on",size:"medium",slot:"off"})),n.mountComponent(i,u),n.mountComponent(r,n.propsSet(r,{class:"__wide-okmsg"})),aS}function aS(t,e){var o=e._1z,r=e._20;oS(0,r,t),n.updateComponent(o,r)}function iS(t,e){return"CLOSED"==n.get(t.props.chat,"status")?qy:e.inParticipants&&n.get(t.props.chat,"link")&&"LEFT"!==n.get(t.props.chat,"status")?Ky:!e.inParticipants&&n.get(t.props.chat,"link")||"LEFT"!=n.get(t.props.chat,"status")||n.get(t.props.chat,"groupChatInfo")?n.get(t.props.chat,"link")?Zy:"DIALOG"!==n.get(t.props.chat,"type")||!n.get(t.props.chat,"hasBots")||!n.get(t.props.chat,"isSuspended")&&n.get(t.props.chat,"messages")&&Tt(0,n.get(t.props.chat,"messages"))?rS:nS:Xy}function sS(t,e){var o=t.componentView,r=n.createInjector(o);return Dy(t,e),e._3=n.mountBlock(t,r,iS),uS}function uS(t,e){Dy(t,e),n.updateBlock(e._3)}qy.dispose=function(t){t._8=n.removeEvent("click",t._8),t._b=n.unmountComponent(t._b),t._9=n.unmountComponent(t._9),t._6=n.unmountComponent(t._6),t._c=null},Ky.dispose=function(t){t._j=n.removeEvent("click",t._j),t._m=n.unmountComponent(t._m),t._k=n.unmountComponent(t._k),t._h=n.unmountComponent(t._h),t._s=n.removeEvent("click",t._s),t._v=n.unmountComponent(t._v),t._x=n.unmountComponent(t._x),t._t=n.unmountComponent(t._t),t._q=n.unmountComponent(t._q),t._u=null},Xy.dispose=function(t){t._15=n.removeEvent("click",t._15),t._18=n.unmountComponent(t._18),t._16=n.unmountComponent(t._16),t._13=n.unmountComponent(t._13),t._19=null},Zy.dispose=function(t){t._1h=n.removeEvent("click",t._1h),t._1i=n.unmountComponent(t._1i),t._1f=n.unmountComponent(t._1f),t._1j=null},nS.dispose=function(t){t._1q=n.removeEvent("click",t._1q),t._1r=n.unmountComponent(t._1r),t._1o=n.unmountComponent(t._1o)},rS.dispose=function(t){t._1y=n.removeEvent("click",t._1y),t._23=n.unmountComponent(t._23),t._21=n.unmountComponent(t._21),t._28=n.unmountComponent(t._28),t._26=n.unmountComponent(t._26),t._1z=n.unmountComponent(t._1z),t._1w=n.unmountComponent(t._1w),t._20=null},sS.dispose=function(t){t._3=n.clearBlock(t._3)};var cS={__proto__:null,cssScope:zy,default:sS,props:function(){return{chat:null}},toggleNotifications:Oy};var pS={get checked(){var t=this.refs.input;return t?t.checked:this.props.checked},set checked(t){var e=this.refs.input;e&&t!==e.checked&&(e.checked=!!t)},get name(){return this.props.name},get type(){return"checkbox"},get value(){return this.refs.input.value},set value(t){var e=this.refs.input;e.value!==t&&(e.value=t)}};var lS="e-op6osr";function mS(t,e,o){n.updateAttribute(t,e,"name",o.props.name),n.updateProperty(t,e,"value",o.props.value),n.updateProperty(t,e,"checked",o.props.checked),n.updateProperty(t,e,"disabled",o.props.disabled),n.updateAttribute(t,e,"tabindex",o.props.tabindex),n.updateAttribute(t,e,"data-tsid",o.props.name+"_checkbox")}function dS(t,e){var o=n.insert(e,n.elem("span",lS));n.setClass(o,"control-okmsg toggle-okmsg")}function _S(t,e,o){var r=n.insert(e,n.elem("span",lS));n.setClass(r,"control-okmsg checkbox-okmsg");var a=o._b=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"check"}))}function fS(t){return"toggle"===t.props.shape?dS:_S}function gS(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("label",lS)),a=n.createInjector(r),i=e._2=n.insert(a,n.elem("input",lS));n.setRef(t,"input",i);var s=e._3=n.obj();n.setAttribute(i,"type","checkbox"),mS(i,s,t),e._4=n.mountBlock(t,a,fS);var u=n.insert(a,n.createSlot(t,"",lS));return n.setClass(u,"label-okmsg"),e._f=n.mountSlot(t,""),vS}function vS(t,e){mS(e._2,e._3,t),n.updateBlock(e._4)}_S.dispose=function(t){t._b=n.unmountComponent(t._b)},gS.dispose=function(t){t._4=n.unmountBlock(t._4),t._f=n.unmountSlot(t._f)};var hS={__proto__:null,cssScope:lS,default:gS,props:function(){return{name:"",value:"",checked:!1,disabled:!1,shape:""}},events:{click:function(t,e){"INPUT"!==e.target.nodeName&&e.stopImmediatePropagation()}},extend:pS,didChange:function(t,e){var n=e.checked;n&&(t.checked=n.current)}},CS="e-uiljcf";function kS(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",CS)),e._2=n.mountSlot(t,"")}kS.dispose=function(t){t._2=n.unmountSlot(t._2)};var bS={__proto__:null,cssScope:CS,default:kS};var yS="egegywd";function SS(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",yS)),e._2=n.mountSlot(t,"")}SS.dispose=function(t){t._2=n.unmountSlot(t._2)};var wS,ES={__proto__:null,cssScope:yS,default:SS,props:function(){return{delimiter:!1,expanded:!1,disabled:!1}}},xS={BACKSPACE:8,TAB:9,ENTER:13,CMD:91,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,ALL:"*"},IS=!1;var BS={metaKey:"CMD",ctrlKey:"CTRL",shiftKey:"SHIFT",altKey:"ALT"},MS=Im(xS),AS=[];function TS(t){return t.map((function(t){return xS[t]})).sort().join("")}function jS(t){for(var e=n.__spreadArray(n.__spreadArray([],function(t){var e=[];return["ctrlKey","metaKey","shiftKey","altKey"].forEach((function(n){t[n]&&e.push(BS[n])})),e}(t),!0),[MS[t.keyCode]],!1),o=TS(e),r=function(){},a=0;a<AS.length;++a){var i=AS[a];i.hasHandler(o)&&(r=i.getHandler(o).bind(null,t,r))}r()}function PS(){document.addEventListener("keydown",jS,!0)}function RS(){document.removeEventListener("keydown",jS,!0)}var LS=function(){function t(t){var e=this;this._shortcuts={},this._shortcuts={},this.platformKeyMap=function(){if(wS)return wS;var t={CMD:void 0};return"Mac OS"!==o.getOSVersion()&&(t.CMD="CTRL"),wS=t,t}(),Object.keys(t).forEach((function(n){e.add(n,t[n])}))}return t.prototype.resolveKeyMap=function(t){var e=this;return t.map((function(t){return e.platformKeyMap[t]||t}))},t.prototype.add=function(t,e){var n=TS(this.resolveKeyMap(t.toUpperCase().split("+")));this._shortcuts[n]=e},t.prototype.remove=function(t){var e=TS(this.resolveKeyMap(t.toUpperCase().split("+")));delete this._shortcuts[e]},t.prototype.getHandler=function(t){return this._shortcuts[t]||this._shortcuts[xS.ALL]},t.prototype.hasHandler=function(t){return!!this.getHandler(t)},t}();function OS(t){if(!t)throw new Error("Config must be not empty");var e=new LS(t);return AS.push(e),1!==AS.length||IS||PS(),{destroy:function(){return function(t){if(AS.length){var e=AS.indexOf(t);if(-1===e)return;AS.splice(e,1),AS.length||IS||RS()}}(e)},manager:e}}function zS(t,e,n){var o;return{willMount:function(r){t.addEventListener(e,o=n(r))},willUnmount:function(){t.removeEventListener(e,o),o=null}}}function DS(t,e){var n,o=function(e){var o={};Object.keys(t).forEach((function(n){return o[n]=t[n].bind(null,e)})),n=OS(o)};return{willMount:function(t){e||o(t)},didMount:function(t){e&&o(t)},willUnmount:function(){null==n||n.destroy(),n=null}}}function US(t,e,n,o){var r,a=!1,i={};"number"==typeof o?i.exitDelay=o:o&&Object.assign(i,o);var s=function(){a||(e(t),a=!0)},u=function(){a&&(n(t),a=!1)},c=function(t,e){clearTimeout(r),e?r=window.setTimeout(t,e):t()},p=function(){return clearTimeout(r)};return{enter:function(t){void 0===t&&(t=0),c(s,t)},exit:function(t){void 0===t&&(t=i.exitDelay),c(u,t)},restart:function(t){void 0===t&&(t=i.exitDelay),s(),c(u,t)},toggle:function(){p(),a?u():s()},reset:p,isActive:function(){return a}}}function NS(t){var e;return{willMount:function(n){"undefined"!=typeof ResizeObserver&&(e=new ResizeObserver((function(e,o){return t(n,e,o)}))).observe(n)},willUnmount:function(){e&&(e.disconnect(),e=null)}}}function qS(t){return t.componentModel&&(t.componentModel.preparing||t.componentModel.mounted)}function HS(t){return!!t&&!!t.posting&&!!t.posting.forward}function FS(t){for(var e=0;e<t.participants.length;e++){var n=t.participants[e];if(!n.user.current)return n.user}}var VS=0;function KS(t,e,n){if(function(t){"Enter"===t.key&&Cr(t.target)&&(t.target,VS&&clearTimeout(VS),VS=window.setTimeout((function(){VS=0}),1e3))}(e),!WS(e)&&XS(e)){var o=hr(t),r=function(t,e){var n=new i(t);for(;e;){if(n.has(e))return e;e=e.parentElement}}(function(t){for(var e=t.querySelectorAll("[tabindex]"),n=[],o=new a,r=0;r<e.length;r++){var i=e[r].getAttribute("tabindex");i&&"-"!==i[0]&&(n.push(e[r]),o.set(e[r],{index:r,tabindex:parseInt(i,10)}))}return n.sort((function(t,e){var n=o.get(t),r=o.get(e);return n.tabindex-r.tabindex||n.index-r.index}))}(t.root),o);if(null==r?void 0:r.closest("msg-chats-list")){var s=t.root.querySelector(".js-chat-search");if(s)return void s.focus()}var u=t.querySelector(".js-posting-form");u&&u.focus()}}function WS(t){var e=t.target;if("INPUT"===e.nodeName)return!0;var n=e.closest("[contenteditable]");return!!n&&n.isContentEditable}var GS=new i(["Control","Alt","Meta","Shift","CapsLock","Tab","Backspace","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Escape","Enter","PageUp","PageDown","Home","End"]),YS=new i([xS.CTRL,xS.ALT,xS.CMD,xS.SHIFT,20,xS.TAB,xS.BACKSPACE,xS.DELETE,xS.UP,xS.DOWN,xS.LEFT,xS.RIGHT,xS.ESC,xS.ENTER,xS.PAGE_UP,xS.PAGE_DOWN,xS.HOME,xS.END]);function XS(t){return!t.ctrlKey&&!t.metaKey&&(t.key?!GS.has(t.key)&&!/^F\d+$/.test(t.key):!(YS.has(t.keyCode)||t.keyCode>=112&&t.keyCode<=123))}function QS(t,e,n){var o=hr(t);if(!dr(o)||t.contains(o)){var r=t.store.get().config.user.ALT_KEYBOARD,a=e.ctrlKey||e.metaKey||e.shiftKey||e.altKey;(r?a:!a)&&JS(t)}else n()}function JS(t){var e=t.store.get().config,n=t.state,o=n.selected,r=n.comment;o&&o.length&&(!r||r.length<=e.server["max-msg-length"])&&te(t,"submit",{chatIds:o,text:r})}function $S(t){var e=t.state,n=e.comment,o=e.selected;if(n||o&&o.length){var r=t.store;L(t,"confirm").show({header:r.l10n("exit-action"),body:r.l10n("forward-messages-exit-confirm"),buttons:[{label:r.l10n("exit-action"),action:function(){return te(t,"cancel")}},{label:r.l10n("confirm-continue-forwarding")}]})}else te(t,"cancel")}function ZS(t,e){var n=e.detail;if("number"==typeof n&&(n=[n]),n){var o=t.state.selected,r=void 0===o?[]:o,a=!1;n.forEach((function(t){r.includes(t)||(a||(r=r.slice(),a=!0),r.push(t))})),a&&t.setState({selected:r})}}function tw(t,e){var n=e.detail;if("number"==typeof n&&(n=[n]),n){var o=t.state.selected,r=void 0===o?[]:o,a=!1;n.forEach((function(t){var e=r.indexOf(t);-1!==e&&(a||(r=r.slice(),a=!0),r.splice(e,1))})),a&&t.setState({selected:r})}}function ew(t,e){var n=new i;t.forEach((function(t){if("DIALOG"===(null==t?void 0:t.type)){var e=FS(t);e&&n.add(e.id)}}));var o=[];return e.forEach((function(t){t.own&&!n.has(t.id)&&o.push(t.id)})),o}function nw(t,e){return t?e.filter((function(t){var e;return!(null===(e=t.groupChatInfo)||void 0===e?void 0:e.isModerator)})):e}function ow(t,e){var n=e.props,o=n.message,r=n.selected;e.store.app.chat.commitForward(r,{targetChatIds:[t.id],messageIds:[o.id],type:"MESSAGES"}).then((function(){var n=L(e,"chat").get(t.id);$p(t.id,{messagesTime:n.lastMessage.time,useBack:!0})}))}function rw(t){Zt(t,"run-message-action",{action:"forward",messageId:t.props.message.id})}var aw=[0],iw=[];function sw(){iw.push(aw),aw=[0]}function uw(){aw=iw.pop()}function cw(t){return t.state.chats}function pw(t,e){e.chat=e.value,e.bot="DIALOG"===n.get(e.chat,"type")&&n.get(e.chat,"hasBots"),e.isGroupchat="GROUP_CHAT"===n.get(e.chat,"type"),e.channel="CHANNEL"===n.get(e.chat,"type"),e.official=Yt(0,e.chat),e.contact=n.get(n.find(n.get(e.chat,"participants"),(function(t){return!n.get(t,"user","current")})),"user"),e.groupModerator=e.isGroupchat&&n.get(e.chat,"groupChatInfo","isModerator"),e.title=n.get(e.chat,"title")||n.get(e.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder")}function lw(t,e,n,o){e.title=o.title}function mw(t,e,n,o){ow(o.chat,t)}function dw(t,e,n,o){e.chat=o.chat}function _w(t,e,n,o){e.official=o.official,e.channel=o.channel,e.bot=o.bot}function fw(t,e,o){pw(t,o);var r=o._d=n.insert(e,n.createComponent("msg-chat-item-container",eb,t)),a=r.componentModel.input,i=o._e=n.propsSet(r,{size:"small",role:"menuitem","data-l":"t,item"});lw(0,i,0,o),o._f=n.addEvent(r,"click",mw,t,o);var s=o._g=n.insert(a,n.createComponent("msg-chat-image",db,t),"image"),u=o._h=n.propsSet(s,{slot:"image",size:"micro",showStatus:!1});dw(0,u,0,o),n.mountComponent(s,u);var c=o._i=n.insert(a,n.createComponent("msg-name",Sh,t),"title"),p=c.componentModel.input,l=o._j=n.propsSet(c,{slot:"title"});return _w(0,l,0,o),o._k=n.insert(p,n.text(o.title)),n.mountComponent(c,l),n.mountComponent(r,i),gw}function gw(t,e){var o=e._d,r=e._e,a=e._g,i=e._h,s=e._i,u=e._j;pw(t,e),lw(0,r,0,e),dw(0,i,0,e),n.updateComponent(a,i),_w(0,u,0,e),aw[0]|=n.updateText(e._k,e.title),n.updateIncomingSlot(s,"",aw[0]),n.updateComponent(s,u),n.updateComponent(o,r)}function vw(t,e){var o=t.componentView;sw();var r=n.createInjector(o);e._1=n.mountIterator(t,r,cw,fw);var a=e._o=n.insert(r,n.createComponent("msg-tico",rc,t)),i=a.componentModel.input;e._q=n.addEvent(a,"click",rw,t,e);var s=e._r=n.insert(i,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(s,n.propsSet(s,{key:"more"})),n.mountComponent(a,n.propsSet(a,{icon:"more",size:"medium",role:"menuitem","data-tsid":"more_fwd","data-l":"t,more"})),uw(),n.subscribeStore(t,["l10n"]),hw}function hw(t,e){sw(),n.updateIterator(e._1),uw()}fw.dispose=function(t){t._f=n.removeEvent("click",t._f),t._g=n.unmountComponent(t._g),t._i=n.unmountComponent(t._i),t._d=n.unmountComponent(t._d),t._e=t._h=t._j=t._k=null},vw.dispose=function(t){sw(),t._1=n.clearIterator(t._1),t._q=n.removeEvent("click",t._q),t._r=n.unmountComponent(t._r),t._o=n.unmountComponent(t._o),uw()};var Cw={__proto__:null,cssScope:"e-bh1k2z",default:vw,onForward:ow,onMore:rw,init:function(t){t.setState({sorter:m((function(t){return t.id}))})},didChange:function(t){var e=t.props,n=e.chats,o=e.contacts,r=[],a=t.store.get().config,i=(null==a?void 0:a.server)&&(null==a?void 0:a.server["quick-forward-limit"])||5;if(null==n?void 0:n.length){var s=null==a?void 0:a.user.FORWARDED;(null==s?void 0:s.length)&&s.forEach((function(t){var e=t.id,o=n.find((function(t){return t.id===e}));o&&r.push(o)})),r=r.concat(n)}if(null==o?void 0:o.size){var u=ew(r,t.props.contacts).map((function(e){return t.store.app.chat.getDialogStub(e)}));u.length&&(r=r.concat(u))}if(null==r?void 0:r.length){var c=t.props.selected,p=l(r).filter((function(t){var e;return!(null===(e=t.groupChatInfo)||void 0===e?void 0:e.isModerator)})).filter((function(t){return t.id!==c}));t.setState({chats:t.state.sorter(p).slice(0,i)})}}};function kw(t,e,n){te(n,"react",{reaction:t,active:e})}function bw(t){Zt(t,"show-more-reactions",{message:t.props.message})}var yw="e-398t8p",Sw=[0],ww=[];function Ew(){ww.push(Sw),Sw=[0]}function xw(){Sw=ww.pop()}function Iw(t,e){e.menu=n.get(t.store.data.config,"server","reactions-menu"),e.fullset=n.get(t.store.data.config,"server","reactions-fullset")}function Bw(t,e){return e.menu}function Mw(t,e){e.mine=e.value===n.get(t.props.message,"reactionInfo","yourReaction")}function Aw(t,e,o,r){n.updateClass(t,e,"reaction-okmsg"+(r.mine?" __mine-okmsg":""))}function Tw(t,e,n,o){kw(o.value,o.mine,t)}function jw(t,e,n,o){e["data-l"]="t,"+o.value}function Pw(t,e,o){Mw(t,o);var r=o._9=n.insert(e,n.elem("span",yw));Aw(r,o._a=n.obj(),0,o),o._b=n.addEvent(r,"click",Tw,t,o);var a=o._c=n.appendChild(r,n.createComponent("msg-parsed-text",ii,t)),i=a.componentModel.input,s=o._d=n.propsSet(a,{emojiContext:"reaction"});return jw(0,s,0,o),o._e=n.insert(i,n.text(o.value)),n.mountComponent(a,s),Rw}function Rw(t,e){var o=e._c,r=e._d;Mw(t,e),Aw(e._9,e._a,0,e),jw(0,r,0,e),Sw[0]|=n.updateText(e._e,e.value),n.updateIncomingSlot(o,"",Sw[0]),n.updateComponent(o,r)}function Lw(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-icon",xe,t));o._m=n.addEvent(r,"click",bw,t,o),n.mountComponent(r,n.propsSet(r,{icon:"add-circle",size:"large","data-l":"t,more"}))}function Ow(t,e){return e.fullset?Lw:null}function zw(t,e){var o=t.componentView;Ew();var r=n.createInjector(o);return Iw(t,e),e._4=n.mountIterator(t,r,Bw,Pw),e._h=n.mountBlock(t,r,Ow),xw(),n.subscribeStore(t,["config"]),Dw}function Dw(t,e){Ew(),Iw(t,e),n.updateIterator(e._4),n.updateBlock(e._h),xw()}Pw.dispose=function(t){t._b=n.removeEvent("click",t._b),t._c=n.unmountComponent(t._c),t._a=t._d=t._e=t._9=null},Lw.dispose=function(t){t._m=n.removeEvent("click",t._m),t._k=n.unmountComponent(t._k)},zw.dispose=function(t){Ew(),t._4=n.clearIterator(t._4),t._h=n.clearBlock(t._h),xw()};var Uw={__proto__:null,cssScope:yw,default:zw,onReact:kw,onShowMore:bw};function Nw(t,e){return t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&qw(t,e):!t||!e||"object"!=typeof t&&"object"!=typeof e?t===e:Hw(t,e))}function qw(t,e,n){var o=t.length;if(o!==e.length)return!1;if(n){for(;o--;)if(t[o]!==e[o])return!1}else for(;o--;)if(!Nw(t[o],e[o]))return!1;return!0}function Hw(t,e,n){if(null==t||null==e||t.prototype!==e.prototype)return!1;var o=Object.keys(t),r=Object.keys(e);if(o.length!==r.length)return!1;if(!qw(o.sort(),r.sort()))return!1;for(var a=o.length-1,i=void 0;a>=0;a--)if(i=o[a],!(n?t[i]===e[i]:Nw(t[i],e[i])))return!1;return typeof t==typeof e}function Fw(t,e,n,o){if(e.parentNode!==n){n.appendChild(e);for(var r=0,a=0,i=o;i&&i!==n;)r+=i.offsetLeft,a+=i.offsetTop,i=i.offsetParent;var s=n.scrollTop+n.clientHeight,u=n.offsetWidth-16,c=e.clientWidth+12,p=e.clientHeight+12,l=o.clientWidth,m=a+5+o.offsetHeight,d="bottom";m+p>s&&(m=a+5-p,d="top"),t.setState({menuYSide:d});var _=Tn(r-("right"===e.getAttribute("align")?c-l:0),0,u-c);e.style.left=_+"px",e.style.top=m+"px",e.style.transformOrigin=r+l/2-_+"px "+("top"===d?"100%":"0")}}var Vw={deactivateMenu:function(){return Gw(this)}};function Kw(t,e,n){if(t&&"more"!==t){n.stopPropagation();var o=e.props.message,r=(o.id||o.cid).toString();Zt(e,"run-message-action",{action:t,chatId:o.chatId,messageId:r}),Gw(e)}}function Ww(t){var e=t.props.message,n=e&&e.actions||[],o=Date.now();return n.map((function(t){return!t.timeout||t.timeout>o?t.type:null})).filter(Boolean)}function Gw(t){t.setState({showMenu:null})}function Yw(t){var e,n=!1,o=null;e=function(){var e=document.body;o=t.id?e.querySelector('[aria-controls="'.concat(t.id,'"]')):null,n=function(t,e){return Xw(t).forEach((function(t){var e;(e=t).hasAttribute("tabindex")||e.setAttribute("tabindex","-1")})),e&&br(e)?(Qw(t,0),!0):(e===hr(t)&&Cr(e)&&e.blur(),!1)}(t,o)},"function"==typeof queueMicrotask?queueMicrotask(e):Promise.resolve().then(e);var r=function(e){if("ArrowUp"===e.key||"ArrowDown"===e.key)(n=hr(t))&&t.contains(n)&&(e.preventDefault(),Qw(t,"ArrowUp"===e.key?-1:1));else if("Enter"===e.key){var n;(n=Jw(t))&&!Cr(n)&&(e.preventDefault(),n.click(),t.dispatchEvent(new CustomEvent("enter",{bubbles:!1,cancelable:!0})))}else if("Escape"===e.key){a().defaultPrevented&&(e.preventDefault(),e.stopPropagation())}},a=function(){var e=new CustomEvent("esc",{bubbles:!1,cancelable:!0});return t.dispatchEvent(e),e},i=function(){o=null,a()},s=0,u=function(){clearTimeout(s),s=0},c=function(){s=window.setTimeout(i,100)};return t.addEventListener("keydown",r),t.addEventListener("focusin",u),t.addEventListener("focusout",c),{destroy:function(){t.removeEventListener("keydown",r),t.removeEventListener("focusin",u),t.removeEventListener("focusout",c),n&&o&&o.focus()}}}function Xw(t){return Array.from(t.querySelectorAll("[role=menuitem]"))}function Qw(t,e){var n,o=Xw(t),r=Jw(t);if(r){var a=o.findIndex((function(t){return t.contains(r)}));if(-1!==a)n=o[Math.abs((a+e+o.length)%o.length)]}n||(n=e<0?o[o.length-1]:o[0]),null==n||n.focus()}function Jw(t){var e=hr(t);if(e&&t.contains(e))return Xw(t).find((function(t){return t===e}))}var $w=new a([["❤️","like"],["🌸","flower"],["🌼","flower"],["🌹","flower"]]),Zw=["more","forward","reactions"],tE="0.3s";function eE(t,e,n,o){if("reactions"!==t||e.props.reactionsEnabled){if("forward"===t)if(!e.store.get().config.server["quick-forward"])return;Zw.includes(t)&&uE(e,o,t)}}function nE(t,e){Zw.includes(t)&&cE(e)}function oE(t,e,n){if(t)if("more"!==t)if("forward"===t&&e.props.focusMode&&e.state.showMenu!==t)uE(e,n.currentTarget,t);else{n.stopPropagation();var o=e.props.message,r=(o.id||o.cid).toString();Zt(e,"run-message-action",{action:t,chatId:o.chatId,messageId:r}),cE(e,"0s")}else uE(e,n.currentTarget,t)}function rE(t,e){var n,o=t.props.message,r=t.state.defaultReaction,a=!!(null===(n=o.reactionInfo)||void 0===n?void 0:n.yourReaction);"object"==typeof e.detail&&e.detail&&(r=e.detail.reaction,a=!1),Zt(t,"message-react",{reaction:r,active:a,source:t.tagName}),cE(t,"0s")}function aE(t,e){sE(e,t)}function iE(t){cE(t)}function sE(t,e,n){void 0===n&&(n=tE);var o=t.state.showMenu;return t.setState({showMenu:e,animationDelay:n}),o!==e}function uE(t,e,o){sE(t,o)&&n.afterUpdate(t,(function(){var n=t.closest(".js-popup-bounds")||document.body,o=t.refs.popup;o&&Fw(t,o,n,e)}))}function cE(t,e){void 0===e&&(e=tE),t.setState({showMenu:null,animationDelay:e})}function pE(t,e){"in"===e.detail.direction&&Ot(t,"activate-menu")}function lE(t,e){"out"===e.detail.direction&&Ot(t,"deactivate-menu")}function mE(t,e){var n,o=Array.from(t.querySelectorAll("button")),r=new a;o.forEach((function(t){r.set(t,t.getBoundingClientRect())})),o.sort((function(t,e){var n=r.get(t),o=r.get(e);return n.left-o.left}));var i=o.indexOf(hr(t));-1!==i&&(null===(n=o[(o.length+i+e)%o.length])||void 0===n||n.focus())}var dE="e5qx4xg",_E={button:{body:kx,defaults:{action:null,icon:null,class:null,tsid:null,popupId:null}}},fE=[0,0,0],gE=[];function vE(){gE.push(fE),fE=[0,0,0]}function hE(){fE=gE.pop()}function CE(t,e){e.isChannelMessage="CHANNEL"===n.get(t.props.message,"type")||"CHANNEL_ADMIN"===n.get(t.props.message,"type"),e.isMine=n.get(t.props.message,"sender","current")&&!e.isChannelMessage,e.id=n.get(t.props.message,"id")||n.get(t.props.message,"uid"),e.hasForward="forward"===n.get(t.state.actions,1),e.needMenu=Tt(0,t.state.actions)>(e.hasForward?3:1),e.showCount=e.hasForward?e.needMenu?2:3:1,e.moreActions=Lt(0,t.state.actions,e.showCount),e.primaryEnabled=!n.get(t.store.data.config,"server","primary-disabled")}function kE(t,e,n){t.class="main-okmsg"+(n.isMine?" is-mine-okmsg":"")}function bE(t,e,o,r){e["aria-controls"]="msg-message-reaction-menu"+r.id,e.title=n.get(o.props.message,"reactionInfo","yourReaction")?"Убрать реакцию "+n.get(o.props.message,"reactionInfo","yourReaction"):"Поставить реакцию "+o.state.defaultReaction}function yE(t,e,n){eE("reactions",t,0,n)}function SE(t,e,n){nE("reactions",t)}function wE(t,e,o){var r=o._q=n.insert(e,n.createComponent("msg-parsed-text",ii,t),""),a=r.componentModel.input;return o._s=n.insert(a,n.text(n.get(t.props.message,"reactionInfo","yourReaction"))),n.mountComponent(r,n.propsSet(r,{class:"reaction-okmsg",emojiSize:16,emojiContext:"reaction"})),fE[0]=1,EE}function EE(t,e){fE[1]|=n.updateText(e._s,n.get(t.props.message,"reactionInfo","yourReaction")),n.updateIncomingSlot(e._q,"",fE[1])}function xE(t,e,n){e.icon=n.state.reactionIconName}function IE(t,e,o){var r=o._w=n.insert(e,n.createComponent("msg-icon",xe,t),""),a=o._x=n.propsSet(r,{size:"medium"});return xE(0,a,t),n.mountComponent(r,a),fE[0]=1,BE}function BE(t,e){var o=e._w,r=e._x;xE(0,r,t),n.updateComponent(o,r)}function ME(t){return n.get(t.props.message,"reactionInfo","yourReaction")?wE:IE}function AE(t,e,o){var r=o._i=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._j=n.propsSet(r,{shape:"circle",class:"hollow-okmsg","aria-haspopup":"menu"});return bE(0,i,t,o),o._k=n.addEvent(r,"click",rE,t,o),o._l=n.addEvent(r,"mouseenter",yE,t,o),o._m=n.addEvent(r,"mouseleave",SE,t,o),o._n=n.mountBlock(t,a,ME),n.mountComponent(r,i),TE}function TE(t,e){var o=e._i,r=e._j;bE(0,r,t,e),n.updateBlock(e._n),n.updateIncomingSlot(o,"",fE[0]),n.updateComponent(o,r)}function jE(t){return t.props.reactionsEnabled?AE:null}function PE(t,e){return Lt(0,t.state.actions,0,e.showCount)}function RE(t,e){e.isPrimary=0===e.index&&"remove"!==e.value&&e.primaryEnabled}function LE(t,e,o){return RE(0,o),o._15=n.mountPartial(t,e,n.getPartial(t,"button",_E),{class:o.isPrimary?"primary-action":"",action:o.value,popupId:"forward"===o.value?"msg-message-"+o.value+"-menu"+o.id:null,icon:"remove"===o.value?"delete":o.value,":a":o._d,":e":o._c}),OE}function OE(t,e){RE(0,e),n.updatePartial(e._15,n.getPartial(t,"button",_E),{class:e.isPrimary?"primary-action":"",action:e.value,popupId:"forward"===e.value?"msg-message-"+e.value+"-menu"+e.id:null,icon:"remove"===e.value?"delete":e.value,":a":e._d,":e":e._c})}function zE(t,e,o){return o._19=n.mountPartial(t,e,n.getPartial(t,"button",_E),{action:"more",icon:"menu",popupId:"msg-message-more-menu"+o.id,":a":o._d,":e":o._c}),DE}function DE(t,e){n.updatePartial(e._19,n.getPartial(t,"button",_E),{action:"more",icon:"menu",popupId:"msg-message-more-menu"+e.id,":a":e._d,":e":e._c})}function UE(t,e){return Tt(0,e.moreActions)?zE:null}function NE(t,e,n,o){e.message=n.props.message,e.id="msg-message-reaction-menu"+o.id,e["data-message-context"]=o.id}function qE(t,e,n){aE("reactions",t)}function HE(t,e){var o=e._1f,r=e._1g;n.setPendingRef(e._1,"popup",o),NE(0,r,t,e),n.updateComponent(o,r)}function FE(t,e,o){return o._1f?HE(t,o):function(t,e,o){var r=o._1f=n.insert(e,n.createComponent("msg-reactions",Uw,t));n.setPendingRef(o._1,"popup",r);var a=o._1g=n.propsSet(r,{"data-l":"t,controls-reactions","data-menu":"reactions"});NE(0,a,t,o),o._1h=n.addEvent(r,"react",rE,t,o),o._1i=n.addEvent(r,"mouseenter",qE,t,o),o._1j=n.addEvent(r,"mouseleave",iE,t,o),o._1k=n.addEvent(r,"animate-start",pE,t,o),o._1l=n.addEvent(r,"animate-end",lE,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._1f,n.createAnimation("global:msg-pop-in 0.20s "+t.state.animationDelay+" cubic-bezier(0.175, 0.885, 0.32, 1.275)",dE)),VE}function VE(t,e){HE(t,e)}function KE(t){return"reactions"===t.state.showMenu?FE:null}function WE(t,e,n,o){e.id="msg-message-more-menu"+o.id,e.align=o.isMine?"right":"left",e["data-message-context"]=o.id}function GE(t,e,n){aE("more",t)}function YE(t,e){return e.moreActions}function XE(t,e,n,o){e["data-l"]="t,messageAction"+o.value,e.class="remove"==o.value&&Tt(0,o.moreActions)>1?"delimiter-okmsg":""}function QE(t,e,n,o){oE(o.value,t,e)}function JE(t,e,n,o){e.icon="remove"==o.value?"delete":o.value,e["data-tsid"]=o.value+"_msg_button"}function $E(t,e,n,o){e.key="message-action-"+o.value}function ZE(t,e,o){var r=o._23=n.insert(e,n.createComponent("msg-menu-item",ES,t)),a=r.componentModel.input,i=o._24=n.propsSet(r,{role:"menuitem",tabindex:"-1"});XE(0,i,0,o),o._25=n.addEvent(r,"click",QE,t,o);var s=o._26=n.insert(a,n.createComponent("msg-tico",rc,t),""),u=s.componentModel.input,c=o._27=n.propsSet(s,{size:"medium"});JE(0,c,0,o);var p=o._28=n.insert(u,n.createComponent("msg-l10n",ae,t),""),l=o._29=n.propsSet(p);return $E(0,l,0,o),n.mountComponent(p,l),n.mountComponent(s,c),n.mountComponent(r,i),fE[2]=1,tx}function tx(t,e){var o=e._23,r=e._24,a=e._26,i=e._27,s=e._28,u=e._29;XE(0,r,0,e),JE(0,i,0,e),$E(0,u,0,e),n.updateComponent(s,u),n.updateComponent(a,i),n.updateComponent(o,r)}function ex(t,e){var o=e._1s,r=e._1t;n.setPendingRef(e._1,"popup",o),WE(0,r,0,e),n.updateIterator(e._20),n.updateIncomingSlot(o,"",fE[2]),n.updateComponent(o,r)}function nx(t,e,o){return o._1s?ex(0,o):function(t,e,o){var r=o._1s=n.insert(e,n.createComponent("msg-menu",bS,t)),a=r.componentModel.input;n.setPendingRef(o._1,"popup",r);var i=o._1t=n.propsSet(r,{role:"menu"});WE(0,i,0,o),o._1u=n.mountUse(t,r,Yw),o._1v=n.addEvent(r,"mouseenter",GE,t,o),o._1w=n.addEvent(r,"mouseleave",iE,t,o),o._1x=n.addEvent(r,"animate-start",pE,t,o),o._1y=n.addEvent(r,"animate-end",lE,t,o);var s=n.insert(a,n.elem("div",dE),""),u=n.createInjector(s);n.setClass(s,"menu-items-okmsg"),o._20=n.mountIterator(t,u,YE,ZE),n.mountComponent(r,i)}(t,e,o),n.animate(o._1s,n.createAnimation("global:msg-pop-in 0.20s "+t.state.animationDelay+" cubic-bezier(0.175, 0.885, 0.32, 1.275)",dE)),ox}function ox(t,e){ex(0,e)}function rx(t){return"more"===t.state.showMenu?nx:null}function ax(t,e,n,o){e.id="msg-message-forward-menu"+o.id,e.align=o.isMine?"right":"left",e["data-message-context"]=o.id}function ix(t,e,n){aE("forward",t)}function sx(t,e,o){e.chats=o.store.data.chatList,e.selected=n.get(o.store.data.selectedChat,"id"),e.contacts=o.store.data.contacts,e.message=o.props.message}function ux(t){Ot(t,"reset")}function cx(t,e){var o=e._2j,r=e._2k,a=e._2r,i=e._2s;n.setPendingRef(e._1,"popup",o),ax(0,r,0,e),sx(0,i,t),n.updateComponent(a,i),n.updateComponent(o,r)}function px(t,e,o){return o._2j?cx(t,o):function(t,e,o){var r=o._2j=n.insert(e,n.createComponent("msg-menu",bS,t)),a=r.componentModel.input;n.setPendingRef(o._1,"popup",r);var i=o._2k=n.propsSet(r,{role:"menu","data-l":"t,forward-menu"});ax(0,i,0,o),o._2l=n.mountUse(t,r,Yw),o._2m=n.addEvent(r,"mouseenter",ix,t,o),o._2n=n.addEvent(r,"mouseleave",iE,t,o),o._2o=n.addEvent(r,"animate-start",pE,t,o),o._2p=n.addEvent(r,"animate-end",lE,t,o);var s=n.insert(a,n.elem("div",dE),"");n.setClass(s,"menu-items-okmsg");var u=o._2r=n.appendChild(s,n.createComponent("msg-forward-menu",Cw,t)),c=o._2s=n.propsSet(u);sx(0,c,t),o._2t=n.addEvent(u,"run-message-action",ux,t,o),n.mountComponent(u,c),n.mountComponent(r,i)}(t,e,o),n.animate(o._2j,n.createAnimation("global:msg-pop-in 0.20s "+t.state.animationDelay+" cubic-bezier(0.175, 0.885, 0.32, 1.275)",dE)),lx}function lx(t,e){cx(t,e)}function mx(t){return"forward"===t.state.showMenu?px:null}function dx(t,e){var o=t.componentView;vE();var r=n.createInjector(o),a=e._1=n.obj();CE(t,e);var i=e._b=n.insert(r,n.elem("div",dE)),s=n.createInjector(i),u=e._c=n.pendingEvents(t,i),c=e._d=n.obj(),p=e._e=n.obj();return kE(c,0,e),e._f=n.mountBlock(t,s,jE),e._10=n.mountIterator(t,s,PE,LE),e._16=n.mountBlock(t,s,UE),n.finalizePendingEvents(u),n.finalizeAttributes(i,c,p),e._1a=n.mountBlock(t,r,KE),e._1n=n.mountBlock(t,r,rx),e._2e=n.mountBlock(t,r,mx),hE(),n.subscribeStore(t,["config","chatList","selectedChat","contacts"]),n.finalizePendingRefs(t,a),_x}function _x(t,e){var o=e._d;vE(),CE(t,e),kE(o,0,e),n.updateBlock(e._f),n.updateIterator(e._10),n.updateBlock(e._16),n.finalizePendingEvents(e._c),n.finalizeAttributes(e._b,o,e._e),n.updateBlock(e._1a),n.updateBlock(e._1n),n.updateBlock(e._2e),hE(),n.finalizePendingRefs(t,e._1)}function fx(t,e,n,o){e.class="hollow-okmsg "+o.class,e.title=o.action&&"more"!==o.action&&n.store.data.l10n("message-action-"+o.action),e["data-l"]="t,messageAction"+o.action,e["aria-haspopup"]=o.popupId?"menu":null,e["aria-controls"]=o.popupId,e["aria-label"]=n.store.data.l10n("message-action-"+o.action),e["data-tsid"]=o.tsid||o.action&&o.action+"_message"}function gx(t,e,n,o){eE(o.action,t,0,n)}function vx(t,e,n,o){nE(o.action,t)}function hx(t,e,n,o){oE(o.action,t,e)}function Cx(t,e,n,o){e.icon=o.icon||o.action}function kx(t,e,o){var r=o._2y=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._2z=n.propsSet(r,{shape:"circle"});fx(0,i,t,o),o._30=n.addEvent(r,"mouseenter",gx,t,o),o._31=n.addEvent(r,"mouseleave",vx,t,o),o._32=n.addEvent(r,"click",hx,t,o);var s=o._33=n.insert(a,n.createComponent("msg-icon",xe,t),""),u=o._34=n.propsSet(s,{size:"medium"});return Cx(0,u,0,o),n.mountComponent(s,u),n.mountComponent(r,i),bx}function bx(t,e){var o=e._2y,r=e._2z,a=e._33,i=e._34;fx(0,r,t,e),Cx(0,i,0,e),n.updateComponent(a,i),n.updateComponent(o,r)}wE.dispose=function(t){t._q=n.unmountComponent(t._q),t._s=null,fE[0]=1},IE.dispose=function(t){t._w=n.unmountComponent(t._w),t._x=null,fE[0]=1},AE.dispose=function(t){t._k=n.removeEvent("click",t._k),t._l=n.removeEvent("mouseenter",t._l),t._m=n.removeEvent("mouseleave",t._m),t._n=n.unmountBlock(t._n),t._i=n.unmountComponent(t._i),t._j=null},LE.dispose=function(t){t._15=n.unmountPartial(t._15)},zE.dispose=function(t){t._19=n.unmountPartial(t._19)},FE.dispose=function(t,e){n.animate(t._1f,n.createAnimation("global:msg-pop-out 0.15s "+e.state.animationDelay+" ease-in",dE),(function(){return function(t){var e=t._1f;t._1h=n.removeEvent("react",t._1h),t._1i=n.removeEvent("mouseenter",t._1i),t._1j=n.removeEvent("mouseleave",t._1j),t._1k=n.removeEvent("animate-start",t._1k),t._1l=n.removeEvent("animate-end",t._1l),t._1f=n.unmountComponent(e),n.domRemove(e),t._1g=null}(t)}))},ZE.dispose=function(t){t._25=n.removeEvent("click",t._25),t._28=n.unmountComponent(t._28),t._26=n.unmountComponent(t._26),t._23=n.unmountComponent(t._23),t._24=t._27=t._29=null,fE[2]=1},nx.dispose=function(t,e){n.animate(t._1s,n.createAnimation("global:msg-pop-out 0.15s "+e.state.animationDelay+" ease-in",dE),(function(){return function(t){var e=t._1s;t._1u=n.unmountUse(t._1u),t._1v=n.removeEvent("mouseenter",t._1v),t._1w=n.removeEvent("mouseleave",t._1w),t._1x=n.removeEvent("animate-start",t._1x),t._1y=n.removeEvent("animate-end",t._1y),t._20=n.unmountIterator(t._20),t._1s=n.unmountComponent(e),n.domRemove(e),t._1t=null}(t)}))},px.dispose=function(t,e){n.animate(t._2j,n.createAnimation("global:msg-pop-out 0.15s "+e.state.animationDelay+" ease-in",dE),(function(){return function(t){var e=t._2j;t._2l=n.unmountUse(t._2l),t._2m=n.removeEvent("mouseenter",t._2m),t._2n=n.removeEvent("mouseleave",t._2n),t._2o=n.removeEvent("animate-start",t._2o),t._2p=n.removeEvent("animate-end",t._2p),t._2t=n.removeEvent("run-message-action",t._2t),t._2r=n.unmountComponent(t._2r),t._2j=n.unmountComponent(e),n.domRemove(e),t._2k=t._2s=null}(t)}))},dx.dispose=function(t){vE(),t._c=n.detachPendingEvents(t._c),t._f=n.unmountBlock(t._f),t._10=n.unmountIterator(t._10),t._16=n.unmountBlock(t._16),t._1a=n.clearBlock(t._1a),t._1n=n.clearBlock(t._1n),t._2e=n.clearBlock(t._2e),hE()},kx.dispose=function(t){t._30=n.removeEvent("mouseenter",t._30),t._31=n.removeEvent("mouseleave",t._31),t._32=n.removeEvent("click",t._32),t._33=n.unmountComponent(t._33),t._2y=n.unmountComponent(t._2y),t._2z=t._34=null};var yx={__proto__:null,cssScope:dE,partials:_E,default:dx,a11yContextPopup:Yw,plugins:function(){return[DS({ESC:function(t,e){t.refs.popup&&(e.preventDefault(),e.stopPropagation(),cE(t))},LEFT:function(t){t.refs.popup||mE(t,-1)},RIGHT:function(t){t.refs.popup||mE(t,1)}})]},didChange:function(t,e){e.message&&t.setState({actions:Ww(t)})},didMount:function(t){var e=t.store.get().config.server["double-tap-reaction"]||"👍",n=$w.get(e)||"klass";t.setState({defaultReaction:e,reactionIconName:n})},onActionHover:eE,onActionLeave:nE,onActionClick:oE,onReact:rE,onRetainMenu:aE,onReleaseMenu:iE,showMenu:sE,activateMenu:uE,deactivateMenu:cE,onMenuAnimateStart:pE,onMenuAnimateEnd:lE};var Sx="e-z8ogbe";function wx(t){return n.get(t.state.grid,"rows")}function Ex(t,e){e.size=n.get(t.state.sizes,e.index),e.coeff=qt(t,374/n.get(e.size,"width"),1),e.padding=qt(t,498,Ht(t,64,n.get(e.size,"width")*n.get(e.size,"ratio")*e.coeff))}function xx(t,e,o,r){n.updateAttribute(t,e,"style","width:"+n.get(r.size,"width")+"px;padding-bottom:"+r.padding+"px;")}function Ix(t,e){return e.value}function Bx(t,e){e.pinned=void 0,e.message=void 0}function Mx(t,e,o,r){n.updateAttribute(t,e,"style","flex-basis: "+100*n.get(r.value,"box","gridWidth")+"%")}function Ax(t,e,o,r){e.message=o.props.message,e.attachment=n.get(r.value,"item"),e.isVisible=o.props.isVisible,e.width=n.get(r.size,"width")*n.get(r.value,"box","gridWidth"),e.compact=o.props.compact||r.pinned,e.cancelable=!n.get(r.message,"preview"),e.error=n.get(r.message,"error"),e.downloadProgress=o.props.downloadProgress&&n.get(o.props.downloadProgress,"id")===n.get(r.value,"item","videoId")?o.props.downloadProgress:null}function Tx(t,e,o){Bx(0,o);var r=o._h=n.insert(e,n.elem("div",Sx)),a=o._i=n.obj();n.setClass(r,"cell-okmsg"),Mx(r,a,0,o);var i=o._j=n.appendChild(r,n.createComponent("msg-attach",Wv,t)),s=o._k=n.propsSet(i,{grid:!0,autoplay:!0});return Ax(0,s,t,o),n.mountComponent(i,s),jx}function jx(t,e){var o=e._j,r=e._k;Bx(0,e),Mx(e._h,e._i,0,e),Ax(0,r,t,e),n.updateComponent(o,r)}function Px(t,e,o){Ex(t,o);var r=o._8=n.insert(e,n.elem("div",Sx)),a=o._9=n.obj();n.setClass(r,"spacer-okmsg"),xx(r,a,0,o);var i=n.appendChild(r,n.elem("div",Sx)),s=n.createInjector(i);return n.setClass(i,"row-okmsg"),o._b=n.mountIterator(t,s,Ix,Tx),Rx}function Rx(t,e){Ex(t,e),xx(e._8,e._9,0,e),n.updateIterator(e._b)}function Lx(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountIterator(t,r,wx,Px),Ox}function Ox(t,e){n.updateIterator(e._1)}Tx.dispose=function(t){t._j=n.unmountComponent(t._j),t._i=t._k=t._h=null},Px.dispose=function(t){t._b=n.unmountIterator(t._b),t._9=t._8=null},Lx.dispose=function(t){t._1=n.clearIterator(t._1)};var zx={__proto__:null,cssScope:Sx,default:Lx,didChange:function(t,e){var o=e.message;o&&function(t,e,o){var r;if(e&&o&&e.attaches===o.attaches)return;var a=[],i=null,s=1;if(e){var u=qm(e),c=t.store.get().isSmallScreen?270:374;a=function(t,e){var o=n.__assign(n.__assign({},Dm),e),r=t.rows,a=[],i=1,s=r.reduce((function(t,r){var s=Fm(r),u=r.map((function(t){var e=t.box.width<o.minWidth?s:1;return t.item.height<o.minHeight&&(i=Math.min(o.minHeight/t.box.height,1)),n.__assign(n.__assign({},t),{width:t.box.width*e,height:t.box.height*e})}));a.push(u);var c=u.reduce((function(t,e){return t+e.width}),0);return e.longText?Math.max(t,c,o.containerWidth):Math.max(t,c)}),0);return a.map((function(t){var e=0,n=1===t.length,o=t.reduce((function(t,e){return t+e.width}),0);return t.forEach((function(t){return e=n?t.height:Math.min(e||t.height,t.height)})),{ratio:Vm(n?1/t[0].box.aspectRatio:e/o),width:Vm(s*i)}}))}(i=Nm(u,{containerWidth:c}),{longText:(null===(r=e.text)||void 0===r?void 0:r.length)>=100,containerWidth:c})}t.setState({attaches:e?qm(e,!1):null,grid:i,sizes:a,ratio:s})}(t,o.current,o.prev)}},Dx=o.isDesktopVersion("1.1.4");function Ux(t,e){var n=t.props.button;"LINK"===n.type?(e.preventDefault(),e.stopPropagation(),function(t){var e=Wn(t);if(e)return void(Gn(e)?Qp("/"+e):$p(e,{useBack:!0}));window.open(t,"_blank")}(t.props.button.url)):"REQUEST_GEO_LOCATION"===n.type?n.isQuick?function(t,e){if(e.preventDefault(),e.stopPropagation(),Dx)return void Nx(t,e);Zt(t,"request-location")}(t):Nx(t,e):n.loading||function(t){var e=t.props,n=e.button,o=e.row,r=e.column,a=function(){Zt(t,"bot-command",Object.assign({},n,{row:o,column:r}))};"REQUEST_CONTACT"===n.type?Zt(t,"show-confirm",{header:V("share-profile-title"),body:V("share-profile-body"),buttons:[{label:V("share-profile-ok"),action:a},{label:V("share-profile-cancel")}]}):a()}(t)}function Nx(t,e){e.preventDefault(),e.stopPropagation(),Zt(t,"share-location")}var qx="e-e7yd7p",Hx=[0],Fx=[];function Vx(){Fx.push(Hx),Hx=[0]}function Kx(){Hx=Fx.pop()}function Wx(t,e){e.type=n.get(t.props.button,"type"),e.intent=Pt(0,n.get(t.props.button,"intent")),e.chooseExpr="REQUEST_CONTACT"===e.type?0:"LINK"===e.type?1:"REQUEST_GEO_LOCATION"===e.type?2:-1,e.caseExpr=0===e.chooseExpr,e.caseExpr_1=1===e.chooseExpr,e.caseExpr_2=2===e.chooseExpr}function Gx(t,e,o,r){n.updateClass(t,e,"contents-okmsg __"+r.intent)}function Yx(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{inverted:!0}))}function Xx(t,e,o){var r=o._i=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input,i=o._j=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"location-quick-request"})),n.mountComponent(r)}function Qx(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._p=n.insert(a,n.text(n.get(t.props.button,"text"))),n.mountComponent(r),Jx}function Jx(t,e){Hx[0]|=n.updateText(e._p,n.get(t.props.button,"text")),n.updateIncomingSlot(e._o,"",Hx[0])}function $x(t,e){return n.get(t.props.button,"loading")?Yx:n.get(t.props.button,"isQuick")&&"REQUEST_GEO_LOCATION"===e.type?Xx:Qx}function Zx(t,e,n,o){e.icon=o.caseExpr_2?"location_12":o.caseExpr_1?"media-share_12":o.caseExpr?"user_12":void 0}function tI(t,e){var o=t.componentView;Vx(),Wx(t,e);var r=e._8=n.appendChild(o,n.elem("a",qx)),a=n.createInjector(r),i=e._9=n.obj();n.setAttribute(r,"target","_blank"),Gx(r,i,0,e),e._a=n.addEvent(r,"click",Ux,t,e),e._b=n.mountBlock(t,a,$x);var s=e._s=n.insert(a,n.createComponent("msg-icon",xe,t)),u=e._t=n.propsSet(s,{size:"small"});return Zx(0,u,0,e),n.mountComponent(s,u),Kx(),eI}function eI(t,e){var o=e._s,r=e._t;Vx(),Wx(t,e),Gx(e._8,e._9,0,e),n.updateBlock(e._b),Zx(0,r,0,e),n.updateComponent(o,r),Kx()}Yx.dispose=function(t){t._e=n.unmountComponent(t._e)},Xx.dispose=function(t){t._j=n.unmountComponent(t._j),t._i=n.unmountComponent(t._i)},Qx.dispose=function(t){t._o=n.unmountComponent(t._o),t._p=null},tI.dispose=function(t){Vx(),t._a=n.removeEvent("click",t._a),t._b=n.unmountBlock(t._b),t._s=n.unmountComponent(t._s),Kx()};var nI={__proto__:null,cssScope:qx,default:tI,props:function(){return{button:null,intent:null,row:null,column:null}},onClick:Ux},oI={"bot-command":function(t,e){var n=t.props,o=n.keyboard,r=n.messageId;e.detail.callbackId=o.callbackId,e.detail.messageId=r},"request-location":function(t){var e=t.props.sender;if(e&&e.current)Zt(t,"show-toast",V("location-you-request"));else{Zt(t,"show-confirm",{header:V("location-confirm-header"),body:V("location-confirm-body"),buttons:[{label:V("send"),action:function(){Zt(t,"send-location")}},{label:V("cancel")}]})}}},rI="e5gp441";function aI(t,e){e.buttons=n.get(t.props.keyboard,"keyboard","buttons")}function iI(t,e){return e.buttons}function sI(t,e){e.row=e.index}function uI(t,e,o,r){n.updateAttribute(t,e,"style","grid-template-columns: repeat("+n.get(r.value,"length")+", 1fr);")}function cI(t,e){return e.value}function pI(t,e,n,o){e.button=o.value,e.row=o.row,e.column=o.index}function lI(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-keyboard-button",nI,t)),a=o._e=n.propsSet(r);return pI(0,a,0,o),n.mountComponent(r,a),mI}function mI(t,e){var o=e._d,r=e._e;pI(0,r,0,e),n.updateComponent(o,r)}function dI(t,e,o){sI(0,o);var r=o._8=n.insert(e,n.elem("div",rI)),a=n.createInjector(r),i=o._9=n.obj();return n.setClass(r,"row-okmsg"),uI(r,i,0,o),o._a=n.mountIterator(t,a,cI,lI),_I}function _I(t,e){sI(0,e),uI(e._8,e._9,0,e),n.updateIterator(e._a)}function fI(t,e){var o=t.componentView,r=n.createInjector(o);return aI(t,e),e._3=n.mountIterator(t,r,iI,dI),gI}function gI(t,e){aI(t,e),n.updateIterator(e._3)}lI.dispose=function(t){t._d=n.unmountComponent(t._d),t._e=null},dI.dispose=function(t){t._a=n.unmountIterator(t._a),t._9=t._8=null},fI.dispose=function(t){t._3=n.clearIterator(t._3)};var vI={__proto__:null,cssScope:rI,default:fI,events:oI};function hI(t){return t?t<1e3?t:t<1e6?"".concat((t/1e3).toFixed(t%1e3<100?0:1),"K"):"".concat((t/1e6).toFixed(t%1e6<1e3?0:1),"M"):0}var CI="e-z8bt7d",kI=[0],bI=[];function yI(){bI.push(kI),kI=[0]}function SI(){kI=bI.pop()}function wI(t,e){e.inChannel="CHANNEL"==n.get(t.props.message,"type")||"CHANNEL_ADMIN"==n.get(t.props.message,"type"),e.showEdit="EDITED"===n.get(t.props.message,"status")&&!n.get(t.props.message,"options","hideEdit")&&!e.inChannel,e.time=Jt(0,n.get(t.props.message,"time")," в ")}function EI(t,e,o){n.updateAttribute(t,e,"href",n.get(o.props.message,"constructedWith","link"))}function xI(t,e,o){var r=o._8=n.insert(e,n.elem("a",CI)),a=o._9=n.obj();n.setClass(r,"link-okmsg"),EI(r,a,t),n.appendChild(r,n.text("@")),o._b=n.appendChild(r,n.text(t.state.bot));var i=n.insert(e,n.elemWithText("span","•",CI));return n.setClass(i,"delimiter-okmsg"),II}function II(t,e){EI(e._8,e._9,t),n.updateText(e._b,t.state.bot)}function BI(t){return n.get(t.props.message,"constructedWith","link")?xI:null}function MI(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"wait",size:"small",class:"wait-okmsg"}))}function AI(t){return n.get(t.props.message,"id")||n.get(t.props.message,"preview")?null:MI}function TI(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"edit",size:"small"}))}function jI(t,e){return e.showEdit?TI:null}function PI(t,e,o){var r=o._r=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._t=n.insert(a,n.text(t.state.views)),n.mountComponent(r,n.propsSet(r,{icon:"looked",size:"small"}));var i=n.insert(e,n.elemWithText("span","•",CI));return n.setClass(i,"delimiter-okmsg"),RI}function RI(t,e){kI[0]|=n.updateText(e._t,t.state.views),n.updateIncomingSlot(e._r,"",kI[0])}function LI(t){return n.get(t.props.message,"stats","views")>0?PI:null}function OI(t,e,o,r){n.updateAttribute(t,e,"aria-label",n.get(o.props.message,"sender","current")?"Отправлено "+r.time:"Получено "+r.time)}function zI(t,e){var o=t.componentView;yI();var r=n.createInjector(o);wI(t,e),e._5=n.mountBlock(t,r,BI),e._e=n.mountBlock(t,r,AI),e._j=n.mountBlock(t,r,jI),e._o=n.mountBlock(t,r,LI);var a=e._w=n.insert(r,n.elem("span",CI)),i=e._x=n.obj();n.setClass(a,"time-okmsg js-nocopy"),OI(a,i,t,e);var s=n.appendChild(a,n.elem("span",CI));return n.setAttribute(s,"aria-hidden","true"),e._z=n.appendChild(s,n.text(Xt(0,n.get(t.props.message,"time"),"HH:MM"))),SI(),DI}function DI(t,e){yI(),wI(t,e),n.updateBlock(e._5),n.updateBlock(e._e),n.updateBlock(e._j),n.updateBlock(e._o),OI(e._w,e._x,t,e),n.updateText(e._z,Xt(0,n.get(t.props.message,"time"),"HH:MM")),SI()}xI.dispose=function(t){t._9=t._b=t._8=null},MI.dispose=function(t){t._h=n.unmountComponent(t._h)},TI.dispose=function(t){t._m=n.unmountComponent(t._m)},PI.dispose=function(t){t._r=n.unmountComponent(t._r),t._t=null},zI.dispose=function(t){yI(),t._5=n.clearBlock(t._5),t._e=n.clearBlock(t._e),t._j=n.clearBlock(t._j),t._o=n.clearBlock(t._o),SI()};var UI={__proto__:null,cssScope:CI,default:zI,didChange:function(t,e){var n,o=e.message;if(o){var r=o.current,a=o.prev;(null==r?void 0:r.stats)!==(null==a?void 0:a.stats)&&t.setState({views:hI(null===(n=null==r?void 0:r.stats)||void 0===n?void 0:n.views)})}}},NI=function(t){var e=t.x,n=t.y;this.x=e,this.y=n},qI=function(t,e){this.topLeft=t,this.bottomRight=e},HI=function(t,e,n,o){this.opacityDelta=0,this.startTime=n,this.startPoint=new NI({x:20*(o+1)*2+20,y:e}),this.angle=Math.random()/6*(Math.random()>.5?1:-1);var r=e/2+Math.random()*e/2;this.endPoint=new NI({x:this.startPoint.x+r*Math.sin(this.angle),y:this.startPoint.y-r*Math.cos(this.angle)});var a=Math.min(this.startPoint.x,this.endPoint.x),i=Math.max(this.startPoint.x,this.endPoint.x),s=Math.min(this.startPoint.y,this.endPoint.y),u=Math.max(this.startPoint.y,this.endPoint.y);this.rect=new qI(new NI({x:a-28,y:s-28}),new NI({x:i+28,y:u+28})),this.ctx=t,this.scale=.8+.2*Math.random(),this.type="reaction"},FI=2e3,VI=20,KI=48,WI=200,GI=280,YI=function(t){return t*(2-t)};function XI(t){var e=performance.now();t.ctx.clearRect(t.repaintRect.topLeft.x,t.repaintRect.topLeft.y,t.repaintRect.bottomRight.x-t.repaintRect.topLeft.x,t.repaintRect.bottomRight.y-t.repaintRect.topLeft.y),JI(t);for(var n=t.drawQueue.length;n--;){var o=t.drawQueue[n],r=(e-o.startTime)/FI;if(!(r<0)){r>1&&(r=1);var a=YI(r);if(QI(t,o,a),t.repaintRect.topLeft.x=Math.min(t.repaintRect.topLeft.x,o.rect.topLeft.x),t.repaintRect.topLeft.y=Math.min(t.repaintRect.topLeft.y,o.rect.topLeft.y),t.repaintRect.bottomRight.x=Math.max(t.repaintRect.bottomRight.x,o.rect.bottomRight.x),t.repaintRect.bottomRight.y=Math.max(t.repaintRect.bottomRight.y,o.rect.bottomRight.y),1===r&&(t.drawQueue.splice(n,1),!t.drawQueue.length))return void(t.drawTimer=-1)}}t.drawTimer=requestAnimationFrame((function(){return XI(t)}))}function QI(t,e,n){var o=e.startPoint.x,r=e.startPoint.y,a=o+(e.endPoint.x-o)*n,i=r+(e.endPoint.y-r)*n,s=e.scale,u=1;n>.8&&(u=(1-n)/.2),e.opacityDelta=Math.min(1,1.3*e.opacityDelta),u=Math.max(0,u+e.opacityDelta),n<.25?s=s*n/.25:n>.9&&(s=s*(1-n)/.1),t.ctx.save(),t.ctx.globalAlpha=u,t.ctx.translate(a,i),t.ctx.scale(s,s),function(t,e){t.ctx.rotate(e.angle),t.ctx.translate(-KI/2,-KI/2),e.outline&&(t.ctx.beginPath(),t.ctx.arc(KI/2,KI/2,KI/2,0,2*Math.PI),t.ctx.clip());t.ctx.drawImage(e.ctx,0,0,KI,KI),e.outline&&(t.ctx.strokeStyle="#fff",t.ctx.lineWidth=4,t.ctx.arc(KI/2,KI/2,KI/2,0,2*Math.PI),t.ctx.stroke())}(t,e),t.ctx.restore()}function JI(t){t.repaintRect={topLeft:{x:1/0,y:1/0},bottomRight:{x:0,y:0}}}var $I="e-dpcbuv";var ZI={__proto__:null,cssScope:$I,default:function(t){var e=t.componentView,o=n.appendChild(e,n.elem("canvas",$I));n.setRef(t,"canvas",o)},init:function(t){t.drawQueue=[],t.drawTimer=-1,JI(t)},didChange:function(t,e){var n,o=e.reactions;(null===(n=null==o?void 0:o.current)||void 0===n?void 0:n.length)&&requestAnimationFrame((function(){!function(t,e){var n=performance.now();t.ctx||(t.ctx=function(t){var e=t.refs.canvas,n=t.getBoundingClientRect();t.setState({dimensions:n}),e.width=GI,e.height=WI;var o=e.getContext("2d");return o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,e.width,e.height),o.filter="none",o}(t));var o=e.map((function(e){return function(t,e){var n=t.store.get().emojiRoot+e.baseUrl+"/32/"+e.fileName,o=new Image;return o.src=n,o}(t,e.emoji)}));Promise.all(o.map((function(t){return(e=t).complete?Promise.resolve():new Promise((function(t){e.onload=function(){return t()}}));var e}))).then((function(){o.forEach((function(o,r){t.drawQueue.push(new HI(o,WI,n,e[r].idx)),n+=VI})),t.drawTimer<0&&XI(t)}))}(t,o.current)}))}},tB="e-4le62l";function eB(t,e){e.value=void 0}function nB(t){return t.props.reactions}function oB(t,e){return n.get(e.value,"emoji")}function rB(t,e,o,r){n.updateAttribute(t,e,"style","left:"+(n.get(r.value,"idx")<0?0:18*n.get(r.value,"idx"))+"px")}function aB(t,e,o,r){e.url=n.get(r.value,"lottieUrl")}function iB(t){Ot(t,"end")}function sB(t,e,o){var r=o._6=n.insert(e,n.elem("div",tB)),a=o._7=n.obj();n.setClass(r,"lottie-wrap-okmsg"),rB(r,a,0,o);var i=o._8=n.appendChild(r,n.createComponent("msg-lottie",Vn,t)),s=o._9=n.propsSet(i,{width:100,height:100});return aB(0,s,0,o),o._a=n.addEvent(i,"end",iB,t,o),n.mountComponent(i,s),uB}function uB(t,e){var o=e._8,r=e._9;rB(e._6,e._7,0,e),aB(0,r,0,e),n.updateComponent(o,r)}function cB(t,e){var o=t.componentView,r=n.createInjector(o);return eB(0,e),e._3=n.mountKeyIterator(t,r,nB,oB,sB),pB}function pB(t,e){eB(0,e),n.updateKeyIterator(e._3)}sB.dispose=function(t){t._a=n.removeEvent("end",t._a),t._8=n.unmountComponent(t._8),t._7=t._9=t._6=null},cB.dispose=function(t){t._3=n.clearKeyIterator(t._3)};var lB,mB={__proto__:null,cssScope:tB,default:cB};!function(t){t.ALL="ALL",t.VIEWS="VIEWS"}(lB||(lB={}));var dB=3;var _B={deactivateMenu:function(){return SB(this)}};function fB(t){var e=t.props.message;Zt(t,"show-read",{chatId:e.chatId,messageId:e.id,tab:lB.ALL})}function gB(t){t._menuHideTimer&&(clearTimeout(t._menuHideTimer),t._menuHideTimer=null)}function vB(t){if(t.props.canreact){var e=t.refs.main;gB(t),t._menuHideTimer=window.setTimeout((function(){return function(t,e){gB(t),t.setState({showMenu:e})}(t,e)}),300)}}function hB(t,e,n){gB(t),t._menuHideTimer=window.setTimeout((function(){return SB(t)}),300)}function CB(t){t.setState({paused:!1}),t.state.scheduledReaction&&(xB(t),BB(t),t.setState({scheduledReaction:null}))}function kB(t,e){if(e.props.canreact){var n=e.state.scheduledReaction,o=n?t.emoji!==(null==n?void 0:n.reaction)||!(null==n?void 0:n.active):!t.mine;SB(e),yB(e,t.emoji,o)}}function bB(t,e){var n=e.detail;yB(t,n.reaction,!n.active)}function yB(t,e,n){t.setState({scheduledReaction:{reaction:e,active:n}}),Zt(t,"message-react",{reaction:e,active:!n,source:t.tagName})}function SB(t){gB(t),t.setState({showMenu:null})}function wB(t,e){var o=t.counters,r=t.yourReaction,a=[],i=!1;return(e?o.slice(0,dB):o).forEach((function(t){i=!!r&&(i||r==t.reaction),a=n.__spreadArray(n.__spreadArray([],a,!0),new Array(t.count).fill(t.reaction),!0)})),!i&&r&&a.push(r),a.map((function(t){return Zo(t)})).filter(Boolean)}function EB(t){var e=t.store.get().config,n=e.server["allow-view-anim"],o=e.server["animated-emojis"];return function(t){var e,r;return n?null===(r=null===(e=null==o?void 0:o[t])||void 0===e?void 0:e.reactionAction)||void 0===r?void 0:r.url:void 0}}function xB(t){var e,o,r=t.props,a=r.reactions,i=r.dialog,s=null==a?void 0:a.yourReaction,u=[],c=!1,p=!1;i?null===(e=null==a?void 0:a.counters)||void 0===e||e.forEach((function(t){var e=t.reaction===s?t.count-1:t.count;u=n.__spreadArray(n.__spreadArray([],u,!0),new Array(e).fill({emoji:t.reaction,mine:void 0}),!0)})):u=(null===(o=null==a?void 0:a.counters)||void 0===o?void 0:o.map((function(t,e){var n={emoji:t.reaction,mine:t.reaction===s&&!p};return t.reaction===s&&e<dB&&(p=!0,c=!0),n})).slice(0,dB))||[],!c&&s&&u.push({emoji:s,mine:!0}),t.setState({top:u})}function IB(t,e,n){var o=t.findIndex((function(t){return Zo(t.emoji).emoji===e.emoji}));return{emoji:e,idx:-1===o?t.length:o,lottieUrl:n(e.emoji)}}function BB(t){clearTimeout(t._animateTopTimer),t.setState({animateTop:!0}),t._animateTopTimer=window.setTimeout((function(){t.setState({animateTop:!1})}),600)}function MB(t){t.setState({diff:null,lottieAnimation:null})}var AB="efylabs";function TB(t,e){e.immediate=n.get(t.state.top,"length")!==n.get(t.state.prevTop,"length"),e.down=t.state.prevTotal>n.get(t.props.reactions,"totalCount"),e.value=void 0}function jB(t,e,o){n.updateClass(t,e,(o.state.scheduledReaction?n.get(o.state.scheduledReaction,"active"):n.get(o.props.reactions,"yourReaction"))?"__voted-okmsg":"")}function PB(t,e){t.setState({paused:!0})}function RB(t,e,n){e.reactions=n.state.diff}function LB(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-floating-reactions",ZI,t)),a=o._h=n.propsSet(r);return RB(0,a,t),n.mountComponent(r,a),OB}function OB(t,e){var o=e._g,r=e._h;RB(0,r,t),n.updateComponent(o,r)}function zB(t){return t.props.isVisible&&!t.state.lottieAnimation?LB:null}function DB(t){return t.state.top}function UB(t,e){return n.get(e.value,"emoji")}function NB(t,e){e.prev=n.get(t.state.prevTop,e.index),e.flip=t.props.animated&&t.state.animateTop&&n.get(e.prev,"emoji")&&n.get(e.value,"emoji")&&n.get(e.prev,"emoji")!==n.get(e.value,"emoji")}function qB(t,e,o,r){n.updateClass(t,e,"wrap-okmsg"+(r.flip?" __flip-okmsg":""))}function HB(t,e,o,r){e.emoji=n.get(r.value,"emoji")}function FB(t,e,n,o){kB(o.value,t)}function VB(t,e,o,r){e.emoji=n.get(r.value,"emoji")}function KB(t,e,o,r){e.emoji=n.get(r.prev,"emoji")}function WB(t,e){var o=e._t,r=e._u,a=e._x,i=e._y,s=e._z,u=e._10;qB(e._r,e._s,0,e),HB(0,r,0,e),n.updateComponent(o,r),VB(0,i,0,e),n.updateComponent(a,i),KB(0,u,0,e),n.updateComponent(s,u)}function GB(t,e,o){return NB(t,o),o._r?WB(0,o):function(t,e,o){var r=o._r=n.insert(e,n.elem("div",AB));qB(r,o._s=n.obj(),0,o);var a=o._t=n.appendChild(r,n.createComponent("msg-emoji",No,t)),i=o._u=n.propsSet(a,{class:"reaction-okmsg",width:16,height:16,sourceName:"reaction"});HB(0,i,0,o),o._v=n.addEvent(a,"click",FB,t,o),n.mountComponent(a,i);var s=n.appendChild(r,n.elem("div",AB));n.setClass(s,"flip-okmsg");var u=o._x=n.appendChild(s,n.createComponent("msg-emoji",No,t)),c=o._y=n.propsSet(u,{class:"back-okmsg",width:16,height:16,sourceName:"reaction"});VB(0,c,0,o),n.mountComponent(u,c);var p=o._z=n.appendChild(s,n.createComponent("msg-emoji",No,t)),l=o._10=n.propsSet(p,{class:"front-okmsg",width:16,height:16,sourceName:"reaction"});KB(0,l,0,o),n.mountComponent(p,l)}(t,e,o),n.animate(o._r,n.createAnimation(t.props.animated&&o.immediate?"appear .3s":null,AB)),YB}function YB(t,e){NB(t,e),WB(0,e)}function XB(t,e,n){e.reactions=n.state.diff}function QB(t,e,o){var r=o._14=n.insert(e,n.createComponent("msg-message-rlottie",mB,t)),a=o._15=n.propsSet(r);return XB(0,a,t),o._16=n.addEvent(r,"end",MB,t,o),n.mountComponent(r,a),JB}function JB(t,e){var o=e._14,r=e._15;XB(0,r,t),n.updateComponent(o,r)}function $B(t){return t.props.isVisible&&t.state.lottieAnimation&&t.state.diff?QB:null}function ZB(t,e,o,r){n.updateClass(t,e,"total_w-okmsg"+(r.down?" __down-okmsg":""))}function tM(t,e,o){var r=o._1h=n.insert(e,n.elem("div",AB));return n.setClass(r,"prev-total-okmsg"),o._1i=n.appendChild(r,n.text(t.state.prevTotal)),n.animate(r,n.createAnimation("slide-up .45s forwards",AB)),eM}function eM(t,e){n.updateText(e._1i,t.state.prevTotal)}function nM(t,e){return t.state.prevTotal&&!e.down?tM:null}function oM(t,e,o){var r=o._1p=n.insert(e,n.elem("div",AB));return n.setClass(r,"prev-total-okmsg"),o._1q=n.appendChild(r,n.text(t.state.prevTotal)),n.animate(r,n.createAnimation("slide-down .45s forwards",AB)),rM}function rM(t,e){n.updateText(e._1q,t.state.prevTotal)}function aM(t,e){return t.state.prevTotal&&e.down?oM:null}function iM(t,e,o){var r=o._1a=n.insert(e,n.elem("div",AB)),a=n.createInjector(r);ZB(r,o._1b=n.obj(),0,o),o._1c=n.addEvent(r,"click",fB,t,o),o._1d=n.addEvent(r,"mouseenter",vB,t,o),o._1e=n.mountBlock(t,a,nM);var i=n.insert(a,n.elem("div",AB));return n.setClass(i,"total-okmsg"),n.setAttribute(i,"data-l","t,total"),o._1l=n.appendChild(i,n.text(n.get(t.props.message,"reactionInfo","totalCount"))),o._1m=n.mountBlock(t,a,aM),sM}function sM(t,e){ZB(e._1a,e._1b,0,e),n.updateBlock(e._1e),n.updateText(e._1l,n.get(t.props.message,"reactionInfo","totalCount")),n.updateBlock(e._1m)}function uM(t){return t.props.dialog?null:iM}function cM(t,e,n){e.reactions=n.props.reactions,e.message=n.props.message,e.parent=n}function pM(t,e){var o=e._1x,r=e._1y;n.setPendingRef(e._1,"reactions",o),cM(0,r,t),n.updateComponent(o,r)}function lM(t,e,o){return o._1x?pM(t,o):function(t,e,o){var r=o._1x=n.insert(e,n.createComponent("msg-reactions",Uw,t));n.setPendingRef(o._1,"reactions",r);var a=o._1y=n.propsSet(r,{"data-l":"t,info-reactions"});cM(0,a,t),o._1z=n.addEvent(r,"react",bB,t,o),o._20=n.addEvent(r,"mouseenter",gB,t,o),o._21=n.addEvent(r,"mouseleave",hB,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._1x,n.createAnimation("global:msg-pop-in 0.20s cubic-bezier(0.175, 0.885, 0.32, 1.275)",AB)),mM}function mM(t,e){pM(t,e)}function dM(t){return t.state.showMenu?lM:null}function _M(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();TB(t,e);var i=e._6=n.insert(r,n.elem("div",AB)),s=n.createInjector(i);n.setRef(t,"main",i),jB(i,e._7=n.obj(),t),e._8=n.addEvent(i,"mouseenter",vB,t,e),e._9=n.addEvent(i,"mouseleave",hB,t,e);var u=n.insert(s,n.elem("div",AB)),c=n.createInjector(u);return n.setClass(u,"top-okmsg"),e._b=n.addEvent(u,"mouseenter",PB,t,e),e._c=n.addEvent(u,"mouseleave",CB,t,e),e._d=n.mountBlock(t,c,zB),e._j=n.mountKeyIterator(t,c,DB,UB,GB),e._11=n.mountBlock(t,c,$B),e._17=n.mountBlock(t,s,uM),e._1s=n.mountBlock(t,r,dM),n.finalizePendingRefs(t,a),fM}function fM(t,e){TB(t,e),jB(e._6,e._7,t),n.updateBlock(e._d),n.updateKeyIterator(e._j),n.updateBlock(e._11),n.updateBlock(e._17),n.updateBlock(e._1s),n.finalizePendingRefs(t,e._1)}LB.dispose=function(t){t._g=n.unmountComponent(t._g),t._h=null},GB.dispose=function(t,e){n.animate(t._r,n.createAnimation(e.props.animated&&t.immediate?"appear .3s reverse":null,AB),(function(){return function(t){t._v=n.removeEvent("click",t._v),t._t=n.unmountComponent(t._t),t._x=n.unmountComponent(t._x),t._z=n.unmountComponent(t._z),t._r=n.domRemove(t._r),t._s=t._u=t._y=t._10=null}(t)}))},QB.dispose=function(t){t._16=n.removeEvent("end",t._16),t._14=n.unmountComponent(t._14),t._15=null},tM.dispose=function(t){t._1h=n.stopAnimation(t._1h),t._1i=null},oM.dispose=function(t){t._1p=n.stopAnimation(t._1p),t._1q=null},iM.dispose=function(t){t._1c=n.removeEvent("click",t._1c),t._1d=n.removeEvent("mouseenter",t._1d),t._1e=n.unmountBlock(t._1e),t._1m=n.unmountBlock(t._1m),t._1b=t._1l=t._1a=null},lM.dispose=function(t,e){n.animate(t._1x,n.createAnimation("global:msg-pop-out 0.15s ease-in",AB),(function(){return function(t){var e=t._1x;t._1z=n.removeEvent("react",t._1z),t._20=n.removeEvent("mouseenter",t._20),t._21=n.removeEvent("mouseleave",t._21),t._1x=n.unmountComponent(e),n.domRemove(e),t._1y=null}(t)}))},_M.dispose=function(t){t._8=n.removeEvent("mouseenter",t._8),t._9=n.removeEvent("mouseleave",t._9),t._b=n.removeEvent("mouseenter",t._b),t._c=n.removeEvent("mouseleave",t._c),t._d=n.unmountBlock(t._d),t._j=n.unmountKeyIterator(t._j),t._11=n.unmountBlock(t._11),t._17=n.unmountBlock(t._17),t._1s=n.clearBlock(t._1s)};var gM={__proto__:null,cssScope:AB,default:_M,props:function(){return{type:"default"}},extend:_B,init:function(t){xB(t)},didRender:function(t){var e=t.refs.reactions,n=t.props.container,o=t.state.showMenu;e&&n&&o&&Fw(t,e,n.refs.scroller,o)},didChange:function(t,e){var n=e.reactions,o=e.lastReaction,r=e.isVisible;if(n){var a=n.current,i=n.prev;t.setState({prevTop:t.state.top}),function(t,e,n){if(e&&(!t.state.paused&&function(t,e){return(null==t?void 0:t.totalCount)&&!(null==e?void 0:e.totalCount)||(null==t?void 0:t.totalCount)!==(null==e?void 0:e.totalCount)||(null==t?void 0:t.yourReaction)!==(null==e?void 0:e.yourReaction)||!Nw(null==t?void 0:t.counters,null==e?void 0:e.counters)}(e,n)&&xB(t),t.props.animated)){var o=function(t,e,n){if(!(null==e?void 0:e.totalCount))return[];var o=t.state.top,r=EB(t),a=wB(function(t,e){var n;return null===(n=t.counters)||void 0===n||n.forEach((function(t){var n,o=t.reaction;(null===(n=null==e?void 0:e.counters)||void 0===n?void 0:n.some((function(t){return t.reaction===o})))||(t.count=1)})),t}(e,n),!0).map((function(t){return IB(o,t,r)}));if(!(null==n?void 0:n.totalCount))return a;var i=wB(n).map((function(t){return IB(o,t,r)}));return a.filter((function(t){var e=i.findIndex((function(e){return e.emoji.id===t.emoji.id}));return-1!==e&&i.splice(e,1),-1===e}))}(t,e,n);BB(t),o.length&&t.setState({diff:o,lottieAnimation:o.some((function(t){return t.lottieUrl}))})}}(t,n.current,n.prev),(null==a?void 0:a.totalCount)!==(null==i?void 0:i.totalCount)&&function(t,e){clearTimeout(t._animateCounterTimer),t.setState({prevTotal:e}),t._animateCounterTimer=window.setTimeout((function(){t.setState({prevTotal:void 0})}),300)}(t,null==i?void 0:i.totalCount)}if((null==o?void 0:o.current)&&o.current!==(null==o?void 0:o.prev)){var s=EB(t),u=IB(t.state.top,Zo(o.current),s);if(u){var c=[u];t.setState({diff:c,lottieAnimation:c.some((function(t){return t.lottieUrl}))})}}r&&r.prev&&!r.current&&t.setState({diff:null,lottieAnimation:void 0})},onShowRead:fB,resetMenuSchedule:gB,onScheduleActivate:vB,onScheduleDeactivate:hB,onUnpause:CB,onReact:kB,onReactPanel:bB,onEnded:MB},vM={particleMaxSizePX:7,particleMinSizePX:1,windForceMax:.5,windDelta:.01,windChangeIntervalMax:5e3,windChangeIntervalMin:2500,windChangeChance:.25,snowSystemsAlpha:[.25,.5,1],desirableFPS:24},hM=function(){return.5+2.5*Math.random()+(Math.random()>.75?1.5:0)},CM=function(t,e){return void 0===t&&(t=vM.particleMinSizePX),void 0===e&&(e=vM.particleMaxSizePX),n=Math.round(t+Math.random()*e),o=hM(),{x:0,y:0,size:n,weight:o,radius:r=n/2,randomizeSize:function(){this.weight=hM()},get cx(){return this.x-r},get cy(){return this.y-r}};var n,o,r},kM=function(t,e){var n;t.x=(n=e,Math.random()*n)},bM=function(t,e,n){void 0===e&&(e=10);var o=function(t){return{move:function(e){e.y+=e.weight,e.y>t.canvas.height+e.radius&&(e.y=-e.radius,kM(e,t.canvas.width),e.randomizeSize())}}}(t),r=function(t){var e=0,n=1,o=0,r=1e3;return{update:function(t){o<t&&(o=t+r,r=vM.windChangeIntervalMin+Math.random()*vM.windChangeIntervalMax,n=Math.random()>1-vM.windChangeChance?-Math.sign(n):Math.sign(n)),n>0&&e<vM.windForceMax&&(e+=vM.windDelta),n<0&&e>-vM.windForceMax&&(e-=vM.windDelta)},move:function(n){n.x+=e,n.x<-n.radius&&(n.x=t.canvas.width+n.radius),n.x>t.canvas.width+n.radius&&(n.x=-n.radius)}}}(t),a=function(t,e,n){var o=0,r=[];return{update:function(n){if(o<n&&r.length<e){o=n+1e3;var a=CM();kM(a,t.canvas.width),r.push(a)}},drawParticle:function(e){n?(t.font=e.size+"px serif",t.fillText(n,e.cx,e.cy)):(t.beginPath(),t.arc(e.cx,e.cy,e.radius,0,2*Math.PI),t.fill())},particles:r}}(t,e,n);return{update:function(t){a.update(t),r.update(t),a.particles.forEach((function(t){o.move(t),r.move(t),a.drawParticle(t)}))}}},yM=function(t,e){e.canvas.width===t.offsetWidth&&e.canvas.height===t.offsetHeight||(e.canvas.width=t.offsetWidth,e.canvas.height=t.offsetHeight,e.fillStyle=t.props.color||"#fff")};var SM="e-cwwcuw";function wM(t,e,o){n.updateAttribute(t,e,"style","background-color: "+n.get(o.props.bg,"bgColor")+";")}function EM(t,e){wM(e._1,e._2,t)}var xM={__proto__:null,cssScope:SM,default:function(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("canvas",SM));return n.setRef(t,"canvas",r),wM(r,e._2=n.obj(),t),EM},didMount:function(t){t.setState({running:!0});var e=t.refs.canvas,n=e.getContext("2d"),o=vM.snowSystemsAlpha.map((function(e){var o;return{alpha:e,system:bM(n,t.props.particlesCountMax,null===(o=t.props.bg)||void 0===o?void 0:o.text)}})),r=1e3/vM.desirableFPS;yM(t,n);var a=0,i=function(s){t.state.running&&(s>=a&&(yM(t,n),a=s+r,n.clearRect(0,0,e.width,e.height),o.forEach((function(t){n.globalAlpha=t.alpha,t.system.update(s)}))),requestAnimationFrame(i))};requestAnimationFrame(i)},willUnmount:function(t){t.setState({running:!1})}},IM="e-c455d9",BM={text:{body:KT,defaults:{message:null,meta:!1}}},MM=[0,0],AM=[];function TM(){AM.push(MM),MM=[0,0]}function jM(){MM=AM.pop()}function PM(t,e){e.seq1st="first"===t.props.sequence||"single"===t.props.sequence,e.sender=n.get(t.props.message,"sender"),e.isChannel="CHANNEL"===n.get(t.props.message,"type")||"CHANNEL_ADMIN"===n.get(t.props.message,"type"),e.showAva="USER"===n.get(t.props.message,"type")&&(t.props.search&&!t.props.mine||e.seq1st&&!t.props.mine&&!t.props.dialog),e.showName=e.showAva||e.isChannel&&(Tt(0,n.get(t.props.message,"attaches"))||n.get(t.props.message,"text")||"FORWARD"===n.get(t.props.message,"link","type")),e.hasActions=Tt(0,n.get(t.props.message,"actions")),e.hasQuote="REPLY"===n.get(t.props.message,"link","type"),e.hasFwd="FORWARD"===n.get(t.props.message,"link","type"),e.msg=e.hasFwd?n.get(t.props.message,"link","message"):t.props.message,e.attachments=n.filter(n.get(e.msg,"attaches"),(function(t){return"INLINE_KEYBOARD"!==n.get(t,"_type")&&"SEND_ACTION"!==n.get(t,"_type")&&"REPLY_KEYBOARD"!==n.get(t,"_type")&&"DAILY_MEDIA"!==n.get(t,"_type")})),e.attach=n.get(e.attachments,0),e.dailyMedia=e.hasFwd?[]:n.filter(n.get(e.msg,"attaches"),(function(t){return"DAILY_MEDIA"===n.get(t,"_type")})),e.dailyMediaOrigin=n.find(e.dailyMedia,(function(t){return n.get(t,"replyOrigin")})),e.dailyMediaAnswer=n.find(e.dailyMedia,(function(t){return!n.get(t,"replyOrigin")})),e.mediaLike=jt(0,["PHOTO","VIDEO","LOCATION","DAILY_MEDIA"],n.get(e.attach,"_type"))&&!n.get(e.attach,"deleted"),e.fileLike=jt(0,["FILE","MUSIC","CALL","CONTACT"],n.get(e.attach,"_type")),e.sticker="STICKER"===n.get(e.attach,"_type"),e.postcard="POSTCARD"===n.get(e.attach,"stickerType")||"LIVE"===n.get(e.attach,"stickerType"),e.share="SHARE"===n.get(e.attach,"_type"),e.keyboard=n.find(n.get(e.msg,"attaches"),(function(t){return"INLINE_KEYBOARD"===n.get(t,"_type")})),e.actionAttach=n.find(n.get(e.msg,"attaches"),(function(t){return"SEND_ACTION"===n.get(t,"_type")})),e.emojiAsSticker=t.state.largeEmoji&&!e.hasQuote&&!e.hasFwd&&!e.keyboard&&!e.attach,e.hasBg="STICKER"!==n.get(e.attach,"_type")&&!e.emojiAsSticker||e.hasQuote||e.hasFwd||e.keyboard,e.hasCustomBg=t.state.animatedBg&&!e.emojiAsSticker||t.state.customBgStyle,e.shortText=n.get(e.msg,"text","length")<100&&e.attach,e.preview=n.get(e.attach,"image")||n.get(e.attach,"media"),e.compact=e.share&&"VIDEO"!==n.get(e.attach,"media","_type")&&(!e.preview||n.get(e.preview,"width")<320),e.hasAction=t.props.congrats&&e.actionAttach&&!t.props.mine,e.clickable=!(t.props.dialog||t.props.mine||n.get(e.sender,"deleted")||"USER"!==n.get(t.props.message,"type")&&"CHANNEL_ADMIN"!==n.get(t.props.message,"type")),e.blockMeta=Tt(0,e.attachments)||e.dailyMediaAnswer,e.shiftReactions=e.sticker&&!(e.hasQuote||e.hasFwd),e.canreact=2===n.get(t.store.data.config,"server","react-permission"),e.inChannel=void 0,e.ifExpr=Tt(0,e.attachments),e.chooseExpr=e.ifExpr?Tt(0,e.attachments)>1?0:1:-1,e.caseExpr_1=1===e.chooseExpr,e.offset=e.caseExpr_1?!e.mediaLike&&!e.sticker||!!e.keyboard||e.sticker&&(e.hasFwd||e.hasQuote):void 0,e.fill=void 0,e.error=n.get(t.props.message,"error"),e.errorCode=e.error&&n.get(e.error,"code"),e.errorMessage=e.error&&n.get(e.error,"localizedMessage")}function RM(t,e,n){e.checked=n.props.selected}function LM(t,e,o){var r=o._1b=n.insert(e,n.createComponent("msg-checkbox",hS,t)),a=o._1c=n.propsSet(r,{"data-l":"t,selectMultiple"});return RM(0,a,t),o._1d=n.addEvent(r,"click",na,t,o),n.mountComponent(r,a),OM}function OM(t,e){var o=e._1b,r=e._1c;RM(0,r,t),n.updateComponent(o,r)}function zM(t,e){return!t.store.data.isMobile&&e.hasActions&&(t.props.selectMode||t.state.active)?LM:null}function DM(t,e,n,o){e.showStatus=!n.props.mine,e.user=o.sender,e.class=o.clickable?"clickable-okmsg":""}function UM(t,e,o,r){n.call(n.get(t.store,"router"),"goToDialog",[n.get(r.sender,"id"),{useBack:!0}])}function NM(t,e){e.clickable&&n.setPendingEvent(e._1j,"click",UM,e)}function qM(t,e,o){var r=o._1i=n.insert(e,n.createComponent("msg-user-card",Nh,t)),a=o._1j=n.pendingEvents(t,r),i=o._1k=n.propsSet(r,{size:"small",masked:!0});return DM(0,i,t,o),NM(0,o),n.finalizePendingEvents(a),n.mountComponent(r,i),HM}function HM(t,e){var o=e._1i,r=e._1k;DM(0,r,t,e),NM(0,e),n.finalizePendingEvents(e._1j),n.updateComponent(o,r)}function FM(t,e){return e.showAva&&"preview"!==t.props.sequence?qM:null}function VM(t,e,o,r){n.updateClass(t,e,"wrap-okmsg"+(r.showName||o.props.mine||o.props.dialog||"preview"===o.props.sequence?"":" __shift-okmsg")+(!o.props.hasReactions||r.shiftReactions||r.emojiAsSticker?"":" __reactions-okmsg"))}function KM(t,e,n){e.url=n.state.wordsAnimateUrl}function WM(t){Ot(t,"lottieAnimationEnd")}function GM(t,e,o){var r=o._1t=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._1u=n.propsSet(r,{class:"lottie-wrap-okmsg",playOnce:!0,width:300,height:300});return KM(0,a,t),o._1v=n.addEvent(r,"end",WM,t,o),n.mountComponent(r,a),YM}function YM(t,e){var o=e._1t,r=e._1u;KM(0,r,t),n.updateComponent(o,r)}function XM(t){return t.state.wordsAnimateUrl?GM:null}function QM(t,e,o){t.class="cnt-okmsg"+(o.hasBg?" __bg-okmsg":"")+(o.postcard?" __postcard-okmsg":"")+(o.hasCustomBg?" __custom-bg-okmsg":"")+(n.get(e.props.message,"error")?" __error-okmsg":"")+("first"===e.props.sequence||"single"===e.props.sequence?" __first-okmsg":"")+(o.sticker?" __fluid-okmsg":"")+(o.shortText||!o.mediaLike||o.sticker||o.compact?"":" __media-okmsg")+("last"===e.props.sequence||"single"===e.props.sequence?" __last-okmsg":"")+(!o.share||o.compact&&!o.shortText?"":" __share-okmsg")+(o.shortText?" __short-okmsg":""),t.style=e.state.customBgStyle?e.state.customBgStyle:"transform: translateX("+(e.state.offset||0)+"px)"}function JM(t,e,n){e.bg=n.state.animatedBg}function $M(t,e,o){var r=o._24=n.insert(e,n.createComponent("msg-chat-snow",xM,t)),a=o._25=n.propsSet(r,{color:"#e0fdfd",particlesCountMax:6});return JM(0,a,t),n.mountComponent(r,a),ZM}function ZM(t,e){var o=e._24,r=e._25;JM(0,r,t),n.updateComponent(o,r)}function tA(t,e){return t.state.animatedBg&&!e.emojiAsSticker?$M:null}function eA(t,e,n,o){e.message=n.props.message,e.mine=n.props.mine,e.clickable=o.clickable,e.dyed=!o.inChannel}function nA(t,e,o){var r=o._2a=n.insert(e,n.createComponent("msg-message-header",OC,t));n.setPendingRef(o._1,"header",r);var a=o._2b=n.propsSet(r);return eA(0,a,t,o),n.mountComponent(r,a),oA}function oA(t,e){var o=e._2a,r=e._2b;n.setPendingRef(e._1,"header",o),eA(0,r,t,e),n.updateComponent(o,r)}function rA(t,e){return e.showName&&e.hasBg?nA:null}function aA(t,e,n,o){e.message=n.props.message,e.fluid=o.sticker}function iA(t,e,o){var r=o._2f=n.insert(e,n.createComponent("msg-message-forward",mC,t)),a=o._2g=n.propsSet(r,{"aria-label":"Пересланное сообщение","data-tsid":"forwarded_message"});return aA(0,a,t,o),n.mountComponent(r,a),sA}function sA(t,e){var o=e._2f,r=e._2g;aA(0,r,t,e),n.updateComponent(o,r)}function uA(t,e){return e.hasFwd?iA:null}function cA(t,e,o){e.message=n.get(o.props.message,"link","message"),e.highlights=o.props.highlights}function pA(t,e,o){var r=o._2k=n.insert(e,n.createComponent("msg-message-quote",ok,t)),a=o._2l=n.propsSet(r,{"aria-label":"Ответ на сообщение","data-tsid":"replied_message"});return cA(0,a,t),o._2m=n.addEvent(r,"click",ea,t,o),n.mountComponent(r,a),lA}function lA(t,e){var o=e._2k,r=e._2l;cA(0,r,t),n.updateComponent(o,r)}function mA(t,e){return e.hasQuote?pA:null}function dA(t,e,n,o){e.attachment=o.dailyMediaOrigin||o.dailyMediaAnswer,e.answer=o.dailyMediaOrigin?o.dailyMediaAnswer:null}function _A(t,e,o){var r=o._2q=n.insert(e,n.createComponent("msg-attach-daily-media",fm,t)),a=o._2r=n.propsSet(r,{"data-tsid":"daily-media-attachment-reply"});return dA(0,a,0,o),n.mountComponent(r,a),fA}function fA(t,e){var o=e._2q,r=e._2r;dA(0,r,0,e),n.updateComponent(o,r)}function gA(t,e){return Tt(0,e.dailyMedia)?_A:null}function vA(t,e,o){return o._2v=n.mountPartial(t,e,n.getPartial(t,"text",BM),{message:o.msg,meta:!Tt(0,o.attachments),":a":o._1z,":e":o._1y}),hA}function hA(t,e){n.updatePartial(e._2v,n.getPartial(t,"text",BM),{message:e.msg,meta:!Tt(0,e.attachments),":a":e._1z,":e":e._1y})}function CA(t,e){return n.get(e.msg,"text")?vA:null}function kA(t,e,n,o){e.message=o.msg,e.offset=!!o.keyboard,e.isVisible=n.props.isVisible,e.downloadProgress=n.state.videoDownload}function bA(t,e,o){var r=o._32=n.insert(e,n.createComponent("msg-message-grid",zx,t)),a=o._33=n.propsSet(r);return kA(0,a,t,o),n.mountComponent(r,a),yA}function yA(t,e){var o=e._32,r=e._33;kA(0,r,t,e),n.updateComponent(o,r)}function SA(t,e,o,r){e.message=r.msg,e.offset=r.offset,e.attachment=r.attach,e.fill=r.fill,e.isVisible=o.props.isVisible,e.compact=r.compact,e.search=o.props.search,e.highlights=o.props.highlights,e.focusMode=o.state.focusMode,e.downloadProgress=o.state.videoDownload&&n.get(o.state.videoDownload,"id")===n.get(r.attach,"videoId")?o.state.videoDownload:null}function wA(t,e,o){var r=o._36=n.insert(e,n.createComponent("msg-attach",Wv,t)),a=o._37=n.propsSet(r,{autoplay:!0});return SA(0,a,t,o),n.mountComponent(r,a),EA}function EA(t,e){var o=e._36,r=e._37;SA(0,r,t,e),n.updateComponent(o,r)}function xA(t,e){return[bA,wA][e.chooseExpr]}function IA(t,e,o){return o._2z=n.mountBlock(t,e,xA),BA}function BA(t,e){n.updateBlock(e._2z)}function MA(t,e){return e.ifExpr?IA:null}function AA(t,e,n,o){e.message=n.props.message,e["has-reactions"]=n.props.hasReactions,e.type=o.sticker?"sticker":o.fileLike?"attach":o.mediaLike&&!o.keyboard?"media":"separate",e.dialog=n.props.dialog}function TA(t,e,o){var r=o._3b=n.insert(e,n.createComponent("msg-message-meta",UI,t)),a=o._3c=n.propsSet(r);return AA(0,a,t,o),n.mountComponent(r,a),jA}function jA(t,e){var o=e._3b,r=e._3c;AA(0,r,t,e),n.updateComponent(o,r)}function PA(t,e){return e.blockMeta?TA:null}function RA(t,e,o,r){e.messageId=n.get(o.props.message,"id")||n.get(o.props.message,"cid"),e.sender=r.sender,e.keyboard=r.keyboard}function LA(t,e,o){var r=o._3g=n.insert(e,n.createComponent("msg-message-keyboard",vI,t)),a=o._3h=n.propsSet(r,{"data-l":"newbieCContainer,bot.link_button"});return RA(0,a,t,o),n.mountComponent(r,a),OA}function OA(t,e){var o=e._3g,r=e._3h;RA(0,r,t,e),n.updateComponent(o,r)}function zA(t,e){return e.keyboard&&!e.hasFwd?LA:null}function DA(t,e,o,r){e.reactions=n.get(o.props.message,"reactionInfo"),e.animated=o.state.mounted,e.message=o.props.message,e.dialog=o.props.dialog,e.container=o.props.container,e.isVisible=o.props.isVisible,e.lastReaction=o.props.lastReaction,e.mine=o.props.mine,e.canreact=r.canreact,e.type=r.shiftReactions?"sticker":void 0,e.class=(r.hasAction?"__shift-okmsg":"")+(o.props.hasReactions||!o.state.active||o.state.reactionsOpen?"":" __semi-okmsg")+(o.state.reactionsOpen?" __open-okmsg":"")}function UA(t,e){t.setState({reactionsOpen:!0})}function NA(t,e){t.setState({reactionsOpen:!1})}function qA(t,e){var o=e._3n,r=e._3o;DA(0,r,t,e),n.updateComponent(o,r)}function HA(t,e,o){return o._3n?qA(t,o):function(t,e,o){var r=o._3n=n.insert(e,n.createComponent("msg-message-reactions",gM,t)),a=o._3o=n.propsSet(r,{"aria-label":"Реакции","data-l":"t,message-reactions"});DA(0,a,t,o),o._3p=n.addEvent(r,"activate-menu",UA,t,o),o._3q=n.addEvent(r,"deactivate-menu",NA,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._3n,n.createAnimation(t.state.mounted?"reactions 0.15s":"",IM)),FA}function FA(t,e){qA(t,e)}function VA(t,e){return!e.emojiAsSticker&&t.props.hasReactions?HA:null}function KA(t,e,o,r){e.tabindex=o.props.focusMode?0:-1,e.class="action-okmsg"+(!o.props.hasReactions||r.emojiAsSticker||r.sticker?"":" __shift-okmsg"),e.style="background: "+n.get(r.actionAttach,"backgroundColor")+"; color: "+n.get(r.actionAttach,"textColor")}function WA(t,e,o,r){oa(n.get(r.actionAttach,"nextContentType"),n.get(r.actionAttach,"actionDestinationType"),t,e)}function GA(t,e,o){var r=o._3u=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._3v=n.propsSet(r,{shape:"square","data-l":"t,send-action-congrats-attach-button"});return KA(0,i,t,o),o._3w=n.addEvent(r,"click",WA,t,o),o._3x=n.insert(a,n.text(n.get(o.actionAttach,"title"))),n.mountComponent(r,i),YA}function YA(t,e){var o=e._3u,r=e._3v;KA(0,r,t,e),MM[0]|=n.updateText(e._3x,n.get(e.actionAttach,"title")),n.updateIncomingSlot(o,"",MM[0]),n.updateComponent(o,r)}function XA(t,e){return e.hasAction?GA:null}function QA(t,e,o){n.updateClass(t,e,"controls-okmsg"+(o.store.data.isMobile?" mobile-okmsg":""))}function JA(t,e,n,o){e.message=n.props.message,e.focusMode=n.state.focusMode,e.reactionsEnabled=n.props.reactionsEnabled&&o.canreact}function $A(t,e){t.setState({menuOpen:!0})}function ZA(t,e){t.setState({menuOpen:!1})}function tT(t,e,o){var r=o._48=n.insert(e,n.createComponent("msg-message-controls",yx,t));n.setPendingRef(o._1,"controls",r);var a=o._49=n.propsSet(r);return JA(0,a,t,o),o._4a=n.addEvent(r,"activate-menu",$A,t,o),o._4b=n.addEvent(r,"deactivate-menu",ZA,t,o),o._4c=n.addEvent(r,"reset",ra,t,o),n.mountComponent(r,a),eT}function eT(t,e){var o=e._48,r=e._49;n.setPendingRef(e._1,"controls",o),JA(0,r,t,e),n.updateComponent(o,r)}function nT(t,e){return t.store.data.isMobile||t.props.search||!e.hasActions||t.props.selectMode||!(t.state.active||t.state.menuOpen||t.state.focusMode)?null:tT}function oT(t,e,o){e.tabindex=o.props.focusMode?0:-1,e["aria-controls"]="msg-message-more-menu"+n.get(o.props.message,"id")}function rT(t,e,o){var r=o._4h=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._4i=n.propsSet(r,{"aria-haspopup":"menu",class:"mobile-more-btn-okmsg",shape:"circle","data-l":"t,messageActionMore","data-tsid":"more_message"});oT(0,i,t),o._4j=n.addEvent(r,"click",sa,t,o);var s=o._4k=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"menu",size:"medium"})),n.mountComponent(r,i),aT}function aT(t,e){var o=e._4h,r=e._4i;oT(0,r,t),n.updateComponent(o,r)}function iT(t){return t.store.data.isMobile&&!t.props.selectMode?rT:null}function sT(t,e,o){var r=o._43=n.insert(e,n.elem("div",IM)),a=n.createInjector(r);return QA(r,o._44=n.obj(),t),o._45=n.mountBlock(t,a,nT),o._4e=n.mountBlock(t,a,iT),uT}function uT(t,e){QA(e._43,e._44,t),n.updateBlock(e._45),n.updateBlock(e._4e)}function cT(t){return"preview"!==t.props.sequence?sT:null}function pT(t,e){return e.errorMessage}function lT(t,e,o){var r=n.insert(e,n.elem("div",IM),""),a=n.createInjector(r);return n.setClass(r,"error-text-okmsg"),n.setAttribute(r,"data-tsid","error_in_message"),o._4x=n.mountInnerHTML(t,a,pT),MM[1]=1,mT}function mT(t,e){MM[1]|=n.updateInnerHTML(e._4x)}function dT(t,e){return e.errorMessage?lT:null}function _T(t,e,n,o){e.key="error-"+o.errorCode}function fT(t,e,o){var r=o._53=n.insert(e,n.createComponent("msg-l10n",ae,t),""),a=o._54=n.propsSet(r,{class:"error-text-okmsg","data-tsid":"error_in_message"});return _T(0,a,0,o),n.mountComponent(r,a),MM[1]=1,gT}function gT(t,e){var o=e._53,r=e._54;_T(0,r,0,e),n.updateComponent(o,r)}function vT(t,e){return e.errorMessage?null:fT}function hT(t,e,o){var r=n.insert(e,n.elem("div",IM));n.setClass(r,"error-okmsg"),n.setAttribute(r,"data-tsid","error_in_message");var a=o._4r=n.appendChild(r,n.createComponent("msg-tico",rc,t)),i=a.componentModel.input;return o._4t=n.mountBlock(t,i,dT),o._50=n.mountBlock(t,i,vT),o._55=n.insert(i,n.text("\n")),n.mountComponent(a,n.propsSet(a,{icon:"error"})),CT}function CT(t,e){n.updateBlock(e._4t),n.updateBlock(e._50),MM[1]|=n.updateText(e._55,"\n"),n.updateIncomingSlot(e._4r,"",MM[1])}function kT(t){return n.get(t.props.message,"error")?hT:null}function bT(t,e,n){e.tabindex=n.props.focusMode?0:-1,e.style="opacity: "+-n.state.offset/50}function yT(t,e,o){var r=o._59=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._5a=n.propsSet(r,{shape:"circle",class:"secondary-okmsg quick-reply-okmsg"});bT(0,i,t);var s=o._5b=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"reply"})),n.mountComponent(r,i),ST}function ST(t,e){var o=e._59,r=e._5a;bT(0,r,t),n.updateComponent(o,r)}function wT(t){return t.store.data.isMobile&&"preview"!==t.props.sequence?yT:null}function ET(t,e){var o=t.componentView;TM();var r=n.createInjector(o),a=e._1=n.obj();PM(t,e),e._18=n.mountBlock(t,r,zM),e._1f=n.mountBlock(t,r,FM);var i=e._1n=n.insert(r,n.elem("div",IM)),s=n.createInjector(i);VM(i,e._1o=n.obj(),t,e);var u=n.insert(s,n.elem("div",IM)),c=n.createInjector(u);n.setClass(u,"main-okmsg"),e._1q=n.mountBlock(t,c,XM);var p=e._1x=n.insert(c,n.elem("div",IM)),l=n.createInjector(p);n.setPendingRef(a,"contents",p);var m=e._1y=n.pendingEvents(t,p),d=e._1z=n.obj(),_=e._20=n.obj();return QM(d,t,e),e._21=n.mountBlock(t,l,tA),e._27=n.mountBlock(t,l,rA),e._2c=n.mountBlock(t,l,uA),e._2h=n.mountBlock(t,l,mA),e._2n=n.mountBlock(t,l,gA),e._2s=n.mountBlock(t,l,CA),e._2w=n.mountBlock(t,l,MA),e._38=n.mountBlock(t,l,PA),e._3d=n.mountBlock(t,l,zA),n.finalizePendingEvents(m),n.finalizeAttributes(p,d,_),e._3i=n.mountBlock(t,c,VA),e._3r=n.mountBlock(t,s,XA),e._40=n.mountBlock(t,r,cT),e._4n=n.mountBlock(t,r,kT),e._56=n.mountBlock(t,r,wT),jM(),n.subscribeStore(t,["config","isMobile"]),n.finalizePendingRefs(t,a),xT}function xT(t,e){var o=e._1,r=e._1x,a=e._1z;TM(),PM(t,e),n.updateBlock(e._18),n.updateBlock(e._1f),VM(e._1n,e._1o,t,e),n.updateBlock(e._1q),n.setPendingRef(o,"contents",r),QM(a,t,e),n.updateBlock(e._21),n.updateBlock(e._27),n.updateBlock(e._2c),n.updateBlock(e._2h),n.updateBlock(e._2n),n.updateBlock(e._2s),n.updateBlock(e._2w),n.updateBlock(e._38),n.updateBlock(e._3d),n.finalizePendingEvents(e._1y),n.finalizeAttributes(r,a,e._20),n.updateBlock(e._3i),n.updateBlock(e._3r),n.updateBlock(e._40),n.updateBlock(e._4n),n.updateBlock(e._56),jM(),n.finalizePendingRefs(t,o)}function IT(t,e){e.ifExpr_1=n.get(e.message,"zoom")}function BT(t,e,o,r){n.updateClass(t,e,"txt-okmsg"+(o.state.largeEmoji&&!r.emojiAsSticker?" __emoji-okmsg":"")+(r.emojiAsSticker?" __no-bg-okmsg":""))}function MT(t,e,o,r){n.updateAttribute(t,e,"data-ref",n.get(r.msg,"id")||""),n.updateAttribute(t,e,"style",r.ifExpr_1?"font-size: "+14*n.get(r.message,"zoom")/100+"px; line-height: "+15*n.get(r.message,"zoom")/100+"px;":void 0)}function AT(t,e,o){var r=o._5o=n.insert(e,n.elem("span",IM));n.setPendingRef(o._1,"ownText",r);var a=o._5p=n.obj();return n.setAttribute(r,"data-tsid","message_text"),MT(r,a,0,o),o._5q=n.mountUse(t,r,Qr,[t.state.tokens,t.state.largeEmoji]),o._5r=n.addEvent(r,"linkenter",Xr,t,o),TT}function TT(t,e){var o=e._5o;n.setPendingRef(e._1,"ownText",o),MT(o,e._5p,0,e),n.updateUse(e._5q,[t.state.tokens,t.state.largeEmoji])}function jT(t){return Tt(0,t.state.tokens)?AT:null}function PT(t,e,o,r){n.updateClass(t,e,"meta-okmsg"+(r.emojiAsSticker&&o.props.hasReactions?" __reactions-okmsg":""))}function RT(t,e,o,r){e.dialog=o.props.dialog,e.mine=o.props.mine,e.reactions=n.get(o.props.message,"reactionInfo"),e.animated=o.state.mounted,e.message=o.props.message,e.container=o.props.container,e.isVisible=o.props.isVisible,e.lastReaction=o.props.lastReaction,e.canreact=r.canreact,e.class=o.state.active?"__active-okmsg":""}function LT(t,e){t.setState({reactionsOpen:!0})}function OT(t,e){t.setState({reactionsOpen:!1})}function zT(t,e){var o=e._63,r=e._64;RT(0,r,t,e),n.updateComponent(o,r)}function DT(t,e,o){return o._63?zT(t,o):function(t,e,o){var r=o._63=n.insert(e,n.createComponent("msg-message-reactions",gM,t)),a=o._64=n.propsSet(r,{type:"emoji","data-l":"t,message-reactions"});RT(0,a,t,o),o._65=n.addEvent(r,"activate-menu",LT,t,o),o._66=n.addEvent(r,"deactivate-menu",OT,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._63,n.createAnimation(t.state.mounted?"reactions 0.15s":"",IM)),UT}function UT(t,e){zT(t,e)}function NT(t,e){return e.emojiAsSticker&&t.props.hasReactions?DT:null}function qT(t,e,n,o){e.message=n.props.message,e["has-reactions"]=n.props.hasReactions,e.dialog=n.props.dialog,e.type=o.emojiAsSticker?"emoji":"inline"}function HT(t,e,o){var r=o._5w=n.insert(e,n.elem("div",IM)),a=n.createInjector(r);PT(r,o._5x=n.obj(),t,o),o._5y=n.mountBlock(t,a,NT);var i=o._68=n.insert(a,n.createComponent("msg-message-meta",UI,t)),s=o._69=n.propsSet(i);return qT(0,s,t,o),n.mountComponent(i,s),FT}function FT(t,e){var o=e._68,r=e._69;PT(e._5w,e._5x,t,e),n.updateBlock(e._5y),qT(0,r,t,e),n.updateComponent(o,r)}function VT(t,e){return e.meta?HT:null}function KT(t,e,o){IT(0,o);var r=o._5j=n.insert(e,n.elem("div",IM)),a=n.createInjector(r);return BT(r,o._5k=n.obj(),t,o),o._5l=n.mountBlock(t,a,jT),o._5t=n.mountBlock(t,a,VT),WT}function WT(t,e){IT(0,e),BT(e._5j,e._5k,t,e),n.updateBlock(e._5l),n.updateBlock(e._5t)}LM.dispose=function(t){t._1d=n.removeEvent("click",t._1d),t._1b=n.unmountComponent(t._1b),t._1c=null},qM.dispose=function(t){t._1j=n.detachPendingEvents(t._1j),t._1i=n.unmountComponent(t._1i),t._1k=null},GM.dispose=function(t){t._1v=n.removeEvent("end",t._1v),t._1t=n.unmountComponent(t._1t),t._1u=null},$M.dispose=function(t){t._24=n.unmountComponent(t._24),t._25=null},nA.dispose=function(t){t._2a=n.unmountComponent(t._2a),t._2b=null},iA.dispose=function(t){t._2f=n.unmountComponent(t._2f),t._2g=null},pA.dispose=function(t){t._2m=n.removeEvent("click",t._2m),t._2k=n.unmountComponent(t._2k),t._2l=null},_A.dispose=function(t){t._2q=n.unmountComponent(t._2q),t._2r=null},vA.dispose=function(t){t._2v=n.unmountPartial(t._2v)},bA.dispose=function(t){t._32=n.unmountComponent(t._32),t._33=null},wA.dispose=function(t){t._36=n.unmountComponent(t._36),t._37=null},IA.dispose=function(t){t._2z=n.unmountBlock(t._2z)},TA.dispose=function(t){t._3b=n.unmountComponent(t._3b),t._3c=null},LA.dispose=function(t){t._3g=n.unmountComponent(t._3g),t._3h=null},HA.dispose=function(t,e){n.animate(t._3n,n.createAnimation("reactions 0.15s reverse",IM),(function(){return function(t){var e=t._3n;t._3p=n.removeEvent("activate-menu",t._3p),t._3q=n.removeEvent("deactivate-menu",t._3q),t._3n=n.unmountComponent(e),n.domRemove(e),t._3o=null}(t)}))},GA.dispose=function(t){t._3w=n.removeEvent("click",t._3w),t._3u=n.unmountComponent(t._3u),t._3v=t._3x=null},tT.dispose=function(t){t._4a=n.removeEvent("activate-menu",t._4a),t._4b=n.removeEvent("deactivate-menu",t._4b),t._4c=n.removeEvent("reset",t._4c),t._48=n.unmountComponent(t._48),t._49=null},rT.dispose=function(t){t._4j=n.removeEvent("click",t._4j),t._4k=n.unmountComponent(t._4k),t._4h=n.unmountComponent(t._4h),t._4i=null},sT.dispose=function(t){t._45=n.unmountBlock(t._45),t._4e=n.unmountBlock(t._4e),t._44=t._43=null},lT.dispose=function(t){t._4x=n.unmountInnerHTML(t._4x),MM[1]=1},fT.dispose=function(t){t._53=n.unmountComponent(t._53),t._54=null,MM[1]=1},hT.dispose=function(t){t._4t=n.unmountBlock(t._4t),t._50=n.unmountBlock(t._50),t._4r=n.unmountComponent(t._4r),t._55=null},yT.dispose=function(t){t._5b=n.unmountComponent(t._5b),t._59=n.unmountComponent(t._59),t._5a=null},ET.dispose=function(t){TM(),t._18=n.clearBlock(t._18),t._1f=n.clearBlock(t._1f),t._1q=n.unmountBlock(t._1q),t._1y=n.detachPendingEvents(t._1y),t._21=n.unmountBlock(t._21),t._27=n.unmountBlock(t._27),t._2c=n.unmountBlock(t._2c),t._2h=n.unmountBlock(t._2h),t._2n=n.unmountBlock(t._2n),t._2s=n.unmountBlock(t._2s),t._2w=n.unmountBlock(t._2w),t._38=n.unmountBlock(t._38),t._3d=n.unmountBlock(t._3d),t._3i=n.unmountBlock(t._3i),t._3r=n.unmountBlock(t._3r),t._40=n.clearBlock(t._40),t._4n=n.clearBlock(t._4n),t._56=n.clearBlock(t._56),jM()},AT.dispose=function(t){t._5q=n.unmountUse(t._5q),t._5r=n.removeEvent("linkenter",t._5r),t._5p=t._5o=null},DT.dispose=function(t,e){n.animate(t._63,n.createAnimation("reactions .15s reverse",IM),(function(){return function(t){var e=t._63;t._65=n.removeEvent("activate-menu",t._65),t._66=n.removeEvent("deactivate-menu",t._66),t._63=n.unmountComponent(e),n.domRemove(e),t._64=null}(t)}))},HT.dispose=function(t){t._5y=n.unmountBlock(t._5y),t._68=n.unmountComponent(t._68),t._5x=t._69=t._5w=null},KT.dispose=function(t){t._5l=n.unmountBlock(t._5l),t._5t=n.unmountBlock(t._5t),t._5k=t._5j=null};var GT={__proto__:null,cssScope:IM,partials:BM,default:ET,plugins:Dr,events:Ur,extend:Nr,isSameMessage:qr,messageOpt:Fr,emojiRenderer:Wr,renderOpt:Gr,onLinkEnter:Xr,messageText:Qr,highlight:Jr,parseMessage:$r,willUnmount:function(t){var e=t.refs.ownText;if(e)for(var n=e.querySelectorAll("a"),o=0;o<n.length;o++){var r=n[o];r&&r.classList.contains("mention")&&Lr(r)}},didMount:function(t){t.state.mounted=!0},didChange:function(e,n){var o,r,a,i=n.message,s=n.selectMode,u=n.highlights,c=n.allowCommands,p=n.hasReactions;if(null==i?void 0:i.current){var l="FORWARD"===(null===(o=null==(C=i.current)?void 0:C.link)||void 0===o?void 0:o.type)?C.link.message:C;if(l.text){e.setState({largeEmoji:aa(l)&&!l.attaches.length});var m=function(t){var e,n;mr();var o=null,r=null==t?void 0:t.id;if(r&&void 0===(o=er.get(r))){var a=null===(n=null===(e=t.text)||void 0===e?void 0:e.toLowerCase())||void 0===n?void 0:n.replace(/ё/g,"е");if(a){var i=nr.find((function(t){return a.includes(t.phrase)}));o=(null==i?void 0:i.theme)||null}er.set(r,o)}return o}(l),d=(a=m,mr(),a&&rr.get(a));if(!e.state.animatedBg&&!e.state.customBgStyle&&d){var _=d.staticUrl;if(_){var f=d.bgColor,g="background-image: url(".concat(_,");");f&&(g+="background-color: ".concat(f,";")),e.setState({customBgStyle:g})}else e.setState({animatedBg:d})}if((null===(r=null==i?void 0:i.prev)||void 0===r?void 0:r.unread)&&m){var v=function(t){var e;mr();var n=t&&or.get(t);return n&&(e=n[Math.floor(Math.random()*n.length)]),e}(m);e.setState({wordsAnimateUrl:v});var h=e.props.mine;new Promise((function(e,n){t(["OK/logger"],e,n)})).then((function(t){return t.success("messagesLayer",h?"animate-words-mine":"animate-words",m)}))}}}if(s&&!s.current&&s.prev&&e.setState({active:null}),(i&&!qr(i.current,i.prev)||u||c)&&ta(e),p&&e.state.mounted){var C=p.current,k=p.prev;(!C&&k||C&&!k)&&function(t){var e,n=function(o){Zt(t,"reaction-height"),o-(e=e||o)<150&&requestAnimationFrame(n)};requestAnimationFrame(n)}(e)}},onQuoteClick:ea,onToggleSelect:na,onOpenCongratsMenu:oa,onDeactivateMenu:function(t){t.setState({menuOpen:!1}),t.state.focusMode&&ua(t,hr(t))},onResetFocus:ra,showModalMessageControls:sa};function YT(t,e){e.props.clickable&&Zp(t,{useBack:!0})}var XT="eh4vxy5",QT=[0,0,0],JT=[];function $T(){JT.push(QT),QT=[0,0,0]}function ZT(){QT=JT.pop()}function tj(t,e){e.count=Tt(0,t.state.otherUsers)}function ej(t){return t.state.visibleUsers}function nj(t,e,n,o){e.user=o.value}function oj(t,e,o,r){n.updateClass(t,e,"msg-user-okmsg"+(o.props.clickable&&!n.get(r.value,"deleted")?" link-okmsg":""))}function rj(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"deleted-user"})),QT[0]=1}function aj(t,e,o,r){YT(n.get(r.value,"id"),t)}function ij(t,e,n,o){e.user=o.value,e.size=n.props.size}function sj(t,e,o){n.setPendingEvent(o._9,"click",aj,o);var r=o._j=n.insert(e,n.createComponent("msg-user-card",Nh,t)),a=o._k=n.propsSet(r);ij(0,a,t,o),n.mountComponent(r,a);var i=o._l=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),s=i.componentModel.input;return o._n=n.insert(s,n.text(n.get(o.value,"name"))),n.mountComponent(i,n.propsSet(i,{class:"name-okmsg",disableFormatting:!0,disableLinks:!0})),QT[0]=1,uj}function uj(t,e){var o=e._j,r=e._k;n.setPendingEvent(e._9,"click",aj,e),ij(0,r,t,e),n.updateComponent(o,r),QT[1]|=n.updateText(e._n,n.get(e.value,"name")),n.updateIncomingSlot(e._l,"",QT[1])}function cj(t,e){return n.get(e.value,"deleted")?rj:sj}function pj(t,e){n.insert(e,n.text(", "))}function lj(t,e){return e.index<Tt(0,t.state.visibleUsers)-1?pj:null}function mj(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-sc-menu",vC,t)),a=r.componentModel.input,i=o._7=n.propsSet(r);nj(0,i,0,o);var s=o._8=n.insert(a,n.elem("div",XT),""),u=n.createInjector(s),c=o._9=n.pendingEvents(t,s);return oj(s,o._a=n.obj(),t,o),o._b=n.mountBlock(t,u,cj),n.finalizePendingEvents(c),n.mountComponent(r,i),o._r=n.mountBlock(t,e,lj),dj}function dj(t,e){var o=e._6,r=e._7;nj(0,r,0,e),oj(e._8,e._a,t,e),n.updateBlock(e._b),n.finalizePendingEvents(e._9),n.updateIncomingSlot(o,"",QT[0]),n.updateComponent(o,r),n.updateBlock(e._r)}function _j(t){return t.state.otherUsers}function fj(t,e,n,o){e.user=o.value}function gj(t,e,o){n.updateClass(t,e,"msg-user-okmsg"+(o.props.clickable?" link-okmsg":""))}function vj(t,e,o,r){YT(n.get(r.value,"id"),t)}function hj(t,e,n,o){e.user=o.value,e.size=n.props.size}function Cj(t,e,o){o._15=n.insert(e,n.text(" "));var r=o._16=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"and"})),o._18=n.insert(e,n.text(" "));var a=o._19=n.insert(e,n.createComponent("msg-sc-menu",vC,t)),i=a.componentModel.input,s=o._1a=n.propsSet(a);fj(0,s,0,o);var u=o._1b=n.insert(i,n.elem("div",XT),"");gj(u,o._1c=n.obj(),t),o._1d=n.addEvent(u,"click",vj,t,o);var c=o._1e=n.appendChild(u,n.createComponent("msg-user-card",Nh,t)),p=o._1f=n.propsSet(c);hj(0,p,t,o),n.mountComponent(c,p);var l=o._1g=n.appendChild(u,n.createComponent("msg-parsed-text",ii,t)),m=l.componentModel.input;return o._1i=n.insert(m,n.text(n.get(o.value,"name"))),n.mountComponent(l,n.propsSet(l,{class:"name-okmsg",disableFormatting:!0,disableLinks:!0})),n.mountComponent(a,s),kj}function kj(t,e){var o=e._19,r=e._1a,a=e._1e,i=e._1f;n.updateText(e._15," "),n.updateText(e._18," "),fj(0,r,0,e),gj(e._1b,e._1c,t),hj(0,i,t,e),n.updateComponent(a,i),QT[2]|=n.updateText(e._1i,n.get(e.value,"name")),n.updateIncomingSlot(e._1g,"",QT[2]),n.updateComponent(o,r)}function bj(t,e,o){return o._12=n.mountIterator(t,e,_j,Cj),yj}function yj(t,e){n.updateIterator(e._12)}function Sj(t,e){t.setState({showOtherUsers:!0})}function wj(t,e,n,o){e["data-number"]=o.count,e["data-numberPlural"]=o.count}function Ej(t,e,o){var r=n.insert(e,n.elem("span",XT));n.setClass(r,"others-okmsg link-okmsg"),o._1o=n.addEvent(r,"click",Sj,t,o);var a=o._1p=n.appendChild(r,n.createComponent("msg-l10n",ae,t)),i=o._1q=n.propsSet(a,{key:"and-more-people"});return wj(0,i,0,o),n.mountComponent(a,i),xj}function xj(t,e){var o=e._1p,r=e._1q;wj(0,r,0,e),n.updateComponent(o,r)}function Ij(t){return 1==Tt(0,t.state.otherUsers)?bj:Ej}function Bj(t,e,o){return o._z=n.mountBlock(t,e,Ij),Mj}function Mj(t,e){n.updateBlock(e._z)}function Aj(t){return Tt(0,t.state.otherUsers)>0?Bj:null}function Tj(t,e){var o=t.componentView;$T();var r=n.createInjector(o);return tj(t,e),e._3=n.mountIterator(t,r,ej,mj),e._w=n.mountBlock(t,r,Aj),ZT(),jj}function jj(t,e){$T(),tj(t,e),n.updateIterator(e._3),n.updateBlock(e._w),ZT()}rj.dispose=function(t){t._e=n.unmountComponent(t._e),QT[0]=1},sj.dispose=function(t){t._j=n.unmountComponent(t._j),t._l=n.unmountComponent(t._l),t._k=t._n=null,QT[0]=1},mj.dispose=function(t){t._9=n.detachPendingEvents(t._9),t._b=n.unmountBlock(t._b),t._6=n.unmountComponent(t._6),t._r=n.unmountBlock(t._r),t._7=t._a=t._8=null},Cj.dispose=function(t){t._16=n.unmountComponent(t._16),t._1d=n.removeEvent("click",t._1d),t._1e=n.unmountComponent(t._1e),t._1g=n.unmountComponent(t._1g),t._19=n.unmountComponent(t._19),t._15=t._18=t._1a=t._1c=t._1f=t._1i=t._1b=null},bj.dispose=function(t){t._12=n.unmountIterator(t._12)},Ej.dispose=function(t){t._1o=n.removeEvent("click",t._1o),t._1p=n.unmountComponent(t._1p),t._1q=null},Bj.dispose=function(t){t._z=n.unmountBlock(t._z)},Tj.dispose=function(t){$T(),t._3=n.clearIterator(t._3),t._w=n.clearBlock(t._w),ZT()};var Pj,Rj={__proto__:null,cssScope:XT,default:Tj,props:function(){return{users:null,size:"nano",clickable:!1}},willRender:function(t){var e=t.props.users,n=Array.isArray(e)?e:[e];t.state.showOtherUsers?t.setState({visibleUsers:n.slice(0,n.length-1),otherUsers:n.slice(n.length-1)}):t.setState({visibleUsers:n.slice(0,2),otherUsers:n.slice(2)})},openDialog:YT};!function(t){t.ChatIcon="chat-icon",t.ChatMedia="chat-media",t.Contact="contact",t.Image="image"}(Pj||(Pj={}));var Lj=function(){function t(t){this.appController=t,this.store=t.store}return t.prototype.get=function(){return this.store.get().showMedia||{}},t.prototype.showMedia=function(t,e){void 0===e&&(e={}),this.store.set({showMedia:n.__assign({type:t},e)})},t.prototype.showChatMedia=function(t,e,n){this.appController.store.app.media.selectItem(t,e,n),this.showMedia(Pj.ChatMedia,{chatId:t,sectionId:e})},t.prototype.resetShowMedia=function(){this.store.set({showMedia:null})},t}();function Oj(t){if(t.store.isMobile()){var e=t.props.message,n=(e.attaches[0]||{}).fullUrl;L(t,"showMedia").showMedia(Pj.Image,{src:n,chatId:e.chatId,messageId:e.id})}else Zt(t,"open-conv-icon-layer",{})}var zj="e-e52f77",Dj=[0,0,0],Uj=[];function Nj(){Uj.push(Dj),Dj=[0,0,0]}function qj(){Dj=Uj.pop()}function Hj(t,e){e.control=n.get(t.props.message,"attaches",0),e.type=n.get(t.props.message,"type"),e.gender=t.props.isMine?3:n.get(t.props.message,"sender","gender"),e.chooseExpr="new"==n.get(e.control,"event")&&"USER"==e.type?0:"add"==n.get(e.control,"event")?1:"remove"==n.get(e.control,"event")?2:"joinByLink"==n.get(e.control,"event")?3:"leave"==n.get(e.control,"event")?4:"title"==n.get(e.control,"event")?5:"icon"==n.get(e.control,"event")?6:"pin"==n.get(e.control,"event")?7:"system"==n.get(e.control,"event")?8:"botStarted"==n.get(e.control,"event")?9:10,e.caseExpr_8=8===e.chooseExpr,e.enableLinks=e.caseExpr_8?n.get(t.store.data.config,"server","link-in-system"):void 0}function Fj(t,e,o){e.users=n.get(o.props.message,"sender"),e.clickable="USER"==n.get(o.props.message,"type")}function Vj(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-users-list",Rj,t)),a=o._d=n.propsSet(r,{size:"nano"});return Fj(0,a,t),n.mountComponent(r,a),Kj}function Kj(t,e){var o=e._c,r=e._d;Fj(0,r,t),n.updateComponent(o,r)}function Wj(t,e){return t.props.isMine||"USER"!=n.get(t.props.message,"type")||"system"==n.get(e.control,"event")?null:Vj}function Gj(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"you"}))}function Yj(t,e){return t.props.isMine&&"CHANNEL"!==e.type?Gj:null}function Xj(t,e,o){return o._i=n.mountBlock(t,e,Yj),o._n=n.insert(e,n.text(" ")),Qj}function Qj(t,e){n.updateBlock(e._i),n.updateText(e._n," ")}function Jj(t,e){return"system"!==n.get(e.control,"event")?Xj:null}function $j(t,e,n,o){e["data-gender"]=o.gender}function Zj(t,e,o){var r=o._r=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._s=n.propsSet(r,{key:"created-chat","data-tsid":"created_chat_system_msg"});return $j(0,a,0,o),n.mountComponent(r,a),tP}function tP(t,e){var o=e._r,r=e._s;$j(0,r,0,e),n.updateComponent(o,r)}function eP(t,e,n,o){e["data-gender"]=o.gender}function nP(t,e,o,r){e.users=n.get(r.control,"users"),e.clickable="USER"==n.get(o.props.message,"type")}function oP(t,e,o){var r=o._v=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._w=n.propsSet(r,{key:"added","data-tsid":"add_users_system_msg"});eP(0,a,0,o),n.mountComponent(r,a),o._x=n.insert(e,n.text(" "));var i=o._y=n.insert(e,n.createComponent("msg-users-list",Rj,t)),s=o._z=n.propsSet(i,{size:"nano"});return nP(0,s,t,o),n.mountComponent(i,s),rP}function rP(t,e){var o=e._v,r=e._w,a=e._y,i=e._z;eP(0,r,0,e),n.updateComponent(o,r),n.updateText(e._x," "),nP(0,i,t,e),n.updateComponent(a,i)}function aP(t,e,n,o){e["data-gender"]=o.gender}function iP(t,e,o,r){e.users=n.get(r.control,"user"),e.clickable="USER"==n.get(o.props.message,"type")}function sP(t,e,o){var r=o._12=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._13=n.propsSet(r,{key:"deleted","data-tsid":"remove_users_from_chat_system_msg"});aP(0,a,0,o),n.mountComponent(r,a),o._14=n.insert(e,n.text(" "));var i=o._15=n.insert(e,n.createComponent("msg-users-list",Rj,t)),s=o._16=n.propsSet(i,{size:"nano"});return iP(0,s,t,o),n.mountComponent(i,s),uP}function uP(t,e){var o=e._12,r=e._13,a=e._15,i=e._16;aP(0,r,0,e),n.updateComponent(o,r),n.updateText(e._14," "),iP(0,i,t,e),n.updateComponent(a,i)}function cP(t,e,n,o){e["data-gender"]=o.gender}function pP(t,e,o){var r=o._19=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1a=n.propsSet(r,{key:"joinByLink","data-tsid":"join_by_link_system_msg"});return cP(0,a,0,o),n.mountComponent(r,a),lP}function lP(t,e){var o=e._19,r=e._1a;cP(0,r,0,e),n.updateComponent(o,r)}function mP(t,e,n,o){e["data-gender"]=o.gender}function dP(t,e,o){var r=o._1d=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1e=n.propsSet(r,{key:"left-chat","data-tsid":"left_chat_system_msg"});return mP(0,a,0,o),n.mountComponent(r,a),_P}function _P(t,e){var o=e._1d,r=e._1e;mP(0,r,0,e),n.updateComponent(o,r)}function fP(t,e,n,o){e["data-gender"]=o.gender}function gP(t,e,o){var r=o._1k=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1l=n.propsSet(r,{key:"removed-chat-title"});return fP(0,a,0,o),n.mountComponent(r,a),vP}function vP(t,e){var o=e._1k,r=e._1l;fP(0,r,0,e),n.updateComponent(o,r)}function hP(t,e,n,o){e["data-gender"]=o.gender}function CP(t,e,o){var r=o._1o=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1p=n.propsSet(r,{key:"changed-chat-title","data-tsid":"change_chat_title_system_msg"});hP(0,a,0,o),n.mountComponent(r,a);var i=o._1q=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),s=i.componentModel.input;return o._1s=n.insert(s,n.text(": ")),n.insert(s,n.text(" «")),o._1u=n.insert(s,n.text(n.get(o.control,"title"))),n.insert(s,n.text("»\n                        ")),n.mountComponent(i,n.propsSet(i,{disableFormatting:!0,disableLinks:!0,class:"new-title-okmsg","data-tsid":"new_chat_title",emojiSize:16,emojiContext:"chat-title"})),kP}function kP(t,e){var o=e._1o,r=e._1p;hP(0,r,0,e),n.updateComponent(o,r),Dj[0]|=n.updateText(e._1s,": "),Dj[0]|=n.updateText(e._1u,n.get(e.control,"title")),n.updateIncomingSlot(e._1q,"",Dj[0])}function bP(t,e){return n.get(e.control,"title")?CP:gP}function yP(t,e,o){return o._1h=n.mountBlock(t,e,bP),SP}function SP(t,e){n.updateBlock(e._1h)}function wP(t,e,n,o){e["data-gender"]=o.gender}function EP(t,e,o){var r=o._22=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._23=n.propsSet(r,{key:"removed-chat-icon","data-tsid":"removed_chat_icon_system_msg"});return wP(0,a,0,o),n.mountComponent(r,a),xP}function xP(t,e){var o=e._22,r=e._23;wP(0,r,0,e),n.updateComponent(o,r)}function IP(t,e,n,o){e["data-gender"]=o.gender}function BP(t,e,o){var r=o._26=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._27=n.propsSet(r,{key:"changed-chat-icon","data-tsid":"changed_chat_icon_system_msg"});return IP(0,a,0,o),n.mountComponent(r,a),MP}function MP(t,e){var o=e._26,r=e._27;IP(0,r,0,e),n.updateComponent(o,r)}function AP(t,e){return n.get(e.control,"url")?BP:EP}function TP(t,e,o){return o._1z=n.mountBlock(t,e,AP),jP}function jP(t,e){n.updateBlock(e._1z)}function PP(t,e,n,o){e["data-gender"]=o.gender}function RP(t,e,o){var r=o._2a=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._2b=n.propsSet(r,{key:"changed-pinned-message","data-tsid":"changed_pinned_msg_system_msg"});return PP(0,a,0,o),n.mountComponent(r,a),LP}function LP(t,e){var o=e._2a,r=e._2b;PP(0,r,0,e),n.updateComponent(o,r)}function OP(t,e,n,o){e.disableLinks=!o.enableLinks,e.openInsidePortal=o.enableLinks,e.class="text-okmsg"+(o.enableLinks?" __clickable-okmsg":"")}function zP(t,e,o){var r=o._2e=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input,i=o._2f=n.propsSet(r,{disableFormatting:!0});return OP(0,i,0,o),o._2g=n.insert(a,n.text(n.get(o.control,"message"))),n.mountComponent(r,i),DP}function DP(t,e){var o=e._2e,r=e._2f;OP(0,r,0,e),Dj[1]|=n.updateText(e._2g,n.get(e.control,"message")),n.updateIncomingSlot(o,"",Dj[1]),n.updateComponent(o,r)}function UP(t,e,n,o){e["data-gender"]=o.gender}function NP(t,e,o){var r=o._2k=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._2l=n.propsSet(r,{key:"bot-started"});return UP(0,a,0,o),n.mountComponent(r,a),qP}function qP(t,e){var o=e._2k,r=e._2l;UP(0,r,0,e),n.updateComponent(o,r)}function HP(t,e,o){var r=o._2o=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._2q=n.insert(a,n.text(n.get(t.props.message,"text"))),n.mountComponent(r,n.propsSet(r,{disableFormatting:!0,disableLinks:!0,class:"text-okmsg"})),FP}function FP(t,e){Dj[2]|=n.updateText(e._2q,n.get(t.props.message,"text")),n.updateIncomingSlot(e._2o,"",Dj[2])}function VP(t,e){return[Zj,oP,sP,pP,dP,yP,TP,RP,zP,NP,HP][e.chooseExpr]}function KP(t,e,o,r){n.updateAttribute(t,e,"src",n.get(r.control,"url"))}function WP(t,e,o){var r=o._2v=n.insert(e,n.elem("img",zj)),a=o._2w=n.obj();return n.setClass(r,"icon-okmsg"),n.setAttribute(r,"alt",""),n.setAttribute(r,"data-tsid","chat_icon_in_system_message"),KP(r,a,0,o),o._2x=n.addEvent(r,"click",Oj,t,o),GP}function GP(t,e){KP(e._2v,e._2w,0,e)}function YP(t,e){return"icon"==n.get(e.control,"event")&&n.get(e.control,"url")?WP:null}function XP(t,e){var o=t.componentView;Nj();var r=n.createInjector(o);Hj(t,e);var a=n.insert(r,n.elem("div",zj)),i=n.createInjector(a);return n.setClass(a,"message-okmsg"),e._9=n.mountBlock(t,i,Wj),e._f=n.mountBlock(t,i,Jj),e._o=n.mountBlock(t,i,VP),e._2s=n.mountBlock(t,r,YP),qj(),n.subscribeStore(t,["config"]),QP}function QP(t,e){Nj(),Hj(t,e),n.updateBlock(e._9),n.updateBlock(e._f),n.updateBlock(e._o),n.updateBlock(e._2s),qj()}Vj.dispose=function(t){t._c=n.unmountComponent(t._c),t._d=null},Gj.dispose=function(t){t._l=n.unmountComponent(t._l)},Xj.dispose=function(t){t._i=n.unmountBlock(t._i),t._n=null},Zj.dispose=function(t){t._r=n.unmountComponent(t._r),t._s=null},oP.dispose=function(t){t._v=n.unmountComponent(t._v),t._y=n.unmountComponent(t._y),t._w=t._x=t._z=null},sP.dispose=function(t){t._12=n.unmountComponent(t._12),t._15=n.unmountComponent(t._15),t._13=t._14=t._16=null},pP.dispose=function(t){t._19=n.unmountComponent(t._19),t._1a=null},dP.dispose=function(t){t._1d=n.unmountComponent(t._1d),t._1e=null},gP.dispose=function(t){t._1k=n.unmountComponent(t._1k),t._1l=null},CP.dispose=function(t){t._1o=n.unmountComponent(t._1o),t._1q=n.unmountComponent(t._1q),t._1p=t._1s=t._1u=null},yP.dispose=function(t){t._1h=n.unmountBlock(t._1h)},EP.dispose=function(t){t._22=n.unmountComponent(t._22),t._23=null},BP.dispose=function(t){t._26=n.unmountComponent(t._26),t._27=null},TP.dispose=function(t){t._1z=n.unmountBlock(t._1z)},RP.dispose=function(t){t._2a=n.unmountComponent(t._2a),t._2b=null},zP.dispose=function(t){t._2e=n.unmountComponent(t._2e),t._2f=t._2g=null},NP.dispose=function(t){t._2k=n.unmountComponent(t._2k),t._2l=null},HP.dispose=function(t){t._2o=n.unmountComponent(t._2o),t._2q=null},WP.dispose=function(t){t._2x=n.removeEvent("click",t._2x),t._2w=t._2v=null},XP.dispose=function(t){Nj(),t._9=n.unmountBlock(t._9),t._f=n.unmountBlock(t._f),t._o=n.unmountBlock(t._o),t._2s=n.clearBlock(t._2s),qj()};var JP={__proto__:null,cssScope:zj,default:XP,props:function(){return{message:{},isMine:!1}},onShowIcon:Oj};var $P="e-ulbv3v";function ZP(t,e){var o=t.componentView;return n.appendChild(o,n.createSlot(t,"",$P)),e._2=n.mountSlot(t,""),e._3=n.appendChild(o,n.text(t.state.time)),tR}function tR(t,e){n.updateText(e._3,t.state.time)}ZP.dispose=function(t){t._2=n.unmountSlot(t._2)};var eR={__proto__:null,cssScope:$P,default:ZP,props:function(){return{timestamp:0,format:"HH:MM",viewType:""}},willRender:function(t){var e=t.props,n=e.timestamp,o=e.format;t.setState({time:v(n,o)})}};function nR(t,e,n){var o=e.state.isOpen;if(clearTimeout(e.state.timer),null==t)e.state.timer=setTimeout((function(){return e.setState({active:null,isOpen:!1})}),100);else{var r=e.closest("msg-message-list"),a=n.target.getBoundingClientRect(),i=!1;if(r){var s=r.getBoundingClientRect();i=a.top-s.top<70}o?e.setState({active:t,bottom:i}):e.state.timer=setTimeout((function(){return e.setState({active:t,bottom:i,isOpen:!0})}),300)}}function oR(t){Zp(t,{useBack:!0})}var rR="es929hj",aR=[0,0],iR=[];function sR(){iR.push(aR),aR=[0,0]}function uR(){aR=iR.pop()}function cR(t,e){e.overflowLabel=Math.min(n.get(t.props.message,"participants","length")-t.props.maxVisible)}function pR(t){return n.filter(n.get(t.props.message,"participants"),(function(e,o){return o<t.props.maxVisible&&!n.get(e,"user","current")}))}function lR(t,e,o,r){nR(n.get(r.value,"user","id"),t,e)}function mR(t,e,n){nR(null,t,e)}function dR(t,e,o,r){e.url=Wt(0,n.get(r.value,"user"),"nano"),e.id=n.get(r.value,"user","id"),e.caption=n.get(r.value,"user","name")}function _R(t,e,n){e.class=(n.state.bottom?"__bottom-okmsg":"")+(n.props.inChat?" clickable-okmsg":"")}function fR(t,e,o,r){oR(n.get(r.value,"user","id"))}function gR(t,e){t.props.inChat&&n.setPendingEvent(e._h,"click",fR,e)}function vR(t,e,o,r){e.url=Wt(0,n.get(r.value,"user"),"medium"),e.id=n.get(r.value,"user","id"),e.caption=n.get(r.value,"user","name")}function hR(t,e,o,r){e.official=n.get(r.value,"user","official"),e.class=o.props.inChat?"link-okmsg":""}function CR(t,e,o,r){e.timestamp=n.get(r.value,"time")}function kR(t,e,o,r){e["data-gender"]=n.get(r.value,"user","gender")}function bR(t,e){var o=e._g,r=e._i,a=e._l,i=e._m,s=e._n,u=e._o,c=e._r,p=e._s,l=e._t,m=e._u;_R(0,r,t),gR(t,e),vR(0,i,0,e),n.updateComponent(a,i),hR(0,u,t,e),aR[0]|=n.updateText(e._p,n.get(e.value,"user","name")),n.updateIncomingSlot(s,"",aR[0]),n.updateComponent(s,u),CR(0,p,0,e),kR(0,m,0,e),n.updateComponent(l,m),aR[1]|=n.updateText(e._v," "),n.updateIncomingSlot(c,"",aR[1]),n.updateComponent(c,p),n.finalizePendingEvents(e._h),n.updateComponent(o,r)}function yR(t,e,o){return o._g?bR(t,o):function(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-chat-item-container",eb,t)),a=r.componentModel.input,i=o._h=n.pendingEvents(t,r),s=o._i=n.propsSet(r,{size:"small"});_R(0,s,t),gR(t,o);var u=o._l=n.insert(a,n.createComponent("msg-avatar",Hp,t),"image"),c=o._m=n.propsSet(u,{slot:"image",size:"medium"});vR(0,c,0,o),n.mountComponent(u,c);var p=o._n=n.insert(a,n.createComponent("msg-name",Sh,t),"title"),l=p.componentModel.input,m=o._o=n.propsSet(p,{size:"small",slot:"title"});hR(0,m,t,o),o._p=n.insert(l,n.text(n.get(o.value,"user","name"))),n.mountComponent(p,m);var d=o._r=n.insert(a,n.createComponent("msg-time",eR,t),""),_=d.componentModel.input,f=o._s=n.propsSet(d);CR(0,f,0,o);var g=o._t=n.insert(_,n.createComponent("msg-l10n",ae,t),""),v=o._u=n.propsSet(g,{key:"read"});kR(0,v,0,o),n.mountComponent(g,v),o._v=n.insert(_,n.text(" ")),n.mountComponent(d,f),n.finalizePendingEvents(i),n.mountComponent(r,s)}(t,e,o),n.animate(o._g,n.createAnimation("global:msg-pop-in .25s cubic-bezier(.4, 0, .3, 1.2)",rR)),SR}function SR(t,e){bR(t,e)}function wR(t,e){return t.state.active===n.get(e.value,"user","id")?yR:null}function ER(t,e,o){var r=n.insert(e,n.elem("div",rR)),a=n.createInjector(r);n.setClass(r,"item-okmsg"),o._7=n.addEvent(r,"mouseenter",lR,t,o),o._8=n.addEvent(r,"mouseleave",mR,t,o);var i=o._9=n.insert(a,n.createComponent("msg-avatar",Hp,t)),s=o._a=n.propsSet(i,{size:"nano"});return dR(0,s,0,o),n.mountComponent(i,s),o._b=n.mountBlock(t,a,wR),xR}function xR(t,e){var o=e._9,r=e._a;dR(0,r,0,e),n.updateComponent(o,r),n.updateBlock(e._b)}function IR(t,e,o,r){n.updateClass(t,e,"overflow-label-okmsg"+(r.overflowLabel>9&&r.overflowLabel<20&&11!==r.overflowLabel?" __shift-okmsg":""))}function BR(t){Zt(t,"open-chat-read-participants",{participants:n.get(t.props.message,"participants"),messageId:n.get(t.props.message,"messageId")})}function MR(t,e,o){var r=o._13=n.insert(e,n.elem("div",rR));return IR(r,o._14=n.obj(),0,o),o._15=n.addEvent(r,"click",BR,t,o),o._16=n.appendChild(r,n.text(Math.min(o.overflowLabel,t.props.maxLabel))),AR}function AR(t,e){IR(e._13,e._14,0,e),n.updateText(e._16,Math.min(e.overflowLabel,t.props.maxLabel))}function TR(t,e){return e.overflowLabel>1?MR:null}function jR(t,e){var o=t.componentView;sR();var r=n.createInjector(o);return cR(t,e),e._3=n.mountIterator(t,r,pR,ER),e._10=n.mountBlock(t,r,TR),uR(),PR}function PR(t,e){sR(),cR(t,e),n.updateIterator(e._3),n.updateBlock(e._10),uR()}yR.dispose=function(t,e){n.animate(t._g,n.createAnimation("global:msg-pop-out .15s ease-out",rR),(function(){return function(t){var e=t._g;t._h=n.detachPendingEvents(t._h),t._l=n.unmountComponent(t._l),t._n=n.unmountComponent(t._n),t._t=n.unmountComponent(t._t),t._r=n.unmountComponent(t._r),t._g=n.unmountComponent(e),n.domRemove(e),t._i=t._m=t._o=t._p=t._s=t._u=t._v=null}(t)}))},ER.dispose=function(t){t._7=n.removeEvent("mouseenter",t._7),t._8=n.removeEvent("mouseleave",t._8),t._9=n.unmountComponent(t._9),t._b=n.unmountBlock(t._b),t._a=null},MR.dispose=function(t){t._15=n.removeEvent("click",t._15),t._14=t._16=t._13=null},jR.dispose=function(t){sR(),t._3=n.clearIterator(t._3),t._10=n.clearBlock(t._10),uR()};var RR={__proto__:null,cssScope:rR,default:jR,props:function(){return{message:null,maxVisible:10,maxLabel:99,isMine:!1,inChat:!0}},setActive:nR,openDialog:oR},LR=12;var OR=864e5;function zR(t){var e=t.state,n=e.currMonth,o=e.currYear,r=e.maxMonth,a=e.maxYear;if(n!==r||o!==a){var i=function(t,e){var n=(LR+e+1)%LR;return n<e&&t++,{month:n,year:t}}(t.state.currYear,t.state.currMonth),s=qR(i.year,i.month),u=NR(t,s,HR(i.year,i.month));Zt(t,"model-update",{stamp:s}),t.setState({currYear:i.year,currMonth:i.month,model:u}),OK.logger.success("messagesLayer","date-picker","next-month")}}function DR(t){var e=t.state,n=e.currMonth,o=e.currYear,r=e.minMonth,a=e.minYear;if(n!==r||o!==a){var i=function(t,e){var n=(LR+e-1)%LR;return n>e&&t--,{year:t,month:n}}(t.state.currYear,t.state.currMonth),s=qR(i.year,i.month),u=NR(t,s,HR(i.year,i.month));Zt(t,"model-update",{stamp:s}),t.setState({currYear:i.year,currMonth:i.month,model:u}),OK.logger.success("messagesLayer","date-picker","prev-month")}}function UR(t,e){var n=Number(e.target.closest(".js-date").dataset.id),o=t.state.model[n];if(o.isNextMonth)return zR(t);if(o.isPrevMonth)return DR(t);if(!o.disabled){var r=o.stamp,a=t.state.selected;t.setState({selected:r}),Zt(t,"selected",{stamp:r,prevStamp:a})}}function NR(t,e,n){for(var o=FR(new Date),r=e-((new Date(e).getDay()||7)-1)*OR,a=[],s=t.props,u=s.disableBefore,c=void 0===u?0:u,p=s.disabled,l=void 0===p?new i:p,m=FR(c),d=r;a.length<42;){var _=new Date(d),f=d<e,g=d>n,v=l.has(d)||d<m;a.push({stamp:d,weekDay:_.getDate(),isToday:d===o,disabled:f||g||d>=o||v,isPrevMonth:f,isNextMonth:g}),d+=OR}return a}function qR(t,e){return new Date(t,e,1).getTime()}function HR(t,e){return new Date(t,e+1,0).getTime()}function FR(t){return new Date(t).setHours(0,0,0,0)}var VR="e-z8n18n";function KR(t,e,n){e.class="control-okmsg __prev-okmsg"+(n.state.currMonth===n.state.minMonth&&n.state.currYear===n.state.minYear?" __disabled-okmsg":"")}function WR(t,e,n){e.class="control-okmsg __next-okmsg"+(n.state.currMonth===n.state.maxMonth&&n.state.currYear===n.state.maxYear?" __disabled-okmsg":"")}function GR(t){return t.state.model}function YR(t,e,o,r){n.updateAttribute(t,e,"data-id",r.index),n.updateClass(t,e,"item-okmsg js-date"+(n.get(r.value,"isToday")?" __today-okmsg":"")+(n.get(r.value,"isPrevMonth")?" __prev-okmsg":"")+(n.get(r.value,"isNextMonth")?" __next-okmsg":"")+(n.get(r.value,"disabled")?" __disabled-okmsg":"")+(n.get(r.value,"stamp")===o.state.selected?" __selected-okmsg":""))}function XR(t,e,o){var r=o._m=n.insert(e,n.elem("div",VR));YR(r,o._n=n.obj(),t,o);var a=n.appendChild(r,n.elem("div",VR));n.setClass(a,"item-bg-okmsg");var i=n.appendChild(r,n.elem("div",VR));return n.setClass(i,"item-text-okmsg"),o._q=n.appendChild(i,n.text(n.get(o.value,"weekDay"))),QR}function QR(t,e){YR(e._m,e._n,t,e),n.updateText(e._q,n.get(e.value,"weekDay"))}function JR(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("div",VR));n.setClass(r,"header-okmsg"),e._2=n.appendChild(r,n.text(n.get(t.state.months,t.state.currMonth))),n.appendChild(r,n.text(" ")),e._4=n.appendChild(r,n.text(t.state.currYear));var a=e._5=n.appendChild(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input,s=e._6=n.propsSet(a);KR(0,s,t),e._7=n.addEvent(a,"click",DR,t,e);var u=e._8=n.insert(i,n.createComponent("msg-icon",xe,t),"");n.mountComponent(u,n.propsSet(u,{icon:"back"})),n.mountComponent(a,s);var c=e._b=n.appendChild(r,n.createComponent("msg-button",fe,t)),p=c.componentModel.input,l=e._c=n.propsSet(c);WR(0,l,t),e._d=n.addEvent(c,"click",zR,t,e);var m=e._e=n.insert(p,n.createComponent("msg-icon",xe,t),"");n.mountComponent(m,n.propsSet(m,{icon:"arrow-right"})),n.mountComponent(c,l);var d=n.appendChild(o,n.elem("div",VR)),_=n.createInjector(d);return n.setClass(d,"dates-okmsg"),e._i=n.addEvent(d,"click",UR,t,e),e._j=n.mountIterator(t,_,GR,XR),$R}function $R(t,e){var o=e._5,r=e._6,a=e._b,i=e._c;n.updateText(e._2,n.get(t.state.months,t.state.currMonth)),n.updateText(e._4,t.state.currYear),KR(0,r,t),n.updateComponent(o,r),WR(0,i,t),n.updateComponent(a,i),n.updateIterator(e._j)}XR.dispose=function(t){t._n=t._q=t._m=null},JR.dispose=function(t){t._7=n.removeEvent("click",t._7),t._8=n.unmountComponent(t._8),t._5=n.unmountComponent(t._5),t._d=n.removeEvent("click",t._d),t._e=n.unmountComponent(t._e),t._b=n.unmountComponent(t._b),t._i=n.removeEvent("click",t._i),t._j=n.unmountIterator(t._j)};var ZR={__proto__:null,cssScope:VR,default:JR,DAY:OR,willMount:function(t){var e=V("months").split(","),n=t.props,o=n.selected,r=n.disableBefore;o=FR(o);var a=new Date,i=a.getMonth(),s=a.getFullYear(),u=new Date(o),c=u.getMonth(),p=u.getFullYear(),l=0,m=0;if(r){var d=new Date(r);l=d.getMonth(),m=d.getFullYear()}var _=qR(p,c),f=HR(p,c);t.setState({currMonth:c,currYear:p,maxYear:s,maxMonth:i,minMonth:l,minYear:m,selected:u.getTime(),months:e,model:NR(t,_,f)}),Zt(t,"model-init",{stamp:_})},willUpdate:function(t,e){if(e.selected||e.disableBefore||e.disabled){var n=t.state,o=n.currMonth,r=n.currYear,a=NR(t,qR(r,o),HR(r,o));t.setState({model:a})}},nextMonth:zR,previousMonth:DR,onSelectDate:UR};function tL(t){eL(t),t._menuHideTimer=window.setTimeout((function(){return oL(t)}),300)}function eL(t){t._menuHideTimer&&(clearTimeout(t._menuHideTimer),t._menuHideTimer=null)}function nL(t,e){eL(t);var n=e.target,o=!1,r=t.refs.control,a=t.closest("msg-message-list");if(r&&a){var i=a.getBoundingClientRect(),s=r.getBoundingClientRect();o=i.bottom-s.bottom<258}t.setState({show:n,alignBottom:o}),te(t,"show"),OK.logger.success("messagesLayer","date-picker","open-menu")}function oL(t){eL(t),t.setState({show:null})}function rL(t,e){iL(t,e.detail.stamp)}function aL(t,e,n){var o=t.props.chatId;return An(o)&&An(e)&&An(n)?t.store.app.chat.chatSearchCountMsg(o,e,n).then((function(e){var n=new i(t.state.disabled);e.noMsgDays.forEach((function(t){return n.add(new Date(t).setHours(0,0,0,0))})),t.setState({disabled:n})})):Promise.resolve()}function iL(t,e){if(t._prevRequestedStamp!==e)if(t._knownFrom){if(t._prevRequestedStamp>e){var n=e-60*OR;n<t._knownFrom&&aL(t,n,t._knownFrom).then((function(){t._knownFrom=n}))}else if(t._prevRequestedStamp<e){var o=e+60*OR;o>t._knownTo&&aL(t,t._knownTo,o).then((function(){t._knownTo=o}))}}else{var r=e-30*OR,a=e+60*OR;t._knownFrom=r,t._knownTo=a,t._prevRequestedStamp=e,aL(t,r,a)}}function sL(t,e){e.detail.animation.startsWith("msg-pop-out")&&te(t,"hide")}var uL="e-tv2hda";function cL(t,e,o){var r=o._7=n.insert(e,n.createComponent("msg-button",fe,t),"button"),a=r.componentModel.input;n.setRef(t,"control",r);var i=o._9=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"calendar"})),n.mountComponent(r,n.propsSet(r,{class:"date-picker-okmsg hollow-okmsg",slot:"button",shape:"circle",size:"medium"}))}function pL(t,e,n){e.disabled=n.state.disabled,e.disableBefore=n.props.disableBefore,e.selected=n.props.selected,e.class=n.state.alignBottom?"bottom-okmsg":""}function lL(t,e){var o=e._i,r=e._j;n.setPendingRef(e._1,"picker",o),pL(0,r,t),n.updateComponent(o,r)}function mL(t,e,o){return o._i?lL(t,o):function(t,e,o){var r=o._i=n.insert(e,n.createComponent("msg-date-picker",ZR,t));n.setPendingRef(o._1,"picker",r);var a=o._j=n.propsSet(r);pL(0,a,t),o._k=n.addEvent(r,"mouseleave",tL,t,o),o._l=n.addEvent(r,"mouseenter",eL,t,o),o._m=n.addEvent(r,"model-update",rL,t,o),o._n=n.addEvent(r,"model-init",rL,t,o),o._o=n.addEvent(r,"selected",oL,t,o),o._p=n.addEvent(r,"animate-end",sL,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._i,n.createAnimation("global:msg-pop-in .3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",uL)),dL}function dL(t,e){lL(t,e)}function _L(t){return t.state.show?mL:null}function fL(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj(),i=n.insert(r,n.createSlot(t,"button",uL));return e._3=n.addEvent(i,"click",nL,t,e),e._4=n.addEvent(i,"mouseleave",tL,t,e),e._c=n.mountSlot(t,"button",cL),e._d=n.mountBlock(t,r,_L),n.finalizePendingRefs(t,a),gL}function gL(t,e){n.updateDefaultSlot(e._c),n.updateBlock(e._d),n.finalizePendingRefs(t,e._1)}cL.dispose=function(t){t._9=n.unmountComponent(t._9),t._7=n.unmountComponent(t._7)},mL.dispose=function(t,e){n.animate(t._i,n.createAnimation("global:msg-pop-out .3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",uL),(function(){return function(t){var e=t._i;t._k=n.removeEvent("mouseleave",t._k),t._l=n.removeEvent("mouseenter",t._l),t._m=n.removeEvent("model-update",t._m),t._n=n.removeEvent("model-init",t._n),t._o=n.removeEvent("selected",t._o),t._p=n.removeEvent("animate-end",t._p),t._i=n.unmountComponent(e),n.domRemove(e),t._j=null}(t)}))},fL.dispose=function(t){t._3=n.removeEvent("click",t._3),t._4=n.removeEvent("mouseleave",t._4),t._c=n.unmountSlot(t._c),t._d=n.clearBlock(t._d)};var vL={__proto__:null,cssScope:uL,default:fL,state:function(){return{show:null,disabled:new i}},scheduleActivateMenu:function(t,e){eL(t),t._menuHideTimer=window.setTimeout((function(){return nL(t,e)}),300)},scheduleDeactivateMenu:tL,resetMenuSchedule:eL,activateMenu:nL,deactivateMenu:oL,monthChange:rL,requestDisabledDates:iL,onAnimateEnd:sL};function hL(t,e){return Object.assign({},{isDelimiter:!0,type:t},e)}function CL(t){return t.attaches&&t.attaches[0]&&"CONTROL"===t.attaches[0]._type}function kL(t){return t&&!t.isDelimiter&&!CL(t)}function bL(t){return Array.isArray(t)?t.slice():Object.assign({},t)}function yL(t,e,n){if(Nw(t[e],n))return t;var o=bL(t);return o[e]=n,o}function SL(t,e){if(!t)return e;var n=t;for(var o in e)Nw(e[o],t[o])||(t===n&&(n=bL(t)),n[o]=e[o]);return n}function wL(t,e){void 0===e&&(e="id");for(var n=[],o=0,r=void 0;o<t.length;o++)n[(r=t[o])[e]]=r;return n}function EL(t,e,n,o){var r=[];o=o||"time";for(var a=0,i=void 0,s=void 0;a<t.length;a++)(s=$(xm(t[a],o)))===i||t[a].isDelimiter||(r.push(xL(t[a],s,e,n)),i=s),r.push(t[a]);return r}function xL(t,e,n,o){var r,a="date"+t[n],i=new Date(e);return o&&a in o?yL(o[a],"label",Z(i)):hL("date",((r={})[n]=a,r.date=i,r.label=Z(i),r))}var IL="unread";var BL=new i(["PHOTO","VIDEO"]);function ML(t){var e=null;return t.reduce((function(n,o,r){if(!kL(o))return e=null,n.push(o),n;if("CHANNEL"===o.type||"CHANNEL_ADMIN"===o.type)return n.push(yL(o,"sequence",{item:"first",view:"single",id:AL(o)})),n;e=e&&"last"!==e.item&&"single"!==e.item?Object.assign({},e,{item:"middle"}):{item:"first",id:AL(o)};var a=t[r+1],i=n[r-1];if(kL(a)&&e.id===AL(a))RL(i)&&i.sequence&&"middle"!==i.sequence.view&&i.sequence.id===e.id?(e.item=i.sequence.item,e.view=i.sequence.item):"single"!==e.view||RL(a)?PL(a)&&!RL(a)?e.view="first"===e.item?"single":"last":e.view=e.item:e.view=PL(a)?"single":"first";else{var s=function(t,e,n){for(var o=n-1;o>0;o--){var r=t[o];if(!r||!kL(r)||AL(r)!==e)return;if(!RL(r))return r}}(n,e.id,r);e.item=s?"last":"single",e.view="single"===e.view?"single":e.item}return PL(o)&&(e.view="single"),n.push(yL(o,"sequence",e)),n}),[])}function AL(t){return t&&t.sender&&t.sender.id}function TL(t){return t.attaches&&t.attaches.some(OL)}function jL(t){return t&&t.attaches&&t.attaches.some(zL)}function PL(t){return kL(t)&&(function(t){return!t.text&&!t.link}(t)&&function(t){return t.attaches&&t.attaches.some(LL)}(t)||TL(t))}function RL(t){return kL(t)&&"REMOVED"===t.status}function LL(t){return BL.has(t._type)}function OL(t){return"STICKER"===t._type}function zL(t){return"AUDIO"===t._type&&t.transcription}function DL(t,e,n,o,r){for(var i=t.slice(),s=function(t){var e=new a(t);return{get:function(t){var n=[];return e.forEach((function(o,r){o>=t&&(n.push({user:r,time:o}),e.delete(r))})),n.filter(Boolean).sort(NL)},get size(){return e.size}}}(n),u=i.length-1,c=void 0,p=void 0;u>=0&&n.size;u--)o(c=i[u],u,t)&&(!(p=s.get(c.time)).length||1===p.length&&p[0].user.current||i.splice(u+1,0,UL(c,e,p,r)));return i}function UL(t,e,n,o){var r,a="readMark"+t[e],i=o&&o[a];return i&&i.participants.length===n.length?i:hL("readMark",((r={})[e]=a,r.participants=n,r.time=t.time,r.sender=t.sender,r.messageId=t.id,r))}function NL(t,e){return t.time-e.time}var qL={key:"uid",showReadMarkLimits:[15,100]};var HL=function(t){this._prev=[],this._list=null,this._firstUnread=null,this._prevChat=null,this._prevOptions=null,this.setOptions(t)},FL={list:{configurable:!0},firstUnread:{configurable:!0},hasUnread:{configurable:!0}};function VL(t,e){if("CHANNEL"===t.type){var n={official:e.official};t=yL(t,"sender",Object.assign({},{id:-e.id,name:e.title||e.placeholder},n))}if(t.link&&t.link.message){var o=yL(t.link,"message",VL(t.link.message,e));t=yL(t,"link",o)}return t}FL.list.get=function(){return this._list||[]},FL.list.set=function(t){t&&this._list&&qw(t,this._list,!0)||(this._list=t)},FL.firstUnread.get=function(){if(this._firstUnread){var t=this.options.key,e=this._firstUnread[t];return this.list.find((function(n){return n[t]===e}))}return null},FL.hasUnread.get=function(){return!!this._firstUnread},HL.prototype.get=function(t){if(this._list){var e=this._list.length;return this._list[(e+t)%e]}return null},HL.prototype.setOptions=function(t){this.options=Object.assign({},qL,t)},HL.prototype.update=function(t,e){var n=function(t,e){if(t===e)return!1;if(!t||!e)return!0;var n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!0;for(var r=0,a=void 0;r<n.length;r++)if("posting"!==(a=n[r])&&t[a]!==e[a])return!0;return!1}(this._prevChat,t)||!Hw(this._prevOptions,e,!0);return!!n&&(this.list=this.transform(t,Object.assign({},e,{prevList:this._list})),this._prevChat=t,this._prevOptions=e,!0)},HL.prototype.transform=function(t,e){var n=this.options.key,o=e.selected,r=e.highlighted,i=e.showReadMarks,s=e.prevList,u=e.postPreview,c=wL(s||[],n),l=p(t.messages);if(e&&e.detectUnread){var m=function(t){for(var e=t.length-1,n=void 0;e>=0&&(n=t[e]).unread;e--)if(n.unread&&(0===e||!t[e-1].unread))return n;return null}(l);m&&(t.readMarkLock||!this._firstUnread||this._firstUnread.time>m.time)&&(this._firstUnread=m)}if(this._firstUnread&&(l=function(t,e,n,o){for(var r,a=o&&o[IL]||hL("unread",((r={})[e]=IL,r)),i=t.length-1;i>=1;i--)if(t[i][e]===n)return t.slice(0,i).concat(a,t.slice(i));return t}(l,n,this._firstUnread[n],c)),l=function(t,e,n,o){return t.map((function(t){return SL(t,{selected:!(!n||!n.has(t[e])&&!n.has(t.id)),highlighted:o&&(o===t[e]||o===t.id)})}))}(l=EL(l,n,c),n,o,r),i){var d=function(t){if(!Array.isArray(t.participants))return new a;var e=new a;return t.participants.forEach((function(t){return e.set(t.user,t.time)})),e}(t);"DIALOG"===t.type?l=function(t,e,n,o){return DL(t,e,n,(function(t){return(e=t)&&e.sender&&e.sender.current&&"CHANNEL"!==e.type&&"CHANNEL_ADMIN"!==e.type&&"REMOVED"!==t.status;var e}),o)}(l,n,d,c):this.options.showReadMarkLimits[0]>t.participantsCount?l=function(t,e,n,o){return DL(t,e,n,kL,o)}(l,n,d,c):this.options.showReadMarkLimits[1]>t.participantsCount&&(l=function(t,e,n,o){var r=!1;return DL(t,e,n,(function(t){return!(!kL(t)||r||(r=!0,0))}),o)}(l,n,d,c))}return function(t,e){return t.map((function(t){return VL(t,e)}))}(l=ML(l=function(t,e){return e?t.concat([hL("preview",{time:e[0].time})],e):t}(l,u)),t)},HL.prototype.find=function(t){return this.list.find((function(e){return e.uid===t||e.id===t}))},HL.prototype.reset=function(){this._firstUnread=null},Object.defineProperties(HL.prototype,FL);var KL=!1;try{window.addEventListener("test",null,{get passive(){return KL=!0}})}catch(t){}var WL=function(t,e){this.fetchArea=e||0,this._request=t,this._cache=new i};WL.prototype.fetch=function(t,e){var n;if(t.scrollTop<=this.fetchArea)for(n=0;n<e.length;){if(e[n].time){this._fetch(e[n].time,"backward");break}n++}if(t.scrollTop>=t.scrollHeight-t.offsetHeight-this.fetchArea)for(n=e.length-1;n>=0;){if(e[n].time){this._fetch(e[n].time,"forward");break}n--}},WL.prototype.reset=function(){this._cache.clear()},WL.prototype._fetch=function(t,e){var n=t+":"+e;this._cache.has(n)||(this._cache.add(n),this._request(t,e))};var GL={itemHeight:100,initialItems:30,maxDisplayItems:50,offscreenArea:300,maxAnimatedScroll:3e3,alignBottom:!1,onUpdate:null,key:"id",reconcile:"replace",paddingTop:0,paddingBottom:0,scrollEasing:function(t,e,n,o){return(t/=o/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},scrollDuration:function(t){var e=Math.min(500,Math.max(300,3*Math.abs(t)));return Math.floor(e)}},YL=function(t){this.options=Object.assign({},GL,t),this._items=null,this._model=null,this._from=-1,this._to=-1,this._heights={},this._animationId=null},XL={model:{configurable:!0},isEmpty:{configurable:!0},items:{configurable:!0},range:{configurable:!0}};XL.model.get=function(){return this._model||(this._model=this._calculateModel()),this._model},XL.isEmpty.get=function(){return-1===this._from&&-1===this._to},XL.items.get=function(){return this._items},XL.range.get=function(){return{from:this._from,to:this._to}},XL.range.set=function(t){null==t?(this._from=this._to=-1,this._model=null):t.from===this._from&&t.to===this._to||(this._from=t.from,this._to=t.to,this._model=null)},YL.prototype.update=function(t,e,n){if((t=t||[]).length){!this.isEmpty&&this._reconcile(t,e)||(this.options.alignBottom?(this._to=t.length-1,this._from=Math.max(0,this._to-this.options.initialItems)):(this._from=0,this._to=Math.min(this.options.initialItems,t.length)));var o=n?t.indexOf(n):-1;-1!==o&&(this.range=this.adjustRange(this.range,t,o))}else this.range=null;this._items=t,this._markAsDirty()},YL.prototype.reset=function(){this.range=null,this._model=null},YL.prototype.itemHeight=function(t,e){var n=this.options.key,o=t&&"object"==typeof t?t[n]:t;return null!=e&&(this._heights[o]=e),o in this._heights?this._heights[o]:this.options.itemHeight},YL.prototype.visualItemHeight=function(t){var e=this.itemHeight(t);return this._items[this._items.length-1]===t&&(e+=this.options.paddingBottom),e},YL.prototype.itemPos=function(t,e){if(e=e||this._items){var n=e.indexOf(t);if(-1!==n){for(var o=0;n--;)o+=this.itemHeight(e[n]);return o+this.options.paddingTop}}return-1},YL.prototype.hasRealHeight=function(t){return t[this.options.key]in this._heights},YL.prototype.listHeight=function(t){var e=(t=t||this._items)[t.length-1];return this.itemPos(e,t)+this.itemHeight(e)+this.options.paddingBottom},YL.prototype.visibleItems=function(t){if(!this._items)return[];for(var e=t.scrollTop,n=e+t.clientHeight,o=[],r=this.options.paddingTop,a=0,i=this._items.length,s=void 0,u=void 0;a<i;a++){if(s=this._items[a],u=this.itemHeight(s),r<n&&r+u>e)o.push(s);else if(r>n)break;r+=u}return o},YL.prototype.inViewport=function(t,e,n){void 0===n&&(n=0);var o=this.itemHeight(t),r=this.itemPos(t),a=r+o,i=e.scrollTop;return r+n*o<=i+e.offsetHeight&&a-n*o>=i},YL.prototype.scrollPos=function(t,e,n,o,r){var a=e.clientHeight,i=e.scrollHeight-a,s=this.visualItemHeight(t),u=Math.round((a-s)*n);return void 0!==r&&(u+=r),o&&(u=Math.max(0,u)),Math.max(Math.min(this.itemPos(t)-u,i),0)},YL.prototype.handleScroll=function(t,e){this._items&&t&&this.fill(t,e)},YL.prototype.fill=function(t,e,n){"number"==typeof e&&(n=e,e=null);var o=this.getRangeForViewport(t,e,n);(o.from<this._from||o.to>this._to)&&(this.range=o,this._markAsDirty())},YL.prototype.getRangeForViewport=function(t,e,n){void 0===n&&(n=0);var o=t.scrollTop,r=this.options.offscreenArea,a=Math.max(0,o-n-r),i=o+t.clientHeight+r-n;return this._findItemsForArea(a,i,e)},YL.prototype.scrollTo=function(t,e,n,o){if(void 0===o&&(o={}),-1!==this.items.indexOf(t)){var r=e.scrollTop,a=this.scrollPos(t,e,n,o.clampTop,o.offset),i=a-r;this.stopAnimatedScroll(),o.animate||null==o.animate&&Math.abs(i)<=this.options.maxAnimatedScroll?(o.maxScrollDelta&&(i=Math.min(o.maxScrollDelta,Math.abs(i))*(i<0?-1:1)),this.animateScroll(e,a-i,a)):i&&(e.scrollTop=a)}},YL.prototype.animateScroll=function(t,e,n){var o=this,r=n-e,a=this.options.scrollDuration(r),i=this.options.scrollEasing,s=Date.now(),u=e;this._animationId=s;var c=function(){if(o._animationId===s){var n=Math.min(Date.now()-s,a),p=Math.round(i(n,e,r,a));t.scrollTop+=p-u,u=p,n<a&&requestAnimationFrame(c)}};this._stopAnimation=!1,t.scrollTop=e,requestAnimationFrame(c)},YL.prototype.stopAnimatedScroll=function(){this._animationId=null},YL.prototype.getAnchor=function(t,e){var n=this._items;if(n)for(var o=t.scrollTop,r=this.options.paddingTop,a=0,i=n.length,s=void 0,u=void 0;a<i;a++){if(s=n[a],u=this.itemHeight(s),this.hasRealHeight(s)&&r+u>o&&(!e||e(s)))return{item:s,offset:r,height:u,scrollTop:o};r+=this.itemHeight(s)}return null},YL.prototype.restoreAnchor=function(t,e){var n=this.itemPos(t.item),o=this.options.key;-1===n&&(n=this.itemPos(this._items.find((function(e){return e[o]===t.item[o]})))),-1!==n&&n!==t.offset&&(e.scrollTop=t.scrollTop+n-t.offset)},YL.prototype.adjustRange=function(t,e,n){var o=function(t,e,n){var o=Math.floor(n/2),r=Math.min(t.length-1,e+o),a=Math.max(0,r-n);return{from:a,to:r}}(e,n,this.options.initialItems),r=this.options.maxDisplayItems,a=Math.min(t.from,o.from),i=Math.max(t.to,o.to);if(i-a>r){var s=(n-a)/(i-a);a=Math.max(0,n-Math.ceil(s*r)),i=Math.min(Math.max(a+r,n),e.length-1)}return{from:a,to:i}},YL.prototype.readRects=function(t,e){for(var n=t.querySelectorAll("["+e+"]"),o=0,r=n.length,a=void 0;o<r;o++)a=n[o],this.itemHeight(a.getAttribute(e),a.offsetHeight)},YL.prototype._markAsDirty=function(){this._model=null,this._notify()},YL.prototype._notify=function(){"function"==typeof this.options.onUpdate&&this.options.onUpdate(this.model)},YL.prototype._reconcile=function(t,e){return"prepend"===this.options.reconcile?this._reconcilePrepend(t,e):this._reconcileReplace(t,e)},YL.prototype._reconcilePrepend=function(t){var e=this.options.key,n=t[this._from];if(!n)return!1;if(n[e]===this._items[this._from][e])return this._to===this._items.length-1&&(this.range=this.adjustRange(this.range,t,this._to)),!0;var o=function(t,e,n){for(var o=t.reduce((function(t,e,o){return t[e[n]]=o,t}),{}),r=0,a=void 0;r<e.length;r++)if((a=e[r])[n]in o)return o[a[n]];return-1}(t,this._items.slice(this._from,this._to+1),e);if(-1===o)return!1;var r=this._to-this._from;return this._to=Math.min(t.length-1,o+r),this._from=Math.max(0,this._to-r),!0},YL.prototype._reconcileReplace=function(t,e){if(t&&t.length){if(this._to>=t.length){var n=this._to-this._from;this._to=t.length-1,this._from=Math.max(0,this._to-n)}return e&&this.fill(e,t),!0}return!1},YL.prototype._calculateModel=function(){var t,e=this,n=this._items,o=this._from,r=this._to,a=0,i=0,s=0;if(n&&n.length){var u=this.itemPos(n[this._from]);i=u,a=this.listHeight(),t=n.slice(o,r+1).map((function(t){var n=e.itemHeight(t),o={top:u,height:n,value:t};return u+=n,o})),s=a-u}else t=[];return{before:i,after:s,height:a,from:o,to:r,items:t}},YL.prototype._findItemsForArea=function(t,e,n){for(var o=null,r=null,a=0,i=(n=n||this._items).length,s=0,u=void 0;a<i&&s<=e;a++)u=this.itemHeight(n[a]),s<=e&&s+u>=t&&(null===o&&(o=a),r=a),s+=u;return{from:o,to:r}},Object.defineProperties(YL.prototype,XL);var QL=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].find((function(t){return"on"+t in document})),JL=["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"].find((function(t){return t in document}));function $L(){return document[JL]}var ZL={timeout:500},tO=function(){function t(t,e){var o=this;this.element=t,this.callback=null,this.state=1,this.lastScrollTime=0,this.rafHandle=0,this.onTouchStart=function(t){1===t.touches.length?(4===o.state&&o.stopScroll(),o.setState(2)):t.touches.length>1&&o.stopScroll()},this.onTouchEnd=function(){3===o.state?(o.setState(4),o.waitScrollEnd()):o.setState(1)},this.onScroll=function(){2===o.state?o.setState(3):3!==o.state&&4!==o.state||(o.lastScrollTime=Date.now())},this.options=n.__assign(n.__assign({},ZL),e),this.shouldWaitScroll="boolean"==typeof this.options.waitScrollEnd?this.options.waitScrollEnd:/iPhone|iPad/.test(navigator.userAgent),this.shouldWaitScroll&&(t.addEventListener("touchstart",this.onTouchStart,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd,{passive:!0})),t.addEventListener("scroll",this.onScroll,{passive:!0})}return Object.defineProperty(t.prototype,"waitingScroll",{get:function(){return 3===this.state||4===this.state},enumerable:!1,configurable:!0}),t.prototype.register=function(t){this.callback=t,this.waitingScroll||this.runCallback()},t.prototype.reset=function(){this.callback=null},t.prototype.dispose=function(){this.reset(),this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchend",this.onTouchEnd),this.element.removeEventListener("scroll",this.onScroll)},t.prototype.setState=function(t){this.state=t},t.prototype.runCallback=function(){this.callback&&(this.callback(),this.callback=null)},t.prototype.waitScrollEnd=function(){var t=this;cancelAnimationFrame(this.rafHandle),this.rafHandle=requestAnimationFrame((function(){4===t.state&&(Date.now()-t.lastScrollTime>t.options.timeout?t.stopScroll():t.waitScrollEnd())}))},t.prototype.stopScroll=function(){this.state=1,cancelAnimationFrame(this.rafHandle),this.rafHandle=0,this.runCallback()},t}(),eO="🎤 ",nO="\r\n> ",oO=" <\r\n",rO="\r\n >>> ",aO=" <<<\r\n";function iO(t,e,o){return t.reduce((function(r,a,i){var s=function(t,e,o){void 0===e&&(e=null);if(!function(t){return!(TL(t)||t.link&&TL(t.link.message))}(t))return null;var r=st(t.text.trim(),t.elements),a=[];if(t.link)if("REPLY"===t.link.type)a=sO(t,e,nO,oO);else a=sO(t,e,rO,aO);if(jL(t)&&cO(e)){var i=uO(t),s=pO(t.elements,eO.length);a=[],r=st(eO+i,s)}var u=function(t){if(!t||!t.name||!t.id)return"";return t.name}(t.sender);"CHANNEL"!==o.type||u&&o.options.SIGN_ADMIN||(u=o.title);u&&(u=" ".concat(u));var c=r.length||a.length?st("[".concat((p=t.time,"".concat(v(p,"DD.MM.YYYY")," ").concat(v(p,"HH:MM"))),"]").concat(u,": ")):[];var p;return n.__spreadArray(n.__spreadArray(n.__spreadArray([],c,!0),a,!0),r,!0)}(a,e,o);if(s&&s.length){var u=[];i!==t.length-1&&(u=st("\r\n")),r=n.__spreadArray(n.__spreadArray(n.__spreadArray([],r,!0),s,!0),u,!0)}return r}),[])}function sO(t,e,n,o){var r,a;if(void 0===e&&(e=null),void 0===n&&(n=""),void 0===o&&(o=""),!t)return[];if(!t.link){var i=pO(t.elements,n.length);return st(n+t.text+o,i)}if(t.link&&t.link.message){var s=t.link.message;if("FORWARD"===(null===(r=s.link)||void 0===r?void 0:r.type)&&(null===(a=s.link)||void 0===a?void 0:a.message)&&(s=s.link.message),jL(s)&&cO(e)){var u=uO(s),c=pO(s.elements,eO.length+n.length);return st(n+eO+u+o,c)}var p=pO(s.elements,n.length);return st(n+s.text+o,p)}return[]}function uO(t){if(jL(t)){var e=t.attaches.find(zL);if(e&&"transcription"in e)return e.transcription}return""}function cO(t){return!!t&&(t.user.AUDIO_TRANSCRIPTION_ENABLED&&t.server["audio-transcription-enabled"])}function pO(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t.map((function(t){return n.__assign(n.__assign({},t),{from:(t.from||0)+e})}))}var lO="tamtam/fragment";function mO(t){if(window.clipboardData&&window.clipboardData.setData)window.clipboardData.setData("Text",t);else if(navigator.clipboard)navigator.clipboard.writeText(t);else{var e=document.createElement("textarea");e.setAttribute("style","width:1px;border:0;opacity:0;"),document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e)}}function dO(t,e){t.clipboardData?Array.isArray(e)?(t.clipboardData.setData("text/plain",n.getText$1(e).trim()),t.clipboardData.setData(lO,JSON.stringify(e))):t.clipboardData.setData("text/plain",e):"clipboardData"in window&&(Array.isArray(e)&&(e=n.getText$1(e)),window.clipboardData.setData("Text",e.trim()))}function _O(t,e){for(var n,o,r=function(t){var e=t.cloneContents();return Array.from(e.querySelectorAll(".js-emoji, .js-user-sticker, msg-emoji")).forEach((function(t){var e=t.getAttribute("MSG-EMOJI"===t.nodeName?"data-raw":"alt");t.parentNode.replaceChild(document.createTextNode(e),t)})),e}(e),a=r.querySelector("msg-message, msg-message-pro"),i=document.createNodeIterator(r,NodeFilter.SHOW_TEXT);n=i.nextNode();)a&&((o=n).parentElement&&(!o.parentElement.closest("msg-message")||o.parentElement.closest("msg-message-controls, msg-time")))&&n.parentNode.removeChild(n);return r.textContent}var fO=100,gO=10,vO=64,hO=navigator.userAgent,CO=hO.includes("Firefox")&&hO.includes("Mac OS"),kO="data-item-id",bO=new i(["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"]),yO=!0,SO=new a;var wO={mousedown:function(t,e){"mousedown"===e.type&&(e.shiftKey||e.detail>1)&&t.props.multiMode&&e.preventDefault()},copy:function(t,e){var o,r=window.getSelection(),a=t.store.get().config;if(r&&r.rangeCount){var i=r.getRangeAt(0);if(r.rangeCount>1){var s=r.getRangeAt(r.rangeCount-1);i.setEnd(s.endContainer,s.endOffset)}var u=function(t){var e=function(t){return Array.from(t.refs.scroller.querySelectorAll("msg-message[data-item-id], msg-message-pro[data-item-id]"))}(t);return e.filter((function(t){return function(t,e){if(void 0===e&&(e=oo()),!e||e.collapsed)return!1;for(var n,o,r,a=document.createNodeIterator(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null,!1);n=a.nextNode();)(n.nodeType===n.TEXT_NODE||no(n))&&(void 0===o&&(o=n),r=n);if(!r)return!1;var i=document.createRange();return i.setStart(o,0),i.setEnd(r,r.length),ro(e,i)}(t)}))}(t),c=1===u.length,p=u[0],l=p&&p.refs.header,m=jL(p.props.message)||jL(null===(o=p.props.message.link)||void 0===o?void 0:o.message),d=t.store.get().selectedChat,_="";c&&m||(_=!c||l&&eo(l,i)?iO(u.map((function(t){return t.props.message})),a,d):function(t,e){var o=t.refs.ownText;if(!o)return[];var r=document.createRange();r.setStart(o,0),r.setEnd(o,o.childNodes.length);var a=r.compareBoundaryPoints(Range.START_TO_START,e),i=r.compareBoundaryPoints(Range.END_TO_END,e);-1===a&&r.setStart(e.startContainer,e.startOffset);1===i&&r.setEnd(e.endContainer,e.endOffset);var s=function(t){var e,n=t.props.message;if("FORWARD"===(null===(e=null==n?void 0:n.link)||void 0===e?void 0:e.type))return n.link.message;return n}(t),u=n.rangeToLocation(o,r),c=n.slice(st(s.text||"",s.elements),u[0],u[1]);if(1===a){(p=document.createRange()).setStart(e.startContainer,e.startOffset),p.setEnd(r.startContainer,r.startOffset),(l=_O(t,p).trim())&&(c=n.__spreadArray(n.__spreadArray([],st(l+"\n"),!0),c,!0))}if(-1===i){var p,l;(p=document.createRange()).setStart(r.endContainer,r.endOffset),p.setEnd(e.endContainer,e.endOffset),(l=_O(t,p).trim())&&(c=n.__spreadArray(n.__spreadArray([],c,!0),st(" "+l),!0))}return c}(p,i),e.preventDefault(),dO(e,_))}},"play-next":function(t,e){e.stopPropagation();var n=e.detail.attachment,o=function(t,e){var n=t._list.model,o=n.items,r=o.findIndex((function(t){return t.value.attaches&&t.value.attaches.includes(e)})),a=o[r+1],i=e._type;if(a&&a.value.attaches&&a.value.attaches.some((function(t){return t._type===i})))return NO(t,a.value.uid)}(t,n),r=o&&o.querySelector("msg-message-audio-attach");r&&r.play()},"reaction-height":function(t){t.retainScrollPos()},keydown:function(t,e){bO.has(e.key)&&function(t,e){var o=e.target.closest("["+kO+"]");if(o){var r=o.getAttribute(kO),a=t._list.items.filter((function(t){return"readMark"!==t.type})),i=a.findIndex((function(t){return t.uid===r||t.id===r}));if(-1!==i){e.preventDefault();var s=i,u=15;switch(e.key){case"ArrowUp":s-=1;break;case"ArrowDown":s+=1;break;case"PageUp":s-=u;break;case"PageDown":s+=u;break;case"Home":s=0;break;case"End":s=a.length-1}if((s=Tn(s,0,a.length-1))!==i){var c=a[s],p=c.uid||c.id,l=t.refs.scroller;t._list.scrollTo(c,l,.3,{animate:!1}),xO(t),t.setState({focused:p}),n.afterUpdate(t,(function(){var e=t.querySelector("["+kO+"='"+p+"']");e&&e.focus()}))}}}}(t,e)}},EO={retainScrollPos:function(){var t=this.state;if(null==t._bottomPos){var e=this.refs.scroller;t._bottomPos={top:e.scrollTop,height:e.offsetHeight},Promise.resolve().then((function(){var n=e.offsetHeight,o=t._bottomPos;n!==o.height&&(e.scrollTop=o.top+o.height-n),t._bottomPos=null}))}}};function xO(t){if(!$L()){var e=t.refs.scroller,n=e.scrollTop,o=t._list;t._lastScrollTop=n,function(t){var e=t._list,n=t.refs,o=n.scroller,r=t.state,a=r.scrollList;if(!o)return;e.model.items.forEach((function(t){return t.visible=e.inViewport(t.value,o),t})),t.setState({scrollList:Object.assign({},a)})}(t),HO(t),BO(t),IO(t);for(var r=o.getRangeForViewport(e),a=!0,i=r.from;i<=r.to;i++){var s=o.items[i];if(!o.hasRealHeight(s)){a=!1;break}}a&&t._list.handleScroll(e),function(t,e){t._scrollObserver?t._scrollObserver.register(e):e()}(t,(function(){t._list.handleScroll(e),t._fetcher.fetch(e,t._messages.list)}))}}var IO=o.debounce((function(t){var e=t.props.chat,n=t.refs.scroller,o=t._list,r=o.visibleItems(n).filter((function(t){return!t.isDelimiter})),a=n.clientHeight,i=n.scrollHeight,s=n.scrollTop,u=i-s-a;if(r.length&&u>a){var c=r[r.length-1],p=o.visualItemHeight(c),l=o.itemPos(c);SO.set(e.id,{messageId:c.id,pos:(l-s)/(a-p)})}else SO.delete(e.id)}),500),BO=o.debounce((function(t){var e=t.props.chat;yO&&e&&function(t,e){var n=t._list,o=n.model.items.filter((function(e){var n=e.value;return function(t,e){var n=t._list,o=t.refs,r=o.scroller;if(!r)return;var a=n.itemPos(e),i=a+n.itemHeight(e),s=r.scrollTop+r.offsetHeight;return e.id&&e.time&&!e.isDelimiter&&a<=i&&i<=s}(t,n)})).map((function(t){return t.value})),r=o[o.length-1];if(!o.length)return;var a=[],i=[];o.forEach((function(n){var o="CHANNEL"===e.type&&n.id&&!t._viewedMessages.has(n.id),r=n.id&&n.link&&"FORWARD"===n.link.type&&"CHANNEL"===n.link.message.type;(o||r)&&(t._viewedMessages.add(n.id),i.push(n.id)),n.unread&&a.push(n.id)}));var s=a.length>0;o.length&&(s||function(t,e){return t.unreadCount>0&&e.find((function(e){return e.id===t.lastMessage.id}))}(e,o))&&Zt(t,"update-read-mark",{chatId:e.id,messageId:r.id,mark:r.time});i.length&&Zt(t,"update-messages-stats",{chatId:e.id,messageIds:i})}(t,e)}),100),MO=o.debounce((function(t,e){var n=t.props.chat,o=t.state.outdatedMessages,r=new i(o),a=Array.from(e).filter((function(t){var e=r.has(t);return e&&r.delete(t),e}));n&&a.length&&(t.store.app.reactions.fetchReactions(n.id,a),t.setState({outdatedMessages:r}))}),200);function AO(t){return!t.isDelimiter}function TO(t,e,n,o,r){return void 0===o&&(o=!1),void 0===r&&(r=0),t?{target:t,pos:e,animate:n,clampTop:o,offset:r}:null}function jO(t){for(var e,n=t.props.chat,o=t._list.items,r=o.length-1;r>=0;r--)if(!o[r].isDelimiter){e=o[r];break}n.lastMessage&&e&&n.lastMessage.id===e.id?t._list.scrollTo(o[o.length-1],t.refs.scroller,1,{animate:!0,maxScrollDelta:600}):n.lastMessage&&$p(n.id,{messagesTime:n.lastMessage.time})}function PO(t){Zt(t,"highlight-message",{messageId:t.props.chat.lastReactedMessageId})}function RO(t,e){OK.logger.success("messagesLayer","date-picker","delimeter"),OO(e,t.date.getTime())}function LO(t,e){OK.logger.success("messagesLayer","date-picker","date");var n=e.detail,o=n.stamp;n.prevStamp;e.stopPropagation(),t.props.chat.created>o&&(o=t.props.chat.created+1),OO(t,o)}function OO(t,e){var n=t.props.chat,o=p(n.messages),r=o.find((function(t,r){var a=o[r-1];return t.time>=e&&a&&a.time<=e||0===r&&n.created>=e}));t.setState({isScrollToDate:!0});var a=r?r.time:e;$p(t.props.chat.id,{messagesTime:a})}function zO(t,e){var n=e.target.closest(".js-date-delimiter");n&&n.classList.add("js-visible")}function DO(t,e){var n=e.target.closest(".js-date-delimiter");n&&n.classList.remove("js-visible")}function UO(t,e){var n=e&&e.lastMessage;if(e&&e.pending&&e.pending.length){var o=e.pending[e.pending.length-1],r=t._messages.get(-1);n&&r&&o.cid===r.cid&&(n=o)}return n}function NO(t,e){return t.refs.scroller.querySelector("msg-message["+kO+"='"+e+"']")}function qO(t){t._hlTimer=null,t._lastScrollTop=0,t._viewedMessages=new i,t._lastMessage=null,t._anchor=null,t._prevScrollTo=null,t._fetcher.reset(),t._list.reset(),t._messages.reset(),t._removeAnimations.clear(),t.setState({focused:null}),function(t){var e=t._scrollObserver;e&&e.reset()}(t)}function HO(t){var e=t.refs.scroller,n=e.scrollHeight-e.scrollTop-e.clientHeight;t.setState({arrowVisible:n>fO})}var FO=["from","to","before","after","height"];function VO(t){var e=t.props.chat;return t.store.get().config.server["react-permission"]&&e&&"GROUP_CHAT"!==e.type}function KO(t,e){var n,o=function(t){var e={};return FO.forEach((function(n){e[n]=t[n]})),e}(e),r=t.refs.scroller,a=t.state.outdatedMessages,s=t.state.focused,u=t._list,c=t.props.chat&&t.props.chat.lastReactedMessageId;if(e.items.length&&"date"!==e.items[0].type)for(var p=e.from,l=t._messages.list;--p>=0;)if("date"===l[p].type){e=Object.assign({},e,{items:[{value:l[p]}].concat(e.items),before:e.before-t._list.itemHeight(l[p])});break}var m=[],d=new i,_=VO(t),f=!1,g=null,v=null;e.items.forEach((function(e){if("date"===e.value.type)n=[e],m.push({id:"g-"+e.value.date.getTime(),items:n});else if(n){e.visible=u.inViewport(e.value,r);var o=e.value.id;_&&e.visible&&o&&(d.add(o),!t.state.seenReaction&&c&&c===o&&(t.setState({seenReaction:e.visible}),WO(t,t.props.chat))),n.push(e)}"unread"===e.value.type&&(g=e.value.id),"readMark"!==e.value.type&&(v=e.value.uid,s===v&&(f=!0))})),d.size&&a.size&&MO(t,d),f||(s=g||v),t.setState({scrollList:Object.assign({},e,{groups:m,cache:o}),focused:s})}function WO(t,e){Zt(t,"read-reaction",{chatId:e.id,messageId:e.lastReactedMessageId})}var GO="e-bysohp";function YO(t,e){e.isChatAdmin=n.get(t.props.chat,"owner","current")||n.find(n.get(t.props.chat,"admins"),(function(t){return n.get(t,"user","current")})),e.inChat="DIALOG"!==n.get(t.props.chat,"type"),e.isGroupchat="GROUP_CHAT"===n.get(t.props.chat,"type"),e.inGroupModerator=!(!n.get(t.props.chat,"groupChatInfo","isModerator")||!n.get(t.store.data.config,"server","moderated-groups")),e.selectMode=t.props.multiMode||"MESSAGES"===n.get(t.props.chat,"posting","forward","type"),e.reactionsEnabled=n.get(t.store.data.config,"server","react-permission")&&!e.isGroupchat,e.lastReactedMessageId=e.reactionsEnabled&&n.get(t.props.chat,"lastReactedMessageId"),e.value=void 0,e.ifExpr_1=n.get(t.props.chat,"unreadCount")}function XO(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function QO(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r)}function JO(t){return"loading"===n.get(t.props.chat,"loadState")&&"backward"===t.state.direction?QO:null}function $O(t){return n.get(t.state.scrollList,"groups")}function ZO(t,e){return n.get(e.value,"id")}function tz(t,e,o,r){n.updateAttribute(t,e,"data-group",n.get(r.value,"id"))}function ez(t,e){return n.get(e.value,"items")}function nz(t,e){return n.get(e.value,"value","uid")}function oz(t,e){e.message=n.get(e.value,"value"),e.id=n.get(e.message,"uid"),e.tabindex=e.id===t.state.focused?"0":null,e.isMineAsGroup=e.inGroupModerator&&"GROUP"===n.get(e.message,"sender","type")&&n.get(e.message,"sender","id")===n.get(t.props.chat,"groupChatInfo","groupId"),e.isChannelMessage="CHANNEL"===n.get(e.message,"type")||"CHANNEL_ADMIN"===n.get(e.message,"type"),e.isMine=!!(n.get(e.message,"sender","current")&&!e.isChannelMessage||e.isMineAsGroup),e.ifExpr=n.get(e.message,"id")===n.get(t.props.chat,"lastReactedMessageId")}function rz(t,e,o,r){n.updateAttribute(t,e,"tabindex",r.tabindex),n.updateAttribute(t,e,"data-item-id",r.id)}function az(t,e,n,o){RO(o.message,t)}function iz(t,e,o){var r=n.insert(e,n.elem("h2",GO));return n.setClass(r,"date-okmsg"),n.setAttribute(r,"data-tsid","system_date"),o._1b=n.addEvent(r,"click",az,t,o),o._1c=n.appendChild(r,n.text(n.get(o.message,"label"))),sz}function sz(t,e){n.updateText(e._1c,n.get(e.message,"label"))}function uz(t){return n.get(t.store.data.config,"server","date-picker")?null:iz}function cz(t,e,n,o){RO(o.message,t)}function pz(t,e,o,r){e.chatId=n.get(o.props.chat,"id"),e.disableBefore=n.get(o.props.chat,"created"),e.selected=n.get(r.message,"date")}function lz(t,e,o){var r=n.insert(e,n.elem("div",GO));n.setClass(r,"date-active-area-okmsg");var a=n.appendChild(r,n.elem("h2",GO));n.setClass(a,"date-okmsg __cur-pointer-okmsg"),n.setAttribute(a,"data-tsid","system_date"),o._1j=n.addEvent(a,"click",cz,t,o),o._1k=n.appendChild(a,n.text(n.get(o.message,"label")));var i=o._1l=n.appendChild(r,n.createComponent("msg-date-picker-bubble",vL,t)),s=o._1m=n.propsSet(i);return pz(0,s,t,o),o._1n=n.addEvent(i,"show",zO,t,o),o._1o=n.addEvent(i,"hide",DO,t,o),o._1p=n.addEvent(i,"selected",LO,t,o),n.mountComponent(i,s),mz}function mz(t,e){var o=e._1l,r=e._1m;n.updateText(e._1k,n.get(e.message,"label")),pz(0,r,t,e),n.updateComponent(o,r)}function dz(t){return n.get(t.store.data.config,"server","date-picker")?lz:null}function _z(t,e,o){var r=o._15=n.insert(e,n.elem("div",GO)),a=n.createInjector(r),i=o._16=n.obj();return n.setClass(r,"delimiter-okmsg __date-okmsg js-date-delimiter"),n.setAttribute(r,"role","menuitem"),rz(r,i,0,o),o._17=n.mountBlock(t,a,uz),o._1e=n.mountBlock(t,a,dz),fz}function fz(t,e){rz(e._15,e._16,0,e),n.updateBlock(e._17),n.updateBlock(e._1e)}function gz(t,e,o,r){n.updateAttribute(t,e,"data-item-id",r.id)}function vz(t,e,o,r){n.updateAttribute(t,e,"tabindex",r.tabindex)}function hz(t,e,o){var r=o._1s=n.insert(e,n.elem("div",GO)),a=o._1t=n.obj();n.setClass(r,"delimiter-okmsg __unread-okmsg"),n.setAttribute(r,"role","menuitem"),gz(r,a,0,o);var i=o._1u=n.appendChild(r,n.elem("h2",GO)),s=o._1v=n.obj();return n.setClass(i,"unread-okmsg"),vz(i,s,0,o),o._1w=n.appendChild(i,n.text(t.store.data.l10n("new-messages"))),Cz}function Cz(t,e){gz(e._1s,e._1t,0,e),vz(e._1u,e._1v,0,e),n.updateText(e._1w,t.store.data.l10n("new-messages"))}function kz(t,e,n,o){e.message=o.message,e.isMine=o.isMine,e.inChat=o.inChat,e.mobile=n.store.data.isMobile,e["data-item-id"]=o.id}function bz(t,e,o){var r=o._1z=n.insert(e,n.createComponent("msg-message-delimiter-participants",RR,t)),a=o._20=n.propsSet(r,{"data-tsid":"read_mark"});return kz(0,a,t,o),n.mountComponent(r,a),yz}function yz(t,e){var o=e._1z,r=e._20;kz(0,r,t,e),n.updateComponent(o,r)}function Sz(t,e,o,r){n.updateAttribute(t,e,"data-item-id",r.id),n.updateAttribute(t,e,"tabindex",r.tabindex)}function wz(t,e,n,o){e.message=o.message,e.isMine=o.isMine}function Ez(t,e,o){var r=o._23=n.insert(e,n.elem("div",GO)),a=o._24=n.obj();n.setClass(r,"control-message-okmsg"),n.setAttribute(r,"role","menuitem"),n.setAttribute(r,"data-tsid","system_message"),Sz(r,a,0,o);var i=o._25=n.appendChild(r,n.createComponent("msg-control-message",JP,t)),s=o._26=n.propsSet(i);return wz(0,s,0,o),n.mountComponent(i,s),xz}function xz(t,e){var o=e._25,r=e._26;Sz(e._23,e._24,0,e),wz(0,r,0,e),n.updateComponent(o,r)}function Iz(t,e,o,r){e.message=r.message,e.tabindex=r.tabindex,e.allowCommands=n.get(o.props.chat,"hasBots"),e.container=o,e.congrats=o.props.showSendActionCongratsAttach,e.dialog=!r.inChat,e.isChatAdmin=r.isChatAdmin,e.isVisible=n.get(r.value,"visible"),e.mine=r.isMine,e.mobile=o.store.data.isMobile,e.sequence=n.get(r.message,"sequence","item"),e.selected=!!n.find(n.get(o.props.chat,"selectedMessages"),(function(t){return n.get(t,"id")===n.get(r.message,"id")})),e.selectMode=r.selectMode,e.unread=n.get(r.message,"unread"),e.reactionsEnabled=r.reactionsEnabled,e.hasReactions=!(!r.reactionsEnabled||!n.get(r.message,"reactionInfo","totalCount")),e["data-item-id"]=r.id,e.lastReaction=r.ifExpr?n.get(o.props.chat,"lastReaction"):void 0,e.class=(n.get(r.message,"highlighted")&&!o.state.isScrollToDate?"__highlighted-okmsg":"")+("REMOVED"===n.get(r.message,"status")?" __removed-okmsg":"")}function Bz(t,e,o){var r=o._29=n.insert(e,n.createComponent("msg-message",GT,t));n.setPendingRef(o._1,"last",r);var a=o._2a=n.propsSet(r,{role:"menuitem","data-tsid":"message_root"});return Iz(0,a,t,o),n.mountComponent(r,a),Mz}function Mz(t,e){var o=e._29,r=e._2a;n.setPendingRef(e._1,"last",o),Iz(0,r,t,e),n.updateComponent(o,r)}function Az(t,e){return"date"===n.get(e.message,"type")?_z:"unread"===n.get(e.message,"type")?hz:"readMark"===n.get(e.message,"type")?bz:"CONTROL"===n.get(e.message,"attaches",0,"_type")?Ez:Bz}function Tz(t,e,o){return oz(t,o),o._12=n.mountBlock(t,e,Az),jz}function jz(t,e){oz(t,e),n.updateBlock(e._12)}function Pz(t,e,o){var r=o._p=n.insert(e,n.elem("div",GO)),a=n.createInjector(r),i=o._q=n.obj();return n.setClass(r,"group-okmsg"),n.setAttribute(r,"role","group"),tz(r,i,0,o),o._r=n.mountKeyIterator(t,a,ez,nz,Tz),Rz}function Rz(t,e){tz(e._p,e._q,0,e),n.updateKeyIterator(e._r)}function Lz(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px")}function Oz(t,e,o){var r=o._2i=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{class:"bottom-okmsg"}))}function zz(t){return"loading"===n.get(t.props.chat,"loadState")&&"forward"==t.state.direction?Oz:null}function Dz(t,e,o){!o._2u&&function(t,e,o){var r=o._2u=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._2w=n.addEvent(r,"click",PO,t,o);var i=o._2x=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"klass",size:"medium"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"float-okmsg __has-unread-okmsg","data-l":"t,scrollToReaction","data-tsid":"scroll_to_reaction"}))}(t,e,o),n.animate(o._2u,n.createAnimation("show-button 0.15s ease-out",GO))}function Uz(t,e){return e.lastReactedMessageId&&!t.state.seenReaction?Dz:null}function Nz(t,e,o,r){e.class="float-okmsg"+(n.get(o.props.chat,"unreadCount")?" __has-unread-okmsg":""),e["data-tsid"]=r.ifExpr_1?"scroll_to_last_msg":"scroll_to_bottom"}function qz(t,e){var o=e._36,r=e._37;Nz(0,r,t,e),n.updateComponent(o,r)}function Hz(t,e,o){return o._36?qz(t,o):function(t,e,o){var r=o._36=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._37=n.propsSet(r,{shape:"circle","data-l":"t,scrollToBottom"});Nz(0,i,t,o),o._38=n.addEvent(r,"click",jO,t,o);var s=o._39=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(s,n.propsSet(s,{icon:"arrow-down",size:"medium"})),n.mountComponent(r,i)}(t,e,o),n.animate(o._36,n.createAnimation("show-button 0.15s ease-out",GO)),Fz}function Fz(t,e){qz(t,e)}function Vz(t){return t.state.arrowVisible?Hz:null}function Kz(t,e,o){var r=n.insert(e,n.elem("div",GO)),a=n.createInjector(r);return n.setClass(r,"navi-okmsg"),o._2p=n.mountBlock(t,a,Uz),o._31=n.mountBlock(t,a,Vz),Wz}function Wz(t,e){n.updateBlock(e._2p),n.updateBlock(e._31)}function Gz(t,e){return t.state.arrowVisible||e.lastReactedMessageId?Kz:null}function Yz(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();YO(t,e);var i=n.insert(r,n.elemWithText("h4","Список сообщений",GO));n.setClass(i,"visually-hidden-okmsg");var s=n.insert(r,n.elem("div",GO)),u=n.createInjector(s);n.setRef(t,"scroller",s),n.setClass(s,"scroller-okmsg custom-scrollbar-okmsg js-lottie-observer js-popup-bounds"),n.setAttribute(s,"role","menu"),e._e=n.addEvent(s,"scroll",xO,t,e);var c=e._f=n.insert(u,n.elem("div",GO)),p=n.createInjector(c);n.setRef(t,"before",c);var l=e._g=n.obj();n.setClass(c,"before-okmsg"),XO(c,l,t),e._h=n.mountBlock(t,p,JO),e._m=n.mountKeyIterator(t,u,$O,ZO,Pz);var m=e._2d=n.insert(u,n.elem("div",GO)),d=n.createInjector(m),_=e._2e=n.obj();return n.setClass(m,"after-okmsg"),Lz(m,_,t),e._2f=n.mountBlock(t,d,zz),e._2l=n.mountBlock(t,r,Gz),n.subscribeStore(t,["config","l10n","isMobile"]),n.finalizePendingRefs(t,a),Xz}function Xz(t,e){YO(t,e),XO(e._f,e._g,t),n.updateBlock(e._h),n.updateKeyIterator(e._m),Lz(e._2d,e._2e,t),n.updateBlock(e._2f),n.updateBlock(e._2l),n.finalizePendingRefs(t,e._1)}QO.dispose=function(t){t._k=n.unmountComponent(t._k)},iz.dispose=function(t){t._1b=n.removeEvent("click",t._1b),t._1c=null},lz.dispose=function(t){t._1j=n.removeEvent("click",t._1j),t._1n=n.removeEvent("show",t._1n),t._1o=n.removeEvent("hide",t._1o),t._1p=n.removeEvent("selected",t._1p),t._1l=n.unmountComponent(t._1l),t._1k=t._1m=null},_z.dispose=function(t){t._17=n.unmountBlock(t._17),t._1e=n.unmountBlock(t._1e),t._16=t._15=null},hz.dispose=function(t){t._1t=t._1v=t._1w=t._1u=t._1s=null},bz.dispose=function(t){t._1z=n.unmountComponent(t._1z),t._20=null},Ez.dispose=function(t){t._25=n.unmountComponent(t._25),t._24=t._26=t._23=null},Bz.dispose=function(t){t._29=n.unmountComponent(t._29),t._2a=null},Tz.dispose=function(t){t._12=n.unmountBlock(t._12)},Pz.dispose=function(t){t._r=n.unmountKeyIterator(t._r),t._q=t._p=null},Oz.dispose=function(t){t._2i=n.unmountComponent(t._2i)},Dz.dispose=function(t,e){n.animate(t._2u,n.createAnimation("hide-button 0.15s ease-in",GO),(function(){return function(t){var e=t._2u;t._2w=n.removeEvent("click",t._2w),t._2x=n.unmountComponent(t._2x),t._2u=n.unmountComponent(e),n.domRemove(e)}(t)}))},Hz.dispose=function(t,e){n.animate(t._36,n.createAnimation("hide-button 0.15s ease-in",GO),(function(){return function(t){var e=t._36;t._38=n.removeEvent("click",t._38),t._39=n.unmountComponent(t._39),t._36=n.unmountComponent(e),n.domRemove(e),t._37=null}(t)}))},Kz.dispose=function(t){t._2p=n.unmountBlock(t._2p),t._31=n.unmountBlock(t._31)},Yz.dispose=function(t){t._e=n.removeEvent("scroll",t._e),t._h=n.unmountBlock(t._h),t._m=n.unmountKeyIterator(t._m),t._2f=n.unmountBlock(t._2f),t._2l=n.clearBlock(t._2l)};var Qz={__proto__:null,cssScope:GO,default:Yz,props:function(){return{chat:null,highlighted:"",multiMode:!1,showReadMarks:!1,showRmLimits:null,showSendActionCongratsAttach:!1}},state:function(){return{isScrollToDate:!1,seenReaction:!1,outdatedMessages:new i}},events:wO,extend:EO,didChange:function(t,e){var n=e.chat,o=e.highlighted;if(o&&o.current&&(clearTimeout(t._hlTimer),t._hlTimer=setTimeout((function(){Zt(t,"highlight-message-end"),t.setState({isScrollToDate:!1})}),1500)),n&&xm(n.current,"id")!==xm(n.prev,"id")){var r=new i,a=xm(n.current,"loadState")===xm(n.prev,"loadState");if(VO(t)&&a&&n.current&&n.current.messages){var s=p(n.current.messages).map((function(t){return t.id||t.cid})).filter(Boolean);r=new i(s)}t.setState({outdatedMessages:r}),t._chatChanged=!0,n.prev&&n.prev.lastReactedMessageId&&WO(t,n.prev)}n&&function(t,e){var n=e.current,o=e.prev;return xm(n,"id")===xm(o,"id")&&UO(t,n)!==UO(t,o)}(t,n)&&function(t,e){var n=e.lastMessage,o=n&&n.attaches&&n.attaches[0];if(o&&"STICKER"===o._type&&o.overlayUrl){var r=t.refs.last,a=r&&r.refs&&r.refs.content&&r.refs.content.refs&&r.refs.content.refs.sticker;a&&(a.play(),a.overlay())}}(t,n.current)},willMount:function(t){t._removeAnimations=new a,t._messages=new HL,t._list=new YL({initialItems:25,itemHeight:34,paddingTop:7,paddingBottom:20,alignBottom:!0,reconcile:"prepend",key:"uid",onUpdate:function(e){if(function(t,e){var n=t.state.scrollList;if(!n||!n.cache)return!0;return FO.some((function(t){return n.cache[t]!==e[t]}))}(t,e))for(var n=t._list,o=0;o<e.items.length;o++)if(!n.hasRealHeight(e.items[o].value))return void KO(t,e);KO(t,e)},scrollDuration:function(){return 300}}),t._listUpdated=!1,t._fetcher=new WL((function(e,n){var o=t.props.chat;t.setState({direction:n}),("forward"!==n||o.lastMessage&&e<o.lastMessage.time)&&("loading"===o.loadState||$L()||Zt(t,"fetch-messages",{chatId:o.id,options:{from:e,direction:n}}))}),500),t._onFocus=function(){yO=!0,BO(t)},t._onBlur=function(){return yO=!1},t._onFullscreenChange=function(){$L()||(t.refs.scroller.scrollTop=t._lastScrollTop)},window.addEventListener("focus",t._onFocus),window.addEventListener("blur",t._onBlur),document.addEventListener(QL,t._onFullscreenChange),qO(t)},willUpdate:function(t,e){var n,o=e.chat,r=t.props,a=r.chat,s=t.refs.scroller;t._chatChanged?qO(t):t._anchor=t._list.getAnchor(s,AO);var u=t._chatChanged?!!a.unreadCount:xm(a,"readMarkLock")&&xm(a,"unreadCount")!==xm(o&&o.prev,"unreadCount");t._listUpdated=t._messages.update(a,{selected:a.selectedMessages?new i(a.selectedMessages.map((function(t){return t.uid}))):null,highlighted:r.highlighted,showReadMarks:r.showReadMarks,detectUnread:u}),t._scrollTo=function(t,e){var n=e?function(t){var e=t.props,n=e.chat,o=t._messages;if(n.focusedMessage){var r=o.find(n.focusedMessage);if(r)return TO(r,.5,!1,!0)}if(o.hasUnread){return TO(o.list.find((function(t){return"unread"===t.type}))||o.firstUnread,.2,!1)}if(SO.has(n.id)){var a=SO.get(n.id),i=o.find(a.messageId);if(i)return TO(i,a.pos,!1)}return TO(o.get(-1),1,!1)}(t):function(t){var e,n=t.props,o=n.chat,r=t._messages,a=o.posting&&o.posting.preview,i=a?o.posting.preview.length+1:1;if(o.focusedMessage){var s=r.find(o.focusedMessage),u=.5,c=0;return t.state.isScrollToDate&&(u=0,c=vO),TO(s,u,!0,!0,c)}var p=r.get(-i),l=UO(t,o);p&&l&&p.time===l.time&&t._lastMessage&&t._lastMessage.uid!==p.uid&&"REMOVED"!==t._lastMessage.status&&(e=p);if(t._lastMessage=p,e&&function(t,e){if(!e)return!1;var n=t.refs,o=n.scroller,r=o.scrollTop+o.clientHeight,a=t._list.itemPos(e,t._messages.list)-r+t._list.options.paddingBottom;if(e.sender&&e.sender.current)return!e.isDelimiter||a<gO;return a>=-fO/2&&a<fO}(t,e))return"preview"===e.type?TO(e,0,null,!0):TO(e,1,null);return null}(t),o=t._prevScrollTo;if(n){if(!o||o.target.id!==n.target.id)return t._prevScrollTo=n,n}else t._prevScrollTo=null;return null}(t,t._chatChanged),t._scrollTo&&!t._list.hasRealHeight(t._scrollTo.target)&&(t._anchor=null,n=t._scrollTo.target),t._list.update(t._messages.list,s,n),t._chatChanged=!1},didMount:function(t){t.setState({_initial:!0});var e=t.refs.scroller;CO&&function(t){t.addEventListener("wheel",(function(){}),!!KL&&{passive:!1})}(e);var n=new tO(e,{timeout:300});return t._scrollObserver=n,function(){n.dispose()}},didUpdate:function(t){var e=t.refs.scroller;if(t._list.readRects(e,kO),t._anchor&&(t._list.restoreAnchor(t._anchor,e),t._anchor=null),t._scrollTo){var n=t._scrollTo,o=n.target,r=n.pos,a=n.animate,i=n.clampTop,s=n.offset;t._list.scrollTo(o,e,r,{animate:a,clampTop:i,offset:s}),t._scrollTo=null}HO(t),BO(t),IO(t),function(t){var e=t._list;e.items&&e.items.forEach((function(e){if("REMOVED"===e.status){var n=e.uid||e.cid,o=NO(t,n),r=t._removeAnimations.get(n);o&&!r?(t._removeAnimations.set(n,!0),function(t,e,n){var o=t._list.visualItemHeight({uid:e}),r=Date.now(),a=300,i=function(t,e,n,o){return n*t/o+e},s=t.refs,u=s.scroller,c=t._list.visibleItems(u);n.style.height=o+"px",getComputedStyle(n);var p=function(){requestAnimationFrame((function(){var t=Date.now()-r,s=Math.max(i(t,o,-o,a),0),u=c.some((function(t){return n=e,(o=t).id===n||o.uid===n||o.cid===n;var n,o}));n.style.height=(u?s:0)+"px",0!==s&&u&&p()}))};p()}(t,n,o)):o||(Zt(t,"clean-removed-message",{messageId:n}),t._removeAnimations.delete(n))}}))}(t)},willUnmount:function(t){window.removeEventListener("focus",t._onFocus),window.removeEventListener("blur",t._onBlur),document.removeEventListener(QL,t._onFullscreenChange)},handleScroll:xO,scrollToBottom:jO,scrollToReaction:PO,onClosePreview:function(t){Zt(t,"reset-posting-preview",{chatId:t.props.chat.id})},scrollToDay:RO,onDateSelect:LO,onCalendarShow:zO,onCalendarHide:DO},Jz={align:function(t,e){void 0===e&&(e={left:0,right:window.innerWidth});var n=this.offsetWidth,o=this.offsetHeight,r=Math.round(Tn(t.x-n/2,e.left,e.right-n)),a=Math.round(t.x-r);this.style.left="".concat(r,"px"),this.style.top="".concat(t.y-o,"px"),this.style.transformOrigin="".concat(a,"px ").concat(o+5,"px"),this._lastPos=t,this._lastBounds=e}};function $z(t){t._lastPos&&t.align(t._lastPos,t._lastBounds)}var Zz="e7wlum7";function tD(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",Zz)),e._2=n.mountSlot(t,"")}tD.dispose=function(t){t._2=n.unmountSlot(t._2)};var eD={__proto__:null,cssScope:Zz,default:tD,extend:Jz,didChange:function(t){$z(t)},didSlotUpdate:function(t){$z(t)}};function nD(t){t.setState({loadState:"loaded"})}function oD(t){t.setState({loadState:"error"})}var rD="exyq6dt";function aD(t,e,o){n.updateClass(t,e,"sticker-okmsg"+(o.state.loadState?" __"+o.state.loadState:"")+(o.props.showPrice?" __price-okmsg":"")+(o.state.isPostcard?" __postcard-okmsg":""))}function iD(t,e,o){n.updateAttribute(t,e,"src",o.props.isVisible?n.get(o.props.sticker,"previewUrl")||n.get(o.props.sticker,"url"):null)}function sD(t,e,o){var r=n.insert(e,n.elem("span",rD));return n.setClass(r,"price-okmsg"),o._b=n.appendChild(r,n.text(t.props.price)),n.appendChild(r,n.text(" OK")),uD}function uD(t,e){n.updateText(e._b,t.props.price)}function cD(t){return t.props.showPrice?sD:null}function pD(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._j=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"play",size:"nano"})),n.mountComponent(r,n.propsSet(r,{size:"small",shape:"circle",class:"primary-okmsg play-okmsg"}))}function lD(t){return t.props.animated?pD:null}function mD(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("div",rD)),a=n.createInjector(r);aD(r,e._2=n.obj(),t);var i=e._3=n.insert(a,n.elem("img",rD)),s=e._4=n.obj();return n.setClass(i,"sticker-img-okmsg"),n.setAttribute(i,"alt",""),n.setAttribute(i,"slot","element"),iD(i,s,t),e._5=n.addEvent(i,"load",nD,t,e),e._6=n.addEvent(i,"error",oD,t,e),e._7=n.mountBlock(t,a,cD),e._e=n.mountBlock(t,a,lD),dD}function dD(t,e){aD(e._1,e._2,t),iD(e._3,e._4,t),n.updateBlock(e._7),n.updateBlock(e._e)}sD.dispose=function(t){t._b=null},pD.dispose=function(t){t._j=n.unmountComponent(t._j),t._h=n.unmountComponent(t._h)},mD.dispose=function(t){t._5=n.removeEvent("load",t._5),t._6=n.removeEvent("error",t._6),t._7=n.unmountBlock(t._7),t._e=n.unmountBlock(t._e)};var _D={__proto__:null,cssScope:rD,default:mD,props:function(){return{sticker:{},price:0,showPrice:!1,isVisible:!1}},willMount:function(t){var e="POSTCARD"===t.props.sticker.type;e&&t.setState({isPostcard:e})},onImageLoad:nD,onImageError:oD};var fD="eaiybcc";function gD(t,e){e.type=n.get(t.props.sticker,"type")||n.get(t.props.sticker,"stickerType"),e.hasPostcardBadge=t.props.postcardBadge&&"POSTCARD"==e.type,e.hasBadge="LIVE"==e.type||n.get(t.props.sticker,"audio")||e.hasPostcardBadge,e.badgeType=n.get(t.props.sticker,"audio")?"AUDIO":e.type,e.price=n.get(t.props.sticker,"price"),e.chooseExpr=t.state.lottieUrl?0:1,e.caseExpr_1=1===e.chooseExpr,e.previewUrl=e.caseExpr_1?n.get(t.props.sticker,"previewUrl"):void 0,e.defaultUrl=e.caseExpr_1?"//i.mycdn.me/getSmile?smileId="+n.call(t.props.stickerId,"toString",[16]):void 0}function vD(t,e,o){e.url=o.state.lottieUrl,e.staticUrl=n.get(o.props.sticker,"url"),e.id=o.props.stickerId}function hD(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._f=n.propsSet(r,{width:100,height:100,loop:!0});return vD(0,a,t),n.mountComponent(r,a),CD}function CD(t,e){var o=e._e,r=e._f;vD(0,r,t),n.updateComponent(o,r)}function kD(t,e,o,r){n.updateAttribute(t,e,"src",r.previewUrl||r.defaultUrl)}function bD(t,e,o){var r=n.insert(e,n.elem("div",fD));n.setClass(r,"price-okmsg");var a=n.appendChild(r,n.elem("span",fD));return n.setClass(a,"label-okmsg"),o._p=n.appendChild(a,n.text(o.price)),n.appendChild(a,n.text(" OK")),yD}function yD(t,e){n.updateText(e._p,e.price)}function SD(t,e){return e.price>0?bD:null}function wD(t,e,n,o){e.type=o.badgeType}function ED(t,e){e.stopPropagation(),e.preventDefault(),Zt(t,"badge-click")}function xD(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-asset-badge",Us,t)),a=o._v=n.propsSet(r);return wD(0,a,0,o),o._w=n.addEvent(r,"click",ED,t,o),n.mountComponent(r,a),ID}function ID(t,e){var o=e._u,r=e._v;wD(0,r,0,e),n.updateComponent(o,r)}function BD(t,e){return e.hasBadge?xD:null}function MD(t,e,o){var r=o._i=n.insert(e,n.elem("img",fD)),a=o._j=n.obj();return n.setAttribute(r,"alt",""),kD(r,a,0,o),o._k=n.mountBlock(t,e,SD),o._r=n.mountBlock(t,e,BD),AD}function AD(t,e){kD(e._i,e._j,0,e),n.updateBlock(e._k),n.updateBlock(e._r)}function TD(t,e){return[hD,MD][e.chooseExpr]}function jD(t,e){var o=t.componentView,r=n.createInjector(o);return gD(t,e),e._b=n.mountBlock(t,r,TD),PD}function PD(t,e){gD(t,e),n.updateBlock(e._b)}hD.dispose=function(t){t._e=n.unmountComponent(t._e),t._f=null},bD.dispose=function(t){t._p=null},xD.dispose=function(t){t._w=n.removeEvent("click",t._w),t._u=n.unmountComponent(t._u),t._v=null},MD.dispose=function(t){t._k=n.unmountBlock(t._k),t._r=n.unmountBlock(t._r),t._j=t._i=null},jD.dispose=function(t){t._b=n.clearBlock(t._b)};var RD={__proto__:null,cssScope:fD,default:jD,didChange:function(t,e){var n,o=e.stickerId,r=e.sticker;((null==o?void 0:o.current)||(null==r?void 0:r.current))&&t.setState({lottieUrl:null===(n=null==r?void 0:r.current)||void 0===n?void 0:n.lottieUrl})}};function LD(t){var e=t.props.user;t.setState({requested:!0}),Zt(t,"add-friend",{userId:e.id}),t.props.important&&Zt(t,"hide-alert-bar-important",{})}function OD(t){Zt(t,"block-user",{userId:t.props.user.id})}function zD(t){Zt(t,"unblock-user",{userId:t.props.user.id})}function DD(t){Zt(t,"report-user",{userId:t.props.user.id,hideAlertImportant:t.props.important})}function UD(t){Zt(t,"hide-alert-bar",{})}function ND(t){Zt(t,"hide-alert-bar-important",{})}function qD(t){Zt(t,"open-common-friends",{friendId:t.props.user.id})}var HD="eengg8h";function FD(t,e){e.type=n.get(t.props.data,"type"),e.pending=n.get(t.props.data,"pending"),e.friends=n.get(t.props.data,"common"),e.total=n.get(t.props.data,"friendCount"),e.showCaption="NOT_FRIEND"!==e.type&&"NOT_FRIEND_COMMON"!==e.type&&t.props.important,e.hasFriends=Tt(0,e.friends),e.showFriends="NOT_FRIEND_COMMON"===e.type||"NOT_FRIEND_BLOCKED"===e.type||"NOT_FRIEND_COMMON_MY"===e.type}function VD(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"info-panel-new-common-hdr"}))}function KD(t,e,n,o){e.key="info-panel-new-"+o.type+"-hdr"}function WD(t,e,o){var r=o._i=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._j=n.propsSet(r);return KD(0,a,0,o),n.mountComponent(r,a),GD}function GD(t,e){var o=e._i,r=e._j;KD(0,r,0,e),n.updateComponent(o,r)}function YD(t,e){return t.props.important||"BLACK_LIST"===e.type?WD:VD}function XD(t,e,n,o){e.key="info-panel-new-"+o.type+"-txt"}function QD(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._p=n.propsSet(r,{class:"text-okmsg"});return XD(0,a,0,o),n.mountComponent(r,a),JD}function JD(t,e){var o=e._o,r=e._p;XD(0,r,0,e),n.updateComponent(o,r)}function $D(t,e){return e.showCaption?QD:null}function ZD(t,e,o,r){n.updateClass(t,e,"common-okmsg"+(r.hasFriends?"":" __no-friends-okmsg"))}function tU(t,e){return e.friends}function eU(t,e,n,o){e.user=o.value}function nU(t,e,o){var r=o._12=n.insert(e,n.createComponent("msg-user-card",Nh,t)),a=o._13=n.propsSet(r,{size:"micro"});return eU(0,a,0,o),n.mountComponent(r,a),oU}function oU(t,e){var o=e._12,r=e._13;eU(0,r,0,e),n.updateComponent(o,r)}function rU(t,e,n,o){e["data-count"]=o.total,e["data-countPlural"]=o.total}function aU(t,e,o){o._z=n.mountIterator(t,e,tU,nU);var r=n.insert(e,n.elem("span",HD));n.setClass(r,"total-okmsg link-okmsg"),n.setAttribute(r,"data-l","t,commonFriends"),o._15=n.addEvent(r,"click",qD,t,o);var a=o._16=n.appendChild(r,n.createComponent("msg-l10n",ae,t)),i=o._17=n.propsSet(a,{key:"common-friends-count"});return rU(0,i,0,o),n.mountComponent(a,i),iU}function iU(t,e){var o=e._16,r=e._17;n.updateIterator(e._z),rU(0,r,0,e),n.updateComponent(o,r)}function sU(t,e,o){var r=o._1a=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"no-common-friends"}))}function uU(t,e){return e.hasFriends?aU:sU}function cU(t,e,o){var r=o._u=n.insert(e,n.elem("div",HD)),a=n.createInjector(r);return ZD(r,o._v=n.obj(),0,o),o._w=n.mountBlock(t,a,uU),pU}function pU(t,e){ZD(e._u,e._v,0,e),n.updateBlock(e._w)}function lU(t,e){return e.showFriends&&e.hasFriends||n.get(t.store.data.config,"server","redesign-alert")?cU:null}function mU(t,e,o){var r=o._1h=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._1j=n.addEvent(r,"click",zD,t,o);var i=o._1k=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"info-panel-unblock-opponent"})),n.mountComponent(r,n.propsSet(r,{size:"small",shape:"square",class:"primary-okmsg","data-l":"t,unblock"}))}function dU(t,e,o){var r=o._1s=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._1u=n.addEvent(r,"click",LD,t,o);var i=o._1v=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"info-panel-add-friend"})),n.mountComponent(r,n.propsSet(r,{size:"small",shape:"square",class:"primary-okmsg","data-l":"t,addFriend","data-tsid":"add_friend_btn"}))}function _U(t,e){return t.state.requested||e.pending?null:dU}function fU(t,e,o){var r=o._21=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{class:"requested-okmsg",key:"info-panel-friend-request-send"}))}function gU(t,e){return t.state.requested||e.pending?fU:null}function vU(t,e,o){return o._1p=n.mountBlock(t,e,_U),o._1y=n.mountBlock(t,e,gU),hU}function hU(t,e){n.updateBlock(e._1p),n.updateBlock(e._1y)}function CU(t,e){return"BLACK_LIST"===e.type?mU:vU}function kU(t,e,o){var r=o._2j=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._2l=n.addEvent(r,"click",ND,t,o);var i=o._2m=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"hide"})),n.mountComponent(r,n.propsSet(r,{size:"small",shape:"square",class:"secondary-okmsg","data-l":"t,hide"}))}function bU(t){return t.props.important?kU:null}function yU(t,e,o){var r=o._2a=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._2c=n.addEvent(r,"click",DD,t,o);var i=o._2d=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(i,n.propsSet(i,{key:"report-messages-confirm-button"})),n.mountComponent(r,n.propsSet(r,{size:"small",shape:"square",class:"secondary-okmsg","data-l":"t,reportUser"})),o._2g=n.mountBlock(t,e,bU),SU}function SU(t,e){n.updateBlock(e._2g)}function wU(t,e,o){var r=o._2u=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._2w=n.addEvent(r,"click",UD,t,o);var i=o._2x=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"ignore"})),n.mountComponent(r,n.propsSet(r,{size:"small",shape:"square",class:"secondary-okmsg","data-l":"t,close"}))}function EU(t,e,o){var r=o._32=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._34=n.addEvent(r,"click",DD,t,o);var i=o._35=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"report-messages-confirm-button"})),n.mountComponent(r,n.propsSet(r,{size:"small",shape:"square",class:"secondary-okmsg","data-l":"t,reportUser"}));var s=o._38=n.insert(e,n.createComponent("msg-button",fe,t)),u=s.componentModel.input;o._3a=n.addEvent(s,"click",OD,t,o);var c=o._3b=n.insert(u,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(c,n.propsSet(c,{key:"block"})),n.mountComponent(s,n.propsSet(s,{size:"small",shape:"square",class:"secondary-okmsg","data-l":"t,blocktUser"}))}function xU(t,e){return"NOT_FRIEND"===e.type||"NOT_FRIEND_COMMON"===e.type||"NOT_FRIEND_BLOCKED"===e.type?wU:"NOT_FRIEND_WARNING"===e.type||"NOT_FRIEND_COMMON_MY"===e.type?EU:null}function IU(t,e,o){return o._2r=n.mountBlock(t,e,xU),BU}function BU(t,e){n.updateBlock(e._2r)}function MU(t){return n.get(t.store.data.config,"server","redesign-alert")?yU:IU}function AU(t,e,o){return o._27=n.mountBlock(t,e,MU),TU}function TU(t,e){n.updateBlock(e._27)}function jU(t,e){return t.state.requested||e.pending?null:AU}function PU(t,e,n){e.title=n.store.data.l10n("close")}function RU(t,e,n){e.size=n.props.important?"small":"normal"}function LU(t,e,o){var r=o._3h=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._3i=n.propsSet(r,{class:"close-okmsg",shape:"circle","data-l":"t,close"});PU(0,i,t),o._3j=n.addEvent(r,"click",UD,t,o);var s=o._3k=n.insert(a,n.createComponent("msg-icon",xe,t),""),u=o._3l=n.propsSet(s,{icon:"close"});return RU(0,u,t),n.mountComponent(s,u),n.mountComponent(r,i),OU}function OU(t,e){var o=e._3h,r=e._3i,a=e._3k,i=e._3l;PU(0,r,t),RU(0,i,t),n.updateComponent(a,i),n.updateComponent(o,r)}function zU(t){return n.get(t.store.data.config,"server","redesign-alert")&&t.props.important?null:LU}function DU(t,e){var o=t.componentView,r=n.createInjector(o);FD(t,e);var a=n.insert(r,n.elem("div",HD)),i=n.createInjector(a);n.setClass(a,"info-okmsg");var s=n.insert(i,n.elem("h3",HD)),u=n.createInjector(s);n.setClass(s,"h3-okmsg"),e._b=n.mountBlock(t,u,YD),e._l=n.mountBlock(t,i,$D),e._r=n.mountBlock(t,i,lU);var c=n.insert(r,n.elem("div",HD)),p=n.createInjector(c);return n.setClass(c,"buttons-okmsg"),e._1e=n.mountBlock(t,p,CU),e._24=n.mountBlock(t,p,jU),e._3e=n.mountBlock(t,r,zU),n.subscribeStore(t,["config","l10n"]),UU}function UU(t,e){FD(t,e),n.updateBlock(e._b),n.updateBlock(e._l),n.updateBlock(e._r),n.updateBlock(e._1e),n.updateBlock(e._24),n.updateBlock(e._3e)}VD.dispose=function(t){t._e=n.unmountComponent(t._e)},WD.dispose=function(t){t._i=n.unmountComponent(t._i),t._j=null},QD.dispose=function(t){t._o=n.unmountComponent(t._o),t._p=null},nU.dispose=function(t){t._12=n.unmountComponent(t._12),t._13=null},aU.dispose=function(t){t._z=n.unmountIterator(t._z),t._15=n.removeEvent("click",t._15),t._16=n.unmountComponent(t._16),t._17=null},sU.dispose=function(t){t._1a=n.unmountComponent(t._1a)},cU.dispose=function(t){t._w=n.unmountBlock(t._w),t._v=t._u=null},mU.dispose=function(t){t._1j=n.removeEvent("click",t._1j),t._1k=n.unmountComponent(t._1k),t._1h=n.unmountComponent(t._1h)},dU.dispose=function(t){t._1u=n.removeEvent("click",t._1u),t._1v=n.unmountComponent(t._1v),t._1s=n.unmountComponent(t._1s)},fU.dispose=function(t){t._21=n.unmountComponent(t._21)},vU.dispose=function(t){t._1p=n.unmountBlock(t._1p),t._1y=n.unmountBlock(t._1y)},kU.dispose=function(t){t._2l=n.removeEvent("click",t._2l),t._2m=n.unmountComponent(t._2m),t._2j=n.unmountComponent(t._2j)},yU.dispose=function(t){t._2c=n.removeEvent("click",t._2c),t._2d=n.unmountComponent(t._2d),t._2a=n.unmountComponent(t._2a),t._2g=n.unmountBlock(t._2g)},wU.dispose=function(t){t._2w=n.removeEvent("click",t._2w),t._2x=n.unmountComponent(t._2x),t._2u=n.unmountComponent(t._2u)},EU.dispose=function(t){t._34=n.removeEvent("click",t._34),t._35=n.unmountComponent(t._35),t._32=n.unmountComponent(t._32),t._3a=n.removeEvent("click",t._3a),t._3b=n.unmountComponent(t._3b),t._38=n.unmountComponent(t._38)},IU.dispose=function(t){t._2r=n.unmountBlock(t._2r)},AU.dispose=function(t){t._27=n.unmountBlock(t._27)},LU.dispose=function(t){t._3j=n.removeEvent("click",t._3j),t._3k=n.unmountComponent(t._3k),t._3h=n.unmountComponent(t._3h),t._3i=t._3l=null},DU.dispose=function(t){t._b=n.unmountBlock(t._b),t._l=n.unmountBlock(t._l),t._r=n.unmountBlock(t._r),t._1e=n.unmountBlock(t._1e),t._24=n.unmountBlock(t._24),t._3e=n.clearBlock(t._3e)};var NU={__proto__:null,cssScope:HD,default:DU,props:function(){return{data:null,user:null,important:!1,simple:!1}},didChange:function(t,e){var n=e.user;if(n&&(!n.prev||n.current.id!==n.prev.id)){var o=t.props.data;Zt(t,"log-action",{name:"CHAT_ALERT",value:{type:o?o.type:"UNKNOWN"}})}},onAddFriend:LD,onBlockUser:OD,onUnblockUser:zD,onReportUser:DD,onClose:UD,onCloseImportant:ND,onShowCommonFriends:qD};function qU(t){var e=Ei(t).CHAT_BACKGROUNDS;return e||KU(t,e={}),e}function HU(t,e){var n=qU(t);return n.chats?n.chats[e]:null}function FU(t){return qU(t).defaultBackground}function VU(t,e){QU(e.id,!0);var n=qU(t);n.chats={},n.defaultBackground=e,KU(t,n)}function KU(t,e){wi(t,"CHAT_BACKGROUNDS",e)}var WU=void 0;function GU(){return WU?Promise.resolve(WU):o.invoke("messages/config/backgrounds").then((function(t){var e=JSON.parse(t||"{}");return(null==e?void 0:e.sections)||[]})).then((function(t){var e,o=G().get().config.server["animated-backgrounds-web"];if(WU=JSON.parse(JSON.stringify(t)),o&&(null==WU?void 0:WU.length)){var r=(o.list||[]).map((function(t){return"aurora"===t||"snow"===t?{id:t}:{type:"lottie",id:t,lottieUrl:"".concat(o.url,"/").concat(t,".").concat(o.ext)}}));(e=WU[0].options).splice.apply(e,n.__spreadArray([1,0],r,!1))}return WU}))}function YU(){return o.supportsCache()}function XU(){JU("open")}function QU(t,e){JU("set-".concat(t)+(e?"-default":""))}function JU(t){var e;"undefined"!=typeof OK&&(null===(e=OK.logger)||void 0===e||e.success("messagesLayer","chat-backgrounds",t))}function $U(t,e){return function(t){return eN(t,0,tN(t),e)}}function ZU(t,e){return function(t){return eN(t,tN(t),0,e)}}function tN(t){return parseInt(getComputedStyle(t).height,10)}function eN(t,e,o,r){var a=t.style,i=a.height,s=a.overflow,u=o-e;return t.style.height=e+"px",t.style.overflow="hidden",n.composeTween(r,{step:function(t,n){t.style.height=Math.round(e+n*u)+"px"},complete:function(t){t.style.height=i,t.style.overflow=s}})}function nN(t,e,n,o){return n*((t=t/o-1)*t*t+1)+e}function oN(t,e,n,o){return(t/=o/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e}var rN={duration:300,easing:nN,start:function(t){return t.classList.add("js-animate")},complete:function(t){return t.classList.remove("js-animate")}};function aN(t,e,o){return $U(0,n.__assign(n.__assign(n.__assign({},rN),o),{step:function(){return Ot(e,"animate")}}))}function iN(t,e,o){return ZU(0,n.__assign(n.__assign(n.__assign({},rN),o),{step:function(){return Ot(e,"animate")}}))}var sN,uN,cN=null,pN=900,lN=150,mN="background",dN="messagingSendAction/",_N=dN.length,fN="tvbg",gN="gif";var vN={"toggle-sticker-sound":function(t,e){EN(t,e.detail)}};function hN(t,e){var n=t.props.link,o=n.url;if(e.stopPropagation(),o){var r=o.indexOf(dN);if(r>-1){var a=null,i=o.substring(r+_N).split(/[\\?]+/);i.length>0&&(a=i[0]),OK.logger.success("messagesLayer.congrats","show.redlink",a||"notrecognised"),Zt(t,"open-congrats-menu",{tab:a})}else if(o.indexOf(fN)>-1)OK.logger.success("messagesLayer","backgroundTV","redlink"),Zt(t,"tv-enable");else if(o.indexOf(mN)>-1)!function(t,e){new Promise((function(t){var n=AN(e);return n?GU().then((function(e){var o=null;return e.some((function(t){return o=t.options.find((function(t){return String(t.id)==n}))})),t(o)})):t(null)})).then((function(e){e?(VU(t,e),Zt(t,"background-update")):function(t){XU(),Zt(t,"toggle-aside-content",{tabName:"backgrounds"})}(t)}))}(t,o);else if(o.indexOf(gN)>-1){Zt(t,"show-assets",{tab:"gifs",query:new URL(o).searchParams.get("query")})}else Jn(t,o)}else n.isPostcard?Zt(t,"show-assets",{tab:"postcards",query:n.query}):Zt(t,"open-sticker-pack-layer",{setId:n.setId})}function CN(t,e,n,o){bN(),o&&(cN=setTimeout((function(){return function(t,e,n){bN(),t.setState({active:{rect:n.getBoundingClientRect(),sticker:e}})}(e,t,o)}),200))}function kN(t){bN(),function(t){bN(),t.setState({active:null})}(t)}function bN(){cN&&(clearTimeout(cN),cN=null)}function yN(t,e,n,o){BN(e),o&&(sN=setTimeout((function(){return xN(e,t,o)}),pN))}function SN(t){IN(),BN(t,!0)}function wN(t,e,n,o){xN(e,t,o),t.audio&&EN(e,!0)}function EN(t,e){t.setState({stickerSound:e})}function xN(t,e,n){var o,r=t.state.active;(null==r?void 0:r.sticker)!==e&&(IN(),t.setState({active:{rect:n.getBoundingClientRect(),sticker:e}}),o="sticker",OK.logger.success("messagesLayer","asset-preview-hello",o))}function IN(){sN&&(clearTimeout(sN),sN=null)}function BN(t,e){e?uN=setTimeout((function(){return BN(t)}),lN):t.setState({active:null})}function MN(){uN&&(clearTimeout(uN),uN=null)}function AN(t){if(!t)return null;var e=to(t),n=e.indexOf(mN),o=n+1;return n>-1&&e.length>o?e[o]:null}function TN(t){te(t,"close-link")}var jN="e-blc3m3";function PN(t,e,n){e.user=n.props.contact,e.data=n.props.alert}function RN(t,e){var o=e._8,r=e._9;PN(0,r,t),n.updateComponent(o,r)}function LN(t,e,o){return o._7?RN(t,o):function(t,e,o){var r=o._7=n.insert(e,n.elem("section",jN)),a=o._8=n.appendChild(r,n.createComponent("msg-chat-alert",NU,t)),i=o._9=n.propsSet(a,{important:!0,"data-tsid":"not-friend","data-l":"t,chatAlertImportant"});PN(0,i,t),n.mountComponent(a,i)}(t,e,o),n.animate(o._7,aN(o._7,t,{duration:400})),ON}function ON(t,e){RN(t,e)}function zN(t){Ot(t,"toggle-stickers")}function DN(t){Ot(t,"reload-stickers")}function UN(t,e,o){var r=o._s=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._u=n.addEvent(r,"click",DN,t,o);var i=o._v=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"arrow-right"})),n.mountComponent(r,n.propsSet(r,{class:"reload-okmsg secondary-okmsg",size:"small",shape:"circle"}))}function NN(t){return t.store.data.isMobile?null:UN}function qN(t,e,o){n.updateClass(t,e,"list-okmsg custom-scrollbar-okmsg"+(n.get(o.store.data.config,"server","hello-redesign")?"":" __flex-okmsg"))}function HN(t,e,o){var r=o._14=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{size:"large"}))}function FN(t){return n.get(t.props.stickers,"stickers")}function VN(t,e,o,r){e.sticker=r.value,e.stickerId=n.get(r.value,"id"),e.class="STATIC"===n.get(r.value,"type")?"__jump-okmsg":""}function KN(t,e,n,o){Zt(t,"pick-sticker",{sticker:o.value,stickerOrigin:"hello_panel"})}function WN(t,e,n,o){yN(o.value,t,0,n)}function GN(t,e,n,o){wN(o.value,t,0,n)}function YN(t,e){var o=e._1f;"STATIC"!==n.get(e.value,"type")&&(n.setPendingEvent(o,"mouseenter",WN,e),n.setPendingEvent(o,"mouseleave",SN,e),n.setPendingEvent(o,"badge-click",GN,e))}function XN(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-assets-sticker",RD,t)),a=o._1f=n.pendingEvents(t,r),i=o._1g=n.propsSet(r,{postcardBadge:!0,"data-l":"t,sticker","data-tsid":"sticker"});return VN(0,i,0,o),o._1h=n.addEvent(r,"click",KN,t,o),YN(0,o),n.finalizePendingEvents(a),n.mountComponent(r,i),QN}function QN(t,e){var o=e._1e,r=e._1g;VN(0,r,0,e),YN(0,e),n.finalizePendingEvents(e._1f),n.updateComponent(o,r)}function JN(t,e,o,r){e.sticker=r.value,e.price=n.get(r.value,"price"),e.showPrice=!!n.get(r.value,"price"),e.animated="POSTCARD"===n.get(r.value,"type"),e.class="POSTCARD"!==n.get(r.value,"type")?"__jump-okmsg":""}function $N(t,e,n,o){Zt(t,"pick-sticker",{sticker:o.value,stickerOrigin:"hello_panel"})}function ZN(t,e,n,o){CN(o.value,t,0,n)}function tq(t,e){"STATIC"!==n.get(e.value,"type")&&n.setPendingEvent(e._1p,"mouseenter",ZN,e)}function eq(t,e){"STATIC"!==n.get(e.value,"type")&&n.setPendingEvent(e._1p,"mouseleave",kN,e)}function nq(t,e,o){var r=o._1o=n.insert(e,n.createComponent("msg-assets-sticker-old",_D,t)),a=o._1p=n.pendingEvents(t,r),i=o._1q=n.propsSet(r,{isVisible:!0,"data-l":"t,sticker"});return JN(0,i,0,o),o._1r=n.addEvent(r,"click",$N,t,o),tq(0,o),eq(0,o),n.finalizePendingEvents(a),n.mountComponent(r,i),oq}function oq(t,e){var o=e._1o,r=e._1q;JN(0,r,0,e),tq(0,e),eq(0,e),n.finalizePendingEvents(e._1p),n.updateComponent(o,r)}function rq(t){return n.get(t.store.data.config,"server","hello-redesign")?XN:nq}function aq(t,e,o){return o._1b=n.mountBlock(t,e,rq),iq}function iq(t,e){n.updateBlock(e._1b)}function sq(t,e,o){return o._18=n.mountIterator(t,e,FN,aq),uq}function uq(t,e){n.updateIterator(e._18)}function cq(t){return n.get(t.props.stickers,"loading")?HN:sq}function pq(t,e){var o=e._23;n.get(t.store.data.config,"server","hello-redesign")&&(n.setPendingEvent(o,"mouseenter",MN,e),n.setPendingEvent(o,"mouseleave",BN,e))}function lq(t,e,o){e.sticker=n.get(o.state.active,"sticker"),e.soundIfAllowed=o.state.stickerSound}function mq(t,e){var o=e._28,r=e._29;n.setPendingRef(e._1,"stickerPreview",e._22),pq(t,e),lq(0,r,t),n.updateComponent(o,r),n.finalizePendingEvents(e._23)}function dq(t,e,o){return o._22?mq(t,o):function(t,e,o){var r=o._22=n.insert(e,n.createComponent("msg-assets-panel-tooltip",eD,t)),a=r.componentModel.input;n.setPendingRef(o._1,"stickerPreview",r);var i=o._23=n.pendingEvents(t,r);pq(t,o);var s=o._28=n.insert(a,n.createComponent("msg-sticker",Uu,t),""),u=o._29=n.propsSet(s,{size:"postcardPreview",autoplay:!0,loop:!0,"data-l":"t,sticker"});lq(0,u,t),n.mountComponent(s,u),n.finalizePendingEvents(i),n.mountComponent(r,n.propsSet(r,{class:"preview-okmsg","data-l":"t,stickerPreview"}))}(t,e,o),n.animate(o._22,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",jN)),_q}function _q(t,e){mq(t,e)}function fq(t){return t.state.active?dq:null}function gq(t,e){n.updateText(e._h,n.get(t.props.stickers,"header")),n.updateBlock(e._p),qN(e._z,e._10,t),n.updateBlock(e._11),n.updateBlock(e._1x)}function vq(t,e,o){return o._e?gq(t,o):function(t,e,o){var r=o._e=n.insert(e,n.elem("section",jN)),a=n.appendChild(r,n.elem("div",jN));n.setClass(a,"hello-header-okmsg");var i=n.appendChild(a,n.elem("div",jN));n.setClass(i,"hello-text-okmsg"),o._h=n.appendChild(i,n.text(n.get(t.props.stickers,"header")));var s=o._i=n.appendChild(a,n.createComponent("msg-button",fe,t)),u=s.componentModel.input;o._k=n.addEvent(s,"click",zN,t,o);var c=o._l=n.insert(u,n.createComponent("msg-icon",xe,t),"");n.mountComponent(c,n.propsSet(c,{icon:"clear"})),n.mountComponent(s,n.propsSet(s,{class:"hello-close-okmsg",shape:"circle","data-l":"t,close"}));var p=n.appendChild(r,n.elem("div",jN)),l=n.createInjector(p);n.setClass(p,"hello-stickers-okmsg"),n.setAttribute(p,"data-l","t,helloStickers"),o._p=n.mountBlock(t,l,NN);var m=o._z=n.insert(l,n.elem("div",jN)),d=n.createInjector(m);qN(m,o._10=n.obj(),t),o._11=n.mountBlock(t,d,cq),o._1x=n.mountBlock(t,l,fq)}(t,e,o),n.animate(o._e,aN(o._e,t,{duration:400})),hq}function hq(t,e){gq(t,e)}function Cq(t,e,o){e.imgSrc=n.get(o.props.link,"iconSrc"),e.style="color: "+n.get(o.props.link,"color"),e["data-l"]=n.get(o.props.link,"isPostcard")?"t,postcard":"t,set"}function kq(t){return n.get(t.props.link,"header")}function bq(t,e,o){var r=o._2p=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._2r=n.addEvent(r,"click",TN,t,o);var i=o._2s=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"clear"})),n.mountComponent(r,n.propsSet(r,{class:"close-okmsg",shape:"circle","data-l":"t,close"}))}function yq(t){return n.get(t.props.link,"closeEnabled")?bq:null}function Sq(t,e){var o=e._2h,r=e._2i;Cq(0,r,t),n.updateInnerHTML(e._2k),n.updateComponent(o,r),n.updateBlock(e._2m)}function wq(t,e,o){return o._2f?Sq(t,o):function(t,e,o){var r=o._2f=n.insert(e,n.elem("section",jN)),a=n.appendChild(r,n.elem("div",jN)),i=n.createInjector(a);n.setClass(a,"msg-redlink-okmsg"),n.setAttribute(a,"data-l","t,redlink");var s=o._2h=n.insert(i,n.createComponent("msg-tico",rc,t)),u=s.componentModel.input,c=o._2i=n.propsSet(s,{size:"redlink"});Cq(0,c,t),o._2j=n.addEvent(s,"click",hN,t,o),o._2k=n.mountInnerHTML(t,u,kq),n.mountComponent(s,c),o._2m=n.mountBlock(t,i,yq)}(t,e,o),n.animate(o._2f,aN(o._2f,t,{duration:200})),Eq}function Eq(t,e){Sq(t,e)}function xq(t){return t.props.alert?LN:t.props.stickers&&!n.get(t.props.stickers,"hidden")?vq:t.props.link&&!n.get(t.props.link,"hidden")?wq:null}function Iq(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();return e._2=n.mountBlock(t,r,xq),n.subscribeStore(t,["isMobile","config"]),n.finalizePendingRefs(t,a),Bq}function Bq(t,e){n.updateBlock(e._2),n.finalizePendingRefs(t,e._1)}LN.dispose=function(t,e){var o=t._7;n.animate(o,iN(0,e,{duration:400}),(function(){return function(t){t._8=n.unmountComponent(t._8),t._7=n.domRemove(t._7),t._9=null}(t)}))},UN.dispose=function(t){t._u=n.removeEvent("click",t._u),t._v=n.unmountComponent(t._v),t._s=n.unmountComponent(t._s)},HN.dispose=function(t){t._14=n.unmountComponent(t._14)},XN.dispose=function(t){t._1f=n.detachPendingEvents(t._1f),t._1h=n.removeEvent("click",t._1h),t._1e=n.unmountComponent(t._1e),t._1g=null},nq.dispose=function(t){t._1p=n.detachPendingEvents(t._1p),t._1r=n.removeEvent("click",t._1r),t._1o=n.unmountComponent(t._1o),t._1q=null},aq.dispose=function(t){t._1b=n.unmountBlock(t._1b)},sq.dispose=function(t){t._18=n.unmountIterator(t._18)},dq.dispose=function(t,e){n.animate(t._22,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",jN),(function(){return function(t){var e=t._22;t._23=n.detachPendingEvents(t._23),t._28=n.unmountComponent(t._28),t._22=n.unmountComponent(e),n.domRemove(e),t._29=null}(t)}))},vq.dispose=function(t,e){var o=t._e;n.animate(o,iN(0,e,{duration:400}),(function(){return function(t){t._k=n.removeEvent("click",t._k),t._l=n.unmountComponent(t._l),t._i=n.unmountComponent(t._i),t._p=n.unmountBlock(t._p),t._11=n.unmountBlock(t._11),t._1x=n.unmountBlock(t._1x),t._e=n.domRemove(t._e),t._h=t._10=t._z=null}(t)}))},bq.dispose=function(t){t._2r=n.removeEvent("click",t._2r),t._2s=n.unmountComponent(t._2s),t._2p=n.unmountComponent(t._2p)},wq.dispose=function(t,e){var o=t._2f;n.animate(o,iN(0,e,{duration:200}),(function(){return function(t){t._2j=n.removeEvent("click",t._2j),t._2k=n.unmountInnerHTML(t._2k),t._2h=n.unmountComponent(t._2h),t._2m=n.unmountBlock(t._2m),t._2f=n.domRemove(t._2f),t._2i=null}(t)}))},Iq.dispose=function(t){t._2=n.clearBlock(t._2)};var Mq={__proto__:null,cssScope:jN,default:Iq,slideUpNotify:iN,slideDownNotify:aN,props:function(){return{stickers:null,link:null}},events:vN,didChange:function(t,e){var n=e.backgroundId,o=e.link;if((null==n?void 0:n.current)||(null==o?void 0:o.current)){var r=t.props,a=r.backgroundId,i=r.link,s=i&&!i.hidden?AN(null==i?void 0:i.url):null;a&&String(a)===s&&TN(t)}},onRedLinkClick:hN,didRender:function(t){var e=t.refs.stickerPreview;if(e){var n=t.state.active;n&&e.align({x:n.rect.left+n.rect.width/2,y:n.rect.top})}},willUnmount:function(t){IN()},onMouseEnter:CN,onMouseLeave:kN,resetPreviewScheduleOld:bN,onStickerEnter:yN,onStickerExit:SN,onBadgeClick:wN,hideStickerSuggestions:BN,cancelHideStickerSuggestions:MN,closeRedLink:TN};var Aq={scroll:function(t){t._list.handleScroll(t),t.scrollHeight-t.scrollTop-t.offsetHeight<200&&Zt(t,"message-search-more",{chatId:t.props.chat.id})}};function Tq(t,e,n){n.target.classList.contains("hashtag")||(n.stopPropagation(),n.preventDefault(),Zt(e,"message-search-select-result",t))}var jq="ef8dek5";function Pq(t,e){e.value=void 0}function Rq(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function Lq(t){return n.get(t.state.scrollList,"groups")}function Oq(t,e){return n.get(e.value,"id")}function zq(t,e,o,r){n.updateAttribute(t,e,"data-group",n.get(r.value,"id"))}function Dq(t,e){return n.get(e.value,"items")}function Uq(t,e){return n.get(e.value,"value","id")}function Nq(t,e){e.item=n.get(e.value,"value")}function qq(t,e,o,r){n.updateAttribute(t,e,"data-item-id",n.get(r.item,"id"))}function Hq(t,e,o){var r=o._l=n.insert(e,n.elem("div",jq)),a=o._m=n.obj();n.setClass(r,"date-delimiter-okmsg"),qq(r,a,0,o);var i=n.appendChild(r,n.elem("span",jq));return n.setClass(i,"date-okmsg"),o._o=n.appendChild(i,n.text(n.get(o.item,"label"))),Fq}function Fq(t,e){qq(e._l,e._m,0,e),n.updateText(e._o,n.get(e.item,"label"))}function Vq(t,e,o,r){e.message=n.get(r.item,"message"),e.mine=n.get(r.item,"message","sender","current"),e.highlights=n.get(r.item,"highlights"),e.container=o,e["data-item-id"]=n.get(r.item,"id")}function Kq(t,e,n,o){Tq(o.item,t,e)}function Wq(t,e,o){var r=o._r=n.insert(e,n.createComponent("msg-message",GT,t)),a=o._s=n.propsSet(r,{sequence:"single",search:!0,"data-tsid":"messages_search_result_item"});return Vq(0,a,t,o),o._t=n.addEvent(r,"click",Kq,t,o),n.mountComponent(r,a),Gq}function Gq(t,e){var o=e._r,r=e._s;Vq(0,r,t,e),n.updateComponent(o,r)}function Yq(t,e){return"date"===n.get(e.item,"type")?Hq:Wq}function Xq(t,e,o){return Nq(0,o),o._i=n.mountBlock(t,e,Yq),Qq}function Qq(t,e){Nq(0,e),n.updateBlock(e._i)}function Jq(t,e,o){var r=o._b=n.insert(e,n.elem("div",jq)),a=n.createInjector(r);return zq(r,o._c=n.obj(),0,o),o._d=n.mountKeyIterator(t,a,Dq,Uq,Xq),$q}function $q(t,e){zq(e._b,e._c,0,e),n.updateKeyIterator(e._d)}function Zq(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px; text-align: center;")}function tH(t,e,o){var r=o._10=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r)}function eH(t){return"loading"==n.get(t.props.chat,"search","loadState")?tH:null}function nH(t,e,o){Rq(o._6=n.insert(e,n.elem("div",jq)),o._7=n.obj(),t),o._8=n.mountKeyIterator(t,e,Lq,Oq,Jq);var r=o._v=n.insert(e,n.elem("div",jq)),a=n.createInjector(r);return Zq(r,o._w=n.obj(),t),o._x=n.mountBlock(t,a,eH),oH}function oH(t,e){Rq(e._6,e._7,t),n.updateKeyIterator(e._8),Zq(e._v,e._w,t),n.updateBlock(e._x)}function rH(t,e,o){var r=o._14=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{class:"first-loading-okmsg"}))}function aH(t,e,o){var r=o._18=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"message-not-found",class:"search-empty-okmsg"}))}function iH(t){return Tt(0,n.get(t.state.scrollList,"items"))?nH:"loading"==n.get(t.props.chat,"search","loadState")?rH:"idle"==n.get(t.props.chat,"search","loadState")?aH:null}function sH(t,e){var o=t.componentView,r=n.createInjector(o);return Pq(0,e),e._3=n.mountBlock(t,r,iH),uH}function uH(t,e){Pq(0,e),n.updateBlock(e._3)}Hq.dispose=function(t){t._m=t._o=t._l=null},Wq.dispose=function(t){t._t=n.removeEvent("click",t._t),t._r=n.unmountComponent(t._r),t._s=null},Xq.dispose=function(t){t._i=n.unmountBlock(t._i)},Jq.dispose=function(t){t._d=n.unmountKeyIterator(t._d),t._c=t._b=null},tH.dispose=function(t){t._10=n.unmountComponent(t._10)},nH.dispose=function(t){t._8=n.unmountKeyIterator(t._8),t._x=n.unmountBlock(t._x),t._7=t._6=t._w=t._v=null},rH.dispose=function(t){t._14=n.unmountComponent(t._14)},aH.dispose=function(t){t._18=n.unmountComponent(t._18)},sH.dispose=function(t){t._3=n.clearBlock(t._3)};var cH={__proto__:null,cssScope:jq,default:sH,props:function(){return{chat:null}},events:Aq,init:function(t){t._list=new YL({initialItems:25,itemHeight:34,paddingBottom:10,onUpdate:function(e){return function(t,e){if(e.items.length&&"date"!==e.items[0].type)for(var n=e.from,o=t._list.items;--n>=0;)if("date"===o[n].type){e=Object.assign({},e,{items:[{value:o[n]}].concat(e.items),before:e.before-t._list.itemHeight(o[n])});break}var r,a=[];e.items.forEach((function(t){"date"===t.value.type?(r=[t],a.push({id:"g-"+t.value.date.getTime(),items:r})):r.push(t)})),t.setState({scrollList:Object.assign({},e,{groups:a})})}(t,e)}})},didRender:function(t){t._list.readRects(t.componentView,"data-item-id")},didChange:function(t,e){var n=e.chat;if((n=n.current)&&n.search){var o=function(t,e){if(t&&t.search.result){var n=wL(e||[]),o=function(t,e){if(!t)return[];return t.map((function(t){return"id"in t||(t=yL(t,"id",t.message.id)),t.id in e?SL(e[t.id],t):t}))}(t.search.result,n);return o=function(t,e){return e.map((function(e){return"CHANNEL"===e.message.type&&e.chat!==e?Object.assign({},e,{chat:t}):e}))}(t,o),o=EL(o,"id",n,"message.time")}return[]}(n,t._prevItems);t._prevItems&&qw(o,t._prevItems,!0)||(t._prevItems=o,t._list.update(o,t))}},onSelectResult:Tq};function pH(t,e){var n=e.props.posting,o=n.shares.items.length;Zt(e,"select-share-preview",{chatId:n.chatId,selected:(t+o)%o})}var lH="eba2k1b";function mH(t,e){e.selected=n.get(t.props.posting,"shares","selected"),e.total=Tt(0,n.get(t.props.posting,"shares","items")),e.current=n.get(t.props.posting,"shares","items",e.selected),e.ifExpr=Tt(0,n.get(t.props.posting,"shares","items"))>1}function dH(t,e,o,r){n.updateClass(t,e,"controls-okmsg"+(r.ifExpr?" multiple-okmsg":""))}function _H(t,e,n,o){pH(o.selected+1,t)}function fH(t,e,n,o){pH(o.selected-1,t)}function gH(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._e=n.addEvent(r,"click",_H,t,o);var i=o._f=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"arrow-right",size:"nano",class:"arrow-left-okmsg"})),n.mountComponent(r,n.propsSet(r,{class:"arrow-okmsg"})),o._i=n.insert(e,n.text(o.selected+1)),n.insert(e,n.text(" из ")),o._k=n.insert(e,n.text(o.total));var s=o._l=n.insert(e,n.createComponent("msg-button",fe,t)),u=s.componentModel.input;o._n=n.addEvent(s,"click",fH,t,o);var c=o._o=n.insert(u,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(c,n.propsSet(c,{icon:"arrow-right",size:"nano"})),n.mountComponent(s,n.propsSet(s,{class:"arrow-okmsg"})),vH}function vH(t,e){n.updateText(e._i,e.selected+1),n.updateText(e._k,e.total)}function hH(t,e){return e.ifExpr?gH:null}function CH(t){Zt(t,"remove-share-preview",{chatId:n.get(t.props.posting,"chatId")})}function kH(t,e,o,r){n.updateAttribute(t,e,"style","background-image: url('"+n.get(r.current,"url")+"');")}function bH(t,e,o){var r=o._11=n.insert(e,n.elem("div",lH)),a=o._12=n.obj();return n.setClass(r,"photo-okmsg"),kH(r,a,0,o),yH}function yH(t,e){kH(e._11,e._12,0,e)}function SH(t,e,n,o){e.attachment=o.current}function wH(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-attach-share",_f,t)),a=o._16=n.propsSet(r,{"data-tsid":"share_attachment_in_TA",compact:!0});return SH(0,a,0,o),n.mountComponent(r,a),EH}function EH(t,e){var o=e._15,r=e._16;SH(0,r,0,e),n.updateComponent(o,r)}function xH(t,e){return"PHOTO"===n.get(e.current,"_type")?bH:wH}function IH(t,e){var o=t.componentView;mH(t,e);var r=n.appendChild(o,n.elem("div",lH)),a=n.createInjector(r);n.setClass(r,"main-okmsg");var i=e._7=n.insert(a,n.elem("div",lH)),s=n.createInjector(i);dH(i,e._8=n.obj(),0,e),e._9=n.mountBlock(t,s,hH);var u=e._s=n.insert(s,n.createComponent("msg-button",fe,t)),c=u.componentModel.input;e._u=n.addEvent(u,"click",CH,t,e);var p=e._v=n.insert(c,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(p,n.propsSet(p,{icon:"clear",size:"nano"})),n.mountComponent(u,n.propsSet(u,{class:"close_btn-okmsg secondary-okmsg","data-tsid":"remove_attached_share",shape:"circle",size:"small"})),e._y=n.mountBlock(t,a,xH),BH}function BH(t,e){mH(t,e),dH(e._7,e._8,0,e),n.updateBlock(e._9),n.updateBlock(e._y)}gH.dispose=function(t){t._e=n.removeEvent("click",t._e),t._f=n.unmountComponent(t._f),t._c=n.unmountComponent(t._c),t._n=n.removeEvent("click",t._n),t._o=n.unmountComponent(t._o),t._l=n.unmountComponent(t._l),t._i=t._k=null},bH.dispose=function(t){t._12=t._11=null},wH.dispose=function(t){t._15=n.unmountComponent(t._15),t._16=null},IH.dispose=function(t){t._9=n.unmountBlock(t._9),t._u=n.removeEvent("click",t._u),t._v=n.unmountComponent(t._v),t._s=n.unmountComponent(t._s),t._y=n.unmountBlock(t._y)};var MH={__proto__:null,cssScope:lH,default:IH,selectShare:pH};function AH(t){return null==t?"auto":"number"==typeof t?t+"px":t}function TH(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"photo"}))}TH.dispose=function(t){t._1=n.unmountComponent(t._1)};var jH={__proto__:null,cssScope:"e-poqc7d",default:TH,didChange:function(t,e){(e.width||e.height)&&(t.style.width=AH(t.props.width),t.style.height=AH(t.props.height))}};function PH(t,e){e.stopPropagation(),Zt(t,"close")}function RH(t){t.load()}var LH="exq3qur";function OH(t,e,o){n.updateAttribute(t,e,"src",o.state.preview)}function zH(t,e,o){var r=o._7=n.insert(e,n.elem("img",LH)),a=o._8=n.obj();return n.setClass(r,"preview-okmsg"),n.setAttribute(r,"alt",""),OH(r,a,t),DH}function DH(t,e){OH(e._7,e._8,t)}function UH(t,e,o){n.updateAttribute(t,e,"src",o.state.preview)}function NH(t,e,o){var r=o._b=n.insert(e,n.elem("video",LH)),a=o._c=n.obj();return n.setClass(r,"preview-okmsg"),UH(r,a,t),o._d=n.mountUse(t,r,RH),qH}function qH(t,e){UH(e._b,e._c,t)}function HH(t){return"PHOTO"===t.state.type?zH:"VIDEO"===t.state.type?NH:null}function FH(t,e,n){e.icon=n.props.canPreview?"preview":"video"}function VH(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._j=n.insert(a,n.createComponent("msg-icon",xe,t),""),s=o._k=n.propsSet(i,{size:"medium"});return FH(0,s,t),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"inverted-okmsg open-okmsg"})),KH}function KH(t,e){var o=e._j,r=e._k;FH(0,r,t),n.updateComponent(o,r)}function WH(t){return"VIDEO"===n.get(t.props.attachment,"_type")||t.props.canPreview?VH:null}function GH(t,e,o){return o._4=n.mountBlock(t,e,HH),o._e=n.mountBlock(t,e,WH),YH}function YH(t,e){n.updateBlock(e._4),n.updateBlock(e._e)}function XH(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-img-stub",jH,t));n.mountComponent(r)}function QH(t){return t.state.preview?GH:XH}function JH(t,e,o){var r=o._z=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"error"}))}function $H(t,e,o){e.spin="completed"!==n.get(o.props.attachment,"status"),e.progress="completed"==n.get(o.props.attachment,"status")?1:n.get(o.props.attachment,"progress","loaded")/n.get(o.props.attachment,"progress","total")}function ZH(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-progress",Ps,t)),a=o._14=n.propsSet(r,{"data-tsid":"upload-bar"});return $H(0,a,t),n.mountComponent(r,a),tF}function tF(t,e){var o=e._13,r=e._14;$H(0,r,t),n.updateComponent(o,r)}function eF(t){return n.get(t.props.attachment,"error")?JH:ZH}function nF(t,e){var o=t.componentView,r=n.createInjector(o);e._1=n.mountBlock(t,r,QH);var a=e._q=n.insert(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input;e._s=n.addEvent(a,"click",PH,t,e);var s=e._t=n.insert(i,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"close",size:"nano"})),n.mountComponent(a,n.propsSet(a,{class:"remove-okmsg",size:"small",shape:"circle"})),e._w=n.mountBlock(t,r,eF),oF}function oF(t,e){n.updateBlock(e._1),n.updateBlock(e._w)}zH.dispose=function(t){t._8=t._7=null},NH.dispose=function(t){t._d=n.unmountUse(t._d),t._c=t._b=null},VH.dispose=function(t){t._j=n.unmountComponent(t._j),t._h=n.unmountComponent(t._h),t._k=null},GH.dispose=function(t){t._4=n.unmountBlock(t._4),t._e=n.unmountBlock(t._e)},XH.dispose=function(t){t._o=n.unmountComponent(t._o)},JH.dispose=function(t){t._z=n.unmountComponent(t._z)},ZH.dispose=function(t){t._13=n.unmountComponent(t._13),t._14=null},nF.dispose=function(t){t._1=n.clearBlock(t._1),t._s=n.removeEvent("click",t._s),t._t=n.unmountComponent(t._t),t._q=n.unmountComponent(t._q),t._w=n.clearBlock(t._w)};var rF={__proto__:null,cssScope:LH,default:nF,props:function(){return{attachment:null,canPreview:!1}},didChange:function(t,e){var n,o,r,a=e.attachment;if(a){var i=xm(a.current,"file"),s=xm(a.prev,"file"),u=t.state.preview;i!==s&&(!s||s.objectUrl||s.url||s.thumbnail||!u||URL.revokeObjectURL(u),t.setState({preview:St(a.current)})),t.setState({type:a.current?(n=a.current,o=n.file&&!(n.file instanceof Blob),r=n._type,"VIDEO"===r&&o?"PHOTO":"PHOTO"===r&&n.file&&/^video\//.test(n.file.type||"")?"VIDEO":r):null})}},onCloseClick:PH,loadVideo:RH},aF={animate:!1,axis:"vertical",duration:300,easing:function(t,e,n,o){return(t/=o/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e}};function iF(t,e){return void 0===e&&(e="vertical"),"horizontal"===e?t.scrollWidth-t.clientWidth:t.scrollHeight-t.clientHeight}function sF(t,e){return t.scrollHeight-t.scrollTop-t.offsetHeight<e}function uF(t,e,n){if(n&&n.animate){var o=n.maxAnimatedScroll,r=pF(t,n.axis);o&&Math.abs(e-r)>o&&(r=e>r?e-o:e+o),cF(t,r,e,n)}else n&&"horizontal"===n.axis?t.scrollLeft=e:t.scrollTop=e}function cF(t,e,o,r){r=n.__assign(n.__assign({},aF),r);var a=o-e,i=r.duration,s=r.easing,u=Date.now(),c=e;t.$scrollId=u;var p=function(){if(t.$scrollId===u){var n=Math.min(Date.now()-u,i),o=Math.round(s(n,e,a,i));"horizontal"===r.axis?t.scrollLeft+=o-c:t.scrollTop+=o-c,c=o,n<i&&requestAnimationFrame(p)}};uF(t,e,{axis:r.axis}),requestAnimationFrame(p)}function pF(t,e){return"horizontal"===e?t.scrollLeft:t.scrollTop}n.__assign(n.__assign({},aF),{dir:"up",delay:0,accel:.6,maxStep:30,step:5,shortClickDuration:300});var lF=40,mF=8;function dF(t){var e=t.refs.scroller,n=e.scrollTop,o=e.scrollHeight,r=e.clientHeight,a=r*t.props.focusEdge,i=n+a+(r-a)*(n/(o-r)),s=function(t,e){var n=t.scrollHeight,o=e.map((function(t){return t.offsetTop}));return o.push(n),hF(t).map((function(t,e){return{elem:t,top:o[e],bottom:o[e+1]}}))}(e,hF(e)),u=s.find((function(t){return t.top<=i&&t.bottom>=i}));u&&CF(t,u.elem),Ot(t,"content-scroll",{scroller:e})}function _F(t,e){Ot(e,"tab-click",{id:t}),function(t,e){var n=vF(t.refs.scroller,e);if(n){var o=t.props,r=o.maxAnimatedScroll,a=o.scrollDuration;uF(t.refs.scroller,n.offsetTop,{animate:!0,axis:"vertical",duration:a,maxAnimatedScroll:r})}}(e,t)}function fF(t){var e=t.refs.tabs,n=e.scrollWidth!==e.clientWidth;t.setState({tabScrollLeft:n&&e.scrollLeft>0,tabScrollRight:n&&e.scrollLeft<iF(e,"horizontal")})}function gF(t,e){var n=e.refs.tabs,o=e.props.maxAnimatedScroll;uF(n,n.scrollLeft+lF*mF*("prev"===t?-1:1),{animate:!0,axis:"horizontal",duration:300,maxAnimatedScroll:o}),fF(e)}function vF(t,e){return hF(t).find((function(t){return t.dataset.id===e}))}function hF(t){for(var e=[],n=0;n<t.children.length;n++){var o=t.children[n];o.dataset.id&&e.push(o)}return e}function CF(t,e){var n=e?e.dataset.id:null,o=t.state.active;if(t.setState({active:n}),n&&n!==o){var r=t.refs.tabs,a=vF(r,n),i=.2;if(a){var s=r.scrollLeft,u=r.clientWidth,c=s+u*i,p=s+.8*u,l=null;a.offsetLeft<c?l=a.offsetLeft-u*i:a.offsetLeft+a.clientWidth>p&&(l=a.offsetLeft-.8*r.clientWidth),null!==l&&uF(r,Tn(l,0,iF(r,"horizontal")),{axis:"horizontal",animate:!0,duration:200})}}}function kF(t){return function(){return function(t){var e=t.$stepScroll;if(e){var n=e.params;if(e.start+n.shortClickDuration>Date.now()){var o="left"===n.dir||"up"===n.dir?-1:1,r=n.step,a=pF(t,n.axis),i=n.maxStep;"function"==typeof r?i=r(t,n):"number"==typeof r&&(i=r),cF(t,a,Math.round(a/i)*i+i*o,n)}else e.accel=-n.accel}}(t.refs.tabs)}}var bF="e-rs1ara",yF={"tab-item":{body:qF,defaults:{item:null,active:!1,pos:0}},content:{body:YF,defaults:{item:null,active:!1,pos:0}}};function SF(t){t.class="custom-scrollbar-okmsg js-lottie-observer",t["data-tsid"]="content"}function wF(t){return t.props.list}function EF(t,e,o){return o._a=n.mountPartial(t,e,n.getPartial(t,"content",yF),{item:o.value,active:n.get(o.value,"id")===t.state.active,pos:o.index,":a":o._4,":e":o._3}),xF}function xF(t,e){n.updatePartial(e._a,n.getPartial(t,"content",yF),{item:e.value,active:n.get(e.value,"id")===t.state.active,pos:e.index,":a":e._4,":e":e._3})}function IF(t){return t.props.tabs||t.props.list}function BF(t,e,o){t["data-id"]=n.get(o.value,"id"),t.class=n.get(o.value,"id")===e.state.active?"selected-okmsg":""}function MF(t,e,o,r){_F(n.get(r.value,"id"),t)}function AF(t,e,o){var r=o._i=n.insert(e,n.elem("li",bF)),a=n.createInjector(r),i=o._j=n.pendingEvents(t,r),s=o._k=n.obj(),u=o._l=n.obj();return BF(s,t,o),n.setPendingEvent(i,"click",MF,o),o._n=n.mountPartial(t,a,n.getPartial(t,"tab-item",yF),{item:o.value,active:n.get(o.value,"id")===t.state.active,pos:o.index,":a":s,":e":i}),n.finalizePendingEvents(i),n.finalizeAttributes(r,s,u),TF}function TF(t,e){var o=e._j,r=e._k;BF(r,t,e),n.setPendingEvent(o,"click",MF,e),n.updatePartial(e._n,n.getPartial(t,"tab-item",yF),{item:e.value,active:n.get(e.value,"id")===t.state.active,pos:e.index,":a":r,":e":o}),n.finalizePendingEvents(o),n.finalizeAttributes(e._i,r,e._l)}function jF(t,e,n){e.class="left-okmsg"+(n.state.tabScrollLeft?"":" disabled-okmsg")}function PF(t,e,n){gF("prev",t)}function RF(t,e,n){e.class="right-okmsg"+(n.state.tabScrollRight?"":" disabled-okmsg")}function LF(t,e,n){gF("next",t)}function OF(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-icon",xe,t)),a=o._v=n.propsSet(r,{icon:"arrow-right"});jF(0,a,t),o._w=n.addEvent(r,"click",PF,t,o),n.mountComponent(r,a);var i=o._x=n.insert(e,n.createComponent("msg-icon",xe,t)),s=o._y=n.propsSet(i,{icon:"arrow-right"});return RF(0,s,t),o._z=n.addEvent(i,"click",LF,t,o),n.mountComponent(i,s),zF}function zF(t,e){var o=e._u,r=e._v,a=e._x,i=e._y;jF(0,r,t),n.updateComponent(o,r),RF(0,i,t),n.updateComponent(a,i)}function DF(t){return t.state.tabScrollLeft||t.state.tabScrollRight?OF:null}function UF(t,e){var o=t.componentView,r=e._1=n.obj(),a=e._2=n.appendChild(o,n.elem("div",bF)),i=n.createInjector(a);n.setPendingRef(r,"scroller",a);var s=e._3=n.pendingEvents(t,a),u=e._4=n.obj(),c=e._5=n.obj();SF(u),n.setPendingEvent(s,"scroll",dF,e),e._7=n.mountIterator(t,i,wF,EF),n.finalizePendingEvents(s),n.finalizeAttributes(a,u,c);var p=n.appendChild(o,n.elem("footer",bF)),l=e._d=n.appendChild(p,n.elem("ul",bF)),m=n.createInjector(l);n.setPendingRef(r,"tabs",l),e._e=n.addEvent(l,"scroll",fF,t,e),e._f=n.mountIterator(t,m,IF,AF);var d=n.appendChild(p,n.elem("div",bF)),_=n.createInjector(d);return n.setClass(d,"scroll-controls-okmsg"),e._r=n.mountBlock(t,_,DF),n.appendChild(p,n.createSlot(t,"controls",bF)),e._12=n.mountSlot(t,"controls"),n.finalizePendingRefs(t,r),NF}function NF(t,e){var o=e._1,r=e._2,a=e._3,i=e._4;n.setPendingRef(o,"scroller",r),SF(i),n.setPendingEvent(a,"scroll",dF,e),n.updateIterator(e._7),n.finalizePendingEvents(a),n.finalizeAttributes(r,i,e._5),n.setPendingRef(o,"tabs",e._d),n.updateIterator(e._f),n.updateBlock(e._r),n.finalizePendingRefs(t,o)}function qF(t,e,o){return o._16=n.insert(e,n.text(n.get(o.item,"id"))),HF}function HF(t,e){n.updateText(e._16,n.get(e.item,"id"))}function FF(t,e){e.value=void 0}function VF(t,e,o,r){n.updateAttribute(t,e,"data-id",n.get(r.value,"id")),n.updateClass(t,e,n.get(r.value,"id")===o.state.active?"selected-okmsg":"")}function KF(t,e){return n.get(e.item,"items")}function WF(t,e,o){var r=n.insert(e,n.elem("span",bF));return o._1h=n.appendChild(r,n.text(o.value)),GF}function GF(t,e){n.updateText(e._1h,e.value)}function YF(t,e,o){FF(0,o);var r=o._1b=n.insert(e,n.elem("section",bF)),a=n.createInjector(r);return VF(r,o._1c=n.obj(),t,o),o._1d=n.mountIterator(t,a,KF,WF),XF}function XF(t,e){FF(0,e),VF(e._1b,e._1c,t,e),n.updateIterator(e._1d)}EF.dispose=function(t){t._a=n.unmountPartial(t._a)},AF.dispose=function(t){t._j=n.detachPendingEvents(t._j),t._n=n.unmountPartial(t._n),t._k=t._l=t._i=null},OF.dispose=function(t){t._w=n.removeEvent("click",t._w),t._u=n.unmountComponent(t._u),t._z=n.removeEvent("click",t._z),t._x=n.unmountComponent(t._x),t._v=t._y=null},UF.dispose=function(t){t._3=n.detachPendingEvents(t._3),t._7=n.unmountIterator(t._7),t._e=n.removeEvent("scroll",t._e),t._f=n.unmountIterator(t._f),t._r=n.unmountBlock(t._r),t._12=n.unmountSlot(t._12)},qF.dispose=function(t){t._16=null},WF.dispose=function(t){t._1h=null},YF.dispose=function(t){t._1d=n.unmountIterator(t._1d),t._1c=t._1b=null};var QF={__proto__:null,cssScope:bF,partials:yF,default:UF,plugins:function(){return[zS(document,"mouseup",kF)]},props:function(){return{list:null,focusEdge:.1,maxAnimatedScroll:500,scrollDuration:400}},state:function(){return{tabScrollLeft:!1,tabScrollRight:!1}},extend:{getScrollPos:function(){var t=this.refs.scroller;return t?t.scrollTop:0},setScrollPos:function(t){var e=this.refs.scroller;e&&(e.scrollTop=t)}},didMount:function(t){CF(t,t.refs.scroller.children[0])},didUpdate:function(t,e){e.list&&dF(t)},didRender:function(t){fF(t)},handleScroll:dF,onTabClick:_F,updateScrollControls:fF,onScrollTabs:gF};function JF(t,e){return new Promise((function(n,o){var r=new XMLHttpRequest;r.open("POST",t),r.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onerror=o,r.onload=function(){if(200===r.status)try{n(JSON.parse(r.responseText))}catch(t){o(t)}else o(new Error(r.statusText))},r.send(function(t){void 0===t&&(t={});return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&")}(e))}))}function $F(t,e,n,o,r){return{id:t,title:e,rows:ZF(t,n,o),params:r}}function ZF(t,e,n){for(var o=[],r=0;r<e.length;r+=n.itemsPerRow){var a=e.slice(r,r+n.itemsPerRow);if(n.stub)for(;a.length<n.itemsPerRow;)a.push({stub:!0});o.push({id:"".concat(t,"-").concat(r),pos:-1,cells:a})}return o}function tV(t,e,n){void 0===n&&(n=200);for(var o=t.scrollTop,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,i=o-n,s=o+t.clientHeight+n,u=0;u<e.length;u++){var c=e[u],p=c.offsetTop;p+c.clientHeight>i&&(r=Math.min(r,u)),p<s&&(a=Math.max(a,u))}return[r,a]}var eV,nV=0,oV="emoji-set-0",rV={itemsPerRow:10,stub:!0},aV=0,iV=0,sV=10,uV=null,cV=null,pV=null,lV=null,mV=0,dV=!1,_V=0,fV=3e5,gV=null,vV=null,hV=600;var CV={mouseover:function(t,e){if(!t.props.reactions&&!t.store.get().config.server["sticker-suggest-disabled"]){var n=xV(e,t),o=null==n?void 0:n.getAttribute("alt");o&&!RV(t,n)&&(OV(t),function(t,e,n){LV(),gV=setTimeout((function(){var o;(o=e,JF("/web-api/stickers/suggest",{query:o}).then((function(t){return t&&t.suggests}))).then((function(e){e&&function(t,e,n){t.setState({stickers:{rect:e,stickers:n}})}(t,n,e)}))}),800)}(t,o,n.getBoundingClientRect()))}},mouseout:function(t,e){t.props.reactions||xV(e,t)&&(LV(),OV(t,!0))},mousedown:function(){nV=Date.now()},click:function(t,e){var o,r=xV(e,t),a=null==r?void 0:r.getAttribute("alt"),i=parseInt(null==r?void 0:r.getAttribute("animoji-id"),10);if(a){var s=Zo(a);if(t.props.reactions)Zt(t,"message-react",{reaction:a,source:"emoji-panel"});else{var u=t.state.skinTone;if(OV(t),RV(t,r))!function(t,e){var o,r=t.state,a=r.pick,i=r.skinTone;if(a&&a.id!==e.id){i=n.__assign(n.__assign({},i),((o={})[a.id]=e,o)),t.setState({skinTone:i});try{localStorage.setItem("emojiSkin",function(t){return Object.keys(t).map(Number).reduce((function(e,n){return e.push(Xo()[n].emoji,t[n].emoji),e}),[]).join(" ")}(i))}catch(t){}}}(t,s),jV(t,s.emoji);else if(i){var c=null===(o=t.store.get().animojis)||void 0===o?void 0:o.animoji.get(i);jV(t,a,c)}else if(s&&s.skin&&!function(t){var e=t.parentNode;return e&&e.dataset.id===oV}(r)&&(!u[s.id]||Date.now()-nV>=800)){var p=t.state.pick;p=p&&p.id===s.id?null:function(t,e){return{id:e.id,rect:t.getBoundingClientRect(),items:[n.__assign(n.__assign({},e),{skin:null})].concat(e.skin)}}(r,s),t.setState({pick:p})}else{var l=u[s.id]||s;(function(t){if(!("user"in t))return!1;if(DV())return!1;if(lV&&lV.length&&lV.indexOf(t.id)>-1)return!1;return!0})(l)&&function(t){Zt(t,"open-payment-layer",{serviceId:19,callback:"buySmileysServiceTTCb"})}(t),jV(t,l.emoji)}}}}};function kV(t){return Zt(t,"assets-fetch"),JF("/web-api/smiles/user").then((function(t){return uV=uV||qV(t.recents||[]),cV=qV(t.popular||[]),pV=qV(t.paid||[]),lV=t.free||[],mV=t.expirationTime,dV=t.allSmilesFree,UV(),t}))}function bV(){return JF("/web-api/smiles/service").then((function(t){return mV=t.expirationTime,dV=t.allSmilesFree,t}))}function yV(){zV()}function SV(t){OV(t)}function wV(t,e){Zt(e,"pick-sticker",{sticker:{id:t},stickerOrigin:"smiles_panel_suggest"}),OV(e)}function EV(t,e){var n=e.detail.scroller,o=n.querySelectorAll("section"),r=tV(n,o),a=r[0],i=r[1];iV=a,sV=i,aV=n.scrollTop,t.setState({from:a,to:i}),LV(),OV(t)}function xV(t,e){var n;void 0===e&&(e=document.body);for(var o=t.target;o&&o!==e;){if(null===(n=o.classList)||void 0===n?void 0:n.contains("js-emoji"))return o;o=o.parentNode}}function IV(t){var e=function(t,e){return String.fromCharCode(Number(e))};return t=t.map((function(t){return"EMOJI"===t.type?n.__assign(n.__assign({},t),{value:t.value.replace(/&#(\d+);/g,e)}):t})),BV(l([].concat(t||[],Go),(function(t){switch(t.type){case"ANIMOJI":return t.id;case"EMOJI":return t.value;default:return t}})).slice(0,Go.length),oV,"Recent")}function BV(t,e,n){return $F(e,n,t.map((function(t){return"ANIMOJI"===t.type?et(t.id):Zo(t.value)})).filter(Boolean),rV)}function MV(){return function(){var t=G().get().animojis,e=t.animojiSets,n=t.animojiSections,r=[];return null==n||n.forEach((function(t){switch(t.type){case o.AnimojiSectionType.ANIMOJI_SETS:t.animojiSetIds.forEach((function(n,o){var a,i=e.get(n);i&&r.push({id:"animoji-set-".concat(t.id,"-").concat(n),title:i.name,items:(a=i.animojiIds,a.reduce((function(t,e){var n=et(e);return n&&t.push(n),t}),[])),iconUrl:i.iconUrl,iconLottieUrl:i.iconLottieUrl})}));case o.AnimojiSectionType.ANIMOJIS:}})),r}().map((function(t){return $F(t.id,t.title,t.items,rV,{iconUrl:t.iconUrl,iconLottieUrl:t.iconLottieUrl})}))}function AV(t,e,n,o){if(null==o?void 0:o.props){var r=o.props.reactions,a=o.store&&o.store.get().config,i=[];if(r)i=TV().filter((function(t){return"emoji-ok"!==t.id}));else{var s=[];!(null==a?void 0:a.server["animoji-v2-in-assets-panel-disable"])&&(s=MV()),i=t?[IV(t)].concat(s).concat(TV()):s.concat(TV())}if(!r)!(null==a?void 0:a.server["disable-anim-smiles"])&&(e&&e.length&&i.push(BV(e,"emoji-popular","Animated")),n&&n.length&&i.push(BV(n,"emoji-paid","Paid")));var u=0;return i.forEach((function(t){t.rows.forEach((function(t){return t.pos=u++}))})),i}return[]}function TV(){return eV||(eV=n.groups.map((function(t,e){return{id:"emoji-set-".concat(e+1),title:t.name,items:t.items.map(Qo)}})).map((function(t){return $F(t.id,t.title,t.items,rV)}))),eV}function jV(e,n,o){Zt(e,"pick-emoji",{emoji:n,emojiData:o}),e.setState({pick:null}),uV&&(o?(uV=uV.filter((function(t){return"ANIMOJI"!==t.type||t.id!==o.id}))).unshift({type:"ANIMOJI",id:o.id}):(uV=uV.filter((function(t){return"EMOJI"!==t.type||t.value!==n}))).unshift({type:"EMOJI",value:n})),new Promise((function(e,n){t(["OK/logger"],e,n)})).then((function(t){return t.success("messagesLayer","smile",n)}))}function PV(t){var e={};if(t)for(var n=t.split(" "),o=0;o<n.length;o+=2){var r=Zo(n[o]),a=Zo(n[o+1]);r&&a&&(e[r.id]=a)}return e}function RV(t,e){var n=t.refs.skinTonePicker;return n&&n.contains(e)}function LV(){gV&&(clearTimeout(gV),gV=null)}function OV(t,e){zV(),e?vV=setTimeout((function(){return OV(t)}),hV):t.setState({stickers:null})}function zV(){vV&&(clearTimeout(vV),vV=null)}function DV(){return dV||mV>Date.now()}function UV(){_V=Date.now()}function NV(t,e){return e?t.filter((function(t){return"emoji-paid"!==t.id&&"emoji-ok"!==t.id&&t.id!==oV})):t.filter((function(t){return"emoji-paid"!==t.id}))}function qV(t){return t.map((function(t){return{type:"EMOJI",value:t}}))}var HV="e-ftwam0",FV={"emoji-tab-item":{body:MK,defaults:{item:null,active:!1,pos:0}},"emoji-content":{body:QK,defaults:{item:null,active:!1,pos:0}},emoji:{body:dW,defaults:{emoji:null,"skin-tone":null}}},VV=[0],KV=[];function WV(){KV.push(VV),VV=[0]}function GV(){VV=KV.pop()}function YV(t,e,n){e.list=n.state.emoji,e.tabs=n.state.emojiTabs,e.skinTone=n.state.skinTone,e.from=n.state.from,e.to=n.state.to}function XV(t,e){t.setState({pick:null})}function QV(t){t.class="skin-tone-picker-okmsg",t["data-l"]="t,skinTonePicker"}function JV(t){return n.get(t.state.pick,"items")}function $V(t,e,o){return o._l=n.mountPartial(t,e,n.getPartial(t,"emoji",FV),{emoji:o.value,":a":o._h,":e":o._g}),ZV}function ZV(t,e){n.updatePartial(e._l,n.getPartial(t,"emoji",FV),{emoji:e.value,":a":e._h,":e":e._g})}function tK(t,e){var o=e._f,r=e._h;n.setPendingRef(e._1,"skinTonePicker",o),QV(r),n.updateIterator(e._i),n.finalizePendingEvents(e._g),n.updateComponent(o,r)}function eK(t,e,o){var r=n.insert(e,n.elem("div",HV));return n.setClass(r,"overlay-okmsg"),o._c=n.addEvent(r,"click",XV,t,o),o._f?tK(0,o):function(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-assets-panel-tooltip",eD,t)),a=r.componentModel.input;n.setPendingRef(o._1,"skinTonePicker",r);var i=o._g=n.pendingEvents(t,r),s=o._h=n.propsSet(r);QV(s),o._i=n.mountIterator(t,a,JV,$V),n.finalizePendingEvents(i),n.mountComponent(r,s)}(t,e,o),n.animate(o._f,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",HV)),nK}function nK(t,e){tK(0,e)}function oK(t){return t.state.pick?eK:null}function rK(t){return n.get(t.state.stickers,"stickers")}function aK(t,e,n,o){e.stickerId=o.value}function iK(t,e,n,o){wV(o.value,t)}function sK(t,e,o){var r=o._z=n.insert(e,n.createComponent("msg-assets-sticker",RD,t),""),a=o._10=n.propsSet(r);return aK(0,a,0,o),o._11=n.addEvent(r,"click",iK,t,o),n.mountComponent(r,a),VV[0]=1,uK}function uK(t,e){var o=e._z,r=e._10;aK(0,r,0,e),n.updateComponent(o,r)}function cK(t,e){var o=e._s;n.setPendingRef(e._1,"stickerPicker",o),n.updateIterator(e._w),n.updateIncomingSlot(o,"",VV[0])}function pK(t,e,o){return o._s?cK(0,o):function(t,e,o){var r=o._s=n.insert(e,n.createComponent("msg-assets-panel-tooltip",eD,t)),a=r.componentModel.input;n.setPendingRef(o._1,"stickerPicker",r),o._u=n.addEvent(r,"mouseenter",yV,t,o),o._v=n.addEvent(r,"mouseleave",SV,t,o),o._w=n.mountIterator(t,a,rK,sK),n.mountComponent(r,n.propsSet(r,{"data-l":"t,stickerPicker"}))}(t,e,o),n.animate(o._s,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",HV)),lK}function lK(t,e){cK(0,e)}function mK(t){return t.state.stickers?pK:null}function dK(t,e,o){return o._8=n.mountBlock(t,e,oK),o._n=n.mountBlock(t,e,mK),_K}function _K(t,e){n.updateBlock(e._8),n.updateBlock(e._n)}function fK(t){return t.props.reaction?null:dK}function gK(t,e){var o=t.componentView;WV();var r=n.createInjector(o),a=e._1=n.obj(),i=e._2=n.insert(r,n.createComponent("msg-assets-panel-group-list",QF,t));n.setPendingRef(a,"panel",i);var s=e._3=n.propsSet(i);return YV(0,s,t),s["partial:content"]=n.assign({host:t},FV["emoji-content"]),s["partial:tab-item"]=n.assign({host:t},FV["emoji-tab-item"]),e._4=n.addEvent(i,"content-scroll",EV,t,e),n.mountComponent(i,s),e._5=n.mountBlock(t,r,fK),GV(),n.finalizePendingRefs(t,a),vK}function vK(t,e){var o=e._1,r=e._2,a=e._3;WV(),n.setPendingRef(o,"panel",r),YV(0,a,t),n.updateComponent(r,a,[t.props.isRecent,t.state.to,t.state.from,t.state.skinTone]),n.updateBlock(e._5),GV(),n.finalizePendingRefs(t,o)}function hK(t,e,o,r){n.updateAttribute(t,e,"data-l","t,tab."+n.get(r.item,"id"))}function CK(t,e,o,r){e.alt=n.get(r.item,"name"),e.url=n.get(r.item,"params","iconLottieUrl"),e.id=n.get(r.item,"id")}function kK(t,e,o){var r=o._1c=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._1d=n.propsSet(r,{loop:!0,class:"tab-icon-okmsg",width:24,height:24});return CK(0,a,0,o),n.mountComponent(r,a),bK}function bK(t,e){var o=e._1c,r=e._1d;CK(0,r,0,e),n.updateComponent(o,r)}function yK(t,e,o,r){n.updateAttribute(t,e,"alt",n.get(r.item,"name")),n.updateAttribute(t,e,"src",n.get(r.item,"params","iconUrl"))}function SK(t,e,o){var r=o._1g=n.insert(e,n.elem("img",HV)),a=o._1h=n.obj();return n.setClass(r,"tab-icon-okmsg"),n.setAttribute(r,"width","24"),n.setAttribute(r,"height","24"),n.setAttribute(r,"loading","lazy"),yK(r,a,0,o),wK}function wK(t,e){yK(e._1g,e._1h,0,e)}function EK(t,e,o,r){e.icon=n.get(r.item,"id")}function xK(t,e,o){var r=o._1k=n.insert(e,n.createComponent("msg-icon",xe,t)),a=o._1l=n.propsSet(r,{size:"large"});return EK(0,a,0,o),n.mountComponent(r,a),IK}function IK(t,e){var o=e._1k,r=e._1l;EK(0,r,0,e),n.updateComponent(o,r)}function BK(t,e){return n.get(e.item,"params","iconLottieUrl")?kK:n.get(e.item,"params","iconUrl")?SK:xK}function MK(t,e,o){var r=o._17=n.insert(e,n.elem("span",HV)),a=n.createInjector(r);return hK(r,o._18=n.obj(),0,o),o._19=n.mountBlock(t,a,BK),AK}function AK(t,e){hK(e._17,e._18,0,e),n.updateBlock(e._19)}function TK(t,e){e.value=void 0}function jK(t,e,o,r){n.updateAttribute(t,e,"data-id","emoji-paid"!==n.get(r.item,"id")?n.get(r.item,"id"):null)}function PK(t,e,o){var r=n.insert(e,n.elem("h3",HV));n.setClass(r,"h3-okmsg");var a=o._1x=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{key:"recent"}))}function RK(t){return t.props.isRecent?PK:null}function LK(t,e){return n.get(e.item,"rows")}function zK(t,e){return n.get(e.value,"id")}function DK(t,e,n){t.class=0===n.index?"first-okmsg":""}function UK(t,e){return n.get(e.value,"cells")}function NK(t,e,o){return o._2c=n.mountPartial(t,e,n.getPartial(t,"emoji",FV),{emoji:o.value,"skin-tone":n.get(t.state.skinTone,n.get(o.value,"id")),":a":o._24,":e":o._23}),qK}function qK(t,e){n.updatePartial(e._2c,n.getPartial(t,"emoji",FV),{emoji:e.value,"skin-tone":n.get(t.state.skinTone,n.get(e.value,"id")),":a":e._24,":e":e._23})}function HK(t,e,o){return o._29=n.mountIterator(t,e,UK,NK),FK}function FK(t,e){n.updateIterator(e._29)}function VK(t,e){return n.get(e.value,"pos")<=t.state.to&&n.get(e.value,"pos")>=t.state.from?HK:null}function KK(t,e,o){var r=o._22=n.insert(e,n.elem("section",HV)),a=n.createInjector(r),i=o._23=n.pendingEvents(t,r),s=o._24=n.obj(),u=o._25=n.obj();return DK(s,0,o),o._26=n.mountBlock(t,a,VK),n.finalizePendingEvents(i),n.finalizeAttributes(r,s,u),WK}function WK(t,e){var o=e._24;DK(o,0,e),n.updateBlock(e._26),n.finalizePendingEvents(e._23),n.finalizeAttributes(e._22,o,e._25)}function GK(t){Zt(t,"open-user-smiles-layer")}function YK(t,e,o){var r=n.insert(e,n.elem("div",HV));n.setClass(r,"rev-okmsg");var a=n.appendChild(r,n.elem("span",HV));n.setClass(a,"rev_ac-okmsg"),n.setAttribute(a,"data-l","t,openUserSmilesLayer"),o._2j=n.addEvent(a,"click",GK,t,o),n.appendChild(a,n.text("\n                ••• "));var i=n.appendChild(a,n.elem("span",HV));n.setClass(i,"rev_text-okmsg");var s=o._2m=n.appendChild(i,n.createComponent("msg-l10n",ae,t));n.mountComponent(s,n.propsSet(s,{key:"user-smiles"}))}function XK(t,e){return"emoji-paid"==n.get(e.item,"id")?YK:null}function QK(t,e,o){TK(0,o);var r=o._1r=n.insert(e,n.elem("div",HV)),a=o._1s=n.obj();return n.setClass(r,"beacon-okmsg"),jK(r,a,0,o),o._1t=n.mountBlock(t,e,RK),o._1z=n.mountKeyIterator(t,e,LK,zK,KK),o._2e=n.mountBlock(t,e,XK),JK}function JK(t,e){TK(0,e),jK(e._1r,e._1s,0,e),n.updateBlock(e._1t),n.updateKeyIterator(e._1z),n.updateBlock(e._2e)}function $K(t,e){e.data=t.props.reactions?e.emoji:e["skin-tone"]||e.emoji,e.isAnimoji=n.get(e.emoji,"lottieUrl")&&n.get(e.emoji,"id")}function ZK(t,e){var o=n.insert(e,n.elem("div",HV));n.setClass(o,"emoji-stub-okmsg")}function tW(t,e,o,r){n.updateAttribute(t,e,"src",n.get(r.data,"url")),n.updateAttribute(t,e,"alt",n.get(r.emoji,"emoji"))}function eW(t,e,o){var r=o._2z=n.insert(e,n.elem("img",HV)),a=o._30=n.obj();return n.setClass(r,"emoji-okmsg js-emoji user-emoji-okmsg"),n.setAttribute(r,"data-l","t,userSmile"),n.setAttribute(r,"data-tsid","user-smile"),tW(r,a,0,o),nW}function nW(t,e){tW(e._2z,e._30,0,e)}function oW(t,e,o,r){e.alt=n.get(r.emoji,"emoji"),e.url=n.get(r.emoji,"lottieUrl"),e.id=n.get(r.emoji,"cid")||n.get(r.emoji,"id"),e["animoji-id"]=n.get(r.emoji,"id")}function rW(t,e,o){var r=o._36=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._37=n.propsSet(r,{loop:!0,class:"emoji-okmsg js-emoji",width:32,height:32});return oW(0,a,0,o),n.mountComponent(r,a),aW}function aW(t,e){var o=e._36,r=e._37;oW(0,r,0,e),n.updateComponent(o,r)}function iW(t,e,o,r){n.updateAttribute(t,e,"alt",n.get(r.emoji,"emoji")),n.updateAttribute(t,e,"src",n.get(r.data,"baseUrl")?o.store.data.emojiRoot+n.get(r.data,"baseUrl")+"/32/"+n.get(r.data,"fileName"):o.state.fallbackImage)}function sW(t,e,o){var r=o._3a=n.insert(e,n.elem("img",HV)),a=o._3b=n.obj();return n.setClass(r,"emoji-okmsg js-emoji"),n.setAttribute(r,"data-l","t,emoji"),n.setAttribute(r,"data-tsid","emoji"),n.setAttribute(r,"loading","lazy"),iW(r,a,t,o),uW}function uW(t,e){iW(e._3a,e._3b,t,e)}function cW(t,e){return e.isAnimoji?rW:sW}function pW(t,e,o){return o._33=n.mountBlock(t,e,cW),lW}function lW(t,e){n.updateBlock(e._33)}function mW(t,e){return n.get(e.data,"stub")?ZK:n.get(e.data,"user")?eW:pW}function dW(t,e,o){return $K(t,o),o._2t=n.mountBlock(t,e,mW),_W}function _W(t,e){$K(t,e),n.updateBlock(e._2t)}$V.dispose=function(t){t._l=n.unmountPartial(t._l)},eK.dispose=function(t,e){t._c=n.removeEvent("click",t._c),n.animate(t._f,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",HV),(function(){return function(t){var e=t._f;t._g=n.detachPendingEvents(t._g),t._i=n.unmountIterator(t._i),t._f=n.unmountComponent(e),n.domRemove(e),t._h=null}(t)}))},sK.dispose=function(t){t._11=n.removeEvent("click",t._11),t._z=n.unmountComponent(t._z),t._10=null,VV[0]=1},pK.dispose=function(t,e){n.animate(t._s,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",HV),(function(){return function(t){var e=t._s;t._u=n.removeEvent("mouseenter",t._u),t._v=n.removeEvent("mouseleave",t._v),t._w=n.unmountIterator(t._w),t._s=n.unmountComponent(e),n.domRemove(e)}(t)}))},dK.dispose=function(t){t._8=n.unmountBlock(t._8),t._n=n.unmountBlock(t._n)},gK.dispose=function(t){WV(),t._4=n.removeEvent("content-scroll",t._4),t._2=n.unmountComponent(t._2),t._5=n.clearBlock(t._5),GV()},kK.dispose=function(t){t._1c=n.unmountComponent(t._1c),t._1d=null},SK.dispose=function(t){t._1h=t._1g=null},xK.dispose=function(t){t._1k=n.unmountComponent(t._1k),t._1l=null},MK.dispose=function(t){t._19=n.unmountBlock(t._19),t._18=t._17=null},PK.dispose=function(t){t._1x=n.unmountComponent(t._1x)},NK.dispose=function(t){t._2c=n.unmountPartial(t._2c)},HK.dispose=function(t){t._29=n.unmountIterator(t._29)},KK.dispose=function(t){t._23=n.detachPendingEvents(t._23),t._26=n.unmountBlock(t._26),t._24=t._25=t._22=null},YK.dispose=function(t){t._2j=n.removeEvent("click",t._2j),t._2m=n.unmountComponent(t._2m)},QK.dispose=function(t){t._1t=n.unmountBlock(t._1t),t._1z=n.unmountKeyIterator(t._1z),t._2e=n.unmountBlock(t._2e),t._1s=t._1r=null},eW.dispose=function(t){t._30=t._2z=null},rW.dispose=function(t){t._36=n.unmountComponent(t._36),t._37=null},sW.dispose=function(t){t._3b=t._3a=null},pW.dispose=function(t){t._33=n.unmountBlock(t._33)},dW.dispose=function(t){t._2t=n.unmountBlock(t._2t)};var fW={__proto__:null,cssScope:HV,partials:FV,default:gK,state:function(t){var e=AV(uV,cV,pV,t);return{emoji:e,emojiTabs:NV(e),from:iV,to:sV,pick:null,skinTone:PV(localStorage.getItem("emojiSkin")),fallbackImage:dt}},events:CV,fetchRecentEmoji:kV,fetchSmileyService:bV,willMount:function(t){var e=t.props.reactions;uV||kV(t).then((function(n){var o=AV(n.recents&&qV(n.recents),n.popular&&qV(n.popular),n.paid&&qV(n.paid),t);t.setState({emoji:o,emojiTabs:NV(o,e)})}))},didMount:function(t){t.refs.panel.setScrollPos(aV)},didChange:function(t,e){if(e.recent){var n=AV(uV=t.props.recent,cV,pV,t),o=NV(n);t.setState({emoji:n,emojiTabs:o})}},didRender:function(t){var e=t.refs,n=e.stickerPicker,o=e.skinTonePicker;if(n){var r=t.state.stickers;n.align({x:r.rect.left+r.rect.width/2,y:r.rect.top})}if(o){var a=t.state.pick;o.align({x:a.rect.left+a.rect.width/2,y:a.rect.bottom})}!DV()&&_V+fV<Date.now()&&(UV(),bV())},onStickerPanelMouseOver:yV,onStickerPanelMouseOut:SV,onPickSticker:wV,handleScroll:EV},gW={get value(){var t=this.refs.input;return t?t.value:this.props.value},set value(t){null==t&&(t="");var e=this.refs.input;e&&e.value!==t&&(e.value=t)},clear:function(){this.value="",Zt(this,"input")},focus:function(){var t;null===(t=this.refs.input)||void 0===t||t.focus()},select:function(){var t=this.refs.input;t&&t.select()}};function vW(t){t.clear(),t.focus()}function hW(t){t.focus()}var CW="e-c13jzn";function kW(t,e,o){var r=o._4=n.insert(e,n.createComponent("msg-icon",xe,t));o._6=n.addEvent(r,"click",hW,t,o),n.mountComponent(r,n.propsSet(r,{icon:"search",size:"medium"}))}function bW(t){return t.props.showIcon?kW:null}function yW(t,e,o){n.updateAttribute(t,e,"name",o.props.name),n.updateProperty(t,e,"value",o.props.value),n.updateAttribute(t,e,"placeholder",o.props.placeholder||o.store.data.l10n("search")),n.updateProperty(t,e,"autofocus",o.props.focused),n.updateAttribute(t,e,"data-tsid",o.props.name+"-input"),n.updateAttribute(t,e,"maxlength",n.get(o.store.data.config,"server","search-max-chats-query-length")||1024)}function SW(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{indeterminate:!0,size:16,radius:6,spin:!0}))}function wW(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._j=n.addEvent(r,"click",vW,t,o);var i=o._k=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"clear"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",size:"medium",class:"controls-internal-okmsg","data-tsid":"clear_search_query"}))}function EW(t){return t.props.loading?SW:t.props.value?wW:null}function xW(t,e){var o=t.componentView,r=n.createInjector(o);e._1=n.mountBlock(t,r,bW);var a=e._8=n.insert(r,n.elem("input",CW));n.setRef(t,"input",a);var i=e._9=n.obj();return n.setAttribute(a,"type","search"),n.setAttribute(a,"autocomplete","off"),n.setClass(a,"base-input-okmsg"),yW(a,i,t),e._a=n.mountBlock(t,r,EW),n.subscribeStore(t,["l10n","config"]),IW}function IW(t,e){n.updateBlock(e._1),yW(e._8,e._9,t),n.updateBlock(e._a)}kW.dispose=function(t){t._6=n.removeEvent("click",t._6),t._4=n.unmountComponent(t._4)},SW.dispose=function(t){t._d=n.unmountComponent(t._d)},wW.dispose=function(t){t._j=n.removeEvent("click",t._j),t._k=n.unmountComponent(t._k),t._h=n.unmountComponent(t._h)},xW.dispose=function(t){t._1=n.clearBlock(t._1),t._a=n.clearBlock(t._a)};var BW={__proto__:null,cssScope:CW,default:xW,events:{click:function(t,e,n){e.target===n&&t.focus()}},extend:gW,willMount:function(t){t._shortcuts=OS({ESC:function(e,n){return function(t,e,n){var o=hr(t);o&&o.isContentEditable&&o!==t.refs.input?n():e.target.value||t.props.value?(e.stopPropagation(),t.clear(),t.focus()):n()}(t,e,n)}})},willUnmount:function(t){t._shortcuts&&(t._shortcuts.destroy(),t._shortcuts=null)},didChange:function(t,e){var n=e.value,o=e.focused;n&&(t.value=n.current),o&&o.current&&requestAnimationFrame((function(){return t.focus()}))},onClearClick:vW,onFocus:hW},MW="e-g9rzb3";function AW(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{size:50,radius:22,thickness:3,spin:!0,indeterminate:!0}));var a=n.appendChild(o,n.elemWithText("span","Загружаю...",MW));n.setClass(a,"label-okmsg")}AW.dispose=function(t){t._1=n.unmountComponent(t._1)};var TW,jW={__proto__:null,cssScope:MW,default:AW},PW=300,RW=0;var LW=[sr()],OW={"pointer:long-tap":function(t,e){e.stopPropagation();var n=function(t,e){void 0===e&&(e=document.body);var n=t.target;for(;n&&n!==e;){if("MSG-STICKER"===n.nodeName)return n;n=n.parentNode}}(e.detail.originalEvent,t);n&&Zt(t,"preview-sticker",{sticker:n.props.sticker,postcard:!0,callback:function(){return Zt(t,"pick-postcard",n.props.sticker)}})},"pointer:tap":function(t,e){e.stopPropagation(),Zt(t,"pick-postcard",e.detail.originalEvent)}};function zW(t,e,n){var o,r=n.scrollHeight,a=t.state.search||t.state.postcards,i=a&&a.hasMore&&t._lastNextRequestMarker!==r&&PW>=iF(o=n)-o.scrollTop;RW=n.scrollTop||0,i&&(t._lastNextRequestMarker=r,NW(t,function(t){if(t&&!t.hasMore)return Promise.resolve(t);return UW({firstIndex:t?t.firstIndex:0}).then((function(e){var n=(t?t.stickers:[]).concat(e.stickers);return Object.assign({},t,e,{stickers:n})}))}(a),!0).then((function(e){t.state.search?t.setState({search:e}):t.setState({postcards:e})})))}var DW=o.throttle((function(t){return qW(t,t.refs.search.value)}),300);function UW(t){return t=Object.assign({},{itemsPerPage:20},t),o.invoke("stickers/postcards",t)}function NW(t,e,n){return t.setState({loadState:"loading"}),e.then((function(e){return n&&(TW=e),t.setState({loadState:"idle",error:null}),e}),(function(e){return t.setState({loadState:"idle",error:e}),Promise.reject(e)}))}function qW(t,e){var n=t.refs.scroller;t.setState({query:e}),t._lastNextRequestMarker=null,e.trim()?"loading"!==t.state.loadState&&NW(t,UW({query:e})).then((function(o){e!==t.state.query?qW(t,t.state.query):(n&&(n.scrollTop=0),t.setState({search:o}))})):(n&&(n.scrollTop=0),t.setState({loadState:"idle",error:null,search:null}))}var HW="evnf8cn",FW=[0],VW=[];function KW(){VW.push(FW),FW=[0]}function WW(){FW=VW.pop()}function GW(t,e){e.data=t.state.search||t.state.postcards,e.width=t.props.width/2-16}function YW(t,e,n){e.value=n.state.query,e.focused=!n.store.data.isTouchDevice,e.loading=n.state.search&&"loading"===n.state.loadState}function XW(t,e){e.stopPropagation(),e.preventDefault()}function QW(t,e){return n.get(e.data,"stickers")}function JW(t,e,n,o){e.sticker=o.value,e.autoplay=0===o.index,e.width=n.store.data.isMobile?o.width:void 0}function $W(t,e,n,o){Zt(t,"pick-sticker",{sticker:o.value,stickerOrigin:"stickers_panel_postcards"})}function ZW(t,e,o){var r=o._i=n.insert(e,n.createComponent("msg-sticker",Uu,t)),a=r.componentModel.input,i=o._j=n.propsSet(r,{size:"postcardPreview",playOnHover:!0,"data-l":"t,sticker","data-tsid":"sticker"});JW(0,i,t,o),o._k=n.addEvent(r,"click",$W,t,o);var s=n.insert(a,n.elem("div",HW),"");n.setClass(s,"price-okmsg"),n.setAttribute(s,"data-tsid","price");var u=n.appendChild(s,n.elem("span",HW));return n.setClass(u,"label-okmsg"),o._n=n.appendChild(u,n.text(n.get(o.value,"price"))),n.appendChild(u,n.text(" OK")),n.mountComponent(r,i),tG}function tG(t,e){var o=e._i,r=e._j;JW(0,r,t,e),FW[0]|=n.updateText(e._n,n.get(e.value,"price")),n.updateIncomingSlot(o,"",FW[0]),n.updateComponent(o,r)}function eG(t,e,o){var r=n.insert(e,n.elem("div",HW));n.setClass(r,"not-found-okmsg");var a=o._v=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"search"}));var i=o._x=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"not-found"}))}function nG(t,e){return t.state.search&&"idle"===t.state.loadState&&!n.get(e.data,"stickers")?eG:null}function oG(t,e,o){var r=o._1,a=n.insert(e,n.elem("header",HW)),i=o._9=n.appendChild(a,n.createComponent("msg-search-input",BW,t));n.setPendingRef(r,"search",i);var s=o._a=n.propsSet(i,{placeholder:"Поиск по открыткам",showIcon:!0,"data-l":"t,search"});YW(0,s,t),o._b=n.addEvent(i,"input",DW,t,o),o._c=n.addEvent(i,"click",XW,t,o),n.mountComponent(i,s);var u=o._d=n.insert(e,n.elem("div",HW)),c=n.createInjector(u);return n.setPendingRef(r,"scroller",u),n.setClass(u,"custom-scrollbar-okmsg"),o._e=n.addEvent(u,"scroll",zW,t,o),o._f=n.mountIterator(t,c,QW,ZW),o._r=n.mountBlock(t,c,nG),rG}function rG(t,e){var o=e._9,r=e._1,a=e._a;n.setPendingRef(r,"search",o),YW(0,a,t),n.updateComponent(o,a),n.setPendingRef(r,"scroller",e._d),n.updateIterator(e._f),n.updateBlock(e._r)}function aG(t,e,o){var r=o._11=n.insert(e,n.createComponent("msg-assets-panel-load-screen",jW,t));n.mountComponent(r)}function iG(t){return t.state.postcards||t.state.query?oG:aG}function sG(t,e){var o=t.componentView;KW();var r=n.createInjector(o),a=e._1=n.obj();return GW(t,e),e._5=n.mountBlock(t,r,iG),WW(),n.subscribeStore(t,["isTouchDevice","isMobile"]),n.finalizePendingRefs(t,a),uG}function uG(t,e){KW(),GW(t,e),n.updateBlock(e._5),WW(),n.finalizePendingRefs(t,e._1)}ZW.dispose=function(t){t._k=n.removeEvent("click",t._k),t._i=n.unmountComponent(t._i),t._j=t._n=null},eG.dispose=function(t){t._v=n.unmountComponent(t._v),t._x=n.unmountComponent(t._x)},oG.dispose=function(t){t._b=n.removeEvent("input",t._b),t._c=n.removeEvent("click",t._c),t._9=n.unmountComponent(t._9),t._e=n.removeEvent("scroll",t._e),t._f=n.unmountIterator(t._f),t._r=n.unmountBlock(t._r),t._a=t._d=null},aG.dispose=function(t){t._11=n.unmountComponent(t._11)},sG.dispose=function(t){KW(),t._5=n.clearBlock(t._5),WW()};var cG={__proto__:null,cssScope:HW,default:sG,state:function(){return{postcards:TW,loadState:null,error:null,query:""}},plugins:LW,events:OW,willMount:function(t){t._lastNextRequestMarker=0,TW||NW(t,UW(),!0).then((function(e){return t.setState({postcards:e})}))},didChange:function(t,e){var n=e.query;n&&n.current&&qW(t,n.current)},didMount:function(t){var e=t.refs.scroller;e&&(e.scrollTop=RW)},handleScroll:zW,handleSearch:DW,setSearch:function(t,e,n){qW(t,n.textContent)}};function pG(t){t.setState({loaded:!1,playing:!1})}var lG="efvtjyr";function mG(t,e,o){n.updateAttribute(t,e,"style","height: "+o.props.height+"px; width: "+o.props.width+"px; background-image: url("+n.get(o.props.gif,"previewUrl")+")")}function dG(t,e,o){!o._8&&function(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{spin:!0,indeterminate:!0}))}(t,e,o),n.animate(o._8,n.createAnimation("global:msg-pop-in 0.15s",lG))}function _G(t){return!t.props.autoplay&&!t.state.playing||t.state.loaded?null:dG}function fG(t,e,o){n.updateAttribute(t,e,"src",n.get(o.props.gif,"mp4Url")),n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height)}function gG(t,e,o){var r=o._e=n.insert(e,n.elem("video",lG)),a=o._f=n.obj();return r.loop=!0,r.autoplay=!0,r.muted=!0,fG(r,a,t),vG}function vG(t,e){fG(e._e,e._f,t)}function hG(t){return!t.props.preview&&t.state.loaded&&(t.props.autoplay||t.state.playing)?gG:null}function CG(t,e){e.stopPropagation(),e.preventDefault()}function kG(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-asset-badge",Us,t));o._m=n.addEvent(r,"click",CG,t,o),n.mountComponent(r,n.propsSet(r,{type:"GIF"}))}function bG(t){return t.props.icon?kG:null}function yG(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.insert(r,n.elem("div",lG)),i=n.createInjector(a),s=e._2=n.obj();return n.setClass(a,"preview-okmsg"),mG(a,s,t),e._3=n.mountBlock(t,i,_G),e._b=n.mountBlock(t,r,hG),e._h=n.mountBlock(t,r,bG),SG}function SG(t,e){mG(e._1,e._2,t),n.updateBlock(e._3),n.updateBlock(e._b),n.updateBlock(e._h)}dG.dispose=function(t,e){n.animate(t._8,n.createAnimation("global:msg-pop-out 0.15s",lG),(function(){return function(t){var e=t._8;t._8=n.unmountComponent(e),n.domRemove(e)}(t)}))},gG.dispose=function(t){t._f=t._e=null},kG.dispose=function(t){t._m=n.removeEvent("click",t._m),t._k=n.unmountComponent(t._k)},yG.dispose=function(t){t._3=n.unmountBlock(t._3),t._b=n.clearBlock(t._b),t._h=n.clearBlock(t._h)};var wG,EG,xG={__proto__:null,cssScope:lG,default:yG,willUpdate:function(t,e){var n=e.gif;n&&n.prev&&n.prev.photoId!==n.current.photoId&&pG(t)},willRender:function(t){var e=t.props,n=e.gif,o=e.autoplay,r=t.state,a=r.playing,i=r.loaded;n&&(a||o)&&!i&&function(t){return fetch(t,{mode:"cors"}).then((function(t){return t.blob()})).then((function(t){var e=new Blob([t],{type:t.type});return e.objectUrl=URL.createObjectURL(e),e}))}(n.mp4Url).then((function(e){t.setState({loaded:!0})}))},willUnmount:function(t){pG(t)},events:{mouseenter:function(t){t.props.preview||t.setState({playing:!0})},mouseleave:function(t){t.props.preview||t.setState({playing:!1})}}},IG=900,BG=150,MG=0,AG=0,TG=4;var jG={"toggle-sticker-sound":function(t,e){YG(t,e.detail)},"pointer:long-tap":function(t,e){e.stopPropagation();var n=function(t,e){var n,o=e.closest("[sticker-id]"),r=null==o?void 0:o.getAttribute("sticker-id");if(r)return null===(n=t.store.get().stickers)||void 0===n?void 0:n.get(Number(r))}(t,e.detail.originalEvent.target),o=t.state.setName;n&&Zt(t,"preview-sticker",{sticker:n,setName:o,callback:function(){return OG(n,o,t)}})},"pointer:tap":function(t,e){e.stopPropagation(),LG(t,e.detail.originalEvent)}},PG=[sr()];function RG(t,e){UG(t,!0);var n=e.detail.scroller,o=n.querySelectorAll("section");MG=n.scrollTop;var r=tV(n,o),a=r[0],i=r[1];AG=a,TG=i,t.setState({from:a,to:i})}function LG(t,e){var n=e.target.closest("msg-assets-gif, msg-assets-sticker");if(n)if(e.preventDefault(),e.stopPropagation(),"msg-assets-gif"===n.localName)zG(n.props.gif,t);else{var o=n.props;OG(o.sticker,o.setId,t)}}function OG(t,e,n,o){null==o||o.preventDefault();var r=function(t){switch(t){case"recent_stickers":return"stickers_panel_recent_set";case"popular_stickers":return"stickers_panel_top_set";default:return"stickers_panel_installed_set"}}(e);Zt(n,"pick-sticker",{sticker:{id:t.id},stickerOrigin:r}),"CONSTRUCTOR"===t.authorType&&OK.logger.success("messagesLayer","send-user-sticker","recent")}function zG(t,e,n){null==n||n.preventDefault(),Zt(e,"post-gif",t)}function DG(t,e,n,o){return void 0===o&&(o=null),{stickers:t,name:e,title:n,iconUrl:o,price:0,vip:!1}}function UG(t,e){Zt(t,"set-notify-typing",{active:e,type:"STICKER"})}function NG(t,e,n,o,r){FG(n),r&&(wG=setTimeout((function(){return GG(n,t,e,r)}),IG))}function qG(t){VG(),FG(t,!0)}function HG(t,e,n,o,r){GG(n,t,e,r),t.audio&&YG(n,!0)}function FG(t,e){e?EG=setTimeout((function(){return FG(t)}),BG):t.setState({active:null})}function VG(){wG&&(clearTimeout(wG),wG=null)}function KG(){EG&&(clearTimeout(EG),EG=null)}function WG(t,e,n){n.stopPropagation(),Zt(e,"sticker-remove",{type:"RECENT",id:t})}function GG(t,e,n,o){var r,a=t.state.active;(null==a?void 0:a.sticker)!==e&&(VG(),t.setState({active:{rect:o.getBoundingClientRect(),sticker:e,setName:n}}),r=e.gif?"gif":"sticker",OK.logger.success("messagesLayer","asset-preview",r))}function YG(t,e){t.setState({stickerSound:e})}var XG="ejmjvz0",QG={"sticker-tab-item":{body:PY,defaults:{item:null,active:!1,pos:0}},"sticker-content":{body:uX,defaults:{item:null,active:!1,pos:0}}},JG=[0],$G=[];function ZG(){$G.push(JG),JG=[0]}function tY(){JG=$G.pop()}function eY(t,e){e.chooseExpr="PHOTO"===n.get(t.state.active,"sticker","_type")?0:1,e.caseExpr=0===e.chooseExpr,e.gif=e.caseExpr?n.get(t.state.active,"sticker"):void 0,e.ratio=e.caseExpr?n.get(e.gif,"width")/n.get(e.gif,"height"):void 0,e.height=e.caseExpr?Math.min(n.get(e.gif,"height"),192):void 0,e.width=e.caseExpr?e.height*e.ratio:void 0,e.caseExpr_1=1===e.chooseExpr,e.stickerType=e.caseExpr_1?n.get(t.state.active,"sticker","stickerType")||n.get(t.state.active,"sticker","type"):void 0,e.openSetOnClick=e.caseExpr_1?jt(0,n.get(t.store.data.config,"server","sticker-type-open-set"),e.stickerType):void 0}function nY(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-assets-panel-load-screen",jW,t));n.mountComponent(r)}function oY(t,e,n){e.list=n.state.stickers,e.from=n.state.from,e.to=n.state.to}function rY(t){Zt(t,"open-sticker-vitrine-layer")}function aY(t,e,o){var r=o._i=n.insert(e,n.createComponent("msg-assets-panel-group-list",QF,t)),a=r.componentModel.input;n.setPendingRef(o._1,"panel",r);var i=o._j=n.propsSet(r);oY(0,i,t),i["partial:content"]=n.assign({host:t},QG["sticker-content"]),i["partial:tab-item"]=n.assign({host:t},QG["sticker-tab-item"]),o._k=n.addEvent(r,"content-scroll",RG,t,o);var s=n.insert(a,n.elem("div",XG),"controls");n.setAttribute(s,"slot","controls"),n.setClass(s,"add-okmsg collapsed-okmsg"),n.setAttribute(s,"data-l","t,openStickersVitrine"),o._m=n.addEvent(s,"click",rY,t,o);var u=o._n=n.appendChild(s,n.createComponent("msg-icon",xe,t));n.mountComponent(u,n.propsSet(u,{icon:"plus"}));var c=n.appendChild(s,n.elemWithText("span","ещё стикеры",XG));return n.setClass(c,"label-okmsg"),n.mountComponent(r,i),iY}function iY(t,e){var o=e._i,r=e._j;n.setPendingRef(e._1,"panel",o),oY(0,r,t),n.updateComponent(o,r,[t.state.to,t.state.from,t.store.data.isTouchDevice,t.props.onStickerExit])}function sY(t,e){n.insert(e,n.elemWithText("p","Ошибка при загрузке",XG))}function uY(t){return"loading"===t.props.loadState?nY:"idle"===t.props.loadState?aY:"error"===t.props.loadState?sY:null}function cY(t,e,n,o){e.gif=o.gif,e.width=o.width,e.height=o.height}function pY(t,e,n,o){Zt(t,"post-gif",o.gif)}function lY(t,e,o){var r=o._17=n.insert(e,n.createComponent("msg-assets-gif",xG,t),""),a=o._18=n.propsSet(r,{autoplay:!0});return cY(0,a,0,o),o._19=n.addEvent(r,"click",pY,t,o),n.mountComponent(r,a),JG[0]=1,mY}function mY(t,e){var o=e._17,r=e._18;cY(0,r,0,e),n.updateComponent(o,r)}function dY(t,e,o){e.sticker=n.get(o.state.active,"sticker"),e.soundIfAllowed=o.state.stickerSound}function _Y(t,e,o){OG(n.get(t.state.active,"sticker"),n.get(t.state.active,"setName"),t,e)}function fY(t){Zt(t,"open-sticker-pack-layer",{setId:n.get(t.state.active,"sticker","setId")})}function gY(t,e,o){var r=o._1i=n.insert(e,n.createComponent("msg-button",fe,t),""),a=r.componentModel.input;o._1k=n.addEvent(r,"click",fY,t,o);var i=o._1l=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"stickerset"})),n.mountComponent(r,n.propsSet(r,{class:"set-okmsg",shape:"circle"})),JG[0]=1}function vY(t,e){return n.get(t.state.active,"sticker","setId")&&e.openSetOnClick?gY:null}function hY(t,e,o){var r=o._1c=n.insert(e,n.createComponent("msg-sticker",Uu,t),""),a=o._1d=n.propsSet(r,{size:"postcardPreview",autoplay:!0,loop:!0,"data-l":"t,sticker"});return dY(0,a,t),o._1e=n.addEvent(r,"click",_Y,t,o),n.mountComponent(r,a),o._1f=n.mountBlock(t,e,vY),JG[0]=1,CY}function CY(t,e){var o=e._1c,r=e._1d;dY(0,r,t),n.updateComponent(o,r),n.updateBlock(e._1f)}function kY(t,e){return[lY,hY][e.chooseExpr]}function bY(t,e){var o=e._10;n.setPendingRef(e._1,"stickerPreview",o),n.updateBlock(e._14),n.updateIncomingSlot(o,"",JG[0])}function yY(t,e,o){return o._10?bY(0,o):function(t,e,o){var r=o._10=n.insert(e,n.createComponent("msg-assets-panel-tooltip",eD,t)),a=r.componentModel.input;n.setPendingRef(o._1,"stickerPreview",r),o._12=n.addEvent(r,"mouseenter",KG,t,o),o._13=n.addEvent(r,"mouseleave",FG,t,o),o._14=n.mountBlock(t,a,kY),n.mountComponent(r,n.propsSet(r,{class:"preview-okmsg","data-l":"t,stickerPreview"}))}(t,e,o),n.animate(o._10,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",XG)),SY}function SY(t,e){bY(0,e)}function wY(t){return t.state.active&&!t.store.data.isMobile?yY:null}function EY(t,e){var o=t.componentView;ZG();var r=n.createInjector(o),a=e._1=n.obj();return eY(t,e),e._c=n.mountBlock(t,r,uY),e._v=n.mountBlock(t,r,wY),tY(),n.subscribeStore(t,["config","isTouchDevice","isMobile"]),n.finalizePendingRefs(t,a),xY}function xY(t,e){ZG(),eY(t,e),n.updateBlock(e._c),n.updateBlock(e._v),tY(),n.finalizePendingRefs(t,e._1)}function IY(t,e,o){var r=o._1v=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"emoji-set-0",class:"tab-icon-okmsg","data-l":"t,tab.Recents"}))}function BY(t,e,o){var r=o._1z=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"popular",class:"tab-icon-okmsg","data-l":"t,tab.Popular"}))}function MY(t,e,o,r){n.updateAttribute(t,e,"alt",n.get(r.item,"title")),n.updateAttribute(t,e,"title",n.get(r.item,"title")),n.updateAttribute(t,e,"src",n.get(r.item,"iconUrl")),n.updateAttribute(t,e,"data-l","t,tab."+n.get(r.item,"name")),n.updateAttribute(t,e,"data-tsid","tab-"+n.get(r.item,"name"))}function AY(t,e,o){var r=o._23=n.insert(e,n.elem("img",XG)),a=o._24=n.obj();return n.setClass(r,"tab-icon-okmsg"),MY(r,a,0,o),TY}function TY(t,e){MY(e._23,e._24,0,e)}function jY(t,e){return"recent_stickers"===n.get(e.item,"id")?IY:"popular_stickers"===n.get(e.item,"id")?BY:AY}function PY(t,e,o){return o._1s=n.mountBlock(t,e,jY),RY}function RY(t,e){n.updateBlock(e._1s)}function LY(t,e){e.setName=n.get(e.item,"id"),e.recent="recent_stickers"===e.setName}function OY(t,e,o,r){n.updateAttribute(t,e,"data-id",r.setName),n.updateAttribute(t,e,"data-tsid",r.setName)}function zY(t,e){return n.get(e.item,"rows")}function DY(t,e){return n.get(e.value,"cells")}function UY(t,e){e.itemId=n.get(e.value,"photoId")||n.get(e.value,"id")}function NY(t,e,o,r){e.gif=r.value,e["data-tsid-id"]=n.get(r.value,"id")}function qY(t,e,n,o){NG(o.value,o.setName,t,0,n)}function HY(t,e){var o=e._2u;t.store.data.isTouchDevice||(n.setPendingEvent(o,"mouseenter",qY,e),n.setPendingEvent(o,"mouseleave",qG,e))}function FY(t,e,o){var r=o._2t=n.insert(e,n.createComponent("msg-assets-gif",xG,t)),a=o._2u=n.pendingEvents(t,r),i=o._2v=n.propsSet(r,{width:100,height:100,preview:!0,icon:!0,"data-tsid":"recent_element","data-type":"gif"});return NY(0,i,0,o),HY(t,o),n.finalizePendingEvents(a),n.mountComponent(r,i),VY}function VY(t,e){var o=e._2t,r=e._2v;NY(0,r,0,e),HY(t,e),n.finalizePendingEvents(e._2u),n.updateComponent(o,r)}function KY(t,e,o,r){e.setId=r.setName,e.sticker=r.value,e.stickerId=n.get(r.value,"id")}function WY(t,e,n,o){HG(o.value,o.setName,t,0,n)}function GY(t,e,n,o){NG(o.value,o.setName,t,0,n)}function YY(t,e){var o=e._32;t.store.data.isTouchDevice||(n.setPendingEvent(o,"mouseenter",GY,e),n.setPendingEvent(o,"mouseleave",qG,e))}function XY(t,e,o){var r=o._31=n.insert(e,n.createComponent("msg-assets-sticker",RD,t)),a=o._32=n.pendingEvents(t,r),i=o._33=n.propsSet(r,{"data-l":"t,sticker","data-tsid":"sticker"});return KY(0,i,0,o),o._34=n.addEvent(r,"badge-click",WY,t,o),YY(t,o),n.finalizePendingEvents(a),n.mountComponent(r,i),QY}function QY(t,e){var o=e._31,r=e._33;KY(0,r,0,e),YY(t,e),n.finalizePendingEvents(e._32),n.updateComponent(o,r)}function JY(t,e){return n.get(e.value,"gif")?FY:XY}function $Y(t,e,n,o){WG(o.itemId,t,e)}function ZY(t,e,o){var r=o._3c=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._3e=n.addEvent(r,"click",$Y,t,o);var i=o._3f=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"close",size:"small"})),n.mountComponent(r,n.propsSet(r,{class:"remove-okmsg",shape:"circle",size:"small"}))}function tX(t,e){return e.recent&&!t.store.data.isTouchDevice?ZY:null}function eX(t,e,o){UY(0,o);var r=n.insert(e,n.elem("div",XG)),a=n.createInjector(r);return n.setClass(r,"item-okmsg"),o._2q=n.mountBlock(t,a,JY),o._39=n.mountBlock(t,a,tX),nX}function nX(t,e){UY(0,e),n.updateBlock(e._2q),n.updateBlock(e._39)}function oX(t,e,o){return o._2k=n.mountIterator(t,e,DY,eX),rX}function rX(t,e){n.updateIterator(e._2k)}function aX(t,e){return n.get(e.value,"pos")<=t.state.to&&n.get(e.value,"pos")>=t.state.from?oX:null}function iX(t,e,o){var r=n.insert(e,n.elem("section",XG)),a=n.createInjector(r);return o._2h=n.mountBlock(t,a,aX),sX}function sX(t,e){n.updateBlock(e._2h)}function uX(t,e,o){LY(0,o);var r=o._2a=n.insert(e,n.elem("h3",XG)),a=o._2b=n.obj();return n.setClass(r,"h3-okmsg"),OY(r,a,0,o),o._2c=n.appendChild(r,n.text(n.get(o.item,"title"))),o._2d=n.mountIterator(t,e,zY,iX),cX}function cX(t,e){LY(0,e),OY(e._2a,e._2b,0,e),n.updateText(e._2c,n.get(e.item,"title")),n.updateIterator(e._2d)}nY.dispose=function(t){t._f=n.unmountComponent(t._f)},aY.dispose=function(t){t._k=n.removeEvent("content-scroll",t._k),t._m=n.removeEvent("click",t._m),t._n=n.unmountComponent(t._n),t._i=n.unmountComponent(t._i),t._j=null},lY.dispose=function(t){t._19=n.removeEvent("click",t._19),t._17=n.unmountComponent(t._17),t._18=null,JG[0]=1},gY.dispose=function(t){t._1k=n.removeEvent("click",t._1k),t._1l=n.unmountComponent(t._1l),t._1i=n.unmountComponent(t._1i),JG[0]=1},hY.dispose=function(t){t._1e=n.removeEvent("click",t._1e),t._1c=n.unmountComponent(t._1c),t._1f=n.unmountBlock(t._1f),t._1d=null,JG[0]=1},yY.dispose=function(t,e){n.animate(t._10,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",XG),(function(){return function(t){var e=t._10;t._12=n.removeEvent("mouseenter",t._12),t._13=n.removeEvent("mouseleave",t._13),t._14=n.unmountBlock(t._14),t._10=n.unmountComponent(e),n.domRemove(e)}(t)}))},EY.dispose=function(t){ZG(),t._c=n.clearBlock(t._c),t._v=n.clearBlock(t._v),tY()},IY.dispose=function(t){t._1v=n.unmountComponent(t._1v)},BY.dispose=function(t){t._1z=n.unmountComponent(t._1z)},AY.dispose=function(t){t._24=t._23=null},PY.dispose=function(t){t._1s=n.unmountBlock(t._1s)},FY.dispose=function(t){t._2u=n.detachPendingEvents(t._2u),t._2t=n.unmountComponent(t._2t),t._2v=null},XY.dispose=function(t){t._32=n.detachPendingEvents(t._32),t._34=n.removeEvent("badge-click",t._34),t._31=n.unmountComponent(t._31),t._33=null},ZY.dispose=function(t){t._3e=n.removeEvent("click",t._3e),t._3f=n.unmountComponent(t._3f),t._3c=n.unmountComponent(t._3c)},eX.dispose=function(t){t._2q=n.unmountBlock(t._2q),t._39=n.unmountBlock(t._39)},oX.dispose=function(t){t._2k=n.unmountIterator(t._2k)},iX.dispose=function(t){t._2h=n.unmountBlock(t._2h)},uX.dispose=function(t){t._2d=n.unmountIterator(t._2d),t._2b=t._2c=t._2a=null};var pX,lX={__proto__:null,cssScope:XG,partials:QG,default:EY,state:function(){return{loadState:o.LoadState.loading,stickers:null,from:AG,to:TG,error:null,active:null}},events:jG,plugins:PG,willMount:function(t){UG(t,!0),Zt(t,"stickers-fetch")},didMount:function(t){var e=t.refs.panel;e&&e.setScrollPos(MG)},willUnmount:function(t){UG(t,!1),VG(),KG()},didRender:function(t){var e=t.refs.stickerPreview;if(e){var n=t.state.active;n&&e.align({x:n.rect.left+n.rect.width/2,y:n.rect.top})}},didChange:function(t,e){var n,o,r=e.recents,a=e.top,i=e.sets,s=e.width,u=t.store.get().isSmallScreen;if(r||a||i||s){var c=[];(null===(n=t.props.recents)||void 0===n?void 0:n.length)&&c.push(DG(t.props.recents,"recent_stickers",V("recent")));var p=t.props.top;p&&(null===(o=p.result)||void 0===o?void 0:o.length)&&c.push(DG(p.result,"popular_stickers",p.title)),t.props.sets&&t.props.sets.forEach((function(t){var e;(null===(e=t.result)||void 0===e?void 0:e.length)&&c.push(DG(t.result,t.name,t.name,t.iconUrl))}));var l=u?Math.min(Math.floor(t.props.width/110),4):4,m=function(t,e){var n={itemsPerRow:e},o=0;return t.map((function(t){var e=ZF(t.name,t.stickers,n);return e.forEach((function(t){return t.pos=o++})),{id:t.name,title:t.title?t.title:t.name,iconUrl:t.iconUrl,name:t.name,price:t.price,vip:t.vip,rows:e}}))}(c,l);t.setState({stickers:m})}},handleScroll:RG,onStickerClick:LG,onStickerPick:OG,onGifPick:zG,onStickerEnter:NG,onStickerExit:qG,onBadgeClick:HG,hideStickerSuggestions:FG,resetPreviewSchedule:VG,cancelHideStickerSuggestions:KG,onRemoveSticker:WG},mX="dR3Ee6Fpxjo8QbSIPqu8gsGR922dmhNwZ26ONQfuplSI7SuANAVxwKiEsYOsO6hj",dX="https://api.kikliko.com",_X="api/v1",fX="gifs",gX="kikliko",vX="kikliko-user-id";function hX(){return function(){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(e){switch(e.label){case 0:return[4,fetch("".concat(dX,"/").concat(_X,"/").concat(mX,"/health-check/"))];case 1:if((t=e.sent()).ok)return[2,t.json()];throw new Error("Health check failed")}}))}))}().then((function(t){return t.gifs.is_alive?(MX("health-check-success"),!0):(MX("error-service-disabled"),!1)})).catch((function(t){return MX("error-service-unavailable",t),!1}))}function CX(t,e){var o;return o="trending"===t.type?function(t,e,o){return n.__awaiter(this,void 0,void 0,(function(){var r;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,fetch(SX(t,e,kX(o)))];case 1:return[4,n.sent().json()];case 2:return(r=n.sent()).data.data=r.data.data.map((function(t){return AX(t,o)})),[2,r]}}))}))}(t.page||1,TX(),e):function(t,e,o,r){return n.__awaiter(this,void 0,void 0,(function(){var a,i;return n.__generator(this,(function(n){switch(n.label){case 0:return a=(null==r?void 0:r.server["kikliko-gif-rating"])||"g",[4,fetch(yX(t,e,o,a,kX(r)))];case 1:return[4,n.sent().json()];case 2:return(i=n.sent()).data.data=i.data.data.map((function(t){return AX(t,r)})),[2,i]}}))}))}(t.page||1,TX(),t.query||"",e),o.then((function(t){return t.data}))}function kX(t){return(null==t?void 0:t.server["kikliko-gif-locale-enabled"])&&document.documentElement.lang||""}function bX(t){var e=Object.keys(t).reduce((function(e,n){var o=t[n];return null!=o&&""!==o&&e.push("".concat(n,"=").concat(o)),e}),[]).join("&");return e?"?"+e:""}function yX(t,e,n,o,r){return"".concat(dX,"/").concat(_X,"/").concat(mX,"/").concat(fX,"/search/").concat(bX({page:t,q:n,customer_id:e,rating:o,locale:r}))}function SX(t,e,n){return"".concat(dX,"/").concat(_X,"/").concat(mX,"/").concat(fX,"/trending/").concat(bX({page:t,customer_id:e,locale:n}))}function wX(t){MX("gif-preview"),IX(function(t){return"".concat(dX,"/").concat(_X,"/").concat(mX,"/").concat(fX,"/view/").concat(t)}(t),TX())}function EX(t){MX("gif-send"),IX(function(t){return"".concat(dX,"/").concat(_X,"/").concat(mX,"/").concat(fX,"/share/").concat(t)}(t),TX())}function xX(t){fetch(function(t){return"".concat(dX,"/").concat(_X,"/").concat(mX,"/").concat(fX,"/disable/").concat(t)}(t),{method:"POST",headers:{"Content-Type":"application/json"}})}function IX(t,e){fetch(t,{method:"POST",body:JSON.stringify({customer_id:e}),headers:{"Content-Type":"application/json"}}).catch((function(t){MX("error-send-stat",t)}))}function BX(t){return fetch(t).then((function(t){return t.blob()})).then((function(t){var e=new Blob([t],{type:t.type});return e.objectUrl=URL.createObjectURL(e),e}))}function MX(t,e){OK.logger.success("messagesLayer",gX,t),e&&OK.logger.clob("error",e.toString(),"messagesLayer")}function AX(t,e){var o=null==e?void 0:e.server["kikliko-gif-quality-preview"],r=null==e?void 0:e.server["kikliko-gif-quality-full"],a=!!(null==e?void 0:e.server["kikliko-gif-use-webp"])?"webp":"gif";return n.__assign(n.__assign({},t),{gif:!0,previewMp4:t.file[o][a].url,fullMp4:t.file[r][a].url,photoId:t.slug,width:t.file[r][a].width,height:t.file[r][a].height,_type:"PHOTO",file:null})}function TX(){var t,e=localStorage.getItem(vX);return e||(t=new Uint8Array(16),window.crypto.getRandomValues(t),e=Array.from(t).map((function(t){return t.toString(16).padStart(2,"0")})).join(""),fr(vX,e)),e}var jX=[sr()];function PX(t,e){var n=e.gif;n&&n.prev&&n.prev.slug!==n.current.slug&&zX(t)}function RX(t){var e=t.props,n=e.gif,o=e.autoplay,r=t.state,i=r.playing,s=r.loaded;n&&(i||o)&&!s&&BX(n.fullMp4).then((function(e){wX(n.slug),function(t,e){pX||(pX=new a),pX.set(t,e)}(n.fullMp4,e),t.setState({loaded:!0})})).catch((function(t){MX("error-load-preview",t)}))}function LX(t){zX(t)}var OX={mouseenter:function(t){t.props.preview||t.setState({playing:!0})},mouseleave:function(t){t.props.preview||t.setState({playing:!1})},"pointer:tap":function(t,e){e.detail.originalEvent.target.closest("msg-icon")&&(e.preventDefault(),e.stopPropagation(),DX(t.props.gif,t))}};function zX(t){t.setState({loaded:!1,playing:!1})}function DX(t,e){var o=n.endorphin("msg-assets-gif-kikliko",s,{props:{gif:t,width:250,height:250},store:e.store});Zt(e,"show-confirm",{header:"Пожаловаться на гифку?",body:o,buttons:[{label:V("send"),action:function(){Zt(e,"report-gif",{gif:t}),xX(t.slug)}},{label:V("cancel")}]})}var UX="e-glactz";function NX(t,e,o){n.updateAttribute(t,e,"style","height: "+o.props.height+"px; width: "+o.props.width+"px; background-image: url("+n.get(o.props.gif,"previewMp4")+")")}function qX(t,e,o){!o._8&&function(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{spin:!0,indeterminate:!0}))}(t,e,o),n.animate(o._8,n.createAnimation("global:msg-pop-in 0.15s",UX))}function HX(t){return!t.props.autoplay&&!t.state.playing||t.state.loaded?null:qX}function FX(t,e,o){n.updateAttribute(t,e,"src",o.props.preview?n.get(o.props.gif,"previewMp4"):n.get(o.props.gif,"fullMp4")),n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height)}function VX(t,e,o){var r=o._e=n.insert(e,n.elem("video",UX)),a=o._f=n.obj();return r.loop=!0,r.autoplay=!0,r.muted=!0,FX(r,a,t),KX}function KX(t,e){FX(e._e,e._f,t)}function WX(t){return!t.props.preview&&t.state.loaded&&(t.props.autoplay||t.state.playing)?VX:null}function GX(t,e){e.stopPropagation(),e.preventDefault()}function YX(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-asset-badge",Us,t));o._m=n.addEvent(r,"click",GX,t,o),n.mountComponent(r,n.propsSet(r,{type:"GIF"}))}function XX(t){return t.props.icon?YX:null}function QX(t,e,o){var r=o._q=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"info",size:"medium"}))}function JX(t){return t.props.allowReport?QX:null}function $X(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.insert(r,n.elem("div",UX)),i=n.createInjector(a),s=e._2=n.obj();return n.setClass(a,"preview-okmsg"),NX(a,s,t),e._3=n.mountBlock(t,i,HX),e._b=n.mountBlock(t,r,WX),e._h=n.mountBlock(t,r,XX),e._n=n.mountBlock(t,r,JX),ZX}function ZX(t,e){NX(e._1,e._2,t),n.updateBlock(e._3),n.updateBlock(e._b),n.updateBlock(e._h),n.updateBlock(e._n)}qX.dispose=function(t,e){n.animate(t._8,n.createAnimation("global:msg-pop-out 0.15s",UX),(function(){return function(t){var e=t._8;t._8=n.unmountComponent(e),n.domRemove(e)}(t)}))},VX.dispose=function(t){t._f=t._e=null},YX.dispose=function(t){t._m=n.removeEvent("click",t._m),t._k=n.unmountComponent(t._k)},QX.dispose=function(t){t._q=n.unmountComponent(t._q)},$X.dispose=function(t){t._3=n.unmountBlock(t._3),t._b=n.clearBlock(t._b),t._h=n.clearBlock(t._h),t._n=n.clearBlock(t._n)};var tQ=4;function eQ(t,e){var n=[],o=null;return e.boxes.forEach((function(r,a){var i=e.boxes[a-1];i&&i.top!==r.top&&(n.push(o),o=null),r.media=t[a],o?o.items.push(r):o={id:n.length,spacing:tQ,height:Math.round(r.height),items:[r]}})),o&&n.push(o),n}var nQ=90,oQ={containerWidth:432,containerPadding:8,targetRowHeightTolerance:.3,boxSpacing:{horizontal:4,vertical:0}},rQ=200,aQ=900,iQ=150,sQ=null,uQ={"pointer:tap":function(t,e){var n=e.detail.originalEvent.target.closest("msg-assets-gif-kikliko");n&&(e.preventDefault(),e.stopPropagation(),mQ(n.props.gif,t))},"report-gif":function(t,e){var o=t.state.searchResult,r=e.detail.gif;if(o){var a=o.data.filter((function(t){return t.slug!==r.slug}));t.setState({searchResult:n.__assign(n.__assign({},o),{data:a})})}sQ&&(sQ=n.__assign(n.__assign({},sQ),{data:sQ.data.filter((function(t){return t.slug!==r.slug}))})),gQ(t)}},cQ=[sr()];function pQ(t,e,n){n.stopPropagation();var o=n.currentTarget.getBoundingClientRect();_Q(e),e.state._showStickersTimerId=window.setTimeout((function(){e.setState({tooltip:{rect:o,gif:t}})}),aQ)}function lQ(t,e){e.stopPropagation(),function(t){var e=t.state;e._showStickersTimerId&&(clearTimeout(e._showStickersTimerId),e._showStickersTimerId=null)}(t),_Q(t,!0)}function mQ(t,e){EX(t.slug),Zt(e,"post-gif-kikliko",t)}function dQ(t){var e,n=t.refs,o=n.search,r=n.scroller,a=null===(e=o.value)||void 0===e?void 0:e.trim();t.state.query!==a&&(t.setState({query:a}),a?t.debounceSearch(a):(t.setState({searchResult:null}),sQ||vQ(t,{type:"trending"}).then((function(e){return CQ(t,e)}))),r.scrollTo(0,0),gQ(t),t.state.list.handleScroll(r),_Q(t))}function _Q(t,e){bQ(t),e?t.state._hideStickersTimerId=window.setTimeout((function(){return _Q(t)}),iQ):t.setState({tooltip:null})}function fQ(t){var e=t.refs.scroller,n=t.state.loading;if(t.state.list.handleScroll(e),function(t){var e=t.state.scrolling;e||(_Q(t),t.setState({scrolling:!0}));clearTimeout(t.state._scrollTimer),t.state._scrollTimer=window.setTimeout((function(){t.setState({scrolling:!1})}),100)}(t),Zt(t,"toggle-notify-stickers",!0),!n&&e.scrollHeight-e.scrollTop-e.clientHeight<rQ){var o=t.state.searchResult?"search":"trending",r="search"===o?t.state.searchResult:sQ;r&&r.has_next&&vQ(t,{type:o,page:r.current_page+1,query:t.state.query}).then((function(e){if("trending"===o)CQ(t,kQ(sQ,e));else{var n=t.state.searchResult;n&&t.setState({searchResult:kQ(n,e)})}gQ(t)}))}}function gQ(t){var e=t.state.searchResult||sQ;if(e){var o=t.store.get().config,r=(null==o?void 0:o.server["kikliko-gif-row-height"])||nQ,a=n.layout(e.data,n.__assign(n.__assign({},oQ),{targetRowHeight:r,containerWidth:t.offsetWidth-2})),i=eQ(e.data,a),s=t.state.list;i.forEach((function(t){return s.itemHeight(t,t.height+t.spacing)})),s.update(i)}}function vQ(t,e){var n=t.store.get().config;return t.setState({loading:!0,error:null}),CX(e,n).then((function(e){return t.setState({loading:!1}),e})).catch((function(e){throw t.setState({error:e?e.message:"unknown-error"}),MX("error-load",e),e}))}function hQ(t,e,n){MX("search"),t.state.loading||(t.setState({loading:!0}),vQ(t,{type:"search",query:e,page:n||0}).then((function(n){t.setState({loading:!1}),t.state.query&&(t.setState({searchResult:n}),e!==t.state.query&&hQ(t,t.state.query)),t.state.list.reset(),gQ(t)})))}function CQ(t,e){sQ=e,gQ(t)}function kQ(t,e){return n.__assign(n.__assign({},e),{data:t.data.concat(e.data)})}function bQ(t){var e=t.state;e._hideStickersTimerId&&(clearTimeout(e._hideStickersTimerId),e._hideStickersTimerId=null)}var yQ="e7l4vmq";function SQ(t,e){e.gif=n.get(t.state.tooltip,"gif"),e.ratio=n.get(e.gif,"width")/n.get(e.gif,"height"),e.height=Math.min(n.get(e.gif,"height"),192),e.width=e.height*e.ratio,e.value=void 0}function wQ(t,e,n,o){e.gif=o.gif,e.width=o.width,e.height=o.height}function EQ(t,e,n,o){mQ(o.gif,t)}function xQ(t,e){var o=e._e,r=e._f;n.setPendingRef(e._1,"stickerPreview",e._d),wQ(0,r,0,e),n.updateComponent(o,r)}function IQ(t,e,o){return o._d?xQ(0,o):function(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-assets-panel-tooltip",eD,t)),a=r.componentModel.input;n.setPendingRef(o._1,"stickerPreview",r);var i=o._e=n.insert(a,n.createComponent("msg-assets-gif-kikliko",s,t),""),u=o._f=n.propsSet(i,{autoplay:!0});wQ(0,u,0,o),o._g=n.addEvent(i,"click",EQ,t,o),n.mountComponent(i,u),n.mountComponent(r)}(t,e,o),n.animate(o._d,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",yQ)),BQ}function BQ(t,e){xQ(0,e)}function MQ(t){return t.state.tooltip&&!t.store.data.isMobile?IQ:null}function AQ(t,e,n){e.value=n.state.query,e.placeholder=n.store.data.l10n("kikliko-gif-search-placeholder")}function TQ(t,e){e.stopPropagation(),e.preventDefault()}function jQ(t,e,o){n.updateClass(t,e,"custom-scrollbar-okmsg"+(o.state.scrolling?" __scroll-okmsg":""))}function PQ(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function RQ(t){return n.get(t.state.scrollList,"items")}function LQ(t,e){return n.get(e.value,"value","id")}function OQ(t,e,o,r){n.updateAttribute(t,e,"style","height: "+n.get(r.value,"height")+"px;")}function zQ(t,e){return n.get(e.value,"value","items")}function DQ(t,e){return n.get(e.value,"media","slug")}function UQ(t,e,o,r){e.gif=n.get(r.value,"media"),e.width=n.get(r.value,"width"),e.height=n.get(r.value,"height"),e.allowReport=n.get(o.store.data.config,"server","kikliko-gif-report-enabled"),e.autoplay=n.get(o.store.data.config,"server","kikliko-gif-list-autoplay")}function NQ(t,e,o,r){pQ(n.get(r.value,"media"),t,e)}function qQ(t,e){var o=e._15;t.store.data.isTouchDevice||(n.setPendingEvent(o,"mouseenter",NQ,e),n.setPendingEvent(o,"mouseleave",lQ,e))}function HQ(t,e,o){var r=o._14=n.insert(e,n.createComponent("msg-assets-gif-kikliko",s,t)),a=o._15=n.pendingEvents(t,r),i=o._16=n.propsSet(r,{preview:!0,"data-tsid":"gif"});return UQ(0,i,t,o),qQ(t,o),n.finalizePendingEvents(a),n.mountComponent(r,i),FQ}function FQ(t,e){var o=e._14,r=e._16;UQ(0,r,t,e),qQ(t,e),n.finalizePendingEvents(e._15),n.updateComponent(o,r)}function VQ(t,e,o){var r=o._z=n.insert(e,n.elem("div",yQ)),a=n.createInjector(r),i=o._10=n.obj();return n.setClass(r,"row-okmsg"),OQ(r,i,0,o),o._11=n.mountKeyIterator(t,a,zQ,DQ,HQ),KQ}function KQ(t,e){OQ(e._z,e._10,0,e),n.updateKeyIterator(e._11)}function WQ(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{spin:!0,indeterminate:!0,class:"bottom-okmsg"}))}function GQ(t){return t.state.loading?WQ:null}function YQ(t,e,o){return o._w=n.mountKeyIterator(t,e,RQ,LQ,VQ),o._1b=n.mountBlock(t,e,GQ),XQ}function XQ(t,e){n.updateKeyIterator(e._w),n.updateBlock(e._1b)}function QQ(t,e,o){var r=n.insert(e,n.elem("div",yQ));n.setClass(r,"not-found-okmsg");var a=o._1j=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"search"}));var i=o._1l=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"not-found"}))}function JQ(t,e,o){var r=o._1p=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{spin:!0,indeterminate:!0}))}function $Q(t){return Tt(0,n.get(t.state.scrollList,"items"))>0?YQ:t.state.query&&!t.state.loading&&0===Tt(0,n.get(t.state.scrollList,"items"))?QQ:t.state.loading?JQ:null}function ZQ(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px;")}function tJ(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();SQ(t,e),e._8=n.mountBlock(t,r,MQ);var i=n.insert(r,n.elem("header",yQ)),s=e._k=n.appendChild(i,n.createComponent("msg-search-input",BW,t));n.setRef(t,"search",s);var u=e._l=n.propsSet(s,{showIcon:!0,focused:!0,"data-l":"t,search"});AQ(0,u,t),e._m=n.addEvent(s,"input",dQ,t,e),e._n=n.addEvent(s,"click",TQ,t,e),n.mountComponent(s,u);var c=e._o=n.insert(r,n.elem("div",yQ)),p=n.createInjector(c);return n.setRef(t,"scroller",c),jQ(c,e._p=n.obj(),t),e._q=n.addEvent(c,"scroll",fQ,t,e),PQ(e._r=n.insert(p,n.elem("div",yQ)),e._s=n.obj(),t),e._t=n.mountBlock(t,p,$Q),ZQ(e._1s=n.insert(p,n.elem("div",yQ)),e._1t=n.obj(),t),n.subscribeStore(t,["isMobile","l10n","config","isTouchDevice"]),n.finalizePendingRefs(t,a),eJ}function eJ(t,e){var o=e._k,r=e._l;SQ(t,e),n.updateBlock(e._8),AQ(0,r,t),n.updateComponent(o,r),jQ(e._o,e._p,t),PQ(e._r,e._s,t),n.updateBlock(e._t),ZQ(e._1s,e._1t,t),n.finalizePendingRefs(t,e._1)}IQ.dispose=function(t,e){n.animate(t._d,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",yQ),(function(){return function(t){var e=t._d;t._g=n.removeEvent("click",t._g),t._e=n.unmountComponent(t._e),t._d=n.unmountComponent(e),n.domRemove(e),t._f=null}(t)}))},HQ.dispose=function(t){t._15=n.detachPendingEvents(t._15),t._14=n.unmountComponent(t._14),t._16=null},VQ.dispose=function(t){t._11=n.unmountKeyIterator(t._11),t._10=t._z=null},WQ.dispose=function(t){t._1e=n.unmountComponent(t._1e)},YQ.dispose=function(t){t._w=n.unmountKeyIterator(t._w),t._1b=n.unmountBlock(t._1b)},QQ.dispose=function(t){t._1j=n.unmountComponent(t._1j),t._1l=n.unmountComponent(t._1l)},JQ.dispose=function(t){t._1p=n.unmountComponent(t._1p)},tJ.dispose=function(t){t._8=n.clearBlock(t._8),t._m=n.removeEvent("input",t._m),t._n=n.removeEvent("click",t._n),t._k=n.unmountComponent(t._k),t._q=n.removeEvent("scroll",t._q),t._t=n.unmountBlock(t._t)};var nJ={__proto__:null,cssScope:yQ,default:tJ,events:uQ,plugins:cQ,init:function(t){t.debounceSearch=o.debounce((function(e,n){return hQ(t,e,n)}),200)},didChange:function(t,e){var n=e.query;n&&n.current&&(t.setState({query:n.current}),hQ(t,n.current))},willMount:function(t){var e=t.store.get().config,n=(null==e?void 0:e.server["kikliko-gif-row-height"])||nQ,o=(null==e?void 0:e.server["kikliko-gif-max-items"])||18;t.setState({list:new YL({maxDisplayItems:o,itemHeight:n,initialItems:6,offscreenArea:rQ,reconcile:"replace",onUpdate:function(e){return t.setState({scrollList:e})}})}),sQ||vQ(t,{type:"trending"}).then((function(e){return CQ(t,e)}))},didRender:function(t){var e=t.refs.stickerPreview,n=t.state.tooltip;if(e&&n){var o=t.getBoundingClientRect();e.align({x:n.rect.left+n.rect.width/2,y:n.rect.top},{left:o.left+5,right:o.right-10})}},willUnmount:function(){pX=null,sQ=null},didMount:function(){MX("open-gifs-panel")},onGifEnter:pQ,onGifExit:lQ,handleGifSend:mQ,handleSearch:dQ,handleScroll:fQ,cancelHideStickerSuggestions:bQ};var oJ="erj6vdz";function rJ(t,e){e.count=t.props.max-t.props.current}function aJ(t,e,o,r){n.updateClass(t,e,r.count<0?"error-okmsg":"")}function iJ(t,e){aJ(e._8,e._9,0,e),n.updateText(e._a,e.count)}function sJ(t,e,o){return o._8?iJ(0,o):function(t,e,o){var r=o._8=n.insert(e,n.elem("div",oJ));aJ(r,o._9=n.obj(),0,o),o._a=n.appendChild(r,n.text(o.count))}(0,e,o),n.animate(o._8,$U(o._8,{duration:100,easing:nN})),uJ}function uJ(t,e){iJ(0,e)}function cJ(t){return t.props.current>t.props.max-t.props.threshold?sJ:null}function pJ(t,e){var o=t.componentView,r=n.createInjector(o);return rJ(t,e),e._3=n.mountBlock(t,r,cJ),lJ}function lJ(t,e){rJ(t,e),n.updateBlock(e._3)}sJ.dispose=function(t,e){var o=t._8;n.animate(o,ZU(0,{duration:100,easing:nN}),(function(){return function(t){t._8=n.domRemove(t._8),t._9=t._a=null}(t)}))},pJ.dispose=function(t){t._3=n.clearBlock(t._3)};var mJ={__proto__:null,cssScope:oJ,default:pJ,slideDown:$U,slideUp:ZU,easeOutCubic:nN,props:function(){return{current:0,max:0,threshold:50}}},dJ="data-lottie-id",_J=new i;function fJ(){return n.ie&&"undefined"!=typeof ResizeObserver}function gJ(t,e,n){var o=vJ(t),r=e.get(o);if(null==r?void 0:r.length){var a=r.shift();return r.length||e.delete(o),a}var i=t.getAttribute("data-lottie-url"),s=document.createElement("canvas");s.setAttribute(dJ,o);var u=Rn({id:o,canvas:s,movie:i,width:t.width,height:t.height,loop:!0});return n&&u.on("rendered",(function(){return n(o)})),Dn(),u}function vJ(t){return t.getAttribute(dJ)}function hJ(t){t.setAttribute("src",dt)}var CJ="undefined"!=typeof WeakMap?new WeakMap:new a,kJ="data-silent",bJ=/TV Bro/.test(navigator.userAgent),yJ=fJ(),SJ=new a([[n.TokenFormat.Bold,"Cmd+B"],[n.TokenFormat.Italic,"Cmd+I"],[n.TokenFormat.Underline,"Cmd+U"],[n.TokenFormat.Strike,"Cmd+Shift+S"],[n.TokenFormat.Monospace,"Cmd+Shift+C"],[n.TokenFormat.Link,"Cmd+Shift+L"],[n.TokenFormat.Heading,"Cmd+J"],[n.TokenFormat.Marked,"Cmd+Shift+M"]]),wJ={get name(){return this.props.name},get value(){var t,e=TJ(this);return e?e.value:(null===(t=this.editor)||void 0===t?void 0:t.getText())||""},set value(t){this.setValue(t)},get focused(){return this.state._focused},setValue:function(t,e){null==t&&(t="");var n=TJ(this);n?jJ(n,{value:t,selection:e,noFocus:!KJ(n)}):this.editor&&this.value!==t&&this.editor.setValue(t,e)},replaceValue:function(t,e){null==t&&(t="");var n=TJ(this);n?(jJ(n,{value:t,selection:e,silent:!0,noFocus:!KJ(n)}),AJ(this)):this.editor&&this.value!==t&&(this.editor.replaceValue(t,e),AJ(this))},insertText:function(t,e){var n=this.getSelection(),o=TJ(this);o?jJ(o,{value:t,replace:n,noFocus:e}):this.editor&&this.editor.replaceText(n[0],n[1],t)},insertEmoji:function(t,e,o){var r=this.getSelection(),a=TJ(this);if(a)jJ(a,{value:t,replace:r,noFocus:o});else if(this.editor){var i=function(t,e,o){var r=n.parse$1(t,e),a=[],i=0;return r.forEach((function(t){var e,r=null===(e=t.emoji)||void 0===e?void 0:e.map((function(t){return n.__assign(n.__assign({},t),{emojiData:o})}));r&&r.length&&(a=a.concat(n.createEmojiUpdatePayload(r,i,t.value))),i+=t.value.length})),n.updateEmojiData(r,a)}(t,this.props.parse,e);this.editor.replaceText(r[0],r[1],i)}},getSelection:function(){var t,e=TJ(this);return e?RJ(e):(null===(t=this.editor)||void 0===t?void 0:t.getSelection())||[-1,-1]},setSelection:function(t,e){void 0===e&&(e=t);var n=TJ(this);n?PJ(n,[t,e]):this.editor&&this.editor.setSelection(t,e)},selectAll:function(){this.setSelection(0,this.value.length)},getShortcut:function(t){return SJ.get(t)},handleEnter:function(t){BJ(this,t)},isEmpty:function(){var t=this.editor;return t?0===t.model.length:!this.value},focus:function(){var t;if(TJ(this)){var e=this.value.length;this.refs.input.focus(),this.setSelection(e,e)}else null===(t=this.editor)||void 0===t||t.focus()},blur:function(){this.refs.input.blur()}},EJ={paste:function(t,e){for(var n=e.clipboardData,o=0,r=0,a=0;a<n.items.length;a++){var i=n.items[a];"string"===i.kind?o++:"file"===i.kind&&r++}r&&o<=1&&(e.preventDefault(),e.stopImmediatePropagation(),function(t,e){Zt(t,"attach-files",e)}(t,function(t){var e=[],n=t.items;if(n&&n.length)for(var o=0;o<n.length;o++)"file"===n[o].kind&&e.push(n[o].getAsFile());return e.filter(Boolean)}(n)))},click:function(t,e){e.target&&e.target.closest("a")&&e.preventDefault()},"editor-update":function(t){AJ(t),Zt(t,"update",{text:t.value})}};function xJ(t){t.state._focused=!0,te(t,"input-focus")}function IJ(t){t.state._focused=!1,te(t,"input-blur")}function BJ(t,e){var n=t.props,o=n.altNewline,r=n.multiline,a=e.ctrlKey||e.metaKey||e.shiftKey||e.altKey;if(r&&(o?!a:a))return!1;e.preventDefault(),Zt(t,"input-submit")}function MJ(t,e){if(!TJ(t)){var n=t.isContentEditable;if(t.contentEditable=String(!e),e&&n){var o=t.getSelection();if(o[0]!==o[1]){var r=window.getSelection();null==r||r.removeAllRanges(),t.blur()}}}}function AJ(t){t.classList.toggle("js-empty",t.isEmpty())}function TJ(t){var e=t.refs.input,n=null==e?void 0:e.nodeName;if("INPUT"===n||"TEXTAREA"===n)return e}function jJ(t,e){e.silent&&t.setAttribute(kJ,"true");var n=function(t){return"string"==typeof t?t:t.map((function(t){return t.value})).join("")}(e.value),o=e.selection;if(e.replace){var r=e.replace,a=r[0],i=r[1];if(!o){var s=a+n.length;o=[s,s]}n=t.value.slice(0,a)+n+t.value.slice(i)}o||(o=[n.length,n.length]),t.value=n,o&&PJ(t,o,e.noFocus),VJ(t),e.silent?t.removeAttribute(kJ):zJ(t)}function PJ(t,e,n){n||(t.selectionStart=e[0],t.selectionEnd=e[1]),LJ(t,e)}function RJ(t){return KJ(t)?[t.selectionStart,t.selectionEnd]:CJ.get(t)||[0,0]}function LJ(t,e){CJ.set(t,e)}function OJ(t,e){var n=TJ(t);n&&(VJ(n),n.hasAttribute(kJ)||zJ(n))}function zJ(t){Zt(t,"editor-update",{input:t})}function DJ(t,e){"Enter"===e.key&&BJ(t,e)}function UJ(t){var e={"Cmd+Z":function(t){return t.undo()},"Cmd+Y":function(t){return t.redo()},"Cmd+Shift+Z":function(t){return t.redo()},Enter:function(e,n){return BJ(t,n)},"Any+Enter":function(e,n){return BJ(t,n)},Escape:function(e,n){var o=new CustomEvent("input-esc",{bubbles:!0,cancelable:!0});t.dispatchEvent(o),o.defaultPrevented&&(n.stopPropagation(),n.preventDefault())}};return SJ.forEach((function(o,r){e[o]=function(e){var o=t.props.format||0;r===n.TokenFormat.Link?(t.props.customLinks&&e.pickLink(),OK.logger.success("messagesLayer","formating.byShortcut",ot[r])):o&r&&(e.toggleFormat(r),OK.logger.success("messagesLayer","formating.byShortcut",ot[r]))}})),e}function NJ(t){t.editor=new n.Editor(t.refs.input,{value:t.props.value||"",parse:t.props.parse,shortcuts:UJ(t),resetFormatOnNewline:!0,html:t.props.htmlPaste,nowrap:!t.props.multiline,scroller:t,emoji:function(e,n,r,a){if(null!=e||r){var i=null,s=null,u=null;if(null==a?void 0:a.lottieUrl){var c=a;i=yo((null==c?void 0:c.emoji)||e),s=(null==c?void 0:c.emoji)||r||e,u=yJ&&t.props.animatedEmoji&&{id:c.cid||o.createAnimojiCid(c.id),url:c.lottieUrl}}else i=yo(e,r),s=r||e;var p=i;return n||((n=document.createElement("img")).className="emoji"),n.getAttribute("alt")!==s&&(n.setAttribute("src",p),n.setAttribute("alt",s)),n.classList.toggle("user-emoji",e.startsWith("#u")),u?(n.classList.add("js-lottie-emoji"),n.setAttribute("data-lottie-id",String(u.id)),n.setAttribute("data-lottie-url",u.url)):(n.classList.remove("js-lottie-emoji"),n.removeAttribute("data-lottie-id"),n.removeAttribute("data-lottie-url"),n.setAttribute("src",p)),n}}}),t.props.disabled&&MJ(t,!0),AJ(t)}function qJ(t){var e=t.editor;e&&(e.dispose(),t.editor=null)}function HJ(t){var e=TJ(t);if(e){var n=t.props.value;if(n){jJ(e,{value:n,noFocus:!0,silent:!0});var o=(null==n?void 0:n.length)||0;LJ(e,[o,o])}VJ(e)}}function FJ(t){var e=TJ(t);e&&CJ.delete(e)}function VJ(t){"TEXTAREA"===t.nodeName&&(t.style.height="1px",t.style.height="".concat(t.scrollHeight,"px"))}function KJ(t){return hr(t)===t}var WJ="e-bbci7t";function GJ(t,e,o){n.updateAttribute(t,e,"placeholder",o.props.placeholder),n.updateProperty(t,e,"disabled",o.props.disabled)}function YJ(t,e,o){var r=o._5=n.insert(e,n.elem("textarea",WJ));return n.setPendingRef(o._1,"input",r),GJ(r,o._6=n.obj(),t),o._7=n.addEvent(r,"input",OJ,t,o),o._8=n.addEvent(r,"keydown",DJ,t,o),o._9=n.addEvent(r,"focus",xJ,t,o),o._a=n.addEvent(r,"blur",IJ,t,o),XJ}function XJ(t,e){var o=e._5;n.setPendingRef(e._1,"input",o),GJ(o,e._6,t)}function QJ(t,e,o){n.updateAttribute(t,e,"placeholder",o.props.placeholder),n.updateProperty(t,e,"disabled",o.props.disabled)}function JJ(t,e,o){var r=o._d=n.insert(e,n.elem("input",WJ)),a=o._e=n.obj();return n.setAttribute(r,"type","text"),QJ(r,a,t),o._f=n.addEvent(r,"input",OJ,t,o),o._g=n.addEvent(r,"keydown",DJ,t,o),o._h=n.addEvent(r,"focus",xJ,t,o),o._i=n.addEvent(r,"blur",IJ,t,o),$J}function $J(t,e){QJ(e._d,e._e,t)}function ZJ(t,e,o){n.updateAttribute(t,e,"data-tsid",o.props["data-tsid"]?o.props["data-tsid"]+"-input":null)}function t$(t,e,o){var r=o._1,a=o._l=n.insert(e,n.elem("div",WJ));n.setPendingRef(r,"overlay",a);var i=o._m=n.insert(e,n.elem("div",WJ));n.setPendingRef(r,"input",i);var s=o._n=n.obj();return n.setClass(i,"js-lottie-observer"),ZJ(i,s,t),o._o=n.addEvent(i,"focus",xJ,t,o),o._p=n.addEvent(i,"blur",IJ,t,o),e$}function e$(t,e){var o=e._1,r=e._m;n.setPendingRef(o,"overlay",e._l),n.setPendingRef(o,"input",r),ZJ(r,e._n,t)}function n$(t){return t.props.plainText&&t.props.multiline?YJ:t.props.plainText?JJ:t$}function o$(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();return e._2=n.mountBlock(t,r,n$),n.finalizePendingRefs(t,a),r$}function r$(t,e){n.updateBlock(e._2),n.finalizePendingRefs(t,e._1)}YJ.dispose=function(t){t._7=n.removeEvent("input",t._7),t._8=n.removeEvent("keydown",t._8),t._9=n.removeEvent("focus",t._9),t._a=n.removeEvent("blur",t._a),t._6=t._5=null},JJ.dispose=function(t){t._f=n.removeEvent("input",t._f),t._g=n.removeEvent("keydown",t._g),t._h=n.removeEvent("focus",t._h),t._i=n.removeEvent("blur",t._i),t._e=t._d=null},t$.dispose=function(t){t._o=n.removeEvent("focus",t._o),t._p=n.removeEvent("blur",t._p),t._l=t._n=t._m=null},o$.dispose=function(t){t._2=n.clearBlock(t._2)};var a$={__proto__:null,cssScope:WJ,default:o$,formatShortcuts:SJ,extend:wJ,events:EJ,props:function(){return{plainText:bJ}},didMount:function(t){t.props.plainText?HJ(t):NJ(t),t.props.autofocus&&requestAnimationFrame((function(){return t.selectAll()}));var e=function(){var e=TJ(t);e&&KJ(e)&&(Zt(t,"editor-selectionchange"),LJ(e,RJ(e)))};document.addEventListener("selectionchange",e);var n=function(){};if(t.props.animatedEmoji&&fJ()){var o=function(t,e){var n=new a,o=function(){return t.element.querySelectorAll(".js-lottie-emoji")},r=function(t){_J.add(t);for(var e=o(),n=0;n<e.length;n++)hJ(e[n])},i=function(t){t.forEach((function(t){t.forEach((function(t){t.canvas&&t.canvas.remove(),t.dispose()}))}))},s=function(){for(var s=new a,u=t.element.getBoundingClientRect(),c=o(),p=0;p<c.length;p++){var l=c[p],m=vJ(l),d=gJ(l,n,r);d.canvas.parentNode!==e&&e.appendChild(d.canvas),_J.has(m)&&hJ(l),s.has(m)?s.get(m).push(d):s.set(m,[d]);var _=l.getBoundingClientRect();d.canvas.style.left="".concat(_.left-u.left,"px"),d.canvas.style.top="".concat(_.top-u.top,"px")}i(n),n=s},u=new ResizeObserver((function(){return s()}));return u.observe(t.element),t.on("editor-update",s),t.on("editor-formatchange",s),s(),{update:s,dispose:function(){i(n),t.off("editor-update",s),t.off("editor-formatchange",s),u.disconnect()}}}(t.editor,t.refs.overlay);t.state.overlay=o,n=function(){return o.dispose()}}return function(){document.removeEventListener("selectionchange",e),n()}},didChange:function(t,e){var n=e.value,o=e.parse,r=e.disabled,a=e.multiline,i=e.plainText,s=t.editor;n&&t.setValue(n.current),s&&(o&&s.setOptions({parse:o.current}),r&&MJ(t,r.current)),a&&(s?s.setOptions({nowrap:!a.current}):t.setValue(t.props.value)),i&&t.refs.input&&(i.current?(qJ(t),HJ(t)):s||(FJ(t),NJ(t)))},willUnmount:function(t){FJ(t),qJ(t)},onFocus:xJ,onBlur:IJ,onPlainInputUpdate:OJ,onKeyDown:DJ};function i$(t,e){return new FontFace(t,"url(".concat(e,")")).load().then((function(t){document.fonts.add(t)}))}function s$(t,e){var n=t.store.get().staticRoot;return"".concat(n,"/").concat(e)}var u$="msg-assets-panel/assets/bg/86235751967ea558.jpg",c$="msg-assets-panel/assets/bg/762a5bbca9297a1e.jpg",p$="msg-assets-panel/assets/bg/07f72fdca98e5769.png",l$="msg-assets-panel/assets/bg/f632c4fe9a0165d6.png",m$="msg-assets-panel/assets/bg/2f2a0a8fea1664a4.jpg",d$="msg-assets-panel/assets/bg/e66a9258b4c8712d.jpg",_$="msg-assets-panel/assets/bg/f038285a20d46060.jpg",f$="msg-assets-panel/assets/bg/df96b436411345ca.jpg",g$="msg-assets-panel/assets/bg/8565e11b01ab5601.jpg",v$="msg-assets-panel/assets/bg/f653c6179c230bba.png",h$="msg-assets-panel/assets/bg/c1114c7ce68ffe20.png",C$="msg-assets-panel/assets/bg/9256146cd1219085.jpg",k$="msg-assets-panel/assets/bg/48750092605841c2.jpg",b$="msg-assets-panel/assets/bg/68e4018fa241261d.jpg",y$="msg-assets-panel/assets/bg/c606d2fa04c07215.jpg",S$="msg-assets-panel/assets/bg/643ab8f090627bda.png",w$="msg-assets-panel/assets/bg/ae2a5749d1fd8561.png",E$="msg-assets-panel/assets/bg/2700141aeb2131a9.png",x$="msg-assets-panel/assets/bg/cde15b3fb598c2de.png",I$="msg-assets-panel/assets/bg/625720f9aa6d4f14.jpg",B$="msg-assets-panel/assets/bg/9a3a069f684b055e.jpg",M$="msg-assets-panel/assets/bg/8c7eb951d425bcc8.jpg",A$="msg-assets-panel/assets/bg/836fb51e91bf94b7.jpg",T$="msg-assets-panel/assets/bg/84c95643119c62d6.jpg",j$="msg-assets-panel/assets/bg/96c0de35ca068483.jpg",P$="msg-assets-panel/assets/bg/1f93be4d3c810686.png",R$="msg-assets-panel/assets/bg/8f36c21088fd8612.png",L$="msg-assets-panel/assets/bg/8a6bc4f04489a3e4.png",O$="msg-assets-panel/assets/bg/5a6b9aa5176c8093.png",z$=432,D$=432;function U$(t,e){e.stopPropagation();var n=t.state.maxSymbols,o=e.target.value.slice(0,n);t.setState({fullText:e.target.value,text:o||V("stickers.stub")}),H$(t)}function N$(t){var e=t.refs.preview,n=t.state,r=n.active,a=n.maxSymbols;n.fullText.length<=a&&(OK.logger.success("messagesLayer","send-user-sticker",r),OK.logger.success("messagesLayer","send-user-sticker-quarter","".concat(r,"_q").concat(o.getCurrentUserQuarter(t))),e.toBlob((function(e){var n=t.store.get().selectedChat;e.height=D$,e.width=z$,Zt(t,"post-user-sticker",{chatId:n.id,file:e})})))}function q$(t,e,o){var r,a=o.store.get().config,i=o.state.fullText,s=Q$(o,t),u=(null===(r=null==a?void 0:a.user)||void 0===r?void 0:r.HIDDEN_BUBBLES)||[];u.find((function(t){return"STICKER_CONSTRUCTOR_TEMPLATES_TOOLTIP"===t}))||Zt(o,"update-user-settings",{name:"HIDDEN_BUBBLES",value:n.__spreadArray(n.__spreadArray([],u,!0),["STICKER_CONSTRUCTOR_TEMPLATES_TOOLTIP"],!1)}),e&&Zt(o,"update-user-settings",{name:"HIDDEN_BUBBLES",value:n.__spreadArray(n.__spreadArray([],u,!0),["STICKER_CONSTRUCTOR_NEW_".concat(t.toUpperCase())],!1)}),o.setState({active:t,text:i?i.slice(0,s.length):V("stickers.stub"),maxSymbols:s.length}),H$(o),o.refs.input.setSelection((null==i?void 0:i.length)||0)}function H$(t){var e=Q$(t,t.state.active);e&&e.template()}function F$(t){var e=t.refs.preview;e.width=z$,e.height=D$;var n=e.getContext("2d");return n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,e.width,e.height),n.filter="none",n.font="96px sans-serif",n.textAlign="center",n.textBaseline="middle",n}function V$(t,e,n){var o;void 0===n&&(n={});var r=n.align,a=void 0===r?"bottom":r,i=n.color,s=void 0===i?"#666":i,u=n.offsetX,c=void 0===u?0:u,p=n.offsetY,l=void 0===p?0:p,m=n.strokeWidth,d=void 0===m?8:m,_=t.state.text,f=48,g=null===(o=Q$(t,e))||void 0===o?void 0:o.image[0];X$(g).then((function(){var e=F$(t);e.drawImage(g,0,0,z$,D$),e.font="".concat(f,'px "Odnoklassniki", Oswald, sans-serif');var n=Y$(e,_,c||60);e.textBaseline=a,e.lineCap="round",e.lineJoin="round",e.miterLimit=2,e.fillStyle=s,e.strokeStyle="#fff",e.lineWidth=d,n.forEach((function(t,o){for(e.save(),f=48,e.font="".concat(f,'px "Odnoklassniki", Oswald, sans-serif');e.measureText(t).width>z$-20-c;)e.font="".concat(--f,'px "Odnoklassniki", Oswald, sans-serif');var r=1.1*f;if("bottom"===a){var i=(o+1-n.length)*r;d&&e.strokeText(t,z$/2,D$-40+i-l),e.shadowColor="transparent",e.fillText(t,z$/2,D$-40+i-l)}else d&&e.strokeText(t,z$/2,20+o*r),e.shadowColor="transparent",e.fillText(t,z$/2,20+o*r)}))}))}function K$(t,e){var n=e.x,o=e.y,r=e.r,a=e.h,i=e.w;t.beginPath(),t.moveTo(n+r,o),t.arcTo(n+i,o,n+i,o+a,r),t.arcTo(n+i,o+a,n,o+a,r),t.arcTo(n,o+a,n,o,r),t.arcTo(n,o,n+i,o,r),t.closePath()}function W$(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function G$(){return 2*Math.round(Math.random())-1}function Y$(t,e,n){void 0===n&&(n=0);for(var o=(e||"").split(/\s+/),r=[],a=o[0],i=1;i<o.length;i++){var s=o[i];t.measureText(a+" "+s).width<z$-n?a+=" "+s:(r.push(a),a=s)}return r.push(a),r}function X$(t){return t.complete?Promise.resolve():new Promise((function(e){t.onload=function(){return e()}}))}function Q$(t,e){return(t.state.templates||[]).find((function(t){return t.name===e}))||null}var J$="e-r4b9xj";function $$(t,e){e.newUntil=Date.parse(n.get(t.store.data.config,"server","user-sticker-new-bubble-until"))>Date.now(),e.new=e.newUntil&&n.get(t.store.data.config,"server","user-sticker-new-bubble"),e.order=n.get(t.store.data.config,"server","user-sticker-template-order")}function Z$(t,e,n){e.value=n.props.value||n.props.text,e.placeholder=n.store.data.l10n("stickers.placeholder")}function tZ(t,e,o){e.current=n.get(o.state.fullText,"length"),e.max=o.state.maxSymbols}function eZ(t,e,o){e.disabled=!n.get(n.call(o.state.fullText,"trim"),"length")||n.get(o.state.fullText,"length")>o.state.maxSymbols}function nZ(t,e){n.get(t.state.fullText,"length")&&n.setPendingEvent(e._f,"click",N$,e)}function oZ(t,e){return e.order}function rZ(t,e){e.isNew=jt(0,e.new,e.value)&&!jt(0,n.get(t.store.data.config,"user","HIDDEN_BUBBLES"),"STICKER_CONSTRUCTOR_NEW_"+Rt(0,e.value)),e.isValid=n.find(t.state.templates,(function(t){return n.get(t,"name")===e.value}))}function aZ(t,e,o,r){n.updateClass(t,e,r.value==o.state.active?"selected-okmsg":"")}function iZ(t,e,n,o){q$(o.value,o.isNew,t)}function sZ(t,e,o,r){n.updateClass(t,e,"preview-okmsg __"+r.value+(r.isNew?" __new-okmsg":""))}function uZ(t,e,o){var r=o._x=n.insert(e,n.elem("li",J$));return aZ(r,o._y=n.obj(),t,o),o._z=n.addEvent(r,"click",iZ,t,o),sZ(o._10=n.appendChild(r,n.elem("div",J$)),o._11=n.obj(),0,o),cZ}function cZ(t,e){aZ(e._x,e._y,t,e),sZ(e._10,e._11,0,e)}function pZ(t,e){return e.isValid?uZ:null}function lZ(t,e,o){return rZ(t,o),o._u=n.mountBlock(t,e,pZ),mZ}function mZ(t,e){rZ(t,e),n.updateBlock(e._u)}function dZ(t,e){var o=t.componentView;$$(t,e);var r=n.appendChild(o,n.elem("section",J$)),a=n.appendChild(r,n.elem("canvas",J$));n.setRef(t,"preview",a);var i=n.appendChild(r,n.elem("div",J$));n.setClass(i,"input-okmsg");var s=n.appendChild(i,n.elem("div",J$));n.setClass(s,"text-okmsg");var u=e._9=n.appendChild(s,n.createComponent("msg-input",a$,t));n.setRef(t,"input",u);var c=e._a=n.propsSet(u,{autofocus:!0,"data-tsid":"user-sticker-input",class:"base-input-okmsg"});Z$(0,c,t),e._b=n.addEvent(u,"update",U$,t,e),n.mountComponent(u,c);var p=e._c=n.appendChild(s,n.createComponent("msg-counter",mJ,t)),l=e._d=n.propsSet(p,{threshold:4,"data-tsid":"sticker_text_length_counter"});tZ(0,l,t),n.mountComponent(p,l);var m=e._e=n.appendChild(i,n.createComponent("msg-button",fe,t)),d=m.componentModel.input,_=e._f=n.pendingEvents(t,m),f=e._g=n.propsSet(m,{shape:"square",class:"primary-okmsg"});eZ(0,f,t),nZ(t,e);var g=e._j=n.insert(d,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(g,n.propsSet(g,{key:"send-own-sticker"})),n.finalizePendingEvents(_),n.mountComponent(m,f);var v=n.appendChild(o,n.elem("footer",J$)),h=n.appendChild(v,n.elem("ul",J$)),C=n.createInjector(h);n.setRef(t,"tabs",h),n.setClass(h,"controls-okmsg"),e._o=n.mountIterator(t,C,oZ,lZ);var k=n.appendChild(o,n.elemWithText("div",".",J$));n.setClass(k,"font-okmsg"),n.setAttribute(k,"style","font-family: 'Poiret One'");var b=n.appendChild(o,n.elemWithText("div",".",J$));n.setClass(b,"font-okmsg"),n.setAttribute(b,"style","font-family: 'Old Standard TT'");var y=n.appendChild(o,n.elemWithText("div",".",J$));n.setClass(y,"font-okmsg"),n.setAttribute(y,"style","font-family: 'Amatic SC'");var S=n.appendChild(o,n.elemWithText("div",".",J$));n.setClass(S,"font-okmsg"),n.setAttribute(S,"style","font-family: 'Russo One'");var w=n.appendChild(o,n.elemWithText("div",".",J$));return n.setClass(w,"font-okmsg"),n.setAttribute(w,"style","font-family: 'Oswald'"),n.subscribeStore(t,["config","l10n"]),_Z}function _Z(t,e){var o=e._9,r=e._a,a=e._c,i=e._d,s=e._e,u=e._g;$$(t,e),Z$(0,r,t),n.updateComponent(o,r),tZ(0,i,t),n.updateComponent(a,i),eZ(0,u,t),nZ(t,e),n.finalizePendingEvents(e._f),n.updateComponent(s,u),n.updateIterator(e._o)}uZ.dispose=function(t){t._z=n.removeEvent("click",t._z),t._y=t._11=t._10=t._x=null},lZ.dispose=function(t){t._u=n.unmountBlock(t._u)},dZ.dispose=function(t){t._b=n.removeEvent("update",t._b),t._9=n.unmountComponent(t._9),t._c=n.unmountComponent(t._c),t._f=n.detachPendingEvents(t._f),t._j=n.unmountComponent(t._j),t._e=n.unmountComponent(t._e),t._o=n.unmountIterator(t._o)};var fZ={__proto__:null,cssScope:J$,default:dZ,props:function(){return{text:""}},plugins:function(){return[DS({ENTER:function(t,e,n){N$(t),n()},ALL:function(t,e,n){n()}})]},willMount:function(t){var e,o,r=t.store.get().config,a=(null===(e=null==r?void 0:r.user)||void 0===e?void 0:e.HIDDEN_BUBBLES)||[];a.find((function(t){return"STICKER_CONSTRUCTOR_TOOLTIP"===t}))||Zt(t,"update-user-settings",{name:"HIDDEN_BUBBLES",value:n.__spreadArray(n.__spreadArray([],a,!0),["STICKER_CONSTRUCTOR_TOOLTIP"],!1)});var i=function(t){var e=[{name:"hearts",length:28,template:function(){return function(t){var e=t.state.text,n=F$(t);(function(t,e){var n=e.createLinearGradient(0,0,0,D$),o=new Path2D("M8 4.25A3.84 3.84 0 0111.54 2c2.47 0 4.7 3.19 2.55 6.47-1.97 3-4.96 5.02-5.85 5.58a.5.5 0 01-.52 0 21.65 21.65 0 01-5.85-5.58C-.32 5.17 1.93 2 4.4 2 6.41 2 7.5 3.3 8 4.25z");function r(t){e.resetTransform();var n=t%40*30-20,a=D$-50*Math.ceil(t/40)+W$(0,20)*G$(),i=W$(6,8);e.translate(n,a),e.scale(i,i),e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor="rgba(0,0,0,.4)",e.shadowBlur=4,e.fillStyle="rgba(".concat(W$(128,254),",").concat(W$(0,20),",").concat(W$(0,20),",1)"),e.fill(o),t-- >0&&r(t)}function a(t){e.resetTransform();var n=W$(0,z$),r=.75*D$,i=.6,s=Math.random()*i,u=W$(0,D$)*(1-s)+r*s,c=u>D$/2?W$(2,6):W$(1,3);e.translate(n,u),e.rotate(W$(0,180)*G$()),e.scale(c,c),e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowColor="rgba(0,0,0,.4)",e.shadowBlur=4,e.fillStyle="rgba(".concat(W$(128,254),",").concat(W$(0,20),",").concat(W$(0,20),",1)"),e.fill(o),t-- >0&&a(t)}n.addColorStop(0,"hsl(".concat(t,", 50%, 95%)")),n.addColorStop(1,"hsl(".concat(t,", 55%, 85%)")),e.fillStyle=n,e.fillRect(0,0,z$,D$),e.save(),r(120),a(120),e.restore()})(W$(0,359),n),n.font='64px "Lobster", cursive',n.lineCap="round",n.lineJoin="round",n.miterLimit=2;var o=Y$(n,e);n.fillStyle="#fff",o.forEach((function(t,e){n.save();var r=64;for(n.font="".concat(r,'px "Lobster", cursive');n.measureText(t).width>z$-40;)n.font="".concat(--r,'px "Lobster", cursive');n.shadowBlur=4,n.shadowOffsetY=4,n.shadowColor="rgba(0,0,0,.4)";var a=(e+1-o.length)*r;n.fillText(t,z$/2,D$-60+a)}))}(t)}},{name:"bouquet",url:[p$],length:28,template:function(){return function(t){var e,n=t.state.text,o=F$(t),r=null===(e=Q$(t,"bouquet"))||void 0===e?void 0:e.image[0];X$(r).then((function(){!function(t,e){var n,o=e.createLinearGradient(0,0,0,D$),r=W$(0,359),a=new Path2D("M8 4.25A3.84 3.84 0 0111.54 2c2.47 0 4.7 3.19 2.55 6.47-1.97 3-4.96 5.02-5.85 5.58a.5.5 0 01-.52 0 21.65 21.65 0 01-5.85-5.58C-.32 5.17 1.93 2 4.4 2 6.41 2 7.5 3.3 8 4.25z"),i=null===(n=Q$(t,"bouquet"))||void 0===n?void 0:n.image[0];function s(t){e.resetTransform();var n=W$(0,z$),o=W$(0,D$),r=W$(1,3);e.translate(n,o),e.rotate(W$(0,180)*G$()),e.scale(r,r),e.fillStyle="rgba(255,255,255,.2)",e.fill(a),t-- >0&&s(t)}o.addColorStop(0,"hsl(".concat(r,", 50%, 85%)")),o.addColorStop(1,"hsl(".concat(r,", 55%, 65%)")),e.fillStyle=o,e.fillRect(0,0,z$,D$),e.save(),s(100),e.restore(),e.drawImage(i,0,0,z$,D$)}(t,o),o.font='64px "Lobster", cursive',o.lineCap="round",o.lineJoin="round",o.miterLimit=2;var e=Y$(o,n);o.fillStyle="#fff",e.forEach((function(t,n){o.save();var r=64;for(o.font="".concat(r,'px "Lobster", cursive');o.measureText(t).width>z$-40;)o.font="".concat(--r,'px "Lobster", cursive');o.shadowBlur=4,o.shadowOffsetY=4,o.shadowColor="rgba(0,0,0,.4)";var a=(n+1-e.length)*r;o.fillText(t,z$/2,D$-60+a)}))}))}(t)}},{name:"leaves",length:28,template:function(){return function(t){var e=t.state.text,n=F$(t);(function(t){var e=[[{path:new Path2D("M20.2 24.91s11.33 3.32 12.16-6.02c.6-6.69-7.01-11.3-9-17.58-2.26 2.98-7.54 6.53-12.07 10.08-4.6 3.6-3.53 10.68 2.02 12.09 5.55 1.4 6.89 1.43 6.89 1.43"),fill:"#FBCD18"},{path:new Path2D("M19.02 24.76c-1-.18-2.76-.53-5.7-1.28-5.56-1.41-6.63-8.48-2.03-12.09 4.53-3.55 9.8-7.1 12.07-10.08l.05.16c-.5 3.13-3.05 14.38-3.4 16.12-.31 1.52-.79 5.46-.99 7.17z"),fill:"#F9B50B"},{path:new Path2D("M19.37 24.6c-.48 2.49-1.34 9.45-.3 14.81-.4.28-.74.12-.74.12-.28-1.79-.25-8.57.76-14.94 1.16-3.16.28.02.28.02"),fill:"#FBCD18"}],[{path:new Path2D("M20.81 33.61c-1.3-1.49-4.74-1.8-6.72-5.06 1.54.02 3.18-1.48.11-3.06-3.06-1.57-4.34-4.84-4.34-4.84s6.97 2.05 3.64-.68C10.16 17.25 9 16.3 9.1 11.6c2.05.44 5.72 3.11 6.74 1.74.05-1.13-2.45-3.66-1.85-6.72 1.26 1.05 3.5.59 3.2-2.05.76.41 2.38-2.07 2.1-4.2C20.3 3.25 23.06 7 24.05 5.23A20 20 0 0124.1 11c-.21 1.64.93.63 2.05-.3 1.12-.94 3.32-1.68 4.2-2.36-.43 3.03-2.79 7.22-3.35 8.17-.55.96.5.98 1.5.41 1-.56 2.27-.71 2.88-1.57.05 2.54-1.25 5.53-2.67 6.36-1.41.84-2.2 1.23-2 1.87.2.64 2.67.8 4.04.35a13.11 13.11 0 01-5.32 4.03c-1.22.5-.48 1.23.37 1.1-.47 2-3.58 2.73-4.99 4.54"),fill:"#F13C07"},{path:new Path2D("M19.32.77l-.03-.4C20.3 3.25 23.06 7 24.05 5.23A20 20 0 0124.1 11c-.21 1.64.93.63 2.05-.3 1.12-.94 3.32-1.68 4.2-2.36-.43 3.03-2.79 7.22-3.35 8.17-.55.96.5.98 1.5.41 1-.56 2.27-.71 2.88-1.57.05 2.54-1.25 5.53-2.67 6.36-1.41.84-2.2 1.23-2 1.87.2.64 2.67.8 4.04.35a13.11 13.11 0 01-5.32 4.03c-1.22.5-.48 1.23.37 1.1-.44 1.86-3.17 2.62-4.68 4.19-.19-2.4-.49-7.8-.54-10.15-.08-2.9.1-10.02-.07-12.64-.15-2.3-.44-6.77-1.19-9.7z"),fill:"#E40E00"},{path:new Path2D("M20.53 32.71s.63 4.03.22 6.5c.71.32.9.11 1.17-.02-.24-.82-1-4.98-.9-6.62-.27-.47-.49.14-.49.14"),fill:"#F13C07"}],[{path:new Path2D("M19.9 30.98S12.61 29.4 9.04 19.95C5.46 10.51 11.72 3.11 18.98 1c2.25.63 12.47 3.3 11.26 15.23-.98 9.64-9.8 14.45-10.35 14.75"),fill:"#D7B400"},{path:new Path2D("M19.04 1.01c2.36.66 12.4 3.38 11.2 15.22-.91 9.1-8.83 13.9-10.17 14.66.02-9.77-.87-26.16-1.03-29.88z"),fill:"#C69A00"},{path:new Path2D("M19.66 30.44s.04 5.48-2.64 7.9c-.02.55.8.61.8.61.82-.79 2.3-4.17 2.2-8.1-.1-3.94-.75-4.63-.75-4.63l.39 4.22z"),fill:"#D7B400"}],[{path:new Path2D("M27.6 23.82c1.46-1.82 3.6-5.6 1.98-6.94-1.45-1.21-2.66.22-3.37-.85s2.59-6.2.61-7.27c-1.98-1.07-2.61 1.3-3.65.58-1.04-.71 1.43-4.64-.7-5.34-1.74-.58-2.25 1.12-3.02.8-.78-.33-.55-5.13-4.65-3.8-4 1.3-1.24 5.03-1.7 5.74-.45.71-1.6-.32-2.57 1.16-1.23 1.89 2.56 3.52 2.12 4.7-.44 1.18-2.13-.42-2.9 1.44-.88 2.07 4.2 4.5 4.23 5.79.03 1.29-2 .89-2.28 2.62-.34 2.09 3.36 3.9 5.6 4.56 2.24.65 1.05 1.85.5 2.82-.73 1.24.12 2.81 2.55 2.61 2.87-.24 4.42.14 5.1 1.82.04-.03.18-.34.22-.35-.27-1.1.71-2.34 2.78-3.86 1.36-.99 1.91-2.35.68-3.13-1.33-.84-3-1.29-1.53-3.1"),fill:"#F7941E"},{path:new Path2D("M14.37 1.16L14.8 1c4.1-1.33 3.87 3.47 4.64 3.8.78.32 1.29-1.38 3.03-.8 2.13.7-.34 4.63.7 5.34 1.04.72 1.67-1.65 3.65-.57 1.98 1.07-1.32 6.19-.6 7.26.7 1.07 1.91-.36 3.37.85 1.62 1.34-.53 5.12-2 6.94-1.45 1.81.2 2.26 1.54 3.1 1.23.78.68 2.14-.68 3.13-1.78 1.3-2.75 2.4-2.82 3.39-1.39-3.6-4.1-12.38-5.39-16.48a165.7 165.7 0 00-5.87-15.8z"),fill:"#F37511"},{path:new Path2D("M25.2 33.58s1.29 2.87.43 5.55c.05.14.43.22.68.13.19-.6.37-3.32-.87-5.87-.4-.55-.24.19-.24.19"),fill:"#F7941E"}],[{path:new Path2D("M17.85 16.8s1.93-5.78 5.15-8.53c-.05 2.54 1.07 4.06 1.07 4.06s2.9-2.22 4.65-2.99c-.6 1.78 2.28 3.76 5.22 3.35-2.06 1.73-5.56 3.56-1.8 4.54l3.76.98s-5.22 3.17 2.1 6.6c-4.21-.16-6.32-.24-6.1 2-1.84-.54-4.27-2.26-4.56-1.15-.29 1.1.25 3.74 3.83 6.48-2.79-.54-6.09 2.14-4.14 7.51-3.37-3.9-4.66-6.93-7.31-3.28-.72-4.3.07-10.94-4.72-2.37-.5-.98-2.06-1.67-4.76 2.49.59-3.15 1.9-7.3-2.85-6.98 1.54-1.91 3.16-4.84.86-5.63-2.3-.8-5.25-.53-5.25-.53s6.21-2.43 3.44-5c3.01-.35 6.28-1.29 3.45-3.63 3.08.66 5.14.02 7.96 2.08"),fill:"#FBAC18"},{path:new Path2D("M26.1 38.55c-2.7-3.33-3.98-5.48-6.38-2.18-.72-4.3.07-10.94-4.72-2.37-.5-.98-2.06-1.67-4.76 2.49.59-3.15 1.9-7.3-2.85-6.98 1.54-1.91 3.16-4.84.86-5.63-2.3-.8-5.25-.53-5.25-.53s6.21-2.43 3.44-5c3.01-.35 6.28-1.29 3.45-3.63 2.98.64 5 .06 7.67 1.87 1.18 2.27 2.1 5.42 2.92 8.46.8 2.97 3.57 9.96 5.63 13.5z"),fill:"#F98A0B"},{path:new Path2D("M18.37 17.49c-.9-1.97-5.5-14.6-4-16.8-.5-.45-.94.27-.94.27-.9 2.71 2.9 12.96 4.58 16.66 1.2 1.66 1.26 1.83.36-.13"),fill:"#FBAC18"}],[{path:new Path2D("M24.32 35.08s-1.8-1.31-3.36-1.73c-2.37-.63-3.7-3.06-4.26-3.58 1.01-.1 2.2-1.33.54-2.09a29.46 29.46 0 00-6.94-2.2c2.03-.8 6.15-2.14 3.35-3.7-2.8-1.56-5.36-3.42-7.08-5.53 2.33.7 6.7.7 6.99-.4.3-1.11-2.51-2.67-4.08-6.83 1.58.54 3.7 1.36 4.8.47 1.1-.9.27-3.25.02-4.14.7.16 1.98-1.2 1.3-4.93.63 1.3 2.85 6.36 4.17 4.1.08 1.4.26 4.67 2.44 3.73 2.18-.93 3.7-2.94 3.7-2.94s-.16 2.62-.78 4.55c-.62 1.92-1.11 3.27.4 2.56 1.53-.7 3.9-2.05 4.52-2.67-1.06 4.57-2.75 7.1-3.26 8.28-.52 1.18.3 1.45 1.95.96 1.66-.5 3.16-.75 3.9-1.27a72.86 72.86 0 01-4.2 5.43c-.88.93-2.06 2.28-.9 2.52 1.15.23 2.92.3 3.08.28-1.32 1.86-2.25 4.31-3 5.46-.74 1.14-3.4 2.6-3.3 3.67"),fill:"#A0A301"},{path:new Path2D("M15.62.5L15.6.42c.63 1.3 2.85 6.36 4.17 4.1.08 1.4.26 4.67 2.44 3.73 2.18-.93 3.7-2.94 3.7-2.94s-.16 2.62-.78 4.55c-.62 1.92-1.11 3.27.4 2.56 1.53-.7 3.9-2.05 4.52-2.67-1.06 4.57-2.75 7.1-3.26 8.28-.52 1.18.3 1.45 1.95.96 1.66-.5 3.16-.75 3.9-1.27a72.86 72.86 0 01-4.2 5.43c-.88.93-2.06 2.28-.9 2.52 1.15.23 2.92.3 3.08.28-1.32 1.86-2.25 4.31-3 5.46-.63.98-2.67 2.2-3.19 3.19-.57-2.6-2.96-11.98-3.7-15.3-.62-2.7-3.67-13.65-5.11-18.8z"),fill:"#828601"},{path:new Path2D("M23.93 33.92s.67 2.66.93 5.57c.46.32.46-.1.46-.1s-1.11-5.12-1.23-5.6c-.12-.49-.16.13-.16.13"),fill:"#A0A301"}]];function n(o){t.resetTransform();var r=W$(-40,z$+40),a=W$(-40,D$+40),i=W$(2,3);t.translate(r,a),t.rotate(W$(0,180)*G$()),t.scale(i,i),t.shadowOffsetX=1,t.shadowOffsetY=1,t.shadowColor="rgba(0,0,0,.2)",t.shadowBlur=4,e[o%e.length].forEach((function(e){t.fillStyle=e.fill,t.fill(e.path)})),o-- >0&&n(o)}t.fillStyle="#9e1a1f",t.fillRect(0,0,z$,D$),t.save(),n(250),t.restore()})(n),n.font='64px "Odnoklassniki", sans-serif',n.lineCap="round",n.lineJoin="round",n.miterLimit=2;var o=Y$(n,e);n.fillStyle="#fff",o.forEach((function(t,e){n.save();var r=64;for(n.font="".concat(r,'px "Odnoklassniki", cursive');n.measureText(t).width>z$-40;)n.font="".concat(--r,'px "Odnoklassniki", cursive');var a=(e-o.length/2)*r+r/2;n.shadowBlur=4,n.shadowOffsetY=4,n.shadowColor="rgba(0,0,0,.4)",n.fillText(t,z$/2,D$/2+a)}))}(t)}},{name:"roseheart",url:[v$],length:28,template:function(){return function(t){var e,n=t.state.text,o=F$(t),r=null===(e=Q$(t,"roseheart"))||void 0===e?void 0:e.image[0];X$(r).then((function(){!function(t,e){var n,o=e.createLinearGradient(0,0,0,D$),r=W$(0,359),a=null===(n=Q$(t,"roseheart"))||void 0===n?void 0:n.image[0];function i(t){e.resetTransform();var n=W$(0,z$),o=W$(0,D$),r=W$(1,3);e.beginPath(),e.arc(n,o,10*r,0,2*Math.PI,!1),e.fillStyle="rgba(255,255,255,.2)",e.fill(),t-- >0&&i(t)}o.addColorStop(0,"hsl(".concat(r,", 40%, 95%)")),o.addColorStop(1,"hsl(".concat(r,", 55%, 80%)")),e.fillStyle=o,e.fillRect(0,0,z$,D$),e.save(),i(100),e.restore(),e.drawImage(a,0,0,z$,D$)}(t,o),o.font='64px "Lobster", cursive',o.lineCap="round",o.lineJoin="round",o.miterLimit=2;var e=Y$(o,n,120);o.fillStyle="#fff",e.forEach((function(t,n){o.save();var r=64;for(o.font="".concat(r,'px "Lobster", cursive');o.measureText(t).width>z$-40;)o.font="".concat(--r,'px "Lobster", cursive');o.shadowBlur=4,o.shadowOffsetY=4,o.shadowColor="rgba(0,0,0,.4)";var a=(n-e.length/2)*r+r/2;o.shadowBlur=6,o.shadowOffsetY=6,o.shadowColor="rgba(0,0,0,.6)",o.fillText(t,z$/2,D$/2+a)}))}))}(t)}},{name:"chief",url:[_$],length:28,template:function(){return V$(t,"chief",{color:"#3a1512",offsetX:120,offsetY:50})}},{name:"konditer",url:[f$],length:32,template:function(){return V$(t,"konditer",{color:"#333"})}},{name:"chaos",length:12,template:function(){return function(t){var e=F$(t),n=t.state.text,o=160,r=e.createLinearGradient(0,0,0,D$);r.addColorStop(0,"#222"),r.addColorStop(1,"#111"),e.fillStyle=r,e.fillRect(0,0,z$,D$),e.save(),function(t,e){var n=function(t){return Math.floor(Math.random()*(t+1))};function o(r){e.resetTransform();var a=z$/2+G$()*n(z$/2),i=D$/2+G$()*n(D$/2);e.translate(a,i),e.rotate(W$(0,180)*G$()),e.fillStyle="rgba(".concat(n(255),", ").concat(n(255),", ").concat(n(255),", ").concat(n(7)/10,")"),e.font="".concat(20+n(100),'px "Amatic SC"'),e.fillText(t.state.text,0,0),r%12==0&&Te(t.refs.preview,3),r-- >0&&o(r)}o(55)}(t,e),e.resetTransform(),e.restore(),e.font="".concat(o,'px "Amatic SC", cursive'),e.fillStyle="#fff";for(;e.measureText(n).width>z$-20;)e.font="".concat(--o,'px "Amatic SC", cursive');e.translate(z$/2,D$/2),e.rotate(W$(0,10)*G$()*Math.PI/180),e.fillText(n,0,0,z$)}(t)}},{name:"roses",url:[u$],length:28,template:function(){return function(t){var e,n=t.state.text,o=F$(t),r=null===(e=Q$(t,"roses"))||void 0===e?void 0:e.image[0];o.drawImage(r,0,0,z$,D$),o.font='96px "Lobster", cursive',o.lineCap="round",o.lineJoin="round",o.miterLimit=2;var a=Y$(o,n);a.forEach((function(t,e){o.save();var n=96;for(o.font="".concat(n,'px "Lobster", cursive');o.measureText(t).width>z$-40;)o.font="".concat(--n,'px "Lobster", cursive');var r=(e-a.length/2)*n+n/2,i=o.createLinearGradient(0,D$/2+r-n/2,0,D$/2+r+n/2);i.addColorStop(0,"#ffde99"),i.addColorStop(.1,"#eca12f"),i.addColorStop(.3,"#fffbad"),i.addColorStop(.5,"#eca12f"),i.addColorStop(1,"#fefeb2"),o.fillStyle=i,o.shadowBlur=6,o.shadowOffsetY=6,o.shadowColor="rgba(0,0,0,.6)",o.fillText(t,z$/2,D$/2+r)}))}(t)}},{name:"jump",length:20,template:function(){return function(t){var e=F$(t),n=t.state.text,o=128,r=128;e.font="".concat(r,'px "Impact", Oswald, sans-serif');var a=Y$(e,n);a.forEach((function(t,n){for(e.save(),r=128,e.font="".concat(r,'px "Impact", Oswald, sans-serif');e.measureText(t).width>z$-20&&r>14;)e.font="".concat(--r,'px "Impact", Oswald, sans-serif');for(var i=e.measureText(t).width/2-e.measureText(t).width/16,s=z$/2+e.measureText(t[0]).width/2,u=(n-a.length/2)*o+o/2,c=Array.from(t),p=0;p<c.length;p++){e.save();var l=e.measureText(c[p]).width-e.measureText(c[p]).width/8;e.fillStyle="hsl(".concat(W$(0,359),", 90%, 65%)"),e.translate(s-i,D$/2+W$(0,20)*G$()+u),e.rotate(W$(0,15)*G$()*Math.PI/180),e.fillText(c[p],0,0),e.restore(),s+=l}})),e.restore()}(t)}},{name:"money",url:[h$],length:28,template:function(){return V$(t,"money",{color:"#f3c25e",strokeWidth:0})}},{name:"stamp",url:[l$],length:16,template:function(){return function(t){var e,n=t.state.text,o=F$(t),r=["#0a9928","#d23","#2c2bc7"][W$(0,2)],a=W$(0,20)*G$(),i=null===(e=Q$(t,"stamp"))||void 0===e?void 0:e.image[0];o.save();var s=72;o.font="".concat(s,'px "Russo One", sans-serif');for(;o.measureText(n.toUpperCase()).width>z$-92;)o.font="bold ".concat(--s,'px "Russo One", sans-serif');o.fillStyle=r,i.complete&&(o.strokeStyle=r,o.lineWidth=16,o.beginPath(),o.arc(z$/2,D$/2,D$/2-48,0,2*Math.PI),o.stroke(),o.lineWidth=12,o.beginPath(),o.arc(z$/2,D$/2,D$/4-16,0,2*Math.PI),o.stroke(),o.lineWidth=4,o.beginPath(),o.arc(z$/2,D$/2,D$/2-62,0,2*Math.PI),o.stroke(),o.beginPath(),o.arc(z$/2,D$/2,D$/4-28,0,2*Math.PI),o.stroke(),o.translate(z$/2,D$/2),o.rotate(a*Math.PI/180),o.translate(-z$/2,-D$/2),K$(o,{x:16,y:D$/2-Math.max(1.5*s,100)/2,r:16,h:Math.max(1.5*s,100),w:z$-32}),o.fill(),function(t,e){var n=new Path2D("M22.12 4.69a2.05 2.05 0 013.68 0l5.03 10.2 11.26 1.63a2.05 2.05 0 011.13 3.5c-3.3 3.2-8.14 7.94-8.14 7.94L37 39.16a2.05 2.05 0 01-2.97 2.17l-10.07-5.3-10.07 5.3a2.05 2.05 0 01-2.97-2.16l1.92-11.21-8.14-7.94a2.04 2.04 0 011.13-3.5L17.1 14.9l5.03-10.2z"),o=new Path2D("M14.75 3.12a1.36 1.36 0 012.45 0l3.35 6.8 7.51 1.1a1.37 1.37 0 01.76 2.32l-5.43 5.3 1.28 7.47a1.37 1.37 0 01-1.98 1.44l-6.72-3.53-6.71 3.53a1.37 1.37 0 01-1.98-1.44l1.28-7.47-5.43-5.3a1.36 1.36 0 01.76-2.32l7.5-1.1 3.36-6.8z"),r=25;t.translate(z$/2-24,D$/2-148),t.fill(n),t.translate(0,248),t.fill(n),t.translate(-z$/2+24,-D$/2-100);for(var a=1;a<=e;a++)t.translate(z$/2,D$/2),t.rotate(r*a*Math.PI/180),t.translate(-16,-140),t.fill(o),t.translate(0,248),t.fill(o),t.translate(16,-108),t.rotate(2*-r*a*Math.PI/180),t.translate(-16,-140),t.fill(o),t.translate(0,248),t.fill(o),t.translate(16,-108),t.rotate(r*a*Math.PI/180),t.translate(-z$/2,-D$/2)}(o,3),o.globalCompositeOperation="destination-out",o.strokeStyle="#fff",K$(o,{x:20,y:D$/2-Math.max(1.5*s,100)/2+6,r:16,h:Math.max(1.5*s,100)-12,w:z$-40}),o.stroke(),o.globalCompositeOperation="destination-in",o.drawImage(i,-W$(0,188),-W$(0,188),i.naturalWidth,i.naturalHeight),o.fillStyle="#fff",o.globalCompositeOperation="destination-out",o.translate(z$/2,D$/2),o.fillText(n.toUpperCase(),0,4),o.restore())}(t)}},{name:"holiday",url:[c$],length:28,template:function(){return function(t){var e,n=t.state.text,o=F$(t),r=null===(e=Q$(t,"holiday"))||void 0===e?void 0:e.image[0];o.drawImage(r,0,0,z$,D$),o.font='64px "Odnoklassniki", cursive',o.lineCap="round",o.lineJoin="round",o.miterLimit=2;var a=Y$(o,n);o.fillStyle="#fff",a.forEach((function(t,e){o.save();var n=64;for(o.font="".concat(n,'px "Odnoklassniki", sans-serif');o.measureText(t).width>z$-40;)o.font="".concat(--n,'px "Odnoklassniki", sans-serif');var r=(e-a.length/2)*n+n/2;o.shadowBlur=4,o.shadowOffsetY=4,o.shadowColor="rgba(0,0,0,.4)",o.fillText(t,z$/2,D$/2+r)}))}(t)}},{name:"catdog",url:[M$],length:32,template:function(){return V$(t,"catdog",{align:"top",color:"#999"})}},{name:"wtf",url:[I$],length:32,template:function(){return V$(t,"wtf",{color:"#333"})}},{name:"lips",url:[C$],length:32,template:function(){return V$(t,"lips",{color:"#9b0d16"})}},{name:"sad",url:[T$],length:32,template:function(){return V$(t,"sad",{color:"#78483d"})}},{name:"wink",url:[B$],length:32,template:function(){return V$(t,"wink",{color:"#ed8300"})}},{name:"sore",url:[A$],length:32,template:function(){return V$(t,"sore")}},{name:"scream",url:[j$],length:32,template:function(){return V$(t,"scream",{align:"top",color:"#a74951"})}},{name:"facepalm",url:[d$],length:32,template:function(){return V$(t,"facepalm")}},{name:"harold",url:[m$],length:32,template:function(){return V$(t,"harold",{color:"#333"})}},{name:"neon",length:26,template:function(){return function(t){var e=t.refs.preview,n=F$(t),o=t.state.text,r=96,a=96;n.fillStyle="#111",n.fillRect(0,0,e.width,e.height),n.font="".concat(r,'px "Poiret One", sans-serif');var i=Y$(n,o),s=W$(0,359);i.forEach((function(t,e){for(n.save(),r=96,n.font="".concat(r,'px "Poiret One", sans-serif');n.measureText(t).width>z$-20&&r>14;)n.font="".concat(--r,'px "Poiret One", sans-serif');var o=(e-i.length/2)*a+a/2,u=z$/2;n.fillStyle="#111",n.lineWidth=40,n.strokeStyle="hsla(".concat(s,", 100%, 50%, .2)"),n.strokeText(t,u,D$/2+o)})),Te(e,50),i.forEach((function(t,e){for(n.save(),r=96,n.font="".concat(r,'px "Poiret One", sans-serif');n.measureText(t).width>z$-20&&r>14;)n.font="".concat(--r,'px "Poiret One", sans-serif');var o=(e-i.length/2)*a+a/2,u=z$/2;n.shadowBlur=30,n.shadowColor="hsl(".concat(s,", 100%, 50%)"),n.fillText(t,u,D$/2+o),n.shadowBlur=20,n.fillText(t,u,D$/2+o),n.shadowBlur=10,n.fillText(t,u,D$/2+o),n.shadowBlur=8,n.fillText(t,u,D$/2+o),n.shadowBlur=4,n.shadowColor="#fff",n.fillText(t,u,D$/2+o),n.shadowBlur=2,n.fillText(t,u,D$/2+o),n.fillStyle="#fff",n.shadowBlur=3,n.shadowColor="rgba(0,0,0,.1)",n.shadowOffsetX=-4,n.shadowOffsetY=6,n.fillText(t,u,D$/2+o),n.shadowOffsetX=0,n.shadowOffsetY=0})),n.restore()}(t)}},{name:"silent",length:36,template:function(){return function(t){var e=F$(t),n=t.state.text,o=72,r=56;e.save();var a=document.createElement("canvas");a.width=z$,a.height=D$;var i=a.getContext("2d");(function(t,e){for(var n=e.createImageData(2*z$,2*D$),o=new Uint32Array(n.data.buffer),r=o.length,a=0;a<r;a++)Math.random()<.5&&(o[a]=1711276032);e.putImageData(n,0,0);var i=new Path2D("M112.3 173.7c6.6-23.9 6.5-35.1 1.9-58.6-.5-2.5 1-4 3.5-3.5 23.5 4.6 34.8 4.7 58.6-1.9 1.6-.4 2.8 1.9 1 3-18.3 11.2-30 11.7-47.7 11-1.5-.1-3.3 1.8-3.2 3.2.7 17.7.2 29.4-11 47.7-1.2 1.9-3.5.7-3.1-.9zm61.2-105c-13.9 7-28.6-6.6-25.8-21.2 1.9-10.1 10.3-16.7 20.1-18.3 13-2.1 25.9 4 32.2 16 16.1 30.3-13.9 55.5-43.5 59.6-16 2.2-39.4.1-57.6-8.2 8.4 18.2 10.5 41.6 8.2 57.6-4.1 29.6-29.2 59.5-59.6 43.5a30.68 30.68 0 01-16-32.2c1.6-9.8 8.3-18.2 18.3-20.1 14.6-2.8 28.2 11.9 21.2 25.8-4.4 8.6-13.6 8.3-17.9 3.5-3.5-3.9-3.7-9.7 0-13.4 3.3-3.3 8.4-3.6 12.1-1.1-4.3-10.2-16.4-8.3-21.6-2.3-9.1 10.3-3.6 27 7.7 32.6 25.6 12.8 44.3-13.7 47.6-37.3 3.5-25-5.8-79.1-39.7-76.2-15.2 1-16 24.1-2.4 26.1 2.9.4 6-.5 7.5-3.2-2.8 1-6 .4-8.2-1.8-3-3-3-8 0-11 5.9-5.9 16.2.1 16.8 7.1 1.6 18.7-24.3 22.3-31.6 5.9-5.8-12.8 2.4-28.7 17.3-30.6 5.5-.6 10.5 0 15 1.4-1.4-4.5-2-9.5-1.4-15 1.9-14.9 17.8-23 30.6-17.3 16.3 7.4 12.8 33.2-5.9 31.6-6.9-.6-13-10.9-7.1-16.8 3-3 8-3 11 0 2.2 2.2 2.8 5.4 1.8 8.2 2.6-1.5 3.6-4.6 3.2-7.5-2-13.6-25.1-12.8-26.4 2.6-2.9 33.9 51.2 43.1 76.2 39.7 23.6-3.3 50.1-22 37.3-47.6-5.6-11.2-22.2-16.8-32.6-7.7-5.9 5.2-7.8 17.3 2.3 21.6a9.43 9.43 0 011.1-12.1c3.7-3.7 9.5-3.5 13.4 0 4.7 4.5 5 13.7-3.6 18.1zM1021.5 173.7c-6.6-23.9-6.5-35.1-1.9-58.6.5-2.5-1-4-3.5-3.5-23.5 4.6-34.8 4.7-58.6-1.9-1.6-.4-2.8 1.9-1 3 18.3 11.2 30 11.7 47.7 11 1.5-.1 3.3 1.8 3.2 3.2-.7 17.7-.2 29.4 11 47.7 1.2 1.9 3.6.7 3.1-.9zm-61.1-105c13.9 7 28.6-6.6 25.8-21.2-1.9-10.1-10.3-16.7-20.1-18.3-13-2.1-25.9 4-32.2 16-16.1 30.3 13.9 55.5 43.5 59.6 16 2.2 39.4.1 57.6-8.2-8.4 18.2-10.5 41.6-8.2 57.6 4.1 29.6 29.2 59.5 59.6 43.5a30.68 30.68 0 0016-32.2c-1.6-9.8-8.3-18.2-18.3-20.1-14.6-2.8-28.2 11.9-21.2 25.8 4.4 8.6 13.6 8.3 17.9 3.5 3.5-3.9 3.7-9.7 0-13.4a9.56 9.56 0 00-12.1-1.1c4.3-10.2 16.4-8.3 21.6-2.3 9.1 10.3 3.6 27-7.7 32.6-25.6 12.8-44.3-13.7-47.6-37.3-3.5-25 5.8-79.1 39.7-76.2 15.4 1.3 16.2 24.5 2.6 26.4-2.9.4-6-.5-7.5-3.2 2.8 1 6 .4 8.2-1.8 3-3 3-8 0-11-5.9-5.9-16.2.1-16.8 7.1-1.6 18.7 24.3 22.3 31.6 5.9 5.8-12.8-2.4-28.7-17.3-30.6-5.5-.6-10.5 0-15 1.4 1.4-4.5 2-9.5 1.4-15-1.9-14.9-17.8-23-30.6-17.3-16.3 7.4-12.8 33.2 5.9 31.6 6.9-.6 13-10.9 7.1-16.8-3-3-8-3-11 0a7.83 7.83 0 00-1.8 8.2c-2.6-1.5-3.6-4.6-3.2-7.5 1.9-13.6 25.1-12.8 26.4 2.6 2.9 33.9-51.2 43.1-76.2 39.7-23.6-3.3-50.1-22-37.3-47.6 5.6-11.2 22.2-16.8 32.6-7.7 5.9 5.2 7.8 17.3-2.3 21.6 2.6-3.7 2.2-8.8-1.1-12.1-3.7-3.7-9.5-3.5-13.4 0-4.9 4.2-5.2 13.4 3.4 17.8zM112.3 960.2c6.6 23.9 6.5 35.1 1.9 58.6-.5 2.5 1 4 3.5 3.5 23.5-4.6 34.8-4.7 58.6 1.9 1.6.4 2.8-1.9 1-3-18.3-11.2-30-11.7-47.7-11-1.5.1-3.3-1.8-3.2-3.2.7-17.7.2-29.4-11-47.7-1.2-2-3.5-.7-3.1.9zm61.2 105c-13.9-7-28.6 6.6-25.8 21.2 1.9 10.1 10.3 16.7 20.1 18.3 13 2.1 25.9-4 32.2-16 16.1-30.3-13.9-55.5-43.5-59.6-16-2.2-39.4-.1-57.6 8.2 8.4-18.2 10.5-41.6 8.2-57.6-4.1-29.6-29.2-59.5-59.6-43.5a30.68 30.68 0 00-16 32.2c1.6 9.8 8.3 18.2 18.3 20.1 14.6 2.8 28.2-11.9 21.2-25.8-4.4-8.6-13.6-8.3-17.9-3.5-3.5 3.9-3.7 9.7 0 13.4 3.3 3.3 8.4 3.6 12.1 1.1-4.3 10.2-16.4 8.3-21.6 2.3-9.1-10.3-3.6-27 7.7-32.6 25.6-12.8 44.3 13.7 47.6 37.3 3.5 25-5.8 79.1-39.7 76.2-15.4-1.3-16.2-24.5-2.6-26.4 2.9-.4 6 .5 7.5 3.2-2.8-1-6-.4-8.2 1.8-3 3-3 8 0 11 5.9 5.9 16.2-.1 16.8-7.1 1.6-18.7-24.3-22.3-31.6-5.9-5.8 12.8 2.4 28.7 17.3 30.6 5.5.6 10.5 0 15-1.4-1.4 4.5-2 9.5-1.4 15 1.9 14.9 17.8 23 30.6 17.3 16.3-7.4 12.8-33.2-5.9-31.6-6.9.6-13 10.9-7.1 16.8 3 3 8 3 11 0 2.2-2.2 2.8-5.4 1.8-8.2 2.6 1.5 3.6 4.6 3.2 7.5-2 13.6-25.1 12.8-26.4-2.6-2.9-33.9 51.2-43.1 76.2-39.7 23.6 3.3 50.1 22 37.3 47.6-5.6 11.2-22.2 16.8-32.6 7.7-5.9-5.2-7.8-17.3 2.3-21.6a9.43 9.43 0 001.1 12.1c3.7 3.7 9.5 3.5 13.4 0 4.9-4.3 5.2-13.5-3.4-17.8zM1021.5 960.2c-6.6 23.9-6.5 35.1-1.9 58.6.5 2.5-1 4-3.5 3.5-23.5-4.6-34.8-4.7-58.6 1.9-1.6.4-2.8-1.9-1-3 18.3-11.2 30-11.7 47.7-11 1.5.1 3.3-1.8 3.2-3.2-.7-17.7-.2-29.4 11-47.7 1.2-2 3.6-.7 3.1.9zm-61.1 105c13.9-7 28.6 6.6 25.8 21.2-1.9 10.1-10.3 16.7-20.1 18.3-13 2.1-25.9-4-32.2-16-16.1-30.3 13.9-55.5 43.5-59.6 16-2.2 39.4-.1 57.6 8.2-8.4-18.2-10.5-41.6-8.2-57.6 4.1-29.6 29.2-59.5 59.6-43.5a30.68 30.68 0 0116 32.2c-1.6 9.8-8.3 18.2-18.3 20.1-14.6 2.8-28.2-11.9-21.2-25.8 4.4-8.6 13.6-8.3 17.9-3.5 3.5 3.9 3.7 9.7 0 13.4a9.56 9.56 0 01-12.1 1.1c4.3 10.2 16.4 8.3 21.6 2.3 9.1-10.3 3.6-27-7.7-32.6-25.6-12.8-44.3 13.7-47.6 37.3-3.5 25 5.8 79.1 39.7 76.2 15.4-1.3 16.2-24.5 2.6-26.4-2.9-.4-6 .5-7.5 3.2 2.8-1 6-.4 8.2 1.8 3 3 3 8 0 11-5.9 5.9-16.2-.1-16.8-7.1-1.6-18.7 24.3-22.3 31.6-5.9 5.8 12.8-2.4 28.7-17.3 30.6-5.5.6-10.5 0-15-1.4 1.4 4.5 2 9.5 1.4 15-1.9 14.9-17.8 23-30.6 17.3-16.3-7.4-12.8-33.2 5.9-31.6 6.9.6 13 10.9 7.1 16.8-3 3-8 3-11 0a7.83 7.83 0 01-1.8-8.2c-2.6 1.5-3.6 4.6-3.2 7.5 1.9 13.6 25.1 12.8 26.4-2.6 2.9-33.9-51.2-43.1-76.2-39.7-23.6 3.3-50.1 22-37.3 47.6 5.6 11.2 22.2 16.8 32.6 7.7 5.9-5.2 7.8-17.3-2.3-21.6 2.6 3.7 2.2 8.8-1.1 12.1-3.7 3.7-9.5 3.5-13.4 0-4.9-4.3-5.2-13.5 3.4-17.8zM61 212.4h4.7v709H61v-709zM1068.2 212.4h4.7v709h-4.7v-709zM212.4 1072.9v-4.7h709v4.7h-709zM212.4 65.7V61h709v4.7h-709z");e.save(),e.scale(.381,.381),e.fillStyle="rgba(255,255,245, .5)",e.fill(i),Te(t,20),e.fillStyle="rgba(255,255,245, .7)",e.fill(i),e.restore()})(t.refs.preview,i),e.fillStyle="#000",e.fillRect(0,0,z$,D$),e.fillStyle="rgba(88, 88, 78, .4)",e.fillRect(32,32,z$-64,D$-64),Te(t.refs.preview,72),e.drawImage(a,0,0),e.fillStyle="rgba(255,255,240,.85)",e.font="".concat(r,'px "Old Standard TT", sans-serif');var s=Y$(e,n,64);s.forEach((function(t,n){for(e.save(),r=56,e.font="".concat(r,'px "Old Standard TT", sans-serif');e.measureText(t).width>z$-64;)e.font="".concat(--r,'px "Old Standard TT", sans-serif');var a=(n-s.length/2)*o+o/2;e.shadowBlur=16,e.shadowColor="rgba(255,255,240,.3)",e.shadowOffsetX=0,e.shadowOffsetY=0,e.fillText(t,z$/2-1,D$/2+1+a)}));var u=W$(32,z$-32);e.beginPath(),e.strokeStyle="rgba(128,128,128, .2)",e.moveTo(u,0),e.lineTo(u,D$),e.stroke(),e.restore()}(t)}},{name:"doge",url:[g$],length:36,template:function(){return V$(t,"doge",{align:"top",color:"#7f4a22"})}},{name:"halloween",url:[S$],length:36,template:function(){return V$(t,"halloween",{color:"#4b0501"})}},{name:"evil",url:[k$],length:36,template:function(){return V$(t,"evil",{color:"#4d1a09"})}},{name:"natasha",url:[b$],length:36,template:function(){return V$(t,"natasha",{align:"top",color:"#654430"})}},{name:"poinsettia",url:[y$],length:36,template:function(){return V$(t,"poinsettia",{color:"#b11819"})}},{name:"forest",url:[P$,R$,L$,O$],length:36,template:function(){return function(t){var e,n=t.state.text,o=F$(t),r=null===(e=Q$(t,"forest"))||void 0===e?void 0:e.image;Promise.all(r.map((function(t){return X$(t)}))).then((function(){!function(t,e){var n,o=e.createLinearGradient(0,0,0,D$);o.addColorStop(0,"#06058c"),o.addColorStop(1,"#2639c4"),e.fillStyle=o,e.fillRect(0,0,z$,D$);var r=null===(n=Q$(t,"forest"))||void 0===n?void 0:n.image,a=[new Path2D("M38.41 24.1663c-.1978-.7385-.957-1.1768-1.6956-.979l-5.925 1.5878-5.7297-3.3081h6.6328c.7648 0 1.3846-.6198 1.3846-1.3844 0-.7646-.6198-1.3845-1.3846-1.3845h-6.48l4.9531-2.8597 6.15 1.648c.7387.198 1.4978-.2404 1.6957-.9789.1978-.7386-.2408-1.4978-.9793-1.6956l-3.4754-.9313 2.9063-1.678c.662-.3822.8891-1.229.5067-1.891-.3823-.662-1.229-.8891-1.8912-.5067l-2.8895 1.6683.9241-3.4496c.1979-.7386-.24-1.4976-.9786-1.6955-.7387-.1979-1.4979.2403-1.6957.9789l-1.6408 6.124-5.2054 3.0054 3.1583-5.4017c.3854-.6601.1631-1.5079-.4968-1.894-.66-.3859-1.5084-.1637-1.8937.4964l-3.0063 5.142V8.7597l4.4925-4.4927c.5407-.5406.5407-1.417 0-1.9578-.5406-.5405-1.4173-.5405-1.9577 0L21.354 4.844V1.881c0-.7647-.6198-1.3844-1.3845-1.3844s-1.3844.6197-1.3844 1.3844v2.963l-2.5349-2.5348c-.5405-.5405-1.4171-.5405-1.9576 0-.5409.5407-.5409 1.4172 0 1.9578l4.4925 4.4927v6.0956L15.5343 9.637c-.3853-.6601-1.2337-.8823-1.8937-.4964-.66.3861-.882 1.2339-.4968 1.894l3.1356 5.363-5.0597-2.9213L9.454 6.8866c-.198-.7386-.957-1.1768-1.6955-.979-.7386.198-1.1768.957-.979 1.6956l1.049 3.9153-2.9679-1.7136c-.662-.3824-1.509-.1554-1.8912.5067-.3825.662-.1554 1.5088.5067 1.891l2.3944 1.3824-3.01.8065c-.7385.1978-1.177.957-.9792 1.6955.198.7386.9573 1.1768 1.6956.979l5.6844-1.5232 5.4651 3.1553H8.4226c-.7643 0-1.384.6199-1.384 1.3845 0 .7646.6197 1.3844 1.384 1.3844h6.4567l-5.465 3.1552-6.0135-1.6113c-.7386-.1978-1.4979.2405-1.6956.979-.1978.7386.2401 1.4975.9787 1.6956l3.339.8947-2.5468 1.4705c-.662.382-.8892 1.229-.5067 1.8911.3821.662 1.2292.8888 1.8912.5066l2.7037-1.5609-.961 3.5863c-.1977.7385.2402 1.4975.9788 1.6952.7385.1981 1.4978-.24 1.6956-.9786l1.6774-6.2608 4.974-2.8717-3.3136 5.668c-.3865.6595-.1641 1.508.4963 1.893.66.3861 1.5081.164 1.8936-.4959l3.5797-6.1224v6.493l-4.4925 4.4927c-.5409.5409-.5409 1.4172 0 1.958.5405.5405 1.417.5405 1.9576 0l2.5349-2.5348v2.963c0 .7644.6197 1.3844 1.3844 1.3844s1.3845-.62 1.3845-1.3845v-2.963l2.5348 2.5349c.5404.5405 1.4171.5405 1.9577 0 .5407-.5408.5407-1.4171 0-1.958l-4.4925-4.4929v-6.4167l3.5352 6.0463c.3855.6598 1.2336.882 1.8936.496.6603-.385.8827-1.2336.4964-1.8931l-3.3364-5.7067 5.1936 2.9985 1.701 6.349c.1978.7386.957 1.1768 1.6956.9788.7386-.198 1.1768-.9567.9791-1.6954l-.9846-3.6745 2.551 1.4728c.662.3822 1.5088.1555 1.891-.5066.3825-.6622.1554-1.509-.5066-1.8911l-2.2825-1.3178 3.2506-.871c.7386-.1978 1.177-.957.979-1.6956"),new Path2D("M37.15 24.8274c-.1959-.7314-.9477-1.1656-1.679-.9696l-4.0405 1.0826-1.689-.9752 3.4291-.9186c.7315-.196 1.1654-.9478.9693-1.6792-.1958-.7313-.9475-1.1656-1.6788-.9697l-6.0776 1.6288-3.6489-2.1067 3.6486-2.1065 6.0779 1.6285c.7313.1958 1.483-.2383 1.6788-.9698.1961-.7314-.2378-1.4827-.9693-1.679l-3.429-.9186 1.689-.9752 4.0404 1.0825c.7313.196 1.4831-.2378 1.679-.9692.196-.7314-.2381-1.4832-.9695-1.679l-1.3918-.3732 1.5374-.8876c.6557-.3785.8804-1.2168.5019-1.8725-.3786-.6557-1.2172-.8807-1.8728-.5018l-1.5374.8877.373-1.3919c.196-.7314-.238-1.4833-.9695-1.6791-.7314-.196-1.483.2378-1.679.9692l-1.0825 4.0405-1.689.9752.9187-3.4291c.196-.7315-.2381-1.4833-.9694-1.6792-.7314-.196-1.4832.2378-1.679.9692l-1.6287 6.078-3.6485 2.1065v-4.2135l4.449-4.4487c.5355-.5355.5355-1.4034 0-1.9389-.5354-.5355-1.4034-.5355-1.939 0l-2.51 2.51V7.5038l2.9574-2.9572c.5355-.5355.5355-1.4035 0-1.939-.5351-.5354-1.4033-.5354-1.9388 0L21.364 3.6263V1.8512c0-.757-.6139-1.3707-1.371-1.3707s-1.3709.6137-1.3709 1.3707v1.7752l-1.0189-1.0188c-.5353-.5354-1.4034-.5354-1.9389 0-.5351.5355-.5351 1.4035 0 1.939l2.9578 2.9573v1.9505l-2.5102-2.51c-.5354-.5356-1.4035-.5356-1.939 0-.5352.5354-.5352 1.4033 0 1.9388l4.4492 4.4487v4.2135l-3.6487-2.1065-1.6285-6.078c-.1959-.7314-.9477-1.1651-1.6792-.9692-.7313.196-1.1653.9477-.9694 1.6792l.9189 3.4291-1.689-.9751-1.0826-4.0406c-.196-.7314-.9478-1.1651-1.679-.9692-.7316.1958-1.1653.9477-.9694 1.6791l.3728 1.3919-1.5373-.8877c-.6556-.3789-1.4941-.154-1.8728.5018-.3785.6557-.1539 1.494.5017 1.8725l1.5376.8876-1.3917.3732c-.7316.1958-1.1653.9476-.9694 1.679.1958.7314.9474 1.1652 1.6788.9692l4.0403-1.0825 1.689.9752-3.429.9185c-.7313.1964-1.1653.9477-.9694 1.679.1958.7316.9477 1.1657 1.679.9699l6.0779-1.6285 3.6484 2.1065-3.6489 2.1067-6.0773-1.6288c-.7314-.1959-1.4833.2384-1.6791.9697-.1959.7314.238 1.4833.9694 1.6792l3.4291.9186-1.689.9752-4.0404-1.0826c-.7314-.196-1.483.2382-1.6788.9696-.1962.7309.2378 1.4827.9694 1.6787l1.3917.373-1.5376.8877c-.6556.3785-.8802 1.2168-.5017 1.8724.3787.6562 1.2172.8807 1.8728.5023l1.537-.8875-.3728 1.3913c-.1956.7313.238 1.4832.9697 1.6791.7312.196 1.483-.2379 1.679-.9692L9.926 27.315l1.689-.9752-.9188 3.4287c-.1959.7315.2381 1.4833.9694 1.6791.7315.196 1.4833-.2378 1.6792-.969l1.6285-6.0778 3.6487-2.1065v4.2132l-4.4492 4.4491c-.5352.535-.5352 1.4035 0 1.9385.5355.5355 1.4036.5355 1.939 0l2.5102-2.51v1.9504l-2.9578 2.9574c-.5351.5355-.5351 1.4033 0 1.9388.5355.5355 1.4036.5355 1.9389 0l1.019-1.0187v1.7751c0 .757.6137 1.3708 1.3709 1.3708.757 0 1.371-.6137 1.371-1.3708v-1.775l1.0185 1.0186c.5355.5355 1.4037.5355 1.9388 0 .5355-.5355.5355-1.4033 0-1.9388l-2.9574-2.9574v-1.9505l2.51 2.5101c.5356.5355 1.4036.5355 1.939 0 .5355-.535.5355-1.4035 0-1.9385l-4.449-4.4491v-4.2132l3.6487 2.1067 1.6284 6.0775c.196.7313.9477 1.165 1.6791.9691.7313-.1958 1.1654-.9476.9694-1.679l-.9188-3.4288 1.6892.9753 1.0825 4.04c.1959.7313.9475 1.1651 1.679.9692.7313-.196 1.1653-.9478.9695-1.6791l-.373-1.3913 1.5373.8875c.6556.3784 1.4942.1539 1.8728-.5023.3785-.6556.1538-1.4939-.5019-1.8724l-1.5375-.8877 1.392-.373c.7313-.196 1.1653-.9478.9694-1.6787"),new Path2D("m35.92 27.9627-5.5088-3.1805 3.4867-.9343c.7362-.1972 1.1732-.9539.9759-1.6901-.1972-.7361-.954-1.173-1.6901-.9758l-6.1525 1.6488-4.7913-2.7664 4.7913-2.7663 6.1525 1.6487c.7361.1971 1.493-.2396 1.69-.9759.1974-.7362-.2396-1.493-.9758-1.69l-3.4867-.9344L35.92 12.166c.66-.381.8862-1.225.505-1.885-.381-.6599-1.2249-.8862-1.8849-.505l-5.4638 3.1546.9154-3.416c.197-.7362-.2398-1.4927-.9759-1.69-.7362-.1973-1.493.2395-1.69.9756l-1.6296 6.082-4.8361 2.792V11.897l4.478-4.478c.539-.539.539-1.4125 0-1.9516-.5388-.5387-1.4127-.5387-1.9514 0L20.8601 7.994V1.8777c0-.7622-.6179-1.3799-1.38-1.3799-.7621 0-1.3798.6177-1.3798 1.38V7.994l-2.5267-2.5267c-.5388-.5387-1.4126-.5387-1.9514 0-.539.539-.539 1.4127 0 1.9516l4.478 4.478v5.7773l-4.8361-2.7921-1.6296-6.082c-.1974-.7361-.954-1.173-1.6901-.9757-.736.1974-1.173.9539-.9757 1.69l.9153 3.4162L4.42 9.776c-.66-.3812-1.504-.1549-1.8849.505-.3812.66-.1551 1.504.5051 1.885l5.5087 3.1805-3.4867.9343c-.7362.1972-1.1733.954-.9758 1.6901.197.7363.9539 1.173 1.6898.9759l6.1527-1.6487 4.7914 2.7663-4.7911 2.7661-6.153-1.6485c-.7359-.1972-1.4927.2397-1.6898.9758-.1975.7362.2393 1.4926.9758 1.69l3.4867.9344-5.5087 3.1805c-.6602.381-.8863 1.225-.505 1.885.3809.66 1.2249.886 1.8848.505L9.884 27.198l-.9153 3.416c-.1972.7362.2397 1.4928.9757 1.69.7362.1974 1.493-.2394 1.69-.9756l1.6297-6.082 4.8362-2.7921v5.777l-4.4781 4.4783c-.539.539-.539 1.4126 0 1.9517.5388.5387 1.4126.5387 1.9514 0l2.5267-2.5267v6.1163c0 .762.6177 1.38 1.3798 1.38.7621 0 1.38-.618 1.38-1.38v-6.1163l2.5266 2.5267c.5387.5387 1.4126.5387 1.9514 0 .539-.539.539-1.4127 0-1.9517l-4.478-4.4782v-5.777l4.8361 2.792 1.6295 6.082c.1972.7362.954 1.173 1.6901.9755.7361-.197 1.173-.9537.9759-1.6899l-.9154-3.416 5.4638 3.1546c.66.381 1.504.155 1.885-.505.3811-.66.1549-1.504-.5051-1.885"),new Path2D("m24 27.9005-3.0904-2.2624v-3.188l2.665 1.5386L24 27.9005Zm-9.0525.0001.4178-3.8421 2.786-1.6085v3.1054l-3.2038 2.3452Zm-4.5259-7.8394 3.6004-1.5876 2.75 1.5876-2.7498 1.5877-3.6006-1.5877Zm4.5259-7.8396 3.2038 2.3452v3.1057l-2.786-1.6084-.4178-3.8425ZM24 12.2217l-.4255 3.9121-2.6649 1.5386v-3.1883L24 12.2217Zm4.5261 7.8395-3.5367 1.5593-2.7007-1.5593 2.701-1.5594 3.5364 1.5594Zm9.3755 4.0246c-.197-.7358-.9533-1.1725-1.6892-.9754l-5.9026 1.5819-2.7368-1.5802 4.422-1.9496a1.2037 1.2037 0 0 0 0-2.2025l-4.4218-1.9497 2.115-1.2212 6.127 1.6418c.7359.1971 1.492-.2395 1.6893-.9753.197-.7358-.2397-1.4921-.9755-1.6892l-3.4625-.9278 2.8955-1.6716c.6595-.3808.8855-1.2244.5046-1.884-.3807-.6596-1.2243-.8858-1.884-.5048l-2.8787 1.662.9206-3.4366c.1971-.7358-.2392-1.492-.975-1.6892-.7358-.197-1.4922.2395-1.6892.9753l-1.6348 6.1011-2.1676 1.2515.5301-4.8739a1.2034 1.2034 0 0 0-.5947-1.1724 1.2033 1.2033 0 0 0-1.3127.071l-3.871 2.834V8.7367l4.4758-4.4757c.5386-.5387.5386-1.4118 0-1.9505-.5386-.5386-1.412-.5386-1.9507 0l-2.525 2.5252v-2.952c0-.7617-.6176-1.3791-1.3794-1.3791-.7616 0-1.379.6174-1.379 1.3792v2.952l-2.5254-2.5253c-.5385-.5386-1.412-.5386-1.9505 0-.5387.5387-.5387 1.4118 0 1.9505l4.4759 4.4759v2.8467l-3.9845-2.9166a1.2035 1.2035 0 0 0-1.9073 1.1013l.5224 4.804-1.9684-1.1364-1.759-6.5652C8.857 6.135 8.101 5.6985 7.365 5.8955c-.7358.1973-1.1723.9535-.9753 1.6893l1.0452 3.9006-2.957-1.7072c-.6596-.381-1.5031-.1548-1.884.5048-.3808.6596-.1548 1.5032.5048 1.884l2.3853 1.3771-2.9986.8035c-.7357.1971-1.1726.9534-.9752 1.6892.1971.7358.9534 1.1724 1.6889.9753l5.6632-1.5175 2.5762 1.4874L6.953 18.96a1.2037 1.2037 0 0 0 .0001 2.2025l4.4858 1.9779-2.424 1.3995-5.991-1.6052c-.7358-.197-1.4923.2395-1.6893.9753-.197.7358.2393 1.4919.9751 1.6893l3.3266.8913-2.5374 1.465c-.6596.3807-.8856 1.2243-.5047 1.884.3808.6595 1.2243.8855 1.8839.5047l2.6937-1.5552-.9573 3.573c-.1972.7357.2393 1.4919.975 1.6889.7359.1973 1.4922-.2392 1.6894-.975l1.6711-6.2373 2.232-1.2886-.5225 4.8038a1.2037 1.2037 0 0 0 1.9074 1.1012l3.9845-2.9166v2.8468l-4.476 4.476c-.5386.5388-.5386 1.412 0 1.9508.5386.5384 1.412.5384 1.9506 0l2.5254-2.5255v2.952c0 .7615.6174 1.3792 1.379 1.3792.7618 0 1.3793-.6177 1.3793-1.3793v-2.9517l2.5251 2.5253c.5386.5384 1.4121.5384 1.9507 0 .5386-.5388.5386-1.412 0-1.9507l-4.4758-4.476v-2.7641l3.871 2.8338a1.2034 1.2034 0 0 0 1.9074-1.1012l-.53-4.8736 2.5046 1.446 1.695 6.3254c.197.7358.9533 1.1724 1.6892.975.7358-.197 1.1724-.9531.9753-1.689l-.9809-3.6608 2.5415 1.4674c.6596.3808 1.5032.1548 1.8839-.5048.381-.6596.155-1.5032-.5046-1.884l-2.274-1.3129 3.2384-.8677c.7357-.197 1.1725-.9534.9752-1.6891")],i=100;function s(t){e.resetTransform();var n=W$(.25*-z$,1.25*z$),o=W$(.7*D$,D$-50)-t/2,a=W$(8,16)/10,u=1-(i-t)/100;e.translate(n,o),e.scale(a,a),e.filter="grayscale(".concat(u,") blur(").concat(Math.floor(t/25),"px) brightness(").concat(i-t/3,"%)");var c=r[t%r.length];e.drawImage(c,0,0),t-- >0&&s(t)}function u(t){e.resetTransform();var n=W$(-z$/4,1.25*z$),o=W$(-D$/4,1.25*D$),r=W$(1,6)/10;e.translate(n,o),e.scale(r,r),e.fillStyle="rgba(255,255,255,".concat(W$(1,6)/10),e.fill(a[t%a.length]),t-- >0&&u(t)}e.save(),u(500),e.restore(),e.save(),s(i),e.restore()}(t,o),o.font='64px "Odnoklassniki", sans-serif',o.lineCap="round",o.lineJoin="round",o.miterLimit=2;var e=Y$(o,n);o.fillStyle="#fff",e.forEach((function(t,n){o.save();var r=64;for(o.font="".concat(r,'px "Odnoklassniki", cursive');o.measureText(t).width>z$-40;)o.font="".concat(--r,'px "Odnoklassniki", cursive');var a=(n-e.length/2)*r+r/2;o.shadowBlur=4,o.shadowOffsetY=4,o.shadowColor="rgba(0,0,0,.4)",o.fillText(t,z$/2,D$/2+a)}))}))}(t)}},{name:"basket",url:[w$],length:36,template:function(){return V$(t,"basket",{color:"#c90401"})}},{name:"bath",url:[E$],length:36,template:function(){return V$(t,"bath",{align:"top",color:"#ff5300"})}},{name:"hug",url:[x$],length:36,template:function(){return V$(t,"hug",{align:"top",color:"#aa6249"})}},{name:"threed",length:18,template:function(){return function(t){var e=F$(t),n=t.state.text,o=120,r=230;e.save(),e.resetTransform(),e.restore(),e.font="".concat(o,'px "Lobster", cursive'),e.lineWidth=6,e.translate(z$/2,D$/2),e.rotate(-10*Math.PI/180);var a=Y$(e,n);a.forEach((function(t,n){e.save();var o=120;for(e.font="".concat(o,'px "Lobster", cursive');e.measureText(t).width>z$-40;)e.font="".concat(--o,'px "Lobster", cursive');for(var i=(n-a.length/2)*o-30+o/2,s=10;s>0;s--)e.fillStyle="hsl(".concat((r+20*s)%360,", 90%, 65%)"),e.fillText(t,2*s,i+3*s);e.strokeStyle="#fff",e.strokeText(t,0,i),e.fillStyle="hsl(".concat((r+30)%360,", 100%, 65%)"),e.fillText(t,0,i)}))}(t)}}];return e.forEach((function(e){var n;(null===(n=e.url)||void 0===n?void 0:n.length)&&(e.image=[],e.url.forEach((function(n){var o=new Image;o.crossOrigin="Anonymous",o.src=s$(t,n),e.image.push(o)})))})),e}(t),s=((null==r?void 0:r.server)&&(null==r?void 0:r.server["user-sticker-template-order"])).find((function(t){return!!(o=i.find((function(e){return e.name===t})))}));i$("Odnoklassniki",s$(t,"msg-assets-panel/assets/fonts/0ed74c99f461d560.otf")),i$("Amatic SC",s$(t,"msg-assets-panel/assets/fonts/1d743cede4938e97.ttf")),i$("Old Standard TT",s$(t,"msg-assets-panel/assets/fonts/0ed3f35fadfd5adf.ttf")),i$("Oswald",s$(t,"msg-assets-panel/assets/fonts/2d390843f2da2822.ttf")),i$("Poiret One",s$(t,"msg-assets-panel/assets/fonts/e584be66a65b2658.ttf")),i$("Russo One",s$(t,"msg-assets-panel/assets/fonts/b41567fa52f0eb8b.ttf")),t.setState({templates:i,active:s,maxSymbols:o.length})},didMount:function(t){q$(t.state.active,!0,t)},onUpdateText:U$,onBlob:N$,onChangeEffect:q$},gZ=-1!==navigator.userAgent.indexOf("Trident");function vZ(t){var e=t.store.get().config,n=(null==e?void 0:e.server["user-stickers-enabled"])&&!gZ,o=null==e?void 0:e.server["user-sticker-new-bubble-until"];if(n&&o&&Date.parse(o)>Date.now()){var r=(null==e?void 0:e.user.HIDDEN_BUBBLES)||[];return!!((null==e?void 0:e.server["user-sticker-new-bubble"])||[]).filter((function(t){return-1===r.indexOf("STICKER_CONSTRUCTOR_NEW_".concat(t.toUpperCase()))})).length}return!1}function hZ(t){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(n){return(null==(e=t.store.get().config)?void 0:e.server["kikliko-gif-enabled"])?[2,hX()]:[2,!1]}))}))}function CZ(t,e){var o=null==e?void 0:e.server["kikliko-gif-tab-position"],r=o?parseInt(o):0;return(t=n.__spreadArray([],t,!0)).splice(r,0,kZ("gifs","kikliko-gif","live-stickers")),t}function kZ(t,e,n){return{id:t,label:e,icon:n}}var bZ="e-bsh4hl";function yZ(t,e){e.activeTab=t.props.tab,e.userStickersEnabled=n.get(t.store.data.config,"server","user-stickers-enabled")&&!Vt(0,"Trident"),e.bubbleHidden=jt(0,n.get(t.store.data.config,"user","HIDDEN_BUBBLES"),"STICKER_CONSTRUCTOR_TOOLTIP"),e.chooseExpr="stickers"===e.activeTab?0:"smiles"===e.activeTab?1:"sticker-constructor"===e.activeTab&&e.userStickersEnabled?2:"gifs"===e.activeTab?3:4,e.caseExpr=0===e.chooseExpr,e.recents=e.caseExpr?n.get(t.store.data.assets,"stickerSections","RECENT","result"):void 0,e.top=e.caseExpr?n.get(t.store.data.assets,"stickerSections","TOP"):void 0,e.sets=e.caseExpr?n.get(t.store.data.assets,"stickerSections","FAVORITE_STICKER_SETS","result"):void 0,e.loadState=e.caseExpr?n.get(t.store.data.assets,"loadState"):void 0,e.caseExpr_1=1===e.chooseExpr,e.recent=e.caseExpr_1?n.get(t.store.data.assets,"stickerSections","RECENT","recentEmojiList"):void 0}function SZ(t){return t.state.tabs}function wZ(t,e,o,r){n.updateAttribute(t,e,"data-tsid",n.get(r.value,"id")+"-menu"),n.updateAttribute(t,e,"data-l","t,"+n.get(r.value,"id")),n.updateClass(t,e,(n.get(r.value,"id")===r.activeTab?"selected-okmsg":"")+("sticker-constructor"===n.get(r.value,"id")&&o.state.showNewBubble?" new-okmsg":""))}function EZ(t,e,o,r){Ot(t,"select-tab",n.get(r.value,"id"))}function xZ(t,e,o,r){e.key=n.get(r.value,"label")}function IZ(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._p=n.propsSet(r);return xZ(0,a,0,o),n.mountComponent(r,a),BZ}function BZ(t,e){var o=e._o,r=e._p;xZ(0,r,0,e),n.updateComponent(o,r)}function MZ(t,e){return"sticker-constructor"!==n.get(e.value,"id")||e.bubbleHidden?IZ:null}function AZ(t,e,o,r){e.key=n.get(r.value,"label")}function TZ(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-bubble",me,t)),a=r.componentModel.input,i=o._w=n.insert(a,n.createComponent("msg-l10n",ae,t),"element"),s=o._x=n.propsSet(i,{slot:"element"});AZ(0,s,0,o),n.mountComponent(i,s);var u=n.insert(a,n.elem("div",bZ),"bubble");n.setClass(u,"tooltip-okmsg"),n.setAttribute(u,"slot","bubble");var c=o._z=n.appendChild(u,n.createComponent("msg-l10n",ae,t));return n.mountComponent(c,n.propsSet(c,{key:"create-own-sticker"})),n.mountComponent(r,n.propsSet(r,{yAxis:"top",xAxis:"left",infobubble:!0,tooltip:!0,hideDelay:0,forced:!0})),jZ}function jZ(t,e){var o=e._w,r=e._x;AZ(0,r,0,e),n.updateComponent(o,r)}function PZ(t,e){return"sticker-constructor"!==n.get(e.value,"id")||e.bubbleHidden?null:TZ}function RZ(t,e,o){var r=o._i=n.insert(e,n.elem("li",bZ)),a=n.createInjector(r);return wZ(r,o._j=n.obj(),t,o),o._k=n.addEvent(r,"click",EZ,t,o),o._l=n.mountBlock(t,a,MZ),o._r=n.mountBlock(t,a,PZ),LZ}function LZ(t,e){wZ(e._i,e._j,t,e),n.updateBlock(e._l),n.updateBlock(e._r)}function OZ(t,e,n,o){e.recents=o.recents,e.top=o.top,e.sets=o.sets,e.loadState=o.loadState,e.width=n.state.windowWidth}function zZ(t,e,o){var r=o._16=n.insert(e,n.createComponent("msg-assets-panel-stickers",lX,t));n.setPendingRef(o._1,"stickers",r);var a=o._17=n.propsSet(r,{class:"content-okmsg","data-l":"t,stickerPanel","data-tsid":"stickers"});return OZ(0,a,t,o),n.mountComponent(r,a),DZ}function DZ(t,e){var o=e._16,r=e._17;n.setPendingRef(e._1,"stickers",o),OZ(0,r,t,e),n.updateComponent(o,r)}function UZ(t,e,n,o){e.recent=o.recent}function NZ(t,e,o){var r=o._1a=n.insert(e,n.createComponent("msg-assets-panel-emoji",fW,t)),a=o._1b=n.propsSet(r,{class:"content-okmsg","data-l":"t,smilesPanel","data-tsid":"smiles"});return UZ(0,a,0,o),n.mountComponent(r,a),qZ}function qZ(t,e){var o=e._1a,r=e._1b;UZ(0,r,0,e),n.updateComponent(o,r)}function HZ(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-assets-panel-text",fZ,t));n.mountComponent(r,n.propsSet(r,{"data-l":"t,smilesPanel","data-tsid":"user-stickers"}))}function FZ(t,e,o){e.query="gifs"===n.get(o.props.query,"tab")?n.get(o.props.query,"query"):""}function VZ(t,e,o){var r=o._1i=n.insert(e,n.createComponent("msg-assets-panel-kikliko",nJ,t)),a=o._1j=n.propsSet(r,{"data-l":"t,gifs","data-tsid":"gifs"});return FZ(0,a,t),n.mountComponent(r,a),KZ}function KZ(t,e){var o=e._1i,r=e._1j;FZ(0,r,t),n.updateComponent(o,r)}function WZ(t,e,o){e.width=o.state.windowWidth,e.query="postcards"===n.get(o.props.query,"tab")?n.get(o.props.query,"query"):""}function GZ(t,e,o){var r=o._1m=n.insert(e,n.createComponent("msg-assets-panel-postcards",cG,t)),a=o._1n=n.propsSet(r,{class:"content-okmsg","data-l":"t,postcardsPanel","data-tsid":"postcards"});return WZ(0,a,t),n.mountComponent(r,a),YZ}function YZ(t,e){var o=e._1m,r=e._1n;WZ(0,r,t),n.updateComponent(o,r)}function XZ(t,e){return[zZ,NZ,HZ,VZ,GZ][e.chooseExpr]}function QZ(t,e){var o=n.insert(e,n.elemWithText("div",".",bZ));n.setClass(o,"font-okmsg"),n.setAttribute(o,"style","font-family: 'Lobster'")}function JZ(t,e){return e.userStickersEnabled?QZ:null}function $Z(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();yZ(t,e);var i=n.insert(r,n.elem("ul",bZ)),s=n.createInjector(i);return n.setClass(i,"tabs-okmsg"),n.setAttribute(i,"data-tsid","tabs"),n.setAttribute(i,"data-l","t,tabs"),e._f=n.mountIterator(t,s,SZ,RZ),e._13=n.mountBlock(t,r,XZ),e._1p=n.mountBlock(t,r,JZ),n.subscribeStore(t,["config","assets"]),n.finalizePendingRefs(t,a),ZZ}function ZZ(t,e){yZ(t,e),n.updateIterator(e._f),n.updateBlock(e._13),n.updateBlock(e._1p),n.finalizePendingRefs(t,e._1)}IZ.dispose=function(t){t._o=n.unmountComponent(t._o),t._p=null},TZ.dispose=function(t){t._w=n.unmountComponent(t._w),t._z=n.unmountComponent(t._z),t._u=n.unmountComponent(t._u),t._x=null},RZ.dispose=function(t){t._k=n.removeEvent("click",t._k),t._l=n.unmountBlock(t._l),t._r=n.unmountBlock(t._r),t._j=t._i=null},zZ.dispose=function(t){t._16=n.unmountComponent(t._16),t._17=null},NZ.dispose=function(t){t._1a=n.unmountComponent(t._1a),t._1b=null},HZ.dispose=function(t){t._1e=n.unmountComponent(t._1e)},VZ.dispose=function(t){t._1i=n.unmountComponent(t._1i),t._1j=null},GZ.dispose=function(t){t._1m=n.unmountComponent(t._1m),t._1n=null},$Z.dispose=function(t){t._f=n.unmountIterator(t._f),t._13=n.clearBlock(t._13),t._1p=n.clearBlock(t._1p)};var t1={__proto__:null,cssScope:bZ,default:$Z,init:function(t){var e=t.store.get().config,o=[kZ("stickers","live-stickers","live-stickers"),kZ("postcards","postcards","postcards"),kZ("smiles","smiles","smiles2")];(null==e?void 0:e.server["user-stickers-enabled"])&&!gZ&&(o.push(kZ("sticker-constructor","sticker-constructor","sticker-constructor")),i$("Lobster",s$(t,"msg-assets-panel/assets/fonts/bf2c7d8e38f749f5.ttf"))),t.setState({tabs:CZ(o,e)}),function(t){n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,hZ(t)];case 1:return e.sent()?(function(t){var e=t.state.tabs;if(!e.some((function(t){return"gifs"===t.id}))){var n=t.store.get().config;t.setState({tabs:CZ(e,n)})}}(t),[2]):[3,3];case 2:return e.sent(),[3,3];case 3:return function(t){var e=t.state.tabs;e.some((function(t){return"gifs"===t.id}))&&t.setState({tabs:e.filter((function(t){return"gifs"!==t.id}))})}(t),[2]}}))}))}(t)},showNewBubble:vZ,didMount:function(t){var e=function(){t.setState({windowWidth:window.innerWidth})};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}},didChange:function(t,e){var n,o=e.order,r=e.config;if(null===(n=null==o?void 0:o.current)||void 0===n?void 0:n.length){var a=t.state.tabs,i=o.current;t.setState({tabs:a.slice().filter((function(t){return i.indexOf(t.id)>-1})).sort((function(t,e){return i.indexOf(t.id)-i.indexOf(e.id)}))})}r&&t.setState({showNewBubble:vZ(t)})}},e1={width:2,gap:1,align:.5};var n1="e-2giyu0";var o1={__proto__:null,cssScope:n1,default:function(t){var e=t.componentView,o=n.appendChild(e,n.elem("canvas",n1));n.setRef(t,"background",o),n.setClass(o,"background-okmsg")},props:function(){return{wave:null,color:"#999"}},didRender:function(t){var e=t.props,n=e.wave;void 0===n&&(n=[]);var o=e.color,r=t.refs.background,a=e1.width+e1.gap,i=t.offsetWidth,s=t.offsetHeight,u=Math.floor(i/a),c=Math.max(0,n.length-u),p=yi(n=n.slice(c),u,e1);r.width=i*bi,r.height=s*bi;var l=r.getContext("2d");l.save(),l.scale(bi,bi),l.translate(i-n.length*a,0),Si(l,p,o,e1),l.restore()}},r1=function(t,e,n){if(this.encoderUrl=t,this.stream=e,this.context=n,this.input=this.context.createMediaStreamSource(this.stream),this.processor=this.context.createScriptProcessor(void 0,1,1),this.state="inactive",this.emitter=document.createDocumentFragment(),window.safari){var o=this.stream.getAudioTracks()[0].getSettings().sampleRate;this.sampleRate=o}else this.sampleRate=this.context.sampleRate};r1.prototype.start=function(){var t=this;"inactive"===this.state&&(this.state="preparing",this.encoder=function(t){/^\/\//.test(t)&&(t=location.protocol+t);/^\w+:/.test(t)||(t=location.origin+t);var e=new Blob(['importScripts("'+t+'");']),n=URL.createObjectURL(e),o=new Worker(n);return URL.revokeObjectURL(n),o}(this.encoderUrl),this.encoder.postMessage(["setup",this.sampleRate]),this.encoder.addEventListener("message",this),this.processor.addEventListener("audioprocess",this),this.input.connect(this.processor),this.processor.connect(this.context.destination),this.emitter.dispatchEvent(new MessageEvent("start")),this.encoder.onerror=function(){t.emitter.dispatchEvent(new MessageEvent("error")),t.dispose()})},r1.prototype.stop=function(){"inactive"!==this.state&&(this.requestData(),this.state="inactive")},r1.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.emitter.dispatchEvent(new MessageEvent("pause")))},r1.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.emitter.dispatchEvent(new MessageEvent("resume")))},r1.prototype.requestData=function(){"inactive"!==this.state&&"preparing"!==this.state&&this.encoder.postMessage(["dump"])},r1.prototype.addEventListener=function(t,e){this.emitter.addEventListener(t,e)},r1.prototype.removeEventListener=function(t,e){this.emitter.removeEventListener(t,e)},r1.prototype.dispatchEvent=function(t){this.emitter.dispatchEvent(t)},r1.prototype.handleEvent=function(t){if("audioprocess"===t.type){if("recording"===this.state||"preparing"===this.state){var e=t.inputBuffer.getChannelData(0);e[0]&&"preparing"===this.state&&(this.dispatchEvent(new MessageEvent("record",{data:t.inputBuffer.numberOfChannels})),this.state="recording"),this.encoder&&"recording"===this.state&&this.encoder.postMessage(["encode",e])}}else"message"===t.type&&"dump"===t.data[0]&&this._handleDump(t.data[1])},r1.prototype._handleDump=function(t){var e=new MessageEvent("dataavailable",{data:t});this.dispatchEvent(e),this.dispose()},r1.prototype.dispose=function(){"inactive"===this.state&&(this.dispatchEvent(new MessageEvent("stop")),this.processor.removeEventListener("audioprocess",this),this.encoder.removeEventListener("message",this),this.encoder.terminate(),this.encoder=null)};var a1=function(t){this.encoderUrl=t};a1.prototype.getAudioStream=function(){return navigator.mediaDevices.getUserMedia({channelCount:1,audio:!0,noiseSuppression:!0,echoCancellation:!0})},a1.prototype.recordStart=function(){var t=this;return this._process=this.getAudioStream().then((function(e){var n=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive"}),o=new r1(t.encoderUrl,e,n),r=n.createAnalyser(),a=o.input,i=o.processor;return r.smoothingTimeConstant=.3,r.fftSize=512,a.connect(r),r.connect(i),o.start(),{stream:e,mediaRecorder:o,audioContext:n,scriptProcessor:i,analyser:r,input:a}})),this._process},a1.prototype.recordStop=function(){return this._process?this._process.then((function(t){var e=t.stream,n=t.mediaRecorder,o=t.scriptProcessor,r=t.analyser,a=t.input,i=t.audioContext;return"inactive"!==n.state&&(n.stop(),e.getTracks().forEach((function(t){return t.stop()})),o.disconnect(i.destination),r.disconnect(o),a.disconnect(r),i.close()),{stream:e,mediaRecorder:n,scriptProcessor:o,analyser:r,input:a,audioContext:i}})):Promise.resolve()};var i1=t.toUrl("./mp3-encoder_7041b9c2.js"),s1=.1,u1={getStatus:function(){return this.state.status},setFocus:function(){var t=this.refs.mainButton;t&&t.focus()},resize:function(){var t=this.refs.wave;t&&t.resize()},cancel:function(){"recording"===this.state.status?(this.setState({status:"canceled"}),this._audio.recordStop()):(Zt(this,"cancel"),l1(this))}};function c1(t){var e=1;return t.reduce((function(t,n){return n>0&&e++,t+n/255}),0)/(.7*e)}function p1(t){var e=t.state.status;"preview"===e?function(t){var e=t.refs.audio;t.setState({status:"playing"}),1!==t.state.progress&&t.state.progress||(e.currentTime=0);var n=function(){g1(t),"playing"===t.state.status&&requestAnimationFrame(n)};n(),e.play()}(t):"recording"!==e&&"playing"!==e||_1(t)}function l1(t){t.setState({chunks:[],wave:[],status:"idle",duration:0,progress:0,currentTime:0});var e=t.refs.audio,n=e&&e.querySelector("source");n&&e.removeChild(n),e.pause()}function m1(t,e){t.setState({status:"error"}),Zt(t,"error",{error:e})}function d1(t,e){var n=t.refs.audio,o=document.createElement("source");n.appendChild(o),o.src=e,o.type="audio/mpeg",n.load()}function _1(t){"recording"===t.state.status?t._audio.recordStop():"playing"===t.state.status&&t.refs.audio.pause(),te(t,"record-stop"),t.setState({status:"preview"})}function f1(t){clearTimeout(t._timer);var e=Date.now();t._timer=window.setTimeout((function(){t.setState({duration:t.state.duration+Date.now()-e}),f1(t)}),1e3)}function g1(t){var e=t.refs.audio,n=e.duration?e.currentTime/e.duration:0;t.setState({progress:n,currentTime:1e3*e.currentTime}),1===n&&_1(t)}function v1(t){t.cancel()}function h1(t,e){var n=t.refs.audio;"recording"!==t.state.status&&isFinite(n.duration)&&(n.currentTime=e.detail.position*n.duration,g1(t))}var C1="e-xpuvuj";function k1(t,e){e.isStatic="preview"===t.state.status||"playing"===t.state.status,e.ifExpr="recording"===t.state.status,e.ifExpr_1="playing"===t.state.status}function b1(t,e,n){e.title="playing"===n.state.status?"Пауза":"recording"===n.state.status?"Стоп":"Воспроизвести"}function y1(t,e,n,o){e.icon=o.ifExpr_1?"pause":o.ifExpr?"stop":"play"}function S1(t,e,n){e.wave=n.state.wave}function w1(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-audio-wave-live",o1,t)),a=o._p=n.propsSet(r);return S1(0,a,t),n.mountComponent(r,a),E1}function E1(t,e){var o=e._o,r=e._p;S1(0,r,t),n.updateComponent(o,r)}function x1(t,e,n){e.wave=n.state.wave,e.progress=n.state.progress}function I1(t,e,o){var r=o._s=n.insert(e,n.createComponent("msg-audio-wave",Ui,t));n.setPendingRef(o._1,"wave",r);var a=o._t=n.propsSet(r);return x1(0,a,t),o._u=n.addEvent(r,"position-change",h1,t,o),n.mountComponent(r,a),B1}function B1(t,e){var o=e._s,r=e._t;n.setPendingRef(e._1,"wave",o),x1(0,r,t),n.updateComponent(o,r)}function M1(t){return"recording"===t.state.status?w1:I1}function A1(t,e,n,o){e.duration=o.isStatic&&n.state.currentTime||n.state.duration}function T1(t,e,o){var r=o._9=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input;o._b=n.addEvent(r,"click",v1,t,o);var i=o._c=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{size:"medium",icon:"clear"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",size:"big",type:"button",title:"Отмена"}));var s=o._f=n.insert(e,n.createComponent("button",fe,t)),u=s.componentModel.input;n.setPendingRef(o._1,"mainButton",s);var c=o._g=n.propsSet(s,{shape:"circle",class:"secondary-okmsg",size:"big",type:"button"});b1(0,c,t),o._h=n.addEvent(s,"click",p1,t,o);var p=o._i=n.insert(u,n.createComponent("msg-icon",xe,t),""),l=o._j=n.propsSet(p,{size:"medium"});y1(0,l,0,o),n.mountComponent(p,l),n.mountComponent(s,c),o._l=n.mountBlock(t,e,M1);var m=o._v=n.insert(e,n.createComponent("msg-duration",qi,t)),d=o._w=n.propsSet(m);return A1(0,d,t,o),n.mountComponent(m,d),j1}function j1(t,e){var o=e._f,r=e._g,a=e._i,i=e._j,s=e._v,u=e._w;n.setPendingRef(e._1,"mainButton",o),b1(0,r,t),y1(0,i,0,e),n.updateComponent(a,i),n.updateComponent(o,r),n.updateBlock(e._l),A1(0,u,t,e),n.updateComponent(s,u)}function P1(t){return"idle"!==t.state.status?T1:null}function R1(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();k1(t,e),e._6=n.mountBlock(t,r,P1);var i=n.insert(r,n.elem("audio",C1));return n.setRef(t,"audio",i),n.insert(r,n.createSlot(t,"right",C1)),e._10=n.mountSlot(t,"right"),n.finalizePendingRefs(t,a),L1}function L1(t,e){k1(t,e),n.updateBlock(e._6),n.finalizePendingRefs(t,e._1)}w1.dispose=function(t){t._o=n.unmountComponent(t._o),t._p=null},I1.dispose=function(t){t._u=n.removeEvent("position-change",t._u),t._s=n.unmountComponent(t._s),t._t=null},T1.dispose=function(t){t._b=n.removeEvent("click",t._b),t._c=n.unmountComponent(t._c),t._9=n.unmountComponent(t._9),t._h=n.removeEvent("click",t._h),t._i=n.unmountComponent(t._i),t._f=n.unmountComponent(t._f),t._l=n.unmountBlock(t._l),t._v=n.unmountComponent(t._v),t._g=t._j=t._w=null},R1.dispose=function(t){t._6=n.clearBlock(t._6),t._10=n.unmountSlot(t._10)};var O1={__proto__:null,cssScope:C1,default:R1,extend:u1,props:function(){return{recording:!1,data:null}},state:function(){return{status:"idle"}},init:function(t){t._audio=new a1(i1),t.resizeHandler=o.throttle((function(){var e=t.refs.wave;e&&"idle"!==t.state.status&&e.resize()}),100),t._recorderEventHandler=function(e){if("dataavailable"===e.type){if(clearTimeout(t._timer),"canceled"===t.state.status)return Zt(t,"cancel"),void l1(t);var n=function(t,e){var n=Math.floor(t.length/e),o=t.slice(),r=[];if(!n)return t;for(;o.length;){var a=r.length===e-1?o.length:n;r.push(o.splice(0,a).reduce((function(t,e){return t+e}),0)/a)}return r}(t.state.wave,80),o=URL.createObjectURL(e.data);Zt(t,"ready",{audioBlob:e.data,wave:n,duration:t.state.duration,url:o}),d1(t,o),t.setState({wave:n,chunks:null})}else"record"===e.type&&(OK.logger.success("messagesLayer","tt-voice-channels","".concat(e.data)),Zt(t,"start"),f1(t))},window.addEventListener("resize",t.resizeHandler)},willUnmount:function(t){window.removeEventListener("resize",t.resizeHandler),t._audio.recordStop()},didChange:function(t,e){var n=e.recording,o=e.data;n&&(n.current?t._audio.recordStart().then((function(e){return function(t,e){var n=e.mediaRecorder,o=e.scriptProcessor,r=e.analyser;l1(t),n.addEventListener("dataavailable",t._recorderEventHandler),n.addEventListener("record",t._recorderEventHandler),n.addEventListener("error",(function(){return m1(t)})),"preparing"===n.state&&(t._deviceTimeout=window.setTimeout((function(){Zt(t,"error",{error:"microphone_timeout"}),l1(t)}),5e3));o.onaudioprocess=function(){"recording"===n.state&&(!function(t,e){var n=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(n),t.setState({wave:t.state.wave.concat(Math.max(c1(n),s1))})}(t,r),t._deviceTimeout&&(clearTimeout(t._deviceTimeout),t._deviceTimeout=null))},t.setState({status:"recording"})}(t,e)})).catch((function(e){return m1(t,e)})):t._audio.recordStop().then((function(){t._deviceTimeout&&(clearTimeout(t._deviceTimeout),t._deviceTimeout=null)})).catch((function(e){return m1(t,e)}))),o&&(o.current&&"idle"===t.state.status&&(requestAnimationFrame((function(){return d1(t,o.current.url)})),t.setState({duration:o.current.duration,wave:o.current.wave,status:"preview"})),!o.current&&o.prev&&t.refs.audio&&l1(t))},onStateChange:p1,onCancel:v1,onStop:function(t){_1(t)},onWaveOffsetChange:h1},z1={CONGRATS:["TEXT_CONGRATS","REPLY_TEXT_CONGRATS","STICKER_CONGRATS","MUSIC_CONGRATS"],STICKERS:["ACTION_STICKERS","REPLY_ACTION_STICKERS"],PHRASES:["PHRASES"]};function D1(t,e){var n=function(t){return Object.keys(z1).find((function(e){return z1[e]===t}))}(e);return n?t[n]:null}var U1=".js-msg-send-action-congrats-holder",N1="data-next-type-url",q1="data-default-url",H1=/st\.types=[a-zA-z0-9%]+/,F1="%3B";function V1(t){var e=t.state.popup;e&&e.classList.remove("__active")}var K1={resetTabs:function(){var t=document.querySelectorAll(".js-tab["+q1+"]");Array.from(t).forEach((function(t){t.setAttribute(N1,t.getAttribute(q1)),t.removeAttribute(q1)}))}},W1="elecjqp";function G1(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("span",W1));n.setRef(t,"hook",r),n.setClass(r,"js-ta-send-action-congrats");var a=n.appendChild(r,n.elem("span",W1));n.setRef(t,"button",a),n.appendChild(a,n.createSlot(t,"",W1)),e._4=n.mountSlot(t,"")}G1.dispose=function(t){t._4=n.unmountSlot(t._4)};var Y1={__proto__:null,cssScope:W1,default:G1,props:function(){return{url:"",section:"",defaultSection:"",friendId:"",active:!1}},state:function(){return{popup:null}},didChange:function(e,n){var o=n.active,r=n.friendId;o&&(o.current&&!o.prev?function(t){var e=t.state.popup;if(e){!function(t){var e=t.refs.button,n=(o=e,r=o.getBoundingClientRect(),{left:r.left+window.pageXOffset,top:r.top+window.pageYOffset});var o,r;t.state.popup.setAttribute("style","left: ".concat(n.left,"px; bottom: -").concat(n.top,"px;"))}(t),e.classList.add("__active");var n=t.props.section,o=(r=function(t){return Object.keys(z1).find((function(e){if(e===t||z1[e].includes(t))return e}))}(n),r?document.querySelector(".js-send-action-tab-id-".concat(r)):null);o&&(!function(t,e){var n=t.props.section;if(n){var o=e.getAttribute("href"),r=o.match(H1);if(null!==r){var a=r[0].split("=")[1].split(F1);if(!a.includes(n)){var i=a.map((function(t){switch(t){case"TEXT_CONGRATS":return"REPLY_TEXT_CONGRATS"===n?"REPLY_TEXT_CONGRATS":t;case"ACTION_STICKERS":return"REPLY_ACTION_STICKERS"===n?"REPLY_ACTION_STICKERS":t;default:return t}})).join(F1);e.getAttribute(q1)||e.setAttribute(q1,o),o=o.replace(H1,"st.types="+i),e.setAttribute(N1,o)}}}}(t,o),o.click(),Zt(t,"reset-congrats-tab"))}var r}(e):!o.current&&o.prev&&V1(e)),r&&r.current!==r.prev&&function(e){if(e.store.get().isTouchDevice)return;Promise.all([new Promise((function(e,n){t(["OK/capture"],e,n)})),new Promise((function(e,n){t(["OK/utils/vanilla"],e,n)}))]).then((function(t){var n=t[0];t[1].ajax({url:"/dk",data:{cmd:"SendActionCongratsMenu","st.friendId":e.props.friendId,"st.isDarkTheme":Ai(e)}}).then((function(t){var o=document.querySelector(".js-msg-send-action-congrats-holder");if(!o){(o=document.createElement("div")).classList.add("js-msg-send-action-congrats-holder","msg-send-action-congrats-holder");var r=document.getElementById("hook_Block_FeedbackLayer");null==r||r.appendChild(o)}o.innerHTML=t.response;var a=document.querySelector("".concat(U1," .comments_smiles_popup"));n.activate(a),e.setState({popup:a}),e.props.section||Zt(e,"set-default-congrats-tab")}))}))}(e)},willUnmount:function(e){V1(e);var n=e.state.popup,o=document.querySelector(U1);n&&new Promise((function(e,n){t(["OK/capture"],e,n)})).then((function(t){t.deactivate(n)})),o&&o.parentNode.removeChild(o)},extend:K1},X1="mention-pref",Q1=function(){try{return JSON.parse(localStorage.getItem(X1)||"{}")}catch(t){}return{}}();function J1(t){return{id:t.id,name:Z1(t),ownName:$1(t),link:t0(t),preference:Q1[t.id],contact:t}}function $1(t){var e=t.names.find((function(t){return"OK"===t.type||"TT"===t.type}));return e?e.name:""}function Z1(t){var e=t.names.find((function(t){return"CUSTOM"===t.type}));return e?e.name:$1(t)}function t0(t){return t.link?"@".concat(Wn(t.link)):""}function e0(t,e){var n,o,r=e.props.mention.contact;n=r.id,(o=t)?Q1[n]=o:delete Q1[n],fr(X1,JSON.stringify(Q1))}function n0(t,e){t=t.toLowerCase();for(var n=0;n<e.length;n++)if(t.includes(e[n]))return!0;return!1}var o0=[0],r0=[];function a0(){r0.push(o0),o0=[0]}function i0(){o0=r0.pop()}function s0(t,e){e.user=n.get(t.props.mention,"contact")}function u0(t,e,o,r){e.url=Wt(0,r.user,"small"),e.id=n.get(r.user,"id"),e.caption=n.get(o.props.mention,"name")}function c0(t,e,o){e.class="token-okmsg"+(o.state.own?" own-okmsg":"")+(n.get(o.props.mention,"preference")===(o.state.own?3:2)?" active-okmsg":""),e.highlights=o.props.highlights}function p0(t,e,n){e0(t.state.own?3:2,t)}function l0(t,e){var o=t.componentView;a0(),s0(t,e);var r=e._3=n.appendChild(o,n.createComponent("msg-avatar",Hp,t)),a=e._4=n.propsSet(r,{size:"small"});u0(0,a,t,e),n.mountComponent(r,a);var i=e._5=n.appendChild(o,n.createComponent("msg-parsed-text",ii,t)),s=i.componentModel.input,u=e._6=n.propsSet(i);return c0(0,u,t),e._7=n.addEvent(i,"click",p0,t,e),e._8=n.insert(s,n.text(t.state.name)),n.mountComponent(i,u),i0(),m0}function m0(t,e){var o=e._3,r=e._4,a=e._5,i=e._6;a0(),s0(t,e),u0(0,r,t,e),n.updateComponent(o,r),c0(0,i,t),o0[0]|=n.updateText(e._8,t.state.name),n.updateIncomingSlot(a,"",o0[0]),n.updateComponent(a,i),i0()}l0.dispose=function(t){a0(),t._3=n.unmountComponent(t._3),t._7=n.removeEvent("click",t._7),t._5=n.unmountComponent(t._5),i0()};var d0={__proto__:null,cssScope:"eac5wie",default:l0,didChange:function(t,e){if(e.mention||e.highlights){var n=t.props,o=n.mention,r=n.highlights;(null==r?void 0:r.length)&&function(t,e){return t.name!==t.ownName&&!n0(t.name,e)&&n0(t.ownName,e)}(o,r)?t.setState({name:o.ownName,own:!0}):t.setState({name:o.name,own:!1})}},select:e0};var _0={"а":["a"],"б":["b"],"в":["v"],"г":["g"],"д":["d"],"е":["e"],"ё":["yo","e"],"ж":["zh","g"],"з":["z"],"и":["i","y"],"й":["j","y","i"],"к":["k"],"л":["l"],"м":["m"],"н":["n"],"о":["o"],"п":["p"],"р":["r"],"с":["s"],"т":["t"],"у":["u"],"ф":["f"],"х":["h","x","kh"],"ц":["cz","c","ts"],"ч":["ch","c"],"ш":["sh"],"щ":["shh","sch"],"ъ":["''"],"ы":["y","i"],"ь":["'"],"э":["e"],"ю":["yu","u","ju"],"я":["ya"],"ий":["y"],"кс":["x"],"ку":["q"],",":[","],".":["."],";":[";"],"'":["'"],"[":["]"],"]":["]"],0:["0"],1:["1"],2:["2"],3:["3"],4:["4"],5:["5"],6:["6"],7:["7"],8:["8"],9:["9"]},f0=Object.assign({},_0,Im(_0));function g0(t){t=t.toLowerCase();for(var e=[],n=[],o=[],r=t.length,a=0;a<3;a++)e[a]=[],n[a]=0,o[a]=0;for(var i=0;i<r;i++)for(var s=0;s<3;s++){var u=t.substr(i,s+1);if(f0[u]&&u.length===s+1)e[s].push(f0[u]),n[s]+=u.length;else for(var c=1;c<=s;c++)if(e[s-c][n[s]]){e[s].push(e[s-c][n[s]]),n[s]+=n[s-c]-n[s],o[s]++;break}}return e.filter((function(t,e){return o[e]!==t.length}))}var v0={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"Х","]":"ъ","}":"Ъ","|":"/","`":"ё","~":"Ё",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"Ж","'":"э",'"':"Э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"Б",".":"ю",">":"Ю","@":'"',"#":"№",$:";","^":":","&":"?",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",0:"0"},h0=Object.assign({},v0,Im(v0));function C0(t){return(t||"").trim().toLowerCase()}var k0=/[^0-9A-Za-zА-Яа-яЁё><;',><.:"}{[\]]/g,b0=/ё/g;function y0(t,e){for(var n=0,o=[],r=0;r<t.length&&t.length<=e.length;r++){for(var a=t[r],i=0;i<a.length;i++){var s=a[i],u=e.substr(n,s.length);if(u===s){o.push(u),n+=s.length;break}i===a.length-1&&(o.length=0)}if(!o.length)break}return o}function S0(t,e){var n=[];if(!Array.isArray(t))return e.startsWith(t)?t:"";for(var o=0;o<t.length;o++){var r=t[o];if(n.length===e.length)break;if(n.length=0,(n=y0(r,e)).length===r.length)break}return n.join("")}var w0=function(t){this.query="",this.update(t),this.queryWords=[],this.queryMappedWords=[],this.queryEWords=[],this.queryTransliteratedWords=[],this.queryTransliteratedMappedWords=[]},E0={isEmpty:{configurable:!0}};function x0(){return{extend:{getSelected:function(t){var e=this.state,n=e.active,o=e.exactMatch;return t&&o?null:n},selectNext:function(){B0(this,1)},selectPrevious:function(){B0(this,-1)}}}}function I0(t,e,o){var r=function(t,e,o){var r=t.model.indexOf(e);if(-1!==r)return o-n.getLength(t.model.slice(0,r));return-1}(t,o,e);return r>0?o.value.slice(1,r):null}function B0(t,e){var n=t.state,o=n.list,r=n.active,a=o.items.length,i=(o.items.indexOf(r)+e+a)%a,s=o.items[i];s!==r&&(t.setState({active:s}),function(t){var e=t.state,n=e.active,o=e.list,r=t.refs.scroller;n&&r&&!o.inViewport(n,r,.5)&&o.scrollTo(n,r,.3,{animate:!0})}(t))}E0.isEmpty.get=function(){return!this.query},w0.prototype.findMatches=function(t,e,n){for(var o=[],r=0;r<t.length;r++)for(var a=0;a<e.length;a++){var i=S0(t[r],e[a]);if(i){o.push(i),n-=.01*a;break}if(a===e.length-1)return null}return{matches:o,weight:n}},w0.prototype.update=function(t){var e=this;return void 0===t&&(t=""),this.query!==t&&(this.query=C0(t),this.queryWords.length=0,this.queryMappedWords.length=0,this.queryEWords.length=0,this.queryTransliteratedWords.length=0,this.queryTransliteratedMappedWords.length=0,this.query.split(k0).filter(Boolean).forEach((function(t){var n=function(t){if(!t)return t;var e=[];return t.split("").forEach((function(t){e.push(h0[t])})),e.join("")}(t).toLowerCase();e.queryWords.push(t),e.queryEWords.push(t.replace(b0,"е")),e.queryTransliteratedWords.push(g0(t)),e.query.length>2&&(e.queryTransliteratedMappedWords.push(g0(n)),e.queryMappedWords.push(n))})),!0)},w0.prototype.applySearch=function(t){if(this.isEmpty)return[];var e=C0(t).split(k0).filter(Boolean).map((function(t){return t.toLowerCase()})),n=e.map((function(t){return t.replace(b0,"е")}));return this.findMatches(this.queryWords,e,1)||this.findMatches(this.queryEWords,n,.9)||this.findMatches(this.queryTransliteratedWords,e,.8)||this.findMatches(this.queryMappedWords,e,.7)||this.findMatches(this.queryTransliteratedMappedWords,e,.6)||{}},w0.prototype.scoringSort=function(t,e){var n=this,o=t.map((function(t,o){return{value:t,index:o,scoring:n.applySearch(e(t))}})).filter((function(t){return t.scoring&&t.scoring.matches&&t.scoring.matches.length})).sort((function(t,n){var o=n.scoring.weight-t.scoring.weight,r=0===o?e(t.value).localeCompare(e(n.value)):0;return o||r||t.index-n.index}));return{result:o,sortedList:o.map((function(t){return t.value})),matchList:l(o.reduce((function(t,e){return t.concat(e.scoring.matches)}),[]))}},Object.defineProperties(w0.prototype,E0);var M0=[x0()];function A0(t){t.state.list.handleScroll(t.refs.scroller)}function T0(t,e){te(e,"submit",t)}function j0(t){var e,n,o,r=[];if("CHANNEL"===t.type)(null===(e=t.members)||void 0===e?void 0:e.items)&&t.members.items.forEach((function(t){P0(t)&&r.push(J1(t))}));else{var a=[],s=new i;t.participants.forEach((function(t){var e=t.user;P0(e)&&(s.add(e.id),a.push(J1(e)))})),null===(o=null===(n=t.members)||void 0===n?void 0:n.items)||void 0===o||o.forEach((function(t){!s.has(t.id)&&P0(t)&&a.push(J1(t))})),r=r.concat(a)}return r}function P0(t){return!t.current&&!t.stub&&!t.deleted}function R0(t){var e=function(t,e){var n=t.state,o=n.query,r=n.participants,a=void 0===r?[]:r,i=n.ownContacts,s=n.searchOwn;return o.update(e),o.isEmpty?{items:s?i:a,highlights:[]}:L0(o,s?i:a)}(t,t.props.prefix),n=e.items,o=e.highlights;t.setState({local:n,highlights:o}),function(t){var e=t.state,n=e.local,o=e.highlights;t.setState({highlights:o}),t.state.list.update(n,t.refs.scroller)}(t)}function L0(t,e){var n=[],o=e.filter((function(e){var o,r,a,i=t.applySearch((a="".concat((r=e).link.slice(1)," ").concat(r.name),r.name!==r.ownName&&(a+=" ".concat(r.ownName)),a));return!(!i.weight||!(null===(o=i.matches)||void 0===o?void 0:o.length))&&(n=n.concat(i.matches),!0)}));return{items:o,highlights:n}}var O0="ewzj63u";function z0(t,e){e.hasResults=n.get(t.state.scrollList,"items","length")>0,e.value=void 0}function D0(t,e,o,r){n.updateClass(t,e,"mentions-okmsg scroller-okmsg custom-scrollbar-okmsg"+(r.hasResults?"":" __empty-okmsg"))}function U0(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function N0(t){return n.get(t.state.scrollList,"items")}function q0(t,e){return n.get(e.value,"value","id")}function H0(t,e,o,r){e.mention=n.get(r.value,"value"),e.highlights=o.state.highlights,e.class=n.get(r.value,"value")===o.state.active?"__active-okmsg":""}function F0(t,e,n,o){t.setState({active:o.value.value})}function V0(t,e,o,r){T0(n.get(r.value,"value"),t)}function K0(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-mention-item",d0,t)),a=o._d=n.propsSet(r);return H0(0,a,t,o),o._e=n.addEvent(r,"mouseenter",F0,t,o),o._f=n.addEvent(r,"click",V0,t,o),n.mountComponent(r,a),W0}function W0(t,e){var o=e._c,r=e._d;H0(0,r,t,e),n.updateComponent(o,r)}function G0(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{class:"not-found-okmsg",key:"not-found"}))}function Y0(t){return 0===n.get(t.state.scrollList,"length")?G0:null}function X0(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px;")}function Q0(t,e){var o=t.componentView;z0(t,e);var r=e._4=n.appendChild(o,n.elem("div",O0)),a=n.createInjector(r);return n.setRef(t,"scroller",r),D0(r,e._5=n.obj(),0,e),e._6=n.addEvent(r,"scroll",A0,t,e),U0(e._7=n.insert(a,n.elem("div",O0)),e._8=n.obj(),t),e._9=n.mountKeyIterator(t,a,N0,q0,K0),e._h=n.mountBlock(t,a,Y0),X0(e._m=n.insert(a,n.elem("div",O0)),e._n=n.obj(),t),J0}function J0(t,e){z0(t,e),D0(e._4,e._5,0,e),U0(e._7,e._8,t),n.updateKeyIterator(e._9),n.updateBlock(e._h),X0(e._m,e._n,t)}K0.dispose=function(t){t._e=n.removeEvent("mouseenter",t._e),t._f=n.removeEvent("click",t._f),t._c=n.unmountComponent(t._c),t._d=null},G0.dispose=function(t){t._k=n.unmountComponent(t._k)},Q0.dispose=function(t){t._6=n.removeEvent("scroll",t._6),t._9=n.unmountKeyIterator(t._9),t._h=n.unmountBlock(t._h)};var $0={__proto__:null,cssScope:O0,default:Q0,plugins:M0,state:function(t){return{query:new w0,loading:0,list:new YL({itemHeight:44,onUpdate:function(e){var n,o=t.state.active;if(o){var r=e.items.find((function(t){return t.value.id===o.id}));o=r?r.value:null}o||(o=null===(n=e.items[0])||void 0===n?void 0:n.value),t.setState({scrollList:e,active:o})}})}},init:function(t){var e=t.store.get(),o=e.chatList,r=function(t,e){var o=new a,r=function(t){return!t.user.current};return e.forEach((function(t){if("DIALOG"===t.type){var e=t.participants.find(r);e&&o.set(e.user.id,t.lastEventTime)}})),n.__spreadArray([],t,!0).sort((function(t,e){var n,r,a=o.get(t.id)||0,i=o.get(e.id)||0;if(0===a&&0===i){var s=(null===(n=t.presence)||void 0===n?void 0:n.seen)||0;return((null===(r=e.presence)||void 0===r?void 0:r.seen)||0)-s}return i-a}))}(function(t){return p(t).filter((function(t){return t.own&&!t.current&&!t.deleted}))}(e.contacts),o).filter(P0).map(J1);t.setState({ownContacts:r})},didChange:function(t,e){var n=e.chat,o=e.prefix;if(n){var r=!!t.state.searchOwn;n.current&&"DIALOG"!==n.current.type||(r=!0),t.setState({searchOwn:r,participants:n.current?j0(n.current):[]})}(n||o)&&null!==(null==o?void 0:o.current)&&R0(t)},willRender:function(t){!function(t){var e=t.state.active,n=!1;if(e){var o=t.props.prefix;n=!!o&&(String(e.id)===o||e.link===o)}t.setState({exactMatch:n})}(t)},onScroll:A0,pickMention:T0,submit:function(t,e){var n=t.state.active;n&&te(t,"submit",n)},toggleSearchContext:function(t){t.setState({searchOwn:!t.state.searchOwn}),R0(t)}},Z0=[x0()];function t2(t){t.state.list.handleScroll(t.refs.scroller)}function e2(t){var e=t.state.active;e&&te(t,"submit",e)}var n2="ewjt37z",o2=[0],r2=[];function a2(){r2.push(o2),o2=[0]}function i2(){o2=r2.pop()}function s2(t,e){e.value=void 0}function u2(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function c2(t){return n.get(t.state.scrollList,"items")}function p2(t,e){return n.get(e.value,"value","name")+n.get(e.value,"value","bot","id")}function l2(t,e,o,r){n.updateClass(t,e,"row-okmsg"+(n.get(r.value,"value")===o.state.active?" __active-okmsg":""))}function m2(t,e,n,o){t.setState({active:o.value.value})}function d2(t,e,o,r){e.url=Wt(0,n.get(r.value,"value","bot"),"micro"),e.id=n.get(r.value,"value","bot","id"),e.caption=n.get(r.value,"value","bot","name")}function _2(t,e,o){var r=n.insert(e,n.elem("div",n2));return n.setClass(r,"mention-okmsg"),n.appendChild(r,n.text("@")),o._o=n.appendChild(r,n.text(n.get(o.value,"value","shortLink"))),f2}function f2(t,e){n.updateText(e._o,n.get(e.value,"value","shortLink"))}function g2(t){return t.props.shortLink?_2:null}function v2(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-avatar",Hp,t)),a=o._i=n.propsSet(r,{size:"micro"});return d2(0,a,0,o),n.mountComponent(r,a),o._j=n.mountBlock(t,e,g2),h2}function h2(t,e){var o=e._h,r=e._i;d2(0,r,0,e),n.updateComponent(o,r),n.updateBlock(e._j)}function C2(t){return"DIALOG"!==n.get(t.props.chat,"type")?v2:null}function k2(t,e,o){var r=o._a=n.insert(e,n.elem("div",n2)),a=n.createInjector(r);l2(r,o._b=n.obj(),t,o),o._c=n.addEvent(r,"mouseenter",m2,t,o),o._d=n.addEvent(r,"click",e2,t,o),o._e=n.mountBlock(t,a,C2);var i=o._q=n.insert(a,n.createComponent("msg-parsed-text",ii,t)),s=i.componentModel.input;o._s=n.insert(s,n.text(n.get(o.value,"value","name"))),n.mountComponent(i,n.propsSet(i,{class:"name-okmsg"}));var u=n.insert(a,n.elem("div",n2));return n.setClass(u,"desc-okmsg"),o._v=n.appendChild(u,n.text(n.get(o.value,"value","description"))),b2}function b2(t,e){l2(e._a,e._b,t,e),n.updateBlock(e._e),o2[0]|=n.updateText(e._s,n.get(e.value,"value","name")),n.updateIncomingSlot(e._q,"",o2[0]),n.updateText(e._v,n.get(e.value,"value","description"))}function y2(t,e,o){var r=n.insert(e,n.elem("div",n2));n.setClass(r,"row-okmsg");var a=o._11=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{class:"not-found-okmsg",key:"not-found"}))}function S2(t){return 0===n.get(t.state.scrollList,"items","length")?y2:null}function w2(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px;")}function E2(t,e){var o=t.componentView;a2(),s2(0,e);var r=n.appendChild(o,n.elem("div",n2)),a=n.createInjector(r);return n.setRef(t,"scroller",r),n.setClass(r,"scroller-okmsg custom-scrollbar-okmsg"),e._4=n.addEvent(r,"scroll",t2,t,e),u2(e._5=n.insert(a,n.elem("div",n2)),e._6=n.obj(),t),e._7=n.mountKeyIterator(t,a,c2,p2,k2),e._x=n.mountBlock(t,a,S2),w2(e._13=n.insert(a,n.elem("div",n2)),e._14=n.obj(),t),i2(),x2}function x2(t,e){a2(),s2(0,e),u2(e._5,e._6,t),n.updateKeyIterator(e._7),n.updateBlock(e._x),w2(e._13,e._14,t),i2()}_2.dispose=function(t){t._o=null},v2.dispose=function(t){t._h=n.unmountComponent(t._h),t._j=n.unmountBlock(t._j),t._i=null},k2.dispose=function(t){t._c=n.removeEvent("mouseenter",t._c),t._d=n.removeEvent("click",t._d),t._e=n.unmountBlock(t._e),t._q=n.unmountComponent(t._q),t._b=t._s=t._v=t._a=null},y2.dispose=function(t){t._11=n.unmountComponent(t._11)},E2.dispose=function(t){a2(),t._4=n.removeEvent("scroll",t._4),t._7=n.unmountKeyIterator(t._7),t._x=n.unmountBlock(t._x),i2()};var I2={__proto__:null,cssScope:n2,default:E2,plugins:Z0,state:function(t){return{list:new YL({itemHeight:36,onUpdate:function(e){var n,o=t.state.active;o&&e.items.some((function(t){return t.value===o}))||(o=null===(n=e.items[0])||void 0===n?void 0:n.value),t.setState({scrollList:e,active:o})}})}},didChange:function(t,e){var n=e.chat,o=e.prefix,r=e.bot;(n||o||r)&&function(t){var e=t.props,n=e.chat,o=e.prefix,r=e.bot,a=[];(null==n?void 0:n.commands)&&(a=n.commands.filter((function(t){if(!o||t.name.startsWith(o))return!r||(t.bot.id===r||(t.bot.link||"").endsWith("/".concat(r)))})));t.state.list.update(a,t.refs.scroller)}(t)},onScroll:t2,submit:e2};var B2={close:function(){j2(this)}};function M2(t,e){/^overlay-hide/.test(e.animationName)&&Zt(t,"close")}function A2(t,e,n){e.target===n&&(Zt(t,"before-close"),Zt(t,"close"),j2(t))}function T2(t,e){e.stopPropagation(),j2(t)}function j2(t){t.setState({hiding:!0})}var P2="ernsmej";function R2(t,e){e.animation=t.state.hiding?"hide":"show"}function L2(t,e,o,r){n.updateClass(t,e,r.animation)}function O2(t,e,o,r){n.updateClass(t,e,r.animation+(o.props.full?" __full-okmsg":""))}function z2(t,e){var o=t.componentView;R2(t,e);var r=n.appendChild(o,n.elem("div",P2));n.setRef(t,"main",r);var a=e._4=n.appendChild(r,n.createSlot(t,"overlay",P2));L2(a,e._5=n.obj(),0,e),e._6=n.addEvent(a,"click",A2,t,e),e._7=n.addEvent(a,"close",T2,t,e),e._8=n.addEvent(a,"animationend",M2,t,e),e._9=n.mountSlot(t,"overlay");var i=e._a=n.appendChild(r,n.createSlot(t,"",P2));return O2(i,e._b=n.obj(),t,e),e._c=n.addEvent(i,"click",A2,t,e),e._d=n.addEvent(i,"close",T2,t,e),e._e=n.mountSlot(t,""),D2}function D2(t,e){R2(t,e),L2(e._4,e._5,0,e),O2(e._a,e._b,t,e)}z2.dispose=function(t){t._6=n.removeEvent("click",t._6),t._7=n.removeEvent("close",t._7),t._8=n.removeEvent("animationend",t._8),t._9=n.unmountSlot(t._9),t._c=n.removeEvent("click",t._c),t._d=n.removeEvent("close",t._d),t._e=n.unmountSlot(t._e)};var U2={__proto__:null,cssScope:P2,default:z2,props:function(){return{bg:"",full:!1}},methods:B2,init:function(t){t.componentView=t.root.refs.main},willUnmount:function(t){var e=t.refs.main;e.parentNode&&e.parentNode.removeChild(e)},onAnimationEnd:M2,onClick:A2,onClose:T2};function N2(t,e){void 0===e&&(e={});var n,o=null,r=function(e){if("Tab"===e.key&&H2(t)){o||(o=kr(t));var n=o.indexOf(hr(t)),r=void 0;null==(r=-1===n?o[0]:o[(n+(e.altKey||e.shiftKey?-1:1)+o.length)%o.length])||r.focus(),e.preventDefault(),e.stopPropagation()}else"Enter"!==e.key||F2(e)||!function(t){if(Cr(t))return!0;var e="nodeType"in t&&1===t.nodeType?t.getAttribute("tabindex"):"";return!!e&&Number(e)>=0}(e.target)||Cr(e.target)||e.defaultPrevented||e.target.click()};if(e.retainTrigger){var a=hr(t);br(a)&&(n=a)}return t.addEventListener("keydown",r),H2(t)&&(t.setAttribute("tabindex","0"),t.focus()),{update:function(){o=null},destroy:function(){o=null,t.removeEventListener("keydown",r),null==n||n.focus()}}}function q2(t,e){void 0===e&&(e=!1);var n={hasModifier:!1,timestamp:0},o=function(t){"Tab"===t.key&&(n.hasModifier=F2(t),n.timestamp=Date.now())},r=function(e){if(!t.contains(e.target)&&e.relatedTarget&&t.contains(e.relatedTarget)){if(Date.now()-n.timestamp>300){var o=e.relatedTarget;if(null==o?void 0:o.focus)return console.log("revert focus to",o),void requestAnimationFrame((function(){return o.focus()}))}var r=kr(t),a=n.hasModifier?r[r.length-1]:r[0];(null==a?void 0:a.focus)&&a.focus()}},a=function(){e?(document.body.addEventListener("keydown",o),document.body.addEventListener("focusin",r)):(document.body.removeEventListener("keydown",o),document.body.removeEventListener("focusin",r))};return a(),{update:function(t){e=t,a()},destroy:function(){e=!1,a()}}}function H2(t){return"true"===t.getAttribute("aria-modal")}function F2(t){return t.altKey||t.shiftKey||t.ctrlKey||t.metaKey}function V2(t){return t&&t.nodeType===t.ELEMENT_NODE?t.classList.contains("toolbar-layer_w")?t:V2(t.parentNode):null}var K2="e6oqypz";function W2(t,e,n){e.title=n.store.data.l10n("close")}function G2(t){Zt(t,"close")}function Y2(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("div",K2));n.setClass(r,"header-okmsg"),n.appendChild(r,n.createSlot(t,"header",K2)),e._3=n.mountSlot(t,"header");var a=e._4=n.appendChild(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input,s=e._5=n.propsSet(a,{class:"close-okmsg",shape:"circle"});W2(0,s,t),e._6=n.addEvent(a,"click",G2,t,e);var u=e._7=n.insert(i,n.createComponent("msg-icon",xe,t),"");n.mountComponent(u,n.propsSet(u,{icon:"clear",size:"medium"})),n.mountComponent(a,s);var c=n.appendChild(o,n.createSlot(t,"",K2));return n.setClass(c,"custom-scrollbar-okmsg"),e._b=n.mountSlot(t,""),n.appendChild(o,n.createSlot(t,"buttons",K2)),e._d=n.mountSlot(t,"buttons"),n.subscribeStore(t,["l10n"]),X2}function X2(t,e){var o=e._4,r=e._5;W2(0,r,t),n.updateComponent(o,r)}Y2.dispose=function(t){t._3=n.unmountSlot(t._3),t._6=n.removeEvent("click",t._6),t._7=n.unmountComponent(t._7),t._4=n.unmountComponent(t._4),t._b=n.unmountSlot(t._b),t._d=n.unmountSlot(t._d)};var Q2={__proto__:null,cssScope:K2,default:Y2,willMount:function(t){var e;null===(e=V2(t.root))||void 0===e||e.classList.add("__msg-ovr")},willUnmount:function(t){var e;null===(e=V2(t.root))||void 0===e||e.classList.remove("__msg-ovr")},didMount:function(t){var e=N2(t,{retainTrigger:!0});return function(){return e.destroy()}}},J2="eg8f9fh";function $2(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",J2)),e._2=n.mountSlot(t,"")}$2.dispose=function(t){t._2=n.unmountSlot(t._2)};var Z2={__proto__:null,cssScope:J2,default:$2},t3={mention:!0,link:!0},e3=[DS({ESC:function(t,e,n){t.state.completeMentions?(e.preventDefault(),s3(t)):n()},UP:function(t,e,n){var o=t.refs.mentions;o&&o.getSelected()?(e.preventDefault(),o.selectPrevious()):n()},DOWN:function(t,e,n){var o=t.refs.mentions;o&&o.getSelected()?(e.preventDefault(),o.selectNext()):n()},TAB:function(t,e){var n=t.refs,o=n.label,r=n.value;document.activeElement===o?(e.preventDefault(),r.selectAll()):document.activeElement===r&&(e.preventDefault(),o.selectAll())}},!0)];function n3(t){var e=t.refs.value.editor,o=e.getSelection(),r=o[0]!==o[1];if(t.state.mentionToken){var a=e.getText().length;return 0===o[0]&&o[1]===a||e.setSelection(0,a),void s3(t)}if(function(t){var e=l3(t),o=e.getSelection(),r=o[0]!==o[1],a=e.tokenForPos(o[0],!0),i=null==a?void 0:a.type;t.setState({completeMentions:i===n.TokenType.Mention&&!r,_prevTokenType:i})}(t),!r){var i=o[0],s=e.tokenForPos(i,!0);(null==s?void 0:s.type)===n.TokenType.Mention?t.setState({prefix:I0(e,i,s)}):t.setState({prefix:null})}}function o3(t,e){var n=t.refs.mentions;if(n){var o=n.getSelected(!0);if(o)return e.preventDefault(),e.stopPropagation(),void u3(t,o)}c3(t,!0)?(Ot(t,"submit",{label:t.refs.label.value,value:p3(t)}),r3(t)):t.setState({valueError:!0})}function r3(t){var e=t.refs.overlay;e&&e.close(),Ot(t,"close")}function a3(t,e){e.detail&&u3(t,e.detail)}function i3(t){var e=t.refs.value.editor,n=t.state.mentionToken;n&&_3(n)!==e.getText()&&d3(t,e.getText()),t.setState({valueError:!c3(t)})}function s3(t){t.setState({completeMentions:!1,prefix:void 0,_prevTokenType:null})}function u3(t,e){m3(t,e.contact),s3(t)}function c3(t,e){for(var o,r=l3(t),a=!1,i=0;i<r.model.length;i++){var s=r.model[i];if(s.type===n.TokenType.Text){if(o=s.value,/^\s+$/.test(o))continue;if(a||e)return!1}else{if(s.type!==n.TokenType.Link&&s.type!==n.TokenType.Mention)return!1;if(a)return!1;a=!0}}return!0}function p3(t){for(var e=l3(t),o=0;o<e.model.length;o++){var r=e.model[o];if(r.type===n.TokenType.Link)return r.link;if(r.type===n.TokenType.Mention)return r.value}return""}function l3(t){return t.refs.value.editor}function m3(t,e){var n=_3(e);t.setState({mentionToken:e,mentionLabel:n});var o=l3(t);o.setValue(n),o.setLink("@".concat(e.id),0,n.length),o.setSelection(0,n.length)}function d3(t,e){t.setState({mentionToken:null,mentionLabel:null}),t.refs.value.editor.setValue(e)}function _3(t){return"@".concat($1(t)||t.id)}var f3="e-n3sewv",g3=[0],v3=[];function h3(){v3.push(g3),g3=[0]}function C3(){g3=v3.pop()}function k3(t,e,n){e.placeholder=n.store.data.l10n("edit-link.label-placeholder"),e.value=n.props.label}function b3(t,e,n){e.chat=n.props.chat,e.prefix=n.state.prefix}function y3(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-mentions-panel",$0,t));n.setPendingRef(o._1,"mentions",r);var a=o._g=n.propsSet(r);return b3(0,a,t),o._h=n.addEvent(r,"submit",a3,t,o),n.mountComponent(r,a),g3[0]=1,S3}function S3(t,e){var o=e._f,r=e._g;n.setPendingRef(e._1,"mentions",o),b3(0,r,t),n.updateComponent(o,r)}function w3(t){return t.state.completeMentions?y3:null}function E3(t,e,n){e.placeholder=n.store.data.l10n("edit-link.value-placeholder"),e.value=n.props.value,e.parse=n.state.parseOptions,e.class=(n.state.valueError?"error-okmsg":"")+(n.state.mentionToken?" hidden-okmsg":"")}function x3(t,e,o){!o._t&&function(t,e,o){var r=o._t=n.insert(e,n.createComponent("msg-form-error",Z2,t)),a=r.componentModel.input,i=o._u=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"edit-link.error.link"})),n.mountComponent(r),g3[0]=1}(t,e,o),n.animate(o._t,$U(o._t,{duration:150,easing:nN}))}function I3(t){return t.state.valueError?x3:null}function B3(t,e){var o=t.componentView;h3();var r=e._1=n.obj(),a=e._2=n.appendChild(o,n.createComponent("msg-overlay",U2,t)),i=a.componentModel.input;n.setRef(t,"overlay",a);var s=e._3=n.insert(i,n.createComponent("msg-dialog",Q2,t),""),u=s.componentModel.input;e._4=n.addEvent(s,"close",r3,t,e);var c=e._5=n.insert(u,n.createComponent("msg-l10n",ae,t),"header");n.mountComponent(c,n.propsSet(c,{slot:"header",key:"edit-link.header"}));var p=n.insert(u,n.elem("div",f3),"");n.setClass(p,"field-okmsg");var l=e._8=n.appendChild(p,n.createComponent("msg-input",a$,t));n.setRef(t,"label",l);var m=e._9=n.propsSet(l);k3(0,m,t),e._a=n.addEvent(l,"input-submit",o3,t,e),n.mountComponent(l,m);var d=n.insert(u,n.elem("div",f3),""),_=n.createInjector(d);n.setClass(d,"field-okmsg"),e._c=n.mountBlock(t,_,w3);var f=e._j=n.insert(_,n.createComponent("msg-input",a$,t));n.setRef(t,"value",f);var g=e._k=n.propsSet(f,{autofocus:!0});E3(0,g,t),e._l=n.addEvent(f,"editor-selectionchange",n3,t,e),e._m=n.addEvent(f,"editor-update",i3,t,e),e._n=n.addEvent(f,"input-submit",o3,t,e),n.mountComponent(f,g),e._o=n.mountBlock(t,_,I3);var v=n.insert(u,n.elem("div",f3),"buttons");n.setAttribute(v,"slot","buttons");var h=e._y=n.appendChild(v,n.createComponent("msg-button",fe,t)),C=h.componentModel.input;e._10=n.addEvent(h,"click",o3,t,e);var k=e._11=n.insert(C,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(k,n.propsSet(k,{key:"save"})),n.mountComponent(h,n.propsSet(h,{class:"primary-okmsg",shape:"square"}));var b=e._14=n.appendChild(v,n.createComponent("msg-button",fe,t)),y=b.componentModel.input;e._16=n.addEvent(b,"click",r3,t,e);var S=e._17=n.insert(y,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(S,n.propsSet(S,{key:"cancel"})),n.mountComponent(b,n.propsSet(b,{class:"secondary-okmsg",shape:"square"})),n.mountComponent(s),n.mountComponent(a),C3(),n.subscribeStore(t,["l10n"]),n.finalizePendingRefs(t,r),M3}function M3(t,e){var o=e._8,r=e._9,a=e._j,i=e._k;h3(),k3(0,r,t),n.updateComponent(o,r),n.updateBlock(e._c),E3(0,i,t),n.updateComponent(a,i),n.updateBlock(e._o),n.updateIncomingSlot(e._3,"",g3[0]),C3(),n.finalizePendingRefs(t,e._1)}y3.dispose=function(t){t._h=n.removeEvent("submit",t._h),t._f=n.unmountComponent(t._f),t._g=null,g3[0]=1},x3.dispose=function(t,e){var o=t._t;n.animate(o,ZU(0,{duration:150,easing:nN}),(function(){return function(t){var e=t._t;t._u=n.unmountComponent(t._u),t._t=n.unmountComponent(e),n.domRemove(e),g3[0]=1}(t)}))},B3.dispose=function(t){h3(),t._4=n.removeEvent("close",t._4),t._5=n.unmountComponent(t._5),t._a=n.removeEvent("input-submit",t._a),t._8=n.unmountComponent(t._8),t._c=n.unmountBlock(t._c),t._l=n.removeEvent("editor-selectionchange",t._l),t._m=n.removeEvent("editor-update",t._m),t._n=n.removeEvent("input-submit",t._n),t._j=n.unmountComponent(t._j),t._o=n.unmountBlock(t._o),t._10=n.removeEvent("click",t._10),t._11=n.unmountComponent(t._11),t._y=n.unmountComponent(t._y),t._16=n.removeEvent("click",t._16),t._17=n.unmountComponent(t._17),t._14=n.unmountComponent(t._14),t._3=n.unmountComponent(t._3),t._2=n.unmountComponent(t._2),C3()};var A3={__proto__:null,cssScope:f3,default:B3,slideDown:$U,slideUp:ZU,easeOutCubic:nN,plugins:e3,state:function(){return{parseOptions:t3}},didMount:function(t){var e=t.props.value;if(e&&"@"===e[0]){var n=Number(e.slice(1)),o=t.store.get().contacts.get(n);o&&m3(t,o)}},onValueSelectionChange:n3,handleSubmit:o3,close:r3,onSubmitMention:a3,onValueUpdate:i3,clearMentionToken:function(t){d3(t,"")}};var T3={mouseover:function(t){t.props.delay?function(t){clearTimeout(t._scheduleTimeoutId),t._scheduleTimeoutId=window.setTimeout((function(){return j3(t)}),500)}(t):j3(t)},mouseleave:function(t){!function(t){t._scheduleTimeoutId&&clearTimeout(t._scheduleTimeoutId);t.setState({active:!1})}(t)}};function j3(t){t.setState({active:!0})}var P3="erzf7nh",R3=[0],L3=[];function O3(){L3.push(R3),R3=[0]}function z3(){R3=L3.pop()}function D3(t,e,o){n.updateAttribute(t,e,"style","top: "+o.state.y+"px; left:"+o.state.x+"px")}function U3(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._g=n.insert(a,n.text(t.props.text)),n.insert(a,n.text(" ")),n.mountComponent(r),N3}function N3(t,e){R3[0]|=n.updateText(e._g,t.props.text),n.updateIncomingSlot(e._f,"",R3[0])}function q3(t){return t.props.text?U3:null}function H3(t,e){var o=e._a;n.setPendingRef(e._1,"tooltip",o),D3(o,e._b,t),n.updateBlock(e._c)}function F3(t,e,o){return o._a?H3(t,o):function(t,e,o){var r=o._a=n.insert(e,n.elem("span",P3)),a=n.createInjector(r);n.setPendingRef(o._1,"tooltip",r);var i=o._b=n.obj();n.setClass(r,"tooltip-okmsg __top-okmsg"),D3(r,i,t),o._c=n.mountBlock(t,a,q3),n.insert(a,n.createSlot(t,"text",P3)),o._l=n.mountSlot(t,"text"),n.insert(a,n.text(" "))}(t,e,o),n.animate(o._a,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",P3)),V3}function V3(t,e){H3(t,e)}function K3(t){return t.state.active?F3:null}function W3(t,e){var o=t.componentView;O3();var r=e._1=n.obj(),a=n.appendChild(o,n.createSlot(t,"",P3));n.setAttribute(a,"title",""),e._3=n.mountSlot(t,"");var i=n.appendChild(o,n.elem("span",P3)),s=n.createInjector(i);return n.setClass(i,"tooltip-wrapper-okmsg"),e._5=n.mountBlock(t,s,K3),z3(),n.finalizePendingRefs(t,r),G3}function G3(t,e){O3(),n.updateBlock(e._5),z3(),n.finalizePendingRefs(t,e._1)}U3.dispose=function(t){t._f=n.unmountComponent(t._f),t._g=null},F3.dispose=function(t,e){n.animate(t._a,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",P3),(function(){return function(t){t._c=n.unmountBlock(t._c),t._l=n.unmountSlot(t._l),t._a=n.domRemove(t._a),t._b=null}(t)}))},W3.dispose=function(t){O3(),t._3=n.unmountSlot(t._3),t._5=n.unmountBlock(t._5),z3()};var Y3={__proto__:null,cssScope:P3,default:W3,state:function(){return{active:!1,x:0,y:0}},props:function(){return{offsetY:4}},events:T3,didRender:function(t){!function(t){var e,n;if(!t.state.active)return;var o=-t.parentElement.scrollLeft-((null===(e=t.refs.tooltip)||void 0===e?void 0:e.clientWidth)-t.clientWidth)/2||0,r=-t.clientHeight-t.props.offsetY-(null===(n=t.refs.tooltip)||void 0===n?void 0:n.clientHeight);t.setState({x:o,y:r})}(t)}};var X3=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(navigator.platform),Q3={meta:"Win",ctrl:"Ctrl",cmd:"Ctrl",alt:"Alt",shift:"Shift",enter:"Enter",tab:"Tab",left:"←",right:"→",up:"↑",down:"↓"},J3=n.__assign(n.__assign({},Q3),{meta:"⌘",cmd:"⌘",ctrl:"⌃",shift:"⇧",alt:"⌥",enter:"⏎",tab:"⇥"});function $3(t){var e=t.split("+");""===e[e.length-2]&&""===e[e.length-1]&&e.pop();var n=X3?J3:Q3;return e.map((function(t){return""===t?"+":n[t.toLowerCase()]||t})).join(X3?"":"+")}function Z3(t,e){n.updateText(e._1,t.state.value)}var t5={__proto__:null,cssScope:"e9s5boj",default:function(t,e){var o=t.componentView;return e._1=n.appendChild(o,n.text(t.state.value)),Z3},props:function(){return{value:""}},state:function(){return{value:""}},didChange:function(t){t.setState({value:$3(t.props.value)})}};function e5(t,e){t.format===n.TokenFormat.Link?te(e,"pick-link"):te(e,"toggle-format",{format:t.format}),OK.logger.success("messagesLayer","formating",ot[t.format])}function n5(t,e,n,o){return{className:e,format:n,tooltip:o,icon:t,shortcut:SJ.get(n)}}var o5="ewqli1z",r5=[0],a5=[];function i5(){a5.push(r5),r5=[0]}function s5(){r5=a5.pop()}function u5(t){return t.state.items}function c5(t,e,o,r){e.class="btn-okmsg"+(n.get(r.value,"format")&o.props.format?" selected-okmsg":"")}function p5(t,e,n,o){e.preventDefault(),e5(o.value,t)}function l5(t,e,o,r){e.key=n.get(r.value,"tooltip"),e.class=n.get(r.value,"className")}function m5(t,e,o,r){e.value=n.get(r.value,"shortcut")}function d5(t,e,o,r){e.icon=n.get(r.value,"icon"),e.class="label-okmsg "+n.get(r.value,"className")}function _5(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-icon",xe,t),""),a=o._l=n.propsSet(r);return d5(0,a,0,o),n.mountComponent(r,a),r5[0]=1,f5}function f5(t,e){var o=e._k,r=e._l;d5(0,r,0,e),n.updateComponent(o,r)}function g5(t,e,o,r){n.updateClass(t,e,"label-okmsg "+n.get(r.value,"className"))}function v5(t,e,o){var r=o._o=n.insert(e,n.elem("span",o5),"");return g5(r,o._p=n.obj(),0,o),o._q=n.appendChild(r,n.text(n.get(o.value,"label"))),r5[0]=1,h5}function h5(t,e){g5(e._o,e._p,0,e),r5[0]|=n.updateText(e._q,n.get(e.value,"label"))}function C5(t,e){return n.get(e.value,"icon")?_5:v5}function k5(t,e,o){var r=o._7=n.insert(e,n.createComponent("msg-tooltip",Y3,t)),a=r.componentModel.input,i=o._8=n.propsSet(r,{delay:!0});c5(0,i,t,o),o._9=n.addEvent(r,"mousedown",p5,t,o);var s=n.insert(a,n.elem("span",o5),"text");n.setAttribute(s,"slot","text");var u=o._b=n.appendChild(s,n.createComponent("msg-l10n",ae,t)),c=o._c=n.propsSet(u);l5(0,c,0,o),n.mountComponent(u,c),n.appendChild(s,n.text(" ("));var p=o._e=n.appendChild(s,n.createComponent("msg-shortcut-to-text",t5,t)),l=o._f=n.propsSet(p);return m5(0,l,0,o),n.mountComponent(p,l),n.appendChild(s,n.text(")\n            ")),o._h=n.mountBlock(t,a,C5),n.mountComponent(r,i),b5}function b5(t,e){var o=e._7,r=e._8,a=e._b,i=e._c,s=e._e,u=e._f;c5(0,r,t,e),l5(0,i,0,e),n.updateComponent(a,i),m5(0,u,0,e),n.updateComponent(s,u),n.updateBlock(e._h),n.updateIncomingSlot(o,"",r5[0]),n.updateComponent(o,r)}function y5(t,e){return t.props.allow&n.get(e.value,"format")?k5:null}function S5(t,e,o){return o._4=n.mountBlock(t,e,y5),w5}function w5(t,e){n.updateBlock(e._4)}function E5(t,e,n){e.class="btn-okmsg reset-okmsg"+(n.props.reset?"":" disabled-okmsg")}function x5(t,e){e.preventDefault(),Ot(t,"reset-format")}function I5(t,e){var o=t.componentView;i5();var r=n.createInjector(o);e._1=n.mountIterator(t,r,u5,S5);var a=e._t=n.insert(r,n.createComponent("msg-tooltip",Y3,t)),i=a.componentModel.input,s=e._u=n.propsSet(a,{delay:!0,text:"Очистить форматирование"});E5(0,s,t),e._v=n.addEvent(a,"mousedown",x5,t,e);var u=e._w=n.insert(i,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(u,n.propsSet(u,{icon:"clean",class:"label-okmsg"})),n.mountComponent(a,s),s5(),B5}function B5(t,e){var o=e._t,r=e._u;i5(),n.updateIterator(e._1),E5(0,r,t),n.updateComponent(o,r),s5()}_5.dispose=function(t){t._k=n.unmountComponent(t._k),t._l=null,r5[0]=1},v5.dispose=function(t){t._p=t._q=t._o=null,r5[0]=1},k5.dispose=function(t){t._9=n.removeEvent("mousedown",t._9),t._b=n.unmountComponent(t._b),t._e=n.unmountComponent(t._e),t._h=n.unmountBlock(t._h),t._7=n.unmountComponent(t._7),t._8=t._c=t._f=null},S5.dispose=function(t){t._4=n.unmountBlock(t._4)},I5.dispose=function(t){i5(),t._1=n.clearIterator(t._1),t._v=n.removeEvent("mousedown",t._v),t._w=n.unmountComponent(t._w),t._t=n.unmountComponent(t._t),s5()};var M5={__proto__:null,cssScope:o5,default:I5,state:function(){return{items:[n5("toolbar-heading","heading",n.TokenFormat.Heading,"editor-toolbar.heading"),n5("toolbar-bold","bold",n.TokenFormat.Bold,"editor-toolbar.bold"),n5("toolbar-italics","italic",n.TokenFormat.Italic,"editor-toolbar.italic"),n5("toolbar-underline","underline",n.TokenFormat.Underline,"editor-toolbar.underline"),n5("toolbar-strike","strike",n.TokenFormat.Strike,"editor-toolbar.strike"),n5("toolbar-monospace","monospace",n.TokenFormat.Monospace,"editor-toolbar.monospace"),n5("toolbar-link","link-btn",n.TokenFormat.Link,"editor-toolbar.link"),n5("toolbar-mark","mark-btn",n.TokenFormat.Marked,"editor-toolbar.mark")]}},didRender:function(t){!function(t){var e=t.props.pos,n=t.clientWidth,o=Tn(e[0],0,e[2]-n),r=Tn(e[1],0,e[3]);t.style.left="".concat(o,"px"),t.style.bottom="".concat(r,"px")}(t)},onClick:e5},A5="ev3ra41";function T5(t){Ot(t,"select",n.get(t.props.mention,"link"))}function j5(t,e,o){var r=n.insert(e,n.elem("div",A5));return n.setClass(r,"item-okmsg"),o._7=n.addEvent(r,"click",T5,t,o),o._8=n.appendChild(r,n.text(n.get(t.props.mention,"link"))),P5}function P5(t,e){n.updateText(e._8,n.get(t.props.mention,"link"))}function R5(t){return n.get(t.props.mention,"link")?j5:null}function L5(t){Ot(t,"select",n.get(t.props.mention,"name"))}function O5(t){Ot(t,"select",n.get(t.props.mention,"ownName"))}function z5(t,e,o){var r=n.insert(e,n.elem("div",A5));return n.setClass(r,"item-okmsg"),o._h=n.addEvent(r,"click",O5,t,o),o._i=n.appendChild(r,n.text(n.get(t.props.mention,"ownName"))),D5}function D5(t,e){n.updateText(e._i,n.get(t.props.mention,"ownName"))}function U5(t){return n.get(t.props.mention,"ownName")&&n.get(t.props.mention,"ownName")!==n.get(t.props.mention,"name")?z5:null}function N5(t,e){var o=t.componentView,r=n.createInjector(o),a=n.insert(r,n.elem("header",A5));e._2=n.appendChild(a,n.text(t.store.data.l10n("mention.swap-popup-header"))),e._3=n.mountBlock(t,r,R5);var i=n.insert(r,n.elem("div",A5));return n.setClass(i,"item-okmsg"),e._b=n.addEvent(i,"click",L5,t,e),e._c=n.appendChild(i,n.text(n.get(t.props.mention,"name"))),e._d=n.mountBlock(t,r,U5),n.subscribeStore(t,["l10n"]),q5}function q5(t,e){n.updateText(e._2,t.store.data.l10n("mention.swap-popup-header")),n.updateBlock(e._3),n.updateText(e._c,n.get(t.props.mention,"name")),n.updateBlock(e._d)}j5.dispose=function(t){t._7=n.removeEvent("click",t._7),t._8=null},z5.dispose=function(t){t._h=n.removeEvent("click",t._h),t._i=null},N5.dispose=function(t){t._3=n.clearBlock(t._3),t._b=n.removeEvent("click",t._b),t._d=n.clearBlock(t._d)};var H5,F5,V5={__proto__:null,cssScope:A5,default:N5},K5=2e3,W5=[DS((H5={ESC:function(t,e,n){var o=t.state,r=o.completeMentions,a=o.completeCommands;r||a?(e.preventDefault(),e.stopPropagation(),M4(t)):n()},UP:function(t,e){var n=p4(t);n&&n.getSelected()&&(e.preventDefault(),e.stopPropagation(),n.selectPrevious())},DOWN:function(t,e,n){var o=p4(t);o&&o.getSelected()?(e.preventDefault(),o.selectNext()):n()}},H5[SJ.get(n.TokenFormat.Link)]=w4,H5)),NS((function(t){t.state.toolbarPos&&i4(t)}))],G5={hashtag:!0,link:!0,textEmoji:!0,userSticker:!0,mention:!0,markdown:!1,command:!1,stickyLink:!0},Y5={get value(){return this.refs.input.value},set value(t){this.refs.input.value=t},setSelection:function(t,e){var n=this.refs.input;n&&n.setSelection(t,e)},selectAll:function(){var t=this.refs.input;t&&t.selectAll()},insertText:function(t,e){var n=this.refs.input;n&&n.insertText(t,e)},insertEmoji:function(t,e){var n;null===(n=this.refs.input)||void 0===n||n.insertEmoji(t,e)},focus:function(t){u4(this,t)},getChunks:function(){var t,e,o;if(this.refs.input){var r=this.props.chunkLength;return t=h4(this),e=r,o={replaceTextEmoji:!1},n.split(t,e).map((function(t){return it(t,o)}))}return[]},toggleCommandCompletions:function(){if(this.props.command)if(this.state.completeCommands)this.setState({completeCommands:!1});else{var t=b4(this),e=t.getSelection(),o=t.tokenForPos(e[0],!0);if((null==o?void 0:o.type)===n.TokenType.Command)this.setState({completeCommands:!0});else{var r="/",a=t.getText();0===e[0]||/\s/.test(a.charAt(e[0]-1))||(r=" "+r),t.replaceText(e[0],e[1],r)}this.focus()}},submit:function(){v4(this),te(this,"submit")},flushUpdates:function(){v4(this)},handleEnter:function(t){var e=this.refs.input;e&&e.handleEnter(t)}};function X5(t,e){b4(t).toggleFormat(e.detail.format)}function Q5(t){var e=b4(t),n=e.getSelection(),o=n[0],r=n[1];e.updateFormat(0,o,r)}function J5(t){var e=b4(t);if(e){var o=e.getSelection(),r=o[0]!==o[1];if(S4(t),r)"ontouchstart"in document||i4(t);else{var a=o[0],i=e.tokenForPos(a,!0);!i||i.type!==n.TokenType.Mention&&i.type!==n.TokenType.Command?t.setState({prefix:null}):t.setState({prefix:I0(e,a,i)}),s4(t)}}}function $5(t){t.state._updateUrls(),g4(t),B4(t)}function Z5(t){i4(t),t.state._updateUrls(),g4(t)}function t4(t,e){e.detail&&l4(t,e.detail)}function e4(t,e){e.detail&&m4(t,e.detail)}function n4(t,e){var n=e.detail,o=n.label,r=n.value,a=t.state.pickLink;if(a){var i=b4(t),s=a.selection,u=s[0],c=s[1];a.label!==o&&i.replaceText(u,c,o||""),o&&i.setLink(r,u,u+o.length),i4(t)}}function o4(t){t.state._scheduleDraftSync&&(Zt(t,"draft-sync",t.props.chatId),t.state._scheduleDraftSync=!1),t.state.pickLink||s4(t)}function r4(t){var e=k4(t),n=e.getSelection(),o=n[0],r=n[1];e.focus(),e.setSelection(o,r),t.setState({pickLink:null})}function a4(t){t.state.toolbarPos&&T4(t)}function i4(t){var e,o=b4(t);if(o){var r=o.getSelection(),a=r[0],i=r[1],s=o.tokenForPos(a),u=o.tokenForPos(i),c=o.model,p=!1,l=0;if(s){l=s.format,s.type!==n.TokenType.Link||s.auto||(l|=n.TokenFormat.Link);for(var m=c.indexOf(s),d=c.indexOf(u);m<=d;)if(null===(e=c[m++])||void 0===e?void 0:e.format){p=!0;break}}t.setState({toolbarFormat:l,resetFormat:p}),T4(t)}}function s4(t){t.setState({toolbarPos:null})}function u4(t,e){void 0===e&&(e=!0);var n=t.refs.input;if(n)if(n.focused||n.focus(),e)n.setSelection(n.value.length);else{var o=n.getSelection();n.setSelection(o[0],o[1])}}function c4(t){v4(t);var e=t.refs,n=e.mentions,o=e.commands;if(n){var r=n.getSelected();if(r)return void l4(t,r)}else if(o){var a=o.getSelected();if(a)return void m4(t,a)}t.submit()}function p4(t){return t.refs.commands||t.refs.mentions}function l4(t,e){var o,r,a,i=b4(t),s=i.tokenForPos(i.getSelection()[0],!0);if((null==s?void 0:s.type)===n.TokenType.Mention){var u=i.model,c=u.indexOf(s),p=n.getLength(u.slice(0,c)),l=(r=e.contact,a=Q1[r.id],!r.link||a&&1!==a?3===a?$1(r):Z1(r):t0(r)),m=null===(o=e.contact.options)||void 0===o?void 0:o.includes("BOT");i.replaceText(p,p+s.value.length,l+" ");var d=p+l.length+1;m&&l===e.link||(i.setLink("@".concat(e.id),p,p+l.length),t.props.markdown&&(d+=String(e.id).length+5)),i.setSelection(d)}M4(t),L(t,"log").action({name:"MENTION_SUGGEST_CLICK",value:e.link?"publicLink":"fullName"})}function m4(t,e){var o=b4(t),r=o.tokenForPos(o.getSelection()[0],!0);if((null==r?void 0:r.type)===n.TokenType.Command){var a=o.model,i=a.indexOf(r),s=n.getLength(a.slice(0,i)),u="/".concat(e.name," ");o.replaceText(s,s+r.value.length,u),o.setSelection(s+u.length)}M4(t)}function d4(t){var e=0,n=0,o=0,r=0,a=window.getSelection();if(a){var i=a.getRangeAt(0),s=i&&_4(i)||t.refs.input.getBoundingClientRect(),u=t.getBoundingClientRect();o=u.width,r=u.height,s&&(e=s.left-u.left,n=u.bottom-s.top)}return[e,n,o,r]}function _4(t){for(var e=t.getClientRects(),n=[],o=0;o<e.length;o++)e[o].width>1&&n.push(e[o]);if(n.length){var r=n[0],a=n[n.length-1];return r.top===a.top?r.left<a.left?r:a:r.top<a.top?r:a}}function f4(t){var e=t.refs.input;if(e){var o=t.props.posting;if(o){var r=t.state.parseOptions,a=st(o.text||"",o.messageElements,r);r.markdown?e.replaceValue(n.textToMd(a)):e.replaceValue(a)}else e.replaceValue("")}}function g4(t,e){void 0===e&&(e=!0);var n=t.props.chatId;if(n){var o=t.state,r=o._pending,a=o._flushTimeout,i=h4(t);r.set(n,i),e?v4(t):(clearTimeout(a),t.state._flushTimeout=window.setTimeout((function(){return v4(t)}),K5)),t.state._scheduleDraftSync=!0}}function v4(t){var e=t.state._pending,n=t.props,o=n.textEmoji,r=n.chatId;e.forEach((function(e,n){var a=it(e,{replaceTextEmoji:!o}),i=a.text,s=a.elements;r===n&&(t.state._text=i,t.state._elements=s),te(t,"posting-update",{chatId:n,posting:{text:i,messageElements:s,emoji:C4(e).reverse(),urls:y4(e)}})})),e.clear(),clearTimeout(t.state._flushTimeout)}function h4(t){var e=t.refs.input;if(e){if(e.editor){var o=e.editor.model;return t.state.parseOptions.markdown&&(o=n.mdToText(o)),o}if(e.value)return[{type:n.TokenType.Text,value:e.value,format:0,sticky:!1}]}return[]}function C4(t){var e=new i;return t.forEach((function(t){t.emoji&&t.emoji.forEach((function(n){e.add(n.emoji||t.value.slice(n.from,n.to))}))})),Array.from(e)}function k4(t){return t.refs.input}function b4(t){return k4(t).editor}function y4(t){var e=[];return t.forEach((function(t){(function(t){return t.type===n.TokenType.Link&&t.auto})(t)&&t.format&n.TokenFormat.Monospace||t.type===n.TokenType.Link&&/^https?:/i.test(t.link)&&e.push(t.link)})),e}function S4(t){var e=b4(t);if(e){var o=e.getSelection(),r=o[0]!==o[1],a=e.tokenForPos(o[0],!0),i=null==a?void 0:a.type;if(i!==t.state._prevTokenType){var s=void 0;i===n.TokenType.Command&&(s=function(t,e){var o=t.model.indexOf(e);if(-1!==o)for(;--o>=0;){var r=t.model[o];if(r.type===n.TokenType.Mention)return r.mention;if(r.type!==n.TokenType.Text)break;if(r.value&&!/^\s+$/.test(r.value))break}}(e,a)),t.setState({completeMentions:i===n.TokenType.Mention&&!r,completeCommands:i===n.TokenType.Command&&!r,commandsBot:s,_prevTokenType:i})}}}function w4(t){var e=b4(t),o=e.getSelection(),r=e.tokenForPos(o[0]),a="";if(r){if(r.format&n.TokenFormat.LinkLabel)for(var i=this.model.indexOf(r)+1;i<this.model.length&&(r=this.model[i++]).type!==n.TokenType.Link;);if(r.type===n.TokenType.Link&&(a=r.link,o[0]===o[1])){i=e.model.indexOf(r);o[0]=n.getText$1(e.model.slice(0,i)).length,o[1]=o[0]+r.value.length}}t.setState({pickLink:{label:e.getText().slice(o[0],o[1]),value:a,selection:o}})}function E4(t){F5=window.setTimeout((function(){B4(t)}),500)}function x4(){clearTimeout(F5)}function I4(t,e){var n=e.detail,o=t.state.hoveredMention;if(o){var r=b4(t),a=o.range;r.replaceText(a[0],a[1],n),B4(t)}}function B4(t){t.setState({hoveredMention:null})}function M4(t){t.setState({completeMentions:!1,completeCommands:!1,commandsBot:void 0,prefix:void 0,_prevTokenType:null}),B4(t)}function A4(t){t.state._text=t.state._elements=null}function T4(t){var e=d4(t),n=t.state.toolbarPos;n&&qw(n,e)||t.setState({toolbarPos:e})}function j4(t,e){t.props.autofocus&&(dr(document.activeElement)||u4(t,e))}function P4(t,e){e.target.closest("a, .mention")&&(e.preventDefault(),e.stopPropagation())}var R4="ewk042h";function L4(t,e){e.mdFormat=27,e.mainFormat=127,e.editMode="EDIT"===n.get(t.props.posting,"type"),e.maxTotal=e.editMode?t.props.chunkLength:6*t.props.chunkLength,e.remainingSymbols=e.maxTotal-Tt(0,n.get(t.props.posting,"text")),e.showCounter=t.props.showCounter&&n.get(t.props.posting,"text")&&e.remainingSymbols<=50,e.isForward="forward"===t.props.context}function O4(t,e,n,o){e.pos=n.state.toolbarPos,e.format=n.state.toolbarFormat,e.allow=512|(n.props.markdown?o.mdFormat:o.mainFormat),e.reset=n.state.resetFormat}function z4(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-editor-toolbar",M5,t)),a=o._e=n.propsSet(r);return O4(0,a,t,o),o._f=n.addEvent(r,"toggle-format",X5,t,o),o._g=n.addEvent(r,"reset-format",Q5,t,o),o._h=n.addEvent(r,"pick-link",w4,t,o),n.mountComponent(r,a),D4}function D4(t,e){var o=e._d,r=e._e;O4(0,r,t,e),n.updateComponent(o,r)}function U4(t){return t.state.toolbarPos&&n.get(t.store.data.config,"server","me-editor")?z4:null}function N4(t,e,o,r){e.chat=r.isForward?null:n.get(o.store.data.chats,o.props.chatId),e.prefix=o.state.prefix,e.mobile=o.store.data.isMobile}function q4(t,e){var o=e._o,r=e._p;n.setPendingRef(e._1,"mentions",o),N4(0,r,t,e),n.updateComponent(o,r)}function H4(t,e,o){return o._o?q4(t,o):function(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-mentions-panel",$0,t));n.setPendingRef(o._1,"mentions",r);var a=o._p=n.propsSet(r);N4(0,a,t,o),o._q=n.addEvent(r,"submit",t4,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._o,$U(o._o,{duration:200,easing:nN})),F4}function F4(t,e){q4(t,e)}function V4(t){return t.state.completeMentions?H4:null}function K4(t,e,o){e.chat=n.get(o.store.data.chats,o.props.chatId),e.prefix=o.state.prefix,e.bot=o.state.commandsBot}function W4(t,e){var o=e._w,r=e._x;n.setPendingRef(e._1,"commands",o),K4(0,r,t),n.updateComponent(o,r)}function G4(t,e,o){return o._w?W4(t,o):function(t,e,o){var r=o._w=n.insert(e,n.createComponent("msg-commands-panel",I2,t));n.setPendingRef(o._1,"commands",r);var a=o._x=n.propsSet(r,{class:"panel-okmsg"});K4(0,a,t),o._y=n.addEvent(r,"submit",e4,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._w,$U(o._w,{duration:200,easing:nN})),Y4}function Y4(t,e){W4(t,e)}function X4(t){return t.state.completeCommands?G4:null}function Q4(t,e,o){e.chat=n.get(o.store.data.chats,o.props.chatId),e.label=n.get(o.state.pickLink,"label"),e.value=n.get(o.state.pickLink,"value")}function J4(t,e,o){var r=o._12=n.insert(e,n.createComponent("msg-edit-link",A3,t)),a=o._13=n.propsSet(r);return Q4(0,a,t),o._14=n.addEvent(r,"close",r4,t,o),o._15=n.addEvent(r,"submit",n4,t,o),n.mountComponent(r,a),$4}function $4(t,e){var o=e._12,r=e._13;Q4(0,r,t),n.updateComponent(o,r)}function Z4(t){return t.state.pickLink?J4:null}function t6(t,e,o){e.mention=n.get(o.state.hoveredMention,"mention"),e.style="left: "+n.get(o.state.hoveredMention,"pos",0)+"px;bottom: "+n.get(o.state.hoveredMention,"pos",1)+"px"}function e6(t,e){var o=e._1b,r=e._1c;t6(0,r,t),n.updateComponent(o,r)}function n6(t,e,o){return o._1b?e6(t,o):function(t,e,o){var r=o._1b=n.insert(e,n.createComponent("msg-pick-mention-display",V5,t)),a=o._1c=n.propsSet(r);t6(0,a,t),o._1d=n.addEvent(r,"mouseenter",x4,t,o),o._1e=n.addEvent(r,"mouseleave",E4,t,o),o._1f=n.addEvent(r,"select",I4,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._1b,n.createAnimation("global:msg-pop-in .25s cubic-bezier(.4, 0, .3, 1.2)",R4)),o6}function o6(t,e){e6(t,e)}function r6(t){return t.state.hoveredMention?n6:null}function a6(t,e,o){var r=n.insert(e,n.elem("aside",R4));n.appendChild(r,n.createSlot(t,"left",R4)),o._1m=n.mountSlot(t,"left")}function i6(t,e){return e.isForward?null:a6}function s6(t,e,o,r){e.format=o.props.markdown||!n.get(o.store.data.config,"server","me-editor")?r.mdFormat:r.mainFormat,e.parse=o.state.parseOptions,e.htmlPaste=n.get(o.store.data.config,"server","html-paste"),e.placeholder=o.props.placeholder,e.altNewline=n.get(o.store.data.config,"user","ALT_KEYBOARD")||o.store.data.isMobile&&o.store.data.isTouchDevice,e.style="padding-right: "+(o.state.rightSize||0)+"px; margin-right: -"+(o.state.rightSize||0)+"px"}function u6(t,e,o,r){n.updateClass(t,e,"counter-okmsg"+(Tt(0,n.get(o.props.posting,"text"))>r.maxTotal?" __error-okmsg":""))}function c6(t,e,o){var r=o._26=n.insert(e,n.elem("div",R4));return u6(r,o._27=n.obj(),t,o),o._28=n.appendChild(r,n.text(o.remainingSymbols)),p6}function p6(t,e){u6(e._26,e._27,t,e),n.updateText(e._28,e.remainingSymbols)}function l6(t,e){return e.showCounter?c6:null}function m6(t,e,o){var r=n.insert(e,n.elem("aside",R4)),a=n.createInjector(r);return o._23=n.mountBlock(t,a,l6),n.insert(a,n.createSlot(t,"right",R4)),o._2b=n.mountSlot(t,"right"),d6}function d6(t,e){n.updateBlock(e._23)}function _6(t,e){return e.isForward?null:m6}function f6(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();L4(t,e),e._a=n.mountBlock(t,r,U4),e._j=n.mountBlock(t,r,V4),e._r=n.mountBlock(t,r,X4),e._z=n.mountBlock(t,r,Z4),e._16=n.mountBlock(t,r,r6);var i=n.insert(r,n.elem("div",R4)),s=n.createInjector(i);n.setClass(i,"main-okmsg"),e._1h=n.mountBlock(t,s,i6);var u=n.insert(s,n.elem("div",R4));n.setRef(t,"wrap",u);var c=n.appendChild(u,n.elem("div",R4));n.setRef(t,"scroller",c);var p=e._1q=n.appendChild(u,n.createComponent("msg-input",a$,t));n.setRef(t,"input",p);var l=e._1r=n.propsSet(p,{multiline:!0,animatedEmoji:!0,"data-tsid":"write_msg_input"});return s6(0,l,t,e),e._1s=n.addEvent(p,"click",P4,t,e),e._1t=n.addEvent(p,"editor-selectionchange",J5,t,e),e._1u=n.addEvent(p,"editor-formatchange",Z5,t,e),e._1v=n.addEvent(p,"editor-update",$5,t,e),e._1w=n.addEvent(p,"input-submit",c4,t,e),e._1x=n.addEvent(p,"input-blur",o4,t,e),e._1y=n.addEvent(p,"scroll",a4,t,e),n.mountComponent(p,l),e._1z=n.mountBlock(t,s,_6),n.subscribeStore(t,["config","chats","isMobile","isTouchDevice"]),n.finalizePendingRefs(t,a),g6}function g6(t,e){var o=e._1q,r=e._1r;L4(t,e),n.updateBlock(e._a),n.updateBlock(e._j),n.updateBlock(e._r),n.updateBlock(e._z),n.updateBlock(e._16),n.updateBlock(e._1h),s6(0,r,t,e),n.updateComponent(o,r),n.updateBlock(e._1z),n.finalizePendingRefs(t,e._1)}z4.dispose=function(t){t._f=n.removeEvent("toggle-format",t._f),t._g=n.removeEvent("reset-format",t._g),t._h=n.removeEvent("pick-link",t._h),t._d=n.unmountComponent(t._d),t._e=null},H4.dispose=function(t,e){var o=t._o;n.animate(o,ZU(0,{duration:200,easing:nN}),(function(){return function(t){var e=t._o;t._q=n.removeEvent("submit",t._q),t._o=n.unmountComponent(e),n.domRemove(e),t._p=null}(t)}))},G4.dispose=function(t,e){var o=t._w;n.animate(o,ZU(0,{duration:200,easing:nN}),(function(){return function(t){var e=t._w;t._y=n.removeEvent("submit",t._y),t._w=n.unmountComponent(e),n.domRemove(e),t._x=null}(t)}))},J4.dispose=function(t){t._14=n.removeEvent("close",t._14),t._15=n.removeEvent("submit",t._15),t._12=n.unmountComponent(t._12),t._13=null},n6.dispose=function(t,e){n.animate(t._1b,n.createAnimation("global:msg-pop-out .15s ease-out",R4),(function(){return function(t){var e=t._1b;t._1d=n.removeEvent("mouseenter",t._1d),t._1e=n.removeEvent("mouseleave",t._1e),t._1f=n.removeEvent("select",t._1f),t._1b=n.unmountComponent(e),n.domRemove(e),t._1c=null}(t)}))},a6.dispose=function(t){t._1m=n.unmountSlot(t._1m)},c6.dispose=function(t){t._27=t._28=t._26=null},m6.dispose=function(t){t._23=n.unmountBlock(t._23),t._2b=n.unmountSlot(t._2b)},f6.dispose=function(t){t._a=n.clearBlock(t._a),t._j=n.clearBlock(t._j),t._r=n.clearBlock(t._r),t._z=n.clearBlock(t._z),t._16=n.clearBlock(t._16),t._1h=n.unmountBlock(t._1h),t._1s=n.removeEvent("click",t._1s),t._1t=n.removeEvent("editor-selectionchange",t._1t),t._1u=n.removeEvent("editor-formatchange",t._1u),t._1v=n.removeEvent("editor-update",t._1v),t._1w=n.removeEvent("input-submit",t._1w),t._1x=n.removeEvent("input-blur",t._1x),t._1y=n.removeEvent("scroll",t._1y),t._1q=n.unmountComponent(t._1q),t._1z=n.unmountBlock(t._1z)};var v6={__proto__:null,cssScope:R4,default:f6,slideUp:ZU,slideDown:$U,easeOutCubic:nN,plugins:W5,extend:Y5,state:function(t){return{parseOptions:G5,_prevUrls:[],_pending:new a,_updateUrls:o.throttle((function(){if(qS(t)){var e=b4(t);if(e){var n=t.state._prevUrls||[],o=y4(e.model);qw(n,o,!0)||(t.state._prevUrls=o,g4(t,!0))}}}),500)}},didMount:function(t){return f4(t),function(t){if("undefined"==typeof ResizeObserver)return;var e,n=-1,o=t.refs,r=o.wrap,a=o.input,i=new ResizeObserver((function(){var o=a.clientHeight;if(-1===n)r.style.height="".concat(o,"px");else if(n!==o){var i=r.clientHeight;e&&e();var s=150;n>o&&!k4(t).isEmpty()&&(s=Math.min(200+n-o,500)),e=function(t,e,n,o){var r,a=n-e,i=o.duration,s=Date.now(),u=function(){r&&(cancelAnimationFrame(r),r=0,t.style.height="".concat(n,"px"))},c=function(){var n=Date.now()-s;if(n>=i)u();else{var p=o.easing(n,0,1,i);t.style.height="".concat(e+p*a,"px"),r=requestAnimationFrame(c)}};return t.scrollTop=0,c(),u}(r,i,o,{easing:nN,duration:s})}n=o}));return i.observe(a),function(){i.disconnect(),e&&e()}}(t)},didChange:function(t,e){var o=e.chatId,r=e.posting,a=e.textEmoji,i=e.markdown,s=e.command;if((a||i||s)&&function(t){var e=t.props,o=e.textEmoji,r=e.command;t.setState({parseOptions:n.__assign(n.__assign({},G5),{textEmoji:o,command:r,markdown:!1})})}(t),null==o?void 0:o.current){var u=t.store.get().chats.get(o.current);t.setState({parseOptions:n.__assign(n.__assign({},t.state.parseOptions),{mention:"DIALOG"!==u.type})})}if(o)s4(t),t.setState({_prevTokenType:void 0,_scheduleDraftSync:!1}),v4(t),A4(t),M4(t),r?(f4(t),j4(t,!0)):function(t){var e=t.refs.input;e&&e.replaceValue("");s4(t),A4(t)}(t);else if(r){var c=r.current,p=r.prev;!function(t,e){void 0===e&&(e=t.props.posting);var n=t.state,o=n._text,r=n._elements;e&&o===e.text&&r===e.messageElements||f4(t)}(t),"EDIT"===(null==c?void 0:c.type)&&"EDIT"!==(null==p?void 0:p.type)&&u4(t),c&&c.text||(s4(t),A4(t),M4(t))}},didSlotUpdate:function(t,e,n){"right"===e&&requestAnimationFrame((function(){t.setState({rightSize:n.parentNode.clientWidth})}))},didRender:function(t,e){var n=e.chatId;(null==n?void 0:n.current)&&(j4(t),S4(t))},willUnmount:function(t){v4(t),clearTimeout(F5)},onToggleFormat:X5,onResetFormat:Q5,onSelectionChange:J5,onEditorUpdate:$5,onFormatChange:Z5,onSubmitMention:t4,onSubmitCommand:e4,onSubmitLink:n4,onInputBlur:o4,onPickLinkClose:r4,onEditorScroll:a4,updateToolbar:i4,hideToolbar:s4,focusInput:u4,handleSubmit:c4,getToolbarPos:d4,getEditor:b4,pickLink:w4,onLinkEnter:function(t,e){if(e.stopPropagation(),!t.state.completeMentions){var o=e.target;if(o.classList.contains("mention")){var r=o.getAttribute("href");if("@"===r[0]){var a=Number(r.slice(1)),i=t.store.get().contacts.get(a);if(i){var s=J1(i),u=b4(t),c=document.createRange();c.selectNode(o);var p=n.rangeToLocation(u.element,c),l=_4(c),m=t.getBoundingClientRect(),d=[l.left-m.left,m.bottom-l.top];x4(),function(t,e){if(e.link||e.ownName&&e.ownName!==e.name)return!0;return t.innerText!==e.name}(o,s)&&t.setState({hoveredMention:{pos:d,mention:s,range:p}})}}}}},onLinkLeave:E4,onHoverLinkReset:x4,onReplaceMention:I4,inputClick:P4};function h6(t){return!!t&&!!t.posting&&!!t.posting.forward}function C6(t){if("DIALOG"===t.type){var e=function(t){var e=t.participants.find((function(t){return!t.user.current}));return e&&e.user}(t);if(e)return"PRIVATE_".concat(e.id)}else if("CHAT"===t.type)return"CHAT_".concat(Math.abs(t.id));return""}function k6(){return 1e3*Math.random()+100|0}var b6,y6=["VIDEO","PHOTO"],S6=3145728,w6="postcards",E6=!1;var x6={hashtag:!0,link:!0,textEmoji:!1,userSticker:!0,mention:!0,markdown:!1,command:!1,stickyLink:!0};var I6={"attach-files":function(t,e){e.target!==t&&(e.stopPropagation(),K6(t,e.detail))},"toggle-assets":l8,"hide-assets":p8,"post-user-sticker":p8,"pick-sticker":function(t){y8("send-sticker"),p8(t)},"pick-emoji":function(t,e){e.stopPropagation();var n=t.refs.inputField;if(e.detail.emoji&&n){var o=t.store.get().isTouchDevice;o||n.focus(!1),n.insertEmoji(e.detail.emoji,e.detail.emojiData,o)}},"post-gif":function(t,e){e.stopPropagation(),p8(t);var n=e.detail;Zt(t,"attach-ids",Gv(t,{attaches:[{_type:"PHOTO",photoToken:n.photoToken,photoId:n.photoId,height:n.height,width:n.width}]})),y8("send-gif")},"post-gif-kikliko":function(t,e){e.stopPropagation(),p8(t),function(t,e){var n=function(n){n.width=t.width,n.height=t.height,K6(e,[n],"gif")},o=function(t){return pX&&pX.has(t)?pX.get(t):null}(t.fullMp4);if(o)return void n(o);BX(t.fullMp4).then((function(t){n(t)})).catch((function(t){MX("error-load-to-send",t),Zt(e,"show-toast",V("kikliko-gif-load-error"))}))}(e.detail,t)},"input-blur":function(t,e){var n=t.refs.inputField;n&&n.storeSelection(e.detail.selection)},cancel:function(t,e){e.stopPropagation(),h8(t)},"reset-congrats-tab":function(t,e){e.stopPropagation(),t.setState({congratsSection:null})},"set-default-congrats-tab":function(t,e){e.stopPropagation(),t.setState({congratsSection:t.props.congrats.defaultSection})},"set-notify-typing":function(t,e){var n=t.props.chat;e.detail.chatId=n.id},click:function(t,e){var n=!1,o=e.target;if(t.store.get().isMobile||o.closest("msg-input"))return;for(;o&&o!==t;){if(o.classList&&(o.classList.contains("js-buttons")||o.classList.contains("js-toggler"))){n=!0;break}o=o.parentNode}var r=t.refs.inputField;!n&&r&&z6(t,!0)}};var B6={updateSize:function(){this.refs.audioInput&&this.refs.audioInput.resizeHandler()},focus:function(){z6(this)},blur:function(){D6(this)},attachFiles:function(t,e){K6(this,t,e)},insertText:function(t){var e=this.refs.inputField;e&&(e.focus(),e.insertText(t))},attachesSelected:function(t){var e=this.props.chat,n=t.chatId,o=t.attaches;e&&e.id===n&&function(t,e){var n=e.map((function(e){if("MUSIC"!==e.type){var n=V6(e);return n||console.warn("Неизвестный тип аттача",e.type),n}!function(t,e){var n=V6(e);n&&Zt(t,"attach-ids",Gv(t,{attaches:[n]}))}(t,e)})).filter(Boolean);n.length&&K6(t,n,"media")}(this,o)},showAssets:function(t){t&&t.tab?this.setState({activeAssetsTab:t.tab,assetsQuery:{tab:t.tab,query:t.query}}):this.setState({activeAssetsTab:w6}),c8(this)},showCongrats:function(t){var e={congratsMenuActive:!0};t&&(e=Object.assign({},e,{congratsSection:t})),this.setState(e)},hideCongrats:function(){this.setState({congratsMenuActive:!1})},updateCongrats:function(t){var e=this.props.congrats;t?this.setState({congratsSection:t,congratsEmoji:D1(e.tabsEmojies,t)}):(this.setState({congratsSection:e.defaultSection,congratsEmoji:null}),this.refs.sendActionCongratsMenu.resetTabs())}};function M6(t){return t.refs.inputField.editor}function A6(t){var e=M6(t),o=e.getSelection(),r=o[0],a=o[1],i=e.tokenForPos(r),s=e.tokenForPos(a),u=e.model,c=!1,p=n.TokenFormat.None;if(i){p=i.format,i.type!==n.TokenType.Link||i.auto||(p|=n.TokenFormat.Link);for(var l=u.indexOf(i),m=u.indexOf(s);l<=m;){var d=u[l++];if(d&&d.format){c=!0;break}}}t.setState({toolbarFormat:p,resetFormat:c}),function(t){var e=d4(t),n=t.state.toolbarPos;n&&qw(n,e)||t.setState({toolbarPos:e})}(t)}function T6(t,e){!function(t,e){Zt(t,"update-posting-message",Gv(t,e))}(t,e.detail.posting)}function j6(t){t.setState({completeMentions:!1,completeCommands:!1,commandsBot:void 0,prefix:void 0,_prevTokenType:null})}function P6(t,e,n){if(function(t,e){if(x8(t))return!0;var n=t.refs.audioInput;if(n&&"idle"!==n.getStatus())return n.cancel(),!0;var o=hr(t),r=dr(o)&&o!==t.refs.inputField.refs.input||(a=e.target,!a.closest("msg-app"));var a;if(!r)return!1;var i=t.props.chat.posting;if(t.state.assets)return p8(t),!0;if(t.state.congratsMenuActive)return m8(t),!0;if(i&&("REPLY"===i.type||"EDIT"===i.type))return d8(t),!0;if(i&&i.upload)return function(t){var e=xm(t.props.chat,"posting.upload");if(e){var n=Array.from(e.values()).filter((function(t){return"AUDIO"!==t._type}));if(n.length)f8(n[n.length-1].file,t)}}(t),!0;if(t.state.voiceMode)return h8(t),!0;return!1}(t,e))return e.stopPropagation(),void e.preventDefault();n()}function R6(t,e){"ArrowUp"===e.key&&(t.refs.inputField.value||(e.preventDefault(),Zt(t,"edit-last-message",Gv(t)),focus(t,!0)))}function L6(t){t.state._text=t.state._elements=null}function O6(t,e){t.store.isMobile()||z6(t,e)}function z6(t,e){void 0===e&&(e=!0);var n=t.refs.inputField;n&&n.focus(e)}function D6(t){var e=t.refs.inputField;e&&e.blur()}function U6(t){return{chatId:t.id}}function N6(t){Zt(t,"open-music-attach-layer",U6(t.props.chat))}function q6(t){Zt(t,"open-video-attach-layer",U6(t.props.chat))}function H6(t){var e=U6(t.props.chat);Bm(e,"maxCount",12),t.store.get().config.server["propagate-photo-attach-layer"]&&(e.openOnWeb=!0),Zt(t,"open-photo-attach-layer",e)}function F6(t,e){Zt(e,"open-transfer-money-layer",{friendId:t})}function V6(t){switch(t.type){case"PHOTO":case"VIDEO":return t.file;case"PHOTOODKL":return{_type:"PHOTO",photoId:Number(t.id),url:t.url,previewUrl:t.previewUrl,width:Number(t.width),height:Number(t.height)};case"VIDEOODKL":return{_type:"VIDEO",videoId:Number(t.id),url:t.preview,width:Number(t.width),height:Number(t.height)};case"MUSIC":return{_type:"MUSIC",trackId:t.trackId,title:t.title,artistName:t.artistName,imageUrl:t.imageUrl,duration:t.duration,context:t.context}}}function K6(t,e,n){void 0===n&&(n=t.state.attachType);var o=t.props.autoUpload;"photo"===n&&(n="media",e.forEach((function(t){/^video\//.test(t.type||"")&&t.size<S6&&(t._photo=!0)}))),Zt(t,"attach-files",Gv(t,{files:e,type:n,autoUpload:o})),t.setState({attachType:null}),O6(t)}function W6(t){l8(t)}function G6(t,e){Zt(e,"open-send-gift-page",{friendId:t})}function Y6(t,e){Zt(t,"log-action","ASSETS_TAB_"+(w6=e.detail)),t.setState({activeAssetsTab:w6})}function X6(t,e){var n;"mobile_photo"===t?(t="photo",n=e.refs.attachPhoto):n="media"===t||"photo"===t?e.refs.attachMedia:e.refs.attachFile,e.setState({attachType:t}),n&&n.click()}function Q6(t,e){for(var n=e.target,o=n.files,r=[],a=0;a<o.length;a++)r.push(o.item(a));r.length&&(K6(t,r),n.value=null),t.store.get().isTouchDevice&&x8(t)}function J6(t){var e=t.store,n=t.props.chat;return e.get().posting.get(n.id)}var $6=10;function Z6(t){var e=J6(t),n=t.refs.inputField;if(n){var o=n.getChunks();if(e&&e.upload)for(var r,i=Array.from(e.upload),s=0,u=0;s<i.length;)(r=o[u])||(r={text:"",elements:[]},o[s]=r),r.upload=new a(i.slice(s,s+$6)),u++,s+=$6;return o}return[]}function t8(t,e,n){t?"submit"!==n.type&&i8(e,n):e8(e,n)}function e8(t,e){e&&(e.stopPropagation(),e.preventDefault());var n=t.props.chat,r=n.posting;r&&(r.voiceMessage&&r.voiceMessage.recording?Zt(t,"voice-message-update",{chatId:n.id,recording:!1}):o.isEmptyPosting(r)||o.isEmptyEdit(r,t.props.config)||Zt(t,"commit-posting-message",{chunks:Z6(t),chatId:n.id}),_8(t))}function n8(t){var e=t.props.chat.id;t.setState({voiceMode:"recording"}),Zt(t,"voice-message-update",{chatId:e,recording:!0}),t.state.fromSubmit&&requestAnimationFrame((function(){t.refs.audioInput.setFocus()}))}function o8(t,e){var n=t.props.chat;if(n.posting&&n.posting.voiceMessage){var o=new File([e.detail.audioBlob],"voice.m4a",{type:"audio/m4a"});K6(t,[o],"media"),Zt(t,"voice-message-update",{chatId:n.id,recording:!1,wave:e.detail.wave,duration:e.detail.duration,url:e.detail.url}),!n.posting||t.state.voiceMode||requestAnimationFrame((function(){e8(t)}))}}function r8(t){h8(t)}function a8(t,e){"microphone_timeout"===e.detail.error&&Zt(t,"show-toast",V("microphone-timeout")),e.detail&&e.detail.error&&0===e.detail.error.code&&Zt(t,"show-toast",V("microphone-permission-error")),r8(t)}function i8(t,e){e.stopPropagation(),e.preventDefault(),t.state.voiceMode||t.setState({voiceMode:"preparing",fromSubmit:"submit"===e.type})}function s8(t,e){var n=t.state.attachmentMenuHover;(t.store.get().isTouchDevice||n)&&(Zt(t,"attach-button-click",{show:!n.isActive()}),n.toggle())}function u8(t,e){if(!t.disabled){var n=e.props.chat,o=t.id;switch(Zt(e,"attach-menu-click",{menuId:o}),x8(e),o){case"send_money":F6(C8(n).id,e);break;case"send_present":G6(C8(n).id,e);break;case"video_message":Zt(e,"record-video");break;case"voice_message":i8(e);break;case"send_contact":Zt(e,"send-contact-enter",[n.id]);break;case"select_file":X6("file",e);break;case"select_audio":N6(e);break;case"select_video":q6(e);break;case"select_photo":H6(e);break;case"mobile_photo":X6("mobile_photo",e);break;case"select_photo_from_pc":X6("photo",e);break;case"select_video_from_pc":X6("media",e);break;case"mobile_music":var r=function(t){var e=C6(t);if(e)return"/dk?st.cmd=userChatAttachMusic&st.convId="+e+"&_prevCmd=userChat&tkn="+k6()}(n);r&&(location.href=r)}}}function c8(t){Zt(t,"active-assets",!0),Zt(t,"log-action","ASSETS_PANEL_SHOW"),t.setState({assets:!!t.props.assets})}function p8(t){if(t.state.assets){t.setState({assets:null,assetsQuery:null}),Zt(t,"active-assets",!1);var e=t.refs.inputField;!e||e.focused||t.store.get().isTouchDevice||e.focus()}}function l8(t){t.state.assets?p8(t):(!function(t){var e=t.props;e.config.server["forget-constructor-tab"]&&b6&&"sticker-constructor"===t.state.activeAssetsTab&&t.setState({activeAssetsTab:b6})}(t),c8(t))}function m8(e){var n=e.state.congratsMenuActive;e.setState({congratsMenuActive:!n}),n||new Promise((function(e,n){t(["OK/logger"],e,n)})).then((function(t){t.success("messagesLayer.congrats","show.tabutton",e.state.congratsSection)}))}function d8(t){Zt(t,"reset-posting-link",Gv(t))}function _8(t){var e=t.refs.inputField;e&&(e.value=""),t.setState({commandsList:null,voiceMode:null,fromSubmit:!1}),O6(t),function(t){t.setState({suggestCommands:null})}(t),function(t){t.setState({suggestMentions:null})}(t)}function f8(t,e){Zt(e,"remove-attach",Gv(e,{file:t})),O6(e)}function g8(t,e){if("PHOTO"===t._type){S8("open");var n=t.file||t;Zt(e,"preview-photo",{file:n,options:{crop:!0,action:function(t){return function(t,e,n){S8("submit");var o=t.props,r=o.autoUpload;Zt(t,"replace-attach",Gv(t,{from:e,to:n,autoUpload:r}))}(e,t.originFile,t.file)}}})}}function v8(t,e){"Enter"===e.key&&e.preventDefault()}function h8(t){var e=t.props.chat,n=e.posting;t.setState({voiceMode:null,fromSubmit:!1}),Zt(t,"voice-message-reset",{chatId:e.id}),n&&n.upload&&n.upload.forEach((function(e,n){Zt(t,"remove-attach",Gv(t,{file:n}))}))}function C8(t){var e=t.participants.find((function(t){return!t.user.current}));return e&&e.user}function k8(t){var e=t.props.chat,n=t.store.get(),o=n.config,r=n.isMobile;if(r){var a=[b8("select_file","file","file"),b8("select_video_from_pc","video","send-video")];return"DIALOG"!==e.type&&"CHAT"!==e.type||a.push(b8("mobile_music","music","music")),a.push(b8("mobile_photo","photocamera","send-photo")),a}var i=function(t){var e=t.store.get(),n=e.config;return n.server["video-messages"]}(t),s=o.server["audio-messages"],u=o.server["contacts-send"],c=[];return r||"DIALOG"!==e.type||o.server["attach-remove-money-present"]||c.push(b8("send_money","money","send-money"),b8("send_present","gift","send-present"),b8("divider")),i&&c.push(b8("video_message","video","button-video")),s&&(c.push(b8("voice_message","microphone","button-audio")),i&&c.push(b8("divider"))),u&&c.push(b8("send_contact","user","contact")),c.push(b8("select_file","file","file"),b8("select_audio","music","music"),b8("select_video","video","send-video"),b8("select_photo","photo","send-photo")),o.server["attach-remove-photo-upload"]||c.push(b8("select_photo_from_pc","photocamera","photo-upload")),c}function b8(t,e,n,o){return{id:t,icon:e,label:n,disabled:o}}function y8(t){window.OK.logger.success("messagesLayer",t)}function S8(t){OK.logger.success("messagesLayer","edit-photo",t)}function w8(t,e){var n=t.store.get().config,o=n.server&&n.server["max-msg-length"]||4e3,r=J6(t);void 0===e&&(e=r?(r.text||"").length:0);var a=e/o,i=r&&r.upload?r.upload.size/$6:0;return Math.ceil(Math.max(a,i))}function E8(t,e){var o=e.detail,r=o.editor,a=o.input,i=r?n.getLength(r.model):a.value.length;t.setState({chunkCount:w8(t,i)})}function x8(t){var e=t.state,n=e.attachmentMenuHover,o=e.attachmentMenu;return!(!n||!o)&&(n.exit(0),!0)}var I8="e-apvwsv",B8=[0,0,0,0,0,0],M8=[];function A8(){M8.push(B8),B8=[0,0,0,0,0,0]}function T8(){B8=M8.pop()}function j8(t,e){e.posting=n.get(t.props.chat,"posting"),e.participants=n.filter(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})),e.maxLength=n.get(t.props.config,"server","max-msg-length")||t.state.defaultMaxMsgLength,e.chunkLength=n.get(e.posting,"text","length")%e.maxLength,e.remainingSymbols=e.chunkLength?e.maxLength-e.chunkLength:0,e.saveDisabled="EDIT"===n.get(e.posting,"type")&&(e.remainingSymbols<0||!n.get(e.posting,"text")&&!n.get(e.posting,"link","attaches","length")),e.showCounter=n.get(e.posting,"text","length")&&e.remainingSymbols<=t.props.warningThreshold,e.canRecord="EDIT"!==n.get(e.posting,"type")&&t.state.supportsAudio&&!e.saveDisabled&&!n.get(e.posting,"text")&&!n.get(e.posting,"voiceMessage")&&!Tt(0,t.state.attaches),e.voicePreparing="preparing"===t.state.voiceMode,e.voiceRecordAction=t.state.supportsMedia&&e.canRecord&&!t.state.voiceMode,e.postPreview=void 0,e.showCongratsBtn=!e.postPreview&&!n.get(e.posting,"voiceMessage")&&"DIALOG"===n.get(t.props.chat,"type")&&n.get(t.props.congrats,"taButtonEmoji"),e.cSession=n.get(t.props.chat,"constructorSession"),e.cCountUploads=Tt(0,n.get(e.cSession,"uploads")),e.allowTextInput=!n.get(e.posting,"preview")&&!e.cCountUploads,e.chooseExpr=e.voicePreparing?0:e.voiceRecordAction?1:2,e.caseExpr_1=1===e.chooseExpr,e.caseExpr_2=2===e.chooseExpr}function P8(t,e,n,o){e.preventDefault(),t8(o.voiceRecordAction,t,e)}function R8(t,e,o,r){e.chatId=n.get(o.props.chat,"id"),e.autofocus=!o.store.data.isTouchDevice,e.posting=r.posting,e.disabled=!r.allowTextInput||o.state.voiceMode,e.placeholder=o.store.data.l10n("write-message"),e.chunkLength=r.maxLength,e.command=n.get(o.props.chat,"hasBots"),e.textEmoji=n.get(o.store.data.config,"server","text-emoji-mode"),e.markdown=n.get(o.store.data.config,"user","MARKDOWN")}function L8(t,e,o,r){e.active=o.state.congratsMenuActive,e.url=n.get(o.props.congrats,"url"),e.section=o.state.congratsSection,e.defaultSection=n.get(o.props.congrats,"defaultSection"),e.friendId=n.get(r.participants,0,"user","id")}function O8(t,e,n){e.class="secondary-okmsg"+(n.state.assets?" __open-okmsg":""),e.title=n.store.data.l10n("button-congrats")}function z8(t,e,o){var r=o._16=n.insert(e,n.createComponent("button",fe,t),""),a=r.componentModel.input,i=o._17=n.propsSet(r,{type:"button",tabindex:"-1",shape:"circle",size:"big","data-l":"t,sendCongrats","data-tsid":"send_congrats_button"});O8(0,i,t),o._18=n.addEvent(r,"click",m8,t,o);var s=o._19=n.insert(a,n.createComponent("msg-parsed-text",ii,t),""),u=s.componentModel.input;return o._1b=n.insert(u,n.text(t.state.congratsEmoji||n.get(t.props.congrats,"taButtonEmoji"))),n.mountComponent(s,n.propsSet(s,{emojiContext:"send-congrats",emojiSize:20})),n.mountComponent(r,i),B8[1]=1,D8}function D8(t,e){var o=e._16,r=e._17;O8(0,r,t),B8[2]|=n.updateText(e._1b,t.state.congratsEmoji||n.get(t.props.congrats,"taButtonEmoji")),n.updateIncomingSlot(e._19,"",B8[2]),n.updateComponent(o,r)}function U8(t,e){return e.showCongratsBtn?z8:null}function N8(t,e,o){var r=o._11=n.insert(e,n.createComponent("msg-send-action-congrats-menu",Y1,t)),a=r.componentModel.input;n.setPendingRef(o._1,"sendActionCongratsMenu",r);var i=o._12=n.propsSet(r);return L8(0,i,t,o),o._13=n.mountBlock(t,a,U8),n.mountComponent(r,i),B8[0]=1,q8}function q8(t,e){var o=e._11,r=e._12;n.setPendingRef(e._1,"sendActionCongratsMenu",o),L8(0,r,t,e),n.updateBlock(e._13),n.updateIncomingSlot(o,"",B8[1]),n.updateComponent(o,r)}function H8(t){return n.get(t.props.congrats,"url")&&t.props.proAllowed?N8:null}function F8(t,e,n){e.config=n.store.data.config,e.tab=n.state.activeAssetsTab,e.order=n.state.assetsTabsOrder,e.query=n.state.assetsQuery}function V8(t,e){var o=e._1n,r=e._1o;n.setPendingRef(e._1,"assets",o),F8(0,r,t),n.updateComponent(o,r)}function K8(t,e,o){return o._1m?V8(t,o):function(t,e,o){var r=o._1m=n.insert(e,n.elem("div",I8));n.setClass(r,"popup-okmsg");var a=o._1n=n.appendChild(r,n.createComponent("msg-assets-panel",t1,t));n.setPendingRef(o._1,"assets",a);var i=o._1o=n.propsSet(a,{"data-tsid":"smiles-block"});F8(0,i,t),o._1p=n.addEvent(a,"keydown",v8,t,o),o._1q=n.addEvent(a,"select-tab",Y6,t,o),n.mountComponent(a,i),B8[3]=1}(t,e,o),n.animate(o._1m,n.createAnimation("global:msg-pop-in 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275)",I8)),W8}function W8(t,e){V8(t,e)}function G8(t){return t.state.assets?K8:null}function Y8(t,e,n){e.title=n.store.data.l10n("button-attachments")}function X8(t,e,n){e.stopPropagation(),s8(t)}function Q8(t,e){n.call(t.state.attachmentMenuHover,"reset")}function J8(t,e){n.call(t.state.attachmentMenuHover,"exit")}function $8(t,e){var o=e._1w;t.store.data.isTouchDevice||(n.setPendingEvent(o,"mouseenter",Q8,e),n.setPendingEvent(o,"mouseleave",J8,e))}function Z8(t,e){n.call(t.state.attachmentMenuHover,"enter")}function t7(t,e){n.call(t.state.attachmentMenuHover,"exit")}function e7(t){return t.state.attachmentMenu}function n7(t,e){var o=n.insert(e,n.elem("div",I8),"");n.setClass(o,"divider-okmsg"),B8[4]=1}function o7(t,e,o,r){e.disabled=n.get(r.value,"disabled"),e["data-l"]="t,"+n.get(r.value,"id"),e["data-tsid"]=n.get(r.value,"id")}function r7(t,e,n,o){u8(o.value,t)}function a7(t,e,o,r){e.icon=n.get(r.value,"icon")}function i7(t,e,o,r){e.key=n.get(r.value,"label")}function s7(t,e,o){var r=o._2o=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._2p=n.propsSet(r,{role:"menuitem",tabindex:"-1"});o7(0,i,0,o),o._2q=n.addEvent(r,"click",r7,t,o);var s=o._2r=n.insert(a,n.createComponent("msg-tico",rc,t),""),u=s.componentModel.input,c=o._2s=n.propsSet(s,{size:"medium"});a7(0,c,0,o);var p=o._2t=n.insert(u,n.createComponent("msg-l10n",ae,t),""),l=o._2u=n.propsSet(p);return i7(0,l,0,o),n.mountComponent(p,l),n.mountComponent(s,c),n.mountComponent(r,i),B8[4]=1,u7}function u7(t,e){var o=e._2o,r=e._2p,a=e._2r,i=e._2s,s=e._2t,u=e._2u;o7(0,r,0,e),a7(0,i,0,e),i7(0,u,0,e),n.updateComponent(s,u),n.updateComponent(a,i),n.updateComponent(o,r)}function c7(t,e){return"divider"===n.get(e.value,"id")?n7:s7}function p7(t,e,o){return o._2i=n.mountBlock(t,e,c7),l7}function l7(t,e){n.updateBlock(e._2i)}function m7(t,e){n.updateIterator(e._2f),n.updateIncomingSlot(e._2a,"",B8[4])}function d7(t,e,o){return o._2a?m7(0,o):function(t,e,o){var r=o._2a=n.insert(e,n.createComponent("msg-menu",bS,t)),a=r.componentModel.input;o._2c=n.mountUse(t,r,Yw),o._2d=n.addEvent(r,"mouseenter",Z8,t,o),o._2e=n.addEvent(r,"mouseleave",t7,t,o),o._2f=n.mountIterator(t,a,e7,p7),n.mountComponent(r,n.propsSet(r,{class:"attachment-menu-okmsg",id:"msg-attachment-menu","data-l":"t,attach-menu",role:"menu"})),B8[3]=1}(t,e,o),n.animate(o._2a,n.createAnimation("global:msg-pop-in .25s cubic-bezier(.4, 0, .3, 1.2)",I8)),_7}function _7(t,e){m7(0,e)}function f7(t){return t.state.attachmentMenu?d7:null}function g7(t,e,o){var r=o._1,a=o._1v=n.insert(e,n.createComponent("button",fe,t)),i=a.componentModel.input,s=o._1w=n.pendingEvents(t,a),u=o._1x=n.propsSet(a,{type:"button",shape:"circle",class:"secondary-okmsg",size:"big",tabindex:"0","data-l":"t,showAttachMenu","data-tsid":"open_attach_menu_button","aria-haspopup":"menu","aria-controls":"msg-attachment-menu"});Y8(0,u,t),o._1y=n.addEvent(a,"click",X8,t,o),$8(t,o);var c=o._22=n.insert(i,n.createComponent("msg-icon",xe,t),"");n.mountComponent(c,n.propsSet(c,{icon:"attach",size:"medium"})),n.finalizePendingEvents(s),n.mountComponent(a,u),o._25=n.mountBlock(t,e,f7);var p=o._2y=n.insert(e,n.elem("input",I8));n.setPendingRef(r,"attachFile",p),n.setAttribute(p,"type","file"),n.setClass(p,"attach-file-okmsg"),p.multiple=!0,n.setAttribute(p,"tabindex","-1"),o._2z=n.addEvent(p,"change",Q6,t,o);var l=o._30=n.insert(e,n.elem("input",I8));n.setPendingRef(r,"attachMedia",l),n.setAttribute(l,"type","file"),l.multiple=!0,n.setClass(l,"attach-media-okmsg"),n.setAttribute(l,"accept","video/*,image/*,.dv,.rm,.dat,.wm,.qt,.divx,.m2v,.ogm,.avi,.vob,.mpg,.mpe,.mpeg,.m2p,.mp4,.mov,.3gp,.asf,.wmv,.flv,.m4v,.m2ts,.mts,.3g2,.evo,.f4v,.mkv,.mcf,.ts,.mxf,.ogg,.rmvb,.webm,.vcd,.svcd,.3gpp,.m4a,.torrent"),n.setAttribute(l,"tabindex","-1"),o._31=n.addEvent(l,"change",Q6,t,o);var m=o._32=n.insert(e,n.elem("input",I8));return n.setPendingRef(r,"attachPhoto",m),n.setAttribute(m,"type","file"),m.multiple=!0,n.setClass(m,"attach-photo-okmsg"),n.setAttribute(m,"tabindex","-1"),n.setAttribute(m,"accept","image/*"),o._33=n.addEvent(m,"change",Q6,t,o),B8[3]=1,v7}function v7(t,e){var o=e._1v,r=e._1x,a=e._1;Y8(0,r,t),$8(t,e),n.finalizePendingEvents(e._1w),n.updateComponent(o,r),n.updateBlock(e._25),n.setPendingRef(a,"attachFile",e._2y),n.setPendingRef(a,"attachMedia",e._30),n.setPendingRef(a,"attachPhoto",e._32)}function h7(t,e){return n.get(e.posting,"voiceMessage")||"EDIT"==n.get(e.posting,"type")&&!n.get(t.store.data.config,"server","editable-attachments")?null:g7}function C7(t,e,n){e.class="secondary-okmsg"+(n.state.assets?" __active-okmsg":"")+(n.state.showNewBubble?" __new-okmsg":""),e.title=n.store.data.l10n("button-smiles")}function k7(t,e,n){e.stopPropagation(),W6(t)}function b7(t,e,o){var r=o._37=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._38=n.propsSet(r,{type:"button",tabindex:"-1",shape:"circle",size:"big","data-l":"t,smiles","data-tsid":"open_smiles_button"});C7(0,i,t),o._39=n.addEvent(r,"click",k7,t,o);var s=o._3a=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{size:"medium",icon:"smiles"})),n.mountComponent(r,i),B8[3]=1,y7}function y7(t,e){var o=e._37,r=e._38;C7(0,r,t),n.updateComponent(o,r)}function S7(t,e){return n.get(e.posting,"voiceMessage")?null:b7}function w7(t,e,o,r){e.class="primary-okmsg"+(n.get(r.posting,"voiceMessage","recording")?" __pulse-okmsg":""),e.disabled=r.saveDisabled||r.voicePreparing,e.title=r.caseExpr_2?o.store.data.l10n("button-send"):r.caseExpr_1?o.store.data.l10n("button-record"):void 0}function E7(t,e,n,o){e.stopPropagation(),t8(o.voiceRecordAction,t,e)}function x7(t,e,n,o){e.stopPropagation(),t8(o.voiceRecordAction,t,e)}function I7(t,e,o){var r=o._3k=n.insert(e,n.createComponent("msg-progress",Ps,t),"");n.mountComponent(r,n.propsSet(r,{size:20,radius:8,thickness:2,indeterminate:!0,spin:!0})),B8[5]=1}function B7(t,e,o){var r=o._3o=n.insert(e,n.createComponent("msg-icon",xe,t),"");n.mountComponent(r,n.propsSet(r,{icon:"microphone"})),n.animate(r,n.createAnimation("switch-icon 0.2s",I8)),B8[5]=1}function M7(t,e,o){var r=o._3s=n.insert(e,n.createComponent("msg-icon",xe,t),"");n.mountComponent(r,n.propsSet(r,{icon:"send",size:"medium"})),B8[5]=1}function A7(t,e){return[I7,B7,M7][e.chooseExpr]}function T7(t,e,o){n.updateAttribute(t,e,"title",o.store.data.l10n("chunked-message-hint"))}function j7(t,e,o){var r=o._3y=n.insert(e,n.elem("div",I8)),a=o._3z=n.obj();return n.setClass(r,"chunks-okmsg"),T7(r,a,t),o._40=n.appendChild(r,n.text(n.get(o.posting,"chunks"))),B8[3]=1,P7}function P7(t,e){T7(e._3y,e._3z,t),B8[3]|=n.updateText(e._40,n.get(e.posting,"chunks"))}function R7(t,e){return!e.saveDisabled&&n.get(e.posting,"chunks")>1?j7:null}function L7(t,e,o){var r=o._r=n.insert(e,n.createComponent("msg-message-editor",v6,t)),a=r.componentModel.input;n.setPendingRef(o._1,"inputField",r);var i=o._s=n.propsSet(r,{showCounter:!1,"data-tsid":"write_msg_portlet"});R8(0,i,t,o),o._t=n.addEvent(r,"submit",e8,t,o),o._u=n.addEvent(r,"keydown",R6,t,o),o._v=n.addEvent(r,"editor-update",E8,t,o),o._w=n.addEvent(r,"posting-update",T6,t,o);var s=n.insert(a,n.elem("div",I8),"left"),u=n.createInjector(s);n.setClass(s,"buttons-okmsg js-buttons __left-okmsg"),n.setAttribute(s,"slot","left"),o._y=n.mountBlock(t,u,H8);var c=n.insert(a,n.elem("div",I8),"right"),p=n.createInjector(c);n.setAttribute(c,"role","toolbar"),n.setClass(c,"buttons-okmsg js-buttons __right-okmsg"),n.setAttribute(c,"slot","right"),o._1h=n.mountBlock(t,p,G8),o._1s=n.mountBlock(t,p,h7),o._34=n.mountBlock(t,p,S7);var l=o._3d=n.insert(p,n.createComponent("button",fe,t)),m=l.componentModel.input,d=o._3e=n.propsSet(l,{shape:"circle",size:"big","data-l":"t,sendButton","data-tsid":"button_send"});return w7(0,d,t,o),o._3f=n.addEvent(l,"click",E7,t,o),o._3g=n.addEvent(l,"touchstart",x7,t,o),o._3h=n.mountBlock(t,m,A7),n.mountComponent(l,d),o._3v=n.mountBlock(t,p,R7),n.mountComponent(r,i),O7}function O7(t,e){var o=e._r,r=e._s,a=e._3d,i=e._3e;n.setPendingRef(e._1,"inputField",o),R8(0,r,t,e),n.updateBlock(e._y),n.updateBlock(e._1h),n.updateBlock(e._1s),n.updateBlock(e._34),w7(0,i,t,e),n.updateBlock(e._3h),n.updateIncomingSlot(a,"",B8[5]),n.updateComponent(a,i),n.updateBlock(e._3v),n.updateIncomingSlot(o,"left",B8[0]),n.updateIncomingSlot(o,"right",B8[3]),n.updateComponent(o,r)}function z7(t,e){return n.get(e.posting,"voiceMessage")?null:L7}function D7(t,e,o,r){n.updateClass(t,e,"counter-okmsg"+(r.saveDisabled?" __error-okmsg":""))}function U7(t,e,o){var r=o._46=n.insert(e,n.elem("div",I8));return D7(r,o._47=n.obj(),0,o),o._48=n.appendChild(r,n.text(o.remainingSymbols)),N7}function N7(t,e){D7(e._46,e._47,0,e),n.updateText(e._48,e.remainingSymbols)}function q7(t,e){return e.showCounter?U7:null}function H7(t,e,o,r){n.updateClass(t,e,"input-okmsg"+(r.showCongratsBtn?" __offset-okmsg":""))}function F7(t,e,o,r){e.data=n.get(r.posting,"voiceMessage"),e.recording="recording"===o.state.voiceMode||"preparing"===o.state.voiceMode}function V7(t,e,o,r){e.class="primary-okmsg"+(n.get(r.posting,"voiceMessage","recording")?" __pulse-okmsg":""),e.title=o.store.data.l10n("button-send"),e.disabled=r.saveDisabled||r.voicePreparing}function K7(t,e,o){var r=o._4e=n.insert(e,n.createComponent("msg-audio-input",O1,t)),a=r.componentModel.input;n.setPendingRef(o._1,"audioInput",r);var i=o._4f=n.propsSet(r,{"data-tsid":"write_audio_input"});F7(0,i,t,o),o._4g=n.addEvent(r,"error",a8,t,o),o._4h=n.addEvent(r,"ready",o8,t,o),o._4i=n.addEvent(r,"cancel",r8,t,o),o._4j=n.addEvent(r,"start",n8,t,o);var s=o._4k=n.insert(a,n.createComponent("button",fe,t),"right"),u=s.componentModel.input,c=o._4l=n.propsSet(s,{slot:"right",shape:"circle",size:"big","data-l":"t,sendButton","data-tsid":"button_send"});V7(0,c,t,o),o._4m=n.addEvent(s,"click",e8,t,o);var p=o._4n=n.insert(u,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(p,n.propsSet(p,{icon:"send",size:"medium"})),n.mountComponent(s,c),n.mountComponent(r,i),W7}function W7(t,e){var o=e._4e,r=e._4f,a=e._4k,i=e._4l;n.setPendingRef(e._1,"audioInput",o),F7(0,r,t,e),V7(0,i,t,e),n.updateComponent(a,i),n.updateComponent(o,r)}function G7(t){return t.state.supportsMedia?K7:null}function Y7(t){return t.state.attaches}function X7(t,e){e.canPreview="EDIT"!==n.get(e.posting,"type")&&"completed"==n.get(e.value,"status")&&n.get(t.props.config,"server","photo-preview-enabled")}function Q7(t,e,n,o){e.attachment=o.value,e.canPreview=!!o.canPreview||void 0}function J7(t,e,o,r){f8(n.get(r.value,"file"),t)}function $7(t,e,n,o){g8(o.value,t)}function Z7(t,e){e.canPreview&&n.setPendingEvent(e._55,"click",$7,e)}function t9(t,e,o){X7(t,o);var r=o._54=n.insert(e,n.createComponent("msg-posting-attach",rF,t)),a=o._55=n.pendingEvents(t,r),i=o._56=n.propsSet(r);return Q7(0,i,0,o),o._57=n.addEvent(r,"close",J7,t,o),Z7(0,o),n.finalizePendingEvents(a),n.mountComponent(r,i),e9}function e9(t,e){var o=e._54,r=e._56;X7(t,e),Q7(0,r,0,e),Z7(0,e),n.finalizePendingEvents(e._55),n.updateComponent(o,r)}function n9(t,e){n.updateIterator(e._4z)}function o9(t,e,o){return o._4x?n9(0,o):function(t,e,o){var r=o._4x=n.insert(e,n.elem("div",I8));n.setClass(r,"wrap-okmsg");var a=n.appendChild(r,n.elem("div",I8)),i=n.createInjector(a);n.setClass(a,"form_attach-okmsg custom-scrollbar-okmsg"),o._4z=n.mountIterator(t,i,Y7,t9)}(t,e,o),n.animate(o._4x,aN(o._4x,t,{duration:300})),r9}function r9(t,e){n9(0,e)}function a9(t,e,n,o){e.posting=o.posting}function i9(t,e){var o=e._5f,r=e._5g;a9(0,r,0,e),n.updateComponent(o,r)}function s9(t,e,o){return o._5f?i9(0,o):function(t,e,o){var r=o._5f=n.insert(e,n.createComponent("msg-posting-share",MH,t)),a=o._5g=n.propsSet(r);a9(0,a,0,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._5f,aN(o._5f,t,{duration:300})),u9}function u9(t,e){i9(0,e)}function c9(t,e){return Tt(0,t.state.attaches)?o9:!n.get(e.posting,"shares","disabled")&&Tt(0,n.get(e.posting,"shares","items"))?s9:null}function p9(t,e){var o=t.componentView;A8();var r=e._1=n.obj();j8(t,e);var a=n.appendChild(o,n.elem("div",I8)),i=n.createInjector(a);n.setClass(a,"container-okmsg"),n.setAttribute(a,"data-tsid","write_msg_portlet");var s=n.insert(i,n.elem("form",I8)),u=n.createInjector(s);e._n=n.addEvent(s,"submit",P8,t,e),e._o=n.mountBlock(t,u,z7),e._43=n.mountBlock(t,u,q7);var c=e._49=n.insert(u,n.elem("div",I8)),p=n.createInjector(c);return H7(c,e._4a=n.obj(),0,e),e._4b=n.mountBlock(t,p,G7),e._4s=n.mountBlock(t,i,c9),T8(),n.subscribeStore(t,["isTouchDevice","l10n","config"]),n.finalizePendingRefs(t,r),l9}function l9(t,e){A8(),j8(t,e),n.updateBlock(e._o),n.updateBlock(e._43),H7(e._49,e._4a,0,e),n.updateBlock(e._4b),n.updateBlock(e._4s),T8(),n.finalizePendingRefs(t,e._1)}z8.dispose=function(t){t._18=n.removeEvent("click",t._18),t._19=n.unmountComponent(t._19),t._16=n.unmountComponent(t._16),t._17=t._1b=null,B8[1]=1},N8.dispose=function(t){t._13=n.unmountBlock(t._13),t._11=n.unmountComponent(t._11),t._12=null,B8[0]=1},K8.dispose=function(t,e){n.animate(t._1m,n.createAnimation("global:msg-pop-out 0.15s ease-in",I8),(function(){A8(),function(t){t._1p=n.removeEvent("keydown",t._1p),t._1q=n.removeEvent("select-tab",t._1q),t._1n=n.unmountComponent(t._1n),t._1m=n.domRemove(t._1m),t._1o=null,B8[3]=1}(t),n.updateIncomingSlot(t._r,"right",B8[3]),T8()}))},n7.dispose=function(){B8[4]=1},s7.dispose=function(t){t._2q=n.removeEvent("click",t._2q),t._2t=n.unmountComponent(t._2t),t._2r=n.unmountComponent(t._2r),t._2o=n.unmountComponent(t._2o),t._2p=t._2s=t._2u=null,B8[4]=1},p7.dispose=function(t){t._2i=n.unmountBlock(t._2i)},d7.dispose=function(t,e){n.animate(t._2a,n.createAnimation("global:msg-pop-out .15s ease-out",I8),(function(){return function(t){var e=t._2a;t._2c=n.unmountUse(t._2c),t._2d=n.removeEvent("mouseenter",t._2d),t._2e=n.removeEvent("mouseleave",t._2e),t._2f=n.unmountIterator(t._2f),t._2a=n.unmountComponent(e),n.domRemove(e),B8[3]=1}(t)}))},g7.dispose=function(t){t._1w=n.detachPendingEvents(t._1w),t._1y=n.removeEvent("click",t._1y),t._22=n.unmountComponent(t._22),t._1v=n.unmountComponent(t._1v),t._25=n.unmountBlock(t._25),t._2z=n.removeEvent("change",t._2z),t._31=n.removeEvent("change",t._31),t._33=n.removeEvent("change",t._33),t._1x=t._2y=t._30=t._32=null,B8[3]=1},b7.dispose=function(t){t._39=n.removeEvent("click",t._39),t._3a=n.unmountComponent(t._3a),t._37=n.unmountComponent(t._37),t._38=null,B8[3]=1},I7.dispose=function(t){t._3k=n.unmountComponent(t._3k),B8[5]=1},B7.dispose=function(t){var e=t._3o;n.stopAnimation(e,!0),t._3o=n.unmountComponent(e),B8[5]=1},M7.dispose=function(t){t._3s=n.unmountComponent(t._3s),B8[5]=1},j7.dispose=function(t){t._3z=t._40=t._3y=null,B8[3]=1},L7.dispose=function(t){t._t=n.removeEvent("submit",t._t),t._u=n.removeEvent("keydown",t._u),t._v=n.removeEvent("editor-update",t._v),t._w=n.removeEvent("posting-update",t._w),t._y=n.unmountBlock(t._y),t._1h=n.unmountBlock(t._1h),t._1s=n.unmountBlock(t._1s),t._34=n.unmountBlock(t._34),t._3f=n.removeEvent("click",t._3f),t._3g=n.removeEvent("touchstart",t._3g),t._3h=n.unmountBlock(t._3h),t._3d=n.unmountComponent(t._3d),t._3v=n.unmountBlock(t._3v),t._r=n.unmountComponent(t._r),t._s=t._3e=null},U7.dispose=function(t){t._47=t._48=t._46=null},K7.dispose=function(t){t._4g=n.removeEvent("error",t._4g),t._4h=n.removeEvent("ready",t._4h),t._4i=n.removeEvent("cancel",t._4i),t._4j=n.removeEvent("start",t._4j),t._4m=n.removeEvent("click",t._4m),t._4n=n.unmountComponent(t._4n),t._4k=n.unmountComponent(t._4k),t._4e=n.unmountComponent(t._4e),t._4f=t._4l=null},t9.dispose=function(t){t._55=n.detachPendingEvents(t._55),t._57=n.removeEvent("close",t._57),t._54=n.unmountComponent(t._54),t._56=null},o9.dispose=function(t,e){var o=t._4x;n.animate(o,iN(0,e,{duration:300}),(function(){return function(t){t._4z=n.unmountIterator(t._4z),t._4x=n.domRemove(t._4x)}(t)}))},s9.dispose=function(t,e){var o=t._5f;n.animate(o,iN(0,e,{duration:300}),(function(){return function(t){var e=t._5f;t._5f=n.unmountComponent(e),n.domRemove(e),t._5g=null}(t)}))},p9.dispose=function(t){A8(),t._n=n.removeEvent("submit",t._n),t._o=n.unmountBlock(t._o),t._43=n.unmountBlock(t._43),t._4b=n.unmountBlock(t._4b),t._4s=n.unmountBlock(t._4s),T8()};var m9={__proto__:null,cssScope:I8,default:p9,slideUpNotify:iN,slideDownNotify:aN,slideUp:ZU,slideDown:$U,easeOutCubic:nN,a11yContextPopup:Yw,props:function(){return{chat:{},config:{},assets:{},autoUpload:!0,warningThreshold:50,shouldFocus:!1,proAllowed:!0}},state:function(t){return{defaultMaxMsgLength:4e3,supportsAudio:Boolean(window.AudioContext||window.webkitAudioContext),assetsTabsOrder:null,activeAssetsTab:w6,attachmentMenu:null,congratsMenuActive:!1,attachmentMenuHover:US(t,(function(){return t.setState({attachmentMenu:k8(t)})}),(function(){return t.setState({attachmentMenu:null})}),300),attaches:[],showNewBubble:!1,parseOptions:x6,supportsMedia:!0}},events:I6,plugins:function(){return[DS({ESC:P6})]},extend:B6,updateToolbar:A6,onPostingUpdate:T6,onSubmitLink:function(t,e){var n=e.detail,o=n.label,r=n.value,a=t.state.pickLink;if(a){var i=M6(t),s=a.selection,u=s[0],c=s[1];a.label!==o&&i.replaceText(u,c,o||""),o&&i.setLink(r,u,u+o.length),A6(t)}},isInputCharacter:function(t){return t>=48&&t<=57||t>=65&&t<=90||t>=186&&t<=192||t>=219&&t<=222},handleKeyDown:R6,willMount:function(t){t.setState({supportsMedia:void 0!==navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia}),E6||(E6=!0,Zt(t,"assets-fetch"),o.invoke("stickers/tabs").then((function(e){var n=e&&e.tabs;n&&n[0]&&(b6=n[0],t.setState({activeAssetsTab:b6,assetsTabsOrder:n}))})))},didMount:function(t){var e=function(e){(function(t,e){if(t.store.get().isTouchDevice&&x8(t))return!0;var n=t.state.congratsMenuActive,o=t.refs,r=o.assets,a=o.sendActionCongratsMenu;if(r){for(var i=e.target;i&&i!==t.root;){if(i===r||"MSG-DIALOG"===i.nodeName)return;i=i.parentNode}return p8(t),!0}if(n){for(var s=e.target;s&&s!==t.root;){if(s===a)return;s=s.parentNode}return m8(t),!0}return!1})(t,e)&&e.preventDefault()};return t.root.addEventListener("click",e),function(){t.root.removeEventListener("click",e)}},focusInput:z6,blurInput:D6,didChange:function(t,e){var n=e.chat,o=e.config;if(n){var r=n.prev,a=n.current,i=a.posting,s=xm(r,"id");(a.id!==s||!i&&xm(r,"posting"))&&(p8(t),Zt(t,"reset-posting-preview",{chatId:s})),!i&&xm(r,"posting")&&_8(t),t.setState({_prevTokenType:void 0,_scheduleDraftSync:!1}),j6(t);var u=[];if(i){i.upload&&u.push.apply(u,Array.from(i.upload.values()).filter(Boolean).filter((function(t){return"AUDIO"!==t._type})));var c=t.props.config;i.link&&"EDIT"===i.type&&i.link.attaches&&c.server["editable-attachments"]&&u.push.apply(u,i.link.attaches.filter((function(t){return y6.includes(t._type)})).map((function(t){return{_type:t._type,status:"completed",file:t}})));var p=t.state.attaches;void 0===p&&(p=[]),c.server["close-overlays-on-attach"]&&u.length!==p.length&&function(t){Zt(t,"hide-aside"),p8(t)}(t);var l=i.current,m=i.prev;l&&"EDIT"===l.type&&m&&"EDIT"!==m.type&&z6(t),l&&l.text||(L6(t),j6(t))}t.setState({attaches:u}),(a.id!==s||xm(r,"posting.preview")&&!xm(a,"posting.preview"))&&i&&i.voiceMessage&&t.setState({voiceMode:"preview"}),xm(a,"posting.text")||(t.setState({lockCommands:null}),t.setState({lockMentions:null})),L6(t)}o&&t.setState({showNewBubble:vZ(t)})},openMusicAttachLayer:N6,openVideoAttachLayer:q6,openPhotoAttachLayer:H6,onSendMoney:F6,onToggleAssets:W6,onSendGift:G6,onMoneySend:function(t,e){Zt(e,"open-transfer-money-layer",{friendId:t})},onSelectAssetsTab:Y6,selectFiles:X6,onSelectFiles:Q6,onPreviewMessage:function(t){p8(t),Zt(t,"posting-preview",Gv(t))},onClosePreview:function(t){Zt(t,"reset-posting-preview",{chatId:t.props.chat.id})},onMainActionClick:t8,onSendMessage:e8,onVoiceMessageStart:n8,onVoiceMessageReady:o8,onVoiceMessageCanceled:r8,onVoiceMessageError:a8,onRecordClick:i8,onAttachmentButtonClick:s8,onAttachmentMenuItemClick:u8,toggleSendActionCongrats:m8,resetPostingLink:d8,removeFile:f8,onAttachClick:g8,preventEnter:v8,onEditorUpdate:E8};var d9="e5i3ojd";function _9(t,e,o){return o._7=n.insert(e,n.text(t.props.label),"label"),f9}function f9(t,e){n.updateText(e._7,t.props.label)}function g9(t,e,o){return n.insert(e,n.createSlot(t,"label",d9)),o._8=n.mountSlot(t,"label",_9),v9}function v9(t,e){n.updateDefaultSlot(e._8)}function h9(t){return t.props.multiple?g9:null}function C9(t,e,n){e.value=n.props.query,e.placeholder=n.props.placeholder,e.focused=n.props.autofocus}function k9(t,e){var o=t.componentView,r=n.createInjector(o);e._1=n.mountBlock(t,r,h9);var a=e._a=n.insert(r,n.createComponent("msg-search-input",BW,t));n.setRef(t,"input",a);var i=e._b=n.propsSet(a,{name:"query","data-tsid":"search"});return C9(0,i,t),n.mountComponent(a,i),b9}function b9(t,e){var o=e._a,r=e._b;n.updateBlock(e._1),C9(0,r,t),n.updateComponent(o,r)}_9.dispose=function(t){t._7=null},g9.dispose=function(t){t._8=n.unmountSlot(t._8)},k9.dispose=function(t){t._1=n.clearBlock(t._1),t._a=n.unmountComponent(t._a)};var y9={__proto__:null,cssScope:d9,default:k9,props:function(){return{label:"",placeholder:"",query:"",multiple:!0,autofocus:!1}},didChange:function(t,e){var n=e.query;if(n){var o=t.refs.input;o&&o.value!==n.current&&(o.value=n.current)}},didMount:function(t){t.autofocus&&requestAnimationFrame((function(){return t.refs.input.focus()}))}};function S9(t,e,o){e.id=n.get(o.props.item,"itemId")||n.get(o.props.item,"id"),e.url=n.get(o.props.item,"url"),e.caption=n.get(o.props.item,"caption")}function w9(t){Zt(t,"unselect-item",n.get(t.props.item,"id"))}function E9(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.createComponent("msg-avatar",Hp,t)),a=e._2=n.propsSet(r,{size:"medium"});S9(0,a,t),n.mountComponent(r,a);var i=e._3=n.appendChild(o,n.createComponent("msg-icon",xe,t));return e._5=n.addEvent(i,"click",w9,t,e),n.mountComponent(i,n.propsSet(i,{icon:"clear"})),x9}function x9(t,e){var o=e._1,r=e._2;S9(0,r,t),n.updateComponent(o,r)}E9.dispose=function(t){t._1=n.unmountComponent(t._1),t._5=n.removeEvent("click",t._5),t._3=n.unmountComponent(t._3)};var I9={__proto__:null,cssScope:"e-c6znr4",default:E9,props:function(){return{item:null}}};function B9(t,e){return function(t){return A9(t,"in",e)}}function M9(t,e){return function(t){return A9(t,"out",e)}}function A9(t,e,o){var r=parseInt(getComputedStyle(t).width,10),a="in"===e?0:r,i=("in"===e?r:0)-a;"in"===e?(t.classList.add("js-animate-in"),t.classList.remove("js-animate-out")):(t.classList.remove("js-animate-in"),t.classList.add("js-animate-out"));var s={duration:300,easing:nN};return t.nextSibling&&(t.style.width="".concat(a,"px"),s.step=function(t,e){return t.style.width="".concat(a+e*i,"px")},s.complete=function(t){return t.style.width=""}),n.composeTween(o,s)}function T9(t,e){e.value=void 0}function j9(t){return t.props.items}function P9(t,e){return n.get(e.value,"id")||n.get(e.value,"itemId")}function R9(t,e,n,o){e.item=o.value}function L9(t,e){var o=e._8,r=e._9;R9(0,r,0,e),n.updateComponent(o,r)}function O9(t,e,o){return o._8?L9(0,o):function(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-picker-tokens-item",I9,t)),a=o._9=n.propsSet(r,{"data-tsid":"empty_chats_list"});R9(0,a,0,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._8,B9(o._8)),z9}function z9(t,e){L9(0,e)}function D9(t,e){var o=t.componentView,r=n.createInjector(o);return T9(0,e),e._3=n.mountKeyIterator(t,r,j9,P9,O9),U9}function U9(t,e){T9(0,e),n.updateKeyIterator(e._3)}O9.dispose=function(t,e){var o=t._8;n.animate(o,M9(),(function(){return function(t){var e=t._8;t._8=n.unmountComponent(e),n.domRemove(e),t._9=null}(t)}))},D9.dispose=function(t){t._3=n.clearKeyIterator(t._3)};var N9={__proto__:null,cssScope:"e5xo55w",default:D9,didUpdate:function(t,e){var n=e.items;n&&n.current&&n.prev&&n.current.length>n.prev.length&&function(t){var e=t.scrollTop,n=t.scrollHeight-t.clientHeight,o=5*(n-e),r=Date.now(),a=r+o,i=function(){var s=Math.min(Date.now(),a);t.scrollTop=nN(s-r,e,n,o),s<a&&requestAnimationFrame(i)};o&&requestAnimationFrame(i)}(t)},showToken:B9,hideToken:M9},q9="data-picker-item",H9={focusInput:function(){var t;(t=this.refs.header)&&t.focusInput()}};var F9={click:function(t,e){var n=function(t){if(1===t.nodeType)return t.closest("["+q9+"]")}(e.target);if(n&&n.props&&!n.props.disabled){var o=V9(n);if(t.lastClickedId&&e.shiftKey&&t.props.multiple){var r=t.props.tokens,i=function(t){t._items||(t._items=p(t.props.items));return t._items}(t),s=function(t){t._disabled||(t._disabled=new a(p(t.props.disabled).map((function(t){return[t,!0]}))));return t._disabled}(t),u=i.find((function(e){return e.id===t.lastClickedId}));if(e.preventDefault(),u){var c=i.indexOf(u),l=i.findIndex((function(t){return t.id===o})),m=r&&-1!==r.findIndex((function(t){return t.id===u.id}))?G9:Y9;if(-1!==c&&-1!==l)return void i.slice(Math.min(c,l),Math.max(c,l)+1).forEach((function(e){s.has(e.id)||m(t,e.id)}))}}Q9(t,o)}},mousedown:function(t,e){e.shiftKey&&t.componentView.contains(e.target)&&e.preventDefault()},focusin:function(t,e){e.target&&"query"===e.target.name&&t.setState({queryFocus:!0})},focusout:function(t,e){e.target&&"query"===e.target.name&&t.setState({queryFocus:!1})}};function V9(t){return t&&Number(t.getAttribute(q9))}function K9(t){return t.classList.contains("js-active")}function W9(t){if(!t._DOMitems){var e=oe(t,"");t._DOMitems=e?Array.from(e.querySelectorAll("["+q9+"]")):[]}return t._DOMitems}function G9(t,e){X9(t,e)||(t.lastClickedId=e,Zt(t,"select-item",e))}function Y9(t,e){X9(t,e)&&(t.lastClickedId=e,Zt(t,"unselect-item",e))}function X9(t,e){var n=function(t,e){var n=oe(t,"");return n&&n.querySelector("["+q9+'="'+e+'"]')}(t,e);return n&&n.hasAttribute("selected")}function Q9(t,e){X9(t,e)?Y9(t,e):G9(t,e)}function J9(t){t._DOMitems=null}function $9(t,e,n){if(e.length){var o=e[e.findIndex(K9)+n];if(o)return o.scrollIntoViewIfNeeded(),function(t,e){Zt(t,"activate-item",e)}(t,V9(o)),!0}return!1}function Z9(t,e,n){var o=function(t,e){var n=hr(t);return n&&ttt(n)?n:(e||W9(t)).find(K9)}(t);!o||o.getAttribute("disabled")||!t.state.queryFocus&&hr(t)!==o?n():(e.preventDefault(),e.stopPropagation(),Q9(t,V9(o)))}function ttt(t){return t&&1===t.nodeType&&t.hasAttribute(q9)}function ett(t){t&&(t.setAttribute("tabindex","0"),t.focus())}var ntt="e75iyxv";function ott(t,e,n){e.multiple=n.props.multiple,e.query=n.props.query,e.autofocus=n.props.autofocus,e.label=n.props.headerLabel,e.placeholder=n.props.headerPlaceholder}function rtt(t,e,o){var r=o._5=n.insert(e,n.createComponent("msg-picker-header",y9,t),"header"),a=o._6=n.propsSet(r);return ott(0,a,t),n.mountComponent(r,a),att}function att(t,e){var o=e._5,r=e._6;ott(0,r,t),n.updateComponent(o,r)}function itt(t,e,n){e.items=n.props.tokens}function stt(t,e){var o=e._g,r=e._h;itt(0,r,t),n.updateComponent(o,r)}function utt(t,e,o){return o._g?stt(t,o):function(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-picker-tokens",N9,t)),a=o._h=n.propsSet(r,{class:"custom-scrollbar-okmsg","data-tsid":"block_added_people"});itt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._g,$U(o._g,{duration:300,easing:nN})),ctt}function ctt(t,e){stt(t,e)}function ptt(t){return t.props.multiple&&Tt(0,t.props.tokens)?utt:null}function ltt(t,e,o){var r=n.insert(e,n.elem("footer",ntt));n.appendChild(r,n.createSlot(t,"footer",ntt)),o._o=n.mountSlot(t,"footer")}function mtt(t){return t.props.footer?ltt:null}function dtt(t,e){var o=t.componentView,r=n.createInjector(o),a=n.insert(r,n.elem("header",ntt));n.setRef(t,"header",a),n.appendChild(a,n.createSlot(t,"header",ntt)),e._7=n.mountSlot(t,"header",rtt);var i=n.insert(r,n.elem("div",ntt));return n.setRef(t,"main",i),n.appendChild(i,n.createSlot(t,"",ntt)),e._a=n.mountSlot(t,""),e._b=n.mountBlock(t,r,ptt),e._j=n.mountBlock(t,r,mtt),_tt}function _tt(t,e){n.updateDefaultSlot(e._7),n.updateBlock(e._b),n.updateBlock(e._j)}rtt.dispose=function(t){t._5=n.unmountComponent(t._5),t._6=null},utt.dispose=function(t,e){var o=t._g;n.animate(o,ZU(0,{duration:300,easing:nN}),(function(){return function(t){var e=t._g;t._g=n.unmountComponent(e),n.domRemove(e),t._h=null}(t)}))},ltt.dispose=function(t){t._o=n.unmountSlot(t._o)},dtt.dispose=function(t){t._7=n.unmountSlot(t._7),t._a=n.unmountSlot(t._a),t._b=n.clearBlock(t._b),t._j=n.clearBlock(t._j)};var ftt={__proto__:null,cssScope:ntt,default:dtt,slideDown:$U,slideUp:ZU,easeOutCubic:nN,methods:H9,props:function(){return{multiple:!1,tokens:null,items:null,disabled:null,query:"",headerLabel:"",headerPlaceholder:"",autofocus:!1,footer:!1}},events:F9,willMount:function(t){t._DOMitems=null,t._items=null,t._shortcuts=OS({UP:function(e,n){ttt(e.target)?(ett(e.target.previousElementSibling),e.preventDefault()):t.state.queryFocus?(e.preventDefault(),function(t){$9(t,W9(t),-1)}(t)):n()},DOWN:function(e,n){ttt(e.target)?(ett(e.target.nextElementSibling),e.preventDefault()):t.state.queryFocus?(e.preventDefault(),function(t){$9(t,W9(t),1)}(t)):n()},SPACE:function(e,n){t.props.multiple?Z9(t,e,n):n()},ENTER:function(e,n){!ttt(e.target)&&t.props.multiple?n():Z9(t,e,n)},"CMD+ENTER":function(){Zt(t,"submit-items",{hotkey:!0})}})},didMount:function(t){J9(t);var e=t.refs.main;if(e){var n="";e.setAttribute("tabindex",0),e.addEventListener("focus",(function(){if(br(e)){var o=W9(t);ett(n&&o.find((function(t){return t.getAttribute(q9)===n}))||o[0])}})),e.addEventListener("focusin",(function(t){e.setAttribute("tabindex","-1"),ttt(t.target)&&(n=t.target.getAttribute(q9))})),e.addEventListener("focusout",(function(t){var n;ttt(t.target)&&(n=t.target).getAttribute("tabindex")&&n.removeAttribute("tabindex"),e.setAttribute("tabindex","0")}))}},willUnmount:function(t){J9(t),t.lastClickedId=null,t._items=null,t._shortcuts.destroy()},didChange:function(t,e){var n=e.items,o=e.disabled;n&&(J9(t),t._items=null),o&&(t._disabled=null)}};var gtt="e4q4kaq",vtt=[0],htt=[];function Ctt(){htt.push(vtt),vtt=[0]}function ktt(){vtt=htt.pop()}function btt(t,e){e.isBot="DIALOG"==n.get(t.props.chat,"type")&&n.get(t.props.chat,"hasBots")}function ytt(t,e){var o=n.insert(e,n.elem("div",gtt));n.setClass(o,"stub-okmsg");var r=n.appendChild(o,n.elem("div",gtt));n.setClass(r,"stub-avatar-okmsg");var a=n.appendChild(o,n.elem("div",gtt));n.setClass(a,"stub-name-okmsg")}function Stt(t,e,n){e.size=n.props.size,e.chat=n.props.chat}function wtt(t,e,o,r){e.size=o.props.size,e.official=Yt(0,o.props.chat),e.bot=r.isBot,e.channel="CHANNEL"==n.get(o.props.chat,"type"),e.highlights=o.props.highlights}function Ett(t,e,o){e.value=n.get(o.props.chat,"uid"),e.checked=o.props.selected}function xtt(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-checkbox",hS,t)),a=o._n=n.propsSet(r,{name:"chat",tabindex:"-1"});return Ett(0,a,t),n.mountComponent(r,a),Itt}function Itt(t,e){var o=e._m,r=e._n;Ett(0,r,t),n.updateComponent(o,r)}function Btt(t){return t.props.disabled?null:xtt}function Mtt(t,e,o){var r=n.insert(e,n.elem("div",gtt)),a=n.createInjector(r);n.setClass(r,"label-okmsg");var i=o._c=n.insert(a,n.createComponent("msg-chat-image",db,t)),s=o._d=n.propsSet(i);Stt(0,s,t),n.mountComponent(i,s);var u=n.insert(a,n.elem("span",gtt));n.setClass(u,"name-okmsg");var c=o._f=n.appendChild(u,n.createComponent("msg-name",Sh,t)),p=c.componentModel.input,l=o._g=n.propsSet(c);return wtt(0,l,t,o),o._h=n.insert(p,n.text(n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder"))),n.mountComponent(c,l),o._j=n.mountBlock(t,a,Btt),Att}function Att(t,e){var o=e._c,r=e._d,a=e._f,i=e._g;Stt(0,r,t),n.updateComponent(o,r),wtt(0,i,t,e),vtt[0]|=n.updateText(e._h,n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")),n.updateIncomingSlot(a,"",vtt[0]),n.updateComponent(a,i),n.updateBlock(e._j)}function Ttt(t){return"DIALOG"===n.get(t.props.chat,"type")&&n.find(n.get(t.props.chat,"participants"),(function(t){return n.get(t,"user","stub")}))?ytt:Mtt}function jtt(t,e){var o=t.componentView;Ctt();var r=n.createInjector(o);return btt(t,e),e._3=n.mountBlock(t,r,Ttt),ktt(),Ptt}function Ptt(t,e){Ctt(),btt(t,e),n.updateBlock(e._3),ktt()}xtt.dispose=function(t){t._m=n.unmountComponent(t._m),t._n=null},Mtt.dispose=function(t){t._c=n.unmountComponent(t._c),t._f=n.unmountComponent(t._f),t._j=n.unmountBlock(t._j),t._d=t._g=t._h=null},jtt.dispose=function(t){Ctt(),t._3=n.clearBlock(t._3),ktt()};var Rtt={__proto__:null,cssScope:gtt,default:jtt,props:function(){return{chat:null,highlights:null,selected:!1,disabled:!1,size:"normal"}}};var Ltt={__proto__:null,events:{"activate-item":function(t,e){return t.activate(e.detail)},"deactivate-item":function(t,e){return t.deactivate(e.detail)},"select-item":function(t){return t.setQuery("")},input:function(t,e){var n=t.refs.basePicker,o=e.target,r=n&&n.refs.header;r&&r.contains(o)&&t.setQuery(o.value)}},extend:{getItems:function(){throw new Error("Not implemented")},updateList:function(){throw new Error("Not implemented")},getTokens:function(){return null},setQuery:function(t){this.setState({query:t}),this.query.update(t)},activate:function(t){this.setState({active:t})},deactivate:function(t){t===this.state.active&&this.setState({active:null})}},willMount:function(t){t._list=new YL(t.state.listOptions),t.query=new w0("")},didMount:function(t){var e=t.refs.scroller;t._handleScroll=function(){return t._list.handleScroll(e)},e&&e.addEventListener("scroll",t._handleScroll)},willUnmount:function(t){var e=t.refs.scroller;e&&e.removeEventListener("scroll",t._handleScroll)},willRender:function(t){var e=t.getItems();t.setState({tokens:t.getTokens(e)}),t.updateList(e)},didRender:function(t){if(t.query.query!==t.state.prevQuery){t.state.prevQuery=t.query.query;var e=t._list;e.items&&e.items.length&&e.scrollTo(e.items[0],t.refs.scroller,0,{animate:!0})}}},Ott=[Ltt],ztt={setQuery:function(t){if(this.setState({query:t}),this.query.update(t),(this.state.searchQuery||"")!==this.query.query){var e=this.query.query;e.length?qtt(this,e):this.setState({searchLoading:!1,searchQuery:e,search:null})}},getItems:function(){return this.props.chats},updateList:function(t){var e=[];if(this.query.isEmpty)t.forEach((function(t){return e.push({chat:t})}));else{var n=new i,o=this.state.search;this.query.scoringSort(t,Ftt).result.forEach((function(t){var o=t.value,r=t.scoring.matches;n.add(o.id),e.push({chat:o,highlights:r})})),o&&o.result.forEach((function(t){t.chat&&!n.has(t.chat.id)&&e.push({chat:t.chat,highlights:t.highlights})}))}this._list.update(e,this.refs.scroller)},getTokens:function(){var t,e=this.props,n=e.selected,o=e.chats,r=this.store.get().chats;return n?n.map((function(e){return t||(t=new a,o.forEach((function(e){return t.set(e.id,e)}))),n=t.get(e)||r.get(e),i="DIALOG"===n.type?xm(n.participants.filter((function(t){return t.user!==n.owner}))[0],"user.id"):n.id,{id:n.id,itemId:i,caption:n.title||n.placeholder,url:Bt(n)};var n,i})):null},focusSearchInput:function(){var t=this.refs.picker;t&&t.focusInput()}};function Dtt(t,e){e.activate(t)}function Utt(t,e){e.deactivate(t)}function Ntt(t){var e=t.refs.scroller;e&&sF(e,200)&&(t.state.search?function(t){var e=t.state,o=e.search,r=e.searchQuery,a=e.searchLoading,i=o&&o.marker;if(i&&r&&!a)return Htt(t,r,i).then((function(e){var o=t.state.search;return o&&o.marker===i&&t.setState({search:n.__assign(n.__assign({},e),{result:o.result.concat(e.result)})}),e}));Promise.resolve(null)}(t):t.store.app.chat.loadNext(t.props.next))}function qtt(t,e,n){return t.state.searchLoading?(t.setState({searchQuery:e}),Promise.resolve(null)):Htt(t,e,n).catch((function(n){return t.state.searchQuery!==e?null:Promise.reject(n)})).then((function(n){var o=t.state.searchQuery;return o&&o!==e?(t.setState({searchLoading:!1}),qtt(t,o)):(o===e&&t.setState({search:n}),n)}))}function Htt(t,e,n){return t.setState({searchQuery:e,searchLoading:!0,searchError:null}),t.store.app.chat.searchChats({query:e,count:50,marker:n}).catch((function(n){return console.error("search error",n),t.state.searchQuery===e&&t.setState({searchLoading:!1,searchError:n}),Promise.reject(n)})).then((function(n){return t.state.searchQuery===e&&t.setState({searchLoading:!1}),n}))}function Ftt(t){var e=t.title||t.placeholder;if("DIALOG"===t.type)for(var n=0;n<t.participants.length;n++){var o=t.participants[n];if(!o.user.current&&o.user.link){e+=" ".concat(Wn(o.user.link));break}}else 1!==t.participants.length||e||(e=V("empty-chat-placeholder"));return e}var Vtt="e-z5zimb",Ktt=[0],Wtt=[];function Gtt(){Wtt.push(Ktt),Ktt=[0]}function Ytt(){Ktt=Wtt.pop()}function Xtt(t,e){e.loading="chats-loading"===t.store.data.state||t.state.searchLoading,e.value=void 0}function Qtt(t,e,o){e.query=o.state.query,e.tokens=o.state.tokens,e.items=n.get(o.state.scrollList,"items"),e.multiple=o.props.multiple,e.headerLabel=o.props.headerLabel,e.headerPlaceholder=o.props.headerPlaceholder,e.autofocus=o.props.autofocus,e.disabled=o.props.disabled}function Jtt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function $tt(t,e,o){var r=n.insert(e,n.elem("div",Vtt));n.setClass(r,"not-found-okmsg");var a=o._f=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"search"}));var i=o._h=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"not-found"})),Ktt[0]=1}function Ztt(t,e){return 0===Tt(0,n.get(t.state.scrollList,"items"))&&t.state.query&&!e.loading?$tt:null}function tet(t){return n.get(t.state.scrollList,"items")}function eet(t,e){return n.get(e.value,"value","chat","id")}function net(t,e){e.chat=n.get(e.value,"value","chat"),e.chatId=n.get(e.chat,"id"),e.isStub="DIALOG"===n.get(e.chat,"type")&&n.find(n.get(e.chat,"participants"),(function(t){return n.get(t,"user","stub")}))}function oet(t,e,o,r){e.chat=r.chat,e.size=o.props.size,e.highlights=n.get(r.value,"value","highlights"),e.disabled=r.isStub||jt(0,o.props.disabled,r.chatId),e.selected=jt(0,o.props.selected,r.chatId),e["aria-selected"]=jt(0,o.props.selected,r.chatId)?"true":null,e["data-picker-item"]=!n.get(r.value,"disabled")&&r.chatId,e.class=o.state.active===r.chatId?"js-active":""}function ret(t,e,n,o){Dtt(o.chatId,t)}function aet(t,e,n,o){Utt(o.chatId,t)}function iet(t,e,o){net(0,o);var r=o._r=n.insert(e,n.createComponent("msg-chat-picker-list-item",Rtt,t)),a=o._s=n.propsSet(r,{role:"menuitem","data-tsid":"item-wrapper"});return oet(0,a,t,o),o._t=n.addEvent(r,"mouseenter",ret,t,o),o._u=n.addEvent(r,"mouseleave",aet,t,o),n.mountComponent(r,a),Ktt[0]=1,set}function set(t,e){var o=e._r,r=e._s;net(0,e),oet(0,r,t,e),n.updateComponent(o,r)}function uet(t,e,o){var r=n.insert(e,n.elem("div",Vtt));n.setClass(r,"loader-okmsg");var a=o._z=n.appendChild(r,n.createComponent("msg-progress",Ps,t));n.mountComponent(a,n.propsSet(a,{size:24,indeterminate:!0,radius:10,thickness:2,spin:!0})),Ktt[0]=1}function cet(t,e){return e.loading?uet:null}function pet(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px")}function met(t,e){var o=t.componentView;Gtt(),Xtt(t,e);var r=e._4=n.appendChild(o,n.createComponent("msg-picker",ftt,t)),a=r.componentModel.input;n.setRef(t,"basePicker",r);var i=e._5=n.propsSet(r,{"data-tsid":"user_and_chat_block"});Qtt(0,i,t);var s=n.insert(a,n.elemWithText("h4","Список чатов",Vtt),"");n.setClass(s,"visually-hidden-okmsg");var u=n.insert(a,n.elem("div",Vtt),""),c=n.createInjector(u);return n.setRef(t,"scroller",u),n.setAttribute(u,"role","menu"),n.setClass(u,"scroller-okmsg custom-scrollbar-okmsg"),e._8=n.addEvent(u,"scroll",Ntt,t,e),Jtt(e._9=n.insert(c,n.elem("div",Vtt)),e._a=n.obj(),t),e._b=n.mountBlock(t,c,Ztt),e._k=n.mountKeyIterator(t,c,tet,eet,iet),e._v=n.mountBlock(t,c,cet),pet(e._11=n.insert(c,n.elem("div",Vtt)),e._12=n.obj(),t),n.mountComponent(r,i),Ytt(),n.subscribeStore(t,["state"]),det}function det(t,e){var o=e._4,r=e._5;Gtt(),Xtt(t,e),Qtt(0,r,t),Jtt(e._9,e._a,t),n.updateBlock(e._b),n.updateKeyIterator(e._k),n.updateBlock(e._v),pet(e._11,e._12,t),n.updateIncomingSlot(o,"",Ktt[0]),n.updateComponent(o,r),Ytt()}$tt.dispose=function(t){t._f=n.unmountComponent(t._f),t._h=n.unmountComponent(t._h),Ktt[0]=1},iet.dispose=function(t){t._t=n.removeEvent("mouseenter",t._t),t._u=n.removeEvent("mouseleave",t._u),t._r=n.unmountComponent(t._r),t._s=null,Ktt[0]=1},uet.dispose=function(t){t._z=n.unmountComponent(t._z),Ktt[0]=1},met.dispose=function(t){Gtt(),t._8=n.removeEvent("scroll",t._8),t._b=n.unmountBlock(t._b),t._k=n.unmountKeyIterator(t._k),t._v=n.unmountBlock(t._v),t._4=n.unmountComponent(t._4),Ytt()};var _et={__proto__:null,cssScope:Vtt,default:met,plugins:Ott,extend:ztt,props:function(){return{chats:[],size:"normal",multiple:!0}},state:function(t){var e=function(){var e=t.state.scrollList;if(e&&e.items){var n=function(t){var e=new i;return t.forEach((function(t){var n=t.value.chat;if("DIALOG"===n.type)for(var o=0;o<n.participants.length;o++){var r=n.participants[o];r.user.stub&&e.add(r.user.id)}})),Array.from(e)}(e.items);n.length&&t.store.app.contacts.fetchMissing(n)}},n=o.debounce(e,300),r=!0;return{listOptions:{itemHeight:46,initialItems:20,onUpdate:function(o){t.setState({scrollList:o}),r?(r=!1,e()):n()}}}},onActivate:Dtt,onDeactivate:Utt,handleScroll:Ntt};var fet="efd64i3",get=[0],vet=[];function het(){vet.push(get),get=[0]}function Cet(){get=vet.pop()}function ket(t){Zt(t,"info-sheet-close")}function bet(t,e,o){var r=o._b=n.insert(e,n.createComponent("msg-button",fe,t),"controls"),a=r.componentModel.input;o._d=n.addEvent(r,"click",ket,t,o);var i=o._e=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"back"})),n.mountComponent(r,n.propsSet(r,{slot:"controls",shape:"circle",class:"secondary-okmsg","data-tsid":"back_in_chat_toolbar"})),get[0]=1}function yet(t){Zt(t,"info-sheet-close")}function Set(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-tico",rc,t),"controls"),a=r.componentModel.input;o._l=n.addEvent(r,"click",yet,t,o);var i=o._m=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"back"})),n.mountComponent(r,n.propsSet(r,{icon:"back",slot:"controls",class:"back-okmsg","data-tsid":"back_in_chat_toolbar"})),get[0]=1}function wet(t){return t.store.data.isMobile?bet:Set}function Eet(t,e,o){return o._8=n.mountBlock(t,e,wet),xet}function xet(t,e){n.updateBlock(e._8)}function Iet(t){return t.props.disableBack?null:Eet}function Bet(t,e,o){var r=o._4=n.insert(e,n.createComponent("msg-toolbar",qk,t)),a=r.componentModel.input;return o._5=n.mountBlock(t,a,Iet),n.insert(a,n.createSlot(t,"title",fet),""),o._r=n.mountSlot(t,""),n.mountComponent(r),Met}function Met(t,e){n.updateBlock(e._5),n.updateIncomingSlot(e._4,"controls",get[0])}function Aet(t){return t.props.toolbar?Bet:null}function Tet(t,e,o){n.updateClass(t,e,o.props.scrollable?"custom-scrollbar-okmsg":"")}function jet(t,e){Zt(t,"info-sheet-scroll",e.currentTarget)}function Pet(t,e){t.props.scrollable&&n.setPendingEvent(e._u,"scroll",jet,e)}function Ret(t,e){var o=t.componentView;het();var r=n.createInjector(o);e._1=n.mountBlock(t,r,Aet);var a=e._t=n.insert(r,n.elem("div",fet)),i=n.createInjector(a);n.setRef(t,"scroller",a);var s=e._u=n.pendingEvents(t,a);return Tet(a,e._v=n.obj(),t),Pet(t,e),n.insert(i,n.createSlot(t,"",fet)),e._z=n.mountSlot(t,""),n.finalizePendingEvents(s),Cet(),n.subscribeStore(t,["isMobile"]),Let}function Let(t,e){het(),n.updateBlock(e._1),Tet(e._t,e._v,t),Pet(t,e),n.finalizePendingEvents(e._u),Cet()}bet.dispose=function(t){t._d=n.removeEvent("click",t._d),t._e=n.unmountComponent(t._e),t._b=n.unmountComponent(t._b),get[0]=1},Set.dispose=function(t){t._l=n.removeEvent("click",t._l),t._m=n.unmountComponent(t._m),t._j=n.unmountComponent(t._j),get[0]=1},Eet.dispose=function(t){t._8=n.unmountBlock(t._8)},Bet.dispose=function(t){t._5=n.unmountBlock(t._5),t._r=n.unmountSlot(t._r),t._4=n.unmountComponent(t._4)},Ret.dispose=function(t){het(),t._1=n.clearBlock(t._1),t._u=n.detachPendingEvents(t._u),t._z=n.unmountSlot(t._z),Cet()};var Oet={__proto__:null,cssScope:fet,default:Ret,props:function(){return{disableBack:!1,toolbar:!1,scrollable:!1}}},zet="e-bhxv59",Det=[0],Uet=[];function Net(){Uet.push(Det),Det=[0]}function qet(){Det=Uet.pop()}function Het(t,e){e.remainingSymbols=n.get(t.store.data.config,"server","max-msg-length")-n.get(t.state.comment,"length")}function Fet(t,e,n){e.disableBack=n.props.disableBack}function Vet(t,e,n){e.selected=n.state.selected,e.chats=n.state.chats,e.next=n.props.next,e.headerLabel=n.store.data.l10n("forward-picker-label"),e.headerPlaceholder=n.store.data.l10n("contact-picker-placeholder"),e.autofocus=n.state.autofocus}function Ket(t,e,o){e.value=o.state.comment,e.altNewline=n.get(o.store.data.config,"user","ALT_KEYBOARD"),e.placeholder=o.store.data.l10n("empty-comment-placeholder"),e.replaceTextEmoji=!n.get(o.store.data.config,"user","NO_TEXT_EMOJI")}function Wet(t,e){t.setState({comment:n.get(e,"detail","text")||""})}function Get(t,e,o,r){n.updateClass(t,e,"counter-okmsg"+(r.remainingSymbols<0?" __error-okmsg":""))}function Yet(t,e,o){var r=o._k=n.insert(e,n.elem("div",zet));return Get(r,o._l=n.obj(),0,o),o._m=n.appendChild(r,n.text(o.remainingSymbols)),Det[0]=1,Xet}function Xet(t,e){Get(e._k,e._l,0,e),Det[0]|=n.updateText(e._m,e.remainingSymbols)}function Qet(t,e){return e.remainingSymbols<=50?Yet:null}function Jet(t,e,n,o){e.disabled=!Tt(0,n.state.selected)||o.remainingSymbols<0}function $et(t,e){var o=t.componentView;Net(),Het(t,e);var r=e._3=n.appendChild(o,n.createComponent("msg-info-sheet",Oet,t)),a=r.componentModel.input,i=e._4=n.propsSet(r,{role:"dialog","aria-modal":"true",toolbar:!0});Fet(0,i,t),e._5=n.addEvent(r,"info-sheet-close",$S,t,e);var s=e._6=n.insert(a,n.createComponent("msg-l10n",ae,t),"title");n.mountComponent(s,n.propsSet(s,{slot:"title",key:"forward","data-tsid":"header_block"}));var u=n.insert(a,n.elem("div",zet),"");n.setClass(u,"main-okmsg");var c=e._9=n.appendChild(u,n.createComponent("msg-chat-picker",_et,t));n.setRef(t,"picker",c);var p=e._a=n.propsSet(c,{size:"small"});Vet(0,p,t),e._b=n.addEvent(c,"select-item",ZS,t,e),e._c=n.addEvent(c,"unselect-item",tw,t,e),n.mountComponent(c,p);var l=n.appendChild(u,n.elem("footer",zet)),m=n.createInjector(l),d=e._e=n.insert(m,n.createComponent("msg-input",a$,t));n.setRef(t,"comment",d);var _=e._f=n.propsSet(d,{name:"comment",multiline:!0});Ket(0,_,t),e._g=n.addEvent(d,"update",Wet,t,e),n.mountComponent(d,_),e._h=n.mountBlock(t,m,Qet);var f=e._o=n.insert(m,n.createComponent("button",fe,t)),g=f.componentModel.input,v=e._p=n.propsSet(f,{shape:"square",class:"primary-okmsg","data-tsid":"forward_btn"});Jet(0,v,t,e),e._q=n.addEvent(f,"click",JS,t,e);var h=e._r=n.insert(g,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(h,n.propsSet(h,{key:"forward-submit"})),n.mountComponent(f,v);var C=e._u=n.insert(m,n.createComponent("button",fe,t)),k=C.componentModel.input;e._w=n.addEvent(C,"click",$S,t,e);var b=e._x=n.insert(k,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(b,n.propsSet(b,{key:"cancel"})),n.mountComponent(C,n.propsSet(C,{shape:"square",class:"secondary-okmsg"})),n.mountComponent(r,i),qet(),n.subscribeStore(t,["config","l10n"]),Zet}function Zet(t,e){var o=e._3,r=e._4,a=e._9,i=e._a,s=e._e,u=e._f,c=e._o,p=e._p;Net(),Het(t,e),Fet(0,r,t),Vet(0,i,t),n.updateComponent(a,i),Ket(0,u,t),n.updateComponent(s,u),n.updateBlock(e._h),Jet(0,p,t,e),n.updateComponent(c,p),n.updateIncomingSlot(o,"",Det[0]),n.updateComponent(o,r),qet()}Yet.dispose=function(t){t._l=t._m=t._k=null,Det[0]=1},$et.dispose=function(t){Net(),t._5=n.removeEvent("info-sheet-close",t._5),t._6=n.unmountComponent(t._6),t._b=n.removeEvent("select-item",t._b),t._c=n.removeEvent("unselect-item",t._c),t._9=n.unmountComponent(t._9),t._g=n.removeEvent("update",t._g),t._e=n.unmountComponent(t._e),t._h=n.unmountBlock(t._h),t._q=n.removeEvent("click",t._q),t._r=n.unmountComponent(t._r),t._o=n.unmountComponent(t._o),t._w=n.removeEvent("click",t._w),t._x=n.unmountComponent(t._x),t._u=n.unmountComponent(t._u),t._3=n.unmountComponent(t._3),qet()};var tnt={__proto__:null,cssScope:zet,default:$et,events:{"animate-end":function(t){t.setState({autofocus:!0})}},plugins:function(){return[DS({ENTER:QS,"CMD+ENTER":QS,"ALT+ENTER":QS,"SHIFT+ENTER":QS,ESC:function(t,e){e.stopPropagation(),$S(t)},ALL:function(t,e,n){if(!WS(e)&&XS(e)){var o=t.refs.comment;return o.setSelection(o.value.length),void o.focus()}n()}})]},init:function(t){t.setState({sorter:m((function(t){return t.id}))})},didChange:function(t,e){var n,o=e.chats,r=e.contacts,a=e.next,i=t.store.get().config.server["moderated-groups"];if(o){var s=o.current||[],u=o.prev||[];s.length!==u.length&&(n=nw(i,s))}if((r||a)&&!t.props.next){n||(n=nw(i,n=t.props.chats||[]));var c=ew(n,t.props.contacts).map((function(e){return t.store.app.chat.getDialogStub(e)}));c.length&&(n=n.concat(c))}n&&t.setState({chats:t.state.sorter(n)})},submit:JS,cancel:$S,select:ZS,unselect:tw,getMissingDialogUserIds:ew};var ent="e-c6puuz";function nnt(t,e,o){n.updateAttribute(t,e,"name",o.props.name),n.updateProperty(t,e,"value",o.props.value),n.updateProperty(t,e,"checked",o.props.checked?"checked":null)}function ont(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("label",ent)),a=e._2=n.appendChild(r,n.elem("input",ent));n.setRef(t,"input",a);var i=e._3=n.obj();n.setAttribute(a,"type","radio"),nnt(a,i,t);var s=n.appendChild(r,n.elem("span",ent));return n.setClass(s,"radio-okmsg"),n.appendChild(r,n.createSlot(t,"",ent)),e._6=n.mountSlot(t,""),rnt}function rnt(t,e){nnt(e._2,e._3,t)}ont.dispose=function(t){t._6=n.unmountSlot(t._6)};var ant={__proto__:null,cssScope:ent,default:ont,props:function(){return{checked:!1,name:null,value:null}},events:{click:function(t,e){"INPUT"!==e.target.nodeName&&e.stopImmediatePropagation()}},init:function(t){Object.defineProperties(t,{checked:{get:function(){var t=this.refs.input;return t?t.checked:this.props.checked},set:function(t){var e=this.refs.input;e&&t!==e.checked&&(e.checked=!!t)}},value:{get:function(){return this.refs.input.value},set:function(t){var e=this.refs.input;e.value!==t&&(e.value=t)}}})},didChange:function(t,e){var n=e.checked;n&&(t.checked=n.current)}},int=["video/mpeg","video/webm","video/webm;codecs=vp8","video/webm;codecs=h264"],snt={mpeg:"mp4",webm:"webm"};function unt(t,e,n){var o=t.state,r=o.stream,a=o.videoInputId,i=o.audioInputId;cnt(t,e,n),Bnt("change-device"),r&&(e!==a&&Bnt("change-device-video"),n!==i&&Bnt("change-device-audio"))}function cnt(t,e,n){var o=t.state,r=o.stream,a=o.videoInputId,i=o.audioInputId;t.setState({videoInputId:e,audioInputId:n}),r&&n&&a===e&&i!==n?function(t,e){return navigator.mediaDevices.getUserMedia({audio:{deviceId:e}}).then((function(e){t.getAudioTracks().forEach((function(e){e.stop(),t.removeTrack(e)})),e.getAudioTracks().forEach((function(e){t.addTrack(e.clone()),e.stop()}))}))}(r,n).catch((function(e){console.warn(e),t.setState({audioInputId:i})})):r&&e===a&&n===i||(t.setState({videoInputId:e,audioInputId:n}),function(t,e,n){t.setState({streamStatus:"requesting"}),navigator.mediaDevices.getUserMedia({video:!e||{deviceId:e},audio:!n||{deviceId:n}}).then((function(e){wnt(t),t.setState({streamStatus:"granted",stream:e});var n=t.refs.video;n&&(Int(n,!0),n.srcObject=e,n.play()),Snt(t)})).catch((function(e){throw t.setState({streamStatus:"denied"}),Bnt("denied"),e}))}(t,e,n))}function pnt(t){var e=!t.state.settingsOpened;t.setState({settingsOpened:e}),e&&Bnt("settings")}function lnt(t,e){e.stopPropagation();var n=t.refs.video,o=t.state.playing;t.setState({playing:!o}),o?n.pause():n.play()}function mnt(t){t.state.recordedVideo&&t.setState({playing:!1})}function dnt(t){t.setState({loaded:!0})}function _nt(t,e){if(function(t){if(t.which>=2)return!1;var e=t.target;if(e.closest&&e.closest("msg-button"))return!1;return!0}(e)){var n=e.currentTarget,o=e.clientX,r=e.clientY,a=n.offsetLeft,i=n.offsetTop,s=n.offsetWidth,u=n.offsetHeight,c=t.offsetWidth-s,p=t.offsetHeight-u,l=function(e){e.stopPropagation(),e.preventDefault();var n=Tn((a+e.clientX-o)/c,0,1),l=Tn((i+e.clientY-r)/p,0,1),m=(t.offsetWidth-s)*n,d=(t.offsetHeight-u)*l;t.setState({position:{x:m,y:d}})},m=function(){document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",l)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",m)}}function fnt(t){if(!t.state.positioned){var e=t.refs.uiPanel,n=t,o=(n.offsetWidth-e.offsetWidth)/2,r=(n.offsetHeight-e.offsetHeight)/2;e.style.left="".concat(o,"px"),e.style.top="".concat(r,"px"),t.setState({positioned:!0})}}function gnt(t){var e=t.state.position,n=t.refs.uiPanel;n&&e&&(n.style.left="".concat(e.x,"px"),n.style.top="".concat(e.y,"px"))}function vnt(t){var e=t.state.stream,n=int.find((function(t){return MediaRecorder.isTypeSupported(t)}));if(e&&n){Bnt("mime-"+n);var o=[],r=new MediaRecorder(e,{mimeType:n,audioBitsPerSecond:64e3,videoBitsPerSecond:1e6});r.addEventListener("dataavailable",(function(e){if(e.data.size>0&&o.push(e.data),"recording"!==r.state&&t.state.recorder===r){var a=t.props,i=a.width,s=a.height,u=new File(o,"video-message.".concat(function(t){var e=t.match(/^video\/(\w+)/);if(e)return snt[e[1]]||e[1];return"mp4"}(n)),{type:n});u.width=i,u.height=s,function(t,e){e.objectUrl||(e.objectUrl=URL.createObjectURL(e));ynt(t),wnt(t);var n=t.refs.video;n&&(n.srcObject=null,n.src=e.objectUrl);t.setState({recordedVideo:e,stream:null})}(t,u),t.setState({recorder:null})}})),r.start(),t.setState({recorder:r}),hnt(t),Bnt("start-record")}}function hnt(t){Cnt(t);var e=Date.now();t.state.timer=window.setTimeout((function(){t.setState({duration:t.state.duration+Date.now()-e}),hnt(t)}),1e3)}function Cnt(t){clearTimeout(t.state.timer)}function knt(t,e){var n=t.state.recorder;if(n){!0===e&&t.setState({recorder:null}),Cnt(t),n.stop(),Bnt("stop-record");var o=t.refs.video;o&&Int(o,!1)}}function bnt(t){te(t,"submit",t.state.recordedVideo),Bnt("submit")}function ynt(t){var e=t.state.recordedVideo;if(e){if(e.objectUrl){var n=t.refs.video;n&&n.src===e.objectUrl&&(n.src=""),URL.revokeObjectURL(e.objectUrl)}t.setState({recordedVideo:null})}}function Snt(t){return navigator.mediaDevices.enumerateDevices().then((function(e){var n=[],o=[];return e.forEach((function(t){if("videoinput"===t.kind)n.push(t);else if("audioinput"===t.kind){o.some((function(e){return e.groupId===t.groupId}))||o.push(t)}})),t.setState({videoInputList:n,audioInputList:o}),e}))}function wnt(t){var e=t.state.stream;if(e){var n=t.refs.video;e.getTracks().forEach((function(t){return t.stop()})),n&&n.srcObject===e&&(n.srcObject=null)}}function Ent(t){return function(){Snt(t).then((function(e){var n=t.state,o=n.videoInputId,r=n.audioInputId,a=n.recorder,i=e.find((function(t){return t.deviceId===o})),s=e.find((function(t){return t.deviceId===r}));if(!i||!s){a&&knt(t,!0);var u=t.state,c=u.videoInputList,p=u.audioInputList,l=i?o:xnt(c),m=s?r:xnt(p);cnt(t,l,m)}})),Bnt("device-list-changed")}}function xnt(t){var e=t[0];return e?e.deviceId:void 0}function Int(t,e){t.muted=e}function Bnt(t){OK.logger.success("messagesLayer","tt-video-message",t)}var Mnt="ewiprbv",Ant=[0,0],Tnt=[];function jnt(){Tnt.push(Ant),Ant=[0,0]}function Pnt(){Ant=Tnt.pop()}function Rnt(t,e){e.isError="unsupported"===t.state.streamStatus||"unavailable"===t.state.streamStatus||"denied"===t.state.streamStatus,e.isRecording=!!t.state.recorder,e.isRecorded=!!t.state.recordedVideo,e.showSettings=!e.isRecording&&!e.isRecorded&&(Tt(0,t.state.videoInputList)||Tt(0,t.state.audioInputList))}function Lnt(t,e,o,r){n.updateClass(t,e,"wrapper-okmsg"+(r.isError?" __error-okmsg":"")+(o.state.loaded?"":" __loading-okmsg")),n.updateAttribute(t,e,"style","width: "+o.props.width+"px;")}function Ont(t,e,n){e.key="video.message.error.hd."+n.state.streamStatus}function znt(t,e,n){e.key="video.message.error.tx."+n.state.streamStatus}function Dnt(t,e,o){var r=n.insert(e,n.elem("div",Mnt));n.setClass(r,"error-okmsg");var a=n.appendChild(r,n.elem("h1",Mnt)),i=o._f=n.appendChild(a,n.createComponent("msg-l10n",ae,t)),s=o._g=n.propsSet(i);Ont(0,s,t),n.mountComponent(i,s);var u=n.appendChild(r,n.elem("p",Mnt)),c=o._i=n.appendChild(u,n.createComponent("msg-l10n",ae,t)),p=o._j=n.propsSet(c);return znt(0,p,t),n.mountComponent(c,p),Unt}function Unt(t,e){var o=e._f,r=e._g,a=e._i,i=e._j;Ont(0,r,t),n.updateComponent(o,r),znt(0,i,t),n.updateComponent(a,i)}function Nnt(t,e){return e.isError?Dnt:null}function qnt(t,e,o){n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height)}function Hnt(t,e,n){e.class=n.state.settingsOpened?"__active-okmsg":""}function Fnt(t){return t.state.videoInputList}function Vnt(t,e,o,r){e.name=n.get(r.value,"deviceId"),e.checked=n.get(r.value,"deviceId")===o.state.videoInputId}function Knt(t,e,o,r){unt(t,n.get(r.value,"deviceId"),t.state.audioInputId)}function Wnt(t,e,o){var r=o._1b=n.insert(e,n.createComponent("msg-radio",ant,t)),a=r.componentModel.input,i=o._1c=n.propsSet(r);return Vnt(0,i,t,o),o._1d=n.addEvent(r,"click",Knt,t,o),o._1e=n.insert(a,n.text(n.get(o.value,"label")||n.call(t.store.data.l10n,"key",["camera"])+" "+o.index)),n.mountComponent(r,i),Gnt}function Gnt(t,e){var o=e._1b,r=e._1c;Vnt(0,r,t,e),Ant[0]|=n.updateText(e._1e,n.get(e.value,"label")||n.call(t.store.data.l10n,"key",["camera"])+" "+e.index),n.updateIncomingSlot(o,"",Ant[0]),n.updateComponent(o,r)}function Ynt(t){return t.state.audioInputList}function Xnt(t,e,o,r){e.name=n.get(r.value,"deviceId"),e.checked=n.get(r.value,"deviceId")===o.state.audioInputId}function Qnt(t,e,o,r){unt(t,t.state.videoInputId,n.get(r.value,"deviceId"))}function Jnt(t,e,o){var r=o._1p=n.insert(e,n.createComponent("msg-radio",ant,t)),a=r.componentModel.input,i=o._1q=n.propsSet(r);return Xnt(0,i,t,o),o._1r=n.addEvent(r,"click",Qnt,t,o),o._1s=n.insert(a,n.text(n.get(o.value,"label")||n.call(t.store.data.l10n,"key",["mic"])+" "+o.index)),n.mountComponent(r,i),$nt}function $nt(t,e){var o=e._1p,r=e._1q;Xnt(0,r,t,e),Ant[1]|=n.updateText(e._1s,n.get(e.value,"label")||n.call(t.store.data.l10n,"key",["mic"])+" "+e.index),n.updateIncomingSlot(o,"",Ant[1]),n.updateComponent(o,r)}function Znt(t,e,o){var r=n.insert(e,n.elem("div",Mnt));n.setClass(r,"settings-okmsg");var a=n.appendChild(r,n.elem("div",Mnt));n.setClass(a,"settings-cnt-okmsg custom-scrollbar-okmsg");var i=n.appendChild(a,n.elem("dl",Mnt)),s=n.appendChild(i,n.elem("dt",Mnt)),u=o._15=n.appendChild(s,n.createComponent("msg-l10n",ae,t));n.mountComponent(u,n.propsSet(u,{key:"choose-video"}));var c=n.appendChild(i,n.elem("dd",Mnt)),p=n.createInjector(c);o._18=n.mountIterator(t,p,Fnt,Wnt);var l=n.appendChild(a,n.elem("dl",Mnt)),m=n.appendChild(l,n.elem("dt",Mnt)),d=o._1j=n.appendChild(m,n.createComponent("msg-l10n",ae,t));n.mountComponent(d,n.propsSet(d,{key:"choose-audio"}));var _=n.appendChild(l,n.elem("dd",Mnt)),f=n.createInjector(_);return o._1m=n.mountIterator(t,f,Ynt,Jnt),tot}function tot(t,e){n.updateIterator(e._18),n.updateIterator(e._1m)}function eot(t){return t.state.settingsOpened?Znt:null}function not(t,e,o){var r=o._v=n.insert(e,n.createComponent("msg-icon",xe,t)),a=o._w=n.propsSet(r,{icon:"settings"});return Hnt(0,a,t),o._x=n.addEvent(r,"click",pnt,t,o),n.mountComponent(r,a),o._y=n.mountBlock(t,e,eot),oot}function oot(t,e){var o=e._v,r=e._w;Hnt(0,r,t),n.updateComponent(o,r),n.updateBlock(e._y)}function rot(t,e){return e.showSettings?not:null}function aot(t,e,n){e.icon=n.state.playing?"pause":"play"}function iot(t,e,n){e.title=n.store.data.l10n("button-send")}function sot(t,e,n){e.preventDefault(),bnt(t)}function uot(t,e,o){var r=o._1z=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._21=n.addEvent(r,"click",lnt,t,o);var i=o._22=n.insert(a,n.createComponent("msg-icon",xe,t),""),s=o._23=n.propsSet(i,{size:"medium"});aot(0,s,t),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{class:"secondary-okmsg",shape:"circle",size:"big","data-l":"t,playPauseButton","data-tsid":"button_play_pause"}));var u=o._25=n.insert(e,n.createComponent("msg-button",fe,t)),c=u.componentModel.input,p=o._26=n.propsSet(u,{class:"primary-okmsg",shape:"circle",size:"big","data-l":"t,sendButton","data-tsid":"button_send"});iot(0,p,t),o._27=n.addEvent(u,"click",sot,t,o);var l=o._28=n.insert(c,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(l,n.propsSet(l,{icon:"send",size:"medium"})),n.mountComponent(u,p),cot}function cot(t,e){var o=e._22,r=e._23,a=e._25,i=e._26;aot(0,r,t),n.updateComponent(o,r),iot(0,i,t),n.updateComponent(a,i)}function pot(t,e,n){e.duration=n.state.duration}function lot(t,e,o){n.updateAttribute(t,e,"title",o.store.data.l10n("button-stop-record"))}function mot(t,e,n){e.preventDefault(),knt(t,e)}function dot(t,e,o){var r=o._2d=n.insert(e,n.createComponent("msg-duration",qi,t)),a=o._2e=n.propsSet(r);pot(0,a,t),n.mountComponent(r,a);var i=o._2f=n.insert(e,n.elem("div",Mnt)),s=o._2g=n.obj();return n.setClass(i,"stop-button-okmsg"),lot(i,s,t),o._2h=n.addEvent(i,"click",mot,t,o),_ot}function _ot(t,e){var o=e._2d,r=e._2e;pot(0,r,t),n.updateComponent(o,r),lot(e._2f,e._2g,t)}function fot(t,e,o){n.updateAttribute(t,e,"title",o.store.data.l10n("button-start-record"))}function got(t,e,n){e.preventDefault(),vnt(t)}function vot(t,e,o){var r=o._2k=n.insert(e,n.elem("div",Mnt)),a=o._2l=n.obj();return n.setClass(r,"record-button-okmsg"),fot(r,a,t),o._2m=n.addEvent(r,"click",got,t,o),hot}function hot(t,e){fot(e._2k,e._2l,t)}function Cot(t,e){return e.isRecorded?uot:e.isRecording?dot:vot}function kot(t,e,o){var r=o._o=n.insert(e,n.elem("video",Mnt));n.setPendingRef(o._1,"video",r),qnt(r,o._p=n.obj(),t),o._q=n.addEvent(r,"ended",mnt,t,o),o._r=n.addEvent(r,"loadeddata",dnt,t,o),o._s=n.mountBlock(t,e,rot);var a=n.insert(e,n.elem("div",Mnt)),i=n.createInjector(a);return n.setClass(a,"button-container-okmsg"),o._1w=n.mountBlock(t,i,Cot),bot}function bot(t,e){var o=e._o;n.setPendingRef(e._1,"video",o),qnt(o,e._p,t),n.updateBlock(e._s),n.updateBlock(e._1w)}function yot(t,e){return e.isError?null:kot}function Sot(t){Zt(t,"recording-video-stop")}function wot(t,e){var o=t.componentView;jnt();var r=e._1=n.obj();Rnt(t,e);var a=e._7=n.appendChild(o,n.elem("div",Mnt)),i=n.createInjector(a);n.setRef(t,"uiPanel",a),Lnt(a,e._8=n.obj(),t,e),e._9=n.addEvent(a,"mousedown",_nt,t,e),e._a=n.mountBlock(t,i,Nnt),e._l=n.mountBlock(t,i,yot);var s=e._2o=n.insert(i,n.createComponent("msg-icon",xe,t));return e._2q=n.addEvent(s,"click",Sot,t,e),n.mountComponent(s,n.propsSet(s,{icon:"close"})),Pnt(),n.subscribeStore(t,["l10n"]),n.finalizePendingRefs(t,r),Eot}function Eot(t,e){jnt(),Rnt(t,e),Lnt(e._7,e._8,t,e),n.updateBlock(e._a),n.updateBlock(e._l),Pnt(),n.finalizePendingRefs(t,e._1)}Dnt.dispose=function(t){t._f=n.unmountComponent(t._f),t._i=n.unmountComponent(t._i),t._g=t._j=null},Wnt.dispose=function(t){t._1d=n.removeEvent("click",t._1d),t._1b=n.unmountComponent(t._1b),t._1c=t._1e=null},Jnt.dispose=function(t){t._1r=n.removeEvent("click",t._1r),t._1p=n.unmountComponent(t._1p),t._1q=t._1s=null},Znt.dispose=function(t){t._15=n.unmountComponent(t._15),t._18=n.unmountIterator(t._18),t._1j=n.unmountComponent(t._1j),t._1m=n.unmountIterator(t._1m)},not.dispose=function(t){t._x=n.removeEvent("click",t._x),t._v=n.unmountComponent(t._v),t._y=n.unmountBlock(t._y),t._w=null},uot.dispose=function(t){t._21=n.removeEvent("click",t._21),t._22=n.unmountComponent(t._22),t._1z=n.unmountComponent(t._1z),t._27=n.removeEvent("click",t._27),t._28=n.unmountComponent(t._28),t._25=n.unmountComponent(t._25),t._23=t._26=null},dot.dispose=function(t){t._2d=n.unmountComponent(t._2d),t._2h=n.removeEvent("click",t._2h),t._2e=t._2g=t._2f=null},vot.dispose=function(t){t._2m=n.removeEvent("click",t._2m),t._2l=t._2k=null},kot.dispose=function(t){t._q=n.removeEvent("ended",t._q),t._r=n.removeEvent("loadeddata",t._r),t._s=n.unmountBlock(t._s),t._1w=n.unmountBlock(t._1w),t._p=t._o=null},wot.dispose=function(t){jnt(),t._9=n.removeEvent("mousedown",t._9),t._a=n.unmountBlock(t._a),t._l=n.unmountBlock(t._l),t._2q=n.removeEvent("click",t._2q),t._2o=n.unmountComponent(t._2o),Pnt()};var xot={__proto__:null,cssScope:Mnt,default:wot,plugins:function(){return[zS(navigator.mediaDevices,"devicechange",Ent)]},props:function(){return{width:400,height:300}},didRender:function(t){gnt(t)},didMount:function(t){if(Bnt("start"),void 0===navigator.mediaDevices||"undefined"==typeof MediaRecorder)return t.setState({streamStatus:"unsupported"}),void Bnt("unsupported");fnt(t),t.setState({duration:0}),Snt(t).then((function(){var e=t.state,n=e.videoInputList,o=e.audioInputList;if(n.length){var r=n[0],a=o[0];cnt(t,r.deviceId,a&&a.deviceId),Bnt("granted")}else t.setState({streamStatus:"unavailable"}),Bnt("unavailable")})),function(t){if(t._shortcuts)return;t._shortcuts=OS({ESC:function(e){e.preventDefault(),e.stopPropagation(),Zt(t,"recording-video-stop")},ALL:function(){return null}})}(t)},willUnmount:function(t){knt(t,!0),ynt(t),wnt(t),function(t){t._shortcuts&&(t._shortcuts.destroy(),t._shortcuts=null)}(t)},changeDevice:unt,pickStream:cnt,toggleSettings:pnt,togglePlayback:lnt,onVideoEnded:mnt,onLoadedData:dnt,onDragStart:_nt,centerPosition:fnt,syncUIPos:gnt,startRecord:vnt,stopRecord:knt,submit:bnt,resetRecordedVideo:ynt};function Iot(t,e){e.store.app.chat.sendButtonMessage(e.props.chat.id,t),OK.logger.success("messagesLayer","reply-keyboard-click")}var Bot="exhlj23",Mot=[0],Aot=[];function Tot(){Aot.push(Mot),Mot=[0]}function jot(){Mot=Aot.pop()}function Pot(t){return n.get(t.props.keyboard,"keyboard")}function Rot(t,e,o,r){n.updateAttribute(t,e,"style","grid-template-columns: repeat("+n.get(r.value,"length")+", 1fr);")}function Lot(t,e){return e.value}function Oot(t,e,o,r){Iot(n.get(r.value,"message"),t)}function zot(t,e,o,r){n.updateClass(t,e,"contents-okmsg"+("POSITIVE"===n.get(r.value,"intent")?" __positive-okmsg":"")+("NEGATIVE"===n.get(r.value,"intent")?" __negative-okmsg":""))}function Dot(t,e,o){var r=o._9=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input;o._b=n.addEvent(r,"click",Oot,t,o);var i=o._c=n.insert(a,n.elem("span",Bot),"");return zot(i,o._d=n.obj(),0,o),o._e=n.appendChild(i,n.text(n.get(o.value,"text"))),n.mountComponent(r,n.propsSet(r,{tabindex:"0"})),Uot}function Uot(t,e){zot(e._c,e._d,0,e),Mot[0]|=n.updateText(e._e,n.get(e.value,"text")),n.updateIncomingSlot(e._9,"",Mot[0])}function Not(t,e,o){var r=o._4=n.insert(e,n.elem("div",Bot)),a=n.createInjector(r),i=o._5=n.obj();return n.setClass(r,"row-okmsg"),Rot(r,i,0,o),o._6=n.mountIterator(t,a,Lot,Dot),qot}function qot(t,e){Rot(e._4,e._5,0,e),n.updateIterator(e._6)}function Hot(t,e){var o=t.componentView;Tot();var r=n.createInjector(o);return e._1=n.mountIterator(t,r,Pot,Not),jot(),Fot}function Fot(t,e){Tot(),n.updateIterator(e._1),jot()}Dot.dispose=function(t){t._b=n.removeEvent("click",t._b),t._9=n.unmountComponent(t._9),t._d=t._e=t._c=null},Not.dispose=function(t){t._6=n.unmountIterator(t._6),t._5=t._4=null},Hot.dispose=function(t){Tot(),t._1=n.clearIterator(t._1),jot()};var Vot={__proto__:null,cssScope:Bot,default:Hot,didMount:function(t){OK.logger.success("messagesLayer","reply-keyboard-show")},onClick:Iot},Kot="backgroundTV",Wot={toggleFullscreen:function(){var t,e=this.refs.movie;e&&(this.setState({off:!1}),$L()?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():((t=(t=e)||document).requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen(),OK.logger.success("messagesLayer",Kot,"fullscreen")))},toggleSound:function(t){var e=this.refs.movie,n=this.state.off;if(e&&!n){var o=t?.02:.3;OK.logger.success("messagesLayer",Kot,t?"volume-min":"volume-max"),Got(e,{action:"volume",value:o})}},turnOnOff:function(){var t=this.refs.movie;if(t){var e=this.state.off,n=e?"unmute":"mute";OK.logger.success("messagesLayer",Kot,e?"turn-on":"turn-off"),Got(t,{action:n}),this.setState({off:!e}),Zt(this,"tv-toggle",!e)}}};function Got(t,e){t.contentWindow.postMessage(e,"*")}var Yot="e-h91soi";function Xot(t,e){e.muted=t.state.safari?1:0}function Qot(t,e,o){n.updateClass(t,e,"movie_cnt-okmsg"+(o.state.off?" __off-okmsg":""))}function Jot(t,e,o,r){n.updateAttribute(t,e,"src",n.get(o.store.data.config,"server","play-video-bg-url","url")+"?tv=1&autoplay=1&muted="+r.muted+"&white=1")}function $ot(t,e){Xot(t,e),Qot(e._4,e._5,t),Jot(e._6,e._7,t,e)}var Zot={__proto__:null,cssScope:Yot,default:function(t,e){var o=t.componentView;Xot(t,e);var r=n.appendChild(o,n.elem("div",Yot));n.setRef(t,"frame",r);var a=e._4=n.appendChild(r,n.elem("div",Yot));Qot(a,e._5=n.obj(),t);var i=e._6=n.appendChild(a,n.elem("iframe",Yot));n.setRef(t,"movie",i);var s=e._7=n.obj();return n.setAttribute(i,"width","100%"),n.setAttribute(i,"height","100%"),n.setAttribute(i,"frameborder","0"),n.setAttribute(i,"allow","autoplay; encrypted-media; fullscreen"),i.allowFullscreen="allowfullscreen",Jot(i,s,t,e),n.subscribeStore(t,["config"]),$ot},extend:Wot,willMount:function(t){var e,n,o=t.store.get().config;t.setState({safari:window.safari}),t._iframeListener=function(e){var n;"autoplay"===(null===(n=e.data)||void 0===n?void 0:n.event)&&(Got(t.refs.movie,{action:"volume",value:.02}),window.removeEventListener("message",t._iframeListener),OK.logger.success("messagesLayer",Kot,"started"))},window.safari&&!(null===(n=null===(e=null==o?void 0:o.user)||void 0===e?void 0:e.TV)||void 0===n?void 0:n.enabled)||window.addEventListener("message",t._iframeListener)},willUnmount:function(t){window.removeEventListener("message",t._iframeListener)}};var trt="ef9jjl6",ert=[0,0],nrt=[];function ort(){nrt.push(ert),ert=[0,0]}function rrt(){ert=nrt.pop()}function art(t,e){e.isBot=n.find(n.get(t.props.user,"options"),(function(t){return"BOT"===t})),e.isOfficial=n.find(n.get(t.props.user,"options"),(function(t){return"OFFICIAL"===t}))}function irt(t,e,o){e.label=o.props.label,e.class=n.get(o.props.user,"current")?"":"selectable-okmsg"}function srt(t,e,o){e.user=o.props.user,e.class=n.get(o.props.user,"current")?"":"link-okmsg"}function urt(t,e,o,r){e.id=n.get(o.props.user,"id"),e.official=r.isOfficial,e.highlights=o.props.highlights,e.bot=r.isBot,e.owner=o.props.owner,e.superadmin=o.props.superadmin,e.admin=o.props.admin}function crt(t,e,o){var r=o._i=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{class:"bot-label-okmsg",key:"bot"})),ert[1]=1}function prt(t,e,n){e.user=n.props.user}function lrt(t,e,o){var r=n.insert(e,n.elem("div",trt),"");n.setClass(r,"text-okmsg");var a=o._n=n.appendChild(r,n.createComponent("msg-online-label",ay,t)),i=o._o=n.propsSet(a);return prt(0,i,t),n.mountComponent(a,i),ert[1]=1,mrt}function mrt(t,e){var o=e._n,r=e._o;prt(0,r,t),n.updateComponent(o,r)}function drt(t,e){return e.isBot?crt:t.props.label?lrt:null}function _rt(t,e){var o=t.componentView;ort(),art(t,e);var r=e._4=n.appendChild(o,n.createComponent("msg-chat-item-container",eb,t)),a=r.componentModel.input,i=e._5=n.propsSet(r,{size:"small"});irt(0,i,t);var s=e._6=n.insert(a,n.createComponent("msg-user-card",Nh,t),"image"),u=e._7=n.propsSet(s,{slot:"image",size:"small","data-tsid":"chat_participants_list_item"});srt(0,u,t),n.mountComponent(s,u);var c=n.insert(a,n.elem("div",trt),"title");n.setClass(c,"title-okmsg"),n.setAttribute(c,"slot","title"),n.appendChild(c,n.createSlot(t,"name-icon",trt)),e._a=n.mountSlot(t,"name-icon");var p=e._b=n.appendChild(c,n.createComponent("msg-name",Sh,t)),l=p.componentModel.input,m=e._c=n.propsSet(p,{"data-tsid":"participant_id",formatting:!1});return urt(0,m,t,e),e._d=n.insert(l,n.text(n.get(t.props.user,"name"))),n.mountComponent(p,m),e._f=n.mountBlock(t,a,drt),n.insert(a,n.createSlot(t,"",trt),""),e._r=n.mountSlot(t,""),n.mountComponent(r,i),rrt(),frt}function frt(t,e){var o=e._4,r=e._5,a=e._6,i=e._7,s=e._b,u=e._c;ort(),art(t,e),irt(0,r,t),srt(0,i,t),n.updateComponent(a,i),urt(0,u,t,e),ert[0]|=n.updateText(e._d,n.get(t.props.user,"name")),n.updateIncomingSlot(s,"",ert[0]),n.updateComponent(s,u),n.updateBlock(e._f),n.updateIncomingSlot(o,"",ert[1]),n.updateComponent(o,r),rrt()}crt.dispose=function(t){t._i=n.unmountComponent(t._i),ert[1]=1},lrt.dispose=function(t){t._n=n.unmountComponent(t._n),t._o=null,ert[1]=1},_rt.dispose=function(t){ort(),t._6=n.unmountComponent(t._6),t._a=n.unmountSlot(t._a),t._b=n.unmountComponent(t._b),t._f=n.unmountBlock(t._f),t._r=n.unmountSlot(t._r),t._4=n.unmountComponent(t._4),rrt()};var grt={__proto__:null,cssScope:trt,default:_rt,props:function(){return{user:null,label:!0,highlights:null,admin:!1,superadmin:!1,owner:!1}}};var vrt="e6zd2ps",hrt=[0],Crt=[];function krt(){Crt.push(hrt),hrt=[0]}function brt(){hrt=Crt.pop()}function yrt(t,e){var o=n.insert(e,n.elem("div",vrt));n.setClass(o,"stub-okmsg");var r=n.appendChild(o,n.elem("div",vrt));n.setClass(r,"stub-avatar-okmsg");var a=n.appendChild(o,n.elem("div",vrt));n.setClass(a,"stub-name-okmsg");var i=n.appendChild(o,n.elem("div",vrt));n.setClass(i,"stub-status-okmsg")}function Srt(t){return n.get(t.props.user,"stub")?yrt:null}function wrt(t,e,n){e.user=n.props.user,e.size=n.props.avatarSize}function Ert(t,e,o){e.official=n.get(o.props.user,"official"),e.highlights=o.props.highlights,e.bot=jt(0,n.get(o.props.user,"options"),"BOT")}function xrt(t,e,n){e.user=n.props.user}function Irt(t,e,o){var r=n.insert(e,n.elem("div",vrt));n.setClass(r,"text-okmsg");var a=o._o=n.appendChild(r,n.createComponent("msg-online-label",ay,t)),i=o._p=n.propsSet(a);return xrt(0,i,t),n.mountComponent(a,i),Brt}function Brt(t,e){var o=e._o,r=e._p;xrt(0,r,t),n.updateComponent(o,r)}function Mrt(t){return t.props.label?Irt:null}function Art(t,e,o){e.value=n.get(o.props.user,"id"),e.checked=o.props.selected}function Trt(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-checkbox",hS,t)),a=o._v=n.propsSet(r,{name:"user","data-tsid":"add_user_to_chat_checkbox",tabindex:"-1"});return Art(0,a,t),n.mountComponent(r,a),jrt}function jrt(t,e){var o=e._u,r=e._v;Art(0,r,t),n.updateComponent(o,r)}function Prt(t){return t.props.disabled?null:Trt}function Rrt(t,e,o){var r=n.insert(e,n.elem("div",vrt)),a=n.createInjector(r);n.setClass(r,"container-okmsg");var i=o._d=n.insert(a,n.createComponent("msg-user-card",Nh,t)),s=o._e=n.propsSet(i,{showStatus:!0});wrt(0,s,t),n.mountComponent(i,s);var u=n.insert(a,n.elem("span",vrt)),c=n.createInjector(u);n.setClass(u,"name-okmsg");var p=o._g=n.insert(c,n.createComponent("msg-name",Sh,t)),l=p.componentModel.input,m=o._h=n.propsSet(p);return Ert(0,m,t),o._i=n.insert(l,n.text(n.get(t.props.user,"name"))),n.mountComponent(p,m),o._k=n.mountBlock(t,c,Mrt),o._r=n.mountBlock(t,a,Prt),Lrt}function Lrt(t,e){var o=e._d,r=e._e,a=e._g,i=e._h;wrt(0,r,t),n.updateComponent(o,r),Ert(0,i,t),hrt[0]|=n.updateText(e._i,n.get(t.props.user,"name")),n.updateIncomingSlot(a,"",hrt[0]),n.updateComponent(a,i),n.updateBlock(e._k),n.updateBlock(e._r)}function Ort(t){return n.get(t.props.user,"stub")?null:Rrt}function zrt(t,e){var o=t.componentView;krt();var r=n.createInjector(o);return e._1=n.mountBlock(t,r,Srt),e._9=n.mountBlock(t,r,Ort),brt(),Drt}function Drt(t,e){krt(),n.updateBlock(e._1),n.updateBlock(e._9),brt()}Irt.dispose=function(t){t._o=n.unmountComponent(t._o),t._p=null},Trt.dispose=function(t){t._u=n.unmountComponent(t._u),t._v=null},Rrt.dispose=function(t){t._d=n.unmountComponent(t._d),t._g=n.unmountComponent(t._g),t._k=n.unmountBlock(t._k),t._r=n.unmountBlock(t._r),t._e=t._h=t._i=null},zrt.dispose=function(t){krt(),t._1=n.clearBlock(t._1),t._9=n.clearBlock(t._9),brt()};var Urt={__proto__:null,cssScope:vrt,default:zrt,props:function(){return{user:{},highlights:null,selected:!1,disabled:!1,avatarSize:"medium",label:!1}}},Nrt={small:40,medium:62},qrt=[Ltt];var Hrt={setQuery:function(t){if(this.setState({query:t}),this.query.update(t),(this.state.searchQuery||"")!==this.query.query){var e=this.query.query,n=this.props.users.some((function(t){return t.stub}));e.length&&n?Krt(this,e):this.setState({searchLoading:!1,searchQuery:e,search:null})}},getTokens:function(){var t=this.props.selected,e=this.store.get().contacts;return t?t.map((function(t){return e.has(t)?{id:(n=e.get(t)).id,itemId:n.id,caption:n.name,url:It(n)}:null;var n})).filter(Boolean):null},getItems:function(){return p(this.props.users)},updateList:function(t){var e=[];if(this.query.isEmpty)t.forEach((function(t){return e.push({contact:t})}));else{var n=new i,o=this.state.search;this.query.scoringSort(t,Vrt).result.forEach((function(t){var o=t.value,r=t.scoring.matches;n.add(o.id),e.push({contact:o,highlights:r})})),(null==o?void 0:o.contacts)&&o.contacts.forEach((function(t){t&&!n.has(t.id)&&e.push({contact:t})}))}var r=this.props.avatarSize;this._list.options.itemHeight=Nrt[r]||Nrt.medium,this._list.update(e,this.refs.scroller)}};function Frt(t){var e=t.refs.scroller;e&&sF(e,200)&&t.state.search&&function(t){var e=t.state,o=e.search,r=e.searchQuery,a=e.searchLoading;if(o.contacts&&o.contacts.length<o.total&&r&&!a){var i=o.contacts.length;return Wrt(t,r,i).then((function(e){var o,r=t.state.search;return(null===(o=null==r?void 0:r.contacts)||void 0===o?void 0:o.length)===i&&t.setState({search:n.__assign(n.__assign({},e),{contacts:r.contacts.concat(e.contacts)})}),e}))}Promise.resolve(null)}(t)}function Vrt(t){return"".concat(t.name," ").concat(Wn(t.link||""))}function Krt(t,e,n){return t.state.searchLoading?(t.setState({searchQuery:e}),Promise.resolve(null)):Wrt(t,e,n).catch((function(n){return t.state.searchQuery!==e?null:Promise.reject(n)})).then((function(n){var o=t.state.searchQuery;return o&&o!==e?(t.setState({searchLoading:!1}),Krt(t,o)):(o===e&&t.setState({search:n}),n)}))}function Wrt(t,e,n){return t.setState({searchQuery:e,searchLoading:!0,searchError:null}),t.store.app.contacts.search({query:e,count:50,from:n}).catch((function(n){return console.error("search error",n),t.state.searchQuery===e&&t.setState({searchLoading:!1,searchError:n}),Promise.reject(n)})).then((function(n){return t.state.searchQuery===e&&t.setState({searchLoading:!1}),n}))}var Grt="e-xkxwat",Yrt=[0],Xrt=[];function Qrt(){Xrt.push(Yrt),Yrt=[0]}function Jrt(){Yrt=Xrt.pop()}function $rt(t,e){e.value=void 0,e.loading=void 0}function Zrt(t,e,n){e.query=n.state.query,e.tokens=n.state.tokens,e.multiple=n.props.multiple,e.autofocus=n.props.autofocus,e.disabled=n.props.disabled,e.headerPlaceholder=n.props.queryPlaceholderText||n.store.data.l10n("contact-picker-placeholder"),e.items=n.props.users}function tat(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function eat(t,e,o){var r=n.insert(e,n.elem("div",Grt));n.setClass(r,"not-found-okmsg"),n.setAttribute(r,"data-tsid","friends_not_found");var a=o._f=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"search"}));var i=o._h=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"friends-not-found"})),Yrt[0]=1}function nat(t){return 0===Tt(0,n.get(t.state.scrollList,"items"))&&t.state.query&&!t.state.searchLoading?eat:null}function oat(t){return n.get(t.state.scrollList,"items")}function rat(t,e){return n.get(e.value,"value","contact","id")}function aat(t,e){e.contact=n.get(e.value,"value","contact"),e.contactId=n.get(e.contact,"id")}function iat(t,e,o,r){e.user=r.contact,e.highlights=n.get(r.value,"value","highlights"),e.disabled=n.get(r.contact,"stub")||jt(0,o.props.disabled,r.contactId),e.selected=jt(0,o.props.selected,r.contactId),e["aria-selected"]=jt(0,o.props.selected,r.contactId)?"true":null,e.stub=n.get(r.contact,"stub"),e.avatarSize=o.props.avatarSize,e.label=o.props.label,e["data-picker-item"]=r.contactId,e.class=o.state.active===r.contactId?"js-active":""}function sat(t,e,o,r){n.call(t,"activate",[r.contactId])}function uat(t,e,o,r){n.call(t,"deactivate",[r.contactId])}function cat(t,e,o){aat(0,o);var r=o._q=n.insert(e,n.createComponent("msg-user-picker-list-item",Urt,t)),a=o._r=n.propsSet(r,{role:"menuitem","data-l":"t,item","data-tsid":"item-wrapper"});return iat(0,a,t,o),o._s=n.addEvent(r,"mouseenter",sat,t,o),o._t=n.addEvent(r,"mouseleave",uat,t,o),n.mountComponent(r,a),Yrt[0]=1,pat}function pat(t,e){var o=e._q,r=e._r;aat(0,e),iat(0,r,t,e),n.updateComponent(o,r)}function lat(t,e,o){var r=n.insert(e,n.elem("div",Grt));n.setClass(r,"loader-okmsg");var a=o._y=n.appendChild(r,n.createComponent("msg-progress",Ps,t));n.mountComponent(a,n.propsSet(a,{size:24,indeterminate:!0,radius:10,thickness:2,spin:!0})),Yrt[0]=1}function mat(t,e){return e.loading?lat:null}function dat(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px")}function _at(t,e){var o=t.componentView;Qrt(),$rt(0,e);var r=e._4=n.appendChild(o,n.createComponent("msg-picker",ftt,t)),a=r.componentModel.input;n.setRef(t,"basePicker",r);var i=e._5=n.propsSet(r,{"data-tsid":"user_and_chat_block"});Zrt(0,i,t);var s=n.insert(a,n.elemWithText("h4","Список пользователей",Grt),"");n.setClass(s,"visually-hidden-okmsg");var u=n.insert(a,n.elem("div",Grt),""),c=n.createInjector(u);return n.setRef(t,"scroller",u),n.setAttribute(u,"role","menu"),n.setClass(u,"scroller-okmsg custom-scrollbar-okmsg"),e._8=n.addEvent(u,"scroll",Frt,t,e),tat(e._9=n.insert(c,n.elem("div",Grt)),e._a=n.obj(),t),e._b=n.mountBlock(t,c,nat),e._k=n.mountKeyIterator(t,c,oat,rat,cat),e._u=n.mountBlock(t,c,mat),dat(e._10=n.insert(c,n.elem("div",Grt)),e._11=n.obj(),t),n.mountComponent(r,i),Jrt(),n.subscribeStore(t,["l10n"]),fat}function fat(t,e){var o=e._4,r=e._5;Qrt(),$rt(0,e),Zrt(0,r,t),tat(e._9,e._a,t),n.updateBlock(e._b),n.updateKeyIterator(e._k),n.updateBlock(e._u),dat(e._10,e._11,t),n.updateIncomingSlot(o,"",Yrt[0]),n.updateComponent(o,r),Jrt()}eat.dispose=function(t){t._f=n.unmountComponent(t._f),t._h=n.unmountComponent(t._h),Yrt[0]=1},cat.dispose=function(t){t._s=n.removeEvent("mouseenter",t._s),t._t=n.removeEvent("mouseleave",t._t),t._q=n.unmountComponent(t._q),t._r=null,Yrt[0]=1},lat.dispose=function(t){t._y=n.unmountComponent(t._y),Yrt[0]=1},_at.dispose=function(t){Qrt(),t._8=n.removeEvent("scroll",t._8),t._b=n.unmountBlock(t._b),t._k=n.unmountKeyIterator(t._k),t._u=n.unmountBlock(t._u),t._4=n.unmountComponent(t._4),Jrt()};var gat={__proto__:null,cssScope:Grt,default:_at,plugins:qrt,props:function(){return{users:[],avatarSize:"medium"}},state:function(t){var e=function(){var e=t.state.scrollList,n=[];e&&e.items&&e.items.forEach((function(t){var e=t.value.contact;e.stub&&n.push(e.id)})),n.length&&t.store.app.contacts.fetchMissing(n)},n=o.debounce(e,300),r=!0;return{listOptions:{itemHeight:Nrt.medium,initialItems:20,batchSize:10,onUpdate:function(o){t.setState({scrollList:o}),r?(r=!1,e()):n()}}}},extend:Hrt,handleScroll:Frt};function vat(t,e){e.stopPropagation(),function(t,e){var n=t.props,o=n.maxCount,r=t.state,a=r.selected;o>0&&a.length>=o?Zt(t,"show-toast",V("error-chat.participants.limit")):a.includes(e)||Sat(t,a.concat(e))}(t,Number(e.detail))}function hat(t,e){e.stopPropagation(),function(t,e){var n=t.state,o=n.selected;o.includes(e)&&Sat(t,o.filter((function(t){return t!==e})))}(t,Number(e.detail))}function Cat(t){t.props.allowSubmit&&yat(t)&&kat(t)}function kat(t,e){e&&e.stopPropagation();var n=t.refs.history;Ot(t,"submit",{userIds:t.state.selected,showHistory:!!n&&n.checked})}function bat(t,e){(e&&e.stopPropagation(),yat(t))?L(t,"confirm").show({header:V("exit-action"),body:V("chat-info-member-add-cancel"),buttons:[{label:V("quit"),action:function(){return Ot(t,"cancel")}},V("confirm-cancel-button")]}):Ot(t,"cancel")}function yat(t){var e=t.state.selected;return e&&e.length}function Sat(t,e){t.setState({selected:e})}var wat="e-esv8rz";function Eat(t,e,n){e.users=n.props.users,e.disabled=n.props.disabled,e.allow=n.props.allowUsers,e.selected=n.state.selected,e.autofocus=n.props.autofocus}function xat(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-checkbox",hS,t)),a=r.componentModel.input;n.setPendingRef(o._1,"history",r);var i=o._f=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(i,n.propsSet(i,{key:"open-history"})),n.mountComponent(r,n.propsSet(r,{name:"show-history",checked:!0,shape:"square","data-tsid":"show_history","data-l":"t,show-history-checkbox"})),Iat}function Iat(t,e){n.setPendingRef(e._1,"history",e._d)}function Bat(t){return t.props.showHistoryButton?xat:null}function Mat(t,e,n){e.disabled=!n.props.allowSubmit||0==Tt(0,n.state.selected)}function Aat(t,e){var o=t.componentView,r=e._1=n.obj(),a=n.appendChild(o,n.elem("div",wat));n.setClass(a,"content-okmsg");var i=e._3=n.appendChild(a,n.createComponent("msg-user-picker",gat,t)),s=e._4=n.propsSet(i,{avatarSize:"small",multiple:!0,"data-l":"t,user-picker"});Eat(0,s,t),e._5=n.addEvent(i,"select-item",vat,t,e),e._6=n.addEvent(i,"unselect-item",hat,t,e),e._7=n.addEvent(i,"submit-items",Cat,t,e),e._8=n.addEvent(i,"close",bat,t,e),n.mountComponent(i,s);var u=n.appendChild(o,n.elem("footer",wat)),c=n.createInjector(u);e._a=n.mountBlock(t,c,Bat),n.insert(c,n.createSlot(t,"",wat)),e._k=n.mountSlot(t,"");var p=n.insert(c,n.elem("div",wat));n.setClass(p,"buttons-okmsg");var l=e._m=n.appendChild(p,n.createComponent("msg-button",fe,t)),m=l.componentModel.input,d=e._n=n.propsSet(l,{shape:"square",class:"primary-okmsg action-okmsg","data-l":"t,submit","data-tsid":"finish_create_chat_button"});Mat(0,d,t),e._o=n.addEvent(l,"click",Cat,t,e);var _=e._p=n.insert(m,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(_,n.propsSet(_,{key:"add"})),n.mountComponent(l,d);var f=e._s=n.appendChild(p,n.createComponent("msg-button",fe,t)),g=f.componentModel.input;e._u=n.addEvent(f,"click",bat,t,e);var v=e._v=n.insert(g,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(v,n.propsSet(v,{key:"cancel"})),n.mountComponent(f,n.propsSet(f,{shape:"square",class:"secondary-okmsg action-okmsg","data-l":"t,cancel"})),n.finalizePendingRefs(t,r),Tat}function Tat(t,e){var o=e._3,r=e._4,a=e._m,i=e._n;Eat(0,r,t),n.updateComponent(o,r),n.updateBlock(e._a),Mat(0,i,t),n.updateComponent(a,i),n.finalizePendingRefs(t,e._1)}xat.dispose=function(t){t._f=n.unmountComponent(t._f),t._d=n.unmountComponent(t._d)},Aat.dispose=function(t){t._5=n.removeEvent("select-item",t._5),t._6=n.removeEvent("unselect-item",t._6),t._7=n.removeEvent("submit-items",t._7),t._8=n.removeEvent("close",t._8),t._3=n.unmountComponent(t._3),t._a=n.unmountBlock(t._a),t._k=n.unmountSlot(t._k),t._o=n.removeEvent("click",t._o),t._p=n.unmountComponent(t._p),t._m=n.unmountComponent(t._m),t._u=n.removeEvent("click",t._u),t._v=n.unmountComponent(t._v),t._s=n.unmountComponent(t._s)};var jat={__proto__:null,cssScope:wat,default:Aat,props:function(){return{users:null,disabled:null,autofocus:!1,allowSubmit:!0,allowUsers:"all",okChat:!1,showHistoryButton:!1,maxCount:-1}},state:function(){return{selected:[]}},onSelectItem:vat,onUnselectItem:hat,onSubmit:Cat,submit:kat,cancel:bat};var Pat="e-fyundx",Rat=[0],Lat=[];function Oat(){Lat.push(Rat),Rat=[0]}function zat(){Rat=Lat.pop()}function Dat(t,e,o){e.key=o.props.allowBlock?"block-participant-confirm-body":"remove-participant-confirm-body",e["data-user"]=n.get(o.props.participant,"name"),e["data-gender"]=n.get(o.props.participant,"gender"),e["data-type"]=o.props.chatType}function Uat(t,e,n){e["data-value"]=n.state.messageRemoveRange}function Nat(t,e){t.setState({messageRemoveRange:0})}function qat(t,e){t.setState({messageRemoveRange:-1})}function Hat(t,e){e["data-value"]=-1}function Fat(t,e){t.setState({messageRemoveRange:86400})}function Vat(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-bubble",me,t)),a=r.componentModel.input,i=n.insert(a,n.elem("div",Pat),"element");n.setAttribute(i,"slot","element");var s=o._9=n.appendChild(i,n.createComponent("msg-l10n",ae,t));n.mountComponent(s,n.propsSet(s,{key:"remove-participant-messages-text"})),o._b=n.appendChild(i,n.text(" "));var u=o._c=n.appendChild(i,n.createComponent("msg-l10n",ae,t)),c=o._d=n.propsSet(u,{key:"remove-participant-messages"});Uat(0,c,t),n.mountComponent(u,c);var p=o._e=n.insert(a,n.createComponent("msg-menu",bS,t),"bubble"),l=p.componentModel.input,m=o._g=n.insert(l,n.createComponent("msg-menu-item",ES,t),""),d=m.componentModel.input;o._h=n.addEvent(m,"click",Nat,t,o);var _=o._i=n.insert(d,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(_,n.propsSet(_,{key:"remove-participant-messages","data-value":0})),n.mountComponent(m);var f=o._l=n.insert(l,n.createComponent("msg-menu-item",ES,t),""),g=f.componentModel.input;o._m=n.addEvent(f,"click",qat,t,o);var v=o._n=n.insert(g,n.createComponent("msg-l10n",ae,t),""),h=o._o=n.propsSet(v,{key:"remove-participant-messages"});Hat(0,h),n.mountComponent(v,h),n.mountComponent(f);var C=o._q=n.insert(l,n.createComponent("msg-menu-item",ES,t),""),k=C.componentModel.input;o._r=n.addEvent(C,"click",Fat,t,o);var b=o._s=n.insert(k,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(b,n.propsSet(b,{key:"remove-participant-messages","data-value":86400})),n.mountComponent(C),n.mountComponent(p,n.propsSet(p,{slot:"bubble"})),n.mountComponent(r,n.propsSet(r,{yAxis:"bottom",container:"msg-confirm"})),Kat}function Kat(t,e){var o=e._c,r=e._d,a=e._n,i=e._o;Rat[0]|=n.updateText(e._b," "),Uat(0,r,t),n.updateComponent(o,r),Hat(0,i),n.updateComponent(a,i),n.updateIncomingSlot(e._6,"element",Rat[0])}function Wat(t){return t.props.allowRemove?Vat:null}function Gat(t,e){var o=t.componentView;Oat();var r=n.createInjector(o),a=e._1=n.insert(r,n.createComponent("msg-l10n",ae,t)),i=e._2=n.propsSet(a);return Dat(0,i,t),n.mountComponent(a,i),e._3=n.mountBlock(t,r,Wat),zat(),Yat}function Yat(t,e){var o=e._1,r=e._2;Oat(),Dat(0,r,t),n.updateComponent(o,r),n.updateBlock(e._3),zat()}Vat.dispose=function(t){t._9=n.unmountComponent(t._9),t._c=n.unmountComponent(t._c),t._h=n.removeEvent("click",t._h),t._i=n.unmountComponent(t._i),t._g=n.unmountComponent(t._g),t._m=n.removeEvent("click",t._m),t._n=n.unmountComponent(t._n),t._l=n.unmountComponent(t._l),t._r=n.removeEvent("click",t._r),t._s=n.unmountComponent(t._s),t._q=n.unmountComponent(t._q),t._e=n.unmountComponent(t._e),t._6=n.unmountComponent(t._6),t._b=t._d=t._o=null},Gat.dispose=function(t){Oat(),t._1=n.unmountComponent(t._1),t._3=n.clearBlock(t._3),zat()};var Xat={__proto__:null,cssScope:Pat,default:Gat,props:function(){return{participant:null,allowBlock:!1,allowRemove:!1,chatType:null}},state:function(){return{messageRemoveRange:0}},methods:{getMessagesRemove:function(){return this.state.messageRemoveRange}}},Qat={VIEW:"VIEW",TRANSFER_OWNER:"TRANSFER_OWNER",ADD_ADMIN:"ADD_ADMIN"};function Jat(t){var e=t.refs,n=e.scroller,o=e.beacon;if(n&&o){var r=n.getBoundingClientRect(),a=o.getBoundingClientRect();t._list.handleScroll(n,n.scrollTop+a.top-r.top)}}function $at(t){var e=t.refs.addParticipants;e&&e.setProps({autofocus:!0})}function Zat(t,e){var n=e.detail,o=L(t,"participants"),r=t.props.chat;o.add(r.id,n.userIds,n.showHistory),tit(t)}function tit(t){t.setState({addParticipantsMode:null})}function eit(t){var e=t.props.chat,n=new i;e.participants&&e.participants.forEach((function(t){return n.add(t.user.id)})),e.members&&e.members.items&&e.members.items.forEach((function(t){return n.add(t.id)})),t.setState({addParticipantsMode:!0,participantIds:p(n)})}function nit(t){var e=t.props.chat;return e.participantsMarker||e.members&&e.members.marker}function oit(t,e){if(t.query.update(e)){t._list.reset(),t.setState({query:e});var n=t.props.chat.id;nit(t)&&Zt(t,"search-participants",{chatId:n,query:e,type:"MEMBER"})}}function rit(t,e){var n=e.store.get().contacts.get(t),o=e.props,r=o.chat,a=o.mode,i=r.admins,s=i&&i.find((function(e){return e.user.id===t}));Zt(e,"toggle-aside-content",{tabName:"manage-admin",tabData:{user:n,inviter:s&&s.inviter,source:a}})}function ait(t,e,o){o.stopPropagation();var r=L(e,"confirm"),a=L(e,"participants"),i=e.props,s=i.chat,u=i.config,c=s.link&&"CHANNEL"!==s.type,p=u.server["remove-user-msg-del"]&&"CHANNEL"!==s.type,l=function(t,e){var n=t.participants.find((function(t){return t.user.id===e}));return n?n=n.user:t.participantsSearch?n=t.participantsSearch.members.find((function(t){return t.id===e})):t.members&&(n=t.members.items.find((function(t){return t.id===e}))),n}(s,t),m=n.endorphin("msg-chat-participants-confirm-body",Xat,{props:{participant:l,allowBlock:c,allowRemove:p,chatType:s.type},store:e.store}),d=[{label:V(c?"block-participant-confirm-button":"remove-participant-confirm-button"),action:function(){var t=m.getMessagesRemove();c?(oit(e,""),a.block(s.id,l.id,t)):a.remove(s.id,l.id,t)}},V("confirm-cancel-button")];r.show({header:V(c?"block-participant-confirm-header":"remove-participant-confirm-header",{type:s.type}),body:m,buttons:d})}function iit(t,e){oit(t,e.target.value)}function sit(t,e){var n=e.props,o=n.chat,r=n.mode;r===Qat.TRANSFER_OWNER?Zt(e,"transfer-ownership",{chatId:o.id,userId:t.id}):r===Qat.ADD_ADMIN?rit(t.id,e):Zp(t.id,{useBack:!0})}function uit(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=new i,o=[];return t.forEach((function(t){t.forEach((function(t){var e=t.id;n.has(e)||(n.add(e),o.push(t))}))})),o}var cit="ew3hycl",pit=[0,0,0],lit=[];function mit(){lit.push(pit),pit=[0,0,0]}function dit(){pit=lit.pop()}function _it(t,e){e.owner=n.get(t.props.chat,"owner"),e.currentUser=n.get(n.find(n.get(t.props.chat,"participants"),(function(t){return n.get(t,"user","current")})),"user"),e.isOwner=n.get(e.currentUser,"id")===n.get(e.owner,"id"),e.permissions=n.get(n.find(n.get(t.props.chat,"admins"),(function(t){return n.get(t,"user","current")})),"permissions"),e.settingsEnabled=n.get(t.store.data.config,"server","settings"),e.settingsUse=n.get(t.store.data.config,"server","settings-use"),e.countLeft=n.get(t.props.config,"server","max-participants")-n.get(t.props.chat,"participantsCount"),e.canAddChat="CHAT"==n.get(t.props.chat,"type")&&"LEFT"!=n.get(t.props.chat,"status")&&e.countLeft>0&&(!n.get(t.props.chat,"options","ONLY_ADMIN_CAN_ADD_MEMBER")||n.get(e.permissions,"manageParticipants")),e.canAddChannel="CHANNEL"==n.get(t.props.chat,"type")&&n.get(e.permissions,"manageParticipants"),e.canAdd=!e.settingsUse||e.canAddChat||e.canAddChannel,e.value=void 0}function fit(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function git(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._j=n.addEvent(r,"click",eit,t,o);var i=o._k=n.insert(a,n.createComponent("msg-l10n",ae,t),""),s=o._l=n.propsSet(i,{key:"add-participants"});return fit(0,s,t),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{class:"add-okmsg",icon:"add","data-tsid":"add_participants_link","data-l":"t,add-participant"})),vit}function vit(t,e){var o=e._k,r=e._l;fit(0,r,t),n.updateComponent(o,r)}function hit(t){Zt(t,"hide-aside")}function Cit(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function kit(t,e,o){var r=o._x=n.insert(e,n.createComponent("msg-l10n",ae,t),""),a=o._y=n.propsSet(r,{key:"participant-action-transfer-own"});return Cit(0,a,t),n.mountComponent(r,a),pit[0]=1,bit}function bit(t,e){var o=e._x,r=e._y;Cit(0,r,t),n.updateComponent(o,r)}function yit(t){return"TRANSFER_OWNER"===t.props.mode?kit:null}function Sit(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function wit(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-l10n",ae,t),""),a=o._14=n.propsSet(r,{key:"add-admins-modal"});return Sit(0,a,t),n.mountComponent(r,a),pit[0]=1,Eit}function Eit(t,e){var o=e._13,r=e._14;Sit(0,r,t),n.updateComponent(o,r)}function xit(t){return"ADD_ADMIN"===t.props.mode?wit:null}function Iit(t,e,o){var r=o._p=n.insert(e,n.createComponent("msg-toolbar",qk,t)),a=r.componentModel.input;o._r=n.addEvent(r,"click",hit,t,o);var i=o._s=n.insert(a,n.createComponent("msg-tico",rc,t),""),s=i.componentModel.input;return o._u=n.mountBlock(t,s,yit),o._10=n.mountBlock(t,s,xit),n.mountComponent(i,n.propsSet(i,{icon:"back",size:"medium"})),n.mountComponent(r,n.propsSet(r,{"data-l":"t,back"})),Bit}function Bit(t,e){n.updateBlock(e._u),n.updateBlock(e._10),n.updateIncomingSlot(e._s,"",pit[0])}function Mit(t,e){return"VIEW"===t.props.mode&&e.canAdd?git:"TRANSFER_OWNER"===t.props.mode||"ADD_ADMIN"===t.props.mode?Iit:null}function Ait(t,e,o){e.focused=o.props.autofocus,e.value=o.state.query,e.placeholder=o.store.data.l10n("search-participants"),e.loading="loading"==n.get(o.props.chat,"participantsSearch","loadState")}function Tit(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function jit(t){return n.get(t.state.scrollList,"items")}function Pit(t,e){return n.get(e.value,"value","id")}function Rit(t,e){e.user=n.get(e.value,"value"),e.userAdmin=jt(0,t.state.adminIds,n.get(e.user,"id")),e.userSuperadmin=jt(0,t.state.superadminIds,n.get(e.user,"id")),e.userOwner=n.get(e.owner,"id")===n.get(e.user,"id"),e.canSeeRole=e.settingsEnabled&&n.get(e.permissions,"manageAdmins"),e.notManagable=e.userSuperadmin&&!n.get(e.permissions,"manageAdmins"),e.needMenu="TRANSFER_OWNER"!==t.props.mode&&"ADD_ADMIN"!==t.props.mode,e.ifExpr=e.needMenu&&e.settingsEnabled&&!n.get(e.user,"current")&&!e.userOwner&&!e.notManagable&&n.get(e.permissions,"manageParticipants"),e.ifExpr_1=e.needMenu&&!e.settingsEnabled&&!n.get(e.user,"current")&&n.get(e.owner,"id")!==n.get(e.user,"id")&&e.isOwner}function Lit(t,e,o,r){e.user=r.user,e.label=!n.get(r.user,"current")&&!r.userOwner,e.highlights=o.state.highlights,e.owner=r.canSeeRole&&r.userOwner,e.superadmin=r.canSeeRole&&r.userSuperadmin,e.admin=r.canSeeRole&&r.userAdmin,e.class=(r.ifExpr?"__actions-okmsg":"")+(r.ifExpr_1?" __actions-okmsg":"")}function Oit(t,e,n,o){sit(o.user,t)}function zit(t,e){e.stopPropagation()}function Dit(t,e,o,r){e.stopPropagation(),rit(n.get(r.user,"id"),t)}function Uit(t,e,o,r){Zt(t,"remove-admin",{userId:n.get(r.user,"id")})}function Nit(t,e,o){var r=o._2h=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input;o._2j=n.addEvent(r,"click",Dit,t,o);var i=o._2k=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"participant-action-edit-admin"})),n.mountComponent(r,n.propsSet(r,{"data-tsid":"edit_admin_button","data-l":"t,edit-admin"}));var s=o._2n=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),u=s.componentModel.input;o._2p=n.addEvent(s,"click",Uit,t,o);var c=o._2q=n.insert(u,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(c,n.propsSet(c,{key:"participant-action-remove-admin"})),n.mountComponent(s,n.propsSet(s,{"data-tsid":"remove_admin_button","data-l":"t,remove-admin"})),pit[2]=1}function qit(t,e){return e.userAdmin?Nit:null}function Hit(t,e,o,r){e.stopPropagation(),rit(n.get(r.user,"id"),t)}function Fit(t,e,o){var r=o._2w=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input;o._2y=n.addEvent(r,"click",Hit,t,o);var i=o._2z=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"participant-action-make-admin"})),n.mountComponent(r,n.propsSet(r,{"data-tsid":"make_admin_button","data-l":"t,make-admin"})),pit[2]=1}function Vit(t,e){return e.userAdmin?null:Fit}function Kit(t,e,o){return o._2e=n.mountBlock(t,e,qit),o._2t=n.mountBlock(t,e,Vit),Wit}function Wit(t,e){n.updateBlock(e._2e),n.updateBlock(e._2t)}function Git(t,e){return n.get(e.permissions,"manageAdmins")?Kit:null}function Yit(t,e,o,r){ait(n.get(r.user,"id"),t,e)}function Xit(t,e,o){var r=o._21=n.insert(e,n.createComponent("msg-bubble",me,t),""),a=r.componentModel.input;o._23=n.addEvent(r,"click",zit,t,o);var i=o._24=n.insert(a,n.createComponent("msg-button",fe,t),"element"),s=i.componentModel.input,u=o._26=n.insert(s,n.createComponent("msg-icon",xe,t),"");n.mountComponent(u,n.propsSet(u,{icon:"menu"})),n.mountComponent(i,n.propsSet(i,{shape:"circle",slot:"element"}));var c=o._29=n.insert(a,n.createComponent("msg-menu",bS,t),"bubble"),p=c.componentModel.input;o._2b=n.mountBlock(t,p,Git);var l=o._33=n.insert(p,n.createComponent("msg-menu-item",ES,t),""),m=l.componentModel.input;o._35=n.addEvent(l,"click",Yit,t,o);var d=o._36=n.insert(m,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(d,n.propsSet(d,{key:"participant-action-remove"})),n.mountComponent(l,n.propsSet(l,{"data-tsid":"remove_user_button","data-l":"t,remove-from-chat"})),n.mountComponent(c,n.propsSet(c,{slot:"bubble","data-l":"t,menu"})),n.mountComponent(r,n.propsSet(r,{xAxis:"right",yAxis:"top","no-offset":!0,container:".js-scroller","data-tsid":"context_participant_menu_button"})),pit[1]=1,Qit}function Qit(t,e){n.updateBlock(e._2b),n.updateIncomingSlot(e._29,"",pit[2])}function Jit(t,e){return e.ifExpr?Xit:null}function $it(t,e,o,r){ait(n.get(r.user,"id"),t,e)}function Zit(t,e,o){var r=o._3e=n.insert(e,n.createComponent("msg-button",fe,t),""),a=r.componentModel.input;o._3g=n.addEvent(r,"click",$it,t,o);var i=o._3h=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{size:"small",icon:"clear"})),n.mountComponent(r,n.propsSet(r,{class:"clear-okmsg",shape:"circle","data-l":"t,remove"})),pit[1]=1}function tst(t,e){return e.ifExpr_1?Zit:null}function est(t,e,o){var r=o._3r=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"its-you"})),pit[1]=1}function nst(t,e){return n.get(e.value,"value","current")?est:null}function ost(t,e,o){var r=n.insert(e,n.elem("span",cit));return o._3y=n.appendChild(r,n.text(" ")),n.appendChild(r,n.text("—")),o._40=n.appendChild(r,n.text(" ")),pit[1]=1,rst}function rst(t,e){pit[1]|=n.updateText(e._3y," "),pit[1]|=n.updateText(e._40," ")}function ast(t,e){return n.get(e.value,"value","current")&&n.get(e.owner,"id")===n.get(e.value,"value","id")?ost:null}function ist(t,e,o){var r=o._44=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"chat-owner"})),pit[1]=1}function sst(t,e){return n.get(e.owner,"id")===n.get(e.value,"value","id")?ist:null}function ust(t,e,o){var r=n.insert(e,n.elem("div",cit),""),a=n.createInjector(r);return n.setClass(r,"text-okmsg"),o._3o=n.mountBlock(t,a,nst),o._3u=n.mountBlock(t,a,ast),o._41=n.mountBlock(t,a,sst),pit[1]=1,cst}function cst(t,e){n.updateBlock(e._3o),n.updateBlock(e._3u),n.updateBlock(e._41)}function pst(t,e){return n.get(e.value,"value","current")||e.userOwner&&!e.settingsEnabled?ust:null}function lst(t,e,o){Rit(t,o);var r=o._1v=n.insert(e,n.createComponent("msg-chat-participants-list-item",grt,t)),a=r.componentModel.input,i=o._1w=n.propsSet(r,{role:"menuitem","data-l":"t,item","data-tsid":"participant_list_item"});return Lit(0,i,t,o),o._1x=n.addEvent(r,"click",Oit,t,o),o._1y=n.mountBlock(t,a,Jit),o._3b=n.mountBlock(t,a,tst),o._3k=n.mountBlock(t,a,pst),n.mountComponent(r,i),mst}function mst(t,e){var o=e._1v,r=e._1w;Rit(t,e),Lit(0,r,t,e),n.updateBlock(e._1y),n.updateBlock(e._3b),n.updateBlock(e._3k),n.updateIncomingSlot(o,"",pit[1]),n.updateComponent(o,r)}function dst(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px;")}function _st(t,e,o){var r=o._4b=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{class:"bottom-okmsg","data-tsid":"search_loader"}))}function fst(t){return"loading"==n.get(t.props.chat,"members","loadState")?_st:null}function gst(t,e,o){var r=o._1g=n.insert(e,n.elem("div",cit));n.setPendingRef(o._1,"beacon",r),Tit(r,o._1h=n.obj(),t),o._1i=n.mountKeyIterator(t,e,jit,Pit,lst);var a=o._46=n.insert(e,n.elem("div",cit)),i=n.createInjector(a);return dst(a,o._47=n.obj(),t),o._48=n.mountBlock(t,i,fst),vst}function vst(t,e){var o=e._1g;n.setPendingRef(e._1,"beacon",o),Tit(o,e._1h,t),n.updateKeyIterator(e._1i),dst(e._46,e._47,t),n.updateBlock(e._48)}function hst(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function Cst(t,e,o){o._4o=n.insert(e,n.text(" "));var r=o._4p=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._4r=n.addEvent(r,"click",eit,t,o);var i=o._4s=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(i,n.propsSet(i,{key:"ask-add"})),n.mountComponent(r,n.propsSet(r,{shape:"square",class:"secondary-okmsg","data-tsid":"add_participants_button_in_search_results"})),kst}function kst(t,e){n.updateText(e._4o," ")}function bst(t,e){return"VIEW"===t.props.mode&&e.canAdd?Cst:null}function yst(t,e,o){var r=n.insert(e,n.elem("div",cit)),a=n.createInjector(r);n.setClass(r,"not-found-okmsg"),n.setAttribute(r,"data-tsid","participants_not_found");var i=o._4h=n.insert(a,n.createComponent("msg-icon",xe,t));n.mountComponent(i,n.propsSet(i,{icon:"search"}));var s=o._4j=n.insert(a,n.createComponent("msg-l10n",ae,t)),u=o._4k=n.propsSet(s,{key:"participants-not-found"});return hst(0,u,t),n.mountComponent(s,u),o._4l=n.mountBlock(t,a,bst),Sst}function Sst(t,e){var o=e._4j,r=e._4k;hst(0,r,t),n.updateComponent(o,r),n.updateBlock(e._4l)}function wst(t){return Tt(0,n.get(t.state.scrollList,"items"))?gst:yst}function Est(t,e,o){e.users=Nt(0,o.store.data.contacts),e.disabled=o.state.participantIds,e.maxCount=n.get(o.props.config,"server","max-participants")-n.get(o.props.chat,"participantsCount"),e.showHistoryButton="CHANNEL"!==n.get(o.props.chat,"type")}function xst(t,e){var o=e._52,r=e._53;n.setPendingRef(e._1,"addParticipants",o),Est(0,r,t),n.updateComponent(o,r)}function Ist(t,e,o){return o._52?xst(t,o):function(t,e,o){var r=o._52=n.insert(e,n.createComponent("msg-chat-add-participants",jat,t));n.setPendingRef(o._1,"addParticipants",r);var a=o._53=n.propsSet(r,{allowSubmit:!0,"data-l":"t,add-participants-list","data-tsid":"root_multichat"});Est(0,a,t),o._54=n.addEvent(r,"submit",Zat,t,o),o._55=n.addEvent(r,"cancel",tit,t,o),o._56=n.addEvent(r,"animationend",$at,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._52,n.createAnimation("show-modal 0.3s ease-out",cit)),Bst}function Bst(t,e){xst(t,e)}function Mst(t){return t.state.addParticipantsMode?Ist:null}function Ast(t,e){var o=t.componentView;mit();var r=n.createInjector(o),a=e._1=n.obj();_it(t,e),e._e=n.mountBlock(t,r,Mit);var i=e._17=n.insert(r,n.createComponent("msg-search-input",BW,t)),s=e._18=n.propsSet(i,{name:"query","data-tsid":"search-in-chat-people"});Ait(0,s,t),e._19=n.addEvent(i,"input",iit,t,e),n.mountComponent(i,s);var u=n.insert(r,n.elemWithText("h4","Список участников чата",cit));n.setClass(u,"visually-hidden-okmsg");var c=n.insert(r,n.elem("div",cit)),p=n.createInjector(c);return n.setRef(t,"scroller",c),n.setAttribute(c,"role","menu"),n.setClass(c,"scroller-okmsg js-scroller custom-scrollbar-okmsg"),e._1c=n.addEvent(c,"scroll",Jat,t,e),e._1d=n.mountBlock(t,p,wst),e._4x=n.mountBlock(t,r,Mst),dit(),n.subscribeStore(t,["config","l10n","contacts"]),n.finalizePendingRefs(t,a),Tst}function Tst(t,e){var o=e._17,r=e._18;mit(),_it(t,e),n.updateBlock(e._e),Ait(0,r,t),n.updateComponent(o,r),n.updateBlock(e._1d),n.updateBlock(e._4x),dit(),n.finalizePendingRefs(t,e._1)}git.dispose=function(t){t._j=n.removeEvent("click",t._j),t._k=n.unmountComponent(t._k),t._h=n.unmountComponent(t._h),t._l=null},kit.dispose=function(t){t._x=n.unmountComponent(t._x),t._y=null,pit[0]=1},wit.dispose=function(t){t._13=n.unmountComponent(t._13),t._14=null,pit[0]=1},Iit.dispose=function(t){t._r=n.removeEvent("click",t._r),t._u=n.unmountBlock(t._u),t._10=n.unmountBlock(t._10),t._s=n.unmountComponent(t._s),t._p=n.unmountComponent(t._p)},Nit.dispose=function(t){t._2j=n.removeEvent("click",t._2j),t._2k=n.unmountComponent(t._2k),t._2h=n.unmountComponent(t._2h),t._2p=n.removeEvent("click",t._2p),t._2q=n.unmountComponent(t._2q),t._2n=n.unmountComponent(t._2n),pit[2]=1},Fit.dispose=function(t){t._2y=n.removeEvent("click",t._2y),t._2z=n.unmountComponent(t._2z),t._2w=n.unmountComponent(t._2w),pit[2]=1},Kit.dispose=function(t){t._2e=n.unmountBlock(t._2e),t._2t=n.unmountBlock(t._2t)},Xit.dispose=function(t){t._23=n.removeEvent("click",t._23),t._26=n.unmountComponent(t._26),t._24=n.unmountComponent(t._24),t._2b=n.unmountBlock(t._2b),t._35=n.removeEvent("click",t._35),t._36=n.unmountComponent(t._36),t._33=n.unmountComponent(t._33),t._29=n.unmountComponent(t._29),t._21=n.unmountComponent(t._21),pit[1]=1},Zit.dispose=function(t){t._3g=n.removeEvent("click",t._3g),t._3h=n.unmountComponent(t._3h),t._3e=n.unmountComponent(t._3e),pit[1]=1},est.dispose=function(t){t._3r=n.unmountComponent(t._3r),pit[1]=1},ost.dispose=function(t){t._3y=t._40=null,pit[1]=1},ist.dispose=function(t){t._44=n.unmountComponent(t._44),pit[1]=1},ust.dispose=function(t){t._3o=n.unmountBlock(t._3o),t._3u=n.unmountBlock(t._3u),t._41=n.unmountBlock(t._41),pit[1]=1},lst.dispose=function(t){t._1x=n.removeEvent("click",t._1x),t._1y=n.unmountBlock(t._1y),t._3b=n.unmountBlock(t._3b),t._3k=n.unmountBlock(t._3k),t._1v=n.unmountComponent(t._1v),t._1w=null},_st.dispose=function(t){t._4b=n.unmountComponent(t._4b)},gst.dispose=function(t){t._1i=n.unmountKeyIterator(t._1i),t._48=n.unmountBlock(t._48),t._1h=t._1g=t._47=t._46=null},Cst.dispose=function(t){t._4r=n.removeEvent("click",t._4r),t._4s=n.unmountComponent(t._4s),t._4p=n.unmountComponent(t._4p),t._4o=null},yst.dispose=function(t){t._4h=n.unmountComponent(t._4h),t._4j=n.unmountComponent(t._4j),t._4l=n.unmountBlock(t._4l),t._4k=null},Ist.dispose=function(t,e){n.animate(t._52,n.createAnimation("hide-modal 0.2s ease-out forwards",cit),(function(){return function(t){var e=t._52;t._54=n.removeEvent("submit",t._54),t._55=n.removeEvent("cancel",t._55),t._56=n.removeEvent("animationend",t._56),t._52=n.unmountComponent(e),n.domRemove(e),t._53=null}(t)}))},Ast.dispose=function(t){mit(),t._e=n.clearBlock(t._e),t._19=n.removeEvent("input",t._19),t._17=n.unmountComponent(t._17),t._1c=n.removeEvent("scroll",t._1c),t._1d=n.unmountBlock(t._1d),t._4x=n.clearBlock(t._4x),dit()};var jst={__proto__:null,cssScope:cit,default:Ast,props:function(){return{chat:null,contacts:null,autofocus:!1,config:null,mode:null}},state:function(){return{query:"",admins:null,adminIds:[],superadminIds:[]}},init:function(t){var e,n,o,r,i,s;t.query=new w0,t._sortContacts=(e=new a,n=function(t){return e.has(t)?e.get(t):-1},o=function(t){return t.presence&&t.presence.on?1:0},r=function(t){return t.presence&&t.presence.seen||0},i=function(t,e){return n(t.id)-n(e.id)||o(e)-o(t)||r(e)-r(t)},s=function(t,n){return e.has(t.id)||e.set(t.id,n),t},function(t){return t.slice().sort(i).map(s)}),t._list=new YL({itemHeight:40,offscreenArea:100,initialItems:30,onUpdate:function(e){return t.setState({scrollList:e})}})},didChange:function(t,e){var n=e.chat,o=e.contacts;if(n){var r=n.prev,a=n.current;t._loadRequested=!1,r&&a.id===r.id||(t.state.query&&oit(t,""),t.setState({addParticipantsMode:!1}));var i=a.admins;i&&t.setState({adminIds:i.map((function(t){return t.user.id})),superadminIds:i.filter((function(t){return t.permissions.manageAdmins})).map((function(t){return t.user.id}))})}if(o){var s=p(o.current).filter((function(t){return!t.deleted}));t.setState({contacts:t._sortContacts(s)})}},didMount:function(t){var e=t.props.chat;e&&t.store.app.participants.loadAllMembers(e.id)},willUnmount:function(t){Zt(t,"reset-participants",{})},willRender:function(t){!function(t){var e=t.props,n=e.chat,o=e.mode,r=[n.owner],a=[];if(function(t){var e=t.props,n=e.chat;return!!n.participantsSearch&&("idle"===n.participantsSearch.loadState||n.participantsSearch.members)}(t))r=function(t){var e=t.props.chat.participantsSearch;if(!e||!e.members)return[];return e.members}(t);else{if("CHAT"===n.type){var s=new i(n.participants.map((function(t){return t.user})));r=t.state.contacts.filter((function(t){return s.has(t)})),n.members&&n.members.items&&(r=uit(r,n.members.items))}else n.members&&n.members.items&&(r=uit(r,n.members.items.filter((function(t){return t.id!==n.owner.id}))));if(!t.query.isEmpty&&!nit(t)){var u=t.query.scoringSort(r,(function(t){return t.name+" "+Wn(t.link||"")}));r=u.sortedList,a=u.matchList}}qw(t.state.highlights||[],a)||t.setState({highlights:a});o===Qat.TRANSFER_OWNER&&(r=r.filter((function(t){return!t.current})));t._list.update(r,t.refs.scroller)}(t)},willUpdate:function(t){Jat(t)},onScroll:Jat,onAddParticipantsAnimationEnd:$at,onAddParticipants:Zat,hideModal:tit,enterAddParticipants:eit,makeParticipantAdmin:rit,removeParticipant:ait,onSearch:iit,onBubbleClick:function(t,e){e.stopPropagation()},onOpenDialog:sit,mergeArrays:uit};var Pst={update:function(t,e){zst(t,e.detail.text)},keydown:function(t,e){e.keyCode===xS.ESC?(e.stopPropagation(),Lst(t)):e.keyCode===xS.ENTER&&(e.stopPropagation(),e.preventDefault(),Rst(t))}};function Rst(t){if(!function(t){return!!t.state.error||!function(t){for(var e=t&&t.firstChild;e;){if(e.nodeType===e.ELEMENT_NODE)return!1;e=e.nextSibling}return!0}(t.refs.error)}(t)){var e=t.state.value||"";return Ost(t,!1,!0),Zt(t,"change",e),!0}return!1}function Lst(t){t.state.editMode&&Ost(t,!1)}function Ost(t,e,n){t.setState({editMode:e}),e||n||zst(t,t.props.value),Zt(t,"toggle-edit-mode",e)}function zst(t,e){if(void 0===e&&(e=""),t.state.value!==e){t.setState({value:e});var n=function(t,e){var n=t.props.maxLength,o=t.props.required;if(-1!==n&&n<e.length)return{code:"too-long",context:{count:n}};if(o&&!e.trim())return{code:"empty"};return null}(t,e);if(n){var o=t.props.errorPrefix,r=o?o+"-"+n.code:n.code;t.setState({error:V(r,n.context)})}else t.setState({error:null})}}function Dst(t,e){e.stopPropagation(),function(t){t.state.editMode||Ost(t,!0)}(t)}function Ust(t,e){e.stopPropagation(),Lst(t,e.detail&&e.detail.submit)}function Nst(t,e){e.stopPropagation(),Rst(t)}var qst="efsdxzn",Hst=[0,0],Fst=[];function Vst(){Fst.push(Hst),Hst=[0,0]}function Kst(){Hst=Fst.pop()}function Wst(t,e,n){e.name=n.props.name,e.value=n.state.value,e.placeholder=n.props.placeholder,e.multiline=n.props.multiline,e.formatting=n.props.formatting,e.replaceTextEmoji=n.props.replaceTextEmoji,e.links=n.props.links,e.class="value-okmsg __edit-okmsg"+(n.props.secondary?" __secondary-okmsg":"")+(n.state.error?" __error-okmsg":"")}function Gst(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-input",a$,t));n.setPendingRef(o._1,"input",r);var a=o._9=n.propsSet(r,{autofocus:!0});return Wst(0,a,t),n.mountComponent(r,a),Yst}function Yst(t,e){var o=e._8,r=e._9;n.setPendingRef(e._1,"input",o),Wst(0,r,t),n.updateComponent(o,r)}function Xst(t,e,o){n.updateClass(t,e,"value-okmsg"+(o.state.value?"":" __empty-okmsg"))}function Qst(t,e,n){e.disableFormatting=!n.props.formatting,e.disableLinks=!n.props.links,e.emojiSize=n.props.emojiSize,e.emojiContext=n.props.emojiContext,e.class=n.state.value?"":"__placeholder-okmsg"}function Jst(t,e,o){var r=o._c=n.insert(e,n.elem("div",qst));n.setPendingRef(o._1,"input",r),Xst(r,o._d=n.obj(),t),o._e=n.addEvent(r,"click",Dst,t,o),n.appendChild(r,n.createSlot(t,"additions",qst)),o._g=n.mountSlot(t,"additions");var a=o._h=n.appendChild(r,n.createComponent("msg-parsed-text",ii,t)),i=a.componentModel.input,s=o._i=n.propsSet(a);return Qst(0,s,t),o._j=n.insert(i,n.text(t.state.value||t.props.placeholder)),n.mountComponent(a,s),$st}function $st(t,e){var o=e._c,r=e._h,a=e._i;n.setPendingRef(e._1,"input",o),Xst(o,e._d,t),Qst(0,a,t),Hst[0]|=n.updateText(e._j,t.state.value||t.props.placeholder),n.updateIncomingSlot(r,"",Hst[0]),n.updateComponent(r,a)}function Zst(t){return t.state.editMode?Gst:Jst}function tut(t,e,o){var r=o._s=n.insert(e,n.createComponent("msg-form-error",Z2,t),"error"),a=r.componentModel.input;return o._t=n.insert(a,n.text(t.state.error)),n.mountComponent(r),eut}function eut(t,e){Hst[1]|=n.updateText(e._t,t.state.error),n.updateIncomingSlot(e._s,"",Hst[1])}function nut(t){return t.state.error?tut:null}function out(t,e,o){return o._p=n.mountBlock(t,e,nut),rut}function rut(t,e){n.updateBlock(e._p)}function aut(t,e,o){e.max=o.props.maxLength,e.current=n.get(o.state.value,"length")}function iut(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-counter",mJ,t)),a=o._16=n.propsSet(r);return aut(0,a,t),n.mountComponent(r,a),sut}function sut(t,e){var o=e._15,r=e._16;aut(0,r,t),n.updateComponent(o,r)}function uut(t){return-1!=t.props.maxLength?iut:null}function cut(t,e,n){e.disabled=n.state.error}function put(t,e){var o=e._18,r=e._19;n.updateBlock(e._12),cut(0,r,t),n.updateComponent(o,r)}function lut(t,e,o){return o._11?put(t,o):function(t,e,o){var r=o._11=n.insert(e,n.elem("div",qst)),a=n.createInjector(r);n.setClass(r,"buttons-okmsg"),o._12=n.mountBlock(t,a,uut);var i=o._18=n.insert(a,n.createComponent("msg-button",fe,t)),s=i.componentModel.input,u=o._19=n.propsSet(i,{class:"primary-okmsg",shape:"circle","data-tsid":"edit_btn"});cut(0,u,t),o._1a=n.addEvent(i,"click",Nst,t,o);var c=o._1b=n.insert(s,n.createComponent("msg-icon",xe,t),"");n.mountComponent(c,n.propsSet(c,{icon:"check",size:"medium"})),n.mountComponent(i,u);var p=o._1e=n.insert(a,n.createComponent("msg-button",fe,t)),l=p.componentModel.input;o._1g=n.addEvent(p,"click",Ust,t,o);var m=o._1h=n.insert(l,n.createComponent("msg-icon",xe,t),"");n.mountComponent(m,n.propsSet(m,{icon:"clear",size:"medium"})),n.mountComponent(p,n.propsSet(p,{class:"inverted-okmsg",shape:"circle"}))}(t,e,o),n.animate(o._11,$U(o._11,{duration:300,easing:nN})),mut}function mut(t,e){put(t,e)}function dut(t){return t.state.editMode?lut:null}function _ut(t,e){var o=t.componentView;Vst();var r=n.createInjector(o),a=e._1=n.obj(),i=n.insert(r,n.elem("div",qst)),s=n.createInjector(i);n.setClass(i,"main-okmsg"),n.insert(s,n.createSlot(t,"prefix",qst)),e._4=n.mountSlot(t,"prefix"),e._5=n.mountBlock(t,s,Zst);var u=n.insert(r,n.createSlot(t,"error",qst));return n.setRef(t,"error",u),e._v=n.mountSlot(t,"error",out),e._w=n.mountBlock(t,r,dut),Kst(),n.finalizePendingRefs(t,a),fut}function fut(t,e){Vst(),n.updateBlock(e._5),n.updateDefaultSlot(e._v),n.updateBlock(e._w),Kst(),n.finalizePendingRefs(t,e._1)}Gst.dispose=function(t){t._8=n.unmountComponent(t._8),t._9=null},Jst.dispose=function(t){t._e=n.removeEvent("click",t._e),t._g=n.unmountSlot(t._g),t._h=n.unmountComponent(t._h),t._d=t._i=t._j=t._c=null},tut.dispose=function(t){t._s=n.unmountComponent(t._s),t._t=null},out.dispose=function(t){t._p=n.unmountBlock(t._p)},iut.dispose=function(t){t._15=n.unmountComponent(t._15),t._16=null},lut.dispose=function(t,e){var o=t._11;n.animate(o,ZU(0,{duration:300,easing:nN}),(function(){return function(t){t._12=n.unmountBlock(t._12),t._1a=n.removeEvent("click",t._1a),t._1b=n.unmountComponent(t._1b),t._18=n.unmountComponent(t._18),t._1g=n.removeEvent("click",t._1g),t._1h=n.unmountComponent(t._1h),t._1e=n.unmountComponent(t._1e),t._11=n.domRemove(t._11),t._19=null}(t)}))},_ut.dispose=function(t){Vst(),t._4=n.unmountSlot(t._4),t._5=n.unmountBlock(t._5),t._v=n.unmountSlot(t._v),t._w=n.clearBlock(t._w),Kst()};var gut={__proto__:null,cssScope:qst,default:_ut,slideDown:$U,slideUp:ZU,easeOutCubic:nN,props:function(){return{name:null,value:null,placeholder:null,maxLength:-1,secondary:!1,required:!1,formatting:!1,multiline:!1,links:!1,replaceTextEmoji:!0,errorPrefix:null}},methods:{focus:function(){this.refs.input.focus()},blur:function(){this.refs.input.blur()}},events:Pst,init:function(t){Object.defineProperties(t,{changed:{get:function(){return this.props.value!==this.state.value}},name:{get:function(){return this.props.name}},value:{get:function(){return this.state.value}}})},didChange:function(t,e){var n=e.value;n&&zst(t,n.current)},onEnterEditMode:Dst,onExitEditMode:Ust,onSubmit:Nst},vut=new Mb(wut,5e3),hut=36e5,Cut=6e4;var kut={"chat-alerts-updated":wut};function but(t,e){Sut(e,-1===t?-1:Date.now()+t*hut),e.state.menu.exit(!0)}function yut(t){Sut(t,0),t.state.menu.exit(!0)}function Sut(t,e){Zt(t,"update-chat-settings",{chatId:t.props.chat.id,settings:{dontDisturbUntil:e}})}function wut(t){var e=t.props.chat,n=e.settings.dontDisturbUntil;if(t.setState({canDisturb:c(e)}),-1===n)t.setState({units:null});else{var o=n-Date.now();o<hut?t.setState({units:"minutes",count:Math.ceil(o/Cut)}):t.setState({units:"hours",count:Math.ceil(o/hut)})}}function Eut(t,e){void 0===e&&(e=!1),t.setState({menuActive:e})}var xut="e-stc65c",Iut=[0,0],But=[];function Mut(){But.push(Iut),Iut=[0,0]}function Aut(){Iut=But.pop()}function Tut(t,e){n.call(t.state.menu,"enter")}function jut(t,e){n.call(t.state.menu,"exit")}function Put(t,e,n){e.key="alerts-"+(n.state.canDisturb?"off":"on")}function Rut(t,e,o){var r=n.insert(e,n.elem("h4",xut),"");n.setClass(r,"h4-okmsg");var a=o._e=n.appendChild(r,n.createComponent("msg-l10n",ae,t)),i=o._f=n.propsSet(a);return Put(0,i,t),n.mountComponent(a,i),n.appendChild(r,n.text(":\n        ")),Iut[0]=1,Lut}function Lut(t,e){var o=e._e,r=e._f;Put(0,r,t),n.updateComponent(o,r)}function Out(t){return t.state.canDisturb?Rut:null}function zut(){return[1,2,24,-1]}function Dut(t,e,n,o){but(o.value,t)}function Uut(t,e,n,o){e["data-hours"]=o.value}function Nut(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input;o._p=n.addEvent(r,"click",Dut,t,o);var i=o._q=n.insert(a,n.createComponent("msg-l10n",ae,t),""),s=o._r=n.propsSet(i,{key:"alerts-off-period"});return Uut(0,s,0,o),n.mountComponent(i,s),n.mountComponent(r),Iut[0]=1,qut}function qut(t,e){var o=e._q,r=e._r;Uut(0,r,0,e),n.updateComponent(o,r)}function Hut(t,e,o){return o._l=n.mountIterator(t,e,zut,Nut),Fut}function Fut(t,e){n.updateIterator(e._l)}function Vut(t,e,o){var r=o._v=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input;o._w=n.addEvent(r,"click",yut,t,o);var i=o._x=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"alerts-on"})),n.mountComponent(r),Iut[0]=1}function Kut(t){return t.state.canDisturb?Hut:Vut}function Wut(t,e){var o=e._7;n.setPendingRef(e._1,"menu",o),n.updateBlock(e._a),n.updateBlock(e._i),n.updateIncomingSlot(o,"",Iut[0])}function Gut(t,e,o){return o._7?Wut(0,o):function(t,e,o){var r=o._7=n.insert(e,n.createComponent("msg-menu",bS,t)),a=r.componentModel.input;n.setPendingRef(o._1,"menu",r),o._8=n.addEvent(r,"mouseenter",Tut,t,o),o._9=n.addEvent(r,"mouseleave",jut,t,o),o._a=n.mountBlock(t,a,Out),o._i=n.mountBlock(t,a,Kut),n.mountComponent(r)}(t,e,o),n.animate(o._7,n.createAnimation("global:msg-pop-in .25s cubic-bezier(.4, 0, .3, 1.2)",xut)),Yut}function Yut(t,e){Wut(0,e)}function Xut(t){return t.state.menuActive?Gut:null}function Qut(t,e,n){e.chat=n.props.chat}function Jut(t,e){n.call(t.state.menu,"enter")}function $ut(t,e){n.call(t.state.menu,"exit")}function Zut(t,e,n){e.key="do-not-disturb-for-"+n.state.units,e["data-count"]=n.state.count,e["data-countPlural"]=n.state.count}function tct(t,e,o){var r=o._1k=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1l=n.propsSet(r);return Zut(0,a,t),n.mountComponent(r,a),Iut[1]=1,ect}function ect(t,e){var o=e._1k,r=e._1l;Zut(0,r,t),n.updateComponent(o,r)}function nct(t,e,o){var r=o._1o=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"do-not-disturb"})),Iut[1]=1}function oct(t){return t.state.units?tct:nct}function rct(t,e){var o=t.componentView;Mut();var r=n.createInjector(o),a=e._1=n.obj();e._2=n.mountBlock(t,r,Xut);var i=e._11=n.insert(r,n.createComponent("msg-chat-alerts",Ly,t)),s=i.componentModel.input,u=e._12=n.propsSet(i);Qut(0,u,t),e._13=n.addEvent(i,"mouseenter",Jut,t,e),e._14=n.addEvent(i,"mouseleave",$ut,t,e);var c=e._15=n.insert(s,n.createComponent("msg-tico",rc,t),"on"),p=c.componentModel.input,l=n.insert(p,n.elem("span",xut),"");n.setClass(l,"pseudo-link-okmsg");var m=e._18=n.appendChild(l,n.createComponent("msg-l10n",ae,t));n.mountComponent(m,n.propsSet(m,{key:"alerts"})),n.appendChild(l,n.text(" "));var d=e._1b=n.appendChild(l,n.createComponent("msg-l10n",ae,t));n.mountComponent(d,n.propsSet(d,{key:"alerts-enabled"})),n.mountComponent(c,n.propsSet(c,{icon:"alert-on",size:"medium",slot:"on"}));var _=e._1e=n.insert(s,n.createComponent("msg-tico",rc,t),"off"),f=_.componentModel.input,g=n.insert(f,n.elem("span",xut),""),v=n.createInjector(g);return n.setClass(g,"pseudo-link-okmsg"),e._1h=n.mountBlock(t,v,oct),n.mountComponent(_,n.propsSet(_,{icon:"alert-off",size:"medium",slot:"off"})),n.mountComponent(i,u),Aut(),n.finalizePendingRefs(t,a),act}function act(t,e){var o=e._11,r=e._12;Mut(),n.updateBlock(e._2),Qut(0,r,t),n.updateBlock(e._1h),n.updateIncomingSlot(e._1e,"",Iut[1]),n.updateComponent(o,r),Aut(),n.finalizePendingRefs(t,e._1)}Rut.dispose=function(t){t._e=n.unmountComponent(t._e),t._f=null,Iut[0]=1},Nut.dispose=function(t){t._p=n.removeEvent("click",t._p),t._q=n.unmountComponent(t._q),t._o=n.unmountComponent(t._o),t._r=null,Iut[0]=1},Hut.dispose=function(t){t._l=n.unmountIterator(t._l)},Vut.dispose=function(t){t._w=n.removeEvent("click",t._w),t._x=n.unmountComponent(t._x),t._v=n.unmountComponent(t._v),Iut[0]=1},Gut.dispose=function(t,e){n.animate(t._7,n.createAnimation("global:msg-pop-out .15s ease-out",xut),(function(){return function(t){var e=t._7;t._8=n.removeEvent("mouseenter",t._8),t._9=n.removeEvent("mouseleave",t._9),t._a=n.unmountBlock(t._a),t._i=n.unmountBlock(t._i),t._7=n.unmountComponent(e),n.domRemove(e)}(t)}))},tct.dispose=function(t){t._1k=n.unmountComponent(t._1k),t._1l=null,Iut[1]=1},nct.dispose=function(t){t._1o=n.unmountComponent(t._1o),Iut[1]=1},rct.dispose=function(t){Mut(),t._2=n.clearBlock(t._2),t._13=n.removeEvent("mouseenter",t._13),t._14=n.removeEvent("mouseleave",t._14),t._18=n.unmountComponent(t._18),t._1b=n.unmountComponent(t._1b),t._15=n.unmountComponent(t._15),t._1h=n.unmountBlock(t._1h),t._1e=n.unmountComponent(t._1e),t._11=n.unmountComponent(t._11),Aut()};var ict={__proto__:null,cssScope:xut,default:rct,props:function(){return{chat:null}},state:function(t){return{menuActive:!1,menu:US(t,(function(){return Eut(t,!0)}),(function(){return Eut(t,!1)}),{enterDelay:150,exitDelay:450})}},events:kut,didChange:function(t,e){e.chat&&wut(t)},willMount:function(t){vut.add(t)},willUnmount:function(t){vut.remove(t)},disable:but,enable:yut};function sct(t,e){Zt(e,"view-profile",{userId:t.id,profileUrl:t.profileUrl})}function uct(t){XU(),Zt(t,"toggle-aside-content",{tabName:"backgrounds"})}function cct(t){Zt(t,"pick-chat-icon",{chatId:t.props.chat.id})}function pct(t,e){var n=t.props.chat.id,o=e.target,r=o.files&&o.files[0];r&&/^image\//.test(r.type)&&(Zt(t,"change-chat-icon",{chatId:n,file:r}),o.value=null)}var lct="e78vss7",mct=[0],dct=[];function _ct(){dct.push(mct),mct=[0]}function fct(){mct=dct.pop()}function gct(t,e){e.contact=n.get(n.find(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})),"user"),e.isDialog="DIALOG"===n.get(t.props.chat,"type"),e.inChat="LEFT"!==n.get(t.props.chat,"status"),e.isGroupchat="GROUP_CHAT"===n.get(t.props.chat,"type"),e.isService=n.get(t.props.chat,"options","SERVICE_CHAT"),e.isProduct="PRODUCT"===n.get(t.props.chat,"subject","type"),e.groupInfo=n.get(t.props.chat,"groupChatInfo"),e.inGroupModerator=e.isGroupchat&&n.get(e.groupInfo,"isModerator")&&!!n.get(t.store.data.config,"server","moderated-groups"),e.inFavorites=n.get(t.props.chat,"settings","favIndex"),e.favoritesEnabled=!!n.get(t.store.data.config,"server","max-favorite-chats"),e.isBot="DIALOG"===n.get(t.props.chat,"type")&&jt(0,n.get(e.contact,"options"),"BOT"),e.ifExpr=!e.inGroupModerator,e.chooseExpr=t.store.data.isMobile?0:1,e.caseExpr=0===e.chooseExpr,e.ifExpr_1=e.ifExpr&&e.isDialog&&!e.isBot,e.blockKey=e.ifExpr_1?"BLOCKED"==n.get(e.contact,"status")?"unblock":"block":void 0}function vct(t){Ot(t,"request-chat-link")}function hct(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._q=n.addEvent(r,"click",vct,t,o);var i=o._r=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"chat-link"})),n.mountComponent(r,n.propsSet(r,{icon:"media-share",size:"medium"}))}function Cct(t,e){return e.isDialog||!n.get(t.props.chat,"owner","current")||n.get(t.props.chat,"link")||e.isGroupchat?null:hct}function kct(t){Zt(t,"toggle-aside-content",{tabName:"settings"})}function bct(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function yct(t,e,o){var r=o._x=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._z=n.addEvent(r,"click",kct,t,o);var i=o._10=n.insert(a,n.createComponent("msg-l10n",ae,t),""),s=o._11=n.propsSet(i,{key:"settings"});return bct(0,s,t),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{icon:"settings","data-l":"t,settings","data-tsid":"edit_chat_settings_button"})),Sct}function Sct(t,e){var o=e._10,r=e._11;bct(0,r,t),n.updateComponent(o,r)}function wct(t,e){return!n.get(t.store.data.config,"server","settings")||e.isDialog||e.isService||e.isGroupchat||e.isProduct||!n.get(t.props.chat,"owner","current")?null:yct}function Ect(t,e,n){e.chat=n.props.chat}function xct(t,e,o){var r=o._16=n.insert(e,n.createComponent("msg-chat-alerts-button",ict,t)),a=o._17=n.propsSet(r);return Ect(0,a,t),n.mountComponent(r,a),Ict}function Ict(t,e){var o=e._16,r=e._17;Ect(0,r,t),n.updateComponent(o,r)}function Bct(t,e){return e.inChat?xct:null}function Mct(t,e,o){var r=o._1b=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._1d=n.addEvent(r,"click",uct,t,o);var i=o._1e=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"set-background"})),n.mountComponent(r,n.propsSet(r,{icon:"stars","data-tsid":"set_chat_bg","data-l":"t,bg"}))}function Act(t){return t.state.backgroundsEnabled?Mct:null}function Tct(t,e,n,o){e.icon=o.inFavorites?"favorite-off":"favorite"}function jct(t){Zt(t,"toggle-favorite",{chatId:n.get(t.props.chat,"id")})}function Pct(t,e,o,r){e.key=r.inFavorites?"favorites-remove":"favorites-add",e["data-type"]=n.get(o.props.chat,"type")}function Rct(t,e,o){var r=o._1k=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=o._1l=n.propsSet(r,{size:"medium",tabindex:"0"});Tct(0,i,0,o),o._1m=n.addEvent(r,"click",jct,t,o);var s=o._1n=n.insert(a,n.createComponent("msg-l10n",ae,t),""),u=o._1o=n.propsSet(s);return Pct(0,u,t,o),n.mountComponent(s,u),n.mountComponent(r,i),Lct}function Lct(t,e){var o=e._1k,r=e._1l,a=e._1n,i=e._1o;Tct(0,r,0,e),Pct(0,i,t,e),n.updateComponent(a,i),n.updateComponent(o,r)}function Oct(t,e){return e.favoritesEnabled&&n.get(t.props.chat,"lastEventTime")&&e.inChat?Rct:null}function zct(t,e,n,o){sct(o.contact,t)}function Dct(t,e,o,r){Zt(t,"bot-suspend",{botId:n.get(r.contact,"id")})}function Uct(t,e,o){var r=o._22=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._24=n.addEvent(r,"click",Dct,t,o);var i=o._25=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"bot-suspend"})),n.mountComponent(r,n.propsSet(r,{icon:"bot-suspend",tabindex:"0","data-tsid":"suspend_bot"}))}function Nct(t,e){return e.isBot&&!n.get(t.props.chat,"isSuspended")?Uct:null}function qct(t,e,o){var r=o._1t=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._1v=n.addEvent(r,"click",zct,t,o);var i=o._1w=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(i,n.propsSet(i,{key:"open-profile"})),n.mountComponent(r,n.propsSet(r,{icon:"user",tabindex:"0"})),o._1z=n.mountBlock(t,e,Nct),Hct}function Hct(t,e){n.updateBlock(e._1z)}function Fct(t,e){return e.isDialog?qct:null}function Vct(t,e,n,o){e.class=o.caseExpr?"change-avatar-okmsg":""}function Kct(t,e,o){var r=n.insert(e,n.elem("label",lct),""),a=n.appendChild(r,n.elem("input",lct));n.setAttribute(a,"type","file"),n.setAttribute(a,"accept","image/png, image/jpeg"),o._2j=n.addEvent(a,"change",pct,t,o),mct[0]=1}function Wct(t,e,o){return n.setPendingEvent(o._2c,"click",cct,o),Gct}function Gct(t,e){n.setPendingEvent(e._2c,"click",cct,e)}function Yct(t,e){return[Kct,Wct][e.chooseExpr]}function Xct(t,e,o){var r=o._2b=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=o._2c=n.pendingEvents(t,r),s=o._2d=n.propsSet(r,{icon:"user-photo","data-tsid":"add_chat_avatar"});Vct(0,s,0,o),o._2e=n.mountBlock(t,a,Yct);var u=o._2o=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(u,n.propsSet(u,{key:"change-avatar"})),n.finalizePendingEvents(i),n.mountComponent(r,s),Qct}function Qct(t,e){var o=e._2b,r=e._2d;Vct(0,r,0,e),n.updateBlock(e._2e),n.finalizePendingEvents(e._2c),n.updateIncomingSlot(o,"",mct[0]),n.updateComponent(o,r)}function Jct(t,e){return t.props.allowEdit&&!e.isDialog?Xct:null}function $ct(t,e,n,o){e.icon=o.blockKey,e["data-tsid"]=o.blockKey+"-user-btn"}function Zct(t,e,o,r){Zt(t,r.blockKey+"-user",{userId:n.get(r.contact,"id")})}function tpt(t,e,n,o){e.key=o.blockKey}function ept(t,e,o){var r=o._2u=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=o._2v=n.propsSet(r,{size:"medium",tabindex:"0"});$ct(0,i,0,o),o._2w=n.addEvent(r,"click",Zct,t,o);var s=o._2x=n.insert(a,n.createComponent("msg-l10n",ae,t),""),u=o._2y=n.propsSet(s);return tpt(0,u,0,o),n.mountComponent(s,u),n.mountComponent(r,i),npt}function npt(t,e){var o=e._2u,r=e._2v,a=e._2x,i=e._2y;$ct(0,r,0,e),tpt(0,i,0,e),n.updateComponent(a,i),n.updateComponent(o,r)}function opt(t,e){return e.ifExpr_1?ept:null}function rpt(t){Zt(t,"clear-chat-history",{chatId:n.get(t.props.chat,"id")})}function apt(t){Zt(t,"hide-chat",{chatId:n.get(t.props.chat,"id")})}function ipt(t){Zt(t,"remove-chat",{chatId:n.get(t.props.chat,"id")})}function spt(t,e,o){var r=o._3f=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._3h=n.addEvent(r,"click",ipt,t,o);var i=o._3i=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"remove-chat"})),n.mountComponent(r,n.propsSet(r,{size:"medium",icon:"delete","data-tsid":"remove-dialog-btn",tabindex:"0"}))}function upt(t,e){return!e.isDialog&&!n.get(t.props.chat,"owner","current")||e.isService||e.groupInfo?null:spt}function cpt(t){Zt(t,"leave-chat",{chatId:n.get(t.props.chat,"id")})}function ppt(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function lpt(t,e,o){var r=o._3o=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._3q=n.addEvent(r,"click",cpt,t,o);var i=o._3r=n.insert(a,n.createComponent("msg-l10n",ae,t),""),s=o._3s=n.propsSet(i,{key:"leave-chat"});return ppt(0,s,t),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{icon:"leave",size:"medium",tabindex:"0","data-tsid":"leave-chat-btn"})),mpt}function mpt(t,e){var o=e._3r,r=e._3s;ppt(0,r,t),n.updateComponent(o,r)}function dpt(t,e){return!e.inChat||e.isDialog||"CHANNEL"===n.get(t.props.chat,"type")&&n.get(t.props.chat,"owner","current")||n.get(t.props.chat,"subject")||e.isService?null:lpt}function _pt(t,e,o){o._l=n.mountBlock(t,e,Cct),o._u=n.mountBlock(t,e,wct),o._13=n.mountBlock(t,e,Bct),o._18=n.mountBlock(t,e,Act),o._1h=n.mountBlock(t,e,Oct),o._1q=n.mountBlock(t,e,Fct),o._28=n.mountBlock(t,e,Jct);var r=n.insert(e,n.elem("div",lct));n.setClass(r,"delimiter-okmsg"),o._2r=n.mountBlock(t,e,opt);var a=o._30=n.insert(e,n.createComponent("msg-tico",rc,t)),i=a.componentModel.input;o._32=n.addEvent(a,"click",rpt,t,o);var s=o._33=n.insert(i,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(s,n.propsSet(s,{key:"clear-chat"})),n.mountComponent(a,n.propsSet(a,{size:"medium",icon:"clean",tabindex:"0","data-tsid":"clear-chat-history-btn"}));var u=o._36=n.insert(e,n.createComponent("msg-tico",rc,t)),c=u.componentModel.input;o._38=n.addEvent(u,"click",apt,t,o);var p=o._39=n.insert(c,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(p,n.propsSet(p,{key:"hide-chat"})),n.mountComponent(u,n.propsSet(u,{size:"medium",icon:"views-off",tabindex:"0","data-tsid":"hide-chat-btn"})),o._3c=n.mountBlock(t,e,upt),o._3l=n.mountBlock(t,e,dpt),fpt}function fpt(t,e){n.updateBlock(e._l),n.updateBlock(e._u),n.updateBlock(e._13),n.updateBlock(e._18),n.updateBlock(e._1h),n.updateBlock(e._1q),n.updateBlock(e._28),n.updateBlock(e._2r),n.updateBlock(e._3c),n.updateBlock(e._3l)}function gpt(t,e){return e.ifExpr?_pt:null}function vpt(t,e,o,r){e.icon=n.get(r.groupInfo,"isAnswered")?"readed":"unreaded"}function hpt(t){Zt(t,"toggle-answered",{chatId:n.get(t.props.chat,"id")})}function Cpt(t,e,o,r){e.key=n.get(r.groupInfo,"isAnswered")?"mark-unanswered":"mark-answered"}function kpt(t,e,o,r){e.icon=n.get(r.groupInfo,"isImportant")?"favorite-off":"favorite"}function bpt(t){Zt(t,"toggle-important",{chatId:n.get(t.props.chat,"id")})}function ypt(t,e,o,r){e.key=n.get(r.groupInfo,"isImportant")?"remove-important":"mark-important"}function Spt(t,e,o){var r=o._41=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=o._42=n.propsSet(r,{tabindex:"0",size:"medium"});vpt(0,i,0,o),o._43=n.addEvent(r,"click",hpt,t,o);var s=o._44=n.insert(a,n.createComponent("msg-l10n",ae,t),""),u=o._45=n.propsSet(s);Cpt(0,u,0,o),n.mountComponent(s,u),n.mountComponent(r,i);var c=o._47=n.insert(e,n.createComponent("msg-tico",rc,t)),p=c.componentModel.input,l=o._48=n.propsSet(c,{tabindex:"0",size:"medium"});kpt(0,l,0,o),o._49=n.addEvent(c,"click",bpt,t,o);var m=o._4a=n.insert(p,n.createComponent("msg-l10n",ae,t),""),d=o._4b=n.propsSet(m);return ypt(0,d,0,o),n.mountComponent(m,d),n.mountComponent(c,l),wpt}function wpt(t,e){var o=e._41,r=e._42,a=e._44,i=e._45,s=e._47,u=e._48,c=e._4a,p=e._4b;vpt(0,r,0,e),Cpt(0,i,0,e),n.updateComponent(a,i),n.updateComponent(o,r),kpt(0,u,0,e),ypt(0,p,0,e),n.updateComponent(c,p),n.updateComponent(s,u)}function Ept(t){return"ACTIVE"===n.get(t.props.chat,"status")||"LEFT"===n.get(t.props.chat,"status")?Spt:null}function xpt(t,e,o,r){Zt(t,"block-user-in-group",{chatId:n.get(t.props.chat,"id"),userId:n.get(r.contact,"id"),groupId:n.get(r.groupInfo,"groupId"),groupName:n.get(r.groupInfo,"name")})}function Ipt(t,e,o){o._3y=n.mountBlock(t,e,Ept);var r=o._4d=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._4f=n.addEvent(r,"click",xpt,t,o);var i=o._4g=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(i,n.propsSet(i,{key:"block-in-group"})),n.mountComponent(r,n.propsSet(r,{size:"medium",icon:"block",tabindex:"0","data-tsid":"block-group-user-btn"})),Bpt}function Bpt(t,e){n.updateBlock(e._3y)}function Mpt(t,e){return e.inGroupModerator?Ipt:null}function Apt(t,e){var o=t.componentView;_ct();var r=n.createInjector(o);return gct(t,e),e._i=n.mountBlock(t,r,gpt),e._3v=n.mountBlock(t,r,Mpt),fct(),n.subscribeStore(t,["config","isMobile"]),Tpt}function Tpt(t,e){_ct(),gct(t,e),n.updateBlock(e._i),n.updateBlock(e._3v),fct()}hct.dispose=function(t){t._q=n.removeEvent("click",t._q),t._r=n.unmountComponent(t._r),t._o=n.unmountComponent(t._o)},yct.dispose=function(t){t._z=n.removeEvent("click",t._z),t._10=n.unmountComponent(t._10),t._x=n.unmountComponent(t._x),t._11=null},xct.dispose=function(t){t._16=n.unmountComponent(t._16),t._17=null},Mct.dispose=function(t){t._1d=n.removeEvent("click",t._1d),t._1e=n.unmountComponent(t._1e),t._1b=n.unmountComponent(t._1b)},Rct.dispose=function(t){t._1m=n.removeEvent("click",t._1m),t._1n=n.unmountComponent(t._1n),t._1k=n.unmountComponent(t._1k),t._1l=t._1o=null},Uct.dispose=function(t){t._24=n.removeEvent("click",t._24),t._25=n.unmountComponent(t._25),t._22=n.unmountComponent(t._22)},qct.dispose=function(t){t._1v=n.removeEvent("click",t._1v),t._1w=n.unmountComponent(t._1w),t._1t=n.unmountComponent(t._1t),t._1z=n.unmountBlock(t._1z)},Kct.dispose=function(t){t._2j=n.removeEvent("change",t._2j),mct[0]=1},Xct.dispose=function(t){t._2c=n.detachPendingEvents(t._2c),t._2e=n.unmountBlock(t._2e),t._2o=n.unmountComponent(t._2o),t._2b=n.unmountComponent(t._2b),t._2d=null},ept.dispose=function(t){t._2w=n.removeEvent("click",t._2w),t._2x=n.unmountComponent(t._2x),t._2u=n.unmountComponent(t._2u),t._2v=t._2y=null},spt.dispose=function(t){t._3h=n.removeEvent("click",t._3h),t._3i=n.unmountComponent(t._3i),t._3f=n.unmountComponent(t._3f)},lpt.dispose=function(t){t._3q=n.removeEvent("click",t._3q),t._3r=n.unmountComponent(t._3r),t._3o=n.unmountComponent(t._3o),t._3s=null},_pt.dispose=function(t){t._l=n.unmountBlock(t._l),t._u=n.unmountBlock(t._u),t._13=n.unmountBlock(t._13),t._18=n.unmountBlock(t._18),t._1h=n.unmountBlock(t._1h),t._1q=n.unmountBlock(t._1q),t._28=n.unmountBlock(t._28),t._2r=n.unmountBlock(t._2r),t._32=n.removeEvent("click",t._32),t._33=n.unmountComponent(t._33),t._30=n.unmountComponent(t._30),t._38=n.removeEvent("click",t._38),t._39=n.unmountComponent(t._39),t._36=n.unmountComponent(t._36),t._3c=n.unmountBlock(t._3c),t._3l=n.unmountBlock(t._3l)},Spt.dispose=function(t){t._43=n.removeEvent("click",t._43),t._44=n.unmountComponent(t._44),t._41=n.unmountComponent(t._41),t._49=n.removeEvent("click",t._49),t._4a=n.unmountComponent(t._4a),t._47=n.unmountComponent(t._47),t._42=t._45=t._48=t._4b=null},Ipt.dispose=function(t){t._3y=n.unmountBlock(t._3y),t._4f=n.removeEvent("click",t._4f),t._4g=n.unmountComponent(t._4g),t._4d=n.unmountComponent(t._4d)},Apt.dispose=function(t){_ct(),t._i=n.clearBlock(t._i),t._3v=n.clearBlock(t._3v),fct()};var jpt={__proto__:null,cssScope:lct,default:Apt,props:function(){return{chat:null,allowEdit:!1}},onOpenProfile:sct,willMount:function(t){t.setState({backgroundsEnabled:YU()})},toggleBackgrounds:uct,pickChatIcon:cct,onChangeAvatar:pct};function Ppt(t,e){var n=t.chatId,o=t.messageId,r=t.photoId;Zt(e,"attachment-click",t),Zt(e,"open-photo-layer",{chatId:n,messageId:o,photoId:r})}function Rpt(t,e){var n=t.collage,o=t.videoId;Zt(e,"toggle-video-player-mode",{link:null==n?void 0:n.link,id:o})}function Lpt(t,e){e.attach=n.get(t.props.mediaItem,"attach"),e.ratio=t.props.dimensions?"FILE"===n.get(t.props.mediaItem,"attach","_type")?n.get(e.attach,"preview","width")/n.get(e.attach,"preview","height"):n.get(e.attach,"width")/n.get(e.attach,"height"):1,e.height=t.props.dimensions?Ft(0,n.get(t.props.dimensions,"height")):1,e.width=Ft(0,e.height*e.ratio),e.censored=(t.store.data.whiteList||[])&&n.call(n.get(t,"root","state","service","chat"),"isCensored",[t.props.attachment])}function Opt(t,e,o,r){e.src=r.attach,e.width=r.width,e.height=r.height,e.censored=r.censored,e["data-tsid-id"]=n.get(r.attach,"photoId")}function zpt(t,e,n,o){Ppt(o.attach,t)}function Dpt(t,e,o){var r=o._a=n.insert(e,n.createComponent("msg-img",En,t)),a=o._b=n.propsSet(r,{gifAutoplay:"false"});return Opt(0,a,0,o),o._c=n.addEvent(r,"click",zpt,t,o),n.mountComponent(r,a),Upt}function Upt(t,e){var o=e._a,r=e._b;Opt(0,r,0,e),n.updateComponent(o,r)}function Npt(t,e,o,r){e.src=n.get(r.attach,"preview"),e.width=r.width,e.height=r.height,e.censored=r.censored,e["data-tsid-id"]=n.get(r.attach,"preview","photoId")}function qpt(t,e,n,o){Ppt(o.attach,t)}function Hpt(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-img",En,t)),a=o._g=n.propsSet(r,{gifAutoplay:"false"});return Npt(0,a,0,o),o._h=n.addEvent(r,"click",qpt,t,o),n.mountComponent(r,a),Fpt}function Fpt(t,e){var o=e._f,r=e._g;Npt(0,r,0,e),n.updateComponent(o,r)}function Vpt(t,e,o,r){e.video=n.get(r.attach,"preview"),e.width=r.width,e.height=r.height}function Kpt(t,e,n,o){Rpt(o.attach,t)}function Wpt(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-video-poster",Ic,t)),a=o._l=n.propsSet(r,{durationIcon:!1,controls:!0,fill:!0});return Vpt(0,a,0,o),o._m=n.addEvent(r,"click",Kpt,t,o),n.mountComponent(r,a),Gpt}function Gpt(t,e){var o=e._k,r=e._l;Vpt(0,r,0,e),n.updateComponent(o,r)}function Ypt(t,e,n,o){e.video=o.attach,e.width=o.width,e.height=o.height}function Xpt(t,e,n,o){Rpt(o.attach,t)}function Qpt(t,e,o){var r=o._p=n.insert(e,n.createComponent("msg-video-poster",Ic,t)),a=o._q=n.propsSet(r,{durationIcon:!1,controls:!0,fill:!0});return Ypt(0,a,0,o),o._r=n.addEvent(r,"click",Xpt,t,o),n.mountComponent(r,a),Jpt}function Jpt(t,e){var o=e._p,r=e._q;Ypt(0,r,0,e),n.updateComponent(o,r)}function $pt(t,e,n,o){e.attachment=o.attach}function Zpt(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-message-audio-attach",Ss,t)),a=o._v=n.propsSet(r,{compact:!0});return $pt(0,a,0,o),n.mountComponent(r,a),tlt}function tlt(t,e){var o=e._u,r=e._v;$pt(0,r,0,e),n.updateComponent(o,r)}function elt(t,e,n,o){e.attachment=o.attach}function nlt(t,e,o){var r=o._y=n.insert(e,n.createComponent("msg-attach-music",j_,t)),a=o._z=n.propsSet(r);return elt(0,a,0,o),n.mountComponent(r,a),olt}function olt(t,e){var o=e._y,r=e._z;elt(0,r,0,e),n.updateComponent(o,r)}function rlt(t,e,n,o){e.attachment=o.attach}function alt(t,e,o){var r=o._12=n.insert(e,n.createComponent("msg-attach-share",_f,t)),a=o._13=n.propsSet(r,{compact:!0});return rlt(0,a,0,o),n.mountComponent(r,a),ilt}function ilt(t,e){var o=e._12,r=e._13;rlt(0,r,0,e),n.updateComponent(o,r)}function slt(t,e,n,o){e.attachment=o.attach,e.sectionId=n.props.sectionId,e.censored=o.censored}function ult(t,e,o){var r=o._16=n.insert(e,n.createComponent("msg-attach-file",m_,t)),a=o._17=n.propsSet(r,{compact:!0,allowDownload:!0});return slt(0,a,t,o),n.mountComponent(r,a),clt}function clt(t,e){var o=e._16,r=e._17;slt(0,r,t,e),n.updateComponent(o,r)}function plt(t,e){return"PHOTO"===n.get(e.attach,"_type")?Dpt:"FILE"===n.get(e.attach,"_type")&&"PHOTO"===n.get(e.attach,"preview","_type")&&"mixed"===t.props.sectionId?Hpt:"FILE"===n.get(e.attach,"_type")&&"VIDEO"===n.get(e.attach,"preview","_type")&&"mixed"===t.props.sectionId?Wpt:"VIDEO"===n.get(e.attach,"_type")?Qpt:"AUDIO"===n.get(e.attach,"_type")?Zpt:"MUSIC"===n.get(e.attach,"_type")?nlt:"SHARE"===n.get(e.attach,"_type")?alt:"FILE"===n.get(e.attach,"_type")?ult:null}function llt(t,e,o,r){e.class="controls-okmsg"+("PHOTO"===n.get(r.attach,"_type")||"VIDEO"===n.get(r.attach,"_type")?" __bg-okmsg":"")}function mlt(t,e){e.stopPropagation(),Ot(t,"go-to-message")}function dlt(t,e){var o=t.componentView,r=n.createInjector(o);Lpt(t,e),e._7=n.mountBlock(t,r,plt);var a=e._19=n.insert(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input,s=e._1a=n.propsSet(a,{shape:"circle"});llt(0,s,0,e),e._1b=n.addEvent(a,"click",mlt,t,e);var u=e._1c=n.insert(i,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(u,n.propsSet(u,{icon:"to-message"})),n.mountComponent(a,s),n.subscribeStore(t,["whiteList"]),_lt}function _lt(t,e){var o=e._19,r=e._1a;Lpt(t,e),n.updateBlock(e._7),llt(0,r,0,e),n.updateComponent(o,r)}Dpt.dispose=function(t){t._c=n.removeEvent("click",t._c),t._a=n.unmountComponent(t._a),t._b=null},Hpt.dispose=function(t){t._h=n.removeEvent("click",t._h),t._f=n.unmountComponent(t._f),t._g=null},Wpt.dispose=function(t){t._m=n.removeEvent("click",t._m),t._k=n.unmountComponent(t._k),t._l=null},Qpt.dispose=function(t){t._r=n.removeEvent("click",t._r),t._p=n.unmountComponent(t._p),t._q=null},Zpt.dispose=function(t){t._u=n.unmountComponent(t._u),t._v=null},nlt.dispose=function(t){t._y=n.unmountComponent(t._y),t._z=null},alt.dispose=function(t){t._12=n.unmountComponent(t._12),t._13=null},ult.dispose=function(t){t._16=n.unmountComponent(t._16),t._17=null},dlt.dispose=function(t){t._7=n.clearBlock(t._7),t._1b=n.removeEvent("click",t._1b),t._1c=n.unmountComponent(t._1c),t._19=n.unmountComponent(t._19)};var flt={__proto__:null,cssScope:"e-4c2fxf",default:dlt,viewPhoto:Ppt,viewVideo:Rpt},glt=100,vlt=4,hlt=0,Clt={mixed:128,share:80,audio:116,file:80,music:80},klt={containerWidth:360,containerPadding:8,targetRowHeight:Clt.mixed,targetRowHeightTolerance:.2,boxSpacing:vlt},blt=360,ylt={handleScroll:function(t){var e=this.refs.beacon;if(e){var n=t.scrollTop,o=t.getBoundingClientRect(),r=e.getBoundingClientRect(),a=this.state,i=a._lastScrollPos,s=a._list,u=this.state;s.handleScroll(t,t.scrollTop+r.top-o.top),u._direction=n>i?"backward":"forward",u._lastScrollPos=n,u._viewportRect=o,xlt(this)}}};function Slt(t,e){var n=e.props.chat;e.store.app.media.selectSection(n.id,t),te(e,"select-tab")}function wlt(t,e){Zt(e,"highlight-message",{messageId:t.messageId}),Zt(e,"toggle-aside-content",{tabName:"info"})}function Elt(t,e){var n=[],o=null;return e.items.forEach((function(e){if(!Mlt(e)){var r=(a=function(t,e){var n=t.props.chat,o=n.messages.get(e);return o?o.time:0}(t,e.messageId),(i=new Date(a)).setDate(1),i.setHours(0,0,0,0),i.getTime());(null==o?void 0:o.marker)!==r?(o={marker:r,items:[e]},n.push(o)):o.items.push(e)}var a,i})),n}function xlt(t){var e=t.props.chat,n=t.state,o=n._list,r=n._direction,a=n._viewportRect,i=t.refs.beacon,s=o.items;if(i&&a&&s&&s.length){var u=Ilt(e);if(u.count!==u.total){var c=t.getBoundingClientRect(),p=a.top-glt,l=a.bottom+glt;if(c.top<l&&c.bottom>p){var m=Clt[u.id],d=i.getBoundingClientRect(),_=Tn(Math.floor((p-d.top)/m),0,s.length-1),f=Tn(Math.ceil((l-d.top)/m),0,s.length);if(!s[_])return;var g=function(t,e){void 0===e&&(e=0);for(;e<t.length;){var n=t[e++];if("item"===n.type)return n.value.id;if("grid"===n.type&&n.value)return n.value[0].media.id}}(s,_),v=function(t,e){void 0===e&&(e=t.length-1);for(;e>=0;){var n=t[e--];if("item"===n.type)return n.value.id;if("grid"===n.type&&n.value.length)return Blt(n.value).media.id}}(s,f-1);if(!g||!v)return;for(var h=0,C=-1,k=-1,b=0;b<u.items.length;b++){var y=u.items[b];if(Mlt(y))h&&(k=b,-1===C&&(C=b));else{if(2===h)break;y.id===g&&h++,y.id===v&&h++}}var S="backward"===r?C:k;-1!==S&&t.store.app.media.loadNext(e.id,u.id,S,r)}}}}function Ilt(t){return Array.from(t.media.values()).find((function(t){return t.selected}))}function Blt(t){return t.length?t[t.length-1]:void 0}function Mlt(t){return"delimiter"===t.id}function Alt(t){return{type:"marker",id:"m-".concat(t),marker:t}}var Tlt="edzf6dd";function jlt(t,e){e.section=n.find(n.get(t.props.chat,"media"),(function(t){return n.get(t,"selected")})),e.loading="loading"===n.get(e.section,"loadState"),e.value=void 0}function Plt(t){return n.get(t.props.chat,"media")}function Rlt(t,e,o,r){n.updateClass(t,e,"tabs_i-okmsg"+(n.get(r.value,"selected")?" __active-okmsg":"")),n.updateAttribute(t,e,"title",o.store.data.l10n(Rt(0,n.get(r.value,"id"))))}function Llt(t,e,o,r){Slt(n.get(r.value,"id"),t)}function Olt(t,e,o,r){e.icon="media-"+Pt(0,n.get(r.value,"id"))}function zlt(t,e,o){var r=o._a=n.insert(e,n.elem("div",Tlt));Rlt(r,o._b=n.obj(),t,o),o._c=n.addEvent(r,"click",Llt,t,o);var a=o._d=n.appendChild(r,n.createComponent("msg-icon",xe,t)),i=o._e=n.propsSet(a);return Olt(0,i,0,o),n.mountComponent(a,i),Dlt}function Dlt(t,e){var o=e._d,r=e._e;Rlt(e._a,e._b,t,e),Olt(0,r,0,e),n.updateComponent(o,r)}function Ult(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function Nlt(t){return t.state.groups}function qlt(t,e){return n.get(e.value,"marker")}function Hlt(t,e){return n.get(e.value,"rows")}function Flt(t,e){return n.get(e.value,"id")}function Vlt(t,e){e.chooseExpr="marker"===n.get(e.value,"type")?0:"item"===n.get(e.value,"type")?1:"grid"===n.get(e.value,"type")?2:-1,e.caseExpr_1=1===e.chooseExpr,e.item=e.caseExpr_1?n.get(e.value,"value"):void 0,e.caseExpr_2=2===e.chooseExpr}function Klt(t,e,o,r){e.mediaItem=r.item,e.class="row-okmsg __"+Pt(0,n.get(r.item,"attach","_type"))}function Wlt(t,e,n,o){wlt(o.item,t)}function Glt(t,e,o){var r=o._10=n.insert(e,n.createComponent("msg-chat-media-item",flt,t)),a=o._11=n.propsSet(r,{"data-tsid":"media_item"});return Klt(0,a,0,o),o._12=n.addEvent(r,"go-to-message",Wlt,t,o),n.mountComponent(r,a),Ylt}function Ylt(t,e){var o=e._10,r=e._11;Klt(0,r,0,e),n.updateComponent(o,r)}function Xlt(t,e){return n.get(e.value,"value")}function Qlt(t,e){return n.get(e.value,"media","id")}function Jlt(t,e,o,r){e.mediaItem=n.get(r.value,"media"),e.dimensions=r.value,e.class="__"+Pt(0,n.get(r.value,"media","attach","_type")),e.style="width: "+n.get(r.value,"width")+"px; max-height: 276px;"}function $lt(t,e,o,r){wlt(n.get(r.value,"media"),t)}function Zlt(t,e,o){var r=o._19=n.insert(e,n.createComponent("msg-chat-media-item",flt,t)),a=o._1a=n.propsSet(r,{"data-tsid":"media_item"});return Jlt(0,a,0,o),o._1b=n.addEvent(r,"go-to-message",$lt,t,o),n.mountComponent(r,a),tmt}function tmt(t,e){var o=e._19,r=e._1a;Jlt(0,r,0,e),n.updateComponent(o,r)}function emt(t,e,o){var r=n.insert(e,n.elem("div",Tlt)),a=n.createInjector(r);return n.setClass(r,"grid-okmsg row-okmsg"),o._16=n.mountKeyIterator(t,a,Xlt,Qlt,Zlt),nmt}function nmt(t,e){n.updateKeyIterator(e._16)}function omt(t,e){return e.caseExpr_1?Glt:e.caseExpr_2?emt:null}function rmt(t,e,o){return Vlt(0,o),o._x=n.mountBlock(t,e,omt),amt}function amt(t,e){Vlt(0,e),n.updateBlock(e._x)}function imt(t,e,o){var r=n.insert(e,n.elem("section",Tlt)),a=n.createInjector(r);return n.setClass(r,"group-okmsg"),o._p=n.mountKeyIterator(t,a,Hlt,Flt,rmt),smt}function smt(t,e){n.updateKeyIterator(e._p)}function umt(t,e,o){return o._l=n.mountKeyIterator(t,e,Nlt,qlt,imt),cmt}function cmt(t,e){n.updateKeyIterator(e._l)}function pmt(t,e,o,r){e.icon="media-"+n.get(r.section,"id")}function lmt(t,e,o){var r=n.insert(e,n.elem("div",Tlt));n.setClass(r,"empty-okmsg");var a=o._1h=n.appendChild(r,n.createComponent("msg-icon",xe,t)),i=o._1i=n.propsSet(a);pmt(0,i,0,o),n.mountComponent(a,i);var s=o._1j=n.appendChild(r,n.createComponent("msg-l10n",ae,t));return n.mountComponent(s,n.propsSet(s,{key:"nothing-here"})),mmt}function mmt(t,e){var o=e._1h,r=e._1i;pmt(0,r,0,e),n.updateComponent(o,r)}function dmt(t,e,o){var r=o._1n=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{indeterminate:!0,spin:!0,class:"middle-okmsg"}))}function _mt(t,e){return Tt(0,t.state.groups)>0?umt:e.loading?0===n.get(e.section,"count")?dmt:null:lmt}function fmt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px;")}function gmt(t,e,o){var r=o._1v=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{indeterminate:!0,spin:!0}))}function vmt(t,e){return e.loading&&n.get(e.section,"count")>0?gmt:null}function hmt(t,e){var o=t.componentView,r=n.createInjector(o);jlt(t,e);var a=n.insert(r,n.elem("div",Tlt));n.setClass(a,"switch-okmsg");var i=n.appendChild(a,n.elem("div",Tlt)),s=n.createInjector(i);n.setClass(i,"tabs-okmsg"),e._7=n.mountIterator(t,s,Plt,zlt);var u=e._g=n.insert(r,n.elem("div",Tlt));n.setRef(t,"beacon",u);var c=e._h=n.obj();n.setClass(u,"scroll-beacon-okmsg"),Ult(u,c,t),e._i=n.mountBlock(t,r,_mt);var p=e._1q=n.insert(r,n.elem("div",Tlt)),l=n.createInjector(p),m=e._1r=n.obj();return n.setClass(p,"preview-shaft-okmsg"),fmt(p,m,t),e._1s=n.mountBlock(t,l,vmt),n.subscribeStore(t,["l10n"]),Cmt}function Cmt(t,e){jlt(t,e),n.updateIterator(e._7),Ult(e._g,e._h,t),n.updateBlock(e._i),fmt(e._1q,e._1r,t),n.updateBlock(e._1s)}zlt.dispose=function(t){t._c=n.removeEvent("click",t._c),t._d=n.unmountComponent(t._d),t._b=t._e=t._a=null},Glt.dispose=function(t){t._12=n.removeEvent("go-to-message",t._12),t._10=n.unmountComponent(t._10),t._11=null},Zlt.dispose=function(t){t._1b=n.removeEvent("go-to-message",t._1b),t._19=n.unmountComponent(t._19),t._1a=null},emt.dispose=function(t){t._16=n.unmountKeyIterator(t._16)},rmt.dispose=function(t){t._x=n.unmountBlock(t._x)},imt.dispose=function(t){t._p=n.unmountKeyIterator(t._p)},umt.dispose=function(t){t._l=n.unmountKeyIterator(t._l)},lmt.dispose=function(t){t._1h=n.unmountComponent(t._1h),t._1j=n.unmountComponent(t._1j),t._1i=null},dmt.dispose=function(t){t._1n=n.unmountComponent(t._1n)},gmt.dispose=function(t){t._1v=n.unmountComponent(t._1v)},hmt.dispose=function(t){t._7=n.unmountIterator(t._7),t._i=n.clearBlock(t._i),t._1s=n.unmountBlock(t._1s)};var kmt={__proto__:null,cssScope:Tlt,default:hmt,extend:ylt,state:function(t){return{_list:new YL({itemHeight:Clt.mixed,initialItems:15,offscreenArea:200,reconcile:"prepend",onUpdate:function(e){var n=[],o=null,r=function(t){o={marker:t.marker,rows:[t]},n.push(o)},a=e.items;a.length&&"marker"!==a[0].value.type&&(e.before=Math.max(0,e.before-hlt),r(Alt(a[0].value.marker))),e.items.forEach((function(t){"marker"===t.value.type?r(t.value):o.rows.push(t.value)})),t.setState({scrollList:e,groups:n})}}),_direction:"backward"}},willRender:function(t,e){var n=e.chat;if(n&&n.current){var o=n.prev,r=n.current;(!o||xm(r,"id")!==xm(o,"id"))&&t.store.app.media.prefetch(n.current.id)}},didChange:function(t,e){e.media&&(Ilt(t.props.chat)?(!function(t){var e=t.props.chat,o=t.state._list,r=Ilt(e),a="mixed"===r.id?function(t,e,o){var r=n.__assign(n.__assign({},klt),o),a=[];return Elt(t,e).map((function(t){var e=[];a.push(Alt(t.marker)),t.items.forEach((function(t){var n=t.attach;"PHOTO"!==n._type&&"VIDEO"!==n._type||e.push({width:n.width,height:n.height})}));var o=n.layout(e,r);eQ(t.items,o).forEach((function(e){a.push({type:"grid",id:"".concat(t.marker,":").concat(e.id),marker:t.marker,height:e.height,value:e.items})}))})),a}(t,r,{containerWidth:blt,targetRowHeight:Clt[r.id]}):function(t,e){var n=[];return Elt(t,e).forEach((function(t){n.push(Alt(t.marker)),t.items.forEach((function(e){n.push({type:"item",id:e.attach.mediaId,marker:t.marker,value:e})}))})),n}(t,r);a.forEach((function(t){var e;e="grid"===t.type?t.height+vlt:"item"===t.type?Clt[r.id]+vlt:hlt,o.itemHeight(t,e)})),o.update(a)}(t),xlt(t)):t.setState({scrollList:null,groups:null}))},onSelectSection:Slt,onGoToMessage:wlt,isMediaDelimiter:Mlt};var bmt={"toggle-edit-mode":function(t,e){!function(t,e,n){t.setState({chatEditMode:n}),"string"==typeof e&&(e=t.refs[e]);n?function(t,e,n){var o=Array.from(t.componentView.querySelectorAll(e.nodeName)).find((function(t){return t!==e&&t.editing}));o?o.changed?Zt(t,"show-confirm",{header:V("confirm-cancel-editing"),body:V("confirm-unsaved-changes"),buttons:[{label:V("save"),action:function(){o.submit()?(n(e),e.focus()):(e.exitEditMode(),o.focus(),n(o))}},{label:V("dont-save"),action:function(){o.exitEditMode(),e.focus(),n(e)}}]}):(o.exitEditMode(),n(e)):n(e)}(t,e,(function(e){return wmt(t,e.getAttribute("name"))})):t.state.editingTextField===e.getAttribute("name")&&wmt(t,null)}(t,e.target.props.name,e.detail)},change:function(t,e){var n=e.target.props;void 0===n&&(n={});var o=n.name,r=t.props.chat;if("description"===o)Zt(t,"update-chat",{chatId:r.id,description:e.detail});else if("title"===o){if("DIALOG"===r.type)Zt(t,"update-contact",{contactId:Amt(r).id,action:"UPDATE",name:e.detail});else e.detail!==r.title&&Zt(t,"update-chat",{chatId:r.id,theme:e.detail})}}};function ymt(t){Zt(t,"revoke-link",{chatId:t.props.chat.id,force:!0})}function Smt(t,e){t.setState({makeLinkWhenChatTitleExist:e})}function wmt(t,e){t.setState({editingTextField:e})}function Emt(t,e){if(e.store.isMobile()){var n=e.props.chat,o=L(e,"showMedia");if("DIALOG"===n.type){var r=n.participants.find((function(t){return!t.user.current})).user;o.showMedia(Pj.Contact,{contactId:r.id})}else o.showMedia(Pj.ChatIcon,{chatId:n.id})}else Zt(e,"open-conv-icon-layer",{hideChangeChatIconWidget:!t})}function xmt(t,e){var n=t.props.chat.id,o=e.target,r=o.files&&o.files[0];r&&/^image\//.test(r.type)&&(Zt(t,"change-chat-icon",{chatId:n,file:r}),o.value=null)}function Imt(t){Zt(t,"pick-chat-icon",{chatId:t.props.chat.id})}function Bmt(t,e,n){n.preventDefault(),mO(t),L(e,"toast").show(V("link-copied"))}function Mmt(t){t.setState({requested:!0}),Zt(t,"add-friend",{userId:Amt(t.props.chat).id})}function Amt(t){return t.participants.find((function(t){return!t.user.current})).user}function Tmt(t){if(t.store.get().config.server["chat-link-require-title"]&&!t.props.chat.title){Smt(t,!0),t.setState({requireTitle:!0});var e=t.refs.title;return e.setProps({required:!0}),e.refs.input.click(),Zt(e,"update",{text:""}),void OK.logger.success("messagesLayer","chat-link","has-empty-title")}ymt(t),OK.logger.success("messagesLayer","chat-link","has-full-title")}function jmt(t){var e=t.refs,n=e.media,o=e.scrollerContainer,r=o.refs.scroller,a=n.offsetTop-r.scrollTop;Pmt(t,o.offsetHeight-a)}function Pmt(t,e){t.setState({mediaHeight:e})}function Rmt(t){var e=t.refs.scrollerContainer;if(e)for(var n=e.refs.scroller,o=e.querySelectorAll(".js-scroll-content"),r=0;r<o.length;r++)o[r].handleScroll(n)}var Lmt="e-65f9nr",Omt=[0,0,0,0,0],zmt=[];function Dmt(){zmt.push(Omt),Omt=[0,0,0,0,0]}function Umt(){Omt=zmt.pop()}function Nmt(t,e){e.isDialog="DIALOG"===n.get(t.props.chat,"type"),e.isGroupchat="GROUP_CHAT"===n.get(t.props.chat,"type"),e.curParticipant=n.find(n.get(t.props.chat,"participants"),(function(t){return n.get(t,"user","current")})),e.curAdmin=n.find(n.get(t.props.chat,"admins"),(function(t){return n.get(t,"user","current")})),e.contact=n.get(n.find(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})),"user"),e.editPermsChat="CHAT"===n.get(t.props.chat,"type")&&e.curParticipant&&(!n.get(t.props.chat,"options","ONLY_OWNER_CAN_CHANGE_ICON_TITLE")||n.get(e.curAdmin,"permissions","manageChat")),e.editPermsChannel="CHANNEL"===n.get(t.props.chat,"type")&&n.get(e.curAdmin,"permissions","manageChat"),e.allowEdit=!e.isGroupchat&&!e.isDialog&&"LEFT"!=n.get(t.props.chat,"status")&&(n.get(t.props.chat,"owner","current")||e.editPermsChannel||e.editPermsChat),e.chatIcon=Gt(0,t.props.chat),e.replaceTextEmoji=!n.get(t.store.data.config,"user","NO_TEXT_EMOJI"),e.official=Yt(0,t.props.chat)}function qmt(t,e,n,o){e.chat=n.props.chat,e.class=o.allowEdit||o.chatIcon?"__clickable-okmsg":""}function Hmt(t,e,n,o){Emt(o.allowEdit,t)}function Fmt(t,e,o){return n.setPendingEvent(o._j,"click",Hmt,o),Vmt}function Vmt(t,e){n.setPendingEvent(e._j,"click",Hmt,e)}function Kmt(t,e,o){var r=n.insert(e,n.elem("label",Lmt),""),a=n.appendChild(r,n.elem("input",Lmt));n.setAttribute(a,"type","file"),n.setAttribute(a,"accept","image/png, image/jpeg"),o._w=n.addEvent(a,"change",xmt,t,o),Omt[0]=1}function Wmt(t,e,o){return n.setPendingEvent(o._j,"click",Imt,o),Gmt}function Gmt(t,e){n.setPendingEvent(e._j,"click",Imt,e)}function Ymt(t){return t.store.data.isMobile?Kmt:Wmt}function Xmt(t,e,o){return o._r=n.mountBlock(t,e,Ymt),Qmt}function Qmt(t,e){n.updateBlock(e._r)}function Jmt(t,e){return e.chatIcon?Fmt:e.allowEdit?Xmt:null}function $mt(t,e,o,r){n.updateClass(t,e,"info-okmsg"+(r.isDialog&&!n.get(r.contact,"own")?" __not-own-okmsg":""))}function Zmt(t,e,o,r){e.value=n.get(o.props.chat,"title")||n.get(o.props.chat,"placeholder")||o.store.data.l10n("empty-chat-placeholder"),e.maxLength=r.isDialog?n.get(o.store.data.config,"server","max-cname-length"):n.get(o.store.data.config,"server","max-theme-length"),e.required=r.isDialog||!!n.get(o.props.chat,"link")||o.state.requireTitle,e.errorPrefix=r.isDialog?"contact-name":Pt(0,n.get(o.props.chat,"type"))+"-theme",e.replaceTextEmoji=r.replaceTextEmoji}function tdt(t,e,o){var r=o._1b=n.insert(e,n.createComponent("msg-icon",xe,t),"additions");n.mountComponent(r,n.propsSet(r,{icon:"official",size:"medium",slot:"additions"})),Omt[2]=1}function edt(t,e){return e.official?tdt:null}function ndt(t,e,o){var r=o._16=n.insert(e,n.createComponent("msg-text-field",gut,t)),a=r.componentModel.input;n.setPendingRef(o._1,"title",r);var i=o._17=n.propsSet(r,{name:"title","data-tsid":"chat-name",emojiSize:16,emojiContext:"chat-title"});return Zmt(0,i,t,o),o._18=n.mountBlock(t,a,edt),n.mountComponent(r,i),Omt[1]=1,odt}function odt(t,e){var o=e._16,r=e._17;n.setPendingRef(e._1,"title",o),Zmt(0,r,t,e),n.updateBlock(e._18),n.updateIncomingSlot(o,"additions",Omt[2]),n.updateComponent(o,r)}function rdt(t,e,o){var r=o._1k=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"official",size:"medium"})),Omt[1]=1}function adt(t,e){return e.official?rdt:null}function idt(t,e,o){var r=n.insert(e,n.elem("div",Lmt)),a=n.createInjector(r);n.setClass(r,"chat-title-okmsg"),o._1h=n.mountBlock(t,a,adt);var i=o._1n=n.insert(a,n.createComponent("msg-parsed-text",ii,t)),s=i.componentModel.input;return o._1p=n.insert(s,n.text(n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder"))),n.mountComponent(i,n.propsSet(i,{disableFormatting:!0,emojiSize:16,emojiContext:"chat-title"})),Omt[1]=1,sdt}function sdt(t,e){n.updateBlock(e._1h),Omt[3]|=n.updateText(e._1p,n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder")),n.updateIncomingSlot(e._1n,"",Omt[3])}function udt(t,e){return e.allowEdit?ndt:idt}function cdt(t,e,n){e.chat=n.props.chat}function pdt(t,e,o){var r=o._1v=n.insert(e,n.createComponent("msg-chat-meta",xy,t)),a=o._1w=n.propsSet(r);return cdt(0,a,t),n.mountComponent(r,a),Omt[1]=1,ldt}function ldt(t,e){var o=e._1v,r=e._1w;cdt(0,r,t),n.updateComponent(o,r)}function mdt(t,e){return e.isGroupchat||t.state.chatEditMode?null:pdt}function ddt(t,e,o){var r=o._24=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{class:"requested-okmsg",key:"info-panel-friend-request-send"})),Omt[1]=1}function _dt(t,e,o){var r=o._28=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input;o._2a=n.addEvent(r,"click",Mmt,t,o);var i=o._2b=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"info-panel-add-friend"})),n.mountComponent(r,n.propsSet(r,{class:"primary-okmsg add-friend-okmsg",size:"small",shape:"square","data-l":"t,addFriend","data-tsid":"add_friend_btn"})),Omt[1]=1}function fdt(t){return t.state.requested||n.get(t.props.alert,"pending")?ddt:_dt}function gdt(t,e,o){return o._21=n.mountBlock(t,e,fdt),vdt}function vdt(t,e){n.updateBlock(e._21)}function hdt(t,e){return n.get(t.store.data.config,"server","add-friend-chat-info")&&t.props.alert&&e.isDialog?gdt:null}function Cdt(t,e,o){Bmt(n.get(t.props.chat,"link"),t,e)}function kdt(t,e,o){Bmt(n.get(t.props.chat,"link"),t,e)}function bdt(t){Zt(t,"revoke-link",{chatId:n.get(t.props.chat,"id")})}function ydt(t){Zt(t,"remove-link",{chatId:n.get(t.props.chat,"id")})}function Sdt(t,e,o){var r=n.insert(e,n.elem("div",Lmt));n.setClass(r,"actions-okmsg");var a=o._2u=n.appendChild(r,n.createComponent("msg-l10n",ae,t));o._2w=n.addEvent(a,"click",bdt,t,o),n.mountComponent(a,n.propsSet(a,{key:"change",class:"link-okmsg"}));var i=o._2x=n.appendChild(r,n.createComponent("msg-l10n",ae,t));o._2z=n.addEvent(i,"click",ydt,t,o),n.mountComponent(i,n.propsSet(i,{key:"remove",class:"link-okmsg"})),Omt[1]=1}function wdt(t){return n.get(t.props.chat,"owner","current")?Sdt:null}function Edt(t,e,o){var r=n.insert(e,n.elem("div",Lmt),""),a=n.createInjector(r);n.setClass(r,"permalink-okmsg __icon-okmsg");var i=o._2i=n.insert(a,n.createComponent("msg-icon",xe,t));o._2k=n.addEvent(i,"click",Cdt,t,o),n.mountComponent(i,n.propsSet(i,{icon:"copy"}));var s=o._2l=n.insert(a,n.createComponent("msg-tico",rc,t)),u=s.componentModel.input;return o._2n=n.addEvent(s,"click",kdt,t,o),o._2o=n.insert(u,n.text(t.state.permalink)),n.mountComponent(s,n.propsSet(s,{icon:"media-share",size:"medium"})),o._2q=n.mountBlock(t,a,wdt),Omt[1]=1,xdt}function xdt(t,e){Omt[4]|=n.updateText(e._2o,t.state.permalink),n.updateIncomingSlot(e._2l,"",Omt[4]),n.updateBlock(e._2q)}function Idt(t,e){return n.get(t.props.chat,"link")&&!e.isGroupchat?Edt:null}function Bdt(t,e,n,o){e.chat=n.props.chat,e.allowEdit=o.allowEdit}function Mdt(t,e,o){e.chat=o.props.chat,e.media=n.get(o.props.chat,"media"),e.style="min-height: "+o.state.mediaHeight+"px;"}function Adt(t,e,o){var r=o._38=n.insert(e,n.createComponent("msg-chat-media",kmt,t),"");n.setPendingRef(o._1,"media",r);var a=o._39=n.propsSet(r,{class:"block-okmsg js-scroll-content"});return Mdt(0,a,t),o._3a=n.addEvent(r,"select-tab",jmt,t,o),n.mountComponent(r,a),Omt[1]=1,Tdt}function Tdt(t,e){var o=e._38,r=e._39;n.setPendingRef(e._1,"media",o),Mdt(0,r,t),n.updateComponent(o,r)}function jdt(t){return n.get(t.store.data.config,"server","media")?Adt:null}function Pdt(t,e){var o=t.componentView;Dmt();var r=e._1=n.obj();Nmt(t,e);var a=e._e=n.appendChild(o,n.createComponent("msg-info-sheet",Oet,t)),i=a.componentModel.input;n.setRef(t,"scrollerContainer",a),e._g=n.addEvent(a,"info-sheet-scroll",Rmt,t,e);var s=n.insert(i,n.elem("header",Lmt),""),u=n.createInjector(s),c=e._i=n.insert(u,n.createComponent("msg-chat-image",db,t)),p=c.componentModel.input,l=e._j=n.pendingEvents(t,c),m=e._k=n.propsSet(c,{"data-tsid":"chat-avatar",size:"normal",showStatus:!1});qmt(0,m,t,e),e._l=n.mountBlock(t,p,Jmt),n.finalizePendingEvents(l),n.mountComponent(c,m);var d=e._11=n.insert(u,n.elem("div",Lmt)),_=n.createInjector(d);$mt(d,e._12=n.obj(),0,e),e._13=n.mountBlock(t,_,udt),e._1s=n.mountBlock(t,u,mdt),e._1y=n.mountBlock(t,u,hdt),e._2e=n.mountBlock(t,i,Idt);var f=e._32=n.insert(i,n.createComponent("msg-chat-info-actions",jpt,t),""),g=e._33=n.propsSet(f);return Bdt(0,g,t,e),e._34=n.addEvent(f,"request-chat-link",Tmt,t,e),n.mountComponent(f,g),e._35=n.mountBlock(t,i,jdt),n.mountComponent(a,n.propsSet(a,{scrollable:!0})),Umt(),n.subscribeStore(t,["config","isMobile","l10n"]),n.finalizePendingRefs(t,r),Rdt}function Rdt(t,e){var o=e._i,r=e._k,a=e._32,i=e._33;Dmt(),Nmt(t,e),qmt(0,r,t,e),n.updateBlock(e._l),n.finalizePendingEvents(e._j),n.updateIncomingSlot(o,"",Omt[0]),n.updateComponent(o,r),$mt(e._11,e._12,0,e),n.updateBlock(e._13),n.updateBlock(e._1s),n.updateBlock(e._1y),n.updateBlock(e._2e),Bdt(0,i,t,e),n.updateComponent(a,i),n.updateBlock(e._35),n.updateIncomingSlot(e._e,"",Omt[1]),Umt(),n.finalizePendingRefs(t,e._1)}Kmt.dispose=function(t){t._w=n.removeEvent("change",t._w),Omt[0]=1},Xmt.dispose=function(t){t._r=n.unmountBlock(t._r)},tdt.dispose=function(t){t._1b=n.unmountComponent(t._1b),Omt[2]=1},ndt.dispose=function(t){t._18=n.unmountBlock(t._18),t._16=n.unmountComponent(t._16),t._17=null,Omt[1]=1},rdt.dispose=function(t){t._1k=n.unmountComponent(t._1k),Omt[1]=1},idt.dispose=function(t){t._1h=n.unmountBlock(t._1h),t._1n=n.unmountComponent(t._1n),t._1p=null,Omt[1]=1},pdt.dispose=function(t){t._1v=n.unmountComponent(t._1v),t._1w=null,Omt[1]=1},ddt.dispose=function(t){t._24=n.unmountComponent(t._24),Omt[1]=1},_dt.dispose=function(t){t._2a=n.removeEvent("click",t._2a),t._2b=n.unmountComponent(t._2b),t._28=n.unmountComponent(t._28),Omt[1]=1},gdt.dispose=function(t){t._21=n.unmountBlock(t._21)},Sdt.dispose=function(t){t._2w=n.removeEvent("click",t._2w),t._2u=n.unmountComponent(t._2u),t._2z=n.removeEvent("click",t._2z),t._2x=n.unmountComponent(t._2x),Omt[1]=1},Edt.dispose=function(t){t._2k=n.removeEvent("click",t._2k),t._2i=n.unmountComponent(t._2i),t._2n=n.removeEvent("click",t._2n),t._2l=n.unmountComponent(t._2l),t._2q=n.unmountBlock(t._2q),t._2o=null,Omt[1]=1},Adt.dispose=function(t){t._3a=n.removeEvent("select-tab",t._3a),t._38=n.unmountComponent(t._38),t._39=null,Omt[1]=1},Pdt.dispose=function(t){Dmt(),t._g=n.removeEvent("info-sheet-scroll",t._g),t._j=n.detachPendingEvents(t._j),t._l=n.unmountBlock(t._l),t._i=n.unmountComponent(t._i),t._13=n.unmountBlock(t._13),t._1s=n.unmountBlock(t._1s),t._1y=n.unmountBlock(t._1y),t._2e=n.unmountBlock(t._2e),t._34=n.removeEvent("request-chat-link",t._34),t._32=n.unmountComponent(t._32),t._35=n.unmountBlock(t._35),t._e=n.unmountComponent(t._e),Umt()};var Ldt={__proto__:null,cssScope:Lmt,default:Pdt,props:function(){return{chat:null,alert:null}},state:function(){return{mediaHeight:0}},events:bmt,didChange:function(t,e){var n=e.chat;if(n){if(xm(n.current,"id")!==xm(n.prev,"id")&&(wmt(t,null),Pmt(t,0)),"DIALOG"===n.current.type){var o=n.current.participants.find((function(t){return!t.user.current}));o.user.link&&t.setState({permalink:o.user.link.split("//")[1]})}else n.current.link&&t.setState({permalink:n.current.link.split("//")[1]});!function(t){t.state.makeLinkWhenChatTitleExist&&(Smt(t,!1),t.setState({requireTitle:!1}),ymt(t))}(t),Rmt(t)}},didMount:function(t){var e=N2(t,{retainTrigger:!0});return function(){return e.destroy()}},onOpenChatIcon:Emt,onChangeChatIcon:xmt,onEditChatIcon:Imt,copyLink:Bmt,onAddFriend:Mmt,onRequestChatLink:Tmt,onSelectMediaTab:jmt,updateScrollContent:Rmt};var Odt="e-4vt69l";function zdt(t,e){e.image=n.get(t.props.backgroundOption,"imageSrc"),e.color=n.get(t.props.backgroundOption,"color"),e.chooseExpr=e.image?0:e.color?1:-1,e.caseExpr=0===e.chooseExpr,e.caseExpr_1=1===e.chooseExpr}function Ddt(t,e,o,r){n.updateAttribute(t,e,"style",r.caseExpr_1?"background-color: "+r.color:r.caseExpr?"background-image: url("+r.image+")":void 0),n.updateClass(t,e,"background-option-okmsg"+(o.props.selected?" __selected-okmsg":""))}function Udt(t){Zt(t,"background-select",t.props.backgroundOption)}function Ndt(t,e,n){e.url=n.props.lottieUrl,e.width=n.state.width,e.height=n.state.height}function qdt(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._e=n.propsSet(r,{loop:!0});return Ndt(0,a,t),n.mountComponent(r,a),Hdt}function Hdt(t,e){var o=e._d,r=e._e;Ndt(0,r,t),n.updateComponent(o,r)}function Fdt(t){return t.props.lottieUrl?qdt:null}function Vdt(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._o=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"check"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"inverted-okmsg"}))}function Kdt(t){return t.props.selected?Vdt:null}function Wdt(t,e){var o=t.componentView;zdt(t,e);var r=e._7=n.appendChild(o,n.elem("div",Odt)),a=n.createInjector(r);Ddt(r,e._8=n.obj(),t,e),e._9=n.addEvent(r,"click",Udt,t,e),e._a=n.mountBlock(t,a,Fdt),n.insert(a,n.createSlot(t,"",Odt)),e._h=n.mountSlot(t,"");var i=n.insert(a,n.elem("div",Odt)),s=n.createInjector(i);return n.setClass(i,"inner-border-okmsg"),e._j=n.mountBlock(t,s,Kdt),Gdt}function Gdt(t,e){zdt(t,e),Ddt(e._7,e._8,t,e),n.updateBlock(e._a),n.updateBlock(e._j)}qdt.dispose=function(t){t._d=n.unmountComponent(t._d),t._e=null},Vdt.dispose=function(t){t._o=n.unmountComponent(t._o),t._m=n.unmountComponent(t._m)},Wdt.dispose=function(t){t._9=n.removeEvent("click",t._9),t._a=n.unmountBlock(t._a),t._h=n.unmountSlot(t._h),t._j=n.unmountBlock(t._j)};var Ydt={__proto__:null,cssScope:Odt,default:Wdt,didMount:function(t){var e,n=(null===(e=t.store.get().config.server["animated-backgrounds-web"])||void 0===e?void 0:e.scale)||3;t.setState({width:t.offsetWidth*n,height:t.offsetHeight*n})}};var Xdt="\n    attribute vec4 position;\n    void main() {\n      gl_Position = position;\n    }\n  ",Qdt="\n\tprecision highp float;\n\tuniform vec2 iResolution;\n\tuniform vec2 iMouse;\n\tuniform float iTime;\n\n\tmat2 mm2(in float a){float c = cos(a), s = sin(a);return mat2(c,s,-s,c);}\n\tmat2 m2 = mat2(0.95534, 0.29552, -0.29552, 0.95534);\n\tfloat tri(in float x){return clamp(abs(fract(x)-.5),0.01,0.49);}\n\tvec2 tri2(in vec2 p){return vec2(tri(p.x)+tri(p.y),tri(p.y+tri(p.x)));}\n\n\tfloat clamped_noise(in vec2 p, float spd)\n\t{\n\t\t\tfloat z=1.8;\n\t\t\tfloat z2=2.5;\n\t\tfloat rz = 0.;\n\t\t\tp *= mm2(p.x*0.06);\n\t\t\tvec2 bp = p;\n\t\tfor (float i=0.; i<5.; i++ )\n\t\t{\n\t\t\t\t\tvec2 dg = tri2(bp*1.85)*.75;\n\t\t\t\t\tdg *= mm2(iTime*spd);\n\t\t\t\t\tp -= dg/z2;\n\n\t\t\t\t\tbp *= 1.3;\n\t\t\t\t\tz2 *= .45;\n\t\t\t\t\tz *= .42;\n\t\t\tp *= 1.21 + (rz-1.0)*.02;\n\t\t\t\t\t\n\t\t\t\t\trz += tri(p.x+tri(p.y))*z;\n\t\t\t\t\tp*= -m2;\n\t\t}\n\t\t\treturn clamp(1./pow(rz*29., 1.3),0.,.55);\n\t}\n\n\tfloat hash_fract(in vec2 n){ return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453); }\n\tvec4 make_aurora(vec3 ro, vec3 rd)\n\t{\n\t\t\tvec4 col = vec4(0);\n\t\t\tvec4 avgCol = vec4(0);\n\t\t\t\n\t\t\tfor(float i=0.;i<50.;i++)\n\t\t\t{\n\t\t\t\t\tfloat of = 0.003*hash_fract(gl_FragCoord.xy)*smoothstep(0.,15., i);\n\t\t\t\t\tfloat pt = ((.8+pow(i,1.4)*.002)-ro.y)/(rd.y*2.+0.4);\n\t\t\t\t\tpt -= of;\n\t\t\t\tvec3 bpos = ro + pt*rd;\n\t\t\t\t\tvec2 p = bpos.zx;\n\t\t\t\t\tfloat rzt = clamped_noise(p, 0.07);\n\t\t\t\t\tvec4 col2 = vec4(0,0,0, rzt);\n\t\t\t\t\tcol2.rgb = (sin(1.-vec3(2.15,-.5, 1.2)+i*0.043)*0.5+0.5)*rzt;\n\t\t\t\t\tavgCol =  mix(avgCol, col2, .5);\n\t\t\t\t\tcol += avgCol*exp2(-i*0.065 - 2.5)*smoothstep(0.,5., i);\n\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tcol *= (clamp(rd.y*15.+.4,0.,1.));\n\t\t\t\n\t\t\treturn col*1.8;\n\t}\n\n\tconst float cHashM = 43758.54;\n\tvec4 Hashv4v3 (vec3 p)\n\t{\n\t\tvec3 cHashVA3 = vec3 (37., 39., 41.);\n\t\tvec2 e = vec2 (1., 0.);\n\t\treturn fract (sin (vec4 (dot (p + e.yyy, cHashVA3), dot (p + e.xyy, cHashVA3),\n\t\t\t dot (p + e.yxy, cHashVA3), dot (p + e.xxy, cHashVA3))) * cHashM);\n\t}\n\tfloat Noisefv3 (vec3 p)\n\t{\n\t\tvec4 t;\n\t\tvec3 ip, fp;\n\t\tip = floor (p);\n\t\tfp = fract (p);\n\t\tfp *= fp * (3. - 2. * fp);\n\t\tt = mix (Hashv4v3 (ip), Hashv4v3 (ip + vec3 (0., 0., 1.)), fp.z);\n\t\treturn mix (mix (t.x, t.y, fp.x), mix (t.z, t.w, fp.x), fp.y);\n\t}\n\n\tvec3 stars_color (vec3 rd)\n\t{\n\t\tvec3 rds;\n\t\trds = floor (2000. * rd);\n\t\trds = 0.000315 * rds + 0.1 * Noisefv3 (0.0005 * rds.yzx);\n\t\tfor (int j = 0; j < 19; j ++) rds = abs (rds) / dot (rds, rds) - 0.9;\n\t\treturn 0.25 * vec3 (1., 1., 0.79) * min (1., 0.5e-3 * pow (min (6., length (rds)), 4.));\n\t}\n\t\tvec3 get_color(in vec3 rd)\n\t\t{\n\t\t\t\tfloat sd = dot(normalize(vec3(-0.5, -0.6, 0.9)), rd)*0.5+0.5;\n\t\t\t\tsd = pow(sd, 5.);\n\t\t\t\tvec3 color = mix(vec3(0.05,0.1,0.2), vec3(0.1,0.05,0.2), sd);\n\t\t\t\treturn color*.63;\n\t\t}\n\n    void main() {\n\t\t\tvec2 q = gl_FragCoord.xy / iResolution.xy;\n\t\t\tvec2 p = q - 0.4;\n\t\t\tp.x*=iResolution.x/iResolution.y;\n\t\t\t\n\t\t\tvec3 ro = vec3(0,0,-6.567);\n\t\t\tvec3 rd = normalize(vec3(p,1.1));\n\t\t\tvec2 mo = vec3(0,0,0).xy / iResolution.xy-.5;\n\t\t\tmo = (mo==vec2(-.5))?mo=vec2(-0.1,0.1):mo;\n\t\t\tmo.x *= iResolution.x/iResolution.y;\n\t\t\trd.yz *= mm2(mo.y);\n\t\t\t\n\t\t\tvec3 color = vec3(0.);\n\t\t\tvec3 brd = rd;\n\t\t\tfloat fade = smoothstep(0.,0.01,abs(brd.y))*0.1+0.9;\n\t\t\t\n\t\t\tcolor = get_color(rd)*fade;\n\t\t\t\n\t\t\tif (rd.y > 0.){\n\t\t\t\t\tvec4 aurora = smoothstep(0.,1.5,make_aurora(ro,rd))*fade;\n\t\t\t\t\tcolor += stars_color(rd)*fade*0.9;\n\t\t\t\t\tcolor = color*(1.-aurora.a) + aurora.rgb;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t\trd.y = abs(rd.y);\n\t\t\t\t\tcolor = get_color(rd)*fade*0.6;\n\t\t\t\t\tvec4 aurora = smoothstep(0.0,2.5,make_aurora(ro,rd));\n\t\t\t\t\tcolor += stars_color(rd)*fade*0.2;\n\t\t\t\t\tcolor = color*(1.-aurora.a) + aurora.rgb;\n\t\t\t\t\tvec3 pos = ro + ((0.5-ro.y)/rd.y)*rd;\n\t\t\t\t\tfloat nz2 = clamped_noise(pos.xz*vec2(.5,.7), 0.);\n\t\t\t\t\tcolor += mix(vec3(0.2,0.25,0.5)*0.08,vec3(0.3,0.3,0.5)*0.7, nz2*0.4);\n\t\t\t}\n\t\t\t\n\t\t\tgl_FragColor = vec4(color, 1.);\n    }\n  ";var Jdt="e8yndt7";var $dt={__proto__:null,cssScope:Jdt,default:function(t){var e=t.componentView,o=n.appendChild(e,n.elem("canvas",Jdt));n.setRef(t,"canvas",o)},didMount:function(t){t.setState({running:!0}),function(t){var e=t.refs.canvas.getContext("webgl");if(e){var n=e.createProgram(),o=e.createShader(e.VERTEX_SHADER);e.shaderSource(o,Xdt),e.compileShader(o),e.attachShader(n,o);var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,Qdt),e.compileShader(r),e.attachShader(n,r),e.linkProgram(n);var a=e.getAttribLocation(n,"position"),i=e.getUniformLocation(n,"iResolution"),s=e.getUniformLocation(n,"iTime"),u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW);var c=0;requestAnimationFrame((function o(r){if(t.state.running){r*=.001;var p=Math.min(r-c,.1);c=r,l=e.canvas,m=l.clientWidth,d=l.clientHeight,l.width===m&&l.height===d||(l.width=m,l.height=d),e.viewport(0,0,e.canvas.width,e.canvas.height),e.useProgram(n),e.enableVertexAttribArray(a),e.bindBuffer(e.ARRAY_BUFFER,u),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.uniform2f(i,e.canvas.width,e.canvas.height),e.uniform1f(s,r+p),e.drawArrays(e.TRIANGLES,0,6),requestAnimationFrame(o)}var l,m,d}))}}(t)},willUnmount:function(t){t.setState({running:!1})}};var Zdt={"background-submit":function(t){var e=t.props.chat,n=t.state.selectedOption,o=t.state.isDefault;e&&n&&(o?VU(t,n):function(t,e,n){if(!e||!n)throw"Невозможно установить фон для чата";QU(n.id,!1);var o=qU(t);o.chats||(o.chats={}),o.chats[e]=n,KU(t,o)}(t,e.id,n)),t.setState({savedOption:n}),function(t){Zt(t,"background-update",{removeAll:!0})}(t)},"background-select":function(t,e){var n=e.detail;t.setState({selectedOption:n})}};function t_t(t){Zt(t,"background-update",{removeAll:!1})}var e_t="e-h1vcn3",n_t=[0],o_t=[];function r_t(){o_t.push(n_t),n_t=[0]}function a_t(){n_t=o_t.pop()}function i_t(t,e,o){var r=n.insert(e,n.elem("div",e_t),"");n.setClass(r,"loader-wrapper-okmsg");var a=o._f=n.appendChild(r,n.createComponent("msg-loader",Be,t));n.mountComponent(a,n.propsSet(a,{class:"backgrounds-loader-okmsg",size:"big","data-tsid":"backgrounds_loader"})),n_t[0]=1}function s_t(t){return 0==n.get(t.state.sections,"length")?i_t:null}function u_t(t){return t.state.sections}function c_t(t,e,o,r){e.key="background-section-"+n.get(r.value,"name")}function p_t(t,e,o){var r=n.insert(e,n.elem("div",e_t));n.setClass(r,"background-section-title-okmsg");var a=o._t=n.appendChild(r,n.createComponent("msg-l10n",ae,t)),i=o._u=n.propsSet(a);return c_t(0,i,0,o),n.mountComponent(a,i),n_t[0]=1,l_t}function l_t(t,e){var o=e._t,r=e._u;c_t(0,r,0,e),n.updateComponent(o,r)}function m_t(t,e){return n.get(e.value,"name")?p_t:null}function d_t(t,e){return n.get(e.value,"options")}function __t(t,e,o,r){e.lottieUrl=n.get(r.value,"lottieUrl"),e.backgroundOption=r.value,e.selected=n.get(o.state.selectedOption,"id")===n.get(r.value,"id")}function f_t(t,e,o){var r=o._11=n.insert(e,n.createComponent("msg-chat-background-option",Ydt,t)),a=o._12=n.propsSet(r);return __t(0,a,t,o),n.mountComponent(r,a),n_t[0]=1,g_t}function g_t(t,e){var o=e._11,r=e._12;__t(0,r,t,e),n.updateComponent(o,r)}function v_t(t,e,o,r){e.backgroundOption=r.value,e.selected=n.get(o.state.selectedOption,"id")===n.get(r.value,"id")}function h_t(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-chat-background-option",Ydt,t)),a=r.componentModel.input,i=o._16=n.propsSet(r);v_t(0,i,t,o);var s=o._17=n.insert(a,n.createComponent("msg-chat-snow",xM,t),"");return n.mountComponent(s),n.mountComponent(r,i),n_t[0]=1,C_t}function C_t(t,e){var o=e._15,r=e._16;v_t(0,r,t,e),n.updateComponent(o,r)}function k_t(t,e,o,r){e.backgroundOption=r.value,e.selected=n.get(o.state.selectedOption,"id")===n.get(r.value,"id")}function b_t(t,e,o){var r=o._1b=n.insert(e,n.createComponent("msg-chat-background-option",Ydt,t)),a=r.componentModel.input,i=o._1c=n.propsSet(r);k_t(0,i,t,o);var s=o._1d=n.insert(a,n.createComponent("msg-chat-aurora",$dt,t),"");return n.mountComponent(s),n.mountComponent(r,i),n_t[0]=1,y_t}function y_t(t,e){var o=e._1b,r=e._1c;k_t(0,r,t,e),n.updateComponent(o,r)}function S_t(t,e,o,r){e.backgroundOption=r.value,e.selected=n.get(o.state.selectedOption,"id")===n.get(r.value,"id")}function w_t(t,e,o){var r=o._1h=n.insert(e,n.createComponent("msg-chat-background-option",Ydt,t)),a=o._1i=n.propsSet(r);return S_t(0,a,t,o),n.mountComponent(r,a),n_t[0]=1,E_t}function E_t(t,e){var o=e._1h,r=e._1i;S_t(0,r,t,e),n.updateComponent(o,r)}function x_t(t,e){return"lottie"===n.get(e.value,"type")?f_t:"snow"===n.get(e.value,"id")?h_t:"aurora"===n.get(e.value,"id")?b_t:w_t}function I_t(t,e,o){return o._y=n.mountBlock(t,e,x_t),B_t}function B_t(t,e){n.updateBlock(e._y)}function M_t(t,e,o){return o._p=n.mountBlock(t,e,m_t),o._v=n.mountIterator(t,e,d_t,I_t),A_t}function A_t(t,e){n.updateBlock(e._p),n.updateIterator(e._v)}function T_t(t,e,o){var r=n.insert(e,n.elem("div",e_t),""),a=n.createInjector(r);return n.setClass(r,"background-options-okmsg"),n.setAttribute(r,"scrollable",""),o._m=n.mountIterator(t,a,u_t,M_t),n_t[0]=1,j_t}function j_t(t,e){n.updateIterator(e._m)}function P_t(t){return n.get(t.state.sections,"length")>0?T_t:null}function R_t(t,e,n){e.checked=n.state.isDefault}function L_t(t,e){t.setState({isDefault:!t.state.isDefault})}function O_t(t){Zt(t,"background-submit")}function z_t(t,e){var o=t.componentView;r_t();var r=e._1=n.appendChild(o,n.createComponent("msg-info-sheet",Oet,t)),a=r.componentModel.input,i=n.insert(a,n.elem("div",e_t),"");n.setClass(i,"toolbar-okmsg");var s=e._4=n.appendChild(i,n.createComponent("msg-tico",rc,t)),u=s.componentModel.input;e._6=n.addEvent(s,"click",t_t,t,e);var c=e._7=n.insert(u,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(c,n.propsSet(c,{key:"set-background",class:"toolbar-text-okmsg"})),n.mountComponent(s,n.propsSet(s,{icon:"back",size:"medium",class:"back-okmsg"})),n.insert(a,n.elem("hr",e_t),""),e._b=n.mountBlock(t,a,s_t),e._i=n.mountBlock(t,a,P_t),n.mountComponent(r,n.propsSet(r,{scrollable:!0}));var p=n.appendChild(o,n.elem("div",e_t));n.setClass(p,"controls-okmsg");var l=e._1l=n.appendChild(p,n.createComponent("msg-checkbox",hS,t)),m=l.componentModel.input,d=e._1m=n.propsSet(l,{shape:"square","data-tsid":"set_background_as_default",class:"checkbox-okmsg"});R_t(0,d,t),e._1n=n.addEvent(l,"click",L_t,t,e);var _=e._1o=n.insert(m,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(_,n.propsSet(_,{key:"set-background-as-default"})),n.mountComponent(l,d);var f=n.appendChild(p,n.elem("div",e_t)),g=e._1s=n.appendChild(f,n.createComponent("msg-button",fe,t)),v=g.componentModel.input;e._1u=n.addEvent(g,"click",O_t,t,e);var h=e._1v=n.insert(v,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(h,n.propsSet(h,{key:"backgrounds-ready"})),n.mountComponent(g,n.propsSet(g,{class:"primary-okmsg accept-button-okmsg",shape:"square",size:"small","data-l":"t,button"}));var C=e._1y=n.appendChild(f,n.createComponent("msg-button",fe,t)),k=C.componentModel.input;e._20=n.addEvent(C,"click",t_t,t,e);var b=e._21=n.insert(k,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(b,n.propsSet(b,{key:"backgrounds-cancel"})),n.mountComponent(C,n.propsSet(C,{class:"secondary-okmsg",shape:"square",size:"small","data-l":"t,button"})),a_t(),D_t}function D_t(t,e){var o=e._1l,r=e._1m;r_t(),n.updateBlock(e._b),n.updateBlock(e._i),n.updateIncomingSlot(e._1,"",n_t[0]),R_t(0,r,t),n.updateComponent(o,r),a_t()}i_t.dispose=function(t){t._f=n.unmountComponent(t._f),n_t[0]=1},p_t.dispose=function(t){t._t=n.unmountComponent(t._t),t._u=null,n_t[0]=1},f_t.dispose=function(t){t._11=n.unmountComponent(t._11),t._12=null,n_t[0]=1},h_t.dispose=function(t){t._17=n.unmountComponent(t._17),t._15=n.unmountComponent(t._15),t._16=null,n_t[0]=1},b_t.dispose=function(t){t._1d=n.unmountComponent(t._1d),t._1b=n.unmountComponent(t._1b),t._1c=null,n_t[0]=1},w_t.dispose=function(t){t._1h=n.unmountComponent(t._1h),t._1i=null,n_t[0]=1},I_t.dispose=function(t){t._y=n.unmountBlock(t._y)},M_t.dispose=function(t){t._p=n.unmountBlock(t._p),t._v=n.unmountIterator(t._v)},T_t.dispose=function(t){t._m=n.unmountIterator(t._m),n_t[0]=1},z_t.dispose=function(t){r_t(),t._6=n.removeEvent("click",t._6),t._7=n.unmountComponent(t._7),t._4=n.unmountComponent(t._4),t._b=n.unmountBlock(t._b),t._i=n.unmountBlock(t._i),t._1=n.unmountComponent(t._1),t._1n=n.removeEvent("click",t._1n),t._1o=n.unmountComponent(t._1o),t._1l=n.unmountComponent(t._1l),t._1u=n.removeEvent("click",t._1u),t._1v=n.unmountComponent(t._1v),t._1s=n.unmountComponent(t._1s),t._20=n.removeEvent("click",t._20),t._21=n.unmountComponent(t._21),t._1y=n.unmountComponent(t._1y),a_t()};var U_t={__proto__:null,cssScope:e_t,default:z_t,state:function(){return{isDefault:!0,sections:[]}},events:Zdt,didMount:function(t){GU().then((function(e){t.setState({sections:e})}));var e=function(t){var e=t.props.chat;if(!e)return null;return HU(t,e.id)}(t);e||(e=FU(t)),t.setState({savedOption:e,selectedOption:e})},closeAndUpdate:t_t};function N_t(t,e){var n=t.user,o=t.permissions;return n.id===e?2:o.manageAdmins?1:0}function q_t(t,e){t.user.current?L(e,"toast").show(V("error.its-you")):Zt(e,"toggle-aside-content",{tabName:"manage-admin",tabData:{user:t.user,inviter:t.inviter,source:"chat-admins"}})}var H_t=[0],F_t=[];function V_t(){F_t.push(H_t),H_t=[0]}function K_t(){H_t=F_t.pop()}function W_t(t){return t.state.sorted}function G_t(t,e){e.user=n.get(e.value,"user"),e.owner=n.get(t.props.chat,"owner","id")===n.get(e.user,"id"),e.superadmin=n.get(e.value,"permissions","manageAdmins")}function Y_t(t,e,n,o){e.user=o.user,e.owner=o.owner,e.superadmin=o.superadmin}function X_t(t,e,n,o){q_t(o.value,t)}function Q_t(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"its-you"})),H_t[0]=1}function J_t(t,e){return n.get(e.user,"current")?Q_t:null}function $_t(t,e,o){return o._e=n.mountBlock(t,e,J_t),o._j=n.insert(e,n.text(" ")),H_t[0]=1,Z_t}function Z_t(t,e){n.updateBlock(e._e),H_t[0]|=n.updateText(e._j," ")}function tft(t,e){return n.get(e.user,"current")?$_t:null}function eft(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"chat-owner"})),H_t[0]=1}function nft(t,e,o){var r=o._s=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"superadmin"})),H_t[0]=1}function oft(t,e,o){var r=o._w=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"admin"})),H_t[0]=1}function rft(t,e){return e.owner?eft:e.superadmin?nft:oft}function aft(t,e,o){G_t(t,o);var r=o._8=n.insert(e,n.createComponent("msg-chat-participants-list-item",grt,t)),a=r.componentModel.input,i=o._9=n.propsSet(r,{label:!1,admin:!0,"data-l":"t,item","data-tsid":"participant_list_item"});return Y_t(0,i,0,o),o._a=n.addEvent(r,"click",X_t,t,o),o._b=n.mountBlock(t,a,tft),o._l=n.mountBlock(t,a,rft),n.mountComponent(r,i),ift}function ift(t,e){var o=e._8,r=e._9;G_t(t,e),Y_t(0,r,0,e),n.updateBlock(e._b),n.updateBlock(e._l),n.updateIncomingSlot(o,"",H_t[0]),n.updateComponent(o,r)}function sft(t,e){var o=t.componentView;V_t();var r=n.createInjector(o);return e._1=n.mountIterator(t,r,W_t,aft),K_t(),uft}function uft(t,e){V_t(),n.updateIterator(e._1),K_t()}Q_t.dispose=function(t){t._h=n.unmountComponent(t._h),H_t[0]=1},$_t.dispose=function(t){t._e=n.unmountBlock(t._e),t._j=null,H_t[0]=1},eft.dispose=function(t){t._o=n.unmountComponent(t._o),H_t[0]=1},nft.dispose=function(t){t._s=n.unmountComponent(t._s),H_t[0]=1},oft.dispose=function(t){t._w=n.unmountComponent(t._w),H_t[0]=1},aft.dispose=function(t){t._a=n.removeEvent("click",t._a),t._b=n.unmountBlock(t._b),t._l=n.unmountBlock(t._l),t._8=n.unmountComponent(t._8),t._9=null},sft.dispose=function(t){V_t(),t._1=n.clearIterator(t._1),K_t()};var cft={__proto__:null,cssScope:"e-cgo0lu",default:sft,didChange:function(t,e){var n=e.admins;if(n){var o=t.props.chat.owner.id,r=n.current.sort((function(t,e){var n=N_t(t,o),r=N_t(e,o)-n,a=0===r?t.user.name.localeCompare(e.user.name):0;return r||a}));t.setState({sorted:r})}},edit:q_t},pft={onClose:function(){return function(t){if(t.state.updated&&!t.state.errors){var e=function(t){var e=t.state,n=e.original,o=e.form,r=function(t,e){var n={},o=!1;t.signAdmin!==e.signAdmin&&(n.SIGN_ADMIN=t.signAdmin,o=!0);t.canChangeInfo!==e.canChangeInfo&&(n.ONLY_OWNER_CAN_CHANGE_ICON_TITLE=!t.canChangeInfo,o=!0);t.canChangeMembers!==e.canChangeMembers&&(n.ONLY_ADMIN_CAN_ADD_MEMBER=!t.canChangeMembers,o=!0);t.canChangePin!==e.canChangePin&&(n.ALL_CAN_PIN_MESSAGE=t.canChangePin,o=!0);t.canCall!==e.canCall&&(n.ONLY_ADMIN_CAN_CALL=!t.canCall,o=!0);return o?n:null}(o,n),a={chatId:t.props.chat.id};r&&(a.options=r);return a}(t),n=t.props.chat;t.root.state.service.chat.update(n.id,e),OK.logger.success("messagesLayer","chat-settings","submit"),t.setState({updated:!1})}}(this)}};function lft(t,e){t.setState({form:e,updated:mft(t,e)})}function mft(t,e){var n=t.state.original||{};return e=e||t.state.form,Object.keys(e).some((function(t){return e[t]!==n[t]}))}function dft(t){Zt(t,"hide-aside")}function _ft(t,e){var o;e.stopPropagation();var r=e.target,a=t.state.form||{},i=r.name;if(i){var s=function(t){if("checkbox"===t.type)return t.checked;if("file"===t.type)return t.files[0];return t.value}(r);lft(t,n.__assign(n.__assign({},a),((o={})[i]=s,o)))}}function fft(t){Zt(t,"toggle-aside-content",{tabName:"transfer-ownership-list"})}var gft="ea0kpur",vft=[0],hft=[];function Cft(){hft.push(vft),vft=[0]}function kft(){vft=hft.pop()}function bft(t,e,o){e.checked=n.get(o.state.form,"signAdmin")}function yft(t,e,o){var r=n.insert(e,n.elem("h5",gft));n.setClass(r,"h5-okmsg");var a=o._l=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{key:"actions"}));var i=o._n=n.insert(e,n.createComponent("msg-checkbox",hS,t)),s=i.componentModel.input,u=o._o=n.propsSet(i,{name:"signAdmin",shape:"square","data-l":"t,signAdmin"});bft(0,u,t);var c=o._p=n.insert(s,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(c,n.propsSet(c,{key:"sign-messages"})),n.mountComponent(i,u);var p=n.insert(e,n.elem("div",gft));n.setClass(p,"description-okmsg");var l=o._t=n.appendChild(p,n.createComponent("msg-l10n",ae,t));return n.mountComponent(l,n.propsSet(l,{key:"sign-messages-descr"})),vft[0]=1,Sft}function Sft(t,e){var o=e._n,r=e._o;bft(0,r,t),n.updateComponent(o,r)}function wft(t){return"CHANNEL"==n.get(t.props.chat,"type")?yft:null}function Eft(t,e,o){e.checked=n.get(o.state.form,"canChangeInfo")}function xft(t,e,o){e.checked=n.get(o.state.form,"canChangeMembers")}function Ift(t,e,o){e.checked=n.get(o.state.form,"canChangePin")}function Bft(t,e,o){e.checked=n.get(o.state.form,"canCall")}function Mft(t,e,o){var r=n.insert(e,n.elem("h5",gft));n.setClass(r,"h5-okmsg");var a=o._10=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{key:"change-chat-options"}));var i=o._12=n.insert(e,n.createComponent("msg-checkbox",hS,t)),s=i.componentModel.input,u=o._13=n.propsSet(i,{name:"canChangeInfo",shape:"square","data-l":"t,canChangeInfo"});Eft(0,u,t);var c=o._14=n.insert(s,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(c,n.propsSet(c,{key:"change-chat-info"})),n.mountComponent(i,u);var p=o._17=n.insert(e,n.createComponent("msg-checkbox",hS,t)),l=p.componentModel.input,m=o._18=n.propsSet(p,{name:"canChangeMembers",shape:"square","data-l":"t,canChangeMembers"});xft(0,m,t);var d=o._19=n.insert(l,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(d,n.propsSet(d,{key:"change-chat-members"})),n.mountComponent(p,m);var _=o._1c=n.insert(e,n.createComponent("msg-checkbox",hS,t)),f=_.componentModel.input,g=o._1d=n.propsSet(_,{name:"canChangePin",shape:"square","data-l":"t,canChangePin"});Ift(0,g,t);var v=o._1e=n.insert(f,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(v,n.propsSet(v,{key:"change-chat-pin"})),n.mountComponent(_,g);var h=o._1h=n.insert(e,n.createComponent("msg-checkbox",hS,t)),C=h.componentModel.input,k=o._1i=n.propsSet(h,{name:"canCall",shape:"square","data-l":"t,canCall"});Bft(0,k,t);var b=o._1j=n.insert(C,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(b,n.propsSet(b,{key:"call-chat"})),n.mountComponent(h,k);var y=n.insert(e,n.elem("div",gft));n.setClass(y,"description-okmsg");var S=o._1n=n.appendChild(y,n.createComponent("msg-l10n",ae,t));return n.mountComponent(S,n.propsSet(S,{key:"change-chat-desc"})),vft[0]=1,Aft}function Aft(t,e){var o=e._12,r=e._13,a=e._17,i=e._18,s=e._1c,u=e._1d,c=e._1h,p=e._1i;Eft(0,r,t),n.updateComponent(o,r),xft(0,i,t),n.updateComponent(a,i),Ift(0,u,t),n.updateComponent(s,u),Bft(0,p,t),n.updateComponent(c,p)}function Tft(t){return"CHAT"==n.get(t.props.chat,"type")?Mft:null}function jft(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function Pft(t){Zt(t,"toggle-aside-content",{tabName:"add-admins"})}function Rft(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function Lft(t,e,o){var r=o._1w=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._1y=n.addEvent(r,"click",fft,t,o);var i=o._1z=n.insert(a,n.createComponent("msg-l10n",ae,t),""),s=o._20=n.propsSet(i,{key:"participant-action-transfer-own"});jft(0,s,t),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{class:"action-okmsg",icon:"shield-safety",size:"medium","data-l":"t,transfer-own","data-tsid":"transfer-own"}));var u=o._22=n.insert(e,n.createComponent("msg-tico",rc,t)),c=u.componentModel.input;o._24=n.addEvent(u,"click",Pft,t,o);var p=o._25=n.insert(c,n.createComponent("msg-l10n",ae,t),""),l=o._26=n.propsSet(p,{key:"add-admins-modal"});return Rft(0,l,t),n.mountComponent(p,l),n.mountComponent(u,n.propsSet(u,{class:"action-okmsg",icon:"plus",size:"medium","data-l":"t,add-admins","data-tsid":"add-admins"})),vft[0]=1,Oft}function Oft(t,e){var o=e._1z,r=e._20,a=e._25,i=e._26;jft(0,r,t),n.updateComponent(o,r),Rft(0,i,t),n.updateComponent(a,i)}function zft(t){return n.get(t.props.chat,"participantsCount")>1?Lft:null}function Dft(t,e,o){e.chat=o.props.chat,e.admins=n.get(o.props.chat,"admins")}function Uft(t,e){var o=t.componentView;Cft();var r=e._1=n.appendChild(o,n.createComponent("msg-info-sheet",Oet,t)),a=r.componentModel.input,i=e._3=n.insert(a,n.createComponent("msg-toolbar",qk,t),""),s=i.componentModel.input;e._5=n.addEvent(i,"click",dft,t,e);var u=e._6=n.insert(s,n.createComponent("msg-tico",rc,t),""),c=u.componentModel.input,p=e._8=n.insert(c,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(p,n.propsSet(p,{key:"chat-settings"})),n.mountComponent(u,n.propsSet(u,{icon:"back",size:"medium"})),n.mountComponent(i,n.propsSet(i,{"data-l":"t,back"}));var l=n.insert(a,n.elem("div",gft),"");n.setClass(l,"scroller-okmsg custom-scrollbar-okmsg");var m=n.appendChild(l,n.elem("div",gft));n.setClass(m,"block-okmsg");var d=n.appendChild(m,n.elem("form",gft)),_=n.createInjector(d);n.setAttribute(d,"data-l","t,form"),e._f=n.addEvent(d,"update",_ft,t,e),e._g=n.addEvent(d,"change",_ft,t,e),e._h=n.mountBlock(t,_,wft),e._w=n.mountBlock(t,_,Tft);var f=n.appendChild(l,n.elem("div",gft)),g=n.createInjector(f);n.setClass(f,"block-okmsg");var v=n.insert(g,n.elem("h5",gft));n.setClass(v,"h5-okmsg");var h=e._1r=n.appendChild(v,n.createComponent("msg-l10n",ae,t));n.mountComponent(h,n.propsSet(h,{key:"admins"})),e._1t=n.mountBlock(t,g,zft);var C=e._29=n.insert(g,n.createComponent("msg-chat-admins",cft,t)),k=e._2a=n.propsSet(C,{"data-l":"t,admins","data-tsid":"admins"});return Dft(0,k,t),n.mountComponent(C,k),n.mountComponent(r,n.propsSet(r,{scrollable:!0})),kft(),Nft}function Nft(t,e){var o=e._29,r=e._2a;Cft(),n.updateBlock(e._h),n.updateBlock(e._w),n.updateBlock(e._1t),Dft(0,r,t),n.updateComponent(o,r),n.updateIncomingSlot(e._1,"",vft[0]),kft()}yft.dispose=function(t){t._l=n.unmountComponent(t._l),t._p=n.unmountComponent(t._p),t._n=n.unmountComponent(t._n),t._t=n.unmountComponent(t._t),t._o=null,vft[0]=1},Mft.dispose=function(t){t._10=n.unmountComponent(t._10),t._14=n.unmountComponent(t._14),t._12=n.unmountComponent(t._12),t._19=n.unmountComponent(t._19),t._17=n.unmountComponent(t._17),t._1e=n.unmountComponent(t._1e),t._1c=n.unmountComponent(t._1c),t._1j=n.unmountComponent(t._1j),t._1h=n.unmountComponent(t._1h),t._1n=n.unmountComponent(t._1n),t._13=t._18=t._1d=t._1i=null,vft[0]=1},Lft.dispose=function(t){t._1y=n.removeEvent("click",t._1y),t._1z=n.unmountComponent(t._1z),t._1w=n.unmountComponent(t._1w),t._24=n.removeEvent("click",t._24),t._25=n.unmountComponent(t._25),t._22=n.unmountComponent(t._22),t._20=t._26=null,vft[0]=1},Uft.dispose=function(t){Cft(),t._5=n.removeEvent("click",t._5),t._8=n.unmountComponent(t._8),t._6=n.unmountComponent(t._6),t._3=n.unmountComponent(t._3),t._f=n.removeEvent("update",t._f),t._g=n.removeEvent("change",t._g),t._h=n.unmountBlock(t._h),t._w=n.unmountBlock(t._w),t._1r=n.unmountComponent(t._1r),t._1t=n.unmountBlock(t._1t),t._29=n.unmountComponent(t._29),t._1=n.unmountComponent(t._1),kft()};var qft={__proto__:null,cssScope:gft,default:Uft,extend:pft,didChange:function(t,e){var o=e.chat;if(o&&o.current){var r=function(t){var e=t.options||{};return{type:t.type,theme:t.title,access:t.access,chatWithLink:!!t.link,link:t.link,publicLink:"PUBLIC"===t.access?Wn(t.link||""):"",signAdmin:e.SIGN_ADMIN,canChangeInfo:!e.ONLY_OWNER_CAN_CHANGE_ICON_TITLE,canChangeMembers:!e.ONLY_ADMIN_CAN_ADD_MEMBER,canChangePin:e.ALL_CAN_PIN_MESSAGE,canCall:!e.ONLY_ADMIN_CAN_CALL}}(o.current),a=t.state.original;if(t.setState({original:r}),o.prev&&o.prev.id===o.current.id){var i=n.__assign({},t.state.form);Object.keys(r).forEach((function(t){r[t]!==a[t]&&(i[t]=r[t])})),lft(t,i)}else lft(t,r)}},didRender:function(t){var e=t.state.form;e&&("PUBLIC"===e.access&&"PRIVATE"===t._prevAccess&&t.componentView.querySelector('input[name="publicLink"]').focus(),t._prevAccess=e.access)},close:dft,onHandleChange:_ft,transferOwn:fft};var Hft={manageAdmins:!1,manageMessages:!0,manageParticipants:!0,pinMessage:!0,manageChat:!0,readMessages:!0,callChat:!0},Fft=["manageAdmins","readMessages","manageMessages","manageParticipants","pinMessage","manageChat","callChat"],Vft={change:function(t,e){var o;e.stopPropagation(),e.preventDefault();var r=e.target,a=r.name,i=r.checked,s=t.props.permissions,u=t.state.displayedPermissions,c=n.__assign(n.__assign({},s),((o={})[a]=i,o)),p=function(t,e){return void 0===t&&(t={}),void 0===e&&(e=Object.keys(t)),e.some((function(e){return t[e]}))}(c,u);Zt(t,"permission-checkboxes-changed",{permissions:c,hasCheckedCheckboxes:p})}};var Kft="ejorycb";function Wft(t,e,o){var r=n.insert(e,n.elem("h5",Kft));n.setClass(r,"h5-okmsg");var a=o._5=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{key:"permissions-title"}))}function Gft(t){return t.props.title?Wft:null}function Yft(t){return t.state.list}function Xft(t,e,o,r){e.name=n.get(r.value,"name"),e.disabled=o.props.readOnly||n.get(r.value,"disabled"),e.checked=n.get(r.value,"value"),e["data-l"]="t,"+n.get(r.value,"name"),e["data-tsid"]="checkbox_"+n.get(r.value,"name")}function Qft(t,e,o,r){e.key="perm-"+n.get(r.value,"name"),e["data-type"]=o.props.chatType}function Jft(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{class:"description-okmsg",key:"perm-super-description"}))}function $ft(t,e){return"manageAdmins"==n.get(e.value,"name")?Jft:null}function Zft(t,e,o){var r=o._b=n.insert(e,n.createComponent("msg-checkbox",hS,t)),a=r.componentModel.input,i=o._c=n.propsSet(r,{shape:"square"});Xft(0,i,t,o);var s=o._d=n.insert(a,n.createComponent("msg-l10n",ae,t),""),u=o._e=n.propsSet(s);return Qft(0,u,t,o),n.mountComponent(s,u),n.mountComponent(r,i),o._g=n.mountBlock(t,e,$ft),tgt}function tgt(t,e){var o=e._b,r=e._c,a=e._d,i=e._e;Xft(0,r,t,e),Qft(0,i,t,e),n.updateComponent(a,i),n.updateComponent(o,r),n.updateBlock(e._g)}function egt(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,Gft),e._8=n.mountIterator(t,r,Yft,Zft),ngt}function ngt(t,e){n.updateBlock(e._1),n.updateIterator(e._8)}Wft.dispose=function(t){t._5=n.unmountComponent(t._5)},Jft.dispose=function(t){t._j=n.unmountComponent(t._j)},Zft.dispose=function(t){t._d=n.unmountComponent(t._d),t._b=n.unmountComponent(t._b),t._g=n.unmountBlock(t._g),t._c=t._e=null},egt.dispose=function(t){t._1=n.clearBlock(t._1),t._8=n.clearIterator(t._8)};var ogt,rgt={__proto__:null,cssScope:Kft,default:egt,events:Vft,didChange:function(t,e){var n=e.permissions,o=e.chatType;if(n||o){var r=t.props,a=r.permissions,i=function(t,e){var n,o="CHANNEL"===t,r=null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.includes("BOT");return Fft.filter((function(t){return!("readMessages"===t&&!r)&&("callChat"!==t||!o)}))}(r.chatType),s=i.map((function(t){return{name:t,value:a[t]||a.manageAdmins,disabled:"manageAdmins"!==t&&a.manageAdmins}}));t.setState({list:s,displayedPermissions:i})}}};function agt(t,e){e.stopPropagation();var n=t.state,o=n.editMode,r=n.originalPermissions,a=e.detail,i=a.permissions,s=a.hasCheckedCheckboxes,u=!o||!Hw(i,r,!0);t.setState({submitEnabled:s&&u,currentPermissions:i})}function igt(t,e){!function(t){var e=t.props,n=e.chat,o=e.user,r=e.source,a=t.state.editMode;ogt=t.state.currentPermissions,a||Zt(t,"log-admins",{source:r}),Zt(t,"manage-admins",{chatId:n.id,userIds:[o.id],permissions:ogt})}(t),cgt(t)}function sgt(t){cgt(t)}function ugt(t){var e=t.props,n=e.chat,o=e.user;Zt(t,"transfer-ownership",{chatId:n.id,userId:o.id})}function cgt(t){Zt(t,"hide-aside")}var pgt="e-r3t0kb",lgt=[0,0,0,0],mgt=[];function dgt(){mgt.push(lgt),lgt=[0,0,0,0]}function _gt(){lgt=mgt.pop()}function fgt(t,e){e.permissions=n.get(n.find(n.get(t.props.chat,"admins"),(function(t){return n.get(t,"user","current")})),"permissions"),e.superadmin=n.get(t.state.currentPermissions,"manageAdmins"),e.admin=!e.superadmin}function ggt(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"edit-admin"})),lgt[0]=1}function vgt(t){return t.state.editMode?ggt:null}function hgt(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"add-admin"})),lgt[0]=1}function Cgt(t){return t.state.editMode?null:hgt}function kgt(t,e,n){e.user=n.props.user}function bgt(t,e,n,o){e.admin=o.admin,e.superadmin=o.superadmin}function ygt(t,e,o){var r=o._y=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"superadmin"})),lgt[2]=1}function Sgt(t,e,o){var r=o._12=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"admin"})),lgt[2]=1}function wgt(t,e){return e.superadmin?ygt:e.admin?Sgt:null}function Egt(t,e,o){e["data-gender"]=n.get(o.props.user,"gender")}function xgt(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1f=n.propsSet(r,{key:"admin-inviter-you"});return Egt(0,a,t),n.mountComponent(r,a),lgt[2]=1,Igt}function Igt(t,e){var o=e._1e,r=e._1f;Egt(0,r,t),n.updateComponent(o,r)}function Bgt(t,e,o){e["data-gender"]=n.get(o.props.inviter,"gender")}function Mgt(t,e,o){var r=o._1i=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1j=n.propsSet(r,{key:"admin-inviter"});Bgt(0,a,t),n.mountComponent(r,a),o._1k=n.insert(e,n.text(" "));var i=o._1l=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),s=i.componentModel.input;return o._1m=n.insert(s,n.text(n.get(t.props.inviter,"name"))),n.mountComponent(i),lgt[2]=1,Agt}function Agt(t,e){var o=e._1i,r=e._1j;Bgt(0,r,t),n.updateComponent(o,r),lgt[2]|=n.updateText(e._1k," "),lgt[3]|=n.updateText(e._1m,n.get(t.props.inviter,"name")),n.updateIncomingSlot(e._1l,"",lgt[3])}function Tgt(t){return n.get(t.props.inviter,"current")?xgt:Mgt}function jgt(t,e,o){return o._18=n.insert(e,n.text(" ")),n.insert(e,n.text("•")),o._1a=n.insert(e,n.text(" ")),o._1b=n.mountBlock(t,e,Tgt),lgt[2]=1,Pgt}function Pgt(t,e){lgt[2]|=n.updateText(e._18," "),lgt[2]|=n.updateText(e._1a," "),n.updateBlock(e._1b)}function Rgt(t){return t.props.inviter?jgt:null}function Lgt(t,e,o,r){e.permissions=o.state.currentPermissions,e.chatType=n.get(o.props.chat,"type"),e.readOnly=!n.get(r.permissions,"manageParticipants")}function Ogt(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function zgt(t){Zt(t,"remove-admin",{userId:n.get(t.props.user,"id"),hideAside:!0})}function Dgt(t,e,o){var r=o._26=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input;o._28=n.addEvent(r,"click",zgt,t,o);var i=o._29=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"participant-action-remove-admin"})),n.mountComponent(r,n.propsSet(r,{icon:"delete","data-l":"t,remove-admin","data-tsid":"remove_admin_button"}))}function Ugt(t){return t.state.editMode?Dgt:null}function Ngt(t,e,n){e.disabled=!n.state.submitEnabled}function qgt(t,e){var o=t.componentView;dgt(),fgt(t,e);var r=e._5=n.appendChild(o,n.createComponent("msg-toolbar",qk,t)),a=r.componentModel.input;e._7=n.addEvent(r,"click",sgt,t,e);var i=e._8=n.insert(a,n.createComponent("msg-tico",rc,t),""),s=i.componentModel.input;e._a=n.mountBlock(t,s,vgt),e._g=n.mountBlock(t,s,Cgt),n.mountComponent(i,n.propsSet(i,{icon:"back",size:"medium"})),n.mountComponent(r,n.propsSet(r,{"data-l":"t,back"}));var u=n.appendChild(o,n.elem("div",pgt));n.setClass(u,"scroller-okmsg custom-scrollbar-okmsg");var c=e._n=n.appendChild(u,n.createComponent("msg-chat-item-container",eb,t)),p=c.componentModel.input,l=e._o=n.insert(p,n.createComponent("msg-user-card",Nh,t),"image"),m=e._p=n.propsSet(l,{slot:"image",size:"small","data-tsid":"chat_participants_list_item"});kgt(0,m,t),n.mountComponent(l,m);var d=e._q=n.insert(p,n.createComponent("msg-name",Sh,t),"title"),_=d.componentModel.input,f=e._r=n.propsSet(d,{slot:"title","data-tsid":"participant_id"});bgt(0,f,0,e),e._s=n.insert(_,n.text(n.get(t.props.user,"name"))),n.mountComponent(d,f);var g=n.insert(p,n.elem("div",pgt),""),v=n.createInjector(g);n.setClass(g,"sec-okmsg"),e._v=n.mountBlock(t,v,wgt),e._15=n.mountBlock(t,v,Rgt),n.mountComponent(c);var h=n.appendChild(u,n.elem("div",pgt));n.setClass(h,"block-okmsg");var C=n.appendChild(h,n.elem("form",pgt));e._1r=n.addEvent(C,"submit",igt,t,e),e._1s=n.addEvent(C,"input-submit",igt,t,e);var k=e._1t=n.appendChild(C,n.createComponent("msg-admin-checkboxes",rgt,t)),b=e._1u=n.propsSet(k,{"data-l":"t,form"});Lgt(0,b,t,e),e._1v=n.addEvent(k,"permission-checkboxes-changed",agt,t,e),n.mountComponent(k,b);var y=n.appendChild(h,n.elem("div",pgt)),S=n.createInjector(y);n.setClass(y,"actions-okmsg");var w=e._1x=n.insert(S,n.createComponent("msg-tico",rc,t)),E=w.componentModel.input;e._1z=n.addEvent(w,"click",ugt,t,e);var x=e._20=n.insert(E,n.createComponent("msg-l10n",ae,t),""),I=e._21=n.propsSet(x,{key:"participant-action-transfer-own"});Ogt(0,I,t),n.mountComponent(x,I),n.mountComponent(w,n.propsSet(w,{icon:"shield-safety",size:"medium","data-l":"t,transfer-own","data-tsid":"transfer_own_button"})),e._23=n.mountBlock(t,S,Ugt);var B=n.appendChild(o,n.elem("footer",pgt)),M=e._2e=n.appendChild(B,n.createComponent("msg-button",fe,t)),A=M.componentModel.input,T=e._2f=n.propsSet(M,{shape:"square",class:"primary-okmsg action-okmsg","data-l":"t,submit","data-tsid":"submit_button"});Ngt(0,T,t),e._2g=n.addEvent(M,"click",igt,t,e);var j=e._2h=n.insert(A,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(j,n.propsSet(j,{key:"save"})),n.mountComponent(M,T);var P=e._2k=n.appendChild(B,n.createComponent("msg-button",fe,t)),R=P.componentModel.input;e._2m=n.addEvent(P,"click",sgt,t,e);var L=e._2n=n.insert(R,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(L,n.propsSet(L,{key:"cancel"})),n.mountComponent(P,n.propsSet(P,{shape:"square",class:"secondary-okmsg action-okmsg","data-l":"t,cancel"})),_gt(),Hgt}function Hgt(t,e){var o=e._o,r=e._p,a=e._q,i=e._r,s=e._1t,u=e._1u,c=e._20,p=e._21,l=e._2e,m=e._2f;dgt(),fgt(t,e),n.updateBlock(e._a),n.updateBlock(e._g),n.updateIncomingSlot(e._8,"",lgt[0]),kgt(0,r,t),n.updateComponent(o,r),bgt(0,i,0,e),lgt[1]|=n.updateText(e._s,n.get(t.props.user,"name")),n.updateIncomingSlot(a,"",lgt[1]),n.updateComponent(a,i),n.updateBlock(e._v),n.updateBlock(e._15),n.updateIncomingSlot(e._n,"",lgt[2]),Lgt(0,u,t,e),n.updateComponent(s,u),Ogt(0,p,t),n.updateComponent(c,p),n.updateBlock(e._23),Ngt(0,m,t),n.updateComponent(l,m),_gt()}ggt.dispose=function(t){t._d=n.unmountComponent(t._d),lgt[0]=1},hgt.dispose=function(t){t._j=n.unmountComponent(t._j),lgt[0]=1},ygt.dispose=function(t){t._y=n.unmountComponent(t._y),lgt[2]=1},Sgt.dispose=function(t){t._12=n.unmountComponent(t._12),lgt[2]=1},xgt.dispose=function(t){t._1e=n.unmountComponent(t._1e),t._1f=null,lgt[2]=1},Mgt.dispose=function(t){t._1i=n.unmountComponent(t._1i),t._1l=n.unmountComponent(t._1l),t._1j=t._1k=t._1m=null,lgt[2]=1},jgt.dispose=function(t){t._1b=n.unmountBlock(t._1b),t._18=t._1a=null,lgt[2]=1},Dgt.dispose=function(t){t._28=n.removeEvent("click",t._28),t._29=n.unmountComponent(t._29),t._26=n.unmountComponent(t._26)},qgt.dispose=function(t){dgt(),t._7=n.removeEvent("click",t._7),t._a=n.unmountBlock(t._a),t._g=n.unmountBlock(t._g),t._8=n.unmountComponent(t._8),t._5=n.unmountComponent(t._5),t._o=n.unmountComponent(t._o),t._q=n.unmountComponent(t._q),t._v=n.unmountBlock(t._v),t._15=n.unmountBlock(t._15),t._n=n.unmountComponent(t._n),t._1r=n.removeEvent("submit",t._1r),t._1s=n.removeEvent("input-submit",t._1s),t._1v=n.removeEvent("permission-checkboxes-changed",t._1v),t._1t=n.unmountComponent(t._1t),t._1z=n.removeEvent("click",t._1z),t._20=n.unmountComponent(t._20),t._1x=n.unmountComponent(t._1x),t._23=n.unmountBlock(t._23),t._2g=n.removeEvent("click",t._2g),t._2h=n.unmountComponent(t._2h),t._2e=n.unmountComponent(t._2e),t._2m=n.removeEvent("click",t._2m),t._2n=n.unmountComponent(t._2n),t._2k=n.unmountComponent(t._2k),_gt()};var Fgt={__proto__:null,cssScope:pgt,default:qgt,state:function(){return{editMode:!1,originalPermissions:{},currentPermissions:{}}},didMount:function(t){var e=t.props,n=e.chat,o=e.user,r=null==n?void 0:n.admins.find((function(t){return t.user.id===o.id})),a=r?Object.assign({},r.permissions):ogt||Hft,i=Boolean(r);t.setState({editMode:i,originalPermissions:a,currentPermissions:a,submitEnabled:!i})},onPermissionCheckboxesChange:agt,onSubmit:igt,onBack:sgt,transferOwnership:ugt,close:cgt};var Vgt=[0],Kgt=[];function Wgt(){Kgt.push(Vgt),Vgt=[0]}function Ggt(){Vgt=Kgt.pop()}function Ygt(t,e){e.forward=n.get(t.props.chat,"posting","forward"),e.chooseExpr=n.get(e.forward,"messageIds")?0:1,e.caseExpr=0===e.chooseExpr,e.count=e.caseExpr?Tt(0,n.get(e.forward,"messageIds")):void 0}function Xgt(t,e,n,o){e["data-count"]=o.count,e["data-countPlural"]=o.count}function Qgt(t,e,o){var r=o._b=n.insert(e,n.createComponent("msg-l10n",ae,t),"title"),a=o._c=n.propsSet(r,{slot:"title",key:"forward-messages"});return Xgt(0,a,0,o),n.mountComponent(r,a),Vgt[0]=1,Jgt}function Jgt(t,e){var o=e._b,r=e._c;Xgt(0,r,0,e),n.updateComponent(o,r)}function $gt(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-l10n",ae,t),"title");n.mountComponent(r,n.propsSet(r,{slot:"title",key:"share-channel-link"})),Vgt[0]=1}function Zgt(t,e){return[Qgt,$gt][e.chooseExpr]}function tvt(t,e,o,r){e.chats=o.store.data.chats,e.config=o.store.data.config,e.forward=r.forward,e.maxCommentLength=n.get(o.store.data.config,"server","max-msg-length")}function evt(t,e){var o=t.componentView;Wgt(),Ygt(t,e);var r=e._6=n.appendChild(o,n.createComponent("msg-info-sheet",Oet,t)),a=r.componentModel.input;e._8=n.mountBlock(t,a,Zgt);var i=e._i=n.insert(a,n.createComponent("msg-forward-form",tnt,t),""),s=e._j=n.propsSet(i,{"data-tsid":"user_and_chat_block"});return tvt(0,s,t,e),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{toolbar:!0,disableBack:!0})),Ggt(),n.subscribeStore(t,["chats","config"]),nvt}function nvt(t,e){var o=e._i,r=e._j;Wgt(),Ygt(t,e),n.updateBlock(e._8),tvt(0,r,t,e),n.updateComponent(o,r),n.updateIncomingSlot(e._6,"title",Vgt[0]),Ggt()}Qgt.dispose=function(t){t._b=n.unmountComponent(t._b),t._c=null,Vgt[0]=1},$gt.dispose=function(t){t._f=n.unmountComponent(t._f),Vgt[0]=1},evt.dispose=function(t){Wgt(),t._8=n.unmountBlock(t._8),t._i=n.unmountComponent(t._i),t._6=n.unmountComponent(t._6),Ggt()};var ovt={__proto__:null,cssScope:"eze1am4",default:evt,props:function(){return{chat:null}}};var rvt="ep710be";function avt(t,e){e.animateIn=Tt(0,t.state.prevContent)?"slide-in 0.3s ease-out":null,e.animateOut=Tt(0,t.props.content)?"slide-out 0.3s ease-in":"dissolve 0.3s"}function ivt(t){return t.props.content}function svt(t,e){e.ifExpr="transfer-ownership-list"===e.value,e.ifExpr_1="add-admins"===e.value}function uvt(t,e,n,o){e.chat=n.props.chat,e.contacts=n.store.data.contacts,e.config=n.store.data.config,e.mode=o.ifExpr_1?"ADD_ADMIN":o.ifExpr?"TRANSFER_OWNER":"VIEW",e["data-l"]=o.ifExpr_1?"t,add-admin":o.ifExpr?"t,transfer-owner":"t,participants",e["data-tsid"]=o.ifExpr_1?"add-admin-list":o.ifExpr?"transfer-ownership-list":"all-users-in-chat"}function cvt(t,e){var o=e._f,r=e._g;uvt(0,r,t,e),n.updateComponent(o,r)}function pvt(t,e,o){return o._f?cvt(t,o):function(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-chat-participants",jst,t)),a=o._g=n.propsSet(r,{class:"section-okmsg"});uvt(0,a,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._f,n.createAnimation(o.animateIn,rvt)),lvt}function lvt(t,e){cvt(t,e)}function mvt(t,e,n){e.chat=n.props.chat,e.alert=n.props.alert}function dvt(t,e){var o=e._l,r=e._m;mvt(0,r,t),n.updateComponent(o,r)}function _vt(t,e,o){return o._l?dvt(t,o):function(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-chat-info",Ldt,t)),a=o._m=n.propsSet(r,{class:"section-okmsg","aria-modal":"true",role:"dialog","data-tsid":"chat-info","data-l":"t,info"});mvt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._l,n.createAnimation(o.animateIn,rvt)),fvt}function fvt(t,e){dvt(t,e)}function gvt(t,e,n){e.chat=n.props.chat}function vvt(t,e){var o=e._r,r=e._s;gvt(0,r,t),n.updateComponent(o,r)}function hvt(t,e,o){return o._r?vvt(t,o):function(t,e,o){var r=o._r=n.insert(e,n.createComponent("msg-chat-aside-forward",ovt,t)),a=o._s=n.propsSet(r,{class:"section-okmsg"});gvt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._r,n.createAnimation(o.animateIn,rvt)),Cvt}function Cvt(t,e){vvt(t,e)}function kvt(t,e,n){e.chat=n.props.chat}function bvt(t,e){var o=e._x,r=e._y;kvt(0,r,t),n.updateComponent(o,r)}function yvt(t,e,o){return o._x?bvt(t,o):function(t,e,o){var r=o._x=n.insert(e,n.createComponent("msg-chat-background",U_t,t)),a=o._y=n.propsSet(r,{class:"section-okmsg","data-tsid":"chat-background"});kvt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._x,n.createAnimation(o.animateIn,rvt)),Svt}function Svt(t,e){bvt(t,e)}function wvt(t,e,o){e.chat=o.props.chat,e["data-tsid"]=("CHANNEL"!==n.get(o.props.chat,"type")?"chat":"channel")+"_settings_layer"}function Evt(t,e){var o=e._13,r=e._14;wvt(0,r,t),n.updateComponent(o,r)}function xvt(t,e,o){return o._13?Evt(t,o):function(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-chat-settings",qft,t)),a=o._14=n.propsSet(r,{class:"section-okmsg","data-l":"t,settings"});wvt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._13,n.createAnimation(o.animateIn,rvt)),Ivt}function Ivt(t,e){Evt(t,e)}function Bvt(t,e,o){e.chat=o.props.chat,e.user=n.get(o.props.data,"manage-admin","user"),e.inviter=n.get(o.props.data,"manage-admin","inviter"),e.source=n.get(o.props.data,"manage-admin","source")}function Mvt(t,e){var o=e._19,r=e._1a;Bvt(0,r,t),n.updateComponent(o,r)}function Avt(t,e,o){return o._19?Mvt(t,o):function(t,e,o){var r=o._19=n.insert(e,n.createComponent("msg-manage-admin",Fgt,t)),a=o._1a=n.propsSet(r,{class:"section-okmsg","data-l":"t,manage-admin"});Bvt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._19,n.createAnimation(o.animateIn,rvt)),Tvt}function Tvt(t,e){Mvt(t,e)}function jvt(t,e){return"participants"===e.value||"transfer-ownership-list"===e.value||"add-admins"===e.value?pvt:"info"===e.value?_vt:"forward"===e.value?hvt:"backgrounds"===e.value?yvt:"settings"===e.value?xvt:"manage-admin"===e.value?Avt:null}function Pvt(t,e,o){return svt(0,o),o._a=n.mountBlock(t,e,jvt),Rvt}function Rvt(t,e){svt(0,e),n.updateBlock(e._a)}function Lvt(t,e){var o=t.componentView,r=n.createInjector(o);return avt(t,e),e._4=n.mountIterator(t,r,ivt,Pvt),n.subscribeStore(t,["contacts","config"]),Ovt}function Ovt(t,e){avt(t,e),n.updateIterator(e._4)}pvt.dispose=function(t,e){n.animate(t._f,n.createAnimation(t.animateOut,rvt),(function(){return function(t){var e=t._f;t._f=n.unmountComponent(e),n.domRemove(e),t._g=null}(t)}))},_vt.dispose=function(t,e){n.animate(t._l,n.createAnimation(t.animateOut,rvt),(function(){return function(t){var e=t._l;t._l=n.unmountComponent(e),n.domRemove(e),t._m=null}(t)}))},hvt.dispose=function(t,e){n.animate(t._r,n.createAnimation(t.animateOut,rvt),(function(){return function(t){var e=t._r;t._r=n.unmountComponent(e),n.domRemove(e),t._s=null}(t)}))},yvt.dispose=function(t,e){n.animate(t._x,n.createAnimation(t.animateOut,rvt),(function(){return function(t){var e=t._x;t._x=n.unmountComponent(e),n.domRemove(e),t._y=null}(t)}))},xvt.dispose=function(t,e){n.animate(t._13,n.createAnimation(t.animateOut,rvt),(function(){return function(t){var e=t._13;t._13=n.unmountComponent(e),n.domRemove(e),t._14=null}(t)}))},Avt.dispose=function(t,e){n.animate(t._19,n.createAnimation(t.animateOut,rvt),(function(){return function(t){var e=t._19;t._19=n.unmountComponent(e),n.domRemove(e),t._1a=null}(t)}))},Pvt.dispose=function(t){t._a=n.unmountBlock(t._a)},Lvt.dispose=function(t){t._4=n.clearIterator(t._4)};var zvt={__proto__:null,cssScope:rvt,default:Lvt,plugins:function(){return[DS({ESC:function(t,e,n){var o=t.props.content;(null==o?void 0:o.length)?(e.stopPropagation(),Zt(t,"hide-aside"),OK.logger.success("messagesLayer","aside","esc")):n()}})]},didChange:function(t,e){var n=e.content;n&&t.setState({prevContent:n.prev})}};function Dvt(t){Zt(t,"join-call")}function Uvt(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=e._3=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"group-call","data-tsid":"chat-call-text"})),n.mountComponent(r,n.propsSet(r,{icon:"audio-call-s",size:"medium"}));var s=e._6=n.appendChild(o,n.createComponent("msg-button",fe,t)),u=s.componentModel.input;e._8=n.addEvent(s,"click",Dvt,t,e);var c=e._9=n.insert(u,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(c,n.propsSet(c,{key:"join-group-call"})),n.mountComponent(s,n.propsSet(s,{class:"primary-okmsg",size:"small",shape:"square","data-tsid":"call-join-btn"}))}Uvt.dispose=function(t){t._3=n.unmountComponent(t._3),t._1=n.unmountComponent(t._1),t._8=n.removeEvent("click",t._8),t._9=n.unmountComponent(t._9),t._6=n.unmountComponent(t._6)};var Nvt={__proto__:null,cssScope:"e4yldzh",default:Uvt};function qvt(t,e){var n=Hvt(e).map((function(t){return t.id||t.cid})).filter(Boolean);"reply"===t||"edit"===t?Zt(e,t+"-message",{messageId:n[0]}):"forward"===t?Zt(e,"run-message-action",{messageIds:n,action:"forward"}):"remove"!==t&&"copy"!==t||Zt(e,t+"-messages",{messageIds:n})}function Hvt(t){var e=t.props.messages;return e?Array.isArray(e)?e:[e]:[]}function Fvt(t){var e=t.length;return e?(1===e?["forward","remove","copy","reply","edit"]:e<=100?["forward","remove","copy"]:["forward","copy"]).filter((function(e){return t.every((function(t){return function(t,e){var n=t.actions;return n&&n.some((function(t){return t.type===e&&(!t.timeout||t.timeout>Date.now())}))}(t,e)}))})):[]}var Vvt="eehkeer";function Kvt(t,e){e.count=Tt(0,t.props.messages)}function Wvt(t,e,n,o){e["data-count"]=o.count,e["data-countPlural"]=o.count}function Gvt(t){return t.state.actions}function Yvt(t,e){e.icon="remove"===e.value?"delete":e.value}function Xvt(t,e,n,o){e.title=n.store.data.l10n(o.value),e["data-tsid"]="control-"+o.value,e["data-l"]="t,messageActionMass"+o.value}function Qvt(t,e,n,o){qvt(o.value,t)}function Jvt(t,e,n,o){e.icon=o.icon}function $vt(t,e,o){Yvt(0,o);var r=o._c=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._d=n.propsSet(r,{class:"secondary-okmsg",shape:"circle"});Xvt(0,i,t,o),o._e=n.addEvent(r,"click",Qvt,t,o);var s=o._f=n.insert(a,n.createComponent("msg-icon",xe,t),""),u=o._g=n.propsSet(s,{size:"medium"});return Jvt(0,u,0,o),n.mountComponent(s,u),n.mountComponent(r,i),Zvt}function Zvt(t,e){var o=e._c,r=e._d,a=e._f,i=e._g;Yvt(0,e),Xvt(0,r,t,e),Jvt(0,i,0,e),n.updateComponent(a,i),n.updateComponent(o,r)}function tht(t){Ot(t,"reset")}function eht(t,e){var o=t.componentView;Kvt(t,e);var r=e._3=n.appendChild(o,n.createComponent("msg-l10n",ae,t)),a=e._4=n.propsSet(r,{class:"counter-okmsg",key:"message-count"});Wvt(0,a,0,e),n.mountComponent(r,a),n.appendChild(o,n.text(":\n\n    "));var i=n.appendChild(o,n.elem("span",Vvt)),s=n.createInjector(i);n.setClass(i,"controls-okmsg"),e._7=n.mountIterator(t,s,Gvt,$vt);var u=e._j=n.appendChild(o,n.createComponent("msg-button",fe,t)),c=u.componentModel.input;e._l=n.addEvent(u,"click",tht,t,e);var p=e._m=n.insert(c,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(p,n.propsSet(p,{icon:"clear"})),n.mountComponent(u,n.propsSet(u,{shape:"circle",class:"close-okmsg"})),n.subscribeStore(t,["l10n"]),nht}function nht(t,e){var o=e._3,r=e._4;Kvt(t,e),Wvt(0,r,0,e),n.updateComponent(o,r),n.updateIterator(e._7)}$vt.dispose=function(t){t._e=n.removeEvent("click",t._e),t._f=n.unmountComponent(t._f),t._c=n.unmountComponent(t._c),t._d=t._g=null},eht.dispose=function(t){t._3=n.unmountComponent(t._3),t._7=n.unmountIterator(t._7),t._l=n.removeEvent("click",t._l),t._m=n.unmountComponent(t._m),t._j=n.unmountComponent(t._j)};var oht={__proto__:null,cssScope:Vvt,default:eht,props:function(){return{messages:null}},didChange:function(t,e){e.messages&&t.setState({actions:Fvt(Hvt(t))})},runAction:qvt};function rht(t,e){e.stopPropagation(),Zt(t,t.props.canUnpin?"unpin-message":"hide-pinned-message",{})}var aht="e78kj8j",iht=[0,0],sht=[];function uht(){sht.push(iht),iht=[0,0]}function cht(){iht=sht.pop()}function pht(t,e){e.message="FORWARD"==n.get(t.props.message,"link","type")?n.get(t.props.message,"link","message"):t.props.message,e.attach=n.get(e.message,"attaches",0),e.type=n.get(e.attach,"_type"),e.transcriptionEnabled=n.get(t.store.data.config,"server","audio-transcription-enabled")&&n.get(t.store.data.config,"user","AUDIO_TRANSCRIPTION_ENABLED"),e.permissions=n.get(n.find(n.get(t.props.chat,"admins"),(function(t){return n.get(t,"user","current")})),"permissions"),e.canUnpin=!n.get(t.store.data.config,"server","settings-use")||n.get(t.props.chat,"options","ALL_CAN_PIN_MESSAGE")||n.get(e.permissions,"pinMessage")}function lht(t,e,o,r){n.updateAttribute(t,e,"src",n.get(r.attach,"url"))}function mht(t,e,o){var r=o._e=n.insert(e,n.elem("img",aht)),a=o._f=n.obj();return n.setClass(r,"preview-okmsg"),n.setAttribute(r,"alt",""),lht(r,a,0,o),dht}function dht(t,e){lht(e._e,e._f,0,e)}function _ht(t,e,o,r){n.updateAttribute(t,e,"src",n.get(r.attach,"thumbnail"))}function fht(t,e,o){var r=o._i=n.insert(e,n.elem("img",aht)),a=o._j=n.obj();return n.setClass(r,"preview-okmsg"),n.setAttribute(r,"alt",""),_ht(r,a,0,o),ght}function ght(t,e){_ht(e._i,e._j,0,e)}function vht(t,e,o,r){n.updateAttribute(t,e,"src",n.get(r.attach,"image","url"))}function hht(t,e,o){var r=o._m=n.insert(e,n.elem("img",aht)),a=o._n=n.obj();return n.setClass(r,"preview-okmsg"),n.setAttribute(r,"alt",""),vht(r,a,0,o),Cht}function Cht(t,e){vht(e._m,e._n,0,e)}function kht(t,e){return"PHOTO"==e.type?mht:"VIDEO"==e.type?fht:"SHARE"==e.type&&n.get(e.attach,"image","url")?hht:null}function bht(t,e,o,r){n.updateAttribute(t,e,"src",n.get(r.attach,"previewUrl")||n.get(r.attach,"url"))}function yht(t,e,o){var r=o._t=n.insert(e,n.elem("img",aht)),a=o._u=n.obj();n.setClass(r,"preview-okmsg __inline-okmsg"),n.setAttribute(r,"alt",""),bht(r,a,0,o);var i=n.insert(e,n.elem("span",aht));n.setClass(i,"description-okmsg");var s=o._w=n.appendChild(i,n.createComponent("msg-l10n",ae,t));return n.mountComponent(s,n.propsSet(s,{key:"sticker"})),Sht}function Sht(t,e){bht(e._t,e._u,0,e)}function wht(t,e,o,r){e.messageElements=n.filter(n.get(r.message,"elements"),(function(t){return"HEADING"!==n.get(t,"type")&&"MONOSPACED"!==n.get(t,"type")}))}function Eht(t,e,o){var r=o._10=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input,i=o._11=n.propsSet(r);return wht(0,i,0,o),o._12=n.insert(a,n.text(n.get(o.message,"text"))),n.mountComponent(r,i),xht}function xht(t,e){var o=e._10,r=e._11;wht(0,r,0,e),iht[0]|=n.updateText(e._12,n.get(e.message,"text")),n.updateIncomingSlot(o,"",iht[0]),n.updateComponent(o,r)}function Iht(t,e,o){var r=o._16=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"photo"}))}function Bht(t,e,o){var r=o._1a=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"video"}))}function Mht(t,e,o){var r=o._1h=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._1j=n.insert(a,n.text(n.get(o.attach,"transcription"))),n.mountComponent(r,n.propsSet(r,{emojiContext:"pinned"})),Aht}function Aht(t,e){iht[1]|=n.updateText(e._1j,n.get(e.attach,"transcription")),n.updateIncomingSlot(e._1h,"",iht[1])}function Tht(t,e,o){var r=o._1n=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"audio"}))}function jht(t,e){return n.get(e.attach,"transcription")&&e.transcriptionEnabled?Mht:Tht}function Pht(t,e,o,r){e.duration=n.get(r.attach,"duration")}function Rht(t,e,o){o._1e=n.mountBlock(t,e,jht);var r=o._1p=n.insert(e,n.createComponent("msg-duration",qi,t)),a=o._1q=n.propsSet(r);return Pht(0,a,0,o),n.mountComponent(r,a),Lht}function Lht(t,e){var o=e._1p,r=e._1q;n.updateBlock(e._1e),Pht(0,r,0,e),n.updateComponent(o,r)}function Oht(t,e,o){var r=o._1t=n.insert(e,n.createComponent("msg-icon",xe,t));return n.mountComponent(r,n.propsSet(r,{class:"preview-okmsg __inline-okmsg",icon:"play"})),o._1v=n.insert(e,n.text(n.get(o.attach,"artistName"))),n.insert(e,n.text(" — ")),o._1x=n.insert(e,n.text(n.get(o.attach,"title"))),zht}function zht(t,e){n.updateText(e._1v,n.get(e.attach,"artistName")),n.updateText(e._1x,n.get(e.attach,"title"))}function Dht(t,e,o){return o._20=n.insert(e,n.text(n.get(o.attach,"title"))),Uht}function Uht(t,e){n.updateText(e._20,n.get(e.attach,"title"))}function Nht(t,e,o){return o._23=n.insert(e,n.text(n.get(o.attach,"name"))),qht}function qht(t,e){n.updateText(e._23,n.get(e.attach,"name"))}function Hht(t,e,o){var r=o._26=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{class:"preview-okmsg __inline-okmsg",icon:"location"}));var a=o._28=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{key:"location"}))}function Fht(t,e){return"STICKER"==e.type?yht:n.get(e.message,"text")?Eht:"PHOTO"==e.type?Iht:"VIDEO"==e.type?Bht:"AUDIO"==e.type?Rht:"MUSIC"==e.type?Oht:"SHARE"==e.type?Dht:"FILE"==e.type?Nht:"LOCATION"==e.type?Hht:null}function Vht(t,e,o){var r=o._2e=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._2g=n.addEvent(r,"click",rht,t,o);var i=o._2h=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"clear"})),n.mountComponent(r,n.propsSet(r,{class:"close-okmsg",shape:"circle"}))}function Kht(t,e){return e.canUnpin?Vht:null}function Wht(t,e){var o=t.componentView;uht();var r=n.createInjector(o);pht(t,e);var a=e._8=n.insert(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"pin",class:"pin-icon-okmsg"}));var i=n.insert(r,n.elem("div",aht)),s=n.createInjector(i);n.setClass(i,"content-okmsg"),e._b=n.mountBlock(t,s,kht);var u=n.insert(s,n.elem("div",aht)),c=n.createInjector(u);return n.setClass(u,"text-okmsg"),e._q=n.mountBlock(t,c,Fht),e._2b=n.mountBlock(t,r,Kht),cht(),n.subscribeStore(t,["config"]),Ght}function Ght(t,e){uht(),pht(t,e),n.updateBlock(e._b),n.updateBlock(e._q),n.updateBlock(e._2b),cht()}mht.dispose=function(t){t._f=t._e=null},fht.dispose=function(t){t._j=t._i=null},hht.dispose=function(t){t._n=t._m=null},yht.dispose=function(t){t._w=n.unmountComponent(t._w),t._u=t._t=null},Eht.dispose=function(t){t._10=n.unmountComponent(t._10),t._11=t._12=null},Iht.dispose=function(t){t._16=n.unmountComponent(t._16)},Bht.dispose=function(t){t._1a=n.unmountComponent(t._1a)},Mht.dispose=function(t){t._1h=n.unmountComponent(t._1h),t._1j=null},Tht.dispose=function(t){t._1n=n.unmountComponent(t._1n)},Rht.dispose=function(t){t._1e=n.unmountBlock(t._1e),t._1p=n.unmountComponent(t._1p),t._1q=null},Oht.dispose=function(t){t._1t=n.unmountComponent(t._1t),t._1v=t._1x=null},Dht.dispose=function(t){t._20=null},Nht.dispose=function(t){t._23=null},Hht.dispose=function(t){t._26=n.unmountComponent(t._26),t._28=n.unmountComponent(t._28)},Vht.dispose=function(t){t._2g=n.removeEvent("click",t._2g),t._2h=n.unmountComponent(t._2h),t._2e=n.unmountComponent(t._2e)},Wht.dispose=function(t){uht(),t._8=n.unmountComponent(t._8),t._b=n.unmountBlock(t._b),t._q=n.unmountBlock(t._q),t._2b=n.clearBlock(t._2b),cht()};var Yht={__proto__:null,cssScope:aht,default:Wht,props:function(){return{message:null,hidden:!1,canUnpin:!1}},onHidePin:rht};var Xht="e-xylj2x",Qht=[0,0],Jht=[];function $ht(){Jht.push(Qht),Qht=[0,0]}function Zht(){Qht=Jht.pop()}function tCt(t,e,o){n.updateAttribute(t,e,"href",n.get(o.props.product,"linkUrl"))}function eCt(t,e,o){n.updateAttribute(t,e,"src",n.get(o.props.product,"imageUrl"))}function nCt(t,e,o){var r=o._6=n.insert(e,n.elem("img",Xht)),a=o._7=n.obj();return n.setClass(r,"preview-okmsg"),n.setAttribute(r,"alt",""),eCt(r,a,t),oCt}function oCt(t,e){eCt(e._6,e._7,t)}function rCt(t,e,o){var r=n.insert(e,n.elem("div",Xht));n.setClass(r,"preview-okmsg stub-okmsg");var a=o._b=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"photo",size:"medium"}))}function aCt(t){return n.get(t.props.product,"imageUrl")?nCt:rCt}function iCt(t,e){var o=t.componentView;$ht();var r=e._1=n.appendChild(o,n.elem("a",Xht)),a=n.createInjector(r),i=e._2=n.obj();n.setClass(r,"product-link-okmsg"),tCt(r,i,t),e._3=n.mountBlock(t,a,aCt);var s=n.insert(a,n.elem("div",Xht));n.setClass(s,"text-okmsg");var u=e._f=n.appendChild(s,n.createComponent("msg-parsed-text",ii,t)),c=u.componentModel.input;e._h=n.insert(c,n.text(n.get(t.props.product,"title"))),n.mountComponent(u,n.propsSet(u,{class:"title-okmsg"}));var p=e._j=n.appendChild(s,n.createComponent("msg-parsed-text",ii,t)),l=p.componentModel.input;return e._l=n.insert(l,n.text(n.get(t.props.product,"description"))),n.mountComponent(p,n.propsSet(p,{class:"description-okmsg"})),Zht(),sCt}function sCt(t,e){$ht(),tCt(e._1,e._2,t),n.updateBlock(e._3),Qht[0]|=n.updateText(e._h,n.get(t.props.product,"title")),n.updateIncomingSlot(e._f,"",Qht[0]),Qht[1]|=n.updateText(e._l,n.get(t.props.product,"description")),n.updateIncomingSlot(e._j,"",Qht[1]),Zht()}nCt.dispose=function(t){t._7=t._6=null},rCt.dispose=function(t){t._b=n.unmountComponent(t._b)},iCt.dispose=function(t){$ht(),t._3=n.unmountBlock(t._3),t._f=n.unmountComponent(t._f),t._j=n.unmountComponent(t._j),Zht()};var uCt={__proto__:null,cssScope:Xht,default:iCt,props:function(){return{product:null}}};function cCt(t){var e=t.refs.searchInput;e&&t.props.showSearch&&e.focus()}function pCt(t,e){"A"!==e.target.tagName&&(e.preventDefault(),Ot(t,"pin-click",t.props.chat.pinnedMessage))}function lCt(t){var e=t.props.chat;Zt(t,"open-video-call-layer",{dir:"JOINING",conversationId:e.videoConversation.conversationId,chatId:e.id})}function mCt(t){Ot(t,"reset-search")}var dCt="eyxq4ot";function _Ct(t,e){e.contact=n.get(n.find(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})),"user"),e.showControls=!t.props.noControls&&Tt(0,n.get(t.props.chat,"selectedMessages"))?1:0,e.showSearch=t.props.showSearch||n.get(t.props.chat,"search")?1:0,e.showPin=!n.get(t.props.chat,"pinnedMessage")||n.get(t.props.chat,"hidePinnedMessage")||n.get(t.props.chat,"search")?0:1,e.panelCount=e.showControls+e.showSearch+e.showPin,e.easing="0.3s cubic-bezier(.4, 0, .6, 1)",e.panelShowAnimation=e.panelCount>1?"slide-in "+e.easing:null,e.panelHideAnimation=e.panelCount?"slide-out "+e.easing:null}function fCt(t,e,o,r){e.user=r.contact,e.data=o.props.alert,e.simple=n.get(o.store.data.config,"server","redesign-alert")}function gCt(t,e){var o=e._i,r=e._j;fCt(0,r,t,e),n.updateComponent(o,r)}function vCt(t,e,o){return o._g?gCt(t,o):function(t,e,o){var r=o._g=n.insert(e,n.elem("section",dCt)),a=n.appendChild(r,n.elem("div",dCt));n.setClass(a,"holder-okmsg");var i=o._i=n.appendChild(a,n.createComponent("msg-chat-alert",NU,t)),s=o._j=n.propsSet(i,{"data-l":"t,chatAlert","data-tsid":"not-friend"});fCt(0,s,t,o),n.mountComponent(i,s)}(t,e,o),n.animate(o._g,aN(o._g,t)),hCt}function hCt(t,e){gCt(t,e)}function CCt(t,e){return!e.showSearch&&t.props.alert?vCt:null}function kCt(t,e,o){!o._q&&function(t,e,o){var r=o._q=n.insert(e,n.elem("section",dCt)),a=n.appendChild(r,n.elem("div",dCt));n.setClass(a,"holder-okmsg");var i=o._s=n.appendChild(a,n.createComponent("msg-chat-call-indicator",Nvt,t));o._u=n.addEvent(i,"join-call",lCt,t,o),n.mountComponent(i,n.propsSet(i,{"data-tsid":"chat-call-panel"}))}(t,e,o),n.animate(o._q,aN(o._q,t))}function bCt(t){return!t.store.data.isMobile&&"CHAT"===n.get(t.props.chat,"type")&&(n.get(t.props.chat,"videoConversation")&&!n.get(t.props.config,"server","call-started-at")||n.get(t.props.chat,"videoConversation","startedAt"))?kCt:null}function yCt(t,e,o){e.product=n.get(o.props.chat,"subject")}function SCt(t,e){var o=e._12,r=e._13;yCt(0,r,t),n.updateComponent(o,r)}function wCt(t,e,o){return o._10?SCt(t,o):function(t,e,o){var r=o._10=n.insert(e,n.elem("section",dCt)),a=n.appendChild(r,n.elem("div",dCt));n.setClass(a,"holder-okmsg");var i=o._12=n.appendChild(a,n.createComponent("msg-market-item",uCt,t)),s=o._13=n.propsSet(i);yCt(0,s,t),n.mountComponent(i,s)}(t,e,o),n.animate(o._10,aN(o._10,t)),ECt}function ECt(t,e){SCt(t,e)}function xCt(t){return"GROUP_CHAT"===n.get(t.props.chat,"type")&&"PRODUCT"===n.get(t.props.chat,"subject","type")?wCt:null}function ICt(t,e,o){e.message=n.get(o.props.chat,"pinnedMessage"),e.canUnpin="GROUP_CHAT"!==n.get(o.props.chat,"type")&&n.get(o.props.chat,"admins")}function BCt(t,e,o){var r=o._1d=n.insert(e,n.createComponent("msg-pinned",Yht,t)),a=o._1e=n.propsSet(r,{class:"panel-okmsg"});return ICt(0,a,t),o._1f=n.addEvent(r,"click",pCt,t,o),n.mountComponent(r,a),MCt}function MCt(t,e){var o=e._1d,r=e._1e;ICt(0,r,t),n.updateComponent(o,r)}function ACt(t,e){return e.showPin?BCt:null}function TCt(t,e,o){e.value=n.get(o.props.chat,"search","query"),e.placeholder=o.store.data.l10n("search-messages"),e.loading="loading"===n.get(o.props.chat,"search","loadState")}function jCt(t,e){Zt(t,"message-search",{chatId:n.get(t.props.chat,"id"),query:n.get(e,"target","value")})}function PCt(t,e,o){var r=o._1u=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input;o._1w=n.addEvent(r,"click",mCt,t,o);var i=o._1x=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"clear"})),n.mountComponent(r,n.propsSet(r,{class:"close-okmsg",shape:"circle","data-tsid":"close_search_panel"}))}function RCt(t){return"loading"!==n.get(t.props.chat,"search","loadState")?PCt:null}function LCt(t,e){var o=e._1o,r=e._1p;n.setPendingRef(e._1,"searchInput",o),TCt(0,r,t),n.updateComponent(o,r),n.updateBlock(e._1r)}function OCt(t,e,o){return o._1m?LCt(t,o):function(t,e,o){var r=o._1m=n.insert(e,n.elem("div",dCt)),a=n.createInjector(r);n.setClass(r,"chat-search-okmsg panel-okmsg"),o._1n=n.addEvent(r,"animationend",cCt,t,o);var i=o._1o=n.insert(a,n.createComponent("msg-search-input",BW,t));n.setPendingRef(o._1,"searchInput",i);var s=o._1p=n.propsSet(i,{name:"message-search",showIcon:!0,focused:!0,"data-tsid":"search_message"});TCt(0,s,t),o._1q=n.addEvent(i,"input",jCt,t,o),n.mountComponent(i,s),o._1r=n.mountBlock(t,a,RCt)}(t,e,o),n.animate(o._1m,n.createAnimation(o.panelShowAnimation,dCt)),zCt}function zCt(t,e){LCt(t,e)}function DCt(t,e){return e.showSearch?OCt:null}function UCt(t,e,o){e.messages=n.get(o.props.chat,"selectedMessages")}function NCt(t){Zt(t,"reset-selected-messages",{chatId:n.get(t.props.chat,"id")})}function qCt(t,e){var o=e._26,r=e._27;UCt(0,r,t),n.updateComponent(o,r)}function HCt(t,e,o){return o._26?qCt(t,o):function(t,e,o){var r=o._26=n.insert(e,n.createComponent("msg-chat-messages-controls",oht,t)),a=o._27=n.propsSet(r,{class:"panel-okmsg","data-l":"t,mass-controls"});UCt(0,a,t),o._28=n.addEvent(r,"reset",NCt,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._26,n.createAnimation(o.panelShowAnimation,dCt)),FCt}function FCt(t,e){qCt(t,e)}function VCt(t,e){return e.showControls?HCt:null}function KCt(t,e){n.updateBlock(e._1a),n.updateBlock(e._1h),n.updateBlock(e._21)}function WCt(t,e,o){return o._19?KCt(0,o):function(t,e,o){var r=o._19=n.insert(e,n.elem("section",dCt)),a=n.createInjector(r);n.setClass(r,"panel-container-okmsg"),o._1a=n.mountBlock(t,a,ACt),o._1h=n.mountBlock(t,a,DCt),o._21=n.mountBlock(t,a,VCt)}(t,e,o),n.animate(o._19,aN(o._19,t)),GCt}function GCt(t,e){KCt(0,e)}function YCt(t,e){return e.showControls||e.showSearch||e.showPin?WCt:null}function XCt(t){Zt(t,"show-pinned-message",{chatId:n.get(t.props.chat,"id")})}function QCt(t,e,o){!o._2e&&function(t,e,o){var r=o._2e=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input;o._2g=n.addEvent(r,"click",XCt,t,o);var i=o._2h=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"pin"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",size:"big",class:"pin-button-okmsg float-okmsg"}))}(t,e,o),n.animate(o._2e,n.createAnimation("global:msg-pop-in 0.15s ease-out",dCt))}function JCt(t,e){return n.get(t.props.chat,"pinnedMessage")&&n.get(t.props.chat,"hidePinnedMessage")&&!(e.showControls||e.showSearch||e.showPin)?QCt:null}function $Ct(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();return _Ct(t,e),e._b=n.mountBlock(t,r,CCt),e._l=n.mountBlock(t,r,bCt),e._v=n.mountBlock(t,r,xCt),e._14=n.mountBlock(t,r,YCt),e._29=n.mountBlock(t,r,JCt),n.subscribeStore(t,["config","isMobile","l10n"]),n.finalizePendingRefs(t,a),ZCt}function ZCt(t,e){_Ct(t,e),n.updateBlock(e._b),n.updateBlock(e._l),n.updateBlock(e._v),n.updateBlock(e._14),n.updateBlock(e._29),n.finalizePendingRefs(t,e._1)}vCt.dispose=function(t,e){var o=t._g;n.animate(o,iN(0,e),(function(){return function(t){t._i=n.unmountComponent(t._i),t._g=n.domRemove(t._g),t._j=null}(t)}))},kCt.dispose=function(t,e){var o=t._q;n.animate(o,iN(0,e),(function(){return function(t){t._u=n.removeEvent("join-call",t._u),t._s=n.unmountComponent(t._s),t._q=n.domRemove(t._q)}(t)}))},wCt.dispose=function(t,e){var o=t._10;n.animate(o,iN(0,e),(function(){return function(t){t._12=n.unmountComponent(t._12),t._10=n.domRemove(t._10),t._13=null}(t)}))},BCt.dispose=function(t){t._1f=n.removeEvent("click",t._1f),t._1d=n.unmountComponent(t._1d),t._1e=null},PCt.dispose=function(t){t._1w=n.removeEvent("click",t._1w),t._1x=n.unmountComponent(t._1x),t._1u=n.unmountComponent(t._1u)},OCt.dispose=function(t,e){n.animate(t._1m,n.createAnimation(t.panelHideAnimation,dCt),(function(){return function(t){t._1n=n.removeEvent("animationend",t._1n),t._1q=n.removeEvent("input",t._1q),t._1o=n.unmountComponent(t._1o),t._1r=n.unmountBlock(t._1r),t._1m=n.domRemove(t._1m),t._1p=null}(t)}))},HCt.dispose=function(t,e){n.animate(t._26,n.createAnimation(t.panelHideAnimation,dCt),(function(){return function(t){var e=t._26;t._28=n.removeEvent("reset",t._28),t._26=n.unmountComponent(e),n.domRemove(e),t._27=null}(t)}))},WCt.dispose=function(t,e){var o=t._19;n.animate(o,iN(0,e),(function(){return function(t){t._1a=n.unmountBlock(t._1a),t._1h=n.unmountBlock(t._1h),t._21=n.unmountBlock(t._21),t._19=n.domRemove(t._19)}(t)}))},QCt.dispose=function(t,e){n.animate(t._2e,n.createAnimation("global:msg-pop-in 0.15s ease-out reverse",dCt),(function(){return function(t){var e=t._2e;t._2g=n.removeEvent("click",t._2g),t._2h=n.unmountComponent(t._2h),t._2e=n.unmountComponent(e),n.domRemove(e)}(t)}))},$Ct.dispose=function(t){t._b=n.clearBlock(t._b),t._l=n.clearBlock(t._l),t._v=n.clearBlock(t._v),t._14=n.clearBlock(t._14),t._29=n.clearBlock(t._29)};var tkt={__proto__:null,cssScope:dCt,default:$Ct,slideUpNotify:iN,slideDownNotify:aN,plugins:function(){return[DS({ESC:function(t,e){var n=t.props.chat,o=n.selectedMessages,r=n.id;if(o)return e.stopPropagation(),void Zt(t,"reset-selected-messages",{chatId:r});t.refs.searchInput&&(e.stopPropagation(),mCt(t))}})]},onAnimationSearchEnd:cCt,onPinClick:pCt,onJoinCall:lCt,onResetSearch:mCt},ekt=[0,0],nkt=[];function okt(){nkt.push(ekt),ekt=[0,0]}function rkt(){ekt=nkt.pop()}function akt(t,e){e.isChannelMessage="CHANNEL"===n.get(t.props.message,"type")||"CHANNEL_ADMIN"===n.get(t.props.message,"type"),e.isMine=!(!n.get(t.props.message,"sender","current")||e.isChannelMessage)}function ikt(t,e,n,o){e.message=n.props.message,e.mine=o.isMine}function skt(t,e,o){e.id="msg-message-more-menu"+n.get(o.props.message,"id")}function ukt(t){Ot(t,"close")}function ckt(t){return t.state.actions}function pkt(t,e){e.chooseExpr="block"===e.value?0:1,e.caseExpr=0===e.chooseExpr,e.actionName=e.caseExpr?n.get(t.props.chat,"link")?"ban":"kick":void 0}function lkt(t,e,n,o){e["data-l"]="t,messageAction"+o.value,e.class="remove"==o.value||"favoriteStickerAdd"==o.value||"favoriteStickerRemove"==o.value?"delimiter-okmsg":""}function mkt(t,e,n,o){Kw(o.value,t,e)}function dkt(t,e,n,o){e["data-tsid"]=o.value+"_msg_button"}function _kt(t,e,n,o){e.key="message-action-"+o.actionName}function fkt(t,e,o){var r=o._n=n.insert(e,n.createComponent("msg-tico",rc,t),""),a=r.componentModel.input,i=o._o=n.propsSet(r,{icon:"remove",size:"medium"});dkt(0,i,0,o);var s=o._p=n.insert(a,n.createComponent("msg-l10n",ae,t),""),u=o._q=n.propsSet(s);return _kt(0,u,0,o),n.mountComponent(s,u),n.mountComponent(r,i),ekt[1]=1,gkt}function gkt(t,e){var o=e._n,r=e._o,a=e._p,i=e._q;dkt(0,r,0,e),_kt(0,i,0,e),n.updateComponent(a,i),n.updateComponent(o,r)}function vkt(t,e,n,o){e.icon="remove"==o.value?"delete":o.value,e["data-tsid"]=o.value+"_msg_button"}function hkt(t,e,n,o){e.key="message-action-"+o.value}function Ckt(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-tico",rc,t),""),a=r.componentModel.input,i=o._v=n.propsSet(r,{size:"medium"});vkt(0,i,0,o);var s=o._w=n.insert(a,n.createComponent("msg-l10n",ae,t),""),u=o._x=n.propsSet(s);return hkt(0,u,0,o),n.mountComponent(s,u),n.mountComponent(r,i),ekt[1]=1,kkt}function kkt(t,e){var o=e._u,r=e._v,a=e._w,i=e._x;vkt(0,r,0,e),hkt(0,i,0,e),n.updateComponent(a,i),n.updateComponent(o,r)}function bkt(t,e){return[fkt,Ckt][e.chooseExpr]}function ykt(t,e,o){pkt(t,o);var r=o._h=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._i=n.propsSet(r,{role:"menuitem"});return lkt(0,i,0,o),o._j=n.addEvent(r,"click",mkt,t,o),o._k=n.mountBlock(t,a,bkt),n.mountComponent(r,i),ekt[0]=1,Skt}function Skt(t,e){var o=e._h,r=e._i;pkt(t,e),lkt(0,r,0,e),n.updateBlock(e._k),n.updateIncomingSlot(o,"",ekt[1]),n.updateComponent(o,r)}function wkt(t,e){var o=t.componentView;okt(),akt(t,e);var r=e._4=n.appendChild(o,n.createComponent("msg-message",GT,t)),a=e._5=n.propsSet(r,{mobile:!0,sequence:"preview"});ikt(0,a,t,e),n.mountComponent(r,a);var i=e._6=n.appendChild(o,n.createComponent("msg-menu",bS,t)),s=i.componentModel.input,u=e._7=n.propsSet(i,{role:"menu"});return skt(0,u,t),e._8=n.mountUse(t,i,Yw),e._9=n.addEvent(i,"esc",ukt,t,e),e._a=n.mountIterator(t,s,ckt,ykt),n.mountComponent(i,u),rkt(),Ekt}function Ekt(t,e){var o=e._4,r=e._5,a=e._6,i=e._7;okt(),akt(t,e),ikt(0,r,t,e),n.updateComponent(o,r),skt(0,i,t),n.updateIterator(e._a),n.updateIncomingSlot(a,"",ekt[0]),n.updateComponent(a,i),rkt()}fkt.dispose=function(t){t._p=n.unmountComponent(t._p),t._n=n.unmountComponent(t._n),t._o=t._q=null,ekt[1]=1},Ckt.dispose=function(t){t._w=n.unmountComponent(t._w),t._u=n.unmountComponent(t._u),t._v=t._x=null,ekt[1]=1},ykt.dispose=function(t){t._j=n.removeEvent("click",t._j),t._k=n.unmountBlock(t._k),t._h=n.unmountComponent(t._h),t._i=null,ekt[0]=1},wkt.dispose=function(t){okt(),t._4=n.unmountComponent(t._4),t._8=n.unmountUse(t._8),t._9=n.removeEvent("esc",t._9),t._a=n.unmountIterator(t._a),t._6=n.unmountComponent(t._6),rkt()};var xkt,Ikt={__proto__:null,cssScope:"e-1ds4uq",default:wkt,onActionClick:Kw,didChange:function(t,e){e.message&&t.setState({actions:Ww(t)})},extend:Vw,a11yContextPopup:Yw};function Bkt(){return{coords:{x:.5,y:.5},dragging:!1}}function Mkt(t){return[zS(window,"resize",(function(){return function(){return Lkt(t)}}))]}function Akt(t){Lkt(t)}function Tkt(t){t._stopSeek&&t._stopSeek(),t._stopDrag&&t._stopDrag()}function jkt(t,e){if(1===e.which){e.stopPropagation();var n=t.refs.progress.getBoundingClientRect();t._seeking=!0;t._stopSeek=function(t,e,n,o){var r,a=function(e){r=Tn(t.width?(e.pageX-t.left)/t.width:0,0,1),n(r)};a(e);var i=function(){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",i),o&&o(r)};return document.addEventListener("mousemove",a),document.addEventListener("mouseup",i),i}(n,e,(function(e){return t.setState({seekPos:e})}),(function(e){t._seeking=!1,L(t,"player").seek(t.store.get().audioPlayer.message.id,e),requestAnimationFrame((function(){t.setState({seekPos:null})}))}))}}function Pkt(t){var e=t.store.get().audioPlayer;$p(e.chatId,{messagesTime:e.message.time,useBack:!0})}function Rkt(t,e){if(function(t){if(0!==t.button)return!1;var e=t.target;return!e.closest||!e.closest("msg-button")}(e)){var n=e.currentTarget,o=e.clientX,r=e.clientY,a=n.offsetLeft,i=n.offsetTop,s=n.offsetWidth,u=n.offsetHeight,c=window.innerWidth-s,p=window.innerHeight-u,l=function(e){e.stopPropagation(),e.preventDefault(),t.setState({dragging:!0});var n=Tn((a+e.clientX-o)/c,0,1),s=Tn((i+e.clientY-r)/p,0,1);t.setState({coords:{x:n,y:s}})};t._stopDrag=function(){t.setState({dragging:!1}),document.removeEventListener("mouseup",t._stopDrag),document.removeEventListener("mousemove",l),t._stopDrag=null},document.addEventListener("mousemove",l),document.addEventListener("mouseup",t._stopDrag)}}function Lkt(t){var e=t.state.coords,n=t.refs.player,o=t.refs.wrap;if(n&&e){var r=(window.innerWidth-o.offsetWidth)*e.x,a=(window.innerHeight-o.offsetHeight)*e.y,i=window.innerHeight-o.offsetHeight-(window.innerHeight-o.offsetHeight)*e.y;n.style.left="".concat(r,"px"),i+o.offsetHeight>=.66*window.innerHeight?(n.style.top="".concat(a,"px"),n.style.bottom=""):(n.style.top="",n.style.bottom="".concat(i,"px"))}}function Okt(t,e){var n=function(t){return L(t,"player")}(e);switch(t){case xkt.prev:return n.playPrevAttach();case xkt.next:return n.playNextAttach();case xkt.toggle:return n.togglePlay();case xkt.playbackSpeed:return n.togglePlaybackSpeed();case xkt.float:return n.floatingMode(!0);case xkt.pin:return n.floatingMode(!1);case xkt.reset:return n.reset()}}!function(t){t.prev="prev",t.next="next",t.toggle="toggle",t.playbackSpeed="playbackSpeed",t.float="float",t.pin="pin",t.reset="reset"}(xkt||(xkt={}));var zkt="e-4s3qs6";function Dkt(t,e){e.player=t.store.data.audioPlayer,e.msg="FORWARD"===n.get(e.player,"message","link","type")?n.get(e.player,"message","link","message"):n.get(e.player,"message"),e.playingAttach=n.find(n.get(e.msg,"attaches"),(function(t){return"INLINE_KEYBOARD"!==n.get(t,"_type")})),e.chat=n.get(t.store.data.chats,n.get(e.playingAttach,"chatId")),e.isVoiceMessage="AUDIO"===n.get(e.playingAttach,"_type"),e.preview=e.isVoiceMessage?$t(0,n.get(e.msg,"sender","baseUrl")||n.get(e.chat,"fullIconUrl"),128):$t(0,n.get(e.playingAttach,"baseUrl"),128)||n.get(e.playingAttach,"preview","imageUrl")||n.get(e.playingAttach,"imageUrl"),e.title=e.isVoiceMessage?n.get(e.msg,"sender","name"):n.get(e.playingAttach,"preview","title")||n.get(e.playingAttach,"title"),e.subtitle=n.get(e.playingAttach,"preview","artistName")||n.get(e.playingAttach,"artistName")||n.get(e.playingAttach,"name"),e.musicInfo=!e.isVoiceMessage&&e.subtitle,e.loading=n.get(e.player,"loading"),e.paused=n.get(e.player,"paused"),e.progress=t.state.seekPos||n.get(e.player,"progress")||0,e.duration=n.get(e.player,"duration"),e.currentTime=t.state.seekPos?t.state.seekPos*e.duration:n.get(e.player,"currentTime"),e.offsetLeft=100*e.progress}function Ukt(t,e,o,r){e.class="previous-okmsg"+(n.get(r.player,"hasPrev")?"":" __disabled-okmsg")}function Nkt(t,e,n){Okt("prev",t)}function qkt(t,e,o,r){n.updateClass(t,e,"cover-okmsg"+(r.preview?" __bg-okmsg":"")),n.updateAttribute(t,e,"style","background-image: url("+r.preview+")")}function Hkt(t,e,o){!o._w&&function(t,e,o){var r=o._w=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{spin:!0,indeterminate:!0,class:"play-okmsg",size:"16",radius:"6"}))}(t,e,o),n.animate(o._w,n.createAnimation("global:msg-pop-in 0.1s",zkt))}function Fkt(t,e){return e.loading?Hkt:null}function Vkt(t,e,n){Okt("toggle",t)}function Kkt(t,e,n,o){e.icon=o.paused?"play":"pause"}function Wkt(t,e){var o=e._17,r=e._18;Kkt(0,r,0,e),n.updateComponent(o,r)}function Gkt(t,e,o){return o._14?Wkt(0,o):function(t,e,o){var r=o._14=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._16=n.addEvent(r,"click",Vkt,t,o);var i=o._17=n.insert(a,n.createComponent("msg-icon",xe,t),""),s=o._18=n.propsSet(i);Kkt(0,s,0,o),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"play-okmsg"}))}(t,e,o),n.animate(o._14,n.createAnimation("global:msg-pop-in 0.1s",zkt)),Ykt}function Ykt(t,e){Wkt(0,e)}function Xkt(t,e){return e.loading?null:Gkt}function Qkt(t,e,o,r){e.class="next-okmsg"+(n.get(r.player,"hasNext")?"":" __disabled-okmsg")}function Jkt(t,e,n){Okt("next",t)}function $kt(t,e,o,r){e.date=n.get(r.msg,"time")}function Zkt(t,e,o){var r=o._1q=n.insert(e,n.createComponent("msg-relative-date",Kb,t)),a=o._1r=n.propsSet(r);return $kt(0,a,0,o),n.mountComponent(r,a),tbt}function tbt(t,e){var o=e._1q,r=e._1r;$kt(0,r,0,e),n.updateComponent(o,r)}function ebt(t,e){return e.isVoiceMessage?Zkt:null}function nbt(t,e,o){return o._1w=n.insert(e,n.text(o.subtitle)),obt}function obt(t,e){n.updateText(e._1w,e.subtitle)}function rbt(t,e){return e.musicInfo?nbt:null}function abt(t,e,o){var r=n.insert(e,n.elem("div",zkt)),a=n.createInjector(r);return n.setClass(r,"subtitle-okmsg"),o._1n=n.mountBlock(t,a,ebt),o._1t=n.mountBlock(t,a,rbt),ibt}function ibt(t,e){n.updateBlock(e._1n),n.updateBlock(e._1t)}function sbt(t,e){return e.isVoiceMessage||e.musicInfo?abt:null}function ubt(t,e,n){Okt("playbackSpeed",t)}function cbt(t,e){return n.get(e.player,"playbackSpeed")}function pbt(t,e,o){var r=o._22=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;return o._24=n.addEvent(r,"click",ubt,t,o),o._25=n.mountInnerHTML(t,a,cbt),n.insert(a,n.text("x\n            ")),n.mountComponent(r,n.propsSet(r,{shape:"circle"})),lbt}function lbt(t,e){n.updateInnerHTML(e._25)}function mbt(t,e){return e.isVoiceMessage?pbt:null}function dbt(t,e,n){Okt("float",t)}function _bt(t,e,o){var r=o._2c=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._2e=n.addEvent(r,"click",dbt,t,o);var i=o._2f=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"picture-in-picture"})),n.mountComponent(r,n.propsSet(r,{shape:"circle"}))}function fbt(t){return t.store.data.isMobile?null:_bt}function gbt(t,e,o){var r=o._2l=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._2n=n.addEvent(r,"click",Pkt,t,o);var i=o._2o=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"to-message"})),n.mountComponent(r,n.propsSet(r,{shape:"circle"}))}function vbt(t){return t.props.disableGoToMessage?null:gbt}function hbt(t,e,n){Okt("reset",t)}function Cbt(t,e){t.setState({active:!0})}function kbt(t,e){t.setState({active:!1})}function bbt(t,e,o,r){n.updateAttribute(t,e,"style","left:"+r.offsetLeft+"%;")}function ybt(t,e){t.setState({tooltip:!0})}function Sbt(t,e){t.setState({tooltip:!1})}function wbt(t,e){bbt(e._37,e._38,0,e)}function Ebt(t,e,o){return o._37?wbt(0,o):function(t,e,o){var r=o._37=n.insert(e,n.elem("div",zkt)),a=o._38=n.obj();n.setClass(r,"draggable-point-okmsg"),bbt(r,a,0,o),o._39=n.addEvent(r,"mouseenter",ybt,t,o),o._3a=n.addEvent(r,"mouseleave",Sbt,t,o);var i=n.appendChild(r,n.elem("div",zkt));n.setClass(i,"point-okmsg")}(t,e,o),n.animate(o._37,n.createAnimation("global:msg-fade-in 0.3s",zkt)),xbt}function xbt(t,e){wbt(0,e)}function Ibt(t){return t.state.active?Ebt:null}function Bbt(t,e,o,r){n.updateAttribute(t,e,"style","width:"+r.offsetLeft+"%")}function Mbt(t,e,o,r){n.updateAttribute(t,e,"style","left:"+r.offsetLeft+"%;")}function Abt(t,e,n,o){e.duration=Ht(n,1e3*o.currentTime,0)}function Tbt(t,e,n,o){e.duration=1e3*o.duration}function jbt(t,e){var o=e._3m,r=e._3n,a=e._3p,i=e._3q;Mbt(e._3k,e._3l,0,e),Abt(0,r,t,e),n.updateComponent(o,r),Tbt(0,i,0,e),n.updateComponent(a,i)}function Pbt(t,e,o){return o._3k?jbt(t,o):function(t,e,o){var r=o._3k=n.insert(e,n.elem("div",zkt)),a=o._3l=n.obj();n.setClass(r,"tooltip-okmsg"),Mbt(r,a,0,o);var i=o._3m=n.appendChild(r,n.createComponent("msg-duration",qi,t)),s=o._3n=n.propsSet(i);Abt(0,s,t,o),n.mountComponent(i,s),n.appendChild(r,n.text(" /\n            "));var u=o._3p=n.appendChild(r,n.createComponent("msg-duration",qi,t)),c=o._3q=n.propsSet(u,{class:"total-okmsg"});Tbt(0,c,0,o),n.mountComponent(u,c)}(t,e,o),n.animate(o._3k,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",zkt)),Rbt}function Rbt(t,e){jbt(t,e)}function Lbt(t){return t.state.tooltip?Pbt:null}function Obt(t,e){var o=t.componentView;Dkt(t,e);var r=n.appendChild(o,n.elem("div",zkt));n.setClass(r,"container-okmsg");var a=n.appendChild(r,n.elem("div",zkt));n.setClass(a,"player-controls-okmsg");var i=e._j=n.appendChild(a,n.createComponent("msg-button",fe,t)),s=i.componentModel.input,u=e._k=n.propsSet(i,{shape:"circle"});Ukt(0,u,0,e),e._l=n.addEvent(i,"click",Nkt,t,e);var c=e._m=n.insert(s,n.createComponent("msg-icon",xe,t),"");n.mountComponent(c,n.propsSet(c,{icon:"previous"})),n.mountComponent(i,u);var p=e._p=n.appendChild(a,n.elem("div",zkt)),l=n.createInjector(p);qkt(p,e._q=n.obj(),0,e),e._r=n.mountBlock(t,l,Fkt),e._z=n.mountBlock(t,l,Xkt);var m=e._1a=n.appendChild(a,n.createComponent("msg-button",fe,t)),d=m.componentModel.input,_=e._1b=n.propsSet(m,{shape:"circle"});Qkt(0,_,0,e),e._1c=n.addEvent(m,"click",Jkt,t,e);var f=e._1d=n.insert(d,n.createComponent("msg-icon",xe,t),"");n.mountComponent(f,n.propsSet(f,{icon:"next"})),n.mountComponent(m,_);var g=n.appendChild(r,n.elem("div",zkt)),v=n.createInjector(g);n.setClass(g,"info-okmsg");var h=n.insert(v,n.elem("div",zkt));n.setClass(h,"title-okmsg"),e._1i=n.appendChild(h,n.text(e.title||n.get(e.chat,"title"))),e._1j=n.mountBlock(t,v,sbt);var C=n.appendChild(r,n.elem("div",zkt)),k=n.createInjector(C);n.setClass(C,"more-okmsg"),e._1z=n.mountBlock(t,k,mbt),e._29=n.mountBlock(t,k,fbt),e._2i=n.mountBlock(t,k,vbt);var b=e._2r=n.insert(k,n.createComponent("msg-button",fe,t)),y=b.componentModel.input;e._2t=n.addEvent(b,"click",hbt,t,e);var S=e._2u=n.insert(y,n.createComponent("msg-icon",xe,t),"");n.mountComponent(S,n.propsSet(S,{icon:"close"})),n.mountComponent(b,n.propsSet(b,{shape:"circle"}));var w=n.appendChild(o,n.elem("div",zkt)),E=n.createInjector(w);n.setClass(w,"offset-okmsg"),e._2y=n.addEvent(w,"mouseenter",Cbt,t,e),e._2z=n.addEvent(w,"mouseleave",kbt,t,e),e._30=n.addEvent(w,"mousedown",jkt,t,e);var x=n.insert(E,n.elem("div",zkt)),I=n.createInjector(x);n.setRef(t,"progress",x),n.setClass(x,"audio-progress-okmsg"),e._32=n.mountBlock(t,I,Ibt);var B=e._3d=n.insert(I,n.elem("div",zkt)),M=e._3e=n.obj();return n.setClass(B,"bar-okmsg"),Bbt(B,M,0,e),e._3f=n.mountBlock(t,E,Lbt),n.subscribeStore(t,["audioPlayer","chats","isMobile"]),zbt}function zbt(t,e){var o=e._j,r=e._k,a=e._1a,i=e._1b;Dkt(t,e),Ukt(0,r,0,e),n.updateComponent(o,r),qkt(e._p,e._q,0,e),n.updateBlock(e._r),n.updateBlock(e._z),Qkt(0,i,0,e),n.updateComponent(a,i),n.updateText(e._1i,e.title||n.get(e.chat,"title")),n.updateBlock(e._1j),n.updateBlock(e._1z),n.updateBlock(e._29),n.updateBlock(e._2i),n.updateBlock(e._32),Bbt(e._3d,e._3e,0,e),n.updateBlock(e._3f)}Hkt.dispose=function(t,e){n.animate(t._w,n.createAnimation("global:msg-pop-out 0.1s",zkt),(function(){return function(t){var e=t._w;t._w=n.unmountComponent(e),n.domRemove(e)}(t)}))},Gkt.dispose=function(t,e){n.animate(t._14,n.createAnimation("global:msg-pop-out 0.1s",zkt),(function(){return function(t){var e=t._14;t._16=n.removeEvent("click",t._16),t._17=n.unmountComponent(t._17),t._14=n.unmountComponent(e),n.domRemove(e),t._18=null}(t)}))},Zkt.dispose=function(t){t._1q=n.unmountComponent(t._1q),t._1r=null},nbt.dispose=function(t){t._1w=null},abt.dispose=function(t){t._1n=n.unmountBlock(t._1n),t._1t=n.unmountBlock(t._1t)},pbt.dispose=function(t){t._24=n.removeEvent("click",t._24),t._25=n.unmountInnerHTML(t._25),t._22=n.unmountComponent(t._22)},_bt.dispose=function(t){t._2e=n.removeEvent("click",t._2e),t._2f=n.unmountComponent(t._2f),t._2c=n.unmountComponent(t._2c)},gbt.dispose=function(t){t._2n=n.removeEvent("click",t._2n),t._2o=n.unmountComponent(t._2o),t._2l=n.unmountComponent(t._2l)},Ebt.dispose=function(t,e){n.animate(t._37,n.createAnimation("global:msg-fade-out 0.3s",zkt),(function(){return function(t){t._39=n.removeEvent("mouseenter",t._39),t._3a=n.removeEvent("mouseleave",t._3a),t._37=n.domRemove(t._37),t._38=null}(t)}))},Pbt.dispose=function(t,e){n.animate(t._3k,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",zkt),(function(){return function(t){t._3m=n.unmountComponent(t._3m),t._3p=n.unmountComponent(t._3p),t._3k=n.domRemove(t._3k),t._3l=t._3n=t._3q=null}(t)}))},Obt.dispose=function(t){t._l=n.removeEvent("click",t._l),t._m=n.unmountComponent(t._m),t._j=n.unmountComponent(t._j),t._r=n.unmountBlock(t._r),t._z=n.unmountBlock(t._z),t._1c=n.removeEvent("click",t._1c),t._1d=n.unmountComponent(t._1d),t._1a=n.unmountComponent(t._1a),t._1j=n.unmountBlock(t._1j),t._1z=n.unmountBlock(t._1z),t._29=n.unmountBlock(t._29),t._2i=n.unmountBlock(t._2i),t._2t=n.removeEvent("click",t._2t),t._2u=n.unmountComponent(t._2u),t._2r=n.unmountComponent(t._2r),t._2y=n.removeEvent("mouseenter",t._2y),t._2z=n.removeEvent("mouseleave",t._2z),t._30=n.removeEvent("mousedown",t._30),t._32=n.unmountBlock(t._32),t._3f=n.unmountBlock(t._3f)};var Dbt={__proto__:null,cssScope:zkt,default:Obt,state:Bkt,plugins:Mkt,didRender:Akt,willUnmount:Tkt,handleSeek:jkt,goToMessage:Pkt,onDragStart:Rkt,syncUIPos:Lkt,runPlayerAction:Okt};function Ubt(){var t=!1;return window.matchMedia&&(t=window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches),!t&&window.devicePixelRatio&&(t=window.devicePixelRatio>1.3),t}var Nbt={};function qbt(t,e){var n=t.props.chat,o=t.state.additional;if(null==o?void 0:o.helloStickers){var r=t.store.get().config,a=Nbt[n.id]=!o.helloStickers.hidden;a&&e&&r.server["hide-hello"]&&function(t,e){var n=t.props.chat.id,o=t.store.app;o.config.setHelloClosed(n,e)}(t,o.helloStickers.mode),Wbt(t,{hidden:a}),Gbt(t,a?"hide":"open")}}function Hbt(t){var e=t.state.additional;e&&e.redLink&&(!function(t,e){var o=t.state.additional;t.setState({additional:n.__assign(n.__assign({},o),{redLink:n.__assign(n.__assign({},o.redLink),e)})})}(t,{hidden:!0}),o.invoke("messages/redlink/close",{bannerId:e.redLink.bannerId}))}function Fbt(t){var e=t.props.chat.id,r=t.state.additional.helloStickers;r.loading||(Gbt(t,"reload"),Vbt(t),Wbt(t,{loading:!0}),o.invoke("stickers/hello",{chatid:e,mode:r.mode,page:r.page||0}).then((function(o){t.props.chat.id===e&&Wbt(t,n.__assign({loading:!1},o))})).catch((function(e){Wbt(t,{loading:!1}),console.warn(e)})))}function Vbt(t){var e,n,o=t.store.app,r=null===(n=null===(e=t.state.additional)||void 0===e?void 0:e.helloStickers)||void 0===n?void 0:n.mode;o.config.resetIgnoredHelloViews(r)}function Kbt(t,e){return t.setState({loadingAdditional:!0}),function(t,e,r){void 0===r&&(r={});return o.invoke("messages/conv/additional",n.__assign({chatid:e,hidpi:Ubt()},r)).then((function(e){return(e=n.__assign({},e)).alert&&e.alert.friendIds?t.root.props.app.contacts.fetch(e.alert.friendIds).then((function(t){return e.alert.common=t,e})):e}))}(t,e).then((function(o){if(e===t.props.chat.id){if(function(t,e){e.helloStickers?Zt(t,"log-action","HELLO_STICKERS"):e.redLink&&Zt(t,"log-action","RED_LINK")}(t,o),o.helloStickers){var r=o.helloStickers.mode,a=t.store.get().config,i=a.server["disable-hello"],s=a.server["hide-hello"],u=i||(s?function(t,e){var n=t.props.chat.id;return t.store.app.config.isHelloClosed(n,e)}(t,r):Nbt[e]);u?o=n.__assign(n.__assign({},o),{helloStickers:null}):(Gbt(t,"view"),s&&function(t,e){t.store.app.config.incrementIgnoredHelloViews(e)}(t,r))}t.setState({loadingAdditional:!1,additional:o})}return o})).catch((function(e){return t.setState({loadingAdditional:!1,additional:null}),console.warn(e),Promise.reject(e)}))}function Wbt(t,e){var o=t.state.additional;t.setState({additional:n.__assign(n.__assign({},o),{helloStickers:n.__assign(n.__assign({},o.helloStickers),e)})})}function Gbt(t,e){var n;"undefined"!=typeof OK&&(null===(n=OK.logger)||void 0===n||n.success("messagesLayer","hello-stickers","".concat(e,"_q").concat(o.getCurrentUserQuarter(t))))}var Ybt=!1,Xbt=["NOT_FRIEND_WARNING","NOT_FRIEND_COMMON_MY"],Qbt={highlightMessage:function(t,e,n){var o=this;n||(n=this.props.chat.id),Zt(this,"check-message-exists",{chatId:n,messageId:e,callbackFn:function(t,e){e&&"REMOVED"===e.status?Zt(o,"show-toast",V("message-quote-removed")):$p(t,{messagesTime:e.time})}})},isSearchOpened:function(){return!!this.state.search},openSearch:function(){var t=this.props.chat.id,e=this.refs.searchTrigger;this.setState({search:br(e)?2:1}),Zt(this,"chat-search-touch",{chatId:t})},closeSearch:function(){var t=this.state.search;if(t){if(this.setState({search:0}),2===t){var e=this.refs.searchTrigger;if(e)return void e.focus()}yyt(this)}},toggleSearch:function(){this.isSearchOpened()?vyt(this):(Jbt(this),this.openSearch())},cancelActiveModal:function(){var t=this.props.chat;if(HS(t)){var e=L(this,"chat");return new Promise((function(n){e.resetPostingForward(t.id,n)}))}return Promise.resolve(!0)},focusPostingForm:function(){var t=this.refs.postingForm;return!!t&&(t.focus(),!0)}};function Jbt(t){jyt(t),t.setState({asideContent:[],asideContentData:null})}var $bt=["get-file-url","message-search-more","reply-message","edit-message","pin-message","unpin-message","reset-selected-messages","hide-pinned-message","set-media-tab","clean-removed-message","copy-messages","remove-messages","forward-init","forward-reset","forward-commit","forward-comment","forward-select-chat","forward-unselect-chat","report-chat","message-react","bot-command","bot-start","send-location","hide-alert-bar","unblock-user"].reduce((function(t,e){return t[e]=gyt,t}),{}),Zbt=n.__assign(n.__assign({},$bt),{click:function(t,e){!function(t,e){if(function(t,e){var n=e.target;if(!n.closest(".cnt")&&!n.closest("msg-message-controls")&&n.closest("msg-message-list")){var o=t.refs.movieBg;if(o){var r=o.refs.frame.getBoundingClientRect(),a=r.top,i=r.bottom,s=r.left,u=r.right,c=e.x,p=e.y;return c>=s&&c<=u&&p>=a&&p<=i}}return!1}(t,e)){var n=t.refs.movieBg;n&&(OK.logger.success("messagesLayer","backgroundTV","click-in-tv"),n.turnOnOff())}}(t,e)},"message-search-select-result":function(t,e){vyt(t),t.highlightMessage(e.detail.message.time,e.detail.message.id)},"highlight-message":function(t,e){e.stopPropagation(),t.highlightMessage(e.detail.messageTime,e.detail.messageId,e.detail.chatId)},"highlight-message-end":function(t,e){e.stopPropagation(),Zt(t,"reset-focused-message",t.props.chat.id)},"open-chat-read-participants":function(t,e){if(e.target!==t){e.stopPropagation();var n=t.props.chat,o=t.store.get().config;Zt(t,"open-chat-read-participants",o.server["react-permission"]?{chatId:n.id,messageId:e.detail.messageId}:{participants:e.detail.participants,total:n.participants})}},"hide-search":function(t,e){e.stopPropagation(),vyt(t)},"select-message":function(t,e){if(e.target!==t)if(e.detail.group){var n=t.props.chat,o=kyt(n,t.state._lastSelected,e.detail.messageId);o.forEach((function(e){Zt(t,"select-message",{messageId:e,chatId:n.id})})),hyt(t,o[o.length-1])}else gyt(t,e),hyt(t,e.detail.messageId)},"unselect-message":function(t,e){if(e.target!==t)if(e.detail.group){var n=t.props.chat,o=kyt(n,t.state._lastUnselected,e.detail.messageId);o.forEach((function(e){return Zt(t,"unselect-message",{messageId:e,chatId:n.id})})),Cyt(t,o[o.length-1])}else gyt(t,e),Cyt(t,e.detail.messageId)},"pick-sticker":function(t,e){e.stopPropagation();var n=t.props.chat,o="DIALOG"===n.type?n.participants.find((function(t){return!t.user.current})).user:null,r=e.detail,a=r.sticker,i=r.stickerOrigin,s=a.width&&a.height?"".concat(a.width,":").concat(a.height,"#"):"";Zt(t,"send-sticker",Gv(t,{stickerId:a.id,height:a.height||192,width:a.width,friendId:o&&o.id,stickerHash:"#".concat(a.id.toString(16),"#").concat(s),source:"DIALOG"===n.type?"messages":"multichat",stickerOrigin:i}))},"open-conv-icon-layer":function(t,e){var n=function(t){var e;if("DIALOG"===t.type){var n=(t.participants&&t.participants.find((function(t){return!t.user.current}))).user;if(void 0===n&&(n={}),n.photoId)return n.photoId;e=Zn(n.fullAvatarUrl)}else e=Zn(t.iconUrl||t.fullIconUrl);return e.search.slice(1).split("&").reduce((function(t,e){var n=e.split("="),o=n[0],r=n[1];return t[o]=r,t}),{}).id}(t.props.chat);e.detail.chatId=t.props.chat.id,e.detail.photoId=n,t.store.get().config.server["propagate-photo-event"]&&(e.detail.openOnWeb=!0)},drop:function(t,e){byt(t);var n=e.target;if(n.closest(".js-dnd-overlay")){var o=n.dataset.attachType||"guess",r=e.dataTransfer.files,a=t.refs.postingForm;if(a&&r&&r.length){for(var i=[],s=0;s<r.length;s++)i.push(r[s]);a.attachFiles(i,o),Zt(t,"dnd-files",{files:i,attachType:o})}}},"runtime-error":function(t,e){var n=t.props.chat;e.detail&&n&&(e.detail.chatId=n.id)},"commit-posting-message":Pyt,"run-message-action":function(t,e){if(t.setState({messageControls:null}),"reply"===e.detail.action&&yyt(t),"forward"===e.detail.action){e.preventDefault(),e.stopPropagation(),t.setState({forward:{type:"MESSAGES"}});var n=L(t,"chat"),o=t.props.chat,r=e.detail.messageId;n.selectMessage(o.id,r),hyt(t,r)}else gyt(t,e)},"open-congrats-menu":function(t,e){var n=t.refs.postingForm;n&&n.showCongrats(e.detail.tab)},"recording-video-stop":function(t){return myt(t)},"toggle-aside-content":function(t,e){var o,r=e.detail.tabName,a=n.__assign(n.__assign({},t.state.asideContentData||{}),((o={})[r]=e.detail.tabData,o));t.setState({asideContentData:a}),pyt(r,t,null,null)},"background-update":function(t,e){_yt(t,!1);var n=e.detail;(null==n?void 0:n.removeAll)?Jbt(t):t.setState({asideContent:Syt(t.state.asideContent)})},"background-select":function(t,e){var n=e.detail;t.setState({background:n})},"hide-aside":function(t){uyt(t)},"add-friend":function(t,e){if(t.store.get().config.server["add-friend-chat-info"]){var n=t.props.chat.id;setTimeout((function(){return Kbt(t,n)}),300)}},"report-user":function(t,e){var n;(null===(n=e.detail)||void 0===n?void 0:n.hideAlertImportant)&&Tyt(t,!0)},"hide-alert-bar-important":function(t,e){gyt(t,e),Tyt(t,!0)},"remove-admin":function(t,e){var n=t.props.chat,o=n.id,r=e.detail.userId,a=n.admins.find((function(t){return t.user.id===r}));if(a){var i=a.user;L(t,"confirm").show({header:V("remove-admin-confirm-header",{type:n.type}),body:V("remove-admin-confirm-body",{user:i.name,gender:i.gender}),buttons:[{label:V("remove-participant-confirm-button"),action:function(){t.store.app.participants.removeAdmin(o,r),e.detail.hideAside&&te(t,"hide-aside")}},V("confirm-cancel-button")]})}else te(t,"hide-aside")},"log-admins":function(t,e){var n=t.state.addedAdminsCount,o=void 0===n?0:n,r=e.detail.source;t.setState({addedAdminsCount:o+1,addedAdminsSource:r})},"message-dblclick":function(t,e){if(!t.store.get().isTouchDevice){var n=e.detail.message,o=n.id||n.cid;t.store.app.chat.replyMessage(n.chatId,o.toString()),yyt(t)}},"tv-toggle":function(t,e){t.setState({tvOff:e.detail})},"tv-enable":function(t){tyt(!0,t)},"attachment-click":function(t,e){if(t.store.isMobile()){var n=e.detail;L(t,"showMedia").showChatMedia(n.chatId,"mixed",n)}},"message-controls":function(t,e){t.setState({messageControls:e.detail.message})},"change-chat-icon":function(t,e){var n=e.detail,o=n.file,r=n.chatId;if(o&&r){var a=L(t,"chat");Zt(t,"preview-photo",{file:o,options:{crop:{square:!0},horizontalFlip:!0,rotate:!0,actionRequired:!0,action:function(t){return a.setIcon(r,t.file)}}})}}});function tyt(t,e){wi(e,"TV",{enabled:t,clicked:!0}),OK.logger.success("messagesLayer","backgroundTV",t?"enable":"disable"),e.setState({tvBackgroundEnabled:t,tvSilent:!0,tvOff:!1})}function eyt(t,e){e.stopImmediatePropagation(),t.refs.movieBg.turnOnOff()}function nyt(t,e){e.stopPropagation(),t.refs.movieBg.toggleFullscreen()}function oyt(t,e){e.stopPropagation(),t.refs.movieBg.toggleSound(!t.state.tvSilent),t.setState({tvSilent:!t.state.tvSilent})}var ryt=function(t){var e=Math.max(t.offsetWidth,t.offsetHeight);t.setState({width:e,height:e})},ayt=[NS(ryt)];function iyt(t){Zt(t,"reset-posting-link",Gv(t))}function syt(t,e){var n;qbt(t),Vbt(t),Gbt(t,"send_".concat(null===(n=null==e?void 0:e.detail)||void 0===n?void 0:n.type))}function uyt(t){var e=t.state.asideContent;if(e.includes("backgrounds")&&_yt(t,!1),"settings"===wyt(e)){var n=t.querySelector("msg-chat-settings");null==n||n.onClose()}"add-admins"===wyt(e=Syt(e))&&(e=Syt(e)),0===e.length&&jyt(t),t.setState({asideContent:e})}function cyt(t,e){var n=e.props.chat,o={isVideo:"VIDEO"===t};"DIALOG"===n.type?o.friendId=n.participants.find((function(t){return!t.user.current})).user.id:o.chatId=Math.abs(n.id),Zt(e,"log-action",{name:"ACTION_CALL_UI_CLICK",value:"PROFILE_".concat(t.toUpperCase())}),Zt(e,"open-video-call-layer",o)}function pyt(t,e,o,r){if(!r||!r.disabled){var a=n.__spreadArray([],e.state.asideContent,!0),i=a.length&&a[0]===t,s=["info","participants"].includes(t);if((i||s)&&(jyt(e),a=[]),i||a.push(t),["info","backgrounds"].includes(t)&&e.state.editableBgEnabled){_yt(e,!1);var u=e.store.get().config;u.server["new-year-backgrounds"]&&"backgrounds"!==t&&Zt(e,"update-user-settings",{name:"HIDDEN_BUBBLES",value:(u.user.HIDDEN_BUBBLES||[]).concat("BACKGROUNDS_NEW_YEAR_UPPER_BUBBLE")})}vyt(e),e.setState({asideContent:a}),Zt(e,"info-active",!!a.length)}}function lyt(t,e){var n=e.detail;if(n){var o=t.props.chat;t.store.app.chat.sendVideoMessage(o.id,n)}myt(t)}function myt(t){t.setState({recordVideo:!1})}function dyt(t){var e=t.refs.messageList;e&&e.retainScrollPos()}function _yt(t,e){var n;if(YU()){var o=function(t,e){return HU(t,e)||FU(t)}(t,t.props.chat.id);e&&(n=o?o.id:null,JU("load-".concat(n||"empty"))),t.setState({background:o,editableBgEnabled:!0})}else t.setState({background:null,editableBgEnabled:!1})}function fyt(t){vyt(t)}function gyt(t,e){e.detail&&!e.detail.chatId&&(e.detail.chatId=t.props.chat.id)}function vyt(t){t.closeSearch(),Zt(t,"message-search-reset",{chatId:t.props.chat.id})}function hyt(t,e){var n=t.state;n._lastSelected=e,n._lastUnselected=null}function Cyt(t,e){var n=t.state;n._lastUnselected=e,n._lastSelected=null}function kyt(t,e,n){if(!t||!t.messages||!t.messages.size)return[];var o=p(t.messages),r=Array.from(t.messages.keys()),a=o.find((function(t){return t.id===e})),i=o.find((function(t){return t.id===n}));if(!a||!i)return[];var s=r.indexOf(a.uid),u=r.indexOf(i.uid);return r.slice(Math.min(s,u),Math.max(s,u)+1).map((function(e){var n=t.messages.get(e);return CL(n)?null:n.id})).filter(Boolean)}function byt(t){t.setState({dnd:null}),t.state._dndStack=0}function yyt(t){requestAnimationFrame((function(){return t.focusPostingForm()}))}function Syt(t){void 0===t&&(t=[]);var e=n.__spreadArray([],t,!0);return e.length?(e.pop(),e):e}function wyt(t){return void 0===t&&(t=[]),t.length?t[t.length-1]:null}function Eyt(t){return function(e){var n,o,r=t.state;if("dragenter"===e.type){var a=e.dataTransfer,i=a.items,s=a.types;if(s&&(s.includes("text/plain")||s.includes("text/html")))return;r._dndStack++;for(var u=!i.length,c=0;c<i.length;c++)if(!["PHOTO","VIDEO"].includes((n=i[c],o=void 0,o=n.type||"",/^image\//.test(o)&&!/svg/.test(o)?"PHOTO":/^video\//.test(o)?"VIDEO":/^audio\/m4a/.test(o)?"AUDIO":!o&&/\.(dv|rm|dat|wm|qt|divx|m2v|ogm|avi|vob|mpg|mpe|mpeg|m2p|mp4|mov|3gp|asf|wmv|flv|m4v|m2ts|mts|3g2|evo|f4v|mkv|mcf|ts|mxf|ogg|rmvb|webm|vcd|svcd|3gpp|m4a|torrent)$/.test(n.name)?"VIDEO":"FILE"))){u=!0;break}!function(t,e){(0,t.setState)({dnd:e})}(t,u?"FILES":"MEDIA")}else"dragleave"===e.type&&(r._dndStack--,r._dndStack||byt(t))}}function xyt(t){var e=t.current,n=t.prev;if(xm(e,"id")!==xm(n,"id"))return!0;if(xm(e,"posting.link.id")!==xm(n,"posting.link.id"))return!0;var o=xm(e,"posting.type"),r=xm(n,"posting.type");return o!==r&&(!!r||"NEW"!==o)}function Iyt(t,e){var n=t.props.chat,o=t.state.forward,r=e.detail.chatIds,a=1===r.length,i=n.selectedMessages;r&&r.length&&o&&i&&i.length&&t.store.app.chat.commitForward(n.id,{chatId:n.id,targetChatIds:r,messageIds:i.map((function(t){return t.id})),text:e.detail.text,type:o.type}).then((function(){var e=L(t,"toast");if(a){if("MESSAGES"===o.type||"CHANNEL"===o.type){var n=t.store.get().chats.get(r[0]);n&&$p(n.id,{messagesTime:n.lastMessage.time,useBack:!0})}}else if("MESSAGES"===o.type){var s=i.length;e.show(V("forward-messages-commit",{count:s,countPlural:s}))}else"CHANNEL"===o.type&&e.show(V("forward-share-commit"))})),Ayt(t)}function Byt(t){var e=t.state,n=e.asideContent,o=e.forward;(null==n?void 0:n.length)?Jbt(t):o?Ayt(t):tl()}function Myt(t,e){e.detail.editor.model.length&&Pyt(t)}function Ayt(t){var e=t.props.chat;L(t,"chat").resetSelectedMessages(e.id)}function Tyt(t,e){t.setState({hideAlertBarImportantClicked:e})}function jyt(t){var e=t.state,n=e.addedAdminsCount,o=e.addedAdminsSource;n&&(n>10&&(n=11),o||(o="unknown"),OK.logger.success("messagesLayer","admins-added_".concat(o),n),t.setState({addedAdminsCount:0,addedAdminsSource:null}))}function Pyt(t){var e=t.props.chat,n=t.state.additional;n&&!xm(n,"helloStickers.hidden")&&qbt(t);var o=t.store.get().config,r=null==n?void 0:n.alert;o.server["redesign-alert"]&&!e.hideAlertImportant&&r&&Xbt.indexOf(r.type)>-1&&(Zt(t,"hide-alert-bar-important",{chatId:e.id}),Tyt(t,!0))}var Ryt="e-v2oxuh",Lyt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Oyt=[];function zyt(){Oyt.push(Lyt),Lyt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function Dyt(){Lyt=Oyt.pop()}function Uyt(t,e){e.isChannel="CHANNEL"===n.get(t.props.chat,"type"),e.isGroupchat="GROUP_CHAT"===n.get(t.props.chat,"type"),e.adminEntry=n.find(n.get(t.props.chat,"admins"),(function(t){return n.get(t,"user","current")})),e.permissions=n.get(e.adminEntry,"permissions"),e.isParticipant=n.find(n.get(t.props.chat,"participants"),(function(t){return n.get(t,"user","current")})),e.isBot="DIALOG"===n.get(t.props.chat,"type")&&n.get(t.props.chat,"hasBots"),e.isService=n.get(t.props.chat,"options","SERVICE_CHAT"),e.botSuspended=e.isBot&&(n.get(t.props.chat,"isSuspended")||!Tt(0,n.get(t.props.chat,"messages"))),e.postingAllowAdmin=e.isChannel&&n.get(e.permissions,"manageMessages"),e.groupModerator=e.isGroupchat&&n.get(t.props.chat,"groupChatInfo","isModerator"),e.postingAllowParticipant=!e.isChannel&&e.isParticipant,e.isPostingEnabled="ACTIVE"===n.get(t.props.chat,"status")&&(e.postingAllowParticipant||e.postingAllowAdmin||e.groupModerator)&&!e.botSuspended,e.contact=n.get(n.find(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})),"user"),e.emptyChat=1===n.get(t.props.chat,"participantsCount"),e.narrowForward=t.state.forward&&n.get(t.store.data.config,"server","narrow-forward"),e.alert=n.get(t.state.additional,"alert"),e.showAlert=e.alert&&!n.get(t.props.chat,"hideAlert")&&(!n.get(e.alert,"pending")||n.get(t.store.data.config,"server","redesign-alert"))&&"DIALOG"===n.get(t.props.chat,"type"),e.showAlertBottom=e.showAlert&&n.get(t.store.data.config,"server","redesign-alert")&&!n.get(t.props.chat,"hideAlertImportant")&&jt(0,["NOT_FRIEND_WARNING","NOT_FRIEND_COMMON_MY"],n.get(e.alert,"type")),e.showAlertTop=e.showAlert&&!e.showAlertBottom&&!t.state.hideAlertBarImportantClicked,e.posting=n.get(t.props.chat,"posting"),e.isEdit=e.posting&&"EDIT"===n.get(e.posting,"type"),e.replyKeyboard=!e.isEdit&&n.get(t.store.data.config,"server","reply-keyboard")&&n.find(n.get(t.props.chat,"lastMessage","attaches"),(function(t){return"REPLY_KEYBOARD"===n.get(t,"_type")})),e.hidePostingForm=e.replyKeyboard&&n.get(e.replyKeyboard,"defaultInputDisabled"),e.official=Yt(0,t.props.chat),e.animated=!n.get(t.store.data.config,"user","TV","clicked")&&n.get(t.store.data.config,"server","play-video-bg-animated"),e.ifExpr="CLOSED"!==n.get(t.props.chat,"status"),e.callPerms=e.ifExpr?!n.get(t.store.data.config,"server","settings-use")||!n.get(t.props.chat,"options","ONLY_ADMIN_CAN_CALL")||n.get(e.permissions,"callChat"):void 0,e.canCall=e.ifExpr?!t.store.data.isMobile&&!e.isBot&&!e.isGroupchat&&!e.isService&&!e.emptyChat&&e.callPerms:void 0,e.disabled=e.ifExpr?n.get(t.state.additional,"alert"):void 0,e.disableAside=(e.ifExpr,jt(0,t.state.asideContent,"forward")),e.bubbleHidden=e.ifExpr?jt(0,n.get(t.store.data.config,"user","HIDDEN_BUBBLES"),"BACKGROUNDS_NEW_YEAR_UPPER_BUBBLE"):void 0,e.chooseExpr=e.ifExpr?t.store.data.isSmallScreen?0:1:-1,e.caseExpr_1=1===e.chooseExpr,e.ifExpr_1=e.caseExpr_1&&"DIALOG"===n.get(t.props.chat,"type"),e.disabled_1=e.ifExpr_1||e.ifExpr?n.get(t.state.additional,"alert"):void 0,e.bubbleHidden_1=jt(0,n.get(t.store.data.config,"user","HIDDEN_BUBBLES"),"BACKGROUNDS_NEW_YEAR_UPPER_BUBBLE"),e.ifExpr_2=n.get(t.store.data.config,"server","chat-bg"),e.bgImage=e.ifExpr_2?n.get(t.store.data.config,"server","chat-bg-url")?"background-image: url("+n.get(t.store.data.config,"server","chat-bg-url")+");":"":void 0,e.bgSize=e.ifExpr_2?n.get(t.store.data.config,"server","chat-bg-size")?"background-size:"+n.get(t.store.data.config,"server","chat-bg-size")+";":"":void 0,e.image=t.state.editableBgEnabled&&n.get(t.state.background,"imageSrc"),e.color=t.state.editableBgEnabled&&n.get(t.state.background,"color"),e.customBg=!(!e.color&&!e.image),e.imageBg=e.image?"background-image: url("+e.image+");":"",e.colorBg=e.color?"background-color: "+e.color+";":"",e.style=e.imageBg+e.colorBg,e.ifExpr_3=!t.state.tvBackgroundEnabled}function Nyt(t,e,n){pyt("info",t,0,n)}function qyt(t,e){"CLOSED"!==n.get(t.props.chat,"status")&&n.setPendingEvent(e._1e,"click",Nyt,e)}function Hyt(t,e,n){e.title=n.store.data.l10n("back"),e.class=(n.store.data.isMobile?"":"back-okmsg")+(n.store.data.isMobile?" secondary-okmsg":"")+(n.store.data.isSmallScreen?" back-mobile-okmsg":"")}function Fyt(t,e,n){e.stopPropagation(),e.preventDefault(),Byt(t)}function Vyt(t,e,o){var r=o._1m=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._1n=n.propsSet(r,{shape:"square"});Hyt(0,i,t),o._1o=n.addEvent(r,"click",Fyt,t,o);var s=o._1p=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"back",size:"medium"})),n.mountComponent(r,i),Lyt[0]=1,Kyt}function Kyt(t,e){var o=e._1m,r=e._1n;Hyt(0,r,t),n.updateComponent(o,r)}function Wyt(t,e,n){e.class="back-mobile-okmsg secondary-okmsg"+(n.props.otherUnread?" __has-unread-okmsg":""),e.title=n.store.data.l10n("back")}function Gyt(t,e,n){e.stopPropagation(),e.preventDefault(),Byt(t)}function Yyt(t,e,o){var r=o._1u=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._1v=n.propsSet(r,{shape:"circle","data-tsid":"conversation_back_button"});Wyt(0,i,t),o._1w=n.addEvent(r,"click",Gyt,t,o);var s=o._1x=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"back",size:"medium"})),n.mountComponent(r,i),Lyt[0]=1,Xyt}function Xyt(t,e){var o=e._1u,r=e._1v;Wyt(0,r,t),n.updateComponent(o,r)}function Qyt(t){return t.state.prevUrl?Vyt:t.store.data.isSmallScreen?Yyt:null}function Jyt(t,e,n){e.chat=n.props.chat}function $yt(t,e,o){n.updateAttribute(t,e,"href",n.get(o.props.chat,"group","profileUrl"))}function Zyt(t,e,o){e.stopPropagation(),e.preventDefault(),$n(t,n.get(t.props.chat,"group"),!t.store.data.isMobile)}function tSt(t,e,n,o){e.official=o.official}function eSt(t,e,o){var r=o._28=n.insert(e,n.elem("a",Ryt),"title"),a=o._29=n.obj();n.setAttribute(r,"slot","title"),n.setClass(r,"link-okmsg"),$yt(r,a,t),o._2a=n.addEvent(r,"click",Zyt,t,o);var i=o._2b=n.appendChild(r,n.createComponent("msg-chat-title",Bb,t)),s=i.componentModel.input,u=o._2c=n.propsSet(i);return tSt(0,u,0,o),o._2d=n.insert(s,n.text(n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder"))),n.mountComponent(i,u),Lyt[1]=1,nSt}function nSt(t,e){var o=e._2b,r=e._2c;$yt(e._28,e._29,t),tSt(0,r,0,e),Lyt[2]|=n.updateText(e._2d,n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder")),n.updateIncomingSlot(o,"",Lyt[2]),n.updateComponent(o,r)}function oSt(t,e,o,r){e.official=r.official,e.channel=r.isChannel,e.bot=r.isBot,e.user="DIALOG"===n.get(o.props.chat,"type")||r.groupModerator?r.contact:null}function rSt(t,e,o){var r=o._2h=n.insert(e,n.createComponent("msg-chat-title",Bb,t),"title"),a=r.componentModel.input,i=o._2i=n.propsSet(r,{slot:"title"});return oSt(0,i,t,o),o._2j=n.insert(a,n.text(n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder"))),n.mountComponent(r,i),Lyt[1]=1,aSt}function aSt(t,e){var o=e._2h,r=e._2i;oSt(0,r,t,e),Lyt[3]|=n.updateText(e._2j,n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder")),n.updateIncomingSlot(o,"",Lyt[3]),n.updateComponent(o,r)}function iSt(t,e){return!e.isGroupchat||e.groupModerator||e.isService?rSt:eSt}function sSt(t,e,o){var r=o._2p=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"bot"})),Lyt[4]=1}function uSt(t,e,o){var r=o._2x=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"service-chat"})),Lyt[4]=1}function cSt(t,e){return e.isService?uSt:null}function pSt(t,e,o){var r=n.insert(e,n.elem("span",Ryt),""),a=n.createInjector(r);return o._2u=n.mountBlock(t,a,cSt),Lyt[4]=1,lSt}function lSt(t,e){n.updateBlock(e._2u)}function mSt(t,e,n){e.chat=n.props.chat}function dSt(t,e,o){var r=o._32=n.insert(e,n.createComponent("msg-chat-meta",xy,t),""),a=o._33=n.propsSet(r);return mSt(0,a,t),n.mountComponent(r,a),Lyt[4]=1,_St}function _St(t,e){var o=e._32,r=e._33;mSt(0,r,t),n.updateComponent(o,r)}function fSt(t,e){return e.isBot?sSt:e.isGroupchat?pSt:dSt}function gSt(t,e,n){e.class="movie-controls-okmsg"+(n.state.tvBackgroundEnabled?"":" __off-okmsg")}function vSt(t,e){e.stopPropagation(),e.preventDefault()}function hSt(t,e,n,o){e.class="tv-okmsg"+(o.animated?" __animated-okmsg":""),e.title=n.state.tvBackgroundEnabled?n.store.data.l10n("tv-bg-disable"):n.store.data.l10n("tv-bg-enable")}function CSt(t,e,n){e.stopPropagation(),e.preventDefault(),tyt(!t.state.tvBackgroundEnabled,t)}function kSt(t,e,n){e.disabled=n.state.tvOff,e.title=n.state.tvSilent?n.store.data.l10n("tv-bg-loud"):n.store.data.l10n("tv-bg-silent")}function bSt(t,e,n){e.icon=n.state.tvSilent?"volume-max":"volume-min"}function ySt(t,e,n){e.title=n.store.data.l10n("tv-bg-fullscreen")}function SSt(t,e,n){e.title=n.state.tvOff?n.store.data.l10n("tv-bg-on"):n.store.data.l10n("tv-bg-off")}function wSt(t,e,o){var r=o._37=n.insert(e,n.createComponent("msg-bubble",me,t),"controls"),a=r.componentModel.input,i=o._38=n.propsSet(r,{slot:"controls",yAxis:"bottom",xAxis:"right",container:"msg-chat",forced:!0});gSt(0,i,t),o._39=n.addEvent(r,"click",vSt,t,o);var s=o._3a=n.insert(a,n.createComponent("button",fe,t),"element"),u=s.componentModel.input,c=o._3b=n.propsSet(s,{shape:"circle",slot:"element"});hSt(0,c,t,o),o._3c=n.addEvent(s,"click",CSt,t,o);var p=o._3d=n.insert(u,n.createComponent("msg-icon",xe,t),"");n.mountComponent(p,n.propsSet(p,{icon:"tv",size:"large"})),n.mountComponent(s,c);var l=n.insert(a,n.elem("div",Ryt),"bubble");n.setAttribute(l,"slot","bubble"),n.setClass(l,"movie-buttons-okmsg");var m=o._3h=n.appendChild(l,n.createComponent("button",fe,t)),d=m.componentModel.input,_=o._3i=n.propsSet(m,{shape:"circle"});kSt(0,_,t),o._3j=n.addEvent(m,"click",oyt,t,o);var f=o._3k=n.insert(d,n.createComponent("msg-icon",xe,t),""),g=o._3l=n.propsSet(f);bSt(0,g,t),n.mountComponent(f,g),n.mountComponent(m,_);var v=o._3n=n.appendChild(l,n.createComponent("button",fe,t)),h=v.componentModel.input,C=o._3o=n.propsSet(v,{shape:"circle"});ySt(0,C,t),o._3p=n.addEvent(v,"click",nyt,t,o);var k=o._3q=n.insert(h,n.createComponent("msg-icon",xe,t),"");n.mountComponent(k,n.propsSet(k,{icon:"fullscreen"})),n.mountComponent(v,C);var b=o._3t=n.appendChild(l,n.createComponent("button",fe,t)),y=b.componentModel.input,S=o._3u=n.propsSet(b,{shape:"circle"});SSt(0,S,t),o._3v=n.addEvent(b,"click",eyt,t,o);var w=o._3w=n.insert(y,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(w,n.propsSet(w,{icon:"off"})),n.mountComponent(b,S),n.mountComponent(r,i),Lyt[5]=1,ESt}function ESt(t,e){var o=e._37,r=e._38,a=e._3a,i=e._3b,s=e._3h,u=e._3i,c=e._3k,p=e._3l,l=e._3n,m=e._3o,d=e._3t,_=e._3u;gSt(0,r,t),hSt(0,i,t,e),n.updateComponent(a,i),kSt(0,u,t),bSt(0,p,t),n.updateComponent(c,p),n.updateComponent(s,u),ySt(0,m,t),n.updateComponent(l,m),SSt(0,_,t),n.updateComponent(d,_),n.updateComponent(o,r)}function xSt(t){return n.get(t.store.data.config,"server","play-video-bg")?wSt:null}function ISt(t,e){e.stopPropagation(),e.preventDefault()}function BSt(t,e,n){cyt("AUDIO",t)}function MSt(t,e,n){cyt("VIDEO",t)}function ASt(t,e,o){var r=o._4k=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input;o._4m=n.addEvent(r,"click",BSt,t,o);var i=o._4n=n.insert(a,n.createComponent("msg-tico",rc,t),""),s=i.componentModel.input;o._4p=n.insert(s,n.text(t.store.data.l10n("call-audio"))),n.mountComponent(i,n.propsSet(i,{icon:"audio-call-s"})),n.mountComponent(r,n.propsSet(r,{"data-l":"t,audioCall","data-tsid":"chat-call-join-btn"}));var u=o._4s=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),c=u.componentModel.input;o._4u=n.addEvent(u,"click",MSt,t,o);var p=o._4v=n.insert(c,n.createComponent("msg-tico",rc,t),""),l=p.componentModel.input;return o._4x=n.insert(l,n.text(t.store.data.l10n("call-video"))),n.mountComponent(p,n.propsSet(p,{icon:"video"})),n.mountComponent(u,n.propsSet(u,{"data-l":"t,videoCall"})),Lyt[6]=1,TSt}function TSt(t,e){Lyt[7]|=n.updateText(e._4p,t.store.data.l10n("call-audio")),n.updateIncomingSlot(e._4n,"",Lyt[7]),Lyt[8]|=n.updateText(e._4x,t.store.data.l10n("call-video")),n.updateIncomingSlot(e._4v,"",Lyt[8])}function jSt(t,e){return e.canCall?ASt:null}function PSt(t,e,n){e.title=n.store.data.l10n("search-messages")}function RSt(t){n.call(t,"toggleSearch")}function LSt(t,e,o){var r=o._54=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._55=n.propsSet(r,{"data-tsid":"message_search_button","data-l":"t,searchMessages"});PSt(0,i,t),o._56=n.addEvent(r,"click",RSt,t,o);var s=o._57=n.insert(a,n.createComponent("msg-tico",rc,t),""),u=s.componentModel.input;return o._59=n.insert(u,n.text(t.store.data.l10n("search"))),n.mountComponent(s,n.propsSet(s,{icon:"search"})),n.mountComponent(r,i),Lyt[6]=1,OSt}function OSt(t,e){var o=e._54,r=e._55;PSt(0,r,t),Lyt[9]|=n.updateText(e._59,t.store.data.l10n("search")),n.updateIncomingSlot(e._57,"",Lyt[9]),n.updateComponent(o,r)}function zSt(t,e){return e.isGroupchat?null:LSt}function DSt(t,e,n,o){e.class=o.disabled?"__disabled-okmsg":""}function USt(t,e,o,r){r.disabled?Zt(t,"show-toast",t.store.data.l10n("add-to-chat-disabled-toast",t,e,o)):Qp("/:new-chat/"+n.get(r.contact,"id"),t)}function NSt(t,e,o){var r=o._5f=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._5g=n.pendingEvents(t,r),s=o._5h=n.propsSet(r,{"data-tsid":"create_chat_from_dialog","data-l":"t,createChatFromDialog"});DSt(0,s,0,o),n.setPendingEvent(i,"click",USt,o);var u=o._5j=n.insert(a,n.createComponent("msg-tico",rc,t),""),c=u.componentModel.input;return o._5l=n.insert(c,n.text(t.store.data.l10n("chat-participants-add"))),n.mountComponent(u,n.propsSet(u,{icon:"add",size:"medium"})),n.finalizePendingEvents(i),n.mountComponent(r,s),Lyt[6]=1,qSt}function qSt(t,e){var o=e._5f,r=e._5g,a=e._5h;DSt(0,a,0,e),n.setPendingEvent(r,"click",USt,e),Lyt[10]|=n.updateText(e._5l,t.store.data.l10n("chat-participants-add")),n.updateIncomingSlot(e._5j,"",Lyt[10]),n.finalizePendingEvents(r),n.updateComponent(o,a)}function HSt(t){return"DIALOG"===n.get(t.props.chat,"type")?NSt:null}function FSt(t,e,n,o){e.disabled=o.disableAside}function VSt(t,e,n){pyt("participants",t,0,n)}function KSt(t,e,o){var r=o._5r=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._5s=n.propsSet(r,{"data-tsid":"view_participants","data-l":"t,viewParticipants"});FSt(0,i,0,o),o._5t=n.addEvent(r,"click",VSt,t,o);var s=o._5u=n.insert(a,n.createComponent("msg-tico",rc,t),""),u=s.componentModel.input;return o._5w=n.insert(u,n.text(t.store.data.l10n("chat-participants",{type:n.get(t.props.chat,"type")}))),n.mountComponent(s,n.propsSet(s,{icon:"participants",size:"medium"})),n.mountComponent(r,i),Lyt[6]=1,WSt}function WSt(t,e){var o=e._5r,r=e._5s;FSt(0,r,0,e),Lyt[11]|=n.updateText(e._5w,t.store.data.l10n("chat-participants",{type:n.get(t.props.chat,"type")})),n.updateIncomingSlot(e._5u,"",Lyt[11]),n.updateComponent(o,r)}function GSt(t,e){return"DIALOG"===n.get(t.props.chat,"type")||e.isGroupchat?null:KSt}function YSt(t,e,n,o){e.disabled=o.disableAside}function XSt(t,e,n){pyt("info",t,0,n)}function QSt(t,e){var o=n.insert(e,n.elem("div",Ryt),"");n.setClass(o,"backgrounds-bubble-okmsg"),Lyt[12]=1}function JSt(t,e){return t.state.editableBgEnabled&&!e.bubbleHidden&&n.get(t.store.data.config,"server","new-year-backgrounds")?QSt:null}function $St(t,e,o){var r=o._62=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._63=n.propsSet(r,{"data-tsid":"chat_info_button","data-l":"t,showChatInfo"});YSt(0,i,0,o),o._64=n.addEvent(r,"click",XSt,t,o),o._65=n.mountBlock(t,a,JSt);var s=o._6a=n.insert(a,n.createComponent("msg-tico",rc,t),""),u=s.componentModel.input;return o._6c=n.insert(u,n.text(t.store.data.l10n("settings"))),n.mountComponent(s,n.propsSet(s,{icon:"info",size:"medium"})),n.mountComponent(r,i),Lyt[6]=1,ZSt}function ZSt(t,e){var o=e._62,r=e._63;YSt(0,r,0,e),n.updateBlock(e._65),Lyt[13]|=n.updateText(e._6c,t.store.data.l10n("settings")),n.updateIncomingSlot(e._6a,"",Lyt[13]),n.updateIncomingSlot(o,"",Lyt[12]),n.updateComponent(o,r)}function twt(t,e){return"ACTIVE"===n.get(t.props.chat,"status")||"LEFT"===n.get(t.props.chat,"status")||e.groupModerator?$St:null}function ewt(t,e,o){var r=o._47=n.insert(e,n.createComponent("msg-bubble",me,t),"controls"),a=r.componentModel.input;o._49=n.addEvent(r,"click",ISt,t,o);var i=o._4a=n.insert(a,n.createComponent("button",fe,t),"element"),s=i.componentModel.input,u=o._4c=n.insert(s,n.createComponent("msg-icon",xe,t),"");n.mountComponent(u,n.propsSet(u,{icon:"menu"})),n.mountComponent(i,n.propsSet(i,{slot:"element",class:"secondary-okmsg",shape:"circle"}));var c=o._4f=n.insert(a,n.createComponent("msg-menu",bS,t),"bubble"),p=c.componentModel.input;return o._4h=n.mountBlock(t,p,jSt),o._51=n.mountBlock(t,p,zSt),o._5c=n.mountBlock(t,p,HSt),o._5o=n.mountBlock(t,p,GSt),o._5z=n.mountBlock(t,p,twt),n.mountComponent(c,n.propsSet(c,{slot:"bubble"})),n.mountComponent(r,n.propsSet(r,{yAxis:"bottom",xAxis:"right",forced:!0,slot:"controls"})),Lyt[5]=1,nwt}function nwt(t,e){n.updateBlock(e._4h),n.updateBlock(e._51),n.updateBlock(e._5c),n.updateBlock(e._5o),n.updateBlock(e._5z),n.updateIncomingSlot(e._4f,"",Lyt[6])}function owt(t,e,n){e.title=n.store.data.l10n("call-audio")}function rwt(t,e,n){e.stopPropagation(),cyt("AUDIO",t)}function awt(t,e,n){e.title=n.store.data.l10n("call-video")}function iwt(t,e,n){e.stopPropagation(),cyt("VIDEO",t)}function swt(t,e,o){var r=o._6k=n.insert(e,n.createComponent("button",fe,t),"controls"),a=r.componentModel.input,i=o._6l=n.propsSet(r,{slot:"controls",shape:"circle","data-l":"t,audioCall","data-tsid":"chat-call-join-btn"});owt(0,i,t),o._6m=n.addEvent(r,"click",rwt,t,o);var s=o._6n=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(s,n.propsSet(s,{icon:"audio-call-s",size:"medium"})),n.mountComponent(r,i);var u=o._6q=n.insert(e,n.createComponent("button",fe,t),"controls"),c=u.componentModel.input,p=o._6r=n.propsSet(u,{slot:"controls",shape:"circle","data-l":"t,videoCall"});awt(0,p,t),o._6s=n.addEvent(u,"click",iwt,t,o);var l=o._6t=n.insert(c,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(l,n.propsSet(l,{icon:"video",size:"medium"})),n.mountComponent(u,p),Lyt[5]=1,uwt}function uwt(t,e){var o=e._6k,r=e._6l,a=e._6q,i=e._6r;owt(0,r,t),n.updateComponent(o,r),awt(0,i,t),n.updateComponent(a,i)}function cwt(t,e){return e.canCall?swt:null}function pwt(t,e,n){e.title=n.store.data.l10n("search-messages")}function lwt(t,e){e.stopPropagation(),n.call(t,"toggleSearch")}function mwt(t,e,o){e.class=n.get(o.props.chat,"search")||o.state.search?"__active-okmsg":""}function dwt(t,e,o){var r=o._6z=n.insert(e,n.createComponent("button",fe,t),"controls"),a=r.componentModel.input;n.setPendingRef(o._1,"searchTrigger",r);var i=o._70=n.propsSet(r,{slot:"controls",shape:"circle","data-tsid":"message_search_button","data-l":"t,searchMessages"});pwt(0,i,t),o._71=n.addEvent(r,"click",lwt,t,o);var s=o._72=n.insert(a,n.createComponent("msg-icon",xe,t),""),u=o._73=n.propsSet(s,{icon:"search",size:"medium"});return mwt(0,u,t),n.mountComponent(s,u),n.mountComponent(r,i),Lyt[5]=1,_wt}function _wt(t,e){var o=e._6z,r=e._70,a=e._72,i=e._73;n.setPendingRef(e._1,"searchTrigger",o),pwt(0,r,t),mwt(0,i,t),n.updateComponent(a,i),n.updateComponent(o,r)}function fwt(t,e){return e.isGroupchat?null:dwt}function gwt(t,e,n,o){e.disabled=o.disabled_1,e.title=n.store.data.l10n(o.disabled_1?"add-to-chat-disabled":"add-to-chat")}function vwt(t,e,o,r){e.stopPropagation(),r.disabled_1?Zt(t,"show-toast",t.store.data.l10n("add-to-chat-disabled-toast",t,e,o)):Qp("/:new-chat/"+n.get(r.contact,"id"),t)}function hwt(t,e,n){e.class=n.state.createDialog?"__active-okmsg":""}function Cwt(t,e,o){var r=o._78=n.insert(e,n.createComponent("button",fe,t),"controls"),a=r.componentModel.input,i=o._79=n.propsSet(r,{slot:"controls",shape:"circle","data-tsid":"create_chat_from_dialog","data-l":"t,createChatFromDialog"});gwt(0,i,t,o),o._7a=n.addEvent(r,"click",vwt,t,o);var s=o._7b=n.insert(a,n.createComponent("msg-icon",xe,t),""),u=o._7c=n.propsSet(s,{icon:"add",size:"medium"});return hwt(0,u,t),n.mountComponent(s,u),n.mountComponent(r,i),Lyt[5]=1,kwt}function kwt(t,e){var o=e._78,r=e._79,a=e._7b,i=e._7c;gwt(0,r,t,e),hwt(0,i,t),n.updateComponent(a,i),n.updateComponent(o,r)}function bwt(t,e){return e.ifExpr_1?Cwt:null}function ywt(t,e,o,r){e.disabled=r.disableAside,e.title=o.store.data.l10n("chat-participants",{type:n.get(o.props.chat,"type")})}function Swt(t,e,n){e.stopPropagation(),pyt("participants",t,0,n)}function wwt(t,e,n){e.class=jt(0,n.state.asideContent,"participants")?"__active-okmsg":""}function Ewt(t,e,o){var r=o._7h=n.insert(e,n.createComponent("button",fe,t),"controls"),a=r.componentModel.input,i=o._7i=n.propsSet(r,{slot:"controls",shape:"circle","data-tsid":"view_participants","data-l":"t,viewParticipants"});ywt(0,i,t,o),o._7j=n.addEvent(r,"click",Swt,t,o);var s=o._7k=n.insert(a,n.createComponent("msg-icon",xe,t),""),u=o._7l=n.propsSet(s,{icon:"participants",size:"medium"});return wwt(0,u,t),n.mountComponent(s,u),n.mountComponent(r,i),Lyt[5]=1,xwt}function xwt(t,e){var o=e._7h,r=e._7i,a=e._7k,i=e._7l;ywt(0,r,t,e),wwt(0,i,t),n.updateComponent(a,i),n.updateComponent(o,r)}function Iwt(t,e){return"DIALOG"===n.get(t.props.chat,"type")||e.isGroupchat?null:Ewt}function Bwt(t,e,n,o){e.disabled=o.disableAside,e.title=n.store.data.l10n("settings")}function Mwt(t,e,n){e.stopPropagation(),pyt("info",t,0,n)}function Awt(t,e){var o=n.insert(e,n.elem("div",Ryt),"");n.setClass(o,"backgrounds-bubble-okmsg"),Lyt[14]=1}function Twt(t,e){return t.state.editableBgEnabled&&!e.bubbleHidden_1&&n.get(t.store.data.config,"server","new-year-backgrounds")?Awt:null}function jwt(t,e,n){e.class=jt(0,n.state.asideContent,"info")?"__active-okmsg":""}function Pwt(t,e,o){var r=o._7q=n.insert(e,n.createComponent("button",fe,t),"controls"),a=r.componentModel.input,i=o._7r=n.propsSet(r,{slot:"controls",shape:"circle","data-tsid":"chat_info_button","data-l":"t,showChatInfo"});Bwt(0,i,t,o),o._7s=n.addEvent(r,"click",Mwt,t,o),o._7t=n.mountBlock(t,a,Twt);var s=o._7y=n.insert(a,n.createComponent("msg-icon",xe,t),""),u=o._7z=n.propsSet(s,{icon:"info",size:"medium"});return jwt(0,u,t),n.mountComponent(s,u),n.mountComponent(r,i),Lyt[5]=1,Rwt}function Rwt(t,e){var o=e._7q,r=e._7r,a=e._7y,i=e._7z;Bwt(0,r,t,e),n.updateBlock(e._7t),jwt(0,i,t),n.updateComponent(a,i),n.updateIncomingSlot(o,"",Lyt[14]),n.updateComponent(o,r)}function Lwt(t,e){return"CLOSED"!==n.get(t.props.chat,"status")||e.groupModerator?Pwt:null}function Owt(t,e,o){return o._6h=n.mountBlock(t,e,cwt),o._6w=n.mountBlock(t,e,fwt),o._75=n.mountBlock(t,e,bwt),o._7e=n.mountBlock(t,e,Iwt),o._7n=n.mountBlock(t,e,Lwt),zwt}function zwt(t,e){n.updateBlock(e._6h),n.updateBlock(e._6w),n.updateBlock(e._75),n.updateBlock(e._7e),n.updateBlock(e._7n)}function Dwt(t,e){return[ewt,Owt][e.chooseExpr]}function Uwt(t,e,o){return o._44=n.mountBlock(t,e,Dwt),Nwt}function Nwt(t,e){n.updateBlock(e._44)}function qwt(t,e){return e.ifExpr?Uwt:null}function Hwt(t,e,o,r){n.updateClass(t,e,"main-okmsg"+(Tt(0,o.state.asideContent)?" active-okmsg":"")),n.updateAttribute(t,e,"style",r.ifExpr_2?r.bgImage+r.bgSize:void 0)}function Fwt(t,e,o){!o._89&&function(t,e,o){var r=o._89=n.insert(e,n.elem("div",Ryt));n.setClass(r,"overlay-okmsg"),o._8a=n.addEvent(r,"click",Ayt,t,o)}(t,e,o),n.animate(o._89,n.createAnimation("global:msg-fade-in 0.2s",Ryt))}function Vwt(t,e){return Tt(0,t.state.asideContent)||e.narrowForward?Fwt:null}function Kwt(t,e,o){e.width=n.get(o.store.data.config,"server","video-messages","width")||600,e.height=n.get(o.store.data.config,"server","video-messages","height")||450}function Wwt(t,e,o){var r=o._8f=n.insert(e,n.createComponent("msg-video-recorder",xot,t)),a=o._8g=n.propsSet(r);return Kwt(0,a,t),o._8h=n.addEvent(r,"submit",lyt,t,o),n.mountComponent(r,a),Gwt}function Gwt(t,e){var o=e._8f,r=e._8g;Kwt(0,r,t),n.updateComponent(o,r)}function Ywt(t){return t.state.recordVideo?Wwt:null}function Xwt(t,e,n,o){e.chat=n.props.chat,e.showSearch=n.state.search,e.noControls=!!n.state.forward,e.alert=o.showAlertTop?o.alert:void 0,e.simple=void o.showAlertTop}function Qwt(t,e){n.call(t,"highlightMessage",[n.get(e,"detail","time"),n.get(e,"detail","id")])}function Jwt(t,e,o){!o._8s&&function(t,e,o){var r=o._8s=n.insert(e,n.createComponent("msg-audio-player-pinned",Dbt,t));n.mountComponent(r,n.propsSet(r,{disableGoToMessage:!0}))}(t,e,o),n.animate(o._8s,$U(o._8s,{duration:300,easing:nN}))}function $wt(t){return t.store.data.isMobile&&n.get(t.store.data.audioPlayer,"message")&&!n.get(t.store.data.audioPlayer,"float")?Jwt:null}function Zwt(t,e,o,r){n.updateClass(t,e,"content-okmsg chat-messages-okmsg"+(r.customBg?" custom-bg-okmsg":"")),n.updateAttribute(t,e,"style",r.ifExpr_3?r.style:void 0)}function tEt(t,e,o){e.url=n.get(o.state.background,"lottieUrl"),e.width=o.state.width,e.height=o.state.height}function eEt(t,e,o){var r=o._92=n.insert(e,n.createComponent("msg-lottie",Vn,t)),a=o._93=n.propsSet(r,{class:"lottie-bg-okmsg",loop:!0});return tEt(0,a,t),n.mountComponent(r,a),nEt}function nEt(t,e){var o=e._92,r=e._93;tEt(0,r,t),n.updateComponent(o,r)}function oEt(t){return"lottie"===n.get(t.state.background,"type")?eEt:null}function rEt(t,e,o){var r=o._97=n.insert(e,n.createComponent("msg-chat-snow",xM,t));n.mountComponent(r,n.propsSet(r,{particlesCountMax:80}))}function aEt(t){return"snow"===n.get(t.state.background,"id")?rEt:null}function iEt(t,e,o){var r=o._9c=n.insert(e,n.createComponent("msg-chat-aurora",$dt,t));n.mountComponent(r)}function sEt(t){return"aurora"===n.get(t.state.background,"id")?iEt:null}function uEt(t,e,o){return o._8z=n.mountBlock(t,e,oEt),o._94=n.mountBlock(t,e,aEt),o._99=n.mountBlock(t,e,sEt),cEt}function cEt(t,e){n.updateBlock(e._8z),n.updateBlock(e._94),n.updateBlock(e._99)}function pEt(t){return t.state.tvBackgroundEnabled?null:uEt}function lEt(t,e,n){e.chat=n.props.chat}function mEt(t,e,o){var r=o._9h=n.insert(e,n.createComponent("msg-message-search-results",cH,t)),a=o._9i=n.propsSet(r,{class:"custom-scrollbar-okmsg","data-tsid":"messages_search_results"});return lEt(0,a,t),n.mountComponent(r,a),dEt}function dEt(t,e){var o=e._9h,r=e._9i;lEt(0,r,t),n.updateComponent(o,r)}function _Et(t,e,o){e.chat=o.props.chat,e.highlighted=n.get(o.props.chat,"focusedMessage"),e.multiMode=!!Tt(0,n.get(o.props.chat,"selectedMessages")),e.showReadMarks=n.get(o.props.config,"user","SHOW_READ_MARK"),e.showRmLimits=n.get(o.props.config,"server","show-rm-limits"),e.showSendActionCongratsAttach=n.get(o.state.additional,"sendActionCongrats","attachButtonEnabled")}function fEt(t,e,o){e.type=n.get(o.props.chat,"type"),e.users=n.get(o.props.chat,"typingParticipants")}function gEt(t,e){var o=e._9s,r=e._9t;fEt(0,r,t),n.updateComponent(o,r)}function vEt(t,e,o){return o._9s?gEt(t,o):function(t,e,o){var r=o._9s=n.insert(e,n.createComponent("msg-typing-indicator",Dk,t)),a=o._9t=n.propsSet(r,{"data-tsid":"pen"});fEt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._9s,n.createAnimation("show-typing 0.15s ease-out",Ryt)),hEt}function hEt(t,e){gEt(t,e)}function CEt(t){return n.get(t.props.chat,"typingParticipants")?vEt:null}function kEt(t,e,o){var r=o._9l=n.insert(e,n.createComponent("msg-message-list",Qz,t));n.setPendingRef(o._1,"messageList",r);var a=o._9m=n.propsSet(r);return _Et(0,a,t),n.mountComponent(r,a),o._9n=n.mountBlock(t,e,CEt),bEt}function bEt(t,e){var o=e._9l,r=e._9m;n.setPendingRef(e._1,"messageList",o),_Et(0,r,t),n.updateComponent(o,r),n.updateBlock(e._9n)}function yEt(t,e,o){var r=o._9w=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{class:"chat-loader-okmsg",size:"big","data-tsid":"messages_list_loader"}))}function SEt(t,e,o){var r=n.insert(e,n.elem("div",Ryt));n.setClass(r,"welcome-chat-text-okmsg");var a=n.appendChild(r,n.elem("div",Ryt));n.setClass(a,"text-okmsg");var i=o._a2=n.appendChild(a,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"empty-chat-text-private"}))}function wEt(t,e,o,r){e.url=Wt(0,r.contact,"big"),e.id=n.get(r.contact,"id"),e.caption=n.get(r.contact,"name")}function EEt(t,e,o){var r=n.insert(e,n.elem("div",Ryt));n.setClass(r,"welcome-chat-text-okmsg");var a=n.appendChild(r,n.elem("div",Ryt));n.setClass(a,"bot-description-okmsg");var i=o._a8=n.appendChild(a,n.createComponent("msg-avatar",Hp,t)),s=o._a9=n.propsSet(i,{size:"big"});return wEt(0,s,0,o),n.mountComponent(i,s),o._aa=n.appendChild(a,n.text(n.get(t.props.contact,"description"))),xEt}function xEt(t,e){var o=e._a8,r=e._a9;wEt(0,r,0,e),n.updateComponent(o,r),n.updateText(e._aa,n.get(t.props.contact,"description"))}function IEt(t,e,o){e["data-type"]=n.get(o.props.chat,"type")}function BEt(t,e,o){var r=n.insert(e,n.elem("div",Ryt));n.setClass(r,"welcome-chat-text-okmsg");var a=n.appendChild(r,n.elem("div",Ryt));n.setClass(a,"text-okmsg");var i=o._af=n.appendChild(a,n.createComponent("msg-l10n",ae,t)),s=o._ag=n.propsSet(i,{key:"empty-chat-text-1"});IEt(0,s,t),n.mountComponent(i,s),n.appendChild(a,n.elem("br",Ryt));var u=o._ai=n.appendChild(a,n.createComponent("msg-l10n",ae,t));return n.mountComponent(u,n.propsSet(u,{key:"empty-chat-text-2"})),MEt}function MEt(t,e){var o=e._af,r=e._ag;IEt(0,r,t),n.updateComponent(o,r)}function AEt(t,e){return n.get(t.props.chat,"search")?mEt:n.find(n.get(t.props.chat,"messages"),(function(t){return"REMOVED"!==n.get(t,"status")}))?kEt:"loading"===n.get(t.props.chat,"loadState")?yEt:"PRIVATE"!==n.get(t.props.chat,"access")||e.isParticipant||"CHAT"!==n.get(t.props.chat,"type")?"PRIVATE"!=n.get(t.props.chat,"access")||e.isParticipant||"CHAT"!==n.get(t.props.chat,"type")?BEt:EEt:SEt}function TEt(t,e,n){e.chat=n.props.chat}function jEt(t,e,o){var r=o._aq=n.insert(e,n.createComponent("msg-chat-actions",cS,t)),a=o._ar=n.propsSet(r);return TEt(0,a,t),n.mountComponent(r,a),PEt}function PEt(t,e){var o=e._aq,r=e._ar;TEt(0,r,t),n.updateComponent(o,r)}function REt(t,e,o,r){e.stickers=n.get(o.state.additional,"helloStickers"),e.link=n.get(o.state.additional,"redLink"),e.backgroundId=n.get(o.state.background,"id"),e.alert=r.showAlertBottom?r.alert:void 0,e.contact=r.showAlertBottom?r.contact:void 0}function LEt(t,e,o){var r=o._ay=n.insert(e,n.createComponent("msg-boost",Mq,t)),a=o._az=n.propsSet(r);return REt(0,a,t,o),o._b0=n.addEvent(r,"toggle-stickers",qbt,t,o),o._b1=n.addEvent(r,"reload-stickers",Fbt,t,o),o._b2=n.addEvent(r,"close-link",Hbt,t,o),o._b3=n.addEvent(r,"pick-sticker",syt,t,o),o._b4=n.addEvent(r,"animate",dyt,t,o),n.mountComponent(r,a),OEt}function OEt(t,e){var o=e._ay,r=e._az;REt(0,r,t,e),n.updateComponent(o,r)}function zEt(t,e){return e.isService?null:LEt}function DEt(t,e,o,r){e.key=n.get(r.posting,"link","text")?"edit-message-text":"add-message-text"}function UEt(t,e,o,r){e.messageElements=n.get(r.posting,"link","elements")}function NEt(t,e,o){var r=o._bg=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._bh=n.propsSet(r,{class:"edit-title-okmsg","data-tsid":"edit_msg_title"});DEt(0,a,0,o),n.mountComponent(r,a);var i=o._bi=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),s=i.componentModel.input,u=o._bj=n.propsSet(i,{emojiSize:14,userSticker:!0,textEmoji:!0,class:"edit-text-okmsg","data-tsid":"edit_msg_text"});return UEt(0,u,0,o),o._bk=n.insert(s,n.text(n.get(o.posting,"link","text"))),n.mountComponent(i,u),qEt}function qEt(t,e){var o=e._bg,r=e._bh,a=e._bi,i=e._bj;DEt(0,r,0,e),n.updateComponent(o,r),UEt(0,i,0,e),Lyt[15]|=n.updateText(e._bk,n.get(e.posting,"link","text")),n.updateIncomingSlot(a,"",Lyt[15]),n.updateComponent(a,i)}function HEt(t,e,o,r){e.message=n.get(r.posting,"link")}function FEt(t,e,o){var r=o._bo=n.insert(e,n.createComponent("msg-message-quote",ok,t)),a=o._bp=n.propsSet(r,{"data-tsid":"replied_msg_text_over_TA"});return HEt(0,a,0,o),n.mountComponent(r,a),VEt}function VEt(t,e){var o=e._bo,r=e._bp;HEt(0,r,0,e),n.updateComponent(o,r)}function KEt(t,e,o){var r=o._bs=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._bt=n.insert(a,n.text(n.get(o.posting,"text"))),n.mountComponent(r),WEt}function WEt(t,e){Lyt[16]|=n.updateText(e._bt,n.get(e.posting,"text")),n.updateIncomingSlot(e._bs,"",Lyt[16])}function GEt(t,e){return"EDIT"===n.get(e.posting,"type")?NEt:"REPLY"===n.get(e.posting,"type")?FEt:KEt}function YEt(t,e){n.updateBlock(e._bd)}function XEt(t,e,o){return o._bb?YEt(0,o):function(t,e,o){var r=o._bb=n.insert(e,n.elem("div",Ryt));n.setClass(r,"wrap-okmsg");var a=n.appendChild(r,n.elem("div",Ryt)),i=n.createInjector(a);n.setClass(a,"add-comment-okmsg"),n.setAttribute(a,"data-tsid","add_comment_panel_over_TA"),o._bd=n.mountBlock(t,i,GEt);var s=o._bw=n.insert(i,n.createComponent("button",fe,t)),u=s.componentModel.input;o._by=n.addEvent(s,"click",iyt,t,o);var c=o._bz=n.insert(u,n.createComponent("msg-icon",xe,t),"");n.mountComponent(c,n.propsSet(c,{icon:"clear"})),n.mountComponent(s,n.propsSet(s,{class:"cancel-okmsg",shape:"circle","data-tsid":"delete_comment_over_TA"}))}(t,e,o),n.animate(o._bb,aN(o._bb,t,{duration:300})),QEt}function QEt(t,e){YEt(0,e)}function JEt(t,e){return n.get(e.posting,"link")?XEt:null}function $Et(t,e,n,o){e.keyboard=o.replyKeyboard,e.chat=n.props.chat}function ZEt(t,e,o){var r=o._c5=n.insert(e,n.createComponent("msg-reply-keyboard",Vot,t)),a=o._c6=n.propsSet(r);return $Et(0,a,t,o),n.mountComponent(r,a),txt}function txt(t,e){var o=e._c5,r=e._c6;$Et(0,r,t,e),n.updateComponent(o,r)}function ext(t,e){return e.replyKeyboard?ZEt:null}function nxt(t,e,o,r){e.chat=o.props.chat,e.assets=o.store.data.assets,e.config=o.store.data.config,e.congrats=n.get(o.state.additional,"sendActionCongrats"),e.shouldFocus=o.state.shouldFocus,e.proAllowed=!r.isService}function oxt(t,e){t.setState({recordVideo:!0})}function rxt(t,e,o){var r=o._ca=n.insert(e,n.createComponent("msg-posting-form",m9,t));n.setPendingRef(o._1,"postingForm",r);var a=o._cb=n.propsSet(r,{class:"js-posting-form"});return nxt(0,a,t,o),o._cc=n.addEvent(r,"animate",dyt,t,o),o._cd=n.addEvent(r,"record-video",oxt,t,o),o._ce=n.addEvent(r,"editor-update",Myt,t,o),n.mountComponent(r,a),axt}function axt(t,e){var o=e._ca,r=e._cb;n.setPendingRef(e._1,"postingForm",o),nxt(0,r,t,e),n.updateComponent(o,r)}function ixt(t,e){return e.hidePostingForm?null:rxt}function sxt(t,e,o){var r=n.insert(e,n.elem("div",Ryt));n.setClass(r,"dnd-overlay_tx-okmsg"),n.setAttribute(r,"data-attach-type","file");var a=o._cp=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"dnd-file"}));var i=o._cr=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"dnd-description-media-file"}));var s=n.insert(e,n.elem("div",Ryt));n.setClass(s,"dnd-overlay_tx-okmsg __second-okmsg"),n.setAttribute(s,"data-attach-type","guess");var u=o._cu=n.appendChild(s,n.createComponent("msg-icon",xe,t));n.mountComponent(u,n.propsSet(u,{icon:"dnd-media"}));var c=o._cw=n.appendChild(s,n.createComponent("msg-l10n",ae,t));n.mountComponent(c,n.propsSet(c,{key:"dnd-description-media"}))}function uxt(t,e,o){var r=n.insert(e,n.elem("div",Ryt));n.setClass(r,"dnd-overlay_tx-okmsg");var a=o._d1=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"dnd-file"}));var i=o._d3=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"dnd-description"}))}function cxt(t){return"MEDIA"===t.state.dnd?sxt:uxt}function pxt(t,e){n.updateBlock(e._cl)}function lxt(t,e,o){return o._ck?pxt(0,o):function(t,e,o){var r=o._ck=n.insert(e,n.elem("div",Ryt)),a=n.createInjector(r);n.setClass(r,"dnd-overlay-okmsg js-dnd-overlay"),o._cl=n.mountBlock(t,a,cxt)}(t,e,o),n.animate(o._ck,n.createAnimation("global:msg-fade-in 0.3s",Ryt)),mxt}function mxt(t,e){pxt(0,e)}function dxt(t){return t.state.dnd?lxt:null}function _xt(t,e,o){var r=o._au=n.insert(e,n.elem("footer",Ryt)),a=n.createInjector(r);return n.setPendingRef(o._1,"footer",r),o._av=n.mountBlock(t,a,zEt),o._b6=n.mountBlock(t,a,JEt),o._c2=n.mountBlock(t,a,ext),o._c7=n.mountBlock(t,a,ixt),o._cf=n.mountBlock(t,e,dxt),fxt}function fxt(t,e){n.setPendingRef(e._1,"footer",e._au),n.updateBlock(e._av),n.updateBlock(e._b6),n.updateBlock(e._c2),n.updateBlock(e._c7),n.updateBlock(e._cf)}function gxt(t,e){return e.isPostingEnabled?_xt:jEt}function vxt(t,e,o){return o._an=n.mountBlock(t,e,gxt),hxt}function hxt(t,e){n.updateBlock(e._an)}function Cxt(t){return n.get(t.props.chat,"search")?null:vxt}function kxt(t,e,o){var r=o._d9=n.insert(e,n.createComponent("msg-chat-background-movie",Zot,t));return n.setPendingRef(o._1,"movieBg",r),n.mountComponent(r),bxt}function bxt(t,e){n.setPendingRef(e._1,"movieBg",e._d9)}function yxt(t){return n.get(t.store.data.config,"server","play-video-bg")&&t.state.tvBackgroundEnabled?kxt:null}function Sxt(t,e,n,o){e.chat=n.props.chat,e.alert=o.alert,e.content=n.state.asideContent,e.data=n.state.asideContentData}function wxt(t,e,n,o){e.chats=n.store.data.chatList,e.next=n.store.data.chatMarker,e.contacts=n.store.data.contacts,e.class=o.narrowForward?"narrow-okmsg":""}function Ext(t,e){var o=e._dh,r=e._di;wxt(0,r,t,e),n.updateComponent(o,r)}function xxt(t,e,o){return o._dh?Ext(t,o):function(t,e,o){var r=o._dh=n.insert(e,n.createComponent("msg-forward-form",tnt,t)),a=o._di=n.propsSet(r,{disableBack:!0,"data-tsid":"user_and_chat_block"});wxt(0,a,t,o),o._dj=n.addEvent(r,"submit",Iyt,t,o),o._dk=n.addEvent(r,"cancel",Ayt,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._dh,n.createAnimation("show-forward 0.5s cubic-bezier(0.19, 1, 0.22, 1)",Ryt)),Ixt}function Ixt(t,e){Ext(t,e)}function Bxt(t){return t.state.forward?xxt:null}function Mxt(t,e,n){e.message=n.state.messageControls}function Axt(t,e){t.setState({messageControls:null})}function Txt(t,e){t.setState({messageControls:null})}function jxt(t,e){var o=e._dr,r=e._ds;Mxt(0,r,t),n.updateComponent(o,r)}function Pxt(t,e,o){return o._dr?jxt(t,o):function(t,e,o){var r=o._dr=n.insert(e,n.createComponent("msg-message-controls-modal",Ikt,t)),a=o._ds=n.propsSet(r);Mxt(0,a,t),o._dt=n.addEvent(r,"close",Axt,t,o),o._du=n.addEvent(r,"click",Txt,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._dr,n.createAnimation("panel 0.5s cubic-bezier(0.19, 1, 0.22, 1)",Ryt)),Rxt}function Rxt(t,e){jxt(t,e)}function Lxt(t){return t.state.messageControls?Pxt:null}function Oxt(t,e){t.setState({messageControls:null})}function zxt(t,e,o){!o._e0&&function(t,e,o){var r=o._e0=n.insert(e,n.elem("div",Ryt));n.setClass(r,"menu-overlay-okmsg"),o._e1=n.addEvent(r,"click",Oxt,t,o)}(t,e,o),n.animate(o._e0,n.createAnimation("global:msg-fade-in 0.2s linear",Ryt))}function Dxt(t){return t.state.messageControls?zxt:null}function Uxt(t,e){var o=t.componentView;zyt();var r=n.createInjector(o),a=e._1=n.obj();Uyt(t,e);var i=e._1d=n.insert(r,n.createComponent("msg-toolbar",qk,t)),s=i.componentModel.input,u=e._1e=n.pendingEvents(t,i);qyt(t,e);var c=n.insert(s,n.elem("div",Ryt),""),p=n.createInjector(c);n.setClass(c,"flex-container-okmsg"),e._1j=n.mountBlock(t,p,Qyt);var l=e._21=n.insert(p,n.createComponent("msg-chat-item-container",eb,t)),m=l.componentModel.input,d=e._23=n.insert(m,n.createComponent("msg-chat-image",db,t),"image"),_=e._24=n.propsSet(d,{slot:"image",size:"small",masked:!0});Jyt(0,_,t),n.mountComponent(d,_),e._25=n.mountBlock(t,m,iSt),e._2m=n.mountBlock(t,m,fSt),n.mountComponent(l,n.propsSet(l,{size:"small"})),e._34=n.mountBlock(t,s,xSt),e._41=n.mountBlock(t,s,qwt),n.finalizePendingEvents(u),n.mountComponent(i,n.propsSet(i,{"data-tsid":"toolbar"}));var f=e._80=n.insert(r,n.elem("div",Ryt));Hwt(f,e._81=n.obj(),t,e);var g=n.appendChild(f,n.elem("section",Ryt)),v=n.createInjector(g);e._83=n.addEvent(g,"click",uyt,t,e),e._84=n.mountBlock(t,v,Vwt),e._8c=n.mountBlock(t,v,Ywt);var h=e._8i=n.insert(v,n.createComponent("msg-chat-header",tkt,t)),C=e._8j=n.propsSet(h);Xwt(0,C,t,e),e._8k=n.addEvent(h,"animate",dyt,t,e),e._8l=n.addEvent(h,"reset-search",fyt,t,e),e._8m=n.addEvent(h,"pin-click",Qwt,t,e),n.mountComponent(h,C),e._8n=n.mountBlock(t,v,$wt);var k=e._8u=n.insert(v,n.elem("div",Ryt)),b=n.createInjector(k);Zwt(k,e._8v=n.obj(),0,e),e._8w=n.mountBlock(t,b,pEt),e._9e=n.mountBlock(t,b,AEt),e._ak=n.mountBlock(t,v,Cxt),e._d6=n.mountBlock(t,v,yxt);var y=e._da=n.appendChild(f,n.createComponent("msg-chat-aside",zvt,t)),S=e._db=n.propsSet(y);return Sxt(0,S,t,e),n.mountComponent(y,S),e._dc=n.mountBlock(t,r,Bxt),e._dm=n.mountBlock(t,r,Lxt),e._dv=n.mountBlock(t,r,Dxt),Dyt(),n.subscribeStore(t,["config","isMobile","isSmallScreen","l10n","audioPlayer","assets","chatList","chatMarker","contacts"]),n.finalizePendingRefs(t,a),Nxt}function Nxt(t,e){var o=e._1d,r=e._21,a=e._23,i=e._24,s=e._8i,u=e._8j,c=e._da,p=e._db;zyt(),Uyt(t,e),qyt(t,e),n.updateBlock(e._1j),Jyt(0,i,t),n.updateComponent(a,i),n.updateBlock(e._25),n.updateBlock(e._2m),n.updateIncomingSlot(r,"title",Lyt[1]),n.updateIncomingSlot(r,"",Lyt[4]),n.updateBlock(e._34),n.updateBlock(e._41),n.finalizePendingEvents(e._1e),n.updateIncomingSlot(o,"",Lyt[0]),n.updateIncomingSlot(o,"controls",Lyt[5]),Hwt(e._80,e._81,t,e),n.updateBlock(e._84),n.updateBlock(e._8c),Xwt(0,u,t,e),n.updateComponent(s,u),n.updateBlock(e._8n),Zwt(e._8u,e._8v,0,e),n.updateBlock(e._8w),n.updateBlock(e._9e),n.updateBlock(e._ak),n.updateBlock(e._d6),Sxt(0,p,t,e),n.updateComponent(c,p),n.updateBlock(e._dc),n.updateBlock(e._dm),n.updateBlock(e._dv),Dyt(),n.finalizePendingRefs(t,e._1)}Vyt.dispose=function(t){t._1o=n.removeEvent("click",t._1o),t._1p=n.unmountComponent(t._1p),t._1m=n.unmountComponent(t._1m),t._1n=null,Lyt[0]=1},Yyt.dispose=function(t){t._1w=n.removeEvent("click",t._1w),t._1x=n.unmountComponent(t._1x),t._1u=n.unmountComponent(t._1u),t._1v=null,Lyt[0]=1},eSt.dispose=function(t){t._2a=n.removeEvent("click",t._2a),t._2b=n.unmountComponent(t._2b),t._29=t._2c=t._2d=t._28=null,Lyt[1]=1},rSt.dispose=function(t){t._2h=n.unmountComponent(t._2h),t._2i=t._2j=null,Lyt[1]=1},sSt.dispose=function(t){t._2p=n.unmountComponent(t._2p),Lyt[4]=1},uSt.dispose=function(t){t._2x=n.unmountComponent(t._2x),Lyt[4]=1},pSt.dispose=function(t){t._2u=n.unmountBlock(t._2u),Lyt[4]=1},dSt.dispose=function(t){t._32=n.unmountComponent(t._32),t._33=null,Lyt[4]=1},wSt.dispose=function(t){t._39=n.removeEvent("click",t._39),t._3c=n.removeEvent("click",t._3c),t._3d=n.unmountComponent(t._3d),t._3a=n.unmountComponent(t._3a),t._3j=n.removeEvent("click",t._3j),t._3k=n.unmountComponent(t._3k),t._3h=n.unmountComponent(t._3h),t._3p=n.removeEvent("click",t._3p),t._3q=n.unmountComponent(t._3q),t._3n=n.unmountComponent(t._3n),t._3v=n.removeEvent("click",t._3v),t._3w=n.unmountComponent(t._3w),t._3t=n.unmountComponent(t._3t),t._37=n.unmountComponent(t._37),t._38=t._3b=t._3i=t._3l=t._3o=t._3u=null,Lyt[5]=1},ASt.dispose=function(t){t._4m=n.removeEvent("click",t._4m),t._4n=n.unmountComponent(t._4n),t._4k=n.unmountComponent(t._4k),t._4u=n.removeEvent("click",t._4u),t._4v=n.unmountComponent(t._4v),t._4s=n.unmountComponent(t._4s),t._4p=t._4x=null,Lyt[6]=1},LSt.dispose=function(t){t._56=n.removeEvent("click",t._56),t._57=n.unmountComponent(t._57),t._54=n.unmountComponent(t._54),t._55=t._59=null,Lyt[6]=1},NSt.dispose=function(t){t._5g=n.detachPendingEvents(t._5g),t._5j=n.unmountComponent(t._5j),t._5f=n.unmountComponent(t._5f),t._5h=t._5l=null,Lyt[6]=1},KSt.dispose=function(t){t._5t=n.removeEvent("click",t._5t),t._5u=n.unmountComponent(t._5u),t._5r=n.unmountComponent(t._5r),t._5s=t._5w=null,Lyt[6]=1},QSt.dispose=function(){Lyt[12]=1},$St.dispose=function(t){t._64=n.removeEvent("click",t._64),t._65=n.unmountBlock(t._65),t._6a=n.unmountComponent(t._6a),t._62=n.unmountComponent(t._62),t._63=t._6c=null,Lyt[6]=1},ewt.dispose=function(t){t._49=n.removeEvent("click",t._49),t._4c=n.unmountComponent(t._4c),t._4a=n.unmountComponent(t._4a),t._4h=n.unmountBlock(t._4h),t._51=n.unmountBlock(t._51),t._5c=n.unmountBlock(t._5c),t._5o=n.unmountBlock(t._5o),t._5z=n.unmountBlock(t._5z),t._4f=n.unmountComponent(t._4f),t._47=n.unmountComponent(t._47),Lyt[5]=1},swt.dispose=function(t){t._6m=n.removeEvent("click",t._6m),t._6n=n.unmountComponent(t._6n),t._6k=n.unmountComponent(t._6k),t._6s=n.removeEvent("click",t._6s),t._6t=n.unmountComponent(t._6t),t._6q=n.unmountComponent(t._6q),t._6l=t._6r=null,Lyt[5]=1},dwt.dispose=function(t){t._71=n.removeEvent("click",t._71),t._72=n.unmountComponent(t._72),t._6z=n.unmountComponent(t._6z),t._70=t._73=null,Lyt[5]=1},Cwt.dispose=function(t){t._7a=n.removeEvent("click",t._7a),t._7b=n.unmountComponent(t._7b),t._78=n.unmountComponent(t._78),t._79=t._7c=null,Lyt[5]=1},Ewt.dispose=function(t){t._7j=n.removeEvent("click",t._7j),t._7k=n.unmountComponent(t._7k),t._7h=n.unmountComponent(t._7h),t._7i=t._7l=null,Lyt[5]=1},Awt.dispose=function(){Lyt[14]=1},Pwt.dispose=function(t){t._7s=n.removeEvent("click",t._7s),t._7t=n.unmountBlock(t._7t),t._7y=n.unmountComponent(t._7y),t._7q=n.unmountComponent(t._7q),t._7r=t._7z=null,Lyt[5]=1},Owt.dispose=function(t){t._6h=n.unmountBlock(t._6h),t._6w=n.unmountBlock(t._6w),t._75=n.unmountBlock(t._75),t._7e=n.unmountBlock(t._7e),t._7n=n.unmountBlock(t._7n)},Uwt.dispose=function(t){t._44=n.unmountBlock(t._44)},Fwt.dispose=function(t,e){n.animate(t._89,n.createAnimation("global:msg-fade-out 0.2s",Ryt),(function(){return function(t){t._8a=n.removeEvent("click",t._8a),t._89=n.domRemove(t._89)}(t)}))},Wwt.dispose=function(t){t._8h=n.removeEvent("submit",t._8h),t._8f=n.unmountComponent(t._8f),t._8g=null},Jwt.dispose=function(t,e){var o=t._8s;n.animate(o,ZU(0,{duration:300,easing:nN}),(function(){return function(t){var e=t._8s;t._8s=n.unmountComponent(e),n.domRemove(e)}(t)}))},eEt.dispose=function(t){t._92=n.unmountComponent(t._92),t._93=null},rEt.dispose=function(t){t._97=n.unmountComponent(t._97)},iEt.dispose=function(t){t._9c=n.unmountComponent(t._9c)},uEt.dispose=function(t){t._8z=n.unmountBlock(t._8z),t._94=n.unmountBlock(t._94),t._99=n.unmountBlock(t._99)},mEt.dispose=function(t){t._9h=n.unmountComponent(t._9h),t._9i=null},vEt.dispose=function(t,e){n.animate(t._9s,n.createAnimation("hide-typing 0.15s ease-in",Ryt),(function(){return function(t){var e=t._9s;t._9s=n.unmountComponent(e),n.domRemove(e),t._9t=null}(t)}))},kEt.dispose=function(t){t._9l=n.unmountComponent(t._9l),t._9n=n.unmountBlock(t._9n),t._9m=null},yEt.dispose=function(t){t._9w=n.unmountComponent(t._9w)},SEt.dispose=function(t){t._a2=n.unmountComponent(t._a2)},EEt.dispose=function(t){t._a8=n.unmountComponent(t._a8),t._a9=t._aa=null},BEt.dispose=function(t){t._af=n.unmountComponent(t._af),t._ai=n.unmountComponent(t._ai),t._ag=null},jEt.dispose=function(t){t._aq=n.unmountComponent(t._aq),t._ar=null},LEt.dispose=function(t){t._b0=n.removeEvent("toggle-stickers",t._b0),t._b1=n.removeEvent("reload-stickers",t._b1),t._b2=n.removeEvent("close-link",t._b2),t._b3=n.removeEvent("pick-sticker",t._b3),t._b4=n.removeEvent("animate",t._b4),t._ay=n.unmountComponent(t._ay),t._az=null},NEt.dispose=function(t){t._bg=n.unmountComponent(t._bg),t._bi=n.unmountComponent(t._bi),t._bh=t._bj=t._bk=null},FEt.dispose=function(t){t._bo=n.unmountComponent(t._bo),t._bp=null},KEt.dispose=function(t){t._bs=n.unmountComponent(t._bs),t._bt=null},XEt.dispose=function(t,e){var o=t._bb;n.animate(o,iN(0,e,{duration:300}),(function(){return function(t){t._bd=n.unmountBlock(t._bd),t._by=n.removeEvent("click",t._by),t._bz=n.unmountComponent(t._bz),t._bw=n.unmountComponent(t._bw),t._bb=n.domRemove(t._bb)}(t)}))},ZEt.dispose=function(t){t._c5=n.unmountComponent(t._c5),t._c6=null},rxt.dispose=function(t){t._cc=n.removeEvent("animate",t._cc),t._cd=n.removeEvent("record-video",t._cd),t._ce=n.removeEvent("editor-update",t._ce),t._ca=n.unmountComponent(t._ca),t._cb=null},sxt.dispose=function(t){t._cp=n.unmountComponent(t._cp),t._cr=n.unmountComponent(t._cr),t._cu=n.unmountComponent(t._cu),t._cw=n.unmountComponent(t._cw)},uxt.dispose=function(t){t._d1=n.unmountComponent(t._d1),t._d3=n.unmountComponent(t._d3)},lxt.dispose=function(t,e){n.animate(t._ck,n.createAnimation("global:msg-fade-out 0.3s",Ryt),(function(){return function(t){t._cl=n.unmountBlock(t._cl),t._ck=n.domRemove(t._ck)}(t)}))},_xt.dispose=function(t){t._av=n.unmountBlock(t._av),t._b6=n.unmountBlock(t._b6),t._c2=n.unmountBlock(t._c2),t._c7=n.unmountBlock(t._c7),t._cf=n.unmountBlock(t._cf),t._au=null},vxt.dispose=function(t){t._an=n.unmountBlock(t._an)},kxt.dispose=function(t){t._d9=n.unmountComponent(t._d9)},xxt.dispose=function(t,e){n.animate(t._dh,n.createAnimation("hide-forward 0.2s ease-out",Ryt),(function(){return function(t){var e=t._dh;t._dj=n.removeEvent("submit",t._dj),t._dk=n.removeEvent("cancel",t._dk),t._dh=n.unmountComponent(e),n.domRemove(e),t._di=null}(t)}))},Pxt.dispose=function(t,e){n.animate(t._dr,n.createAnimation("panel 0.2s ease-out reverse",Ryt),(function(){return function(t){var e=t._dr;t._dt=n.removeEvent("close",t._dt),t._du=n.removeEvent("click",t._du),t._dr=n.unmountComponent(e),n.domRemove(e),t._ds=null}(t)}))},zxt.dispose=function(t,e){n.animate(t._e0,n.createAnimation("global:msg-fade-in 0.2s linear reverse",Ryt),(function(){return function(t){t._e1=n.removeEvent("click",t._e1),t._e0=n.domRemove(t._e0)}(t)}))},Uxt.dispose=function(t){zyt(),t._1e=n.detachPendingEvents(t._1e),t._1j=n.unmountBlock(t._1j),t._23=n.unmountComponent(t._23),t._25=n.unmountBlock(t._25),t._2m=n.unmountBlock(t._2m),t._21=n.unmountComponent(t._21),t._34=n.unmountBlock(t._34),t._41=n.unmountBlock(t._41),t._1d=n.unmountComponent(t._1d),t._83=n.removeEvent("click",t._83),t._84=n.unmountBlock(t._84),t._8c=n.unmountBlock(t._8c),t._8k=n.removeEvent("animate",t._8k),t._8l=n.removeEvent("reset-search",t._8l),t._8m=n.removeEvent("pin-click",t._8m),t._8i=n.unmountComponent(t._8i),t._8n=n.unmountBlock(t._8n),t._8w=n.unmountBlock(t._8w),t._9e=n.unmountBlock(t._9e),t._ak=n.unmountBlock(t._ak),t._d6=n.unmountBlock(t._d6),t._da=n.unmountComponent(t._da),t._dc=n.clearBlock(t._dc),t._dm=n.clearBlock(t._dm),t._dv=n.clearBlock(t._dv),Dyt()};var qxt={__proto__:null,cssScope:Ryt,default:Uxt,slideDown:$U,slideUp:ZU,easeOutCubic:nN,slideUpNotify:iN,slideDownNotify:aN,navigateGroup:$n,goTo:Qp,toggleStickerDisplay:qbt,closeLink:Hbt,reloadStickers:Fbt,goBack:tl,extend:Qbt,state:function(t){return{_dndStack:0,_handleEvent:Eyt(t),asideContent:[],asideContentData:null,search:0,_time:o.logTime("msg-chat"),editableBgEnabled:!1,hideAlertBarImportantClicked:!1,tvSilent:!0}},willMount:function(t){var e,n=t.state._handleEvent;ee(t,"mousedown",n),ee(t,"dragenter",n,!0),ee(t,"dragleave",n);var o=Ei(t),r=t.store.get().config;t.setState({editableBgEnabled:YU(),tvBackgroundEnabled:r.server["play-video-bg"]&&(null===(e=null==o?void 0:o.TV)||void 0===e?void 0:e.enabled)})},willUnmount:function(t){var e=t.state._handleEvent;ne(t,"mousedown",e),ne(t,"dragenter",e,!0),ne(t,"dragleave",e)},didChange:function(t,e){var n,o,r,a=e.chat;if(a){var i=t.state,s=i.prevUrl,u=!a.current.selectedMessages||!a.current.selectedMessages.length,c=a.current&&a.current.id,l=a.current,m=a.prev;m&&c===m.id?"DIALOG"===l.type&&l.joinTime!==m.joinTime&&1===m.joinTime&&Kbt(t,c):(Zt(t,"log-screen",l.type),m&&(t.closeSearch(),byt(t),myt(t)),u=!0,i._lastSelected=null,i._lastUnselected=null,s=Kp.state.prev,Kbt(t,c),_yt(t,!0),Tyt(t,!1),Jbt(t)),t.setState({prevUrl:s,shouldFocus:xyt(a),forward:u?null:i.forward}),m&&m.hasBots||!l||!l.hasBots||Zt(t,"chat-update-commands",{chatId:c}),Ybt||(Zt(t,"log-external",{type:"scalar",param:"chat-opened"}),Ybt=!0),(l&&(!m||l.messages&&!m.messages)||xm(l,"lastMessage.id")!==xm(m,"lastMessage.id"))&&function(t){var e=t.props.chat,n=t.state.additional;if("DIALOG"===e.type&&n&&xm(n,"sendActionCongrats")){var o=null;Promise.resolve().then((function(){var n=t.refs.postingForm,r=p(e.messages);n&&(r.slice(Math.max(r.length-10,0)).reverse().find((function(t){var e=!t.sender.current&&t.attaches&&t.attaches.find((function(t){return"SEND_ACTION"===t._type}));return e&&(o=e.nextContentType),e})),n.updateCongrats(o))}))}}(t),(null===(n=null==m?void 0:m.owner)||void 0===n?void 0:n.current)&&(null===(o=null==l?void 0:l.owner)||void 0===o?void 0:o.id)!==(null===(r=null==m?void 0:m.owner)||void 0===r?void 0:r.id)&&Jbt(t)}},didRender:function(t){t.state._time()},events:Zbt,onToggleTVBg:tyt,onSwitchTV:eyt,onToggleTVFullscreen:nyt,onToggleTVSound:oyt,plugins:ayt,didMount:function(t){ryt(t)},resetPostingLink:iyt,onPickSticker:syt,hideAsideOverlay:uyt,onCallStart:cyt,toggleAsideContent:pyt,onSearchMessages:function(t,e){Zt(t,"message-search",{chatId:t.props.chat.id,query:e.target.value})},onSubmitRecordedVideo:lyt,handleMessageListResize:dyt,onResetSearch:fyt,forwardFormSubmit:Iyt,onBack:Byt,onEditorUpdate:Myt,forwardFormReset:Ayt};var Hxt="ebdl02v";function Fxt(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",Hxt)),e._2=n.mountSlot(t,"")}Fxt.dispose=function(t){t._2=n.unmountSlot(t._2)};var Vxt={__proto__:null,cssScope:Hxt,default:Fxt,props:function(){return{type:""}}};var Kxt=[0,0],Wxt=[];function Gxt(){Wxt.push(Kxt),Kxt=[0,0]}function Yxt(){Kxt=Wxt.pop()}function Xxt(t,e,n){e.chat=n.props.chat}function Qxt(t,e){var o=t.componentView;Gxt();var r=e._1=n.appendChild(o,n.createComponent("msg-chat-alerts",Ly,t)),a=r.componentModel.input,i=e._2=n.propsSet(r);Xxt(0,i,t);var s=e._3=n.insert(a,n.createComponent("msg-notification-bubble",Vxt,t),"on"),u=s.componentModel.input;e._5=n.insert(u,n.text(n.get(t.props.chat,"unreadCount"))),n.mountComponent(s,n.propsSet(s,{slot:"on","data-tsid":"new_msg_bubble"}));var c=e._7=n.insert(a,n.createComponent("msg-notification-bubble",Vxt,t),"off"),p=c.componentModel.input;return e._9=n.insert(p,n.text(n.get(t.props.chat,"unreadCount"))),n.mountComponent(c,n.propsSet(c,{type:"muted",slot:"off","data-tsid":"new_msg_bubble_mute"})),n.mountComponent(r,i),Yxt(),Jxt}function Jxt(t,e){var o=e._1,r=e._2;Gxt(),Xxt(0,r,t),Kxt[0]|=n.updateText(e._5,n.get(t.props.chat,"unreadCount")),n.updateIncomingSlot(e._3,"",Kxt[0]),Kxt[1]|=n.updateText(e._9,n.get(t.props.chat,"unreadCount")),n.updateIncomingSlot(e._7,"",Kxt[1]),n.updateComponent(o,r),Yxt()}Qxt.dispose=function(t){Gxt(),t._3=n.unmountComponent(t._3),t._7=n.unmountComponent(t._7),t._1=n.unmountComponent(t._1),Yxt()};var $xt={__proto__:null,cssScope:"e-4c2e2n",default:Qxt,props:function(){return{chat:null}}},Zxt="e-ezdtmt";function tIt(t,e){e.control=n.get(t.props.message,"attaches",0),e.gender=n.get(t.props.message,"sender","gender")}function eIt(t,e,o){e.key="created-"+("CHANNEL"==n.get(o.props.message,"type")?"channel":"new-chat")}function nIt(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._9=n.propsSet(r);return eIt(0,a,t),n.mountComponent(r,a),oIt}function oIt(t,e){var o=e._8,r=e._9;eIt(0,r,t),n.updateComponent(o,r)}function rIt(t,e,n,o){e["data-gender"]=o.gender}function aIt(t,e,o){o._k=n.insert(e,n.text(" "));var r=o._l=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"and"})),o._n=n.insert(e,n.text(" "));var a=n.insert(e,n.elem("span",Zxt));return n.setClass(a,"msg-user-okmsg"),o._p=n.appendChild(a,n.text(n.get(o.control,"users",1,"name"))),iIt}function iIt(t,e){n.updateText(e._k," "),n.updateText(e._n," "),n.updateText(e._p,n.get(e.control,"users",1,"name"))}function sIt(t,e,o){n.insert(e,n.text("\n                        , "));var r=n.insert(e,n.elem("span",Zxt));n.setClass(r,"msg-user-okmsg"),o._u=n.appendChild(r,n.text(n.get(o.control,"users",1,"name"))),o._v=n.insert(e,n.text(" "));var a=o._w=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{key:"and"})),o._y=n.insert(e,n.text(" "));var i=n.insert(e,n.elem("span",Zxt));return n.setClass(i,"span-okmsg"),o._10=n.appendChild(i,n.text(Tt(0,n.get(o.control,"users"))-2)),uIt}function uIt(t,e){n.updateText(e._u,n.get(e.control,"users",1,"name")),n.updateText(e._v," "),n.updateText(e._y," "),n.updateText(e._10,Tt(0,n.get(e.control,"users"))-2)}function cIt(t,e){return 2===Tt(0,n.get(e.control,"users"))?aIt:Tt(0,n.get(e.control,"users"))>2?sIt:null}function pIt(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._d=n.propsSet(r,{key:"added"});rIt(0,a,0,o),n.mountComponent(r,a),o._e=n.insert(e,n.text(" "));var i=n.insert(e,n.elem("span",Zxt));return n.setClass(i,"msg-user-okmsg"),o._g=n.appendChild(i,n.text(n.get(o.control,"users",0,"name"))),o._h=n.mountBlock(t,e,cIt),lIt}function lIt(t,e){var o=e._c,r=e._d;rIt(0,r,0,e),n.updateComponent(o,r),n.updateText(e._e," "),n.updateText(e._g,n.get(e.control,"users",0,"name")),n.updateBlock(e._h)}function mIt(t,e,n,o){e["data-gender"]=o.gender}function dIt(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._14=n.propsSet(r,{key:"deleted"});mIt(0,a,0,o),n.mountComponent(r,a),o._15=n.insert(e,n.text(" "));var i=n.insert(e,n.elem("span",Zxt));return n.setClass(i,"msg-user-okmsg"),o._17=n.appendChild(i,n.text(n.get(o.control,"user","name"))),_It}function _It(t,e){var o=e._13,r=e._14;mIt(0,r,0,e),n.updateComponent(o,r),n.updateText(e._15," "),n.updateText(e._17,n.get(e.control,"user","name"))}function fIt(t,e,n,o){e["data-gender"]=o.gender}function gIt(t,e,o){var r=o._1a=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1b=n.propsSet(r,{key:"left-chat"});return fIt(0,a,0,o),n.mountComponent(r,a),vIt}function vIt(t,e){var o=e._1a,r=e._1b;fIt(0,r,0,e),n.updateComponent(o,r)}function hIt(t,e,n,o){e["data-gender"]=o.gender}function CIt(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1f=n.propsSet(r,{key:"joinByLink"});return hIt(0,a,0,o),n.mountComponent(r,a),kIt}function kIt(t,e){var o=e._1e,r=e._1f;hIt(0,r,0,e),n.updateComponent(o,r)}function bIt(t,e,o,r){e.key=(n.get(r.control,"title")?"changed":"removed")+"-chat-title",e["data-gender"]=r.gender}function yIt(t,e,o){var r=o._1i=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1j=n.propsSet(r);return bIt(0,a,0,o),n.mountComponent(r,a),SIt}function SIt(t,e){var o=e._1i,r=e._1j;bIt(0,r,0,e),n.updateComponent(o,r)}function wIt(t,e,o,r){e.key=(n.get(r.control,"url")?"changed":"removed")+"-chat-icon",e["data-gender"]=r.gender}function EIt(t,e,o){var r=o._1m=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1n=n.propsSet(r);return wIt(0,a,0,o),n.mountComponent(r,a),xIt}function xIt(t,e){var o=e._1m,r=e._1n;wIt(0,r,0,e),n.updateComponent(o,r)}function IIt(t,e,n,o){e["data-gender"]=o.gender}function BIt(t,e,o){var r=o._1q=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1r=n.propsSet(r,{key:"changed-pinned-message"});return IIt(0,a,0,o),n.mountComponent(r,a),MIt}function MIt(t,e){var o=e._1q,r=e._1r;IIt(0,r,0,e),n.updateComponent(o,r)}function AIt(t,e,n,o){e["data-gender"]=o.gender}function TIt(t,e,o){var r=o._1u=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1v=n.propsSet(r,{key:"bot-started"});return AIt(0,a,0,o),n.mountComponent(r,a),jIt}function jIt(t,e){var o=e._1u,r=e._1v;AIt(0,r,0,e),n.updateComponent(o,r)}function PIt(t,e,o){return o._1y=n.insert(e,n.text(n.get(o.control,"shortMessage"))),RIt}function RIt(t,e){n.updateText(e._1y,n.get(e.control,"shortMessage"))}function LIt(t,e){return"new"==n.get(e.control,"event")?nIt:"add"==n.get(e.control,"event")?pIt:"remove"==n.get(e.control,"event")?dIt:"leave"==n.get(e.control,"event")?gIt:"joinByLink"==n.get(e.control,"event")?CIt:"title"==n.get(e.control,"event")?yIt:"icon"==n.get(e.control,"event")?EIt:"pin"==n.get(e.control,"event")?BIt:"botStarted"==n.get(e.control,"event")?TIt:"system"==n.get(e.control,"event")?PIt:null}function OIt(t,e){var o=t.componentView;tIt(t,e);var r=n.appendChild(o,n.elem("div",Zxt)),a=n.createInjector(r);return n.setClass(r,"message-okmsg"),e._5=n.mountBlock(t,a,LIt),zIt}function zIt(t,e){tIt(t,e),n.updateBlock(e._5)}nIt.dispose=function(t){t._8=n.unmountComponent(t._8),t._9=null},aIt.dispose=function(t){t._l=n.unmountComponent(t._l),t._k=t._n=t._p=null},sIt.dispose=function(t){t._w=n.unmountComponent(t._w),t._u=t._v=t._y=t._10=null},pIt.dispose=function(t){t._c=n.unmountComponent(t._c),t._h=n.unmountBlock(t._h),t._d=t._e=t._g=null},dIt.dispose=function(t){t._13=n.unmountComponent(t._13),t._14=t._15=t._17=null},gIt.dispose=function(t){t._1a=n.unmountComponent(t._1a),t._1b=null},CIt.dispose=function(t){t._1e=n.unmountComponent(t._1e),t._1f=null},yIt.dispose=function(t){t._1i=n.unmountComponent(t._1i),t._1j=null},EIt.dispose=function(t){t._1m=n.unmountComponent(t._1m),t._1n=null},BIt.dispose=function(t){t._1q=n.unmountComponent(t._1q),t._1r=null},TIt.dispose=function(t){t._1u=n.unmountComponent(t._1u),t._1v=null},PIt.dispose=function(t){t._1y=null},OIt.dispose=function(t){t._5=n.unmountBlock(t._5)};var DIt={__proto__:null,cssScope:Zxt,default:OIt};var UIt="e-gycx31",NIt=[0,0,0],qIt=[];function HIt(){qIt.push(NIt),NIt=[0,0,0]}function FIt(){NIt=qIt.pop()}function VIt(t,e){e.gif="PHOTO"===t.props.type&&n.get(t.props.attachment,"gif"),e.transcriptionEnabled=n.get(t.store.data.config,"server","audio-transcription-enabled")&&n.get(t.store.data.config,"user","AUDIO_TRANSCRIPTION_ENABLED"),e.chooseExpr="STICKER"===t.props.type?0:"CONTROL"===t.props.type?1:"FILE"===t.props.type?2:"MUSIC"===t.props.type?3:"CONTACT"===t.props.type?4:"LOCATION"===t.props.type?5:"CALL"===t.props.type?6:7,e.caseExpr_6=6===e.chooseExpr,e.hangupType=e.caseExpr_6?n.get(t.props.hangupType,n.get(t.props.attachment,"hangupType"),n.get(t.props.message,"sender","current")?0:1)||Pt(0,n.get(t.props.attachment,"hangupType")):void 0}function KIt(t,e,o){var r=n.insert(e,n.elem("span",UIt));n.setClass(r,"attachment-icon-okmsg");var a=o._e=n.appendChild(r,n.createComponent("msg-parsed-text",ii,t)),i=a.componentModel.input;return o._g=n.insert(i,n.text(n.get(t.props.attachment,"tags",0))),n.mountComponent(a,n.propsSet(a,{disableLinks:!0,userStickerSize:"compact"})),WIt}function WIt(t,e){NIt[0]|=n.updateText(e._g,n.get(t.props.attachment,"tags",0)),n.updateIncomingSlot(e._e,"",NIt[0])}function GIt(t){return n.get(t.props.attachment,"tags",0)?KIt:null}function YIt(t,e,o){o._a=n.mountBlock(t,e,GIt);var r=o._i=n.insert(e,n.createComponent("msg-l10n",ae,t));return n.mountComponent(r,n.propsSet(r,{key:"sticker"})),XIt}function XIt(t,e){n.updateBlock(e._a)}function QIt(t,e,n){e.message=n.props.message}function JIt(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-chat-last-control-message",DIt,t)),a=o._n=n.propsSet(r);return QIt(0,a,t),n.mountComponent(r,a),$It}function $It(t,e){var o=e._m,r=e._n;QIt(0,r,t),n.updateComponent(o,r)}function ZIt(t,e,o){var r=o._q=n.insert(e,n.createComponent("msg-icon",xe,t));return n.mountComponent(r,n.propsSet(r,{icon:"file_12",size:"small"})),o._s=n.insert(e,n.text(n.get(t.props.attachment,"name"))),tBt}function tBt(t,e){n.updateText(e._s,n.get(t.props.attachment,"name"))}function eBt(t,e,o){var r=o._v=n.insert(e,n.createComponent("msg-icon",xe,t));return n.mountComponent(r,n.propsSet(r,{icon:"music_12",size:"small"})),o._x=n.insert(e,n.text(n.get(t.props.attachment,"artistName"))),n.insert(e,n.text(" — ")),o._z=n.insert(e,n.text(n.get(t.props.attachment,"title"))),nBt}function nBt(t,e){n.updateText(e._x,n.get(t.props.attachment,"artistName")),n.updateText(e._z,n.get(t.props.attachment,"title"))}function oBt(t,e,o){var r=o._12=n.insert(e,n.createComponent("msg-icon",xe,t));return n.mountComponent(r,n.propsSet(r,{icon:"user_12",size:"small"})),o._14=n.insert(e,n.text(n.get(t.props.attachment,"user","name")||n.get(t.props.attachment,"name"))),rBt}function rBt(t,e){n.updateText(e._14,n.get(t.props.attachment,"user","name")||n.get(t.props.attachment,"name"))}function aBt(t,e,o){var r=o._17=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"location_12",size:"small"}));var a=o._19=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{key:"location"}))}function iBt(t,e,o){var r=o._1g=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"audio-call_12",size:"small"}))}function sBt(t,e,o){var r=o._1k=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"video-call_12",size:"small"}))}function uBt(t){return"AUDIO"===n.get(t.props.attachment,"callType")?iBt:sBt}function cBt(t,e,o,r){e.key=r.hangupType+"-"+Pt(0,n.get(o.props.attachment,"callType"))+"-call"}function pBt(t,e,o){o._1d=n.mountBlock(t,e,uBt);var r=o._1m=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._1n=n.propsSet(r);return cBt(0,a,t,o),n.mountComponent(r,a),lBt}function lBt(t,e){var o=e._1m,r=e._1n;n.updateBlock(e._1d),cBt(0,r,t,e),n.updateComponent(o,r)}function mBt(t,e,o){var r=o._1t=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"photo_12",size:"small"}))}function dBt(t,e,o){var r=o._1x=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"media-mixed_12",size:"small"}))}function _Bt(t,e,o){var r=o._21=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"microphone_12",size:"small"}))}function fBt(t,e,o){var r=o._25=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"media-share_12",size:"small"}))}function gBt(t,e,o){var r=o._29=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"dailyphoto_12",size:"small"}))}function vBt(t){return"PHOTO"===t.props.type?mBt:"VIDEO"===t.props.type?dBt:"AUDIO"===t.props.type?_Bt:"SHARE"===t.props.type?fBt:"DAILY_MEDIA"===t.props.type?gBt:null}function hBt(t,e,o){e.highlights=o.props.highlights,e.messageElements=n.filter(n.get(o.props.message,"elements"),(function(t){return"HEADING"!==n.get(t,"type")&&"LINK"!==n.get(t,"type")&&"MONOSPACED"!==n.get(t,"type")&&"USER_MENTION"!==n.get(t,"type")}))}function CBt(t,e,o){var r=o._2e=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input,i=o._2f=n.propsSet(r,{disableLinks:!0,disableArt:!0,textEmoji:!0,userSticker:!0,userStickerSize:"compact",class:"message-txt-okmsg",emojiSize:16});return hBt(0,i,t),o._2g=n.insert(a,n.text(n.get(t.props.message,"text"))),n.mountComponent(r,i),kBt}function kBt(t,e){var o=e._2e,r=e._2f;hBt(0,r,t),NIt[1]|=n.updateText(e._2g,n.get(t.props.message,"text")),n.updateIncomingSlot(o,"",NIt[1]),n.updateComponent(o,r)}function bBt(t,e,o){return o._2k=n.insert(e,n.text(n.get(t.props.attachment,"url"))),yBt}function yBt(t,e){n.updateText(e._2k,n.get(t.props.attachment,"url"))}function SBt(t,e,n){e.highlights=n.props.highlights}function wBt(t,e,o){var r=o._2n=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input,i=o._2o=n.propsSet(r,{class:"message-txt-okmsg"});return SBt(0,i,t),o._2p=n.insert(a,n.text(n.get(t.props.attachment,"transcription"))),n.mountComponent(r,i),EBt}function EBt(t,e){var o=e._2n,r=e._2o;SBt(0,r,t),NIt[2]|=n.updateText(e._2p,n.get(t.props.attachment,"transcription")),n.updateIncomingSlot(o,"",NIt[2]),n.updateComponent(o,r)}function xBt(t,e,n){e.key=Pt(0,n.props.type)}function IBt(t,e,o){var r=o._2w=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._2x=n.propsSet(r);return xBt(0,a,t),n.mountComponent(r,a),BBt}function BBt(t,e){var o=e._2w,r=e._2x;xBt(0,r,t),n.updateComponent(o,r)}function MBt(t,e){return e.gif?null:IBt}function ABt(t,e){n.insert(e,n.elemWithText("span","GIF",UIt))}function TBt(t,e){return e.gif?ABt:null}function jBt(t,e,o){return o._2t=n.mountBlock(t,e,MBt),o._2y=n.mountBlock(t,e,TBt),PBt}function PBt(t,e){n.updateBlock(e._2t),n.updateBlock(e._2y)}function RBt(t,e){return n.get(t.props.message,"text")?CBt:"SHARE"===t.props.type?bBt:n.get(t.props.attachment,"transcription")&&e.transcriptionEnabled?wBt:t.props.type?jBt:null}function LBt(t,e,o){return o._1q=n.mountBlock(t,e,vBt),o._2b=n.mountBlock(t,e,RBt),OBt}function OBt(t,e){n.updateBlock(e._1q),n.updateBlock(e._2b)}function zBt(t,e){return[YIt,JIt,ZIt,eBt,oBt,aBt,pBt,LBt][e.chooseExpr]}function DBt(t,e){var o=t.componentView;HIt();var r=n.createInjector(o);return VIt(t,e),e._7=n.mountBlock(t,r,zBt),FIt(),n.subscribeStore(t,["config"]),UBt}function UBt(t,e){HIt(),VIt(t,e),n.updateBlock(e._7),FIt()}KIt.dispose=function(t){t._e=n.unmountComponent(t._e),t._g=null},YIt.dispose=function(t){t._a=n.unmountBlock(t._a),t._i=n.unmountComponent(t._i)},JIt.dispose=function(t){t._m=n.unmountComponent(t._m),t._n=null},ZIt.dispose=function(t){t._q=n.unmountComponent(t._q),t._s=null},eBt.dispose=function(t){t._v=n.unmountComponent(t._v),t._x=t._z=null},oBt.dispose=function(t){t._12=n.unmountComponent(t._12),t._14=null},aBt.dispose=function(t){t._17=n.unmountComponent(t._17),t._19=n.unmountComponent(t._19)},iBt.dispose=function(t){t._1g=n.unmountComponent(t._1g)},sBt.dispose=function(t){t._1k=n.unmountComponent(t._1k)},pBt.dispose=function(t){t._1d=n.unmountBlock(t._1d),t._1m=n.unmountComponent(t._1m),t._1n=null},mBt.dispose=function(t){t._1t=n.unmountComponent(t._1t)},dBt.dispose=function(t){t._1x=n.unmountComponent(t._1x)},_Bt.dispose=function(t){t._21=n.unmountComponent(t._21)},fBt.dispose=function(t){t._25=n.unmountComponent(t._25)},gBt.dispose=function(t){t._29=n.unmountComponent(t._29)},CBt.dispose=function(t){t._2e=n.unmountComponent(t._2e),t._2f=t._2g=null},bBt.dispose=function(t){t._2k=null},wBt.dispose=function(t){t._2n=n.unmountComponent(t._2n),t._2o=t._2p=null},IBt.dispose=function(t){t._2w=n.unmountComponent(t._2w),t._2x=null},jBt.dispose=function(t){t._2t=n.unmountBlock(t._2t),t._2y=n.unmountBlock(t._2y)},LBt.dispose=function(t){t._1q=n.unmountBlock(t._1q),t._2b=n.unmountBlock(t._2b)},DBt.dispose=function(t){HIt(),t._7=n.clearBlock(t._7),FIt()};var NBt={__proto__:null,cssScope:UIt,default:DBt,props:function(){return{message:null,attachment:null,type:"",hangupType:{CANCELED:["canceled","missed"],REJECTED:["outgoing","missed"],HUNGUP:["outgoing","incoming"]}}}};function qBt(t,e){e.attachment=n.get(t.props.message,"attaches",0)}function HBt(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{class:"type-okmsg",size:"small",icon:"mention"}))}function FBt(t,e,o){var r=o._a=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{class:"type-okmsg",size:"small",icon:"reply"}))}function VBt(t){return t.props.hasUnreadMention?HBt:t.props.hasUnreadReply?FBt:null}function KBt(t,e,o){e.url=Wt(0,n.get(o.props.message,"sender"),"nano"),e.id=n.get(o.props.message,"sender","id"),e.caption=n.get(o.props.message,"sender","name")}function WBt(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-avatar",Hp,t)),a=o._k=n.propsSet(r,{size:"nano"});return KBt(0,a,t),n.mountComponent(r,a),GBt}function GBt(t,e){var o=e._j,r=e._k;KBt(0,r,t),n.updateComponent(o,r)}function YBt(t){return"DIALOG"==t.props.chatType&&n.get(t.props.message,"sender","current")||"CHAT"==t.props.chatType||"CHANNEL"==t.props.chatType&&n.get(t.props.message,"sender")?WBt:null}function XBt(t,e,o){return o._g=n.mountBlock(t,e,YBt),QBt}function QBt(t,e){n.updateBlock(e._g)}function JBt(t,e,o){var r=o._n=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"forward_12",class:"fwd-okmsg",size:"small"}))}function $Bt(t){return t.props.forward?JBt:XBt}function ZBt(t,e,o){e.message=n.get(o.props.message,"link","message"),e.chatType=o.props.chatType,e.canDisturb=o.props.canDisturb}function tMt(t,e,o){var r=o._s=n.insert(e,n.createComponent(t.nodeName,t.componentModel.definition,t)),a=o._t=n.propsSet(r,{forward:!0});return ZBt(0,a,t),n.mountComponent(r,a),eMt}function eMt(t,e){var o=e._s,r=e._t;ZBt(0,r,t),n.updateComponent(o,r)}function nMt(t,e,o,r){e.message=o.props.message,e.attachment=r.attachment,e.type=n.get(r.attachment,"_type")}function oMt(t,e,o){var r=o._w=n.insert(e,n.createComponent("msg-chats-list-message",NBt,t)),a=o._x=n.propsSet(r);return nMt(0,a,t,o),n.mountComponent(r,a),rMt}function rMt(t,e){var o=e._w,r=e._x;nMt(0,r,t,e),n.updateComponent(o,r)}function aMt(t){return"FORWARD"==n.get(t.props.message,"link","type")?tMt:oMt}function iMt(t,e){var o=t.componentView,r=n.createInjector(o);return qBt(t,e),e._3=n.mountBlock(t,r,VBt),e._d=n.mountBlock(t,r,$Bt),e._p=n.mountBlock(t,r,aMt),sMt}function sMt(t,e){qBt(t,e),n.updateBlock(e._3),n.updateBlock(e._d),n.updateBlock(e._p)}HBt.dispose=function(t){t._6=n.unmountComponent(t._6)},FBt.dispose=function(t){t._a=n.unmountComponent(t._a)},WBt.dispose=function(t){t._j=n.unmountComponent(t._j),t._k=null},XBt.dispose=function(t){t._g=n.unmountBlock(t._g)},JBt.dispose=function(t){t._n=n.unmountComponent(t._n)},tMt.dispose=function(t){t._s=n.unmountComponent(t._s),t._t=null},oMt.dispose=function(t){t._w=n.unmountComponent(t._w),t._x=null},iMt.dispose=function(t){t._3=n.clearBlock(t._3),t._d=n.clearBlock(t._d),t._p=n.clearBlock(t._p)};var uMt={__proto__:null,cssScope:"esgea31",default:iMt,props:function(){return{message:null,chatType:"DIALOG",forward:!1,canDisturb:!0}}};function cMt(t,e){var n=new a;return t.forEach((function(t){c(t)&&(t.unreadCount||e&&t.lastReaction)&&n.set(t.id,function(t){var e=!1,n=t.lastMessage&&t.lastMessage.id,o=t.lastMessage&&t.lastMessage.time,r=new a,i=function(t){(function(t){return t&&t.unread&&t.sender&&!t.sender.current})(t)&&r.set(function(t){return t.uid||t.id||String(t.cid)}(t),t),e=e||lMt(t)};t.messages&&t.messages.forEach((function(t){t.id!==n&&i(t)}));t.lastMessage&&i(t.lastMessage);return{id:t.id,chat:t,selected:t.selected,lastMessageTime:o,unreadMessages:r,hasReply:e}}(t))})),n}function pMt(t){var e=!1;return t.messages&&t.messages.forEach((function(t){return e=e||lMt(t)})),t.lastMessage&&(e=e||lMt(t.lastMessage)),e}function lMt(t){return!(!(t&&t.unread&&t.link&&"REPLY"===t.link.type&&mMt(t.link.message.sender))||mMt(t.sender))}function mMt(t){return t&&t.current}var dMt=new Mb(gMt,1e3);var _Mt={keydown:function(t,e){"Enter"===e.key&&(e.preventDefault(),t.selectChat())},drop:function(t,e){e.stopPropagation(),e.preventDefault();var n=e.dataTransfer&&e.dataTransfer.files;if(n){for(var o=[],r=0;r<n.length;r++)o.push(n[r]);!function(t,e){var n=t.props.chat;t.selectChat(),Zt(t,"attach-files",{chatId:n.id,files:e,autoUpload:!0,fromChatList:!0})}(t,o)}}},fMt={activate:function(){var t;null===(t=this.refs.link)||void 0===t||t.focus()},selectChat:function(){$p(this.props.chat.id)},selectActiveItem:function(){this.selectChat()}};function gMt(t){var e=t.props.chat,n=t.store.get().config.server["hide-call-timer-max-duration"],o=e.videoConversation&&e.videoConversation.startedAt;if(o){var r=Date.now()-o;null!=n&&r>n&&(r=-1),t.setState({callDuration:r})}else t.state.callDuration&&t.setState({callDuration:-1})}function vMt(t,e){Yv(e)?t.selectChat():e.stopPropagation()}var hMt="e-5p5hde",CMt=[0,0,0],kMt=[];function bMt(){kMt.push(CMt),CMt=[0,0,0]}function yMt(){CMt=kMt.pop()}function SMt(t,e){e.participants=n.filter(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})),e.important=!!(n.get(t.store.data.config,"server","moderated-groups")&&n.get(t.props.chat,"groupChatInfo","isModerator")&&n.get(t.props.chat,"groupChatInfo","isImportant")),e.favorite=n.get(t.props.chat,"settings","favIndex")||e.important,e.isProduct="PRODUCT"===n.get(t.props.chat,"subject","type"),e.noBoldUnread=n.get(t.store.data.config,"server","no-bold-unread"),e.lastMessageSender=n.get(t.props.chat,"lastMessage","sender"),e.chooseExpr="DIALOG"==n.get(t.props.chat,"type")?0:1,e.caseExpr=0===e.chooseExpr,e.participant=e.caseExpr?n.find(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})):void 0,e.upload=n.find(n.get(n.find(n.get(t.props.chat,"pending"),(function(t){return n.find(n.get(t,"attaches"),(function(t){return Dt(0,t)}))})),"attaches"),(function(t){return Dt(0,t)})),e.ifExpr=n.get(t.props.chat,"lastMessage"),e.chooseExpr_1=t.state.canDisturb&&n.get(t.props.chat,"typingParticipants")?0:n.get(t.props.chat,"posting")||!n.get(t.props.chat,"isFake")&&(n.get(t.props.chat,"lastMessage")||"DIALOG"!==n.get(t.props.chat,"type"))?!n.get(t.props.chat,"posting")||n.get(t.props.chat,"selected")&&n.get(t.props.chat,"lastMessage")?e.upload&&!n.get(t.props.chat,"selected")?3:n.get(t.props.chat,"lastMessage")?4:-1:2:1,e.value=void 0,e.upload_1=n.get(t.props.chat,"posting","upload",0),e.selectedShare=n.get(t.props.chat,"posting","shares","selected"),e.caseExpr_6=4===e.chooseExpr_1,e.lastMention=e.caseExpr_6?n.get(t.props.chat,"lastMentionMessage"):void 0,e.ownMention=e.caseExpr_6?n.get(e.lastMention,"sender")===n.get(t.store.data.auth,"profile","id"):void 0,e.allowShowMention=e.caseExpr_6?e.lastMention&&"REMOVED"!==n.get(e.lastMention,"status")&&!e.ownMention&&n.get(e.lastMention,"unread")&&n.get(t.props.chat,"unreadCount"):void 0,e.unread=!t.props.largeChat&&"CHANNEL"!=n.get(t.props.chat,"type")&&Tt(0,n.get(t.props.chat,"participants"))>1&&n.get(t.props.chat,"lastMessage","time")>t.state.lastReadMark,e.anim=n.get(t.store.data.config,"server","bubbles-animate"),e.checks=n.get(t.store.data.config,"server","bubbles-check"),e.animateIn=e.anim&&t.state.mounted?"global:msg-pop-full 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)":null,e.animateOut=e.anim?"global:msg-pop-full 0.3s ease-out reverse":null}function wMt(t,e,o){n.updateAttribute(t,e,"href","/messages"+o.state.chatUrl)}function EMt(t,e,o,r){e.user=n.get(r.participant,"user"),e.size=o.props.compact?"small":"medium"}function xMt(t,e,o){var r=o._w=n.insert(e,n.createComponent("msg-user-card",Nh,t)),a=o._x=n.propsSet(r,{showStatus:!0});return EMt(0,a,t,o),n.mountComponent(r,a),IMt}function IMt(t,e){var o=e._w,r=e._x;EMt(0,r,t,e),n.updateComponent(o,r)}function BMt(t,e,o){e.url=Gt(0,o.props.chat,o.props.compact?"small":"medium"),e.id=n.get(o.props.chat,"id"),e.caption=n.get(o.props.chat,"title")||n.get(o.props.chat,"placeholder"),e.size=o.props.compact?"small":"medium"}function MMt(t,e,o){var r=o._10=n.insert(e,n.createComponent("msg-avatar",Hp,t)),a=o._11=n.propsSet(r);return BMt(0,a,t),n.mountComponent(r,a),AMt}function AMt(t,e){var o=e._10,r=e._11;BMt(0,r,t),n.updateComponent(o,r)}function TMt(t,e){return[xMt,MMt][e.chooseExpr]}function jMt(t,e,n){e.duration=n.state.callDuration}function PMt(t,e,o){var r=o._1c=n.insert(e,n.createComponent("msg-duration",qi,t)),a=o._1d=n.propsSet(r);return jMt(0,a,t),n.mountComponent(r,a),RMt}function RMt(t,e){var o=e._1c,r=e._1d;jMt(0,r,t),n.updateComponent(o,r)}function LMt(t){return t.state.callDuration>0?PMt:null}function OMt(t,e,o){var r=n.insert(e,n.elem("div",hMt)),a=n.createInjector(r);n.setClass(r,"call_info-okmsg");var i=o._17=n.insert(a,n.createComponent("msg-icon",xe,t));return n.mountComponent(i,n.propsSet(i,{icon:"audio-call-s","data-tsid":"chat-call-icon"})),o._19=n.mountBlock(t,a,LMt),zMt}function zMt(t,e){n.updateBlock(e._19)}function DMt(t){return n.get(t.props.chat,"videoConversation")&&-1!=t.state.callDuration?OMt:null}function UMt(t,e,o){n.updateAttribute(t,e,"src",n.get(o.props.chat,"subject","imageUrl"))}function NMt(t,e,o){var r=o._1l=n.insert(e,n.elem("img",hMt)),a=o._1m=n.obj();return n.setClass(r,"market-okmsg"),n.setAttribute(r,"alt",""),UMt(r,a,t),qMt}function qMt(t,e){UMt(e._1l,e._1m,t)}function HMt(t,e,o){var r=n.insert(e,n.elem("div",hMt));n.setClass(r,"market-okmsg stub-okmsg");var a=o._1q=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"photo",size:"medium"}))}function FMt(t){return n.get(t.props.chat,"subject","imageUrl")?NMt:HMt}function VMt(t,e,o){return o._1i=n.mountBlock(t,e,FMt),KMt}function KMt(t,e){n.updateBlock(e._1i)}function WMt(t,e){return e.isProduct?VMt:null}function GMt(t,e,o){n.updateClass(t,e,"title-okmsg"+(o.state.canDisturb&&n.get(o.props.chat,"unreadCount")?" unread-okmsg":""))}function YMt(t,e,o){var r=o._1x=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"official",size:"medium"}))}function XMt(t){return Yt(0,t.props.chat)?YMt:null}function QMt(t,e,o){var r=o._27=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{size:"small",icon:"alert-off_12","data-tsid":"mute_icon"}))}function JMt(t){return t.state.canDisturb?null:QMt}function $Mt(t,e,o){var r=o._2c=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{size:"small",icon:"in-favorite_12"}))}function ZMt(t,e){return e.favorite?$Mt:null}function tAt(t,e,o,r){n.updateClass(t,e,"text-okmsg"+(o.state.canDisturb&&n.get(o.props.chat,"typingParticipants")?" __typing-okmsg":"")),n.updateAttribute(t,e,"aria-label",r.ifExpr?"Последнее сообщение от "+(n.get(r.lastMessageSender,"current")?"вас":n.get(r.lastMessageSender,"name"))+", "+(n.get(r.lastMessageSender,"current")?"отправлено":"получено")+" "+Jt(0,n.get(o.props.chat,"lastMessage","time")," в "):void 0)}function eAt(t,e,o){e.type=n.get(o.props.chat,"type"),e.users=n.get(o.props.chat,"typingParticipants")}function nAt(t,e){var o=e._2m,r=e._2n;eAt(0,r,t),n.updateComponent(o,r)}function oAt(t,e,o){return o._2m?nAt(t,o):function(t,e,o){var r=o._2m=n.insert(e,n.createComponent("msg-typing-indicator",Dk,t)),a=o._2n=n.propsSet(r);eAt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._2m,n.createAnimation("show-typing .15s",hMt)),rAt}function rAt(t,e){nAt(t,e)}function aAt(t,e,o,r){e.user=n.find(n.get(r.value,"value","chat","participants"),(function(t){return!n.get(t,"user","current")}))}function iAt(t,e,o){var r=o._2q=n.insert(e,n.createComponent("msg-online-label",ay,t)),a=o._2r=n.propsSet(r);return aAt(0,a,0,o),n.mountComponent(r,a),sAt}function sAt(t,e){var o=e._2q,r=e._2r;aAt(0,r,0,e),n.updateComponent(o,r)}function uAt(t,e,o){var r=o._31=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"photo_12",size:"small"}))}function cAt(t,e,o){var r=o._35=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"media-mixed_12",size:"small"}))}function pAt(t,e,o){var r=o._39=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"microphone_12",size:"small"}))}function lAt(t,e,o){var r=o._3d=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"media-share_12",size:"small"}))}function mAt(t,e,o){var r=o._3h=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"file_12",size:"small"}))}function dAt(t,e,o){var r=o._3l=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"user_12",size:"small"}))}function _At(t,e){return"PHOTO"===n.get(e.upload_1,"_type")?uAt:"VIDEO"===n.get(e.upload_1,"_type")?cAt:"AUDIO"===n.get(e.upload_1,"_type")?pAt:"SHARE"===n.get(e.upload_1,"_type")?lAt:"FILE"===n.get(e.upload_1,"_type")?mAt:"CONTACT"===n.get(e.upload_1,"_type")?dAt:null}function fAt(t,e,o){var r=o._3r=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"voice-message"}))}function gAt(t,e,o){e.messageElements=n.filter(n.get(o.props.chat,"posting","messageElements"),(function(t){return"USER_MENTION"!==n.get(t,"type")}))}function vAt(t,e,o){var r=o._3v=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input,i=o._3w=n.propsSet(r,{textEmoji:!0,userSticker:!0,disableLinks:!0,userStickerSize:"compact",emojiSize:16});return gAt(0,i,t),o._3x=n.insert(a,n.text(n.get(t.props.chat,"posting","text")||n.get(t.props.chat,"posting","urls",o.selectedShare)||n.get(o.upload_1,"file","name"))),n.mountComponent(r,i),hAt}function hAt(t,e){var o=e._3v,r=e._3w;gAt(0,r,t),CMt[1]|=n.updateText(e._3x,n.get(t.props.chat,"posting","text")||n.get(t.props.chat,"posting","urls",e.selectedShare)||n.get(e.upload_1,"file","name")),n.updateIncomingSlot(o,"",CMt[1]),n.updateComponent(o,r)}function CAt(t){return n.get(t.props.chat,"posting","voiceMessage")?fAt:vAt}function kAt(t,e,o){var r=n.insert(e,n.elem("div",hMt)),a=n.createInjector(r);n.setClass(r,"draft-okmsg");var i=o._2v=n.insert(a,n.createComponent("msg-l10n",ae,t));return n.mountComponent(i,n.propsSet(i,{key:"draft"})),o._2x=n.insert(a,n.text(" ")),o._2y=n.mountBlock(t,a,_At),o._3o=n.mountBlock(t,a,CAt),bAt}function bAt(t,e){n.updateText(e._2x," "),n.updateBlock(e._2y),n.updateBlock(e._3o)}function yAt(t,e,o,r){e.indeterminate="loading"!==n.get(r.upload_1,"status"),e.progress=n.get(r.upload_1,"progress")?n.get(r.upload_1,"progress","loaded")/n.get(r.upload_1,"progress","total"):null}function SAt(t,e,o){var r=o._41=n.insert(e,n.createComponent("msg-progress",Ps,t)),a=o._42=n.propsSet(r,{size:16,radius:5,thickness:2,spin:!0});return yAt(0,a,0,o),n.mountComponent(r,a),o._43=n.insert(e,n.text(n.get(o.upload_1,"file","name"))),wAt}function wAt(t,e){var o=e._41,r=e._42;yAt(0,r,0,e),n.updateComponent(o,r),n.updateText(e._43,n.get(e.upload_1,"file","name"))}function EAt(t,e,o,r){e.message=n.get(o.props.chat,"lastMessage"),e.chatType=n.get(o.props.chat,"type"),e.canDisturb=o.state.canDisturb,e.hasUnreadReply=o.state.hasUnreadReply,e.hasUnreadMention=!!r.allowShowMention&&function(t,e){var n=t.store.get().auth.profile;if(n&&e&&e.elements)for(var o=0;o<e.elements.length;o++)if(e.elements[o].entityId===n.id)return!0;return!1}(o,r.lastMention),e.class=!r.noBoldUnread&&o.state.canDisturb&&n.get(o.props.chat,"unreadCount")?"unread-okmsg":""}function xAt(t,e,o){var r=o._46=n.insert(e,n.createComponent("msg-chat-last-message",uMt,t)),a=o._47=n.propsSet(r);return EAt(0,a,t,o),n.mountComponent(r,a),IAt}function IAt(t,e){var o=e._46,r=e._47;EAt(0,r,t,e),n.updateComponent(o,r)}function BAt(t,e){return[oAt,iAt,kAt,SAt,xAt][e.chooseExpr_1]}function MAt(t,e,o){var r=o._4c=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._4e=n.insert(a,n.text(n.get(t.props.chat,"lastReaction"))),n.mountComponent(r,n.propsSet(r,{class:"last-reaction-okmsg"})),AAt}function AAt(t,e){CMt[2]|=n.updateText(e._4e,n.get(t.props.chat,"lastReaction")),n.updateIncomingSlot(e._4c,"",CMt[2])}function TAt(t){return n.get(t.store.data.config,"server","react-permission")&&n.get(t.props.chat,"lastReaction")?MAt:null}function jAt(t,e,o){!o._4m&&function(t,e,o){var r=o._4m=n.insert(e,n.createComponent("msg-notification-bubble",Vxt,t)),a=r.componentModel.input;n.insert(a,n.text("!")),n.mountComponent(r,n.propsSet(r,{type:"warn"}))}(t,e,o),n.animate(o._4m,n.createAnimation(o.animateIn,hMt))}function PAt(t,e,n){e.chat=n.props.chat}function RAt(t,e){var o=e._4u,r=e._4v;PAt(0,r,t),n.updateComponent(o,r)}function LAt(t,e,o){return o._4u?RAt(t,o):function(t,e,o){var r=o._4u=n.insert(e,n.createComponent("msg-chat-notification-bubble",$xt,t)),a=o._4v=n.propsSet(r);PAt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._4u,n.createAnimation(o.animateIn,hMt)),OAt}function OAt(t,e){RAt(t,e)}function zAt(t,e,o){!o._50&&function(t,e,o){var r=o._50=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"bday"}))}(t,e,o),n.animate(o._50,n.createAnimation(o.animateIn,hMt))}function DAt(t,e,o){!o._56&&function(t,e,o){var r=o._56=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"read",class:"my-read-okmsg"}))}(t,e,o),n.animate(o._56,n.createAnimation(o.animateIn,hMt))}function UAt(t,e){var o=n.insert(e,n.elem("span",hMt));n.setClass(o,"my-unread-okmsg")}function NAt(t,e){return n.get(t.props.chat,"lastError")?jAt:n.get(t.props.chat,"unreadCount")?LAt:"DIALOG"===n.get(t.props.chat,"type")&&zt(0,n.get(e.participants,0,"user","bday"))?zAt:e.checks&&n.get(t.props.chat,"lastMessage","sender","current")&&!e.unread&&!n.get(t.props.chat,"typingParticipants")?DAt:!e.checks&&!t.props.largeChat&&"CHANNEL"!=n.get(t.props.chat,"type")&&Tt(0,n.get(t.props.chat,"participants"))>1&&n.get(t.props.chat,"lastMessage","sender","current")&&n.get(t.props.chat,"lastMessage","time")>t.state.lastReadMark?UAt:null}function qAt(t,e){var o=t.componentView;bMt(),SMt(t,e);var r=e._q=n.appendChild(o,n.elem("a",hMt)),a=n.createInjector(r);n.setRef(t,"link",r);var i=e._r=n.obj();n.setAttribute(r,"tabindex","-1"),wMt(r,i,t),e._s=n.addEvent(r,"click",vMt,t,e),e._t=n.mountBlock(t,a,TMt),e._13=n.mountBlock(t,a,DMt),e._1f=n.mountBlock(t,a,WMt);var s=e._1s=n.insert(a,n.elem("div",hMt)),u=n.createInjector(s),c=e._1t=n.obj();n.setAttribute(s,"data-tsid","conversation_name"),GMt(s,c,t),e._1u=n.mountBlock(t,u,XMt);var p=e._20=n.insert(u,n.createComponent("msg-parsed-text",ii,t)),l=p.componentModel.input;e._22=n.insert(l,n.text(n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder"))),n.mountComponent(p,n.propsSet(p,{disableFormatting:!0,disableLinks:!0,emojiSize:16,emojiContext:"chat-title"})),e._24=n.mountBlock(t,u,JMt),e._29=n.mountBlock(t,u,ZMt);var m=e._2e=n.insert(a,n.elem("div",hMt)),d=n.createInjector(m),_=e._2f=n.obj();n.setAttribute(m,"data-tsid","last_message"),tAt(m,_,t,e);var f=n.insert(d,n.elem("div",hMt)),g=n.createInjector(f);return n.setClass(f,"contents-okmsg"),e._2h=n.mountBlock(t,g,BAt),e._49=n.mountBlock(t,d,TAt),e._4h=n.mountBlock(t,d,NAt),yMt(),n.subscribeStore(t,["config","auth","l10n"]),HAt}function HAt(t,e){bMt(),SMt(t,e),wMt(e._q,e._r,t),n.updateBlock(e._t),n.updateBlock(e._13),n.updateBlock(e._1f),GMt(e._1s,e._1t,t),n.updateBlock(e._1u),CMt[0]|=n.updateText(e._22,n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder")),n.updateIncomingSlot(e._20,"",CMt[0]),n.updateBlock(e._24),n.updateBlock(e._29),tAt(e._2e,e._2f,t,e),n.updateBlock(e._2h),n.updateBlock(e._49),n.updateBlock(e._4h),yMt()}xMt.dispose=function(t){t._w=n.unmountComponent(t._w),t._x=null},MMt.dispose=function(t){t._10=n.unmountComponent(t._10),t._11=null},PMt.dispose=function(t){t._1c=n.unmountComponent(t._1c),t._1d=null},OMt.dispose=function(t){t._17=n.unmountComponent(t._17),t._19=n.unmountBlock(t._19)},NMt.dispose=function(t){t._1m=t._1l=null},HMt.dispose=function(t){t._1q=n.unmountComponent(t._1q)},VMt.dispose=function(t){t._1i=n.unmountBlock(t._1i)},YMt.dispose=function(t){t._1x=n.unmountComponent(t._1x)},QMt.dispose=function(t){t._27=n.unmountComponent(t._27)},$Mt.dispose=function(t){t._2c=n.unmountComponent(t._2c)},oAt.dispose=function(t,e){n.animate(t._2m,n.createAnimation("hide-typing .15s",hMt),(function(){return function(t){var e=t._2m;t._2m=n.unmountComponent(e),n.domRemove(e),t._2n=null}(t)}))},iAt.dispose=function(t){t._2q=n.unmountComponent(t._2q),t._2r=null},uAt.dispose=function(t){t._31=n.unmountComponent(t._31)},cAt.dispose=function(t){t._35=n.unmountComponent(t._35)},pAt.dispose=function(t){t._39=n.unmountComponent(t._39)},lAt.dispose=function(t){t._3d=n.unmountComponent(t._3d)},mAt.dispose=function(t){t._3h=n.unmountComponent(t._3h)},dAt.dispose=function(t){t._3l=n.unmountComponent(t._3l)},fAt.dispose=function(t){t._3r=n.unmountComponent(t._3r)},vAt.dispose=function(t){t._3v=n.unmountComponent(t._3v),t._3w=t._3x=null},kAt.dispose=function(t){t._2v=n.unmountComponent(t._2v),t._2y=n.unmountBlock(t._2y),t._3o=n.unmountBlock(t._3o),t._2x=null},SAt.dispose=function(t){t._41=n.unmountComponent(t._41),t._42=t._43=null},xAt.dispose=function(t){t._46=n.unmountComponent(t._46),t._47=null},MAt.dispose=function(t){t._4c=n.unmountComponent(t._4c),t._4e=null},jAt.dispose=function(t,e){n.animate(t._4m,n.createAnimation(t.animateOut,hMt),(function(){return function(t){var e=t._4m;t._4m=n.unmountComponent(e),n.domRemove(e)}(t)}))},LAt.dispose=function(t,e){n.animate(t._4u,n.createAnimation(t.animateOut,hMt),(function(){return function(t){var e=t._4u;t._4u=n.unmountComponent(e),n.domRemove(e),t._4v=null}(t)}))},zAt.dispose=function(t,e){n.animate(t._50,n.createAnimation(t.animateOut,hMt),(function(){return function(t){var e=t._50;t._50=n.unmountComponent(e),n.domRemove(e)}(t)}))},DAt.dispose=function(t,e){n.animate(t._56,n.createAnimation(t.animateOut,hMt),(function(){return function(t){var e=t._56;t._56=n.unmountComponent(e),n.domRemove(e)}(t)}))},qAt.dispose=function(t){bMt(),t._s=n.removeEvent("click",t._s),t._t=n.unmountBlock(t._t),t._13=n.unmountBlock(t._13),t._1f=n.unmountBlock(t._1f),t._1u=n.unmountBlock(t._1u),t._20=n.unmountComponent(t._20),t._24=n.unmountBlock(t._24),t._29=n.unmountBlock(t._29),t._2h=n.unmountBlock(t._2h),t._49=n.unmountBlock(t._49),t._4h=n.unmountBlock(t._4h),yMt()};var FAt={__proto__:null,cssScope:hMt,default:qAt,didMount:function(t){t.state.mounted=!0},events:_Mt,extend:fMt,willMount:function(t){dMt.add(t),gMt(t)},willUnmount:function(t){dMt.remove(t)},didChange:function(t,e){var n=e.chat;n&&(n.current?(!function(t,e){var n=e.participants.reduce((function(t,e){return!e.user.current&&e.time>t?e.time:t}),0);t.setState({lastReadMark:n})}(t,n.current),t.setState({chatUrl:Yp(n.current),hasUnreadReply:pMt(n.current),canDisturb:c(n.current)}),gMt(t)):t.setState({chatUrl:null}))},handleClick:vMt};function VAt(t,e){t.setState({isHover:"mouseenter"===e.type})}var KAt="e-9zjq2l";function WAt(t,e){e.multiple=n.get(t.props.data,"friends","length")>1,e.ifExpr=n.get(t.props.data,"theme","icon"),e.ifExpr_1=n.get(t.props.data,"theme","barColor")}function GAt(t,e,o){n.updateAttribute(t,e,"src",o.state.videoUrl),n.updateAttribute(t,e,"style","background-color: "+(n.get(o.props.data,"theme","bgColor")||"none")+";")}function YAt(t,e,o){var r=o._9=n.insert(e,n.elem("video",KAt));n.setPendingRef(o._1,"video",r);var a=o._a=n.obj();return n.setClass(r,"random-congrats_vid-okmsg"),r.autoplay=!0,r.loop=!0,r.muted=!0,GAt(r,a,t),XAt}function XAt(t,e){var o=e._9;n.setPendingRef(e._1,"video",o),GAt(o,e._a,t)}function QAt(t){return t.state.videoUrl?YAt:null}function JAt(t,e,o){n.updateAttribute(t,e,"style","background-color: "+(o.state.isHover?n.get(o.state.bg,"hover"):n.get(o.state.bg,"main"))+";")}function $At(t,e,o,r){n.updateAttribute(t,e,"style",r.ifExpr?"background-image: url("+n.get(o.props.data,"theme","icon")+");":void 0)}function ZAt(t,e,o){e.url=Wt(0,n.get(o.props.data,"friends",0),"small"),e.id=n.get(o.props.data,"friends",0,"id"),e.caption=n.get(o.props.data,"friends",0,"names",0,"name")}function tTt(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-avatar",Hp,t)),a=o._m=n.propsSet(r,{size:"small"});return ZAt(0,a,t),n.mountComponent(r,a),eTt}function eTt(t,e){var o=e._l,r=e._m;ZAt(0,r,t),n.updateComponent(o,r)}function nTt(t){return 1===n.get(t.props.data,"friends","length")?tTt:null}function oTt(t,e,o){return o._t=n.insert(e,n.text(n.get(t.props.data,"headerMultipleStart"))),rTt}function rTt(t,e){n.updateText(e._t,n.get(t.props.data,"headerMultipleStart"))}function aTt(t){return n.get(t.props.data,"headerSingle")}function iTt(t,e,o){return o._w=n.mountInnerHTML(t,e,aTt),sTt}function sTt(t,e){n.updateInnerHTML(e._w)}function uTt(t,e,o){return o._z=n.insert(e,n.text(n.get(t.props.data,"header"))),cTt}function cTt(t,e){n.updateText(e._z,n.get(t.props.data,"header"))}function pTt(t,e){return e.multiple?oTt:n.get(t.props.data,"friends","length")?iTt:uTt}function lTt(t){return n.get(t.props.data,"friends")}function mTt(t,e,o,r){e.url=Wt(0,r.value,"micro"),e.id=n.get(r.value,"id"),e.caption=n.get(r.value,"names",0,"name")}function dTt(t,e,o){var r=o._18=n.insert(e,n.createComponent("msg-avatar",Hp,t)),a=o._19=n.propsSet(r,{size:"micro"});return mTt(0,a,0,o),n.mountComponent(r,a),_Tt}function _Tt(t,e){var o=e._18,r=e._19;mTt(0,r,0,e),n.updateComponent(o,r)}function fTt(t,e,o){var r=n.insert(e,n.elem("div",KAt)),a=n.createInjector(r);n.setClass(r,"friends-okmsg"),o._15=n.mountIterator(t,a,lTt,dTt);var i=n.insert(e,n.elem("div",KAt));return n.setClass(i,"random-congrats-entrypoint_hd2-okmsg"),o._1c=n.appendChild(i,n.text(n.get(t.props.data,"headerMultipleFinish"))),gTt}function gTt(t,e){n.updateIterator(e._15),n.updateText(e._1c,n.get(t.props.data,"headerMultipleFinish"))}function vTt(t,e){return e.multiple?fTt:null}function hTt(t,e,o,r){n.updateAttribute(t,e,"style",r.ifExpr_1?"background-color: "+n.get(o.props.data,"theme","barColor")+";":void 0)}function CTt(t,e,o){n.updateAttribute(t,e,"style","width: "+n.get(o.props.data,"progress")+"%;background-color: "+n.get(o.props.data,"theme","barFillColor")+";")}function kTt(t,e,o){var r=o._1h=n.insert(e,n.elem("div",KAt)),a=o._1i=n.obj();n.setClass(r,"random-congrats-entrypoint_progress-okmsg"),hTt(r,a,t,o);var i=o._1j=n.appendChild(r,n.elem("div",KAt)),s=o._1k=n.obj();return n.setClass(i,"random-congrats-entrypoint_bar-okmsg js-random-congrats-progress"),CTt(i,s,t),bTt}function bTt(t,e){hTt(e._1h,e._1i,t,e),CTt(e._1j,e._1k,t)}function yTt(t){return n.get(t.props.data,"theme","barColor")?null:kTt}function STt(t){return n.get(t.props.data,"text")}function wTt(t,e,n){e.title=n.store.data.l10n("close")}function ETt(t,e){e.stopPropagation(),Ot(t,"close")}function xTt(t,e,o){var r=o._1r=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._1s=n.propsSet(r,{class:"close-okmsg",shape:"circle",size:"small","data-l":"t,close"});wTt(0,i,t),o._1t=n.addEvent(r,"click",ETt,t,o);var s=o._1u=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"close",size:"small"})),n.mountComponent(r,i),ITt}function ITt(t,e){var o=e._1r,r=e._1s;wTt(0,r,t),n.updateComponent(o,r)}function BTt(t){return n.get(t.props.data,"closeCampId")?xTt:null}function MTt(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();WAt(t,e),e._6=n.mountBlock(t,r,QAt);var i=e._c=n.insert(r,n.elem("div",KAt)),s=n.createInjector(i);n.setRef(t,"entry",i);var u=e._d=n.obj();n.setClass(i,"random-congrats-entrypoint-okmsg"),JAt(i,u,t),e._e=n.addEvent(i,"mouseenter",VAt,t,e),e._f=n.addEvent(i,"mouseleave",VAt,t,e);var c=e._g=n.insert(s,n.elem("div",KAt)),p=n.createInjector(c),l=e._h=n.obj();n.setClass(c,"icon-okmsg"),$At(c,l,t,e),e._i=n.mountBlock(t,p,nTt);var m=n.insert(s,n.elem("div",KAt)),d=n.createInjector(m);n.setClass(m,"random-congrats-entrypoint_side-okmsg");var _=n.insert(d,n.elem("div",KAt)),f=n.createInjector(_);n.setClass(_,"random-congrats-entrypoint_hd-okmsg"),e._q=n.mountBlock(t,f,pTt),e._11=n.mountBlock(t,d,vTt),e._1e=n.mountBlock(t,d,yTt);var g=n.insert(d,n.elem("div",KAt)),v=n.createInjector(g);return n.setClass(g,"random-congrats-entrypoint_tx-okmsg"),e._1m=n.mountInnerHTML(t,v,STt),e._1o=n.mountBlock(t,s,BTt),n.subscribeStore(t,["l10n"]),n.finalizePendingRefs(t,a),ATt}function ATt(t,e){WAt(t,e),n.updateBlock(e._6),JAt(e._c,e._d,t),$At(e._g,e._h,t,e),n.updateBlock(e._i),n.updateBlock(e._q),n.updateBlock(e._11),n.updateBlock(e._1e),n.updateInnerHTML(e._1m),n.updateBlock(e._1o),n.finalizePendingRefs(t,e._1)}YAt.dispose=function(t){t._a=t._9=null},tTt.dispose=function(t){t._l=n.unmountComponent(t._l),t._m=null},oTt.dispose=function(t){t._t=null},iTt.dispose=function(t){t._w=n.unmountInnerHTML(t._w)},uTt.dispose=function(t){t._z=null},dTt.dispose=function(t){t._18=n.unmountComponent(t._18),t._19=null},fTt.dispose=function(t){t._15=n.unmountIterator(t._15),t._1c=null},kTt.dispose=function(t){t._1i=t._1k=t._1j=t._1h=null},xTt.dispose=function(t){t._1t=n.removeEvent("click",t._1t),t._1u=n.unmountComponent(t._1u),t._1r=n.unmountComponent(t._1r),t._1s=null},MTt.dispose=function(t){t._6=n.clearBlock(t._6),t._e=n.removeEvent("mouseenter",t._e),t._f=n.removeEvent("mouseleave",t._f),t._i=n.unmountBlock(t._i),t._q=n.unmountBlock(t._q),t._11=n.unmountBlock(t._11),t._1e=n.unmountBlock(t._1e),t._1m=n.unmountInnerHTML(t._1m),t._1o=n.unmountBlock(t._1o)};var TTt={__proto__:null,cssScope:KAt,default:MTt,didChange:function(t,e){var n,o=e.data;if(o){var r={main:"none",hover:"none"};if(null===(n=o.current)||void 0===n?void 0:n.theme){var a=o.current.theme,i=function(t){var e={},n=t.customTheme;if(n&&"string"==typeof n)try{e=JSON.parse(n)}catch(t){}return e}(a),s=i.videoUrl;s?(r.main="none",r.hover=(null==i?void 0:i.bannerHoverColor)||"none"):(r.main=a.bgColor,r.hover=a.bgHoverColor),t.setState({videoUrl:s})}t.setState({bg:r})}},didRender:function(t){var e=t.refs.video;e&&!t.state.playing&&(e.muted=!0,e.play(),t.setState({playing:!0}))},onHoverToggle:VAt},jTt="mobGenerator",PTt="undefined"!=typeof IntersectionObserver,RTt=new a,LTt=null;function OTt(t,e){PTt&&(RTt.set(t,e),LTt&&LTt.observe(t))}function zTt(t){RTt.delete(t),LTt&&LTt.unobserve(t)}function DTt(t){PTt&&(UTt(),LTt=new IntersectionObserver((function(t){t.forEach((function(t){var e=RTt.get(t.target);e&&e(t.intersectionRatio>0)}))}),{root:t}),RTt.forEach((function(t,e){return LTt.observe(e)})))}function UTt(){LTt&&(LTt.disconnect(),LTt=null)}var NTt=100;function qTt(t){Zt(t,"exit-modal")}function HTt(t){t.state._list.handleScroll(t.refs.scroller);var e=t.refs.scroller;e.scrollHeight-e.scrollTop-e.clientHeight<=NTt&&t.store.app.congrats.getCongratsList({count:50,userCongratsCount:5,loadMore:!0})}function FTt(t,e){var n=e.state.closedItems;n.add(t),e.setState({closedItems:n}),e.store.app.congrats.processCongratulation(t)}function VTt(t,e,n){return e.state.closedItems.has(n)?ZU(0,{duration:300,easing:oN}):null}function KTt(t,e){console.log(t),OK.logger.success("messagesLayer",jTt,t),e&&OK.logger.clob("error",e.toString(),"messagesLayer")}function WTt(t){KTt("banner-closed"),te(t,"close")}var GTt="e-yzjptm";function YTt(t,e,o){n.updateAttribute(t,e,"style","background-color: "+n.get(o.props.data,"color")+";")}function XTt(t,e,o){n.updateAttribute(t,e,"style","background-image: url("+n.get(o.props.data,"iconUrl")+");")}function QTt(t,e,o){var r=o._7=n.insert(e,n.elem("div",GTt)),a=o._8=n.obj();return n.setClass(r,"icon-okmsg"),XTt(r,a,t),JTt}function JTt(t,e){XTt(e._7,e._8,t)}function $Tt(t){return n.get(t.props.data,"iconUrl")?QTt:null}function ZTt(t,e,o){n.updateAttribute(t,e,"style","width: "+(n.get(o.props.data,"counter","processed")||0)/n.get(o.props.data,"counter","total")*100+"%;")}function tjt(t,e,o){var r=n.insert(e,n.elem("div",GTt));n.setClass(r,"progress-okmsg");var a=o._h=n.appendChild(r,n.elem("div",GTt)),i=o._i=n.obj();return n.setClass(a,"bar-okmsg"),ZTt(a,i,t),ejt}function ejt(t,e){ZTt(e._h,e._i,t)}function njt(t){return n.get(t.props.data,"theme","barColor")?null:tjt}function ojt(t,e,n){e.title=n.store.data.l10n("close")}function rjt(t,e,n){e.stopPropagation(),WTt(t)}function ajt(t,e,o){var r=o._p=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._q=n.propsSet(r,{class:"close-okmsg",shape:"circle",size:"small","data-l":"t,close"});ojt(0,i,t),o._r=n.addEvent(r,"click",rjt,t,o);var s=o._s=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"close",size:"small"})),n.mountComponent(r,i),ijt}function ijt(t,e){var o=e._p,r=e._q;ojt(0,r,t),n.updateComponent(o,r)}function sjt(t){return n.get(t.props.data,"holidayId")?ajt:null}function ujt(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("div",GTt)),a=n.createInjector(r);n.setRef(t,"entry",r);var i=e._2=n.obj();n.setClass(r,"entrypoint-okmsg"),YTt(r,i,t);var s=n.insert(a,n.elem("div",GTt)),u=n.createInjector(s);n.setClass(s,"icon-bg-okmsg"),e._4=n.mountBlock(t,u,$Tt);var c=n.insert(a,n.elem("div",GTt)),p=n.createInjector(c);n.setClass(c,"side-okmsg");var l=n.insert(p,n.elem("div",GTt));n.setClass(l,"header-okmsg"),e._c=n.appendChild(l,n.text(n.get(t.props.data,"title"))),e._d=n.mountBlock(t,p,njt);var m=n.insert(p,n.elem("div",GTt));return n.setClass(m,"title-okmsg"),e._l=n.appendChild(m,n.text(t.state.title)),e._m=n.mountBlock(t,a,sjt),n.subscribeStore(t,["l10n"]),cjt}function cjt(t,e){YTt(e._1,e._2,t),n.updateBlock(e._4),n.updateText(e._c,n.get(t.props.data,"title")),n.updateBlock(e._d),n.updateText(e._l,t.state.title),n.updateBlock(e._m)}QTt.dispose=function(t){t._8=t._7=null},tjt.dispose=function(t){t._i=t._h=null},ajt.dispose=function(t){t._r=n.removeEvent("click",t._r),t._s=n.unmountComponent(t._s),t._p=n.unmountComponent(t._p),t._q=null},ujt.dispose=function(t){t._4=n.unmountBlock(t._4),t._d=n.unmountBlock(t._d),t._m=n.unmountBlock(t._m)};var pjt={__proto__:null,cssScope:GTt,default:ujt,didMount:function(){KTt("banner-rendered")},didChange:function(t){var e,n=t.props.data,o=n.counter,r=n.listProcessTitle,a=null===(e=null==r?void 0:r.replace("{count}","".concat((null==o?void 0:o.processed)||0)))||void 0===e?void 0:e.replace("{total}","".concat((null==o?void 0:o.total)||0));t.setState({title:a})},onClose:WTt},ljt="e-fxai0x",mjt=[0],djt=[];function _jt(){djt.push(mjt),mjt=[0]}function fjt(){mjt=djt.pop()}function gjt(t,e,o){n.updateAttribute(t,e,"style","background-image:url("+n.get(o.props.data,"stickerSrc")+");")}function vjt(t,e,n){e.title=n.store.data.l10n("close")}function hjt(t,e){e.stopPropagation(),Ot(t,"close")}function Cjt(t,e){var o=t.componentView;_jt();var r=n.appendChild(o,n.elem("div",ljt));n.setClass(r,"content-okmsg");var a=e._2=n.appendChild(r,n.elem("div",ljt)),i=e._3=n.obj();n.setClass(a,"preview-okmsg"),gjt(a,i,t);var s=n.appendChild(r,n.elem("div",ljt));n.setClass(s,"description-okmsg");var u=n.appendChild(s,n.elem("div",ljt));n.setClass(u,"h5-okmsg"),e._6=n.appendChild(u,n.text(t.store.data.l10n("sticker.set.pro.h")));var c=e._7=n.appendChild(s,n.createComponent("msg-button",fe,t)),p=c.componentModel.input;e._9=n.insert(p,n.text(t.store.data.l10n("sticker.set.pro.install"))),n.mountComponent(c,n.propsSet(c,{shape:"square",size:"small",class:"primary-okmsg","data-l":"t,install"}));var l=e._b=n.appendChild(o,n.createComponent("msg-button",fe,t)),m=l.componentModel.input,d=e._c=n.propsSet(l,{class:"close-okmsg",shape:"circle",size:"small","data-l":"t,close"});vjt(0,d,t),e._d=n.addEvent(l,"click",hjt,t,e);var _=e._e=n.insert(m,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(_,n.propsSet(_,{icon:"close",size:"small"})),n.mountComponent(l,d),fjt(),n.subscribeStore(t,["l10n"]),kjt}function kjt(t,e){var o=e._b,r=e._c;_jt(),gjt(e._2,e._3,t),n.updateText(e._6,t.store.data.l10n("sticker.set.pro.h")),mjt[0]|=n.updateText(e._9,t.store.data.l10n("sticker.set.pro.install")),n.updateIncomingSlot(e._7,"",mjt[0]),vjt(0,r,t),n.updateComponent(o,r),fjt()}Cjt.dispose=function(t){_jt(),t._7=n.unmountComponent(t._7),t._d=n.removeEvent("click",t._d),t._e=n.unmountComponent(t._e),t._b=n.unmountComponent(t._b),fjt()};var bjt={__proto__:null,cssScope:ljt,default:Cjt};var yjt="e-gve6dh",Sjt=[0],wjt=[];function Ejt(){wjt.push(Sjt),Sjt=[0]}function xjt(){Sjt=wjt.pop()}function Ijt(t,e,o){e.sticker=n.get(o.props.data,"sticker")}function Bjt(t,e,n){e.title=n.store.data.l10n("close")}function Mjt(t,e){e.stopPropagation(),Ot(t,"close")}function Ajt(t,e){var o=t.componentView;Ejt();var r=n.appendChild(o,n.elem("div",yjt));n.setClass(r,"mass-send_content-okmsg"),n.setAttribute(r,"data-l","t,sticker-set_pro");var a=e._2=n.appendChild(r,n.createComponent("msg-sticker",Uu,t)),i=e._3=n.propsSet(a,{class:"mass-send_preview-okmsg",size:"xsmall",autoplay:!0,loop:!0});Ijt(0,i,t),n.mountComponent(a,i);var s=n.appendChild(r,n.elem("div",yjt));n.setClass(s,"description-okmsg");var u=n.appendChild(s,n.elem("div",yjt));n.setClass(u,"mass-send_text-okmsg"),e._6=n.appendChild(u,n.text(n.get(t.props.data,"title")));var c=e._7=n.appendChild(s,n.createComponent("msg-button",fe,t)),p=c.componentModel.input;e._9=n.insert(p,n.text(n.get(t.props.data,"button"))),n.mountComponent(c,n.propsSet(c,{shape:"square",class:"primary-okmsg mass-send_btn-okmsg",size:"small","data-l":"t,button"}));var l=e._b=n.appendChild(o,n.createComponent("msg-button",fe,t)),m=l.componentModel.input,d=e._c=n.propsSet(l,{class:"mass-send_close-okmsg",shape:"circle",size:"small","data-l":"t,close"});Bjt(0,d,t),e._d=n.addEvent(l,"click",Mjt,t,e);var _=e._e=n.insert(m,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(_,n.propsSet(_,{icon:"close",size:"small"})),n.mountComponent(l,d),xjt(),n.subscribeStore(t,["l10n"]),Tjt}function Tjt(t,e){var o=e._2,r=e._3,a=e._b,i=e._c;Ejt(),Ijt(0,r,t),n.updateComponent(o,r),n.updateText(e._6,n.get(t.props.data,"title")),Sjt[0]|=n.updateText(e._9,n.get(t.props.data,"button")),n.updateIncomingSlot(e._7,"",Sjt[0]),Bjt(0,i,t),n.updateComponent(a,i),xjt()}Ajt.dispose=function(t){Ejt(),t._2=n.unmountComponent(t._2),t._7=n.unmountComponent(t._7),t._d=n.removeEvent("click",t._d),t._e=n.unmountComponent(t._e),t._b=n.unmountComponent(t._b),xjt()};var jjt={__proto__:null,cssScope:yjt,default:Ajt,didMount:function(t){var e=t.props.data;if(e&&e.theme){var n=e.theme,o=n.bgColor,r=n.bgHoverColor,a=n.closeColor,i=n.textColor,s=n.btnBgColor,u=n.btnTextColor,c=n.customCss,p=document.createElement("style");p.innerHTML="\n            .mass-send_content {background-color: "+o+";}\n            .mass-send_content:hover {background-color: "+r+";}\n            .mass-send_text {color: "+i+" !important;}\n            .mass-send_close, .mass-send_close:hover {color: "+a+" !important;}\n            .mass-send_btn {background: "+s+" !important; color: "+u+" !important}\n            .mass-send_btn:hover {background: "+s+" !important; color: "+u+" !important; box-shadow: 0 0 0 1px "+s+" !important;}\n            "+(c||""),t.appendChild(p)}}};var Pjt="e-gt7ikr";function Rjt(t,e,o){var r=o._4=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"no-chats-in-group"}))}function Ljt(t){Zt(t,"filter-chat-importance")}function Ojt(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"no-chats-in-filter"}));var a=n.insert(e,n.elem("div",Pjt));n.setClass(a,"link-wr-okmsg");var i=n.appendChild(a,n.elem("span",Pjt));n.setClass(i,"link-okmsg"),o._c=n.addEvent(i,"click",Ljt,t,o);var s=o._d=n.appendChild(i,n.createComponent("msg-l10n",ae,t));n.mountComponent(s,n.propsSet(s,{key:"filter-chat-all"}))}function zjt(t){return"NONE"===t.props.selected?Rjt:Ojt}function Djt(t,e){var o=t.componentView,r=n.createInjector(o);return e._1=n.mountBlock(t,r,zjt),Ujt}function Ujt(t,e){n.updateBlock(e._1)}Rjt.dispose=function(t){t._4=n.unmountComponent(t._4)},Ojt.dispose=function(t){t._8=n.unmountComponent(t._8),t._c=n.removeEvent("click",t._c),t._d=n.unmountComponent(t._d)},Djt.dispose=function(t){t._1=n.clearBlock(t._1)};var Njt={__proto__:null,cssScope:Pjt,default:Djt,props:function(){return{selected:"NONE"}}};function qjt(t,e,n,o){return void 0===n&&(n=0),void 0===o&&(o=!1),{id:t,action:e,delta:n,reordered:o}}function Hjt(t){return null!=t.value.animation}function Fjt(t,e,n,o){var r="update"===t.action?e*n.options.itemHeight:0;return o.max&&(r=Math.min(Math.abs(r),o.max)*(r<0?-1:1)),{from:r,type:t.action,reordered:t.reordered}}function Vjt(t,e){var n=t.lastMessage&&t.lastMessage.time||0,o=e&&e[t.id]||0;return Math.max(n,t.joinTime||0,o)}var Kjt,Wjt="RANDOM_CONGRATS_SPLASH",Gjt="msg-chats-list-item",Yjt=2e3,Xjt="okmsg-promo",Qjt=function(){try{return JSON.parse(localStorage.getItem(Xjt)||"[]")}catch(t){return[]}}(),Jjt=!1,$jt={scroll:lPt,focusin:function(t,e){var n=e.target.closest(Gjt);n&&t.setState({lastFocused:n.props.chat.id})},animationend:function(t,e){/^chat-animate/.test(e.animationName)&&(function(t,e){var n=t.state._completedAnimations;n.add(e);for(var o=aPt(t),r=0;r<o.length;r++)if(!n.has(o[r]))return!1;return!0}(t,Number(e.target.getAttribute("data-item-id")))&&pPt(t))},mousemove:function(t,e){if(t.state._keyboardScroll){var n=e.target.closest(Gjt),o=n.getAttribute("data-item-id");n&&t.setState({active:Number(o)})}t.state._keyboardScroll=!1},keydown:function(t,e){if("Home"!==e.key&&"End"!==e.key){var o=0;switch(e.key){case"ArrowUp":o=-1;break;case"ArrowDown":o=1;break;case"PageUp":o=-20;break;case"PageDown":o=20}0!==o&&(!function(t,e){var n,o=function(t){return null==t?void 0:t.matches(Gjt)},r=vPt(t);if(r){if(n=r,e>0)for(;e>0&&o(n.nextElementSibling);)e--,n=n.nextElementSibling;else if(e<0)for(;e<0&&o(n.previousElementSibling);)e++,n=n.previousElementSibling}else n=t.querySelector(Gjt);n&&(n.setAttribute("tabindex","0"),n.focus())}(t,o),e.preventDefault())}else{var r=t.state._list,a=r.items["Home"===e.key?0:r.items.length-1];a&&(r.scrollTo(a,t,0,{animate:!1}),lPt(t),t.setState({lastFocused:a.id}),n.afterUpdate(t,(function(){var e;return null===(e=vPt(t))||void 0===e?void 0:e.activate()})))}}},Zjt={scrollToItemAtIndex:function(t){var e=this.state._list.items[t];e&&iPt(this,e)}};function tPt(t,e){e.state._keyboardScroll||e.setState({active:t})}function ePt(t,e){var n=e.state;n._keyboardScroll||n.active!==t||e.setState({active:null})}function nPt(t){KTt("banner-click"),Zt(t,"random-congrats")}function oPt(t){return t.value.id}function rPt(t){var e=aPt(t),n=t.state._animationStart;if(e.length>0){if(!n||Date.now()-n<Yjt)return!0;pPt(t)}return!1}function aPt(t){var e=t.state.scrollModel;return e?e.items.filter(Hjt).map(oPt):[]}function iPt(t,e){t.state._rendered?sPt(t,e):requestAnimationFrame((function(){var n,o=null===(n=t.state._list.items)||void 0===n?void 0:n.find((function(t){return t.id===e.id}));o&&sPt(t,o)}))}function sPt(t,e,n,o){void 0===n&&(n=.3),void 0===o&&(o=!1);var r=t.state._list;!e||!o&&r.inViewport(e,t)||r.scrollTo(e,t,n,{animate:!0,maxScrollDelta:1.5*t.offsetHeight})}function uPt(t,e,n){var o=n.groupChatInfo;if(null==t&&null==o)return!0;if(o){if(!t)return!o.isModerator;if(o.groupId!==t)return!1;switch(e){case"UNREAD":return n.unreadCount>0;case"UNANSWERED":return!o.isAnswered;case"IMPORTANT":return o.isImportant;default:return!0}}return!1}function cPt(t){for(var e=t.props,o=e.chats,r=e.groupIdFilter,i=e.groupChatsFilter,s=t.state,u=s._order,c=s._prevOrder,p=s._lookup,l=s._list,m=t.store.get().chats,d=new a,_=[],f=t.store.get().config.server["moderated-groups"],g=c&&rPt(t)?c:u(o),v=0;v<g.length;v++){var h=g[v],C=m.get(h.id)||p.get(h.id);C&&(f&&!uPt(r,i,C)||(d.set(h.id,C),_.push(n.__assign(n.__assign({},h),{chat:C}))))}l.update(_,t),t.setState({_prevOrder:g,_lookup:d,_requiresListUpdate:!1})}function pPt(t){t.state._animationStart=0,t.state._completedAnimations.clear();var e=t.state._list.model,o=t.state.scrollModel.items.filter((function(t){return t.value.animation&&"delete"===t.value.animation.type})).map(oPt);t.state._finalizeAnimation=!0,o.length&&(e=n.__assign(n.__assign({},e),{items:e.items.filter((function(t){return!o.includes(oPt(t))}))})),t.setState({scrollModel:e})}function lPt(t){t.state._list.handleScroll(t);var e,n=t.props,o=n.next,r=n.groupIdFilter,a=n.groupChatsFilter,i=void 0===a?"NONE":a,s=t.store.get().config.server["moderated-groups"]&&r;!(o||s)||!sF(t,400)&&(e=t).scrollHeight>e.offsetHeight||(s?t.store.app.chat.loadNextGroupChats(r,i):t.store.app.chat.loadNext(o))}function mPt(t){if(!Qjt.includes(t)){Qjt.push(t);try{localStorage.setItem(Xjt,JSON.stringify(Qjt))}catch(t){}}return Qjt}function dPt(t){var e,n=t.props.pro;if(n){var o=null;e=function(t){var e=[],n=t.randomCongrats,o=t.stickerSetPro,r=t.massSend;return n&&(n._type="RANDOM_CONGRATS",e.push(n)),o&&(o._type="STICKER_SET_PROMO",e.push(o)),r&&(r._type="MASS_SEND",e.push(r)),e}(n).filter((function(t){var e=!Qjt.includes(t.closeCampId);return"RANDOM_CONGRATS"===t._type&&e&&(o=t),e})),o&&function(t,e){var n=e.splashCampId;if(n){var o=t.store.get().config,r=null==o?void 0:o.campIds;if((r&&r[Wjt])!=n){var a=0===e.progress,i=!function(){var t=document.getElementById("counter_ToolbarMessages");if(t)return!t.classList.contains("notifications__hide");return!1}();a&&i&&(fPt(e.url,t),Zt(t,"update-campaign-id",{name:Wjt,value:n}))}}}(t,o)}t.setState({promoList:e})}function _Pt(t,e){mPt(t),gPt(e),dPt(e)}function fPt(t,e){Jn(e,t)}function gPt(t){var e;if(t.props.congrats){var n=null===(e=t.props.congrats)||void 0===e?void 0:e.info,o=n.holidayId,r=n.counter;r.total&&r.total===r.processed&&mPt(o),t.setState({showCongrats:!Qjt.includes(o)})}}function vPt(t){return t.querySelector("".concat(Gjt,"[tabindex]"))}var hPt="efngyfz";function CPt(t,e){e.inGroupModerator=!(!t.props.groupIdFilter||!n.get(t.store.data.config,"server","moderated-groups")),e.value=void 0,e.loading=void 0}function kPt(t,e,o){var r=n.insert(e,n.elem("div",hPt));n.setClass(r,"not-found-okmsg");var a=o._9=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"search"}));var i=o._b=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"empty-chats-list"}))}function bPt(t){return t.state.promoList}function yPt(t,e){return n.get(e.value,"closeCampId")}function SPt(t,e,o,r){fPt(n.get(r.value,"customUrl")||n.get(r.value,"url"),t)}function wPt(t,e,n,o){e.data=o.value}function EPt(t,e,o,r){_Pt(n.get(r.value,"closeCampId"),t)}function xPt(t,e,o){var r=o._v=n.insert(e,n.createComponent("msg-random-congrats-entry",TTt,t)),a=o._w=n.propsSet(r,{"data-l":"t,rndCongrEntry"});return wPt(0,a,0,o),o._x=n.addEvent(r,"close",EPt,t,o),n.mountComponent(r,a),IPt}function IPt(t,e){var o=e._v,r=e._w;wPt(0,r,0,e),n.updateComponent(o,r)}function BPt(t){return n.get(t.store.data.config,"server","congrats-banner-enabled-web")?xPt:null}function MPt(t,e,o){return o._s=n.mountBlock(t,e,BPt),APt}function APt(t,e){n.updateBlock(e._s)}function TPt(t,e,n,o){e.data=o.value}function jPt(t,e,o,r){_Pt(n.get(r.value,"closeCampId"),t)}function PPt(t,e,o){var r=o._10=n.insert(e,n.createComponent("msg-sticker-set-pro",bjt,t)),a=o._11=n.propsSet(r,{"data-l":"t,stickerSetPro"});return TPt(0,a,0,o),o._12=n.addEvent(r,"close",jPt,t,o),n.mountComponent(r,a),RPt}function RPt(t,e){var o=e._10,r=e._11;TPt(0,r,0,e),n.updateComponent(o,r)}function LPt(t,e,n,o){e.data=o.value}function OPt(t,e,o,r){_Pt(n.get(r.value,"closeCampId"),t)}function zPt(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-mass-send-entry",jjt,t)),a=o._16=n.propsSet(r,{"data-l":"t,massSendEntry"});return LPt(0,a,0,o),o._17=n.addEvent(r,"close",OPt,t,o),n.mountComponent(r,a),DPt}function DPt(t,e){var o=e._15,r=e._16;LPt(0,r,0,e),n.updateComponent(o,r)}function UPt(t,e){return"RANDOM_CONGRATS"===n.get(e.value,"_type")?MPt:"STICKER_SET_PROMO"===n.get(e.value,"_type")?PPt:"MASS_SEND"===n.get(e.value,"_type")?zPt:null}function NPt(t,e){n.updateBlock(e._p)}function qPt(t,e,o){return o._n?NPt(0,o):function(t,e,o){var r=o._n=n.insert(e,n.elem("div",hPt)),a=n.createInjector(r);o._o=n.addEvent(r,"click",SPt,t,o),o._p=n.mountBlock(t,a,UPt)}(t,e,o),n.animate(o._n,$U(o._n,{duration:300,easing:oN})),HPt}function HPt(t,e){NPt(0,e)}function FPt(t,e,o){return o._i=n.mountKeyIterator(t,e,bPt,yPt,qPt),VPt}function VPt(t,e){n.updateKeyIterator(e._i)}function KPt(t,e){return e.inGroupModerator?null:FPt}function WPt(t,e,o){e.data=n.get(o.props.congrats,"info")}function GPt(t,e,o){_Pt(n.get(t.props.congrats,"info","holidayId"),t)}function YPt(t,e){var o=e._1e,r=e._1f;WPt(0,r,t),n.updateComponent(o,r)}function XPt(t,e,o){return o._1e?YPt(t,o):function(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-congratulation-enter",pjt,t)),a=o._1f=n.propsSet(r);WPt(0,a,t),o._1g=n.addEvent(r,"click",nPt,t,o),o._1h=n.addEvent(r,"close",GPt,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._1e,$U(o._1e,{duration:300,easing:oN})),QPt}function QPt(t,e){YPt(t,e)}function JPt(t){return n.get(t.store.data.config,"server","congrats-banner-enabled-mob")&&t.state.showCongrats&&n.get(t.props.congrats,"info")?XPt:null}function $Pt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollModel,"before")||0)+"px;")}function ZPt(t,e,n){e.selected=n.props.groupChatsFilter}function tRt(t,e,o){var r=o._1n=n.insert(e,n.createComponent("msg-chats-list-stub",Njt,t)),a=o._1o=n.propsSet(r);return ZPt(0,a,t),n.mountComponent(r,a),eRt}function eRt(t,e){var o=e._1n,r=e._1o;ZPt(0,r,t),n.updateComponent(o,r)}function nRt(t,e){return e.inGroupModerator&&0===Tt(0,n.get(t.state.scrollModel,"items"))?tRt:null}function oRt(t){return n.get(t.state.scrollModel,"items")}function rRt(t,e){return n.get(e.value,"value","id")}function aRt(t,e){e.v=n.get(e.value,"value"),e.chat=n.get(e.v,"chat"),e.ifExpr=n.get(e.v,"animation","type"),e.ifExpr_1="update"===n.get(e.v,"animation","type")}function iRt(t,e,o,r){e.chat=r.chat,e.favorite=!!n.get(r.chat,"settings","favIndex"),e["data-item-id"]=n.get(r.v,"id"),e.active=n.get(r.v,"id")===o.state.active,e.tabindex=n.get(r.v,"id")===o.state.lastFocused?0:null,e.selected=n.get(r.v,"id")===o.props.selected,e["aria-current"]=n.get(r.v,"id")===o.props.selected,e.largeChat=Tt(0,n.get(r.chat,"participants"))>n.get(o.store.data.config,"server","show-rm-limits",1),e.compact=o.state.compactView,e["data-tsid-id"]=n.get(r.chat,"type"),e.class=(r.ifExpr?"js-animate-"+n.get(r.v,"animation","type"):"")+(n.get(r.v,"animation","reordered")?" reordered-okmsg":""),e.style=r.ifExpr_1?"top: "+(n.get(r.v,"fake")?n.get(r.value,"top"):0)+"px;transform: translateY("+n.get(r.v,"animation","from")+"px);":void 0}function sRt(t,e,o,r){tPt(n.get(r.v,"id"),t)}function uRt(t,e,o,r){ePt(n.get(r.v,"id"),t)}function cRt(t,e,o){aRt(0,o);var r=o._1x=n.insert(e,n.createComponent("msg-chats-list-item",FAt,t)),a=o._1y=n.propsSet(r,{role:"menuitem","data-l":"t,chatsListItem","data-tsid":"chat"});return iRt(0,a,t,o),o._1z=n.addEvent(r,"mouseenter",sRt,t,o),o._20=n.addEvent(r,"mouseleave",uRt,t,o),n.mountComponent(r,a),pRt}function pRt(t,e){var o=e._1x,r=e._1y;aRt(0,e),iRt(0,r,t,e),n.updateComponent(o,r)}function lRt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollModel,"after")||0)+"px")}function mRt(t,e,o){var r=o._26=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r)}function dRt(t,e){return e.loading?mRt:null}function _Rt(t,e,o){o._f=n.mountBlock(t,e,KPt),o._19=n.mountBlock(t,e,JPt),$Pt(o._1i=n.insert(e,n.elem("div",hPt)),o._1j=n.obj(),t),o._1k=n.mountBlock(t,e,nRt),o._1p=n.mountKeyIterator(t,e,oRt,rRt,cRt);var r=o._21=n.insert(e,n.elem("div",hPt)),a=n.createInjector(r),i=o._22=n.obj();return n.setClass(r,"after-okmsg"),lRt(r,i,t),o._23=n.mountBlock(t,a,dRt),fRt}function fRt(t,e){n.updateBlock(e._f),n.updateBlock(e._19),$Pt(e._1i,e._1j,t),n.updateBlock(e._1k),n.updateKeyIterator(e._1p),lRt(e._21,e._22,t),n.updateBlock(e._23)}function gRt(t){return t.props.loaded&&!Tt(0,t.props.chats)?kPt:_Rt}function vRt(t,e){var o=t.componentView,r=n.createInjector(o);return CPt(t,e),e._5=n.mountBlock(t,r,gRt),n.subscribeStore(t,["config"]),hRt}function hRt(t,e){CPt(t,e),n.updateBlock(e._5)}kPt.dispose=function(t){t._9=n.unmountComponent(t._9),t._b=n.unmountComponent(t._b)},xPt.dispose=function(t){t._x=n.removeEvent("close",t._x),t._v=n.unmountComponent(t._v),t._w=null},MPt.dispose=function(t){t._s=n.unmountBlock(t._s)},PPt.dispose=function(t){t._12=n.removeEvent("close",t._12),t._10=n.unmountComponent(t._10),t._11=null},zPt.dispose=function(t){t._17=n.removeEvent("close",t._17),t._15=n.unmountComponent(t._15),t._16=null},qPt.dispose=function(t,e){var o=t._n;n.animate(o,ZU(0,{duration:300,easing:oN}),(function(){return function(t){t._o=n.removeEvent("click",t._o),t._p=n.unmountBlock(t._p),t._n=n.domRemove(t._n)}(t)}))},FPt.dispose=function(t){t._i=n.unmountKeyIterator(t._i)},XPt.dispose=function(t,e){var o=t._1e;n.animate(o,ZU(0,{duration:300,easing:oN}),(function(){return function(t){var e=t._1e;t._1g=n.removeEvent("click",t._1g),t._1h=n.removeEvent("close",t._1h),t._1e=n.unmountComponent(e),n.domRemove(e),t._1f=null}(t)}))},tRt.dispose=function(t){t._1n=n.unmountComponent(t._1n),t._1o=null},cRt.dispose=function(t){t._1z=n.removeEvent("mouseenter",t._1z),t._20=n.removeEvent("mouseleave",t._20),t._1x=n.unmountComponent(t._1x),t._1y=null},mRt.dispose=function(t){t._26=n.unmountComponent(t._26)},_Rt.dispose=function(t){t._f=n.unmountBlock(t._f),t._19=n.unmountBlock(t._19),t._1k=n.unmountBlock(t._1k),t._1p=n.unmountKeyIterator(t._1p),t._23=n.unmountBlock(t._23),t._1j=t._1i=t._22=t._21=null},vRt.dispose=function(t){t._5=n.clearBlock(t._5)};var CRt={__proto__:null,cssScope:hPt,default:vRt,slideDown:$U,slideUp:ZU,easeInOutCubic:oN,events:$jt,extend:Zjt,init:function(t){var e,r,s,u=t.store;t.setState({_order:(e=!1,r=null,s=null,function(t){if(r===t&&!e)return s;if(s=[],e=!1,r&&r.length)for(var n=function(t,e){for(var n={},o={},r=0;r<e.length;r++)n[e[r].id]=r;r=0;for(var a=void 0,i=void 0;r<t.length;r++)(i=t[r].id)in n&&(a=n[i],o[i]={delta:r-a,reordered:e[a-1]!==t[r-1]&&e[a+1]!==t[r+1]});return o}(t,r),o=0,a=void(c=0),i=void 0,u=Math.max(t.length,r.length);c<u;c++)c<r.length&&((i=r[c].id)in n||(e=!0,s.push(qjt(i,"delete")),o++)),c<t.length&&((i=t[c].id)in n?n[i].delta+o!==0?(e=!0,a=n[i],s.push(qjt(i,"update",a.delta+o,a.reordered))):s.push(qjt(i,"")):(e=!0,s.push(qjt(i,"insert")),o--));else{e=!0;for(var c=0;c<t.length;c++)s.push(qjt(t[c].id,""))}if(!t.length)return r=null,s=[];for(c=s.length-1;c>=0;c--){var p=s[c];if("insert"!==p.action)break;p.action=""}return r=t,s}),_list:new YL({itemHeight:64,initialItems:Math.ceil(window.innerHeight/64),onUpdate:function(e){return function(t,e){var o,r=rPt(t),s=null,u=t.state._list,c=r?function(t,e){var o=new a,r=t.items.map((function(t,e){return o.set(t.value.id,e),t})),i=!1;return e.items.forEach((function(t){var e=t.value.id;if(Hjt(t))if(i=!0,o.has(e)){var a=o.get(e),s=r[a];r[a]=n.__assign(n.__assign({},s),{value:n.__assign(n.__assign({},s.value),{animation:t.value.animation})})}else r.push(n.__assign(n.__assign({},t),{value:n.__assign(n.__assign({},t.value),{fake:!0})}))})),i?n.__assign(n.__assign({},t),{items:r}):t}(e,t.state.scrollModel):function(t,e,o){var r=new i,a=!1,s=t.items.map((function(t){var i=t.value;return r.add(i.id),function(t){return"insert"===t.action||"delete"===t.action||"update"===t.action&&0!==t.delta}(i)?(a=!0,n.__assign(n.__assign({},t),{value:n.__assign(n.__assign({},t.value),{animation:Fjt(i,-i.delta,e,o)})})):t}));return e.items.forEach((function(i,u){if("update"===i.action&&function(t,e){return e>=t.from&&e<=t.to}(t,u-i.delta)&&!r.has(i.id)){var c=e.itemPos(i),p=Fjt(i,-i.delta,e,o),l=-i.delta*e.options.itemHeight-p.from;a=!0,s.push({top:c+l,height:e.itemHeight(i),value:n.__assign(n.__assign({},i),{animation:p,fake:!0})})}})),a?n.__assign(n.__assign({},t),{items:s}):t}(e,u,{get max(){return null===s&&(s=t.clientHeight+u.options.itemHeight),s}}),p=t.state.lastFocused;c.items.some((function(t){return t.value.id===p}))||(p=null===(o=c.items[0])||void 0===o?void 0:o.value.id);t.setState({scrollModel:c,lastFocused:p}),!r&&rPt(t)&&function(t){t.state._animationStart=Date.now(),t.state._completedAnimations.clear()}(t)}(t,e)}}),_completedAnimations:new i,_animationStart:0,_finalizeAnimation:!1,_firstRender:!0,_timer:null}),u.isMobile()&&u.app.congrats.getCongratsInfo(),Kjt=o.logTime("msg-chat-list"),Zt(t,"log-screen","CHATS")},willUnmount:function(t){clearTimeout(t.state._timer)},didChange:function(t,e){var n=e.chats,o=e.pro,r=e.groupIdFilter,a=e.groupChatsFilter,i=e.congrats;o&&o.current&&dPt(t),i&&i.current&&gPt(t),(n||r||a)&&t.setState({_requiresListUpdate:!0})},willRender:function(t){!function(t){var e=t.state,n=e._requiresListUpdate,o=e._finalizeAnimation;n&&!o&&cPt(t)}(t)},didMount:function(){Kjt(),Jjt||(Jjt=!0,o.log("render-chat-list"))},didRender:function(t){var e=t.state;if(e._finalizeAnimation)return e._finalizeAnimation=!1,void cPt(t);e._firstRender&&function(t){var e=t.props,n=e.chats,o=e.next;n&&!o&&(t.state._firstRender=!1,n.length&&!t.state._timer&&(t.state._timer=setTimeout((function(){if(!t.componentView.querySelectorAll(Gjt).length){var e=t.store.get().auth;e&&e.profile&&e.profile.id}}),2e3)))}(t);var n,o=function(t){var e,n=t.props.selected;return null===(e=t.state._list.items)||void 0===e?void 0:e.find((function(t){return t.id===n}))}(t);if(o){var r=o.chat;if(r.id!==e._prevSelected)iPt(t,o),e._prevSelected=r.id,e._prevLastMessage=r.lastMessage&&r.lastMessage.id;else if(r.posting&&r.posting.updated!==e._prevTypingTime)iPt(t,o),e._prevTypingTime=r.posting.updated;else if((n=r).lastMessage&&n.lastMessage.sender&&n.lastMessage.sender.current){var a=r.lastMessage.id;a!==e._prevLastMessage&&(iPt(t,o),e._prevLastMessage=a)}}e._rendered=!0},onMouseEnterInItem:tPt,onMouseLeaveItem:ePt,onCongratulationEnterClick:nPt,onClosePromo:_Pt,onOpenPromo:fPt},kRt="playing";var bRt={mouseenter:function(t){var e;ERt(t)||t.setState(((e={})[kRt]=!0,e["loading-video"]=!0,e))},mouseleave:function(t){var e;!ERt(t)&&t.state[kRt]&&t.setState(((e={})[kRt]=!1,e))}};function yRt(t,e){console.log("failed to load",t.state.src,e);var n=t.props.src;t.setState({error:!0,src:n.gif&&n.file?n.previewUrl:dt}),!1===navigator.onLine&&window.addEventListener("online",t._onOnline)}function SRt(t,e){e.stopPropagation();var n=t.props.src;t.setState({gifSaved:!0}),Zt(t,"show-toast",V("gif-saved-album")),Zt(t,"add-to-gifs",{chatid:n.chatId,messageid:n.messageId,photoid:n.photoId})}function wRt(t,e){e.stopPropagation();var n=t.props.src;Zt(t,"save-photo",{chatId:n.chatId,messageId:n.messageId,photoId:n.photoId})}function ERt(t){var e=t.props,n=e.src,o=e.gifAutoplay;return n&&!n.gif||o}var xRt="elxi57l",IRt=[0,0],BRt=[];function MRt(){BRt.push(IRt),IRt=[0,0]}function ARt(){IRt=BRt.pop()}function TRt(t,e){e.videoBlob=n.get(t.props.src,"file")&&jt(0,n.get(t.props.src,"file","type"),"video"),e.videoSrc=e.videoBlob?n.get(t.props.src,"file","objectUrl"):n.get(t.props.src,"mp4Url"),e.isVideo=n.get(t.props.src,"gif")||e.videoBlob,e.ratio=t.props.height/t.props.width,e.isSent=!!n.get(t.props.src,"messageId"),e.ifExpr=e.isVideo&&!t.state.loading&&t.state.playing,e.ifExpr_1=e.isVideo&&t.state.loading,e.ifExpr_2=!t.state.gifSaved}function jRt(t,e,o,r){n.updateClass(t,e,"wrap-okmsg"+(r.ifExpr?" __playing-okmsg":"")+(r.ifExpr_1?" __loading-okmsg":"")),n.updateAttribute(t,e,"style","width:"+o.props.width+"px;padding-bottom: "+100*r.ratio+"%;")}function PRt(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{size:"medium",inverted:!0}))}function RRt(t,e){return e.ifExpr_1?PRt:null}function LRt(t,e,o,r){n.updateAttribute(t,e,"src",r.videoSrc),n.updateAttribute(t,e,"width",o.props.width||null),n.updateAttribute(t,e,"height",o.props.height||null),n.updateProperty(t,e,"autoplay",o.props.autoplay||null)}function ORt(t,e){t.setState({loading:!1})}function zRt(t,e,o){o._g=n.mountBlock(t,e,RRt);var r=o._l=n.insert(e,n.elem("video",xRt));n.setPendingRef(o._1,"video",r);var a=o._m=n.obj();r.loop="loop",r.muted="muted",r.playsInline=!0,LRt(r,a,t,o),o._n=n.addEvent(r,"playing",ORt,t,o);var i=n.insert(e,n.elem("div",xRt));return n.setClass(i,"gif_ic-okmsg"),DRt}function DRt(t,e){var o=e._l;n.updateBlock(e._g),n.setPendingRef(e._1,"video",o),LRt(o,e._m,t,e)}function URt(t,e){return e.isVideo?zRt:null}function NRt(t,e,o){n.updateAttribute(t,e,"src",o.state.src),n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height)}function qRt(t,e,o){var r=o._t=n.insert(e,n.elem("img",xRt)),a=o._u=n.obj();return n.setAttribute(r,"alt",""),NRt(r,a,t),o._v=n.addEvent(r,"error",yRt,t,o),HRt}function HRt(t,e){NRt(e._t,e._u,t)}function FRt(t,e,o){var r=o._y=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"photo",class:"stub-okmsg"}))}function VRt(t){return t.state.src?qRt:t.props.fallback?FRt:null}function KRt(t,e,n,o){e["data-tsid"]=o.ifExpr_2?"added_gif":"save_gif",e.class=n.state.gifSaved?"__saved-okmsg":""}function WRt(t,e){e.ifExpr_2&&n.setPendingEvent(e._19,"click",SRt,e)}function GRt(t,e,n){e.icon=n.state.gifSaved?"check":"plus"}function YRt(t,e,o){var r=o._18=n.insert(e,n.createComponent("msg-button",fe,t),"element"),a=r.componentModel.input,i=o._19=n.pendingEvents(t,r),s=o._1a=n.propsSet(r,{slot:"element",shape:"circle","data-l":"t,addtoGifs"});KRt(0,s,t,o),WRt(0,o);var u=o._1d=n.insert(a,n.createComponent("msg-icon",xe,t),""),c=o._1e=n.propsSet(u);return GRt(0,c,t),n.mountComponent(u,c),n.finalizePendingEvents(i),n.mountComponent(r,s),IRt[0]=1,XRt}function XRt(t,e){var o=e._18,r=e._1a,a=e._1d,i=e._1e;KRt(0,r,t,e),WRt(0,e),GRt(0,i,t),n.updateComponent(a,i),n.finalizePendingEvents(e._19),n.updateComponent(o,r)}function QRt(t,e,o){var r=o._1i=n.insert(e,n.createComponent("msg-button",fe,t),"element"),a=r.componentModel.input;o._1k=n.addEvent(r,"click",wRt,t,o);var i=o._1l=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"plus"})),n.mountComponent(r,n.propsSet(r,{slot:"element",shape:"circle",class:"__hover-okmsg","data-l":"t,saveToAlbum","data-tsid":"save_album"})),IRt[0]=1}function JRt(t){return n.get(t.props.src,"gif")?YRt:n.get(t.store.data.config,"server","album-save")?QRt:null}function $Rt(t,e,o){var r=o._1t=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"gif-save"})),IRt[1]=1}function ZRt(t,e,o){var r=o._1x=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"saved-to-album"})),IRt[1]=1}function tLt(t,e,o){var r=o._21=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"album-save"})),IRt[1]=1}function eLt(t){return n.get(t.props.src,"gif")&&!t.state.gifSaved?$Rt:n.get(t.props.src,"gif")&&t.state.gifSaved?ZRt:tLt}function nLt(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-bubble",me,t)),a=r.componentModel.input;o._15=n.mountBlock(t,a,JRt);var i=n.insert(a,n.elem("div",xRt),"bubble"),s=n.createInjector(i);return n.setClass(i,"tooltip-okmsg"),n.setAttribute(i,"slot","bubble"),o._1q=n.mountBlock(t,s,eLt),n.mountComponent(r,n.propsSet(r,{yAxis:"top",xAxis:"left",tooltip:!0,hideDelay:0,forced:!0})),oLt}function oLt(t,e){var o=e._13;n.updateBlock(e._15),n.updateBlock(e._1q),n.updateIncomingSlot(o,"element",IRt[0]),n.updateIncomingSlot(o,"bubble",IRt[1])}function rLt(t,e){return!e.isSent||t.props.compact||n.get(t.store.data.config,"server","plus-photo-disabled")?null:nLt}function aLt(t,e){var o=t.componentView;MRt();var r=n.createInjector(o),a=e._1=n.obj();TRt(t,e);var i=e._b=n.insert(r,n.elem("div",xRt)),s=n.createInjector(i);return jRt(i,e._c=n.obj(),t,e),e._d=n.mountBlock(t,s,URt),e._q=n.mountBlock(t,s,VRt),e._10=n.mountBlock(t,r,rLt),ARt(),n.subscribeStore(t,["config"]),n.finalizePendingRefs(t,a),iLt}function iLt(t,e){MRt(),TRt(t,e),jRt(e._b,e._c,t,e),n.updateBlock(e._d),n.updateBlock(e._q),n.updateBlock(e._10),ARt(),n.finalizePendingRefs(t,e._1)}PRt.dispose=function(t){t._j=n.unmountComponent(t._j)},zRt.dispose=function(t){t._g=n.unmountBlock(t._g),t._n=n.removeEvent("playing",t._n),t._m=t._l=null},qRt.dispose=function(t){t._v=n.removeEvent("error",t._v),t._u=t._t=null},FRt.dispose=function(t){t._y=n.unmountComponent(t._y)},YRt.dispose=function(t){t._19=n.detachPendingEvents(t._19),t._1d=n.unmountComponent(t._1d),t._18=n.unmountComponent(t._18),t._1a=t._1e=null,IRt[0]=1},QRt.dispose=function(t){t._1k=n.removeEvent("click",t._1k),t._1l=n.unmountComponent(t._1l),t._1i=n.unmountComponent(t._1i),IRt[0]=1},$Rt.dispose=function(t){t._1t=n.unmountComponent(t._1t),IRt[1]=1},ZRt.dispose=function(t){t._1x=n.unmountComponent(t._1x),IRt[1]=1},tLt.dispose=function(t){t._21=n.unmountComponent(t._21),IRt[1]=1},nLt.dispose=function(t){t._15=n.unmountBlock(t._15),t._1q=n.unmountBlock(t._1q),t._13=n.unmountComponent(t._13)},aLt.dispose=function(t){MRt(),t._d=n.unmountBlock(t._d),t._q=n.unmountBlock(t._q),t._10=n.clearBlock(t._10),ARt()};var sLt={__proto__:null,cssScope:xRt,default:aLt,props:function(){return{src:null,width:320,height:240,gifAutoplay:!1,compact:!1}},state:function(){return{error:!1}},events:bRt,willMount:function(t){t._onOnline=function(){t.setState({src:St(t.props.src)}),window.removeEventListener("online",t._onOnline)}},willUnmount:function(t){window.removeEventListener("online",t._onOnline)},didChange:function(t,e){var n,o=e.src,r=e.gifAutoplay;if(o){var a=o.prev&&o.prev.file;if(a&&!a.objectUrl&&!a.url){var i=t.state.src;requestAnimationFrame((function(){return URL.revokeObjectURL(i)}))}t.setState({error:!1,src:St(o.current)})}r&&t.setState(((n={})[kRt]=r.current,n))},didRender:function(t){var e=t.refs.video;e&&(t.state[kRt]?(e.muted=!0,e.play()):t.props.gifAutoplay||isNaN(e.duration)||(e.pause(),e.currentTime=0))},handleError:yRt,onAddtoGifs:SRt,onSaveToAlbum:wRt},uLt=new Mb(lLt,1e3);var cLt={mousedown:function(t,e){0===e.button&&t.selectChat()},drop:function(t,e){e.stopPropagation(),e.preventDefault();var n=e.dataTransfer&&e.dataTransfer.files;if(n){for(var o=[],r=0;r<n.length;r++)o.push(n[r]);!function(t,e){var n=t.props,o=n.chat;t.selectChat(),Zt(t,"attach-files",{chatId:o.id,files:e,attachType:"guess"})}(t,o)}}},pLt={selectChat:function(){$p(this.props.chat.id)},selectActiveItem:function(){this.selectChat()}};function lLt(t){var e=t.props.chat,n=t.store.get().config.server["hide-call-timer-max-duration"];if(e.videoConversation&&e.videoConversation.startedAt){var o=Date.now()-e.videoConversation.startedAt;null!=n&&o>n&&(o=-1),t.setState({callDuration:o})}else t.state.callDuration&&t.setState({callDuration:-1})}var mLt="e-hfizft",dLt=[0,0,0,0,0,0,0,0],_Lt=[];function fLt(){_Lt.push(dLt),dLt=[0,0,0,0,0,0,0,0]}function gLt(){dLt=_Lt.pop()}function vLt(t,e){e.participants=n.filter(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})),e.important=!!(n.get(t.store.data.config,"server","moderated-groups")&&n.get(t.props.chat,"groupChatInfo","isModerator")&&n.get(t.props.chat,"groupChatInfo","isImportant")),e.favorite=n.get(t.props.chat,"settings","favIndex")||e.important,e.isProduct="PRODUCT"===n.get(t.props.chat,"subject","type"),e.noBoldUnread=n.get(t.store.data.config,"server","no-bold-unread"),e.hasBadge=n.get(t.props.chat,"lastError")||t.state.hasUnreadReply||n.get(t.props.chat,"unreadCount")||"DIALOG"===n.get(t.props.chat,"type")&&zt(0,n.get(e.participants,0,"user","bday"))||!t.props.largeChat&&"CHANNEL"!=n.get(t.props.chat,"type")&&Tt(0,n.get(t.props.chat,"participants"))>1&&n.get(t.props.chat,"lastMessage","sender","current")&&n.get(t.props.chat,"lastMessage","time")>t.state.lastReadMark,e.isBot="DIALOG"===n.get(t.props.chat,"type")&&n.get(t.props.chat,"hasBots"),e.chooseExpr="DIALOG"==n.get(t.props.chat,"type")?0:1,e.caseExpr=0===e.chooseExpr,e.participant=e.caseExpr?n.find(n.get(t.props.chat,"participants"),(function(t){return!n.get(t,"user","current")})):void 0,e.uploadMessage=n.find(n.get(t.props.chat,"pending"),(function(t){return n.find(n.get(t,"attaches"),(function(t){return n.get(t,"file")&&"loading"===n.get(t,"status")||"processing"===n.get(t,"status")}))})),e.upload=n.find(n.get(e.uploadMessage,"attaches"),(function(t){return n.get(t,"file")&&"loading"===n.get(t,"status")||"processing"===n.get(t,"status")})),e.value=void 0,e.upload_1=n.get(t.props.chat,"posting","upload",0),e.selectedShare=n.get(t.props.chat,"posting","shares","selected")}function hLt(t,e,o,r){e.favorite=r.favorite,e.compact=o.props.compact,e.double=r.isProduct,e.badge=r.hasBadge,e["data-tsid"]=Pt(0,n.get(o.props.chat,"type"))+"_item",e.class=(!r.noBoldUnread&&o.state.canDisturb&&n.get(o.props.chat,"unreadCount")?"__unread-okmsg":"")+(r.favorite?" __favorite-okmsg":"")}function CLt(t,e,o,r){e.user=n.get(r.participant,"user"),e.size=o.props.compact?"small":"medium",e.showStatus=o.props.showStatus}function kLt(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-user-card",Nh,t),"image"),a=o._n=n.propsSet(r,{slot:"image"});return CLt(0,a,t,o),n.mountComponent(r,a),dLt[0]=1,bLt}function bLt(t,e){var o=e._m,r=e._n;CLt(0,r,t,e),n.updateComponent(o,r)}function yLt(t,e,o){e.url=Gt(0,o.props.chat,o.props.compact?"small":"medium"),e.id=n.get(o.props.chat,"id"),e.caption=n.get(o.props.chat,"title")||n.get(o.props.chat,"placeholder"),e.size=o.props.compact?"small":"medium"}function SLt(t,e,o){var r=o._q=n.insert(e,n.createComponent("msg-avatar",Hp,t),"image"),a=o._r=n.propsSet(r,{slot:"image","data-tsid":"img-avatar"});return yLt(0,a,t),n.mountComponent(r,a),dLt[0]=1,wLt}function wLt(t,e){var o=e._q,r=e._r;yLt(0,r,t),n.updateComponent(o,r)}function ELt(t,e){return[kLt,SLt][e.chooseExpr]}function xLt(t,e,n){e.duration=n.state.callDuration}function ILt(t,e,o){var r=n.insert(e,n.elem("div",mLt),"");n.setClass(r,"call_info-okmsg");var a=o._x=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"audio-call-s","data-tsid":"chat-call-icon"}));var i=o._z=n.appendChild(r,n.createComponent("msg-duration",qi,t)),s=o._10=n.propsSet(i);return xLt(0,s,t),n.mountComponent(i,s),dLt[1]=1,BLt}function BLt(t,e){var o=e._z,r=e._10;xLt(0,r,t),n.updateComponent(o,r)}function MLt(t){return t.state.callDuration>0?ILt:null}function ALt(t,e,o){e.src=n.get(o.props.chat,"subject","imageUrl")}function TLt(t,e,o){var r=o._14=n.insert(e,n.createComponent("msg-img",sLt,t),"image-subj"),a=o._15=n.propsSet(r,{slot:"image-subj",width:48,height:48});return ALt(0,a,t),n.mountComponent(r,a),dLt[2]=1,jLt}function jLt(t,e){var o=e._14,r=e._15;ALt(0,r,t),n.updateComponent(o,r)}function PLt(t,e){return e.isProduct?TLt:null}function RLt(t,e,o,r){e.official=n.call(o.props,"ifOfficial",[o.props.chat]),e.channel="CHANNEL"===n.get(o.props.chat,"type"),e.bot=r.isBot}function LLt(t,e,n){e.chat=n.props.chat}function OLt(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-chat-alerts",Ly,t)),a=r.componentModel.input,i=o._1f=n.propsSet(r);LLt(0,i,t);var s=o._1g=n.insert(a,n.createComponent("msg-icon",xe,t),"off");return n.mountComponent(s,n.propsSet(s,{size:"small",icon:"alert-off_12",slot:"off","data-tsid":"mute_icon"})),n.mountComponent(r,i),dLt[4]=1,zLt}function zLt(t,e){var o=e._1e,r=e._1f;LLt(0,r,t),n.updateComponent(o,r)}function DLt(t){return t.state.canDisturb?null:OLt}function ULt(t,e,o){var r=o._1n=n.insert(e,n.createComponent("msg-icon",xe,t),"favorite");n.mountComponent(r,n.propsSet(r,{slot:"favorite",icon:"in-favorite_12",size:"small"})),dLt[5]=1}function NLt(t,e){return e.favorite?ULt:null}function qLt(t,e,o){var r=o._1s=n.insert(e,n.createComponent("msg-notification-bubble",Vxt,t),"badge"),a=r.componentModel.input;n.insert(a,n.text("!")),n.mountComponent(r,n.propsSet(r,{slot:"badge",type:"warn"})),dLt[6]=1}function HLt(t,e,n){e.type=n.state.canDisturb?null:"muted"}function FLt(t,e,o){var r=o._1y=n.insert(e,n.createComponent("msg-notification-bubble",Vxt,t),"badge"),a=r.componentModel.input,i=o._1z=n.propsSet(r,{slot:"badge"});HLt(0,i,t);var s=o._20=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"reply",size:"small"})),n.mountComponent(r,i),dLt[6]=1,VLt}function VLt(t,e){var o=e._1y,r=e._1z;HLt(0,r,t),n.updateComponent(o,r)}function KLt(t,e,n){e.chat=n.props.chat}function WLt(t,e,o){var r=o._25=n.insert(e,n.createComponent("msg-chat-notification-bubble",$xt,t),"badge"),a=o._26=n.propsSet(r,{slot:"badge","data-tsid":"chat-notification"});return KLt(0,a,t),n.mountComponent(r,a),dLt[6]=1,GLt}function GLt(t,e){var o=e._25,r=e._26;KLt(0,r,t),n.updateComponent(o,r)}function YLt(t,e,o){var r=o._29=n.insert(e,n.createComponent("msg-icon",xe,t),"badge");n.mountComponent(r,n.propsSet(r,{icon:"bday",slot:"badge"})),dLt[6]=1}function XLt(t,e){var o=n.insert(e,n.elem("span",mLt),"badge");n.setAttribute(o,"slot","badge"),n.setClass(o,"my-unread-okmsg"),dLt[6]=1}function QLt(t,e){return n.get(t.props.chat,"lastError")?qLt:t.state.hasUnreadReply?FLt:n.get(t.props.chat,"unreadCount")?WLt:"DIALOG"===n.get(t.props.chat,"type")&&zt(0,n.get(e.participants,0,"user","bday"))?YLt:!t.props.largeChat&&"CHANNEL"!=n.get(t.props.chat,"type")&&Tt(0,n.get(t.props.chat,"participants"))>1&&n.get(t.props.chat,"lastMessage","sender","current")&&n.get(t.props.chat,"lastMessage","time")>t.state.lastReadMark?XLt:null}function JLt(t,e,o){n.updateClass(t,e,"text-okmsg"+(o.state.canDisturb&&n.get(o.props.chat,"typingParticipants")?" __offset-okmsg":""))}function $Lt(t,e,o){e.type=n.get(o.props.chat,"type"),e.users=n.get(o.props.chat,"typingParticipants")}function ZLt(t,e){var o=e._2l,r=e._2m;$Lt(0,r,t),n.updateComponent(o,r)}function tOt(t,e,o){return o._2l?ZLt(t,o):function(t,e,o){var r=o._2l=n.insert(e,n.createComponent("msg-typing-indicator",Dk,t)),a=o._2m=n.propsSet(r);$Lt(0,a,t),n.mountComponent(r,a),dLt[1]=1}(t,e,o),n.stopAnimation(o._2l,!0),eOt}function eOt(t,e){ZLt(t,e)}function nOt(t,e,o){var r=o._2p=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"bot"})),dLt[1]=1}function oOt(t,e,o,r){e.user=n.find(n.get(r.value,"value","chat","participants"),(function(t){return!n.get(t,"user","current")}))}function rOt(t,e,o){var r=o._2t=n.insert(e,n.createComponent("msg-online-label",ay,t)),a=o._2u=n.propsSet(r);return oOt(0,a,0,o),n.mountComponent(r,a),dLt[1]=1,aOt}function aOt(t,e){var o=e._2t,r=e._2u;oOt(0,r,0,e),n.updateComponent(o,r)}function iOt(t,e,o){var r=o._34=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"photo_12",size:"small"})),dLt[1]=1}function sOt(t,e,o){var r=o._38=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"media-mixed_12",size:"small"})),dLt[1]=1}function uOt(t,e,o){var r=o._3c=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"microphone_12",size:"small"})),dLt[1]=1}function cOt(t,e,o){var r=o._3g=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"media-share_12",size:"small"})),dLt[1]=1}function pOt(t,e,o){var r=o._3k=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"file_12",size:"small"})),dLt[1]=1}function lOt(t,e,o){var r=o._3o=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{icon:"user_12",size:"small"})),dLt[1]=1}function mOt(t,e){return"PHOTO"===n.get(e.upload_1,"_type")?iOt:"VIDEO"===n.get(e.upload_1,"_type")?sOt:"AUDIO"===n.get(e.upload_1,"_type")?uOt:"SHARE"===n.get(e.upload_1,"_type")?cOt:"FILE"===n.get(e.upload_1,"_type")?pOt:"CONTACT"===n.get(e.upload_1,"_type")?lOt:null}function dOt(t,e,o){var r=o._3u=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"voice-message"})),dLt[1]=1}function _Ot(t,e,o){e.messageElements=n.get(o.props.chat,"posting","messageElements")}function fOt(t,e,o){var r=o._3y=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input,i=o._3z=n.propsSet(r,{textEmoji:!0,userSticker:!0,disableLinks:!0,userStickerSize:"compact"});return _Ot(0,i,t),o._40=n.insert(a,n.text(n.get(t.props.chat,"posting","text")||n.get(t.props.chat,"posting","urls",o.selectedShare)||n.get(o.upload_1,"file","name"))),n.mountComponent(r,i),dLt[1]=1,gOt}function gOt(t,e){var o=e._3y,r=e._3z;_Ot(0,r,t),dLt[7]|=n.updateText(e._40,n.get(t.props.chat,"posting","text")||n.get(t.props.chat,"posting","urls",e.selectedShare)||n.get(e.upload_1,"file","name")),n.updateIncomingSlot(o,"",dLt[7]),n.updateComponent(o,r)}function vOt(t){return n.get(t.props.chat,"posting","voiceMessage")?dOt:fOt}function hOt(t,e,o){var r=n.insert(e,n.elem("div",mLt)),a=n.createInjector(r);n.setClass(r,"draft-okmsg");var i=o._2y=n.insert(a,n.createComponent("msg-l10n",ae,t));return n.mountComponent(i,n.propsSet(i,{key:"draft"})),o._30=n.insert(a,n.text(" ")),o._31=n.mountBlock(t,a,mOt),o._3r=n.mountBlock(t,a,vOt),dLt[1]=1,COt}function COt(t,e){dLt[1]|=n.updateText(e._30," "),n.updateBlock(e._31),n.updateBlock(e._3r)}function kOt(t,e,o,r){e.indeterminate="loading"!==n.get(r.upload_1,"status"),e.progress=n.get(r.upload_1,"progress")?n.get(r.upload_1,"progress","loaded")/n.get(r.upload_1,"progress","total"):null}function bOt(t,e,o){var r=o._44=n.insert(e,n.createComponent("msg-progress",Ps,t)),a=o._45=n.propsSet(r,{size:16,radius:5,thickness:2,spin:!0});return kOt(0,a,0,o),n.mountComponent(r,a),o._46=n.insert(e,n.text(n.get(o.upload_1,"file","name"))),dLt[1]=1,yOt}function yOt(t,e){var o=e._44,r=e._45;kOt(0,r,0,e),n.updateComponent(o,r),dLt[1]|=n.updateText(e._46,n.get(e.upload_1,"file","name"))}function SOt(t,e,o,r){e.message=n.get(o.props.chat,"lastMessage"),e.chatType=n.get(o.props.chat,"type"),e.canDisturb=o.state.canDisturb,e.class=!r.noBoldUnread&&o.state.canDisturb&&n.get(o.props.chat,"unreadCount")?"__unread-okmsg":""}function wOt(t,e,o){var r=o._49=n.insert(e,n.createComponent("msg-chat-last-message",uMt,t)),a=o._4a=n.propsSet(r,{"data-tsid":"last-message"});return SOt(0,a,t,o),n.mountComponent(r,a),dLt[1]=1,EOt}function EOt(t,e){var o=e._49,r=e._4a;SOt(0,r,t,e),n.updateComponent(o,r)}function xOt(t,e){return t.state.canDisturb&&n.get(t.props.chat,"typingParticipants")?tOt:!n.get(t.props.chat,"hasBots")||n.get(t.props.chat,"posting")||"DIALOG"!==n.get(t.props.chat,"type")||n.get(t.props.chat,"lastMessage")?n.get(t.props.chat,"posting")||!n.get(t.props.chat,"isFake")&&(n.get(t.props.chat,"lastMessage")||"DIALOG"!==n.get(t.props.chat,"type"))?!n.get(t.props.chat,"posting")||n.get(t.props.chat,"selected")&&n.get(t.props.chat,"lastMessage")?e.upload&&!n.get(t.props.chat,"selected")?bOt:n.get(t.props.chat,"lastMessage")?wOt:null:hOt:rOt:nOt}function IOt(t,e){var o=t.componentView;fLt(),vLt(t,e);var r=e._h=n.appendChild(o,n.createComponent("msg-chat-item-container",eb,t)),a=r.componentModel.input,i=e._i=n.propsSet(r,{foldable:!0});hLt(0,i,t,e),e._j=n.mountBlock(t,a,ELt),e._t=n.mountBlock(t,a,MLt),e._11=n.mountBlock(t,a,PLt);var s=n.insert(a,n.elem("div",mLt),"title"),u=n.createInjector(s);n.setAttribute(s,"slot","title"),n.setClass(s,"title-okmsg"),n.setAttribute(s,"data-tsid","conversation_name");var c=e._17=n.insert(u,n.createComponent("msg-name",Sh,t)),p=c.componentModel.input,l=e._18=n.propsSet(c);RLt(0,l,t,e),e._19=n.insert(p,n.text(n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder"))),n.mountComponent(c,l),e._1b=n.mountBlock(t,u,DLt),e._1k=n.mountBlock(t,a,NLt),e._1p=n.mountBlock(t,a,QLt);var m=e._2e=n.insert(a,n.elem("div",mLt),""),d=n.createInjector(m),_=e._2f=n.obj();return n.setAttribute(m,"data-tsid","last_message"),JLt(m,_,t),e._2g=n.mountBlock(t,d,xOt),n.mountComponent(r,i),gLt(),n.subscribeStore(t,["config","l10n"]),BOt}function BOt(t,e){var o=e._h,r=e._i,a=e._17,i=e._18;fLt(),vLt(t,e),hLt(0,r,t,e),n.updateBlock(e._j),n.updateBlock(e._t),n.updateBlock(e._11),RLt(0,i,t,e),dLt[3]|=n.updateText(e._19,n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder")),n.updateIncomingSlot(a,"",dLt[3]),n.updateComponent(a,i),n.updateBlock(e._1b),n.updateBlock(e._1k),n.updateBlock(e._1p),JLt(e._2e,e._2f,t),n.updateBlock(e._2g),n.updateIncomingSlot(o,"image",dLt[0]),n.updateIncomingSlot(o,"",dLt[1]),n.updateIncomingSlot(o,"image-subj",dLt[2]),n.updateIncomingSlot(o,"title",dLt[4]),n.updateIncomingSlot(o,"favorite",dLt[5]),n.updateIncomingSlot(o,"badge",dLt[6]),n.updateComponent(o,r),gLt()}kLt.dispose=function(t){t._m=n.unmountComponent(t._m),t._n=null,dLt[0]=1},SLt.dispose=function(t){t._q=n.unmountComponent(t._q),t._r=null,dLt[0]=1},ILt.dispose=function(t){t._x=n.unmountComponent(t._x),t._z=n.unmountComponent(t._z),t._10=null,dLt[1]=1},TLt.dispose=function(t){t._14=n.unmountComponent(t._14),t._15=null,dLt[2]=1},OLt.dispose=function(t){t._1g=n.unmountComponent(t._1g),t._1e=n.unmountComponent(t._1e),t._1f=null,dLt[4]=1},ULt.dispose=function(t){t._1n=n.unmountComponent(t._1n),dLt[5]=1},qLt.dispose=function(t){t._1s=n.unmountComponent(t._1s),dLt[6]=1},FLt.dispose=function(t){t._20=n.unmountComponent(t._20),t._1y=n.unmountComponent(t._1y),t._1z=null,dLt[6]=1},WLt.dispose=function(t){t._25=n.unmountComponent(t._25),t._26=null,dLt[6]=1},YLt.dispose=function(t){t._29=n.unmountComponent(t._29),dLt[6]=1},XLt.dispose=function(){dLt[6]=1},tOt.dispose=function(t,e){n.animate(t._2l,n.createAnimation("hide-typing 0.2s",mLt),(function(){return function(t){var e=t._2l;t._2l=n.unmountComponent(e),n.domRemove(e),t._2m=null,dLt[1]=1}(t)}))},nOt.dispose=function(t){t._2p=n.unmountComponent(t._2p),dLt[1]=1},rOt.dispose=function(t){t._2t=n.unmountComponent(t._2t),t._2u=null,dLt[1]=1},iOt.dispose=function(t){t._34=n.unmountComponent(t._34),dLt[1]=1},sOt.dispose=function(t){t._38=n.unmountComponent(t._38),dLt[1]=1},uOt.dispose=function(t){t._3c=n.unmountComponent(t._3c),dLt[1]=1},cOt.dispose=function(t){t._3g=n.unmountComponent(t._3g),dLt[1]=1},pOt.dispose=function(t){t._3k=n.unmountComponent(t._3k),dLt[1]=1},lOt.dispose=function(t){t._3o=n.unmountComponent(t._3o),dLt[1]=1},dOt.dispose=function(t){t._3u=n.unmountComponent(t._3u),dLt[1]=1},fOt.dispose=function(t){t._3y=n.unmountComponent(t._3y),t._3z=t._40=null,dLt[1]=1},hOt.dispose=function(t){t._2y=n.unmountComponent(t._2y),t._31=n.unmountBlock(t._31),t._3r=n.unmountBlock(t._3r),t._30=null,dLt[1]=1},bOt.dispose=function(t){t._44=n.unmountComponent(t._44),t._45=t._46=null,dLt[1]=1},wOt.dispose=function(t){t._49=n.unmountComponent(t._49),t._4a=null,dLt[1]=1},IOt.dispose=function(t){fLt(),t._j=n.unmountBlock(t._j),t._t=n.unmountBlock(t._t),t._11=n.unmountBlock(t._11),t._17=n.unmountComponent(t._17),t._1b=n.unmountBlock(t._1b),t._1k=n.unmountBlock(t._1k),t._1p=n.unmountBlock(t._1p),t._2g=n.unmountBlock(t._2g),t._h=n.unmountComponent(t._h),gLt()};var MOt={__proto__:null,cssScope:mLt,default:IOt,props:function(){return{chat:null,selected:!1,active:!1,compact:!1,largeChat:!1}},events:cLt,methods:pLt,willMount:function(t){uLt.add(t),lLt(t)},willUnmount:function(t){uLt.remove(t)},didChange:function(t,e){var n=e.chat;n&&n.current&&(!function(t,e){var n=e.participants.reduce((function(t,e){return!e.user.current&&e.time>t?e.time:t}),0);t.setState({lastReadMark:n})}(t,n.current),t.setState({hasUnreadReply:pMt(n.current),canDisturb:c(n.current)}),lLt(t))}};var AOt={selectChat:function(){$p(this.props.data.chatId)},selectActiveItem:function(){this.selectChat()}},TOt="ekhm019",jOt=[0,0,0,0,0],POt=[];function ROt(){POt.push(jOt),jOt=[0,0,0,0,0]}function LOt(){jOt=POt.pop()}function OOt(t,e){e.chat=n.get(t.props.data,"chat"),e.isBot="DIALOG"==n.get(e.chat,"type")&&n.get(e.chat,"hasBots"),e.dialogWith="DIALOG"===n.get(e.chat,"type")&&n.get(n.find(n.get(e.chat,"participants"),(function(t){return!n.get(t,"user","current")})),"user"),e.chooseExpr="MESSAGES"==n.get(t.props.data,"section")?0:1,e.caseExpr=0===e.chooseExpr,e.message=e.caseExpr?"FORWARD"==n.get(t.props.data,"message","link","type")?n.get(t.props.data,"message","link","message"):n.get(t.props.data,"message"):void 0,e.attachment=e.caseExpr?n.get(e.message,"attaches",0):void 0,e.attachmentType=e.caseExpr?n.get(e.attachment,"_type"):void 0}function zOt(t,e,o,r){e.class=null==n.get(o.props.data,"section")&&n.get(r.chat,"unreadCount")?"__unread-okmsg":""}function DOt(t,e,n,o){e.chat=o.chat}function UOt(t,e,o,r){e.official=Yt(0,r.chat),e.channel="CHANNEL"==n.get(r.chat,"type"),e.highlights=n.get(o.props.data,"highlights"),e.bot=r.isBot}function NOt(t,e,o,r){e.message=r.message,e.attachment=r.attachment,e.highlights=n.get(o.props.data,"highlights"),e.type=r.attachmentType}function qOt(t,e,o){var r=o._s=n.insert(e,n.createComponent("msg-notification-bubble",Vxt,t),"badge"),a=r.componentModel.input;return o._u=n.insert(a,n.text(n.get(t.props.data,"count"))),n.mountComponent(r,n.propsSet(r,{slot:"badge",type:"count"})),jOt[2]=1,HOt}function HOt(t,e){jOt[3]|=n.updateText(e._u,n.get(t.props.data,"count")),n.updateIncomingSlot(e._s,"",jOt[3])}function FOt(t){return n.get(t.props.data,"count")?qOt:null}function VOt(t,e,o){var r=o._n=n.insert(e,n.createComponent("msg-chats-list-message",NBt,t),""),a=o._o=n.propsSet(r);return NOt(0,a,t,o),n.mountComponent(r,a),o._p=n.mountBlock(t,e,FOt),jOt[1]=1,KOt}function KOt(t,e){var o=e._n,r=e._o;NOt(0,r,t,e),n.updateComponent(o,r),n.updateBlock(e._p)}function WOt(t,e,o){e.highlights=n.get(o.props.data,"highlights")}function GOt(t,e,o){var r=o._11=n.insert(e,n.createComponent("msg-parsed-text",ii,t),""),a=r.componentModel.input,i=o._12=n.propsSet(r,{disableFormatting:!0,focusHighlight:2,disableLinks:!0});return WOt(0,i,t),o._13=n.insert(a,n.text(n.get(t.props.data,"matchedParticipants"))),n.mountComponent(r,i),jOt[1]=1,YOt}function YOt(t,e){var o=e._11,r=e._12;WOt(0,r,t),jOt[4]|=n.updateText(e._13,n.get(t.props.data,"matchedParticipants")),n.updateIncomingSlot(o,"",jOt[4]),n.updateComponent(o,r)}function XOt(t,e,o){var r=o._17=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"bot"})),jOt[1]=1}function QOt(t,e,n,o){e.user=o.dialogWith}function JOt(t,e,o){var r=o._1b=n.insert(e,n.createComponent("msg-online-label",ay,t),""),a=o._1c=n.propsSet(r);return QOt(0,a,0,o),n.mountComponent(r,a),jOt[1]=1,$Ot}function $Ot(t,e){var o=e._1b,r=e._1c;QOt(0,r,0,e),n.updateComponent(o,r)}function ZOt(t,e,o,r){e.message=n.get(r.chat,"lastMessage"),e.chatType=n.get(r.chat,"type"),e.canDisturb=c(r.chat)}function tzt(t,e,o){var r=o._1f=n.insert(e,n.createComponent("msg-chat-last-message",uMt,t),""),a=o._1g=n.propsSet(r);return ZOt(0,a,0,o),n.mountComponent(r,a),jOt[1]=1,ezt}function ezt(t,e){var o=e._1f,r=e._1g;ZOt(0,r,0,e),n.updateComponent(o,r)}function nzt(t,e){return n.get(t.props.data,"matchedParticipants")?GOt:e.isBot?XOt:n.get(e.chat,"isFake")?JOt:n.get(e.chat,"lastMessage")?tzt:null}function ozt(t,e,n,o){e.chat=o.chat}function rzt(t,e,o){var r=o._1k=n.insert(e,n.createComponent("msg-chat-notification-bubble",$xt,t),"badge"),a=o._1l=n.propsSet(r,{slot:"badge"});return ozt(0,a,0,o),n.mountComponent(r,a),jOt[2]=1,azt}function azt(t,e){var o=e._1k,r=e._1l;ozt(0,r,0,e),n.updateComponent(o,r)}function izt(t,e){return n.get(e.chat,"unreadCount")?rzt:null}function szt(t,e,o){return o._y=n.mountBlock(t,e,nzt),o._1h=n.mountBlock(t,e,izt),uzt}function uzt(t,e){n.updateBlock(e._y),n.updateBlock(e._1h)}function czt(t,e){return[VOt,szt][e.chooseExpr]}function pzt(t,e){var o=t.componentView;ROt(),OOt(t,e);var r=e._a=n.appendChild(o,n.createComponent("msg-chat-item-container",eb,t)),a=r.componentModel.input,i=e._b=n.propsSet(r,{"data-tsid":"conversation"});zOt(0,i,t,e);var s=e._c=n.insert(a,n.createComponent("msg-chat-image",db,t),"image"),u=e._d=n.propsSet(s,{slot:"image"});DOt(0,u,0,e),n.mountComponent(s,u);var c=n.insert(a,n.elem("div",TOt),"title");n.setAttribute(c,"slot","title"),n.setClass(c,"title_w-okmsg");var p=n.appendChild(c,n.elem("div",TOt));n.setClass(p,"title-okmsg");var l=e._g=n.appendChild(p,n.createComponent("msg-name",Sh,t)),m=l.componentModel.input,d=e._h=n.propsSet(l,{formatting:!1,"data-tsid":"conversation_name"});return UOt(0,d,t,e),e._i=n.insert(m,n.text(n.get(e.chat,"title")||n.get(e.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder"))),n.mountComponent(l,d),e._k=n.mountBlock(t,a,czt),n.mountComponent(r,i),LOt(),n.subscribeStore(t,["l10n"]),lzt}function lzt(t,e){var o=e._a,r=e._b,a=e._c,i=e._d,s=e._g,u=e._h;ROt(),OOt(t,e),zOt(0,r,t,e),DOt(0,i,0,e),n.updateComponent(a,i),UOt(0,u,t,e),jOt[0]|=n.updateText(e._i,n.get(e.chat,"title")||n.get(e.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder")),n.updateIncomingSlot(s,"",jOt[0]),n.updateComponent(s,u),n.updateBlock(e._k),n.updateIncomingSlot(o,"",jOt[1]),n.updateIncomingSlot(o,"badge",jOt[2]),n.updateComponent(o,r),LOt()}qOt.dispose=function(t){t._s=n.unmountComponent(t._s),t._u=null,jOt[2]=1},VOt.dispose=function(t){t._n=n.unmountComponent(t._n),t._p=n.unmountBlock(t._p),t._o=null,jOt[1]=1},GOt.dispose=function(t){t._11=n.unmountComponent(t._11),t._12=t._13=null,jOt[1]=1},XOt.dispose=function(t){t._17=n.unmountComponent(t._17),jOt[1]=1},JOt.dispose=function(t){t._1b=n.unmountComponent(t._1b),t._1c=null,jOt[1]=1},tzt.dispose=function(t){t._1f=n.unmountComponent(t._1f),t._1g=null,jOt[1]=1},rzt.dispose=function(t){t._1k=n.unmountComponent(t._1k),t._1l=null,jOt[2]=1},szt.dispose=function(t){t._y=n.unmountBlock(t._y),t._1h=n.unmountBlock(t._1h)},pzt.dispose=function(t){ROt(),t._c=n.unmountComponent(t._c),t._g=n.unmountComponent(t._g),t._k=n.unmountBlock(t._k),t._a=n.unmountComponent(t._a),LOt()};var mzt={__proto__:null,cssScope:TOt,default:pzt,props:function(){return{data:null,selected:!1,active:!1}},extend:AOt};var dzt={type:"delimiter",id:"chats-delimiter"},_zt={type:"delimiter",id:"messages-delimiter"},fzt={scroll:function(t){t.state._list.handleScroll(t),hzt(t)}},gzt={activateNext:function(t){!function(t,e){var n=t.state._list,o=n.items.filter(kzt),r=n.visibleItems(t).filter(kzt),a=t.state,i=a.active,s=a.selected,u=function(t,e,n,o){var r,a=e.length;return a?(r=o?e.findIndex((function(t){return t.id===o}))+t:e.findIndex((function(t){return t.id===n[0].id})),r<0&&(r=0),r>a-1&&(r=a-1),e[r]):null}(e,o,r,i||s);if(u){t.setState({active:u.id}),function(t,e,n,o){void 0===n&&(n=.3);void 0===o&&(o=!1);var r=t.state._list;!e||!o&&r.inViewport(e,t)||r.scrollTo(e,t,n)}(t,u,e>0?.8:.2,u===r[0]||u===r[r.length-1])}}(this,t)},selectActiveItem:function(){var t;(t=this.refs.active)&&"function"==typeof t.selectActiveItem&&t.selectActiveItem()}};function vzt(t,e){var n,o=e.props.search,r=t.item.chat;e.setState({selected:t.id});var a=e.store.app.stats;if(r){var i=e.store.get().isMobile,s={};"MESSAGES"===t.item.section&&i&&(s.messagesTime=null===(n=t.item.message)||void 0===n?void 0:n.time),$p(r.id,s).then((function(){"MESSAGES"!==t.item.section||s.messagesTime||Zt(e,"message-search",{chatId:r.id,query:o.query})}))}else a.log.error("INVALID_SEARCH_RESULT",JSON.stringify(t))}var hzt=o.throttle((function(t){var e=t.props.search;if(e){t.scrollHeight-t.scrollTop-t.clientHeight<=150&&"idle"===e.loadState&&e.marker&&t.store.app.chat.loadMoreSearchResults()}}),150,{leading:!1});function Czt(t){return t&&t.query}function kzt(t){return"delimiter"!==t.type}var bzt="exi3sgh";function yzt(t,e){e.isEmpty=0===Tt(0,n.get(t.state.scrollList,"items")),e.value=void 0}function Szt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function wzt(t){return n.get(t.state.scrollList,"items")}function Ezt(t,e){return n.get(e.value,"value","id")}function xzt(t,e){e.type=n.get(e.value,"value","type"),e.item=n.get(e.value,"value","item"),e.id=n.get(e.value,"value","id")}function Izt(t,e,o,r){e.chat=r.item,e.active=r.id===o.state.active,e.selected=n.get(r.item,"selected"),e["data-item-id"]=r.id,e["data-tsid-id"]=n.get(r.item,"type")}function Bzt(t,e){t.setState({selected:null})}function Mzt(t,e,n,o){t.setState({active:o.id})}function Azt(t,e,o){var r=o._h=n.insert(e,n.createComponent("msg-chats-list-item",MOt,t));n.setPendingRef(o._1,o.id===t.state.active?"active":null,r);var a=o._i=n.propsSet(r,{role:"menuitem","data-tsid":"chat"});return Izt(0,a,t,o),o._j=n.addEvent(r,"click",Bzt,t,o),o._k=n.addEvent(r,"mouseenter",Mzt,t,o),n.mountComponent(r,a),Tzt}function Tzt(t,e){var o=e._h,r=e._i;n.setPendingRef(e._1,e.id===t.state.active?"active":null,o),Izt(0,r,t,e),n.updateComponent(o,r)}function jzt(t,e,o,r){n.updateAttribute(t,e,"data-item-id",r.id)}function Pzt(t,e,o){return jzt(o._n=n.insert(e,n.elem("hr",bzt)),o._o=n.obj(),0,o),Rzt}function Rzt(t,e){jzt(e._n,e._o,0,e)}function Lzt(t,e,o,r){n.updateAttribute(t,e,"data-item-id",r.id)}function Ozt(t,e,o){var r=o._r=n.insert(e,n.elem("h4",bzt)),a=o._s=n.obj();n.setClass(r,"h4-okmsg"),Lzt(r,a,0,o);var i=o._t=n.appendChild(r,n.createComponent("msg-l10n",ae,t));return n.mountComponent(i,n.propsSet(i,{key:"message-text"})),zzt}function zzt(t,e){Lzt(e._r,e._s,0,e)}function Dzt(t,e,o,r){e.data=r.item,e.selected=r.id===o.state.selected,e.active=r.id===o.state.active,e["data-item-id"]=r.id,e["data-tsid-id"]=n.get(r.item,"chat","type")}function Uzt(t,e,o,r){vzt(n.get(r.value,"value"),t)}function Nzt(t,e,n,o){t.setState({active:o.id})}function qzt(t,e){t.setState({active:null})}function Hzt(t,e,o){var r=o._x=n.insert(e,n.createComponent("msg-search-results-item",mzt,t));n.setPendingRef(o._1,o.id===t.state.active?"active":null,r);var a=o._y=n.propsSet(r,{"data-tsid":"chat"});return Dzt(0,a,t,o),o._z=n.addEvent(r,"click",Uzt,t,o),o._10=n.addEvent(r,"mouseenter",Nzt,t,o),o._11=n.addEvent(r,"mouseleave",qzt,t,o),n.mountComponent(r,a),Fzt}function Fzt(t,e){var o=e._x,r=e._y;n.setPendingRef(e._1,e.id===t.state.active?"active":null,o),Dzt(0,r,t,e),n.updateComponent(o,r)}function Vzt(t,e){return"chat"===e.type?Azt:"delimiter"===e.type&&"chats-delimiter"===e.id?Pzt:"delimiter"===e.type&&"messages-delimiter"===e.id?Ozt:Hzt}function Kzt(t,e,o){return xzt(0,o),o._e=n.mountBlock(t,e,Vzt),Wzt}function Wzt(t,e){xzt(0,e),n.updateBlock(e._e)}function Gzt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px;")}function Yzt(t,e,o){var r=n.insert(e,n.elem("div",bzt));n.setClass(r,"not-found-okmsg");var a=o._19=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{icon:"search"}));var i=o._1b=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"not-found"}))}function Xzt(t,e,o){var r=n.insert(e,n.elem("div",bzt));n.setClass(r,"spinner-container-okmsg");var a=o._1g=n.appendChild(r,n.createComponent("msg-progress",Ps,t));n.mountComponent(a,n.propsSet(a,{size:40,radius:16,thickness:3,spin:!0,indeterminate:!0}))}function Qzt(t,e){return!t.props.loading&&e.isEmpty?Yzt:t.props.loading&&!e.isEmpty?Xzt:null}function Jzt(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();return yzt(t,e),Szt(e._5=n.insert(r,n.elem("div",bzt)),e._6=n.obj(),t),e._7=n.mountKeyIterator(t,r,wzt,Ezt,Kzt),Gzt(e._13=n.insert(r,n.elem("div",bzt)),e._14=n.obj(),t),e._15=n.mountBlock(t,r,Qzt),n.finalizePendingRefs(t,a),$zt}function $zt(t,e){yzt(t,e),Szt(e._5,e._6,t),n.updateKeyIterator(e._7),Gzt(e._13,e._14,t),n.updateBlock(e._15),n.finalizePendingRefs(t,e._1)}Azt.dispose=function(t){t._j=n.removeEvent("click",t._j),t._k=n.removeEvent("mouseenter",t._k),t._h=n.unmountComponent(t._h),t._i=null},Pzt.dispose=function(t){t._o=t._n=null},Ozt.dispose=function(t){t._t=n.unmountComponent(t._t),t._s=t._r=null},Hzt.dispose=function(t){t._z=n.removeEvent("click",t._z),t._10=n.removeEvent("mouseenter",t._10),t._11=n.removeEvent("mouseleave",t._11),t._x=n.unmountComponent(t._x),t._y=null},Kzt.dispose=function(t){t._e=n.unmountBlock(t._e)},Yzt.dispose=function(t){t._19=n.unmountComponent(t._19),t._1b=n.unmountComponent(t._1b)},Xzt.dispose=function(t){t._1g=n.unmountComponent(t._1g)},Jzt.dispose=function(t){t._7=n.clearKeyIterator(t._7),t._15=n.clearBlock(t._15)};var Zzt={__proto__:null,cssScope:bzt,default:Jzt,events:fzt,extend:gzt,init:function(t){t.setState({_list:new YL({itemHeight:64,initialItems:30,onUpdate:function(e){return t.setState({scrollList:e})}}),_timeMark:Date.now(),_firstChatId:null}),Zt(t,"log-screen","CHATS_SEARCH")},didChange:function(t,e){var n=e.chats,o=e.search;if(n){var r=t.state._timeMark,a=p(n.current).filter((function(t){return t.lastEventTime>r&&c(t)})).sort((function(t,e){return e.lastEventTime-t.lastEventTime})).map((function(t){return{type:"chat",id:t.id,item:t}}));t.setState({chats:a})}o&&o.current&&(o.prev&&Czt(o.prev)===Czt(o.current)||(t.componentView.scrollTop=0),t.state._list.update(function(t){var e=t.state.chats,n=t.props.search,o=[];e&&e.length&&(o=o.concat(e,dzt));if(n&&n.result){var r=!1;n.result.forEach((function(t){"MESSAGES"!==t.section||r||(r=!0,o.push(_zt));var e="MESSAGES"===t.section?t.message.id:t.chatId;o.push({type:"search",id:"".concat(t.section,"-").concat(e),item:t})}))}return o}(t),t))},didRender:function(t){var e=t.state,n=e.chats,o=e._list,r=e._firstChatId,a=n&&n[0];if(o.readRects(t.componentView,"data-item-id"),a&&a.id!==r){t.state._firstChatId=a.id;var i=t.scrollTop;i&&o.animateScroll(t,i,0)}hzt(t)},onSelectItem:vzt};var tDt={PHOTO:"📷",VIDEO:"📹",AUDIO:"🔈",MUSIC:"🔈",FILE:"📁",CALL:"📞",CONTACT:"👤"},eDt=function(){function t(t){this.component=t,this.unreadMessages=0,this.layerHidden=!1}return Object.defineProperty(t.prototype,"settings",{get:function(){return Ei(this.component)||{}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"server",{get:function(){return this.component.store.get().config.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return u(this.settings.DONT_DISTURB_UNTIL)},enumerable:!1,configurable:!0}),t.prototype.enable=function(){wi(this.component,"DONT_DISTURB_UNTIL",0)},t.prototype.disable=function(){wi(this.component,"DONT_DISTURB_UNTIL",-1)},t.prototype.emit=function(t,e){Zt(this.component,t,e)},t.prototype.update=function(t){if(t){var e=this.server&&this.server["reactions-toolbar"],n=cMt(t.chatList,e);this.unreadStats&&this.notifyNewMessages(n,this.unreadStats),this.notifyUnreadChats(n,this.unreadStats,e),this.notifyUnreadMessages(n,this.unreadStats),this.unreadStats=n,t.unreadStats=n}else this.unreadStats=null},t.prototype.setLayerHidden=function(t){this.layerHidden=t},t.prototype.notifyNewMessages=function(t,e){if(this.enabled){var n=this.settings,o=this.server||{},r=o["browser-notif-fix"],a=o["notif-web-push-check"],i=aDt(n.UI_NOTIFICATIONS,r)&&window.Notification&&"granted"===window.Notification.permission&&(!a||"PushManager"in window&&"serviceWorker"in navigator&&window.Notification&&"localStorage"in window),s=iDt(n.PUSH_SOUND);if(i||s){var u=function(t,e,n){var o=[],r=n&&!n.PUSH_DETAILS,a=V("notifications-new-message");return e.forEach((function(e,n){var i=t.get(n),s=e.chat;e.unreadMessages.forEach((function(t){(function(t){return t.attaches&&t.attaches[0]&&"CONTROL"===t.attaches[0]._type})(t)||i&&null!=i.lastMessageTime&&!(t.time>i.lastMessageTime)||o.push({chatId:s.id,msgId:t.uid,chatSelected:e.selected,title:s.title||s.placeholder,body:r?a:nDt(t,s),icon:Bt(s),url:Xn(s)})}))})),o}(e,t,n);if(u.length>0){var c={notifications:u,showNotifications:i,playSound:s,active:!this.layerHidden};this.emit("notify-new-messages",c)}}}},t.prototype.notifyUnreadChats=function(t,e,n){var o=rDt(t,n),r=e&&rDt(e,n);r&&o.conv===r.conv&&o.hasReply===r.hasReply&&o.lastReaction===r.lastReaction||(o.showGrowlTT=this.settings.GROWL&&this.layerHidden,this.emit("unread-chats-count-update",o))},t.prototype.notifyUnreadMessages=function(t,e){var n=oDt(t);n!==(e?oDt(t):0)&&this.emit("unread-messages-count-update",n)},t}();function nDt(t,e){var n=t.attaches&&t.attaches[0],o=t.text,r="";switch(t.link&&"FORWARD"===t.link.type&&t.link.message&&(o=nDt(t.link.message,e)),e&&"CHAT"===e.type&&"CHANNEL"!==t.type&&(r="".concat(t.sender.name,": ")),n&&n._type){case"STICKER":var a=n.tags;o="".concat(a&&a[0]||""," ").concat(V("sticker")).trim();break;case"PHOTO":case"VIDEO":case"AUDIO":o="".concat(tDt[n._type]," ").concat(o);break;case"MUSIC":o="".concat(tDt[n._type]," ").concat(n.artistName," - ").concat(n.title);break;case"FILE":var i=n.preview;o="".concat(tDt[i&&i._type||n._type]," ").concat(n.name);break;case"SHARE":o=o||n.url;break;case"CALL":o="".concat(tDt.CALL," ").concat(V("".concat(n.callType.toLowerCase(),"-call")));break;case"CONTACT":o="".concat(tDt.CONTACT," ").concat(n.user.name||n.name)}return r+o}function oDt(t){var e=0;return t.forEach((function(t){var n=t.chat;return e+=n.unreadCount})),e}function rDt(t,e){var n,o=0,r=!1,a=0;return t.forEach((function(t){var i,s=t.chat;s.unreadCount&&!(null===(i=s.groupChatInfo)||void 0===i?void 0:i.isModerator)&&(o++,r=r||t.hasReply),e&&s.lastReaction&&s.lastEventTime>a&&(n=s.lastReaction,a=s.lastEventTime)})),{conv:o,hasReply:r,lastReaction:n}}function aDt(t,e){return t||!1!==t&&e}function iDt(t){return"_NONE_"!==t}function sDt(t){var e;Qp("/"),uDt(null===(e=t.state.chatFilter)||void 0===e?void 0:e.find((function(t){return t.currentUser})),t)}function uDt(t,e){Zt(e,"scroll-list-to-top");var n=t.selected,o=t.id;n||Zt(e,"filter-groups",!t.currentUser?o:void 0)}function cDt(t,e,n,o,r){return void 0===o&&(o=!1),void 0===r&&(r=!1),{id:t,icon:e,name:n,selected:o,currentUser:r}}function pDt(t,e,n){var o=t.id;return t.currentUser?e:null==n?void 0:n.get(o)}var lDt="eblb3m5",mDt=[0,0,0,0,0,0],dDt=[];function _Dt(){dDt.push(mDt),mDt=[0,0,0,0,0,0]}function fDt(){mDt=dDt.pop()}function gDt(t,e){e.selected=n.find(t.state.chatFilter,(function(t){return n.get(t,"selected")}))}function vDt(t,e,o,r){e.url=n.get(r.selected,"icon"),e.id=n.get(r.selected,"id"),e.caption=n.get(r.selected,"name")}function hDt(t,e,o){var r=o._a=n.insert(e,n.createComponent("msg-notification-bubble",Vxt,t),"element"),a=r.componentModel.input;return o._c=n.insert(a,n.text(t.state.commonCounter)),n.mountComponent(r,n.propsSet(r,{slot:"element",class:"common-counter-okmsg","data-tsid":"new_group_chat_common_bubble"})),mDt[0]=1,CDt}function CDt(t,e){mDt[1]|=n.updateText(e._c,t.state.commonCounter),n.updateIncomingSlot(e._a,"",mDt[1])}function kDt(t){return t.state.commonCounter>0?hDt:null}function bDt(t,e,n){e.title=n.store.data.l10n("main-link")}function yDt(t){return t.store.data.l10n("main-link")}function SDt(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._l=n.propsSet(r);bDt(0,i,t),o._m=n.addEvent(r,"click",sDt,t,o);var s=n.insert(a,n.elem("div",lDt),"");n.setClass(s,"icon-wr-okmsg");var u=o._o=n.appendChild(s,n.createComponent("msg-icon",xe,t));n.mountComponent(u,n.propsSet(u,{icon:"home",size:"medium","data-tsid":"msg_home_button"}));var c=n.insert(a,n.elem("div",lDt),"");n.setClass(c,"name-okmsg");var p=o._r=n.appendChild(c,n.createComponent("msg-parsed-text",ii,t)),l=p.componentModel.input;return o._t=n.mountInnerHTML(t,l,yDt),n.mountComponent(p,n.propsSet(p,{disableLinks:!0})),n.mountComponent(r,i),mDt[2]=1,wDt}function wDt(t,e){var o=e._k,r=e._l;bDt(0,r,t),n.updateInnerHTML(e._t),n.updateComponent(o,r)}function EDt(t){return t.store.data.isMobile?null:SDt}function xDt(t){return t.state.chatFilter}function IDt(t,e,o,r){e.title=n.get(r.value,"name"),e.class=n.get(r.value,"selected")?"__active-okmsg":""}function BDt(t,e,n,o){uDt(o.value,t)}function MDt(t,e,o,r){e.url=n.get(r.value,"icon"),e.id=n.get(r.value,"id"),e.caption=n.get(r.value,"name")}function ADt(t,e,o){var r=o._1d=n.insert(e,n.createComponent("msg-notification-bubble",Vxt,t),""),a=r.componentModel.input;return o._1f=n.insert(a,n.text(n.get(o.value,"counter"))),n.mountComponent(r,n.propsSet(r,{"data-tsid":"new_group_chat_bubble"})),mDt[4]=1,TDt}function TDt(t,e){mDt[5]|=n.updateText(e._1f,n.get(e.value,"counter")),n.updateIncomingSlot(e._1d,"",mDt[5])}function jDt(t,e){return n.get(e.value,"counter")>0?ADt:null}function PDt(t,e,o){var r=o._10=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._11=n.propsSet(r);IDt(0,i,0,o),o._12=n.addEvent(r,"click",BDt,t,o);var s=o._13=n.insert(a,n.createComponent("msg-avatar",Hp,t),""),u=o._14=n.propsSet(s,{size:"small"});MDt(0,u,0,o),n.mountComponent(s,u);var c=n.insert(a,n.elem("div",lDt),"");n.setClass(c,"name-okmsg");var p=o._16=n.appendChild(c,n.createComponent("msg-parsed-text",ii,t)),l=p.componentModel.input;return o._18=n.insert(l,n.text(n.get(o.value,"name"))),n.mountComponent(p,n.propsSet(p,{disableLinks:!0})),o._1a=n.mountBlock(t,a,jDt),n.mountComponent(r,i),mDt[2]=1,RDt}function RDt(t,e){var o=e._10,r=e._11,a=e._13,i=e._14;IDt(0,r,0,e),MDt(0,i,0,e),n.updateComponent(a,i),mDt[3]|=n.updateText(e._18,n.get(e.value,"name")),n.updateIncomingSlot(e._16,"",mDt[3]),n.updateBlock(e._1a),n.updateIncomingSlot(o,"",mDt[4]),n.updateComponent(o,r)}function LDt(t,e){var o=t.componentView;_Dt(),gDt(t,e);var r=e._3=n.appendChild(o,n.createComponent("msg-bubble",me,t)),a=r.componentModel.input,i=e._5=n.insert(a,n.createComponent("msg-avatar",Hp,t),"element"),s=e._6=n.propsSet(i,{slot:"element",size:"small"});vDt(0,s,0,e),n.mountComponent(i,s),e._7=n.mountBlock(t,a,kDt);var u=e._f=n.insert(a,n.createComponent("msg-menu",bS,t),"bubble"),c=u.componentModel.input;return e._h=n.mountBlock(t,c,EDt),e._x=n.mountIterator(t,c,xDt,PDt),n.mountComponent(u,n.propsSet(u,{slot:"bubble",class:"custom-scrollbar-okmsg"})),n.mountComponent(r,n.propsSet(r,{xAxis:"left",yAxis:"bottom",forced:!0})),fDt(),n.subscribeStore(t,["l10n","isMobile"]),ODt}function ODt(t,e){var o=e._5,r=e._6;_Dt(),gDt(t,e),vDt(0,r,0,e),n.updateComponent(o,r),n.updateBlock(e._7),n.updateBlock(e._h),n.updateIterator(e._x),n.updateIncomingSlot(e._f,"",mDt[2]),n.updateIncomingSlot(e._3,"element",mDt[0]),fDt()}hDt.dispose=function(t){t._a=n.unmountComponent(t._a),t._c=null,mDt[0]=1},SDt.dispose=function(t){t._m=n.removeEvent("click",t._m),t._o=n.unmountComponent(t._o),t._t=n.unmountInnerHTML(t._t),t._r=n.unmountComponent(t._r),t._k=n.unmountComponent(t._k),t._l=null,mDt[2]=1},ADt.dispose=function(t){t._1d=n.unmountComponent(t._1d),t._1f=null,mDt[4]=1},PDt.dispose=function(t){t._12=n.removeEvent("click",t._12),t._13=n.unmountComponent(t._13),t._16=n.unmountComponent(t._16),t._1a=n.unmountBlock(t._1a),t._10=n.unmountComponent(t._10),t._11=t._14=t._18=null,mDt[2]=1},LDt.dispose=function(t){_Dt(),t._5=n.unmountComponent(t._5),t._7=n.unmountBlock(t._7),t._h=n.unmountBlock(t._h),t._x=n.unmountIterator(t._x),t._f=n.unmountComponent(t._f),t._3=n.unmountComponent(t._3),fDt()};var zDt={__proto__:null,cssScope:lDt,default:LDt,goTo:Qp,didChange:function(t,e){var o,r,a=e.moderatedGroups,i=e.counters,s=e.unreadStats,u=e.groupIdFilter,c=!1;if(a&&a.current){var p=null===(o=t.state.chatFilter)||void 0===o?void 0:o.find((function(t){return t.selected})),l=p&&!p.currentUser;(_=a.current.map((function(t){return cDt(t.id,It(t),t.name,l&&t.id===p.id)}))).unshift(function(t,e){void 0===e&&(e=!1);var n=t.store.get().auth.profile;return cDt(n.id,It(n),n.name,e,!0)}(t,!l)),t.setState({chatFilter:_})}if(s&&s.current){var m=rDt(s.current);Hw(m,t.state.personalCounter,!0)||(c=!0,t.setState({personalCounter:m}))}if(i&&i.current&&(c=!0),c){var d=function(t,e){var n=t||0;return e.forEach((function(t){return n+=t})),n}(null===(r=t.state.personalCounter)||void 0===r?void 0:r.conv,t.props.counters),_=function(t){var e=t.state,o=e.chatFilter,r=e.personalCounter,a=t.props.counters;return(o||[]).map((function(t){return n.__assign(n.__assign({},t),{counter:pDt(t,null==r?void 0:r.conv,a)})}))}(t);t.setState({commonCounter:d,chatFilter:_})}if(u){var f=u.current;f?t.store.app.chat.fetchGroupChats(f):t.store.app.chat.stopGroupChats();_=t.state.chatFilter.map((function(t){return n.__assign(n.__assign({},t),{selected:(e=t,o=f,e.currentUser?null==o:o===e.id)});var e,o}));t.setState({chatFilter:_})}},onSelectHome:sDt,onSelectFilter:uDt};var DDt=["NONE","UNREAD","UNANSWERED","IMPORTANT"].map((function(t){return{id:e=t,label:"chats-filter-".concat(e)};var e}));function UDt(t,e){t!==e.props.selected&&Zt(e,"filter-chat-importance",{id:t}),e.state.hover.exit()}var NDt="ee0se6j",qDt=[0],HDt=[];function FDt(){HDt.push(qDt),qDt=[0]}function VDt(){qDt=HDt.pop()}function KDt(t,e){n.call(t.state.hover,"enter")}function WDt(t,e){n.call(t.state.hover,"exit")}function GDt(t,e,n){e.key="chats-filter-"+n.props.selected}function YDt(t,e){n.call(t.state.hover,"enter")}function XDt(t,e){n.call(t.state.hover,"exit")}function QDt(t){return t.state.menu}function JDt(t,e,o,r){UDt(n.get(r.value,"id"),t)}function $Dt(t,e,o,r){e.key=n.get(r.value,"label")}function ZDt(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input;o._k=n.addEvent(r,"click",JDt,t,o);var i=o._l=n.insert(a,n.createComponent("msg-l10n",ae,t),""),s=o._m=n.propsSet(i);return $Dt(0,s,0,o),n.mountComponent(i,s),n.mountComponent(r),qDt[0]=1,tUt}function tUt(t,e){var o=e._l,r=e._m;$Dt(0,r,0,e),n.updateComponent(o,r)}function eUt(t,e){n.updateIterator(e._g),n.updateIncomingSlot(e._d,"",qDt[0])}function nUt(t,e,o){return o._d?eUt(0,o):function(t,e,o){var r=o._d=n.insert(e,n.createComponent("msg-menu",bS,t)),a=r.componentModel.input;o._e=n.addEvent(r,"mouseenter",YDt,t,o),o._f=n.addEvent(r,"mouseleave",XDt,t,o),o._g=n.mountIterator(t,a,QDt,ZDt),n.mountComponent(r)}(t,e,o),n.animate(o._d,n.createAnimation("global:msg-pop-in .25s cubic-bezier(.4, 0, .3, 1.2)",NDt)),oUt}function oUt(t,e){eUt(0,e)}function rUt(t){return t.state.menuActive?nUt:null}function aUt(t,e){var o=t.componentView;FDt();var r=n.createInjector(o),a=e._1=n.insert(r,n.createComponent("msg-tico",rc,t)),i=a.componentModel.input;e._3=n.addEvent(a,"click",KDt,t,e),e._4=n.addEvent(a,"mouseleave",WDt,t,e);var s=e._5=n.insert(i,n.createComponent("msg-l10n",ae,t),""),u=e._6=n.propsSet(s);return GDt(0,u,t),n.mountComponent(s,u),n.mountComponent(a,n.propsSet(a,{icon:"arrow-down",size:"small",position:"right",class:"button-okmsg"})),e._8=n.mountBlock(t,r,rUt),VDt(),iUt}function iUt(t,e){var o=e._5,r=e._6;FDt(),GDt(0,r,t),n.updateComponent(o,r),n.updateBlock(e._8),VDt()}ZDt.dispose=function(t){t._k=n.removeEvent("click",t._k),t._l=n.unmountComponent(t._l),t._j=n.unmountComponent(t._j),t._m=null,qDt[0]=1},nUt.dispose=function(t,e){n.animate(t._d,n.createAnimation("global:msg-pop-out .15s ease-out",NDt),(function(){return function(t){var e=t._d;t._e=n.removeEvent("mouseenter",t._e),t._f=n.removeEvent("mouseleave",t._f),t._g=n.unmountIterator(t._g),t._d=n.unmountComponent(e),n.domRemove(e)}(t)}))},aUt.dispose=function(t){FDt(),t._3=n.removeEvent("click",t._3),t._4=n.removeEvent("mouseleave",t._4),t._5=n.unmountComponent(t._5),t._1=n.unmountComponent(t._1),t._8=n.clearBlock(t._8),VDt()};var sUt={__proto__:null,cssScope:NDt,default:aUt,props:function(){return{selected:"NONE"}},state:function(t){return{menuActive:!1,menu:DDt,hover:US(t,(function(){return t.setState({menuActive:!0})}),(function(){return t.setState({menuActive:!1})}),300)}},onItemClick:UDt},uUt={keydown:function(t,e){e.shiftKey&&(e.ctrlKey||e.metaKey)&&e.keyCode===xS.F&&(e.preventDefault(),t.focusSearchInput())},"filter-chat-importance":function(t,e){var n;t.setState({groupChatsFilter:null===(n=e.detail)||void 0===n?void 0:n.id})},"scroll-list-to-top":function(t){var e=_Ut(t);e&&e.scrollToItemAtIndex&&e.scrollToItemAtIndex(0)}};function cUt(t,e,n){Zt(t,"chat-search",{query:n.value})}function pUt(t,e){if(e.keyCode===xS.UP)e.preventDefault(),dUt(t,-1);else if(e.keyCode===xS.DOWN)e.preventDefault(),dUt(t,1);else if(e.keyCode===xS.ENTER)!function(t){var e=_Ut(t);e&&"function"==typeof e.selectActiveItem&&e.selectActiveItem()}(t);else if(e.keyCode===xS.ESC){var n=t.refs.input;(null==n?void 0:n.value)&&(n.clear(),e.preventDefault(),e.stopPropagation())}}function lUt(t,e){var n="enter"===e.type||"esc"===e.type||"click"===e.type;t.setState({plusMenuOpened:n?2:1})}function mUt(t){t.setState({plusMenuOpened:0})}function dUt(t,e){var n=_Ut(t);n&&"function"==typeof n.activateNext&&n.activateNext(e)}function _Ut(t){return t.refs.searchList||t.refs.chatList}function fUt(t){return t.names[0].name||""}function gUt(t){return t.title||t.placeholder||V("empty-chat-placeholder")||""}function vUt(t){return t.own&&!t.current}function hUt(t){Zt(t,"open-video-call-layer",{isVideo:!0,createJoinLink:!0,locationParam:"messages_plus_createcall"})}var CUt="e-yrperd",kUt=[0,0],bUt=[];function yUt(){bUt.push(kUt),kUt=[0,0]}function SUt(){kUt=bUt.pop()}function wUt(t,e){e.moderatedGroupsEnabled=n.get(t.store.data.config,"server","moderated-groups")&&Tt(0,n.get(t.store.data.moderatedGroups,"groups"))>0,e.moderatedGroupsSelected=e.moderatedGroupsEnabled&&t.props.groupIdFilter}function EUt(t,e,o){e.class=n.get(o.store.data.search,"query")?"__active-okmsg":""}function xUt(t,e,o){e.moderatedGroups=n.get(o.store.data.moderatedGroups,"groups"),e.counters=n.get(o.store.data.moderatedGroups,"counters"),e.unreadStats=o.store.data.unreadStats,e.groupIdFilter=o.props.groupIdFilter}function IUt(t,e){var o=e._c,r=e._d;xUt(0,r,t),n.updateComponent(o,r)}function BUt(t,e,o){return o._c?IUt(t,o):function(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-groups-filter",zDt,t),""),a=o._d=n.propsSet(r);xUt(0,a,t),n.mountComponent(r,a),kUt[0]=1}(t,e,o),n.animate(o._c,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",CUt)),MUt}function MUt(t,e){IUt(t,e)}function AUt(t,e,n){e.title=n.store.data.l10n("main-link")}function TUt(t,e,n){Qp("/",t)}function jUt(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-icon",xe,t),""),a=o._h=n.propsSet(r,{icon:"home",size:"medium","data-tsid":"msg_settings_button"});return AUt(0,a,t),o._i=n.addEvent(r,"click",TUt,t,o),n.mountComponent(r,a),kUt[0]=1,PUt}function PUt(t,e){var o=e._g,r=e._h;AUt(0,r,t),n.updateComponent(o,r)}function RUt(t,e){return e.moderatedGroupsEnabled?BUt:t.store.data.isMobile?null:jUt}function LUt(t,e,n){e.selected=n.state.groupChatsFilter}function OUt(t,e,o){var r=o._n=n.insert(e,n.createComponent("msg-chat-importance-filter",sUt,t),""),a=o._o=n.propsSet(r);return LUt(0,a,t),n.mountComponent(r,a),kUt[0]=1,zUt}function zUt(t,e){var o=e._n,r=e._o;LUt(0,r,t),n.updateComponent(o,r)}function DUt(t,e,o){e.value=n.get(o.store.data.search,"query"),e.loading="loading"==n.get(o.store.data.search,"loadState")}function UUt(t){Zt(t,"chat-search-touch")}function NUt(t){Zt(t,"chat-search-blur")}function qUt(t,e,n){e.preventDefault(),mUt(t)}function HUt(t,e,n){Qp("/:new-chat",t)}function FUt(t,e,o){!o._1e&&function(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-menu",bS,t)),a=r.componentModel.input;o._1g=n.mountUse(t,r,Yw),o._1h=n.addEvent(r,"mouseenter",lUt,t,o),o._1i=n.addEvent(r,"mouseleave",mUt,t,o),o._1j=n.addEvent(r,"esc",qUt,t,o),o._1k=n.addEvent(r,"enter",mUt,t,o);var i=o._1l=n.insert(a,n.createComponent("msg-menu-item",ES,t),""),s=i.componentModel.input;o._1n=n.addEvent(i,"click",HUt,t,o);var u=o._1o=n.insert(s,n.createComponent("msg-tico",rc,t),""),c=u.componentModel.input,p=o._1q=n.insert(c,n.createComponent("msg-l10n",ae,t),""),l=p.componentModel.input;n.insert(l,n.text("Создать чат")),n.mountComponent(p,n.propsSet(p,{key:"create-chat"})),n.mountComponent(u,n.propsSet(u,{icon:"create-chat",size:"medium"})),n.mountComponent(i,n.propsSet(i,{role:"menuitem","data-tsid":"plus_create_chat"}));var m=o._1w=n.insert(a,n.createComponent("msg-menu-item",ES,t),""),d=m.componentModel.input;o._1y=n.addEvent(m,"click",hUt,t,o);var _=o._1z=n.insert(d,n.createComponent("msg-tico",rc,t),""),f=_.componentModel.input,g=o._21=n.insert(f,n.createComponent("msg-l10n",ae,t),""),v=g.componentModel.input;n.insert(v,n.text("Начать звонок")),n.mountComponent(g,n.propsSet(g,{key:"join.call.plus.button"})),n.mountComponent(_,n.propsSet(_,{icon:"call-add",size:"medium"})),n.mountComponent(m,n.propsSet(m,{role:"menuitem","data-tsid":"plus_create_call"})),n.mountComponent(r,n.propsSet(r,{id:"msg-new-menu",role:"menu"})),kUt[1]=1}(t,e,o),n.animate(o._1e,n.createAnimation("global:msg-pop-in .25s "+(2===t.state.plusMenuOpened?"":".15s")+" cubic-bezier(.4, 0, .3, 1.2)",CUt))}function VUt(t){return t.state.plusMenuOpened?FUt:null}function KUt(t,e,o){var r=o._11=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input;o._13=n.addEvent(r,"mouseenter",lUt,t,o),o._14=n.addEvent(r,"mouseleave",mUt,t,o),o._15=n.addEvent(r,"click",lUt,t,o);var i=o._16=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(i,n.propsSet(i,{icon:"plus",size:"medium"})),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"secondary-okmsg",size:"big","aria-label":"Создать","aria-haspopup":"menu","aria-controls":"msg-new-menu","data-l":"t, createMenu","data-tsid":"open_plus_button"})),o._19=n.mountBlock(t,e,VUt),kUt[1]=1,WUt}function WUt(t,e){n.updateBlock(e._19)}function GUt(t,e,n){e.title=n.store.data.l10n("create-chat",{type:"CHAT"})}function YUt(t,e,n){Qp("/:new-chat",t)}function XUt(t,e,o){var r=o._2a=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._2b=n.propsSet(r,{class:"create-chat-btn-okmsg",shape:"circle","data-l":"t,createChat","data-tsid":"create_chat"});GUt(0,i,t),o._2c=n.addEvent(r,"click",YUt,t,o);var s=o._2d=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"create-chat",size:"large"})),n.mountComponent(r,i),kUt[1]=1,QUt}function QUt(t,e){var o=e._2a,r=e._2b;GUt(0,r,t),n.updateComponent(o,r)}function JUt(t){return t.state.plusMenu?KUt:XUt}function $Ut(t,e,o){var r=o._r=n.insert(e,n.createComponent("msg-search-input",BW,t),"");n.setPendingRef(o._1,"input",r);var a=o._s=n.propsSet(r,{class:"js-chat-search",name:"chat-search",showIcon:!0,"data-l":"t,chatsSearchInput","data-tsid":"conversation_search"});DUt(0,a,t),o._t=n.addEvent(r,"focusin",UUt,t,o),o._u=n.addEvent(r,"focusout",NUt,t,o),o._v=n.addEvent(r,"input",cUt,t,o),o._w=n.addEvent(r,"keydown",pUt,t,o),n.mountComponent(r,a);var i=n.insert(e,n.elem("div",CUt),"controls"),s=n.createInjector(i);return n.setClass(i,"controls-okmsg"),n.setAttribute(i,"slot","controls"),o._y=n.mountBlock(t,s,JUt),kUt[0]=kUt[1]=1,ZUt}function ZUt(t,e){var o=e._r,r=e._s;n.setPendingRef(e._1,"input",o),DUt(0,r,t),n.updateComponent(o,r),n.updateBlock(e._y)}function tNt(t,e){return e.moderatedGroupsSelected?OUt:$Ut}function eNt(t,e,o){!o._2m&&function(t,e,o){var r=o._2m=n.insert(e,n.createComponent("msg-audio-player-pinned",Dbt,t));n.mountComponent(r)}(t,e,o),n.animate(o._2m,$U(o._2m,{duration:300,easing:nN}))}function nNt(t){return t.store.data.isMobile&&n.get(t.store.data.audioPlayer,"message")&&!n.get(t.store.data.audioPlayer,"float")&&!t.store.data.selectedChat?eNt:null}function oNt(t,e,o){e.search=o.state.search,e.chats=o.props.chats,e.loading="loading"==n.get(o.store.data.search,"loadState")}function rNt(t,e,o){var r=n.insert(e,n.elem("div",CUt));n.setClass(r,"search-result-okmsg");var a=n.appendChild(r,n.elemWithText("h4","Результаты поиска",CUt));n.setClass(a,"visually-hidden-okmsg");var i=o._2w=n.appendChild(r,n.createComponent("msg-search-results",Zzt,t));n.setPendingRef(o._1,"searchList",i);var s=o._2x=n.propsSet(i,{class:"custom-scrollbar-okmsg",role:"menu"});return oNt(0,s,t),n.mountComponent(i,s),aNt}function aNt(t,e){var o=e._2w,r=e._2x;n.setPendingRef(e._1,"searchList",o),oNt(0,r,t),n.updateComponent(o,r)}function iNt(t){return n.get(t.store.data.search,"query")?rNt:null}function sNt(t,e,o){e.class="custom-scrollbar-okmsg js-lottie-observer"+(n.get(o.store.data.search,"query")?" hidden-okmsg":""),e.chats=o.props.chats,e.next=o.props.next,e.loading=o.props.loading,e.selected=o.props.selected,e.groupIdFilter=o.props.groupIdFilter,e.groupChatsFilter=o.state.groupChatsFilter,e.congrats=o.store.data.congrats,e.pro=n.get(o.store.data.okWeb,"leftColAdditional")}function uNt(t,e,o){!o._37&&function(t,e,o){var r=o._37=n.insert(e,n.createComponent("msg-audio-player-pinned",Dbt,t));n.mountComponent(r)}(t,e,o),n.animate(o._37,$U(o._37,{duration:300,easing:nN}))}function cNt(t){return t.store.data.isMobile||!n.get(t.store.data.audioPlayer,"message")||n.get(t.store.data.audioPlayer,"float")?null:uNt}function pNt(t,e){var o=t.componentView;yUt();var r=n.createInjector(o),a=e._1=n.obj();wUt(t,e);var i=e._5=n.insert(r,n.createComponent("msg-toolbar",qk,t)),s=i.componentModel.input,u=e._6=n.propsSet(i,{"data-tsid":"conversation_list_top_panel"});EUt(0,u,t),e._7=n.mountBlock(t,s,RUt),e._k=n.mountBlock(t,s,tNt),n.mountComponent(i,u),e._2h=n.mountBlock(t,r,nNt),n.insert(r,n.createSlot(t,"header",CUt)),e._2p=n.mountSlot(t,"header");var c=n.insert(r,n.elem("div",CUt)),p=n.createInjector(c);n.setClass(c,"content-okmsg"),n.setAttribute(c,"data-tsid","conversation_list"),e._2r=n.mountBlock(t,p,iNt);var l=n.insert(p,n.elemWithText("h4","Список чатов",CUt));n.setAttribute(l,"id","msg-chats-list-header"),n.setClass(l,"visually-hidden-okmsg");var m=e._30=n.insert(p,n.createComponent("msg-chats-list",CRt,t));n.setRef(t,"chatList",m);var d=e._31=n.propsSet(m,{"aria-labelledby":"msg-chats-list-header",role:"menu"});return sNt(0,d,t),n.mountComponent(m,d),e._32=n.mountBlock(t,r,cNt),SUt(),n.subscribeStore(t,["config","moderatedGroups","search","unreadStats","l10n","isMobile","audioPlayer","selectedChat","congrats","okWeb"]),n.finalizePendingRefs(t,a),lNt}function lNt(t,e){var o=e._5,r=e._6,a=e._30,i=e._31;yUt(),wUt(t,e),EUt(0,r,t),n.updateBlock(e._7),n.updateBlock(e._k),n.updateIncomingSlot(o,"",kUt[0]),n.updateIncomingSlot(o,"controls",kUt[1]),n.updateComponent(o,r),n.updateBlock(e._2h),n.updateBlock(e._2r),sNt(0,i,t),n.updateComponent(a,i),n.updateBlock(e._32),SUt(),n.finalizePendingRefs(t,e._1)}BUt.dispose=function(t,e){n.animate(t._c,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",CUt),(function(){return function(t){var e=t._c;t._c=n.unmountComponent(e),n.domRemove(e),t._d=null,kUt[0]=1}(t)}))},jUt.dispose=function(t){t._i=n.removeEvent("click",t._i),t._g=n.unmountComponent(t._g),t._h=null,kUt[0]=1},OUt.dispose=function(t){t._n=n.unmountComponent(t._n),t._o=null,kUt[0]=1},FUt.dispose=function(t,e){n.animate(t._1e,n.createAnimation("global:msg-pop-out .15s "+(2===e.state.plusMenuOpened?"":".3s")+" ease-out",CUt),(function(){return function(t){var e=t._1e;t._1g=n.unmountUse(t._1g),t._1h=n.removeEvent("mouseenter",t._1h),t._1i=n.removeEvent("mouseleave",t._1i),t._1j=n.removeEvent("esc",t._1j),t._1k=n.removeEvent("enter",t._1k),t._1n=n.removeEvent("click",t._1n),t._1q=n.unmountComponent(t._1q),t._1o=n.unmountComponent(t._1o),t._1l=n.unmountComponent(t._1l),t._1y=n.removeEvent("click",t._1y),t._21=n.unmountComponent(t._21),t._1z=n.unmountComponent(t._1z),t._1w=n.unmountComponent(t._1w),t._1e=n.unmountComponent(e),n.domRemove(e),kUt[1]=1}(t)}))},KUt.dispose=function(t){t._13=n.removeEvent("mouseenter",t._13),t._14=n.removeEvent("mouseleave",t._14),t._15=n.removeEvent("click",t._15),t._16=n.unmountComponent(t._16),t._11=n.unmountComponent(t._11),t._19=n.unmountBlock(t._19),kUt[1]=1},XUt.dispose=function(t){t._2c=n.removeEvent("click",t._2c),t._2d=n.unmountComponent(t._2d),t._2a=n.unmountComponent(t._2a),t._2b=null,kUt[1]=1},$Ut.dispose=function(t){t._t=n.removeEvent("focusin",t._t),t._u=n.removeEvent("focusout",t._u),t._v=n.removeEvent("input",t._v),t._w=n.removeEvent("keydown",t._w),t._r=n.unmountComponent(t._r),t._y=n.unmountBlock(t._y),t._s=null,kUt[0]=kUt[1]=1},eNt.dispose=function(t,e){var o=t._2m;n.animate(o,ZU(0,{duration:300,easing:nN}),(function(){return function(t){var e=t._2m;t._2m=n.unmountComponent(e),n.domRemove(e)}(t)}))},rNt.dispose=function(t){t._2w=n.unmountComponent(t._2w),t._2x=null},uNt.dispose=function(t,e){var o=t._37;n.animate(o,ZU(0,{duration:300,easing:nN}),(function(){return function(t){var e=t._37;t._37=n.unmountComponent(e),n.domRemove(e)}(t)}))},pNt.dispose=function(t){yUt(),t._7=n.unmountBlock(t._7),t._k=n.unmountBlock(t._k),t._5=n.unmountComponent(t._5),t._2h=n.clearBlock(t._2h),t._2p=n.unmountSlot(t._2p),t._2r=n.unmountBlock(t._2r),t._30=n.unmountComponent(t._30),t._32=n.clearBlock(t._32),SUt()};var mNt={__proto__:null,cssScope:CUt,default:pNt,slideDown:$U,slideUp:ZU,easeOutCubic:nN,goTo:Qp,a11yContextPopup:Yw,events:uUt,extend:{focusSearchInput:function(){var t=this.refs.input;t&&t.focus()}},init:function(t){t.state.query=new w0},willMount:function(t){var e;Zt(t,"leftcol-additional-info");var n=t.store.get(),o=n.config,r=n.isMobile;t.setState({plusMenu:(null===(e=o.server)||void 0===e?void 0:e["plus-menu-enabled"])&&!r})},didChange:function(t,e){var o=e.search;if(o&&o.current){var r=n.__assign({},o.current);t.state.query.update(r.query||"");var a=function(t){var e=t.state.query,n=e.scoringSort(p(t.props.chats),gUt),o=n.sortedList,r=void 0===o?[]:o,a=n.matchList,i=void 0===a?[]:a;return r.sort((function(t,e){var n=t.settings.favIndex||0,o=e.settings.favIndex||0;if(n!==o)return o-n;if("unread"===u){var r=t.id===s?1:t.unreadCount||0,a=e.id===s?1:e.unreadCount||0;if(r>0&&0===a)return-1;if(a>0&&0===r)return 1}return Vjt(e,c)-Vjt(t,c)})).map((function(t){return{chatId:t.id,chat:t,highlights:i,section:"CHATS"}}));var s,u,c}(t),s=function(t){var e=t.store.get().contacts,n=p(e).filter(vUt),o=t.state.query,r=o.scoringSort(n,fUt),a=r.sortedList,i=void 0===a?[]:a,s=r.matchList,u=void 0===s?[]:s;return i.map((function(e){var n=t.store.app.chat.getDialogStub(e.id);return{chat:n,chatId:n.id,highlights:u,section:"CHATS"}}))}(t),u=new i,c=[];a.forEach((function(t){return u.add(t.chatId)})),r.result&&r.result.forEach((function(t){"CHATS"!==t.section?c.push(t):!u.has(t.chatId)&&t.chat&&(u.add(t.chatId),a.push(t))})),s.forEach((function(t){u.has(t.chatId)||a.push(t)})),(a.length||c.length)&&(r=n.__assign(n.__assign({},r),{result:a.concat(c)})),t.setState({search:r})}},onChatSearch:cUt,onChatSearchKeydown:pUt,onRetainMenu:lUt,onReleaseMenu:mUt,onCreateEmptyCall:hUt};function dNt(t){Zt(t,"log-action",{name:"ONBOARDING_PROMO_OPEN",value:2}),Jn(t,t.props.url)}var _Nt="equ52rf";function fNt(t,e){var o=n.insert(e,n.elem("div",_Nt));n.setClass(o,"msg-holiday_left-okmsg")}function gNt(t){return n.get(t.props.theme,"left")?fNt:null}function vNt(t,e){var o=n.insert(e,n.elem("div",_Nt));n.setClass(o,"msg-holiday_right-okmsg")}function hNt(t){return n.get(t.props.theme,"right")?vNt:null}function CNt(t,e,n){e.sticker=n.props.sticker}function kNt(t,e,o){e["data-price"]=n.get(o.props.sticker,"price")}function bNt(t,e){var o=t.componentView,r=n.createInjector(o),a=n.insert(r,n.elem("div",_Nt));n.setClass(a,"msg-holiday_bg-okmsg"),e._2=n.mountBlock(t,r,gNt),e._7=n.mountBlock(t,r,hNt);var i=n.insert(r,n.elem("div",_Nt));n.setClass(i,"msg-holiday_content-okmsg");var s=e._c=n.appendChild(i,n.createComponent("msg-sticker",Uu,t)),u=e._d=n.propsSet(s,{size:"promo",loop:!0,autoplay:!0});CNt(0,u,t),e._e=n.addEvent(s,"click",dNt,t,e),n.mountComponent(s,u);var c=n.appendChild(i,n.elem("div",_Nt));n.setClass(c,"msg-holiday_text-okmsg");var p=n.appendChild(c,n.elem("h2",_Nt));n.setClass(p,"msg-holiday_title-okmsg"),e._h=n.appendChild(p,n.text(n.get(t.props.theme,"titleText")));var l=e._i=n.appendChild(c,n.createComponent("msg-button",fe,t)),m=l.componentModel.input;e._k=n.addEvent(l,"click",dNt,t,e);var d=e._l=n.insert(m,n.createComponent("msg-l10n",ae,t),""),_=e._m=n.propsSet(d,{key:"buy-for"});return kNt(0,_,t),n.mountComponent(d,_),n.mountComponent(l,n.propsSet(l,{class:"primary-okmsg",shape:"square"})),yNt}function yNt(t,e){var o=e._c,r=e._d,a=e._l,i=e._m;n.updateBlock(e._2),n.updateBlock(e._7),CNt(0,r,t),n.updateComponent(o,r),n.updateText(e._h,n.get(t.props.theme,"titleText")),kNt(0,i,t),n.updateComponent(a,i)}bNt.dispose=function(t){t._2=n.clearBlock(t._2),t._7=n.clearBlock(t._7),t._e=n.removeEvent("click",t._e),t._c=n.unmountComponent(t._c),t._k=n.removeEvent("click",t._k),t._l=n.unmountComponent(t._l),t._i=n.unmountComponent(t._i)};var SNt={__proto__:null,cssScope:_Nt,default:bNt,props:function(){return{theme:{left:"",right:"",bg:"",bgColor:"#f6f6f6",header:"#666",button:"#e47d08",sticker:null,customCss:""},sticker:{},url:""}},onOpenLayer:dNt,didMount:function(t){var e=t.props.theme;if(e){var n=document.createElement("style");n.innerHTML="\n            .msg-holiday_bg {background-image: url("+(e.bg||"")+");}\n            .msg-holiday_left {background-image: url("+(e.left||"")+");}\n            .msg-holiday_right {background-image: url("+(e.right||"")+");}\n            .msg-holiday_title {color: "+e.header+"}\n            .msg-holiday_text msg-button {background-color: "+e.button+"}\n            .msg-holiday_text msg-button:hover {box-shadow: 0 0 0 1px "+e.button+"}\n            "+(e.customCss||""),t.appendChild(n)}}};function wNt(t,e,n){Jn(t,n.getAttribute("href"))}function ENt(t){var e=location.origin||"".concat(location.protocol,"//").concat(location.host),n=t.store.get().auth.profile.id;mO("".concat(e,"/profile/").concat(n)),L(t,"toast").show(V("link-copied"))}var xNt="equor7v";function INt(t,e){e.vkUrl=n.get(t.props.info,"vk","url")||"https://oauth.vk.com/authorize?client_id=5456066&display=popup&scope=friends&response_type=code&v=5.60&redirect_uri=https://ok.ru/web-api/socialAuth",e.vkPopupurl=n.get(t.props.info,"vk","popupurl")||"/friends?st.cmd=userFriend&cmd=PopLayer&st.layer.cmd=SocialFriendshipRequest",e.vkType=n.get(t.props.info,"vk","type")||"friends"}function BNt(t){return t.store.data.l10n("add-friend")}function MNt(t,e,n){e.preventDefault(),wNt(t,0,n)}function ANt(t){return t.store.data.l10n("add-friend-search-h")}function TNt(t){return t.store.data.l10n("add-friend-search-p")}function jNt(t){return t.store.data.l10n("add-friend-search-button")}function PNt(t,e,o,r){n.updateAttribute(t,e,"data-url",r.vkUrl),n.updateAttribute(t,e,"data-popupurl",r.vkPopupurl),n.updateAttribute(t,e,"data-type",r.vkType)}function RNt(t){return t.store.data.l10n("add-friend-vk-h")}function LNt(t){return t.store.data.l10n("add-friend-vk-p")}function ONt(t){return t.store.data.l10n("add-friend-vk-button")}function zNt(t){return t.store.data.l10n("add-friend-link-h")}function DNt(t){return t.store.data.l10n("add-friend-link-p")}function UNt(t){return t.store.data.l10n("add-friend-link-copy")}function NNt(t,e){var o=t.componentView;INt(t,e);var r=n.appendChild(o,n.elem("h2",xNt)),a=n.createInjector(r);e._6=n.mountInnerHTML(t,a,BNt);var i=n.appendChild(o,n.elem("div",xNt));n.setClass(i,"items-okmsg");var s=n.appendChild(i,n.elem("a",xNt));n.setAttribute(s,"href","/search?st.mode=Users"),n.setClass(s,"item-okmsg __search-okmsg"),n.setAttribute(s,"data-l","t,search"),e._a=n.addEvent(s,"click",MNt,t,e);var u=e._b=n.appendChild(s,n.createComponent("msg-icon",xe,t));n.mountComponent(u,n.propsSet(u,{icon:"search"}));var c=n.appendChild(s,n.elem("h5",xNt)),p=n.createInjector(c);e._e=n.mountInnerHTML(t,p,ANt);var l=n.appendChild(s,n.elem("p",xNt)),m=n.createInjector(l);e._h=n.mountInnerHTML(t,m,TNt);var d=n.appendChild(s,n.elem("div",xNt));n.setClass(d,"item_bottom-okmsg");var _=e._k=n.appendChild(d,n.createComponent("msg-button",fe,t)),f=_.componentModel.input;e._m=n.mountInnerHTML(t,f,jNt),n.mountComponent(_,n.propsSet(_,{class:"primary-okmsg"}));var g=e._o=n.appendChild(i,n.elem("div",xNt));n.setRef(t,"socialSearchHook",g);var v=e._p=n.obj();n.setClass(g,"item-okmsg __vk-okmsg h-mod-okmsg"),n.setAttribute(g,"data-module","SocialSearch"),n.setAttribute(g,"data-l","t,vk"),PNt(g,v,0,e);var h=e._q=n.appendChild(g,n.createComponent("msg-icon",xe,t));n.mountComponent(h,n.propsSet(h,{icon:"vk"}));var C=n.appendChild(g,n.elem("h5",xNt)),k=n.createInjector(C);e._t=n.mountInnerHTML(t,k,RNt);var b=n.appendChild(g,n.elem("p",xNt)),y=n.createInjector(b);e._w=n.mountInnerHTML(t,y,LNt);var S=n.appendChild(g,n.elem("div",xNt));n.setClass(S,"item_bottom-okmsg");var w=e._z=n.appendChild(S,n.createComponent("msg-button",fe,t)),E=w.componentModel.input;e._11=n.mountInnerHTML(t,E,ONt),n.mountComponent(w,n.propsSet(w,{class:"primary-okmsg"}));var x=n.appendChild(o,n.elem("div",xNt));n.setClass(x,"item-okmsg __hor-okmsg"),n.setAttribute(x,"data-l","t,copy"),e._14=n.addEvent(x,"click",ENt,t,e);var I=e._15=n.appendChild(x,n.createComponent("msg-icon",xe,t));n.mountComponent(I,n.propsSet(I,{icon:"media-share_24",size:"medium",class:"dec-okmsg"}));var B=n.appendChild(x,n.elem("h5",xNt)),M=n.createInjector(B);e._18=n.mountInnerHTML(t,M,zNt);var A=n.appendChild(x,n.elem("p",xNt)),T=n.createInjector(A);e._1b=n.mountInnerHTML(t,T,DNt);var j=e._1d=n.appendChild(x,n.createComponent("msg-tico",rc,t)),P=j.componentModel.input;return e._1f=n.mountInnerHTML(t,P,UNt),n.mountComponent(j,n.propsSet(j,{position:"right",icon:"copy",class:"copy-link-okmsg"})),n.subscribeStore(t,["l10n"]),qNt}function qNt(t,e){INt(t,e),n.updateInnerHTML(e._6),n.updateInnerHTML(e._e),n.updateInnerHTML(e._h),n.updateInnerHTML(e._m),PNt(e._o,e._p,0,e),n.updateInnerHTML(e._t),n.updateInnerHTML(e._w),n.updateInnerHTML(e._11),n.updateInnerHTML(e._18),n.updateInnerHTML(e._1b),n.updateInnerHTML(e._1f)}NNt.dispose=function(t){t._6=n.unmountInnerHTML(t._6),t._a=n.removeEvent("click",t._a),t._b=n.unmountComponent(t._b),t._e=n.unmountInnerHTML(t._e),t._h=n.unmountInnerHTML(t._h),t._m=n.unmountInnerHTML(t._m),t._k=n.unmountComponent(t._k),t._q=n.unmountComponent(t._q),t._t=n.unmountInnerHTML(t._t),t._w=n.unmountInnerHTML(t._w),t._11=n.unmountInnerHTML(t._11),t._z=n.unmountComponent(t._z),t._14=n.removeEvent("click",t._14),t._15=n.unmountComponent(t._15),t._18=n.unmountInnerHTML(t._18),t._1b=n.unmountInnerHTML(t._1b),t._1f=n.unmountInnerHTML(t._1f),t._1d=n.unmountComponent(t._1d)};var HNt={__proto__:null,cssScope:xNt,default:NNt,didMount:function(e){Zt(e,"log-screen","add-friend"),new Promise((function(e,n){t(["OK/SocialSearch"],e,n)})).then((function(t){null!==e.social&&(e.social=t,e.social.activate(e.refs.socialSearchHook))}))},willUnmount:function(t){t.social&&t.social.deactivate(),t.social=null},navigate:wNt,copyLink:ENt},FNt=!1;function VNt(t,e){Zp(t,{useBack:!0}),Zt(e,"log-action","ACTION_ONBOARDING_CONTACT_CLICKED")}function KNt(t,e){Zt(e,"log-action",{name:"ACTION_CALL_UI_CLICK",value:"PROFILE_AUDIO"}),Zt(e,"open-video-call-layer",{friendId:t,isVideo:!1})}function WNt(t,e){Zt(e,"open-video-call-layer",{isVideo:!0,createJoinLink:!0,locationParam:t})}function GNt(){return document.getElementById("messaging-settings-button")}function YNt(t,e){var n=L(e,"chat");n.isParticipant(t)?$p(t.id,{useBack:!0}):n.join(Wn(t.link)).then((function(){$p(t.id,{useBack:!0})}))}var XNt="ehf6rvx",QNt=[0,0,0,0],JNt=[];function $Nt(){JNt.push(QNt),QNt=[0,0,0,0]}function ZNt(){QNt=JNt.pop()}function tqt(t,e){e.additional=n.get(t.store.data.okWeb,"onboardingAdditional"),e.holidays=n.get(e.additional,"promptedUsers"),e.contacts=n.get(e.additional,"friends"),e.chatsPro=n.get(e.additional,"chatsPro"),e.hasContacts=n.get(e.contacts,"length")>0,e.promo=e.additional&&n.get(e.additional,"massSend"),e.needAddFriend=n.get(t.store.data.config,"server","add-friend")&&n.get(e.additional,"requested")&&!e.hasContacts,e.hasPromo=e.promo&&n.get(Object.keys(e.promo),"length")>0&&!e.needAddFriend,e.joinCallProStat=n.get(e.additional,"joincall")&&n.get(e.additional,"joincall","statPlaceMessagesOnboarding")&&!e.needAddFriend,e.showSettingsButton=!(n.get(t.store.data.config,"server","hide-settings-button")&&t.state.portalButtonExists)}function eqt(t,e,n){e.title=n.store.data.l10n("settings")}function nqt(t){Zt(t,"settings-enter")}function oqt(t,e,o){var r=o._f=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._g=n.propsSet(r,{shape:"circle",class:"settings-okmsg","data-l":"t,showSettings"});eqt(0,i,t),o._h=n.addEvent(r,"click",nqt,t,o);var s=o._i=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"settings"})),n.mountComponent(r,i),rqt}function rqt(t,e){var o=e._f,r=e._g;eqt(0,r,t),n.updateComponent(o,r)}function aqt(t,e){return e.showSettingsButton?oqt:null}function iqt(t,e,o,r){e.sticker=n.get(r.promo,"sticker"),e.theme=n.get(r.promo,"theme"),e.url=n.get(r.promo,"url")}function sqt(t,e,o){var r=o._t=n.insert(e,n.createComponent("msg-holiday",SNt,t),""),a=o._u=n.propsSet(r,{"data-l":"t,holiday"});return iqt(0,a,0,o),n.mountComponent(r,a),QNt[0]=1,uqt}function uqt(t,e){var o=e._t,r=e._u;iqt(0,r,0,e),n.updateComponent(o,r)}function cqt(t,e){return e.hasPromo?sqt:null}function pqt(t,e,n,o){WNt(o.joinCallProStat,t)}function lqt(t,e,o){var r=n.insert(e,n.elem("div",XNt),"");n.setClass(r,"join-call-pro-okmsg");var a=n.appendChild(r,n.elem("h1",XNt));n.setClass(a,"h1-okmsg");var i=o._11=n.appendChild(a,n.createComponent("msg-l10n",ae,t)),s=i.componentModel.input;n.insert(s,n.text("Вас пригласили в звонок")),n.mountComponent(i,n.propsSet(i,{key:"join.call.pro.header"}));var u=n.appendChild(r,n.elem("p",XNt));n.setClass(u,"join-call-pro_text-okmsg");var c=o._16=n.appendChild(u,n.createComponent("msg-l10n",ae,t)),p=c.componentModel.input;n.insert(p,n.text("Звоните друзьям в ОК и за пределами социальной сети – выберите друга, групповой чат или пригласите звонок по ссылке!")),n.mountComponent(c,n.propsSet(c,{key:"join.call.pro.text"}));var l=o._1a=n.appendChild(r,n.createComponent("msg-button",fe,t)),m=l.componentModel.input;o._1c=n.addEvent(l,"click",pqt,t,o);var d=o._1d=n.insert(m,n.createComponent("msg-l10n",ae,t),""),_=d.componentModel.input;n.insert(_,n.text("Начать звонок")),n.mountComponent(d,n.propsSet(d,{key:"join.call.pro.button","data-l":"t,join-call"})),n.mountComponent(l,n.propsSet(l,{class:"primary-okmsg",size:"small"})),QNt[0]=1}function mqt(t,e){return e.joinCallProStat&&!e.hasPromo?lqt:null}function dqt(t,e){return e.contacts}function _qt(t,e){e.event=n.get(e.holidays,n.get(e.value,"id")),e.text=n.get(e.event,"holiday"),e.isBday=void 0!==n.get(e.event,"holidayId")&&!n.get(e.event,"holidayId")}function fqt(t,e,o,r){VNt(n.get(r.value,"id"),t)}function gqt(t,e,n,o){e.user=o.value}function vqt(t,e,o,r){VNt(n.get(r.value,"id"),t)}function hqt(t,e,n,o){e.icon=o.isBday?"bday":"holiday",e.title=o.text}function Cqt(t,e,o){var r=o._22=n.insert(e,n.createComponent("msg-tico",rc,t)),a=r.componentModel.input,i=o._23=n.propsSet(r,{class:"holi-okmsg"});return hqt(0,i,0,o),o._24=n.insert(a,n.text(o.text)),n.mountComponent(r,i),QNt[0]=1,kqt}function kqt(t,e){var o=e._22,r=e._23;hqt(0,r,0,e),QNt[2]|=n.updateText(e._24,e.text),n.updateIncomingSlot(o,"",QNt[2]),n.updateComponent(o,r)}function bqt(t,e,n,o){e.user=o.value}function yqt(t,e,o){var r=o._28=n.insert(e,n.createComponent("msg-online-label",ay,t)),a=o._29=n.propsSet(r);return bqt(0,a,0,o),n.mountComponent(r,a),QNt[0]=1,Sqt}function Sqt(t,e){var o=e._28,r=e._29;bqt(0,r,0,e),n.updateComponent(o,r)}function wqt(t,e){return e.text?Cqt:yqt}function Eqt(t,e,n,o){e["data-l"]=o.text?"t,congratulate":"t,write"}function xqt(t,e,o,r){VNt(n.get(r.value,"id"),t)}function Iqt(t,e,n,o){e.key=o.text?"congratulate":"write"}function Bqt(t,e,n){e.title=n.store.data.l10n("call-audio")}function Mqt(t,e,o,r){KNt(n.get(r.value,"id"),t)}function Aqt(t,e,o){_qt(0,o);var r=n.insert(e,n.elem("div",XNt)),a=n.createInjector(r);n.setClass(r,"contacts_i-okmsg"),n.setAttribute(r,"data-l","t,contact"),o._1r=n.addEvent(r,"click",fqt,t,o);var i=o._1s=n.insert(a,n.createComponent("msg-user-card",Nh,t)),s=o._1t=n.propsSet(i,{size:"big",showStatus:!0});gqt(0,s,0,o),n.mountComponent(i,s);var u=o._1u=n.insert(a,n.createComponent("msg-parsed-text",ii,t)),c=u.componentModel.input;o._1w=n.addEvent(u,"click",vqt,t,o),o._1x=n.insert(c,n.text(n.get(o.value,"names",0,"name"))),n.mountComponent(u,n.propsSet(u,{class:"name-okmsg",disableFormatting:!0})),o._1z=n.mountBlock(t,a,wqt);var p=n.insert(a,n.elem("div",XNt));n.setClass(p,"actions-okmsg");var l=o._2c=n.appendChild(p,n.createComponent("msg-button",fe,t)),m=l.componentModel.input,d=o._2d=n.propsSet(l,{class:"secondary-okmsg",size:"small",shape:"square"});Eqt(0,d,0,o),o._2e=n.addEvent(l,"click",xqt,t,o);var _=o._2f=n.insert(m,n.createComponent("msg-l10n",ae,t),""),f=o._2g=n.propsSet(_);Iqt(0,f,0,o),n.mountComponent(_,f),n.mountComponent(l,d);var g=o._2i=n.appendChild(p,n.createComponent("msg-button",fe,t)),v=g.componentModel.input,h=o._2j=n.propsSet(g,{class:"secondary-okmsg",shape:"circle",size:"small","data-l":"t,call"});Bqt(0,h,t),o._2k=n.addEvent(g,"click",Mqt,t,o);var C=o._2l=n.insert(v,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(C,n.propsSet(C,{icon:"audio-call-s"})),n.mountComponent(g,h),QNt[0]=1,Tqt}function Tqt(t,e){var o=e._1s,r=e._1t,a=e._2c,i=e._2d,s=e._2f,u=e._2g,c=e._2i,p=e._2j;_qt(0,e),gqt(0,r,0,e),n.updateComponent(o,r),QNt[1]|=n.updateText(e._1x,n.get(e.value,"names",0,"name")),n.updateIncomingSlot(e._1u,"",QNt[1]),n.updateBlock(e._1z),Eqt(0,i,0,e),Iqt(0,u,0,e),n.updateComponent(s,u),n.updateComponent(a,i),Bqt(0,p,t),n.updateComponent(c,p)}function jqt(t,e){return e.chatsPro}function Pqt(t,e){e.title=n.get(e.value,"title")||n.get(e.value,"placeholder"),e.participantsCount=n.get(e.value,"participantsCount")||0}function Rqt(t,e,n,o){YNt(o.value,t)}function Lqt(t,e,o,r){e.url=Gt(0,r.value,"big"),e.id=n.get(r.value,"id"),e.caption=r.title}function Oqt(t,e,n,o){e["data-count"]=o.participantsCount,e["data-countPlural"]=o.participantsCount}function zqt(t,e,o){Pqt(0,o);var r=n.insert(e,n.elem("div",XNt));n.setClass(r,"contacts_i-okmsg"),n.setAttribute(r,"data-l","t,chat"),o._33=n.addEvent(r,"click",Rqt,t,o);var a=o._34=n.appendChild(r,n.createComponent("msg-avatar",Hp,t)),i=o._35=n.propsSet(a,{size:"big"});Lqt(0,i,0,o),n.mountComponent(a,i);var s=o._36=n.appendChild(r,n.createComponent("msg-parsed-text",ii,t)),u=s.componentModel.input;o._38=n.insert(u,n.text(o.title)),n.mountComponent(s,n.propsSet(s,{class:"name-okmsg",disableFormatting:!0}));var c=n.appendChild(r,n.elem("div",XNt));n.setClass(c,"participants-count-okmsg");var p=o._3b=n.appendChild(c,n.createComponent("msg-l10n",ae,t)),l=o._3c=n.propsSet(p,{key:"participants-count"});Oqt(0,l,0,o),n.mountComponent(p,l);var m=n.appendChild(r,n.elem("div",XNt));n.setClass(m,"actions-okmsg");var d=o._3e=n.appendChild(m,n.createComponent("msg-button",fe,t)),_=d.componentModel.input,f=o._3g=n.insert(_,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(f,n.propsSet(f,{key:"join-chat-confirm-button"})),n.mountComponent(d,n.propsSet(d,{class:"secondary-okmsg",size:"small",shape:"square"})),QNt[0]=1,Dqt}function Dqt(t,e){var o=e._34,r=e._35,a=e._3b,i=e._3c;Pqt(0,e),Lqt(0,r,0,e),n.updateComponent(o,r),QNt[3]|=n.updateText(e._38,e.title),n.updateIncomingSlot(e._36,"",QNt[3]),Oqt(0,i,0,e),n.updateComponent(a,i)}function Uqt(t,e,o){var r=n.insert(e,n.elem("div",XNt),""),a=n.createInjector(r);n.setClass(r,"contacts_list-okmsg __chats-pro-okmsg");var i=n.insert(a,n.elem("h2",XNt));n.setClass(i,"title-okmsg");var s=o._2u=n.appendChild(i,n.createComponent("msg-l10n",ae,t));return n.mountComponent(s,n.propsSet(s,{key:"pro-chats-title"})),o._2w=n.mountIterator(t,a,jqt,zqt),QNt[0]=1,Nqt}function Nqt(t,e){n.updateIterator(e._2w)}function qqt(t,e){return n.get(e.chatsPro,"length")?Uqt:null}function Hqt(t,e,o,r){e.info=n.get(r.additional,"addFriend")}function Fqt(t,e,o){var r=o._3n=n.insert(e,n.createComponent("msg-add-friends",HNt,t),""),a=o._3o=n.propsSet(r,{"data-l":"t,addFriend"});return Hqt(0,a,0,o),n.mountComponent(r,a),QNt[0]=1,Vqt}function Vqt(t,e){var o=e._3n,r=e._3o;Hqt(0,r,0,e),n.updateComponent(o,r)}function Kqt(t,e){return e.needAddFriend?Fqt:null}function Wqt(t,e){var o=t.componentView;$Nt();var r=n.createInjector(o);tqt(t,e),e._c=n.mountBlock(t,r,aqt);var a=e._m=n.insert(r,n.createComponent("msg-info-sheet",Oet,t)),i=a.componentModel.input,s=e._o=n.insert(i,n.createComponent("msg-l10n",ae,t),"title");n.mountComponent(s,n.propsSet(s,{key:"onboarding-title",slot:"title"})),e._q=n.mountBlock(t,i,cqt),e._w=n.mountBlock(t,i,mqt);var u=n.insert(i,n.elem("div",XNt),""),c=n.createInjector(u);return n.setClass(u,"contacts_list-okmsg"),e._1j=n.mountIterator(t,c,dqt,Aqt),e._2p=n.mountBlock(t,i,qqt),e._3k=n.mountBlock(t,i,Kqt),n.mountComponent(a,n.propsSet(a,{toolbar:!0,disableBack:!0,scrollable:!0,"data-l":"t,onboarding"})),ZNt(),n.subscribeStore(t,["okWeb","config","l10n"]),Gqt}function Gqt(t,e){$Nt(),tqt(t,e),n.updateBlock(e._c),n.updateBlock(e._q),n.updateBlock(e._w),n.updateIterator(e._1j),n.updateBlock(e._2p),n.updateBlock(e._3k),n.updateIncomingSlot(e._m,"",QNt[0]),ZNt()}oqt.dispose=function(t){t._h=n.removeEvent("click",t._h),t._i=n.unmountComponent(t._i),t._f=n.unmountComponent(t._f),t._g=null},sqt.dispose=function(t){t._t=n.unmountComponent(t._t),t._u=null,QNt[0]=1},lqt.dispose=function(t){t._11=n.unmountComponent(t._11),t._16=n.unmountComponent(t._16),t._1c=n.removeEvent("click",t._1c),t._1d=n.unmountComponent(t._1d),t._1a=n.unmountComponent(t._1a),QNt[0]=1},Cqt.dispose=function(t){t._22=n.unmountComponent(t._22),t._23=t._24=null,QNt[0]=1},yqt.dispose=function(t){t._28=n.unmountComponent(t._28),t._29=null,QNt[0]=1},Aqt.dispose=function(t){t._1r=n.removeEvent("click",t._1r),t._1s=n.unmountComponent(t._1s),t._1w=n.removeEvent("click",t._1w),t._1u=n.unmountComponent(t._1u),t._1z=n.unmountBlock(t._1z),t._2e=n.removeEvent("click",t._2e),t._2f=n.unmountComponent(t._2f),t._2c=n.unmountComponent(t._2c),t._2k=n.removeEvent("click",t._2k),t._2l=n.unmountComponent(t._2l),t._2i=n.unmountComponent(t._2i),t._1t=t._1x=t._2d=t._2g=t._2j=null,QNt[0]=1},zqt.dispose=function(t){t._33=n.removeEvent("click",t._33),t._34=n.unmountComponent(t._34),t._36=n.unmountComponent(t._36),t._3b=n.unmountComponent(t._3b),t._3g=n.unmountComponent(t._3g),t._3e=n.unmountComponent(t._3e),t._35=t._38=t._3c=null,QNt[0]=1},Uqt.dispose=function(t){t._2u=n.unmountComponent(t._2u),t._2w=n.unmountIterator(t._2w),QNt[0]=1},Fqt.dispose=function(t){t._3n=n.unmountComponent(t._3n),t._3o=null,QNt[0]=1},Wqt.dispose=function(t){$Nt(),t._c=n.clearBlock(t._c),t._o=n.unmountComponent(t._o),t._q=n.unmountBlock(t._q),t._w=n.unmountBlock(t._w),t._1j=n.unmountIterator(t._1j),t._2p=n.unmountBlock(t._2p),t._3k=n.unmountBlock(t._3k),t._m=n.unmountComponent(t._m),ZNt()};var Yqt={__proto__:null,cssScope:XNt,default:Wqt,props:function(){return{model:{}}},state:function(){return{_time:o.logTime("msg-onboarding"),portalButtonExists:GNt()}},willMount:function(t){Zt(t,"log-screen","ONBOARDING"),Zt(t,"onboarding-additional-info")},didRender:function(t){FNt||(Zt(t,"log-external",{type:"scalar",param:"onboarding"}),FNt=!0)},didMount:function(t){t.state._time()},onOpenDialog:VNt,onCallStart:KNt,onCreateEmptyCall:WNt,isPortalButtonExists:GNt,joinChat:YNt};var Xqt="e-ykg3n9";function Qqt(t,e,o){var r=o._4=n.insert(e,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(r,n.propsSet(r,{key:"connecting"}))}function Jqt(t,e,n){e.paused=n.props.paused}function $qt(t,e){var o=t.componentView,r=n.appendChild(o,n.createSlot(t,"",Xqt));n.setClass(r,"text-okmsg"),e._6=n.mountSlot(t,"",Qqt);var a=e._7=n.appendChild(o,n.createComponent("msg-loader",Be,t)),i=e._8=n.propsSet(a);return Jqt(0,i,t),n.mountComponent(a,i),Zqt}function Zqt(t,e){var o=e._7,r=e._8;n.updateDefaultSlot(e._6),Jqt(0,r,t),n.updateComponent(o,r)}Qqt.dispose=function(t){t._4=n.unmountComponent(t._4)},$qt.dispose=function(t){t._6=n.unmountSlot(t._6),t._7=n.unmountComponent(t._7)};var tHt={__proto__:null,cssScope:Xqt,default:$qt,props:function(){return{paused:!1}}};function eHt(t,e){nHt(t,e)}function nHt(t,e){e.preventDefault(),e.stopPropagation(),Zt(t,"close-layer")}var oHt="e-btlw0v";function rHt(t,e,o){var r=n.insert(e,n.elem("div",oHt));n.setClass(r,"buttons-okmsg"),n.appendChild(r,n.createSlot(t,"buttons",oHt)),o._p=n.mountSlot(t,"buttons")}function aHt(t){return t.props.controls?rHt:null}function iHt(t,e,o){var r=n.insert(e,n.elem("div",oHt),"center"),a=n.createInjector(r);n.setClass(r,"center-okmsg");var i=n.insert(a,n.elem("div",oHt));n.setClass(i,"header-okmsg"),n.appendChild(i,n.createSlot(t,"header",oHt)),o._a=n.mountSlot(t,"header");var s=o._b=n.appendChild(i,n.createComponent("msg-button",fe,t)),u=s.componentModel.input;o._d=n.addEvent(s,"click",eHt,t,o);var c=o._e=n.insert(u,n.createComponent("msg-icon",xe,t),"");n.mountComponent(c,n.propsSet(c,{icon:"clear",size:"medium"})),n.mountComponent(s,n.propsSet(s,{class:"close-okmsg",shape:"circle"}));var p=n.insert(a,n.elem("div",oHt));return n.setRef(t,"content",p),n.setClass(p,"inner-okmsg custom-scrollbar-okmsg"),n.appendChild(p,n.createSlot(t,"body",oHt)),o._j=n.mountSlot(t,"body"),o._k=n.mountBlock(t,a,aHt),sHt}function sHt(t,e){n.updateBlock(e._k)}function uHt(t,e,o){var r=n.insert(e,n.elem("div",oHt));n.setClass(r,"close-okmsg"),o._w=n.addEvent(r,"click",eHt,t,o);var a=n.appendChild(r,n.elem("div",oHt));n.setClass(a,"close_ovr-okmsg");var i=o._y=n.appendChild(r,n.createComponent("msg-button",fe,t)),s=i.componentModel.input,u=o._10=n.insert(s,n.createComponent("msg-icon",xe,t),"");n.mountComponent(u,n.propsSet(u,{icon:"clear",size:"medium"})),n.mountComponent(i,n.propsSet(i,{shape:"circle"}))}function cHt(t){return"big"===t.props.size?uHt:null}function pHt(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("div",oHt));n.setClass(r,"overlay-okmsg"),e._2=n.addEvent(r,"click",eHt,t,e);var a=e._3=n.appendChild(o,n.elem("div",oHt)),i=n.createInjector(a);n.setClass(a,"container-okmsg"),n.insert(i,n.createSlot(t,"center",oHt)),e._r=n.mountSlot(t,"center",iHt),e._s=n.mountBlock(t,i,cHt),n.animate(a,n.createAnimation("global:msg-dialog-show 0.25s cubic-bezier(0.2, 0.94, 0.42, 1.25) backwards",oHt));var s=n.appendChild(o,n.elem("div",oHt));return n.setClass(s,"va-okmsg"),lHt}function lHt(t,e){n.updateDefaultSlot(e._r),n.updateBlock(e._s)}rHt.dispose=function(t){t._p=n.unmountSlot(t._p)},iHt.dispose=function(t){t._a=n.unmountSlot(t._a),t._d=n.removeEvent("click",t._d),t._e=n.unmountComponent(t._e),t._b=n.unmountComponent(t._b),t._j=n.unmountSlot(t._j),t._k=n.unmountBlock(t._k)},uHt.dispose=function(t){t._w=n.removeEvent("click",t._w),t._10=n.unmountComponent(t._10),t._y=n.unmountComponent(t._y)},pHt.dispose=function(t){t._2=n.removeEvent("click",t._2),t._r=n.unmountSlot(t._r),t._s=n.unmountBlock(t._s),t._3=n.stopAnimation(t._3)};var mHt={__proto__:null,cssScope:oHt,default:pHt,props:function(){return{controls:!0,size:""}},willMount:function(t){t._shortcuts=OS({ESC:function(e){return nHt(t,e)}})},willUnmount:function(t){t._shortcuts.destroy()},onClose:eHt};function dHt(t){return/^[A-Za-zА-Яа-я0-9]/.test(t)}function _Ht(t,e){if(t.name===e.name)return e.id-t.id;var n=dHt(t.name),o=dHt(e.name);return n&&o||!n&&!o?t.name>e.name?1:-1:n?-1:1}function fHt(t){Zt(t,"close-chat-read-participants")}function gHt(t,e){Zt(e,"view-profile",{userId:t.id,profileUrl:t.profileUrl})}var vHt="ec5r6if",hHt=[0,0],CHt=[];function kHt(){CHt.push(hHt),hHt=[0,0]}function bHt(){hHt=CHt.pop()}function yHt(t,e,n){e["data-count"]=Tt(0,n.state.read)}function SHt(t){return t.props.participants}function wHt(t,e,o,r){e.user=n.get(r.value,"user")}function EHt(t,e,o,r){gHt(n.get(r.value,"user"),t)}function xHt(t,e,o,r){gHt(n.get(r.value,"user"),t)}function IHt(t,e,o){var r=n.insert(e,n.elem("div",vHt));n.setClass(r,"contacts_i-okmsg");var a=o._g=n.appendChild(r,n.createComponent("msg-user-card",Nh,t)),i=o._h=n.propsSet(a,{size:"big",showStatus:!0});wHt(0,i,0,o),o._i=n.addEvent(a,"click",EHt,t,o),n.mountComponent(a,i);var s=o._j=n.appendChild(r,n.createComponent("msg-parsed-text",ii,t)),u=s.componentModel.input;return o._l=n.addEvent(s,"click",xHt,t,o),o._m=n.insert(u,n.text(n.get(o.value,"user","name"))),n.mountComponent(s,n.propsSet(s,{class:"name-okmsg",disableFormatting:!0})),hHt[0]=1,BHt}function BHt(t,e){var o=e._g,r=e._h;wHt(0,r,0,e),n.updateComponent(o,r),hHt[1]|=n.updateText(e._m,n.get(e.value,"user","name")),n.updateIncomingSlot(e._j,"",hHt[1])}function MHt(t,e,o){var r=n.insert(e,n.elem("div",vHt)),a=n.createInjector(r);return n.setClass(r,"contacts-okmsg"),o._c=n.mountIterator(t,a,SHt,IHt),hHt[0]=1,AHt}function AHt(t,e){n.updateIterator(e._c)}function THt(t){return Tt(0,t.state.read)>0?MHt:null}function jHt(t,e){var o=t.componentView;kHt();var r=e._1=n.appendChild(o,n.createComponent("msg-layer",mHt,t)),a=r.componentModel.input;e._3=n.addEvent(r,"close-layer",fHt,t,e);var i=n.insert(a,n.elem("div",vHt),"header");n.setClass(i,"header-okmsg"),n.setAttribute(i,"slot","header");var s=e._5=n.appendChild(i,n.createComponent("msg-l10n",ae,t)),u=e._6=n.propsSet(s,{key:"have-read"});yHt(0,u,t),n.mountComponent(s,u);var c=n.insert(a,n.elem("div",vHt),"body"),p=n.createInjector(c);return n.setAttribute(c,"slot","body"),e._8=n.mountBlock(t,p,THt),n.mountComponent(r,n.propsSet(r,{controls:!1})),bHt(),PHt}function PHt(t,e){var o=e._5,r=e._6;kHt(),yHt(0,r,t),n.updateComponent(o,r),n.updateBlock(e._8),n.updateIncomingSlot(e._1,"body",hHt[0]),bHt()}IHt.dispose=function(t){t._i=n.removeEvent("click",t._i),t._g=n.unmountComponent(t._g),t._l=n.removeEvent("click",t._l),t._j=n.unmountComponent(t._j),t._h=t._m=null,hHt[0]=1},MHt.dispose=function(t){t._c=n.unmountIterator(t._c),hHt[0]=1},jHt.dispose=function(t){kHt(),t._3=n.removeEvent("close-layer",t._3),t._5=n.unmountComponent(t._5),t._8=n.unmountBlock(t._8),t._1=n.unmountComponent(t._1),bHt()};var RHt={__proto__:null,cssScope:vHt,default:jHt,props:function(){return{participants:null,total:null}},didChange:function(t){var e=t.props,n=e.participants,o=e.total,r=new i(n.map((function(t){return t.user.id}))),a=o.map((function(t){return t.user})).filter((function(t){return!r.has(t.id)}));t.setState({read:n.sort((function(t,e){return e.time-t.time})),unread:a.sort(_Ht)})},close:fHt,onOpenProfile:gHt},LHt=10;var OHt={handleScroll:function(t){var e=t.getBoundingClientRect(),n=this.refs.beacon.getBoundingClientRect();this._list.handleScroll(t,t.scrollTop+n.top-e.top),t.scrollHeight-t.scrollTop-t.offsetHeight<100&&UHt(this)}};function zHt(t){Zp(t,{useBack:!0})}function DHt(t,e){e.setState({active:t}),UHt(e),e._list.reset(),NHt(e)}function UHt(t){var e=t.props,n=e.messageId,r=e.chatId,a=e.reactionsDetailed,i=t.state.active,s=i===lB.VIEWS||i===lB.ALL?null:i,u=(null==a?void 0:a.filter)&&a.filter[s||o.FILTER_ALL],c=null==u?void 0:u.inconsistent,p=c||null==u?void 0:u.marker,l=null==u?void 0:u.loadState;if(c||0!==p&&l!==o.LoadState.loading&&!t._loadRequested){var m=function(t,e){var n;return t?((null===(n=null==e?void 0:e.items)||void 0===n?void 0:n.length)||0)+LHt:LHt}(c,u);t._loadRequested=!0,t.store.app.reactions.messageGetDetailedReactions(r,n,s,p,m,c)}}function NHt(t){var e,r=t.state,i=r.active,s=r.read,u=t.props.reactionsDetailed,c=[];if(i===lB.VIEWS){var p=(null==u?void 0:u.byUserIds)||new a;c=s.map((function(t){return n.__assign(n.__assign({},t),{reaction:p.get(t.id)})}))}else{var l=null==u?void 0:u.filter,m=l&&l[i];m&&(c=m.items.map((function(t){return n.__assign(n.__assign({},t.userId),{reaction:t.reaction})})),m.loadState!==o.LoadState.idle||(null===(e=m.items)||void 0===e?void 0:e.length)||i===lB.ALL||DHt(lB.ALL,t))}t._list.update(c)}var qHt="e-xzufrl",HHt=[0,0,0],FHt=[];function VHt(){FHt.push(HHt),HHt=[0,0,0]}function KHt(){HHt=FHt.pop()}function WHt(t,e){e.list=t.state.scrollList,e.loading="loading"===n.get(t.props.reactionsDetailed,"filter",t.state.active,"loadState"),e.value=void 0}function GHt(t){Zt(t,"close-chat-read-participants")}function YHt(t,e,o){n.updateClass(t,e,"tabs_i-okmsg"+("VIEWS"===o.state.active?" __active-okmsg":""))}function XHt(t,e,n){DHt("VIEWS",t)}function QHt(t,e,n){e["data-count"]=Tt(0,n.state.read)}function JHt(t,e,o){var r=o._j=n.insert(e,n.elem("div",qHt)),a=o._k=n.obj();n.setAttribute(r,"data-l","t,tab-VIEW"),YHt(r,a,t),o._l=n.addEvent(r,"click",XHt,t,o);var i=o._m=n.appendChild(r,n.createComponent("msg-l10n",ae,t)),s=o._n=n.propsSet(i,{key:"read-participants"});return QHt(0,s,t),n.mountComponent(i,s),HHt[0]=1,$Ht}function $Ht(t,e){var o=e._m,r=e._n;YHt(e._j,e._k,t),QHt(0,r,t),n.updateComponent(o,r)}function ZHt(t){return t.props.largeChat?null:JHt}function tFt(t){return null==(e=n.get(t.props.reactionsDetailed,"total"))?[]:Array.isArray(e)?e:Mt&&e instanceof a||At&&e instanceof i?Array.from(e.keys()):"object"==typeof e?Object.keys(e):[];var e}function eFt(t,e){e.count=n.get(t.props.reactionsDetailed,"total",e.value)}function nFt(t,e,o,r){n.updateClass(t,e,"tabs_i-okmsg"+(o.state.active===r.value?" __active-okmsg":"")),n.updateAttribute(t,e,"data-l","t,tab-"+r.value)}function oFt(t,e,n,o){DHt(o.value,t)}function rFt(t,e,n,o){e["data-count"]=o.count}function aFt(t,e,o){var r=o._13=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._14=n.propsSet(r,{key:"reacted-participants"});return rFt(0,a,0,o),n.mountComponent(r,a),HHt[0]=1,iFt}function iFt(t,e){var o=e._13,r=e._14;rFt(0,r,0,e),n.updateComponent(o,r)}function sFt(t,e,o){var r=o._17=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._18=n.insert(a,n.text(o.value)),n.insert(a,n.text(" ")),o._1a=n.insert(a,n.text(o.count)),n.mountComponent(r),HHt[0]=1,uFt}function uFt(t,e){HHt[1]|=n.updateText(e._18,e.value),HHt[1]|=n.updateText(e._1a,e.count),n.updateIncomingSlot(e._17,"",HHt[1])}function cFt(t,e){return"ALL"===e.value?aFt:sFt}function pFt(t,e,o){var r=o._x=n.insert(e,n.elem("div",qHt)),a=n.createInjector(r);return nFt(r,o._y=n.obj(),t,o),o._z=n.addEvent(r,"click",oFt,t,o),o._10=n.mountBlock(t,a,cFt),HHt[0]=1,lFt}function lFt(t,e){nFt(e._x,e._y,t,e),n.updateBlock(e._10)}function mFt(t,e){return n.get(t.props.reactionsDetailed,"total",e.value)?pFt:null}function dFt(t,e,o){return eFt(t,o),o._u=n.mountBlock(t,e,mFt),_Ft}function _Ft(t,e){eFt(t,e),n.updateBlock(e._u)}function fFt(t,e,o){var r=n.insert(e,n.elem("div",qHt)),a=n.createInjector(r);return n.setClass(r,"tabs-okmsg"),o._g=n.mountBlock(t,a,ZHt),o._p=n.mountIterator(t,a,tFt,dFt),HHt[0]=1,gFt}function gFt(t,e){n.updateBlock(e._g),n.updateIterator(e._p)}function vFt(t){return t.props.chatId<0?fFt:null}function hFt(t,e,o,r){n.updateAttribute(t,e,"style","height: "+(n.get(r.list,"before")||0)+"px;")}function CFt(t,e){return n.get(e.list,"items")}function kFt(t,e){return n.get(e.value,"value","id")}function bFt(t,e){e.user=n.get(e.value,"value")}function yFt(t,e,n,o){e.user=o.user}function SFt(t,e,o,r){zHt(n.get(r.user,"id"))}function wFt(t,e){n.get(e.user,"id")&&n.setPendingEvent(e._1o,"click",SFt,e)}function EFt(t,e,o){var r=o._1v=n.insert(e,n.createComponent("msg-parsed-text",ii,t)),a=r.componentModel.input;return o._1x=n.insert(a,n.text(n.get(o.user,"reaction"))),n.mountComponent(r,n.propsSet(r,{class:"reaction-okmsg"})),HHt[0]=1,xFt}function xFt(t,e){HHt[2]|=n.updateText(e._1x,n.get(e.user,"reaction")),n.updateIncomingSlot(e._1v,"",HHt[2])}function IFt(t,e){return n.get(e.user,"reaction")?EFt:null}function BFt(t,e,o){bFt(0,o);var r=n.insert(e,n.elem("div",qHt)),a=n.createInjector(r);n.setClass(r,"participant-okmsg");var i=o._1n=n.insert(a,n.createComponent("msg-chat-participants-list-item",grt,t)),s=o._1o=n.pendingEvents(t,i),u=o._1p=n.propsSet(i,{label:!1,"data-tsid":"participant_list_item","data-l":"t,user"});return yFt(0,u,0,o),wFt(0,o),n.finalizePendingEvents(s),n.mountComponent(i,u),o._1s=n.mountBlock(t,a,IFt),HHt[0]=1,MFt}function MFt(t,e){var o=e._1n,r=e._1p;bFt(0,e),yFt(0,r,0,e),wFt(0,e),n.finalizePendingEvents(e._1o),n.updateComponent(o,r),n.updateBlock(e._1s)}function AFt(t,e,o,r){n.updateAttribute(t,e,"style","height: "+(n.get(r.list,"after")||0)+"px; text-align: center")}function TFt(t,e,o){var r=o._26=n.insert(e,n.createComponent("msg-loader",Be,t));n.mountComponent(r,n.propsSet(r,{class:"bottom-okmsg","data-tsid":"reactions_loader"})),HHt[0]=1}function jFt(t,e){return e.loading?TFt:null}function PFt(t,e,o){var r=o._2c=n.insert(e,n.createComponent("msg-l10n",ae,t));n.mountComponent(r,n.propsSet(r,{key:"no-reactions",class:"no-reactions-okmsg"})),HHt[0]=1}function RFt(t,e){return e.loading||n.get(e.list,"items","length")?null:PFt}function LFt(t,e){var o=t.componentView;VHt(),WHt(t,e);var r=e._5=n.appendChild(o,n.createComponent("msg-layer",mHt,t)),a=r.componentModel.input;n.setRef(t,"layer",r),e._7=n.addEvent(r,"close-layer",GHt,t,e);var i=n.insert(a,n.elem("div",qHt),"header");n.setAttribute(i,"slot","header");var s=e._9=n.appendChild(i,n.createComponent("msg-l10n",ae,t));n.mountComponent(s,n.propsSet(s,{key:"read-and-reacted"}));var u=n.insert(a,n.elem("div",qHt),"body"),c=n.createInjector(u);n.setAttribute(u,"slot","body"),e._c=n.mountBlock(t,c,vFt);var p=n.insert(c,n.elem("div",qHt)),l=n.createInjector(p);n.setClass(p,"contacts-okmsg");var m=e._1f=n.insert(l,n.elem("div",qHt));n.setRef(t,"beacon",m);var d=e._1g=n.obj();n.setClass(m,"scroll-beacon-okmsg"),hFt(m,d,0,e),e._1h=n.mountKeyIterator(t,l,CFt,kFt,BFt);var _=e._21=n.insert(l,n.elem("div",qHt)),f=n.createInjector(_);return AFt(_,e._22=n.obj(),0,e),e._23=n.mountBlock(t,f,jFt),e._29=n.mountBlock(t,l,RFt),n.mountComponent(r,n.propsSet(r,{controls:!1})),KHt(),OFt}function OFt(t,e){VHt(),WHt(t,e),n.updateBlock(e._c),hFt(e._1f,e._1g,0,e),n.updateKeyIterator(e._1h),AFt(e._21,e._22,0,e),n.updateBlock(e._23),n.updateBlock(e._29),n.updateIncomingSlot(e._5,"body",HHt[0]),KHt()}JHt.dispose=function(t){t._l=n.removeEvent("click",t._l),t._m=n.unmountComponent(t._m),t._k=t._n=t._j=null,HHt[0]=1},aFt.dispose=function(t){t._13=n.unmountComponent(t._13),t._14=null,HHt[0]=1},sFt.dispose=function(t){t._17=n.unmountComponent(t._17),t._18=t._1a=null,HHt[0]=1},pFt.dispose=function(t){t._z=n.removeEvent("click",t._z),t._10=n.unmountBlock(t._10),t._y=t._x=null,HHt[0]=1},dFt.dispose=function(t){t._u=n.unmountBlock(t._u)},fFt.dispose=function(t){t._g=n.unmountBlock(t._g),t._p=n.unmountIterator(t._p),HHt[0]=1},EFt.dispose=function(t){t._1v=n.unmountComponent(t._1v),t._1x=null,HHt[0]=1},BFt.dispose=function(t){t._1o=n.detachPendingEvents(t._1o),t._1n=n.unmountComponent(t._1n),t._1s=n.unmountBlock(t._1s),t._1p=null,HHt[0]=1},TFt.dispose=function(t){t._26=n.unmountComponent(t._26),HHt[0]=1},PFt.dispose=function(t){t._2c=n.unmountComponent(t._2c),HHt[0]=1},LFt.dispose=function(t){VHt(),t._7=n.removeEvent("close-layer",t._7),t._9=n.unmountComponent(t._9),t._c=n.unmountBlock(t._c),t._1h=n.unmountKeyIterator(t._1h),t._23=n.unmountBlock(t._23),t._29=n.unmountBlock(t._29),t._5=n.unmountComponent(t._5),KHt()};var zFt={__proto__:null,cssScope:qHt,default:LFt,state:function(){return{active:lB.VIEWS,usersMap:new a,read:[]}},extend:OHt,init:function(t){OK.logger.success("messagesLayer","message-participants-opened"),t._list=new YL({itemHeight:40,offscreenArea:100,initialItems:10,onUpdate:function(e){return t.setState({scrollList:e})}})},willRender:function(t){UHt(t)},didMount:function(t){var e=t.refs.layer;if(e){var n=e.refs.content;if(n){var o=function(){return t.handleScroll(n)};return n.addEventListener("scroll",o),function(){return n.removeEventListener("scroll",o)}}}},didChange:function(t,e){var n=e.reactionsDetailed,o=e.participants,r=e.tab;if(r&&t.setState({active:r.current}),o){var i=t.props.message,s=(o.current||[]).reduce((function(t,e){return t.set(e.user.id,e.user),t}),new a),u=(o.current||[]).filter((function(t){return t.time>=i.time})).sort((function(t,e){return e.time-t.time})).map((function(t){return t.user}));t.setState({usersMap:s,read:u}),t._loadRequested=!1,NHt(t)}n&&(t._loadRequested=!1,NHt(t))},onOpenDialog:zHt,onSelectTab:DHt,onScroll:function(t,e){console.log("handle scroll",e)}},DFt={"message-react":function(t,e){if(e.detail){var n=t.props,o=n.chatId,r=n.messageId,a=n.mine;e.detail.active=e.detail.reaction===a,e.detail.chatId=o,e.detail.messageId=r}Zt(t,"close-reactions-layer")}},UFt="e-edyool";function NFt(t,e){e.recent=n.get(t.store.data.assets,"stickerSections","RECENT","emojiList")}function qFt(t){Zt(t,"close-reactions-layer")}function HFt(t,e,n,o){e.recent=o.recent}function FFt(t,e){var o=t.componentView;NFt(t,e);var r=e._3=n.appendChild(o,n.createComponent("msg-layer",mHt,t)),a=r.componentModel.input;e._5=n.addEvent(r,"close-layer",qFt,t,e);var i=n.insert(a,n.elem("div",UFt),"header");n.setAttribute(i,"slot","header");var s=e._7=n.appendChild(i,n.createComponent("msg-l10n",ae,t));n.mountComponent(s,n.propsSet(s,{key:"reactions"}));var u=n.insert(a,n.elem("div",UFt),"body");n.setAttribute(u,"slot","body");var c=e._a=n.appendChild(u,n.createComponent("msg-assets-panel-emoji",fW,t)),p=e._b=n.propsSet(c,{reactions:!0});return HFt(0,p,0,e),n.mountComponent(c,p),n.mountComponent(r,n.propsSet(r,{controls:!1})),n.subscribeStore(t,["assets"]),VFt}function VFt(t,e){var o=e._a,r=e._b;NFt(t,e),HFt(0,r,0,e),n.updateComponent(o,r)}FFt.dispose=function(t){t._5=n.removeEvent("close-layer",t._5),t._7=n.unmountComponent(t._7),t._a=n.unmountComponent(t._a),t._3=n.unmountComponent(t._3)};var KFt={__proto__:null,cssScope:UFt,default:FFt,events:DFt},WFt="e-gfih8e";function GFt(t,e){e.player=t.store.data.audioPlayer,e.msg="FORWARD"===n.get(e.player,"message","link","type")?n.get(e.player,"message","link","message"):n.get(e.player,"message"),e.playingAttach=n.find(n.get(e.msg,"attaches"),(function(t){return"INLINE_KEYBOARD"!==n.get(t,"_type")})),e.chat=n.get(t.store.data.chats,n.get(e.playingAttach,"chatId")),e.isVoiceMessage="AUDIO"===n.get(e.playingAttach,"_type"),e.preview=e.isVoiceMessage?$t(0,n.get(e.msg,"sender","baseUrl")||n.get(e.chat,"fullIconUrl"),440):$t(0,n.get(e.playingAttach,"baseUrl"),440)||n.get(e.playingAttach,"fullImageUrl"),e.title=e.isVoiceMessage?n.get(e.msg,"sender","name"):n.get(e.playingAttach,"preview","title")||n.get(e.playingAttach,"title"),e.subtitle=n.get(e.playingAttach,"preview","artistName")||n.get(e.playingAttach,"artistName")||n.get(e.playingAttach,"name"),e.musicInfo=!e.isVoiceMessage&&e.subtitle,e.loading=n.get(e.player,"loading"),e.paused=n.get(e.player,"paused"),e.progress=t.state.seekPos||n.get(e.player,"progress")||0,e.duration=n.get(e.player,"duration"),e.currentTime=t.state.seekPos?t.state.seekPos*e.duration:n.get(e.player,"currentTime"),e.offsetLeft=100*e.progress}function YFt(t,e,o,r){n.updateAttribute(t,e,"style","background-image: url("+r.preview+")")}function XFt(t,e,o){var r=o._m=n.insert(e,n.elem("div",WFt)),a=o._n=n.obj();return n.setClass(r,"bg-okmsg"),YFt(r,a,0,o),QFt}function QFt(t,e){YFt(e._m,e._n,0,e)}function JFt(t,e){return e.preview?XFt:null}function $Ft(t,e,n){Okt("playbackSpeed",t)}function ZFt(t,e){return n.get(e.player,"playbackSpeed")}function tVt(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;return o._w=n.addEvent(r,"click",$Ft,t,o),o._x=n.mountInnerHTML(t,a,ZFt),n.insert(a,n.text("x\n                ")),n.mountComponent(r,n.propsSet(r,{shape:"circle"})),eVt}function eVt(t,e){n.updateInnerHTML(e._x)}function nVt(t,e){return e.isVoiceMessage?tVt:null}function oVt(t,e,n){Okt("pin",t)}function rVt(t,e,n){Okt("reset",t)}function aVt(t,e,o,r){e.date=n.get(r.msg,"time")}function iVt(t,e,o){var r=o._1t=n.insert(e,n.createComponent("msg-relative-date",Kb,t)),a=o._1u=n.propsSet(r);return aVt(0,a,0,o),n.mountComponent(r,a),sVt}function sVt(t,e){var o=e._1t,r=e._1u;aVt(0,r,0,e),n.updateComponent(o,r)}function uVt(t,e){return e.isVoiceMessage?iVt:null}function cVt(t,e,o){return o._1z=n.insert(e,n.text(o.subtitle)),pVt}function pVt(t,e){n.updateText(e._1z,e.subtitle)}function lVt(t,e){return e.musicInfo?cVt:null}function mVt(t,e,o){var r=n.insert(e,n.elem("div",WFt)),a=n.createInjector(r);return n.setClass(r,"subtitle-okmsg"),o._1q=n.mountBlock(t,a,uVt),o._1w=n.mountBlock(t,a,lVt),dVt}function dVt(t,e){n.updateBlock(e._1q),n.updateBlock(e._1w)}function _Vt(t,e){return e.isVoiceMessage||e.musicInfo?mVt:null}function fVt(t,e,n){Okt("prev",t)}function gVt(t,e){t.state.dragging||n.setPendingEvent(e._25,"mouseup",fVt,e)}function vVt(t,e,o){var r=n.insert(e,n.elem("div",WFt)),a=o._25=n.pendingEvents(t,r);return n.setClass(r,"fake-okmsg __prev-okmsg"),gVt(t,o),n.finalizePendingEvents(a),hVt}function hVt(t,e){gVt(t,e),n.finalizePendingEvents(e._25)}function CVt(t){return n.get(t.store.data.audioPlayer,"hasPrev")?vVt:null}function kVt(t,e,n){Okt("toggle",t)}function bVt(t,e){t.state.dragging||e.loading||n.setPendingEvent(e._2a,"mouseup",kVt,e)}function yVt(t,e,n){Okt("next",t)}function SVt(t,e){t.state.dragging||n.setPendingEvent(e._2h,"mouseup",yVt,e)}function wVt(t,e,o){var r=n.insert(e,n.elem("div",WFt)),a=o._2h=n.pendingEvents(t,r);return n.setClass(r,"fake-okmsg __next-okmsg"),SVt(t,o),n.finalizePendingEvents(a),EVt}function EVt(t,e){SVt(t,e),n.finalizePendingEvents(e._2h)}function xVt(t){return n.get(t.store.data.audioPlayer,"hasNext")?wVt:null}function IVt(t,e,o){e.class="previous-okmsg"+(n.get(o.store.data.audioPlayer,"hasPrev")?"":" __disabled-okmsg")}function BVt(t,e,n){Okt("prev",t)}function MVt(t,e,o){!o._2x&&function(t,e,o){var r=o._2x=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{spin:!0,indeterminate:!0,class:"play-okmsg",size:24,radius:11}))}(t,e,o),n.animate(o._2x,n.createAnimation("global:msg-pop-in 0.1s",WFt))}function AVt(t,e){return e.loading?MVt:null}function TVt(t,e,n){Okt("toggle",t)}function jVt(t,e,n,o){e.icon=o.paused?"play":"pause"}function PVt(t,e){var o=e._38,r=e._39;jVt(0,r,0,e),n.updateComponent(o,r)}function RVt(t,e,o){return o._35?PVt(0,o):function(t,e,o){var r=o._35=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._37=n.addEvent(r,"click",TVt,t,o);var i=o._38=n.insert(a,n.createComponent("msg-icon",xe,t),""),s=o._39=n.propsSet(i,{size:"large"});jVt(0,s,0,o),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"play-okmsg"}))}(t,e,o),n.animate(o._35,n.createAnimation("global:msg-pop-in 0.1s",WFt)),LVt}function LVt(t,e){PVt(0,e)}function OVt(t,e){return e.loading?null:RVt}function zVt(t,e,o){e.class="next-okmsg"+(n.get(o.store.data.audioPlayer,"hasNext")?"":" __disabled-okmsg")}function DVt(t,e,n){Okt("next",t)}function UVt(t,e){t.setState({active:!0})}function NVt(t,e){t.setState({active:!1})}function qVt(t,e,o,r){n.updateAttribute(t,e,"style","left:"+r.offsetLeft+"%;")}function HVt(t,e){t.setState({tooltip:!0})}function FVt(t,e){t.setState({tooltip:!1})}function VVt(t,e){qVt(e._3r,e._3s,0,e)}function KVt(t,e,o){return o._3r?VVt(0,o):function(t,e,o){var r=o._3r=n.insert(e,n.elem("div",WFt)),a=o._3s=n.obj();n.setClass(r,"draggable-point-okmsg"),qVt(r,a,0,o),o._3t=n.addEvent(r,"mouseenter",HVt,t,o),o._3u=n.addEvent(r,"mouseleave",FVt,t,o);var i=n.appendChild(r,n.elem("div",WFt));n.setClass(i,"point-okmsg")}(t,e,o),n.animate(o._3r,n.createAnimation("global:msg-fade-in 0.3s",WFt)),WVt}function WVt(t,e){VVt(0,e)}function GVt(t){return t.state.active?KVt:null}function YVt(t,e,o,r){n.updateAttribute(t,e,"style","width:"+r.offsetLeft+"%")}function XVt(t,e,o,r){n.updateAttribute(t,e,"style","left:"+r.offsetLeft+"%;")}function QVt(t,e,n,o){e.duration=Ht(n,1e3*o.currentTime,0)}function JVt(t,e,n,o){e.duration=1e3*o.duration}function $Vt(t,e){var o=e._46,r=e._47,a=e._49,i=e._4a;XVt(e._44,e._45,0,e),QVt(0,r,t,e),n.updateComponent(o,r),JVt(0,i,0,e),n.updateComponent(a,i)}function ZVt(t,e,o){return o._44?$Vt(t,o):function(t,e,o){var r=o._44=n.insert(e,n.elem("div",WFt)),a=o._45=n.obj();n.setClass(r,"tooltip-okmsg"),XVt(r,a,0,o);var i=o._46=n.appendChild(r,n.createComponent("msg-duration",qi,t)),s=o._47=n.propsSet(i);QVt(0,s,t,o),n.mountComponent(i,s),n.appendChild(r,n.text(" /\n                        "));var u=o._49=n.appendChild(r,n.createComponent("msg-duration",qi,t)),c=o._4a=n.propsSet(u,{class:"total-okmsg"});JVt(0,c,0,o),n.mountComponent(u,c)}(t,e,o),n.animate(o._44,n.createAnimation("global:msg-pop-in 0.15s cubic-bezier(.4, 0, .6, 1)",WFt)),tKt}function tKt(t,e){$Vt(t,e)}function eKt(t){return t.state.tooltip?ZVt:null}function nKt(t,e){var o=t.componentView;GFt(t,e);var r=n.appendChild(o,n.elem("div",WFt)),a=n.createInjector(r);n.setRef(t,"player",r),n.setClass(r,"player-okmsg"),e._i=n.addEvent(r,"mousedown",Rkt,t,e),e._j=n.mountBlock(t,a,JFt);var i=n.insert(a,n.elem("div",WFt)),s=n.createInjector(i);n.setRef(t,"wrap",i),n.setClass(i,"wrap-okmsg");var u=n.insert(s,n.elem("header",WFt)),c=n.createInjector(u);e._r=n.mountBlock(t,c,nVt);var p=e._11=n.insert(c,n.createComponent("msg-button",fe,t)),l=p.componentModel.input;e._13=n.addEvent(p,"click",oVt,t,e);var m=e._14=n.insert(l,n.createComponent("msg-icon",xe,t),"");n.mountComponent(m,n.propsSet(m,{icon:"pin"})),n.mountComponent(p,n.propsSet(p,{shape:"circle"}));var d=e._17=n.insert(c,n.createComponent("msg-button",fe,t)),_=d.componentModel.input;e._19=n.addEvent(d,"click",Pkt,t,e);var f=e._1a=n.insert(_,n.createComponent("msg-icon",xe,t),"");n.mountComponent(f,n.propsSet(f,{icon:"to-message"})),n.mountComponent(d,n.propsSet(d,{shape:"circle"}));var g=e._1d=n.insert(c,n.createComponent("msg-button",fe,t)),v=g.componentModel.input;e._1f=n.addEvent(g,"click",rVt,t,e);var h=e._1g=n.insert(v,n.createComponent("msg-icon",xe,t),"");n.mountComponent(h,n.propsSet(h,{icon:"close"})),n.mountComponent(g,n.propsSet(g,{shape:"circle"}));var C=n.insert(s,n.elem("div",WFt)),k=n.createInjector(C);n.setClass(C,"info-okmsg");var b=n.insert(k,n.elem("div",WFt));n.setClass(b,"title-okmsg"),e._1l=n.appendChild(b,n.text(e.title)),e._1m=n.mountBlock(t,k,_Vt),e._21=n.mountBlock(t,s,CVt);var y=n.insert(s,n.elem("div",WFt)),S=e._2a=n.pendingEvents(t,y);n.setClass(y,"fake-okmsg __play-okmsg"),bVt(t,e),n.finalizePendingEvents(S),e._2d=n.mountBlock(t,s,xVt);var w=n.insert(s,n.elem("footer",WFt)),E=n.appendChild(w,n.elem("div",WFt)),x=n.createInjector(E);n.setClass(E,"player-controls-okmsg");var I=e._2m=n.insert(x,n.createComponent("msg-button",fe,t)),B=I.componentModel.input,M=e._2n=n.propsSet(I,{shape:"circle"});IVt(0,M,t),e._2o=n.addEvent(I,"click",BVt,t,e);var A=e._2p=n.insert(B,n.createComponent("msg-icon",xe,t),"");n.mountComponent(A,n.propsSet(A,{icon:"previous"})),n.mountComponent(I,M),e._2s=n.mountBlock(t,x,AVt),e._30=n.mountBlock(t,x,OVt);var T=e._3b=n.insert(x,n.createComponent("msg-button",fe,t)),j=T.componentModel.input,P=e._3c=n.propsSet(T,{shape:"circle"});zVt(0,P,t),e._3d=n.addEvent(T,"click",DVt,t,e);var R=e._3e=n.insert(j,n.createComponent("msg-icon",xe,t),"");n.mountComponent(R,n.propsSet(R,{icon:"next"})),n.mountComponent(T,P);var L=n.appendChild(w,n.elem("div",WFt)),O=n.createInjector(L);n.setClass(L,"offset-okmsg"),e._3i=n.addEvent(L,"mouseenter",UVt,t,e),e._3j=n.addEvent(L,"mouseleave",NVt,t,e),e._3k=n.addEvent(L,"mousedown",jkt,t,e);var z=n.insert(O,n.elem("div",WFt)),D=n.createInjector(z);n.setRef(t,"progress",z),n.setClass(z,"audio-progress-okmsg"),e._3m=n.mountBlock(t,D,GVt);var U=e._3x=n.insert(D,n.elem("div",WFt)),N=e._3y=n.obj();return n.setClass(U,"bar-okmsg"),YVt(U,N,0,e),e._3z=n.mountBlock(t,O,eKt),n.subscribeStore(t,["audioPlayer","chats"]),oKt}function oKt(t,e){var o=e._2m,r=e._2n,a=e._3b,i=e._3c;GFt(t,e),n.updateBlock(e._j),n.updateBlock(e._r),n.updateText(e._1l,e.title),n.updateBlock(e._1m),n.updateBlock(e._21),bVt(t,e),n.finalizePendingEvents(e._2a),n.updateBlock(e._2d),IVt(0,r,t),n.updateComponent(o,r),n.updateBlock(e._2s),n.updateBlock(e._30),zVt(0,i,t),n.updateComponent(a,i),n.updateBlock(e._3m),YVt(e._3x,e._3y,0,e),n.updateBlock(e._3z)}XFt.dispose=function(t){t._n=t._m=null},tVt.dispose=function(t){t._w=n.removeEvent("click",t._w),t._x=n.unmountInnerHTML(t._x),t._u=n.unmountComponent(t._u)},iVt.dispose=function(t){t._1t=n.unmountComponent(t._1t),t._1u=null},cVt.dispose=function(t){t._1z=null},mVt.dispose=function(t){t._1q=n.unmountBlock(t._1q),t._1w=n.unmountBlock(t._1w)},vVt.dispose=function(t){t._25=n.detachPendingEvents(t._25)},wVt.dispose=function(t){t._2h=n.detachPendingEvents(t._2h)},MVt.dispose=function(t,e){n.animate(t._2x,n.createAnimation("global:msg-pop-out 0.1s",WFt),(function(){return function(t){var e=t._2x;t._2x=n.unmountComponent(e),n.domRemove(e)}(t)}))},RVt.dispose=function(t,e){n.animate(t._35,n.createAnimation("global:msg-pop-out 0.1s",WFt),(function(){return function(t){var e=t._35;t._37=n.removeEvent("click",t._37),t._38=n.unmountComponent(t._38),t._35=n.unmountComponent(e),n.domRemove(e),t._39=null}(t)}))},KVt.dispose=function(t,e){n.animate(t._3r,n.createAnimation("global:msg-fade-out 0.3s",WFt),(function(){return function(t){t._3t=n.removeEvent("mouseenter",t._3t),t._3u=n.removeEvent("mouseleave",t._3u),t._3r=n.domRemove(t._3r),t._3s=null}(t)}))},ZVt.dispose=function(t,e){n.animate(t._44,n.createAnimation("global:msg-pop-out 0.15s cubic-bezier(.4, 0, .6, 1)",WFt),(function(){return function(t){t._46=n.unmountComponent(t._46),t._49=n.unmountComponent(t._49),t._44=n.domRemove(t._44),t._45=t._47=t._4a=null}(t)}))},nKt.dispose=function(t){t._i=n.removeEvent("mousedown",t._i),t._j=n.unmountBlock(t._j),t._r=n.unmountBlock(t._r),t._13=n.removeEvent("click",t._13),t._14=n.unmountComponent(t._14),t._11=n.unmountComponent(t._11),t._19=n.removeEvent("click",t._19),t._1a=n.unmountComponent(t._1a),t._17=n.unmountComponent(t._17),t._1f=n.removeEvent("click",t._1f),t._1g=n.unmountComponent(t._1g),t._1d=n.unmountComponent(t._1d),t._1m=n.unmountBlock(t._1m),t._21=n.unmountBlock(t._21),t._2a=n.detachPendingEvents(t._2a),t._2d=n.unmountBlock(t._2d),t._2o=n.removeEvent("click",t._2o),t._2p=n.unmountComponent(t._2p),t._2m=n.unmountComponent(t._2m),t._2s=n.unmountBlock(t._2s),t._30=n.unmountBlock(t._30),t._3d=n.removeEvent("click",t._3d),t._3e=n.unmountComponent(t._3e),t._3b=n.unmountComponent(t._3b),t._3i=n.removeEvent("mouseenter",t._3i),t._3j=n.removeEvent("mouseleave",t._3j),t._3k=n.removeEvent("mousedown",t._3k),t._3m=n.unmountBlock(t._3m),t._3z=n.unmountBlock(t._3z)};var rKt={__proto__:null,cssScope:WFt,default:nKt,state:Bkt,plugins:Mkt,didRender:Akt,willUnmount:Tkt,handleSeek:jkt,goToMessage:Pkt,onDragStart:Rkt,syncUIPos:Lkt,runPlayerAction:Okt},aKt=-.007,iKt=300,sKt=0,uKt=0;var cKt,pKt=.5,lKt=11e3,mKt=null,dKt=!1,_Kt=0,fKt={reset:function(){var t=wKt(this,this.refs.image);this.setState({zoom:t})},getInitialState:function(){return wKt(this,this.refs.image)}},gKt={zoom:function(t,e){var n=MKt(t);if(n&&(e.preventDefault(),e.detail.start&&(_Kt=e.detail.id),_Kt===e.detail.id)){var o=e.detail,r=o.scale,a=o.x,i=o.y;AKt(t,xKt(n,n.scale+r,a,i))}},"pointer:start":function(t,e){return vKt(t,e)},"pointer:double-tap":function(t,e){return SKt(!1,t,e)},"pointer:move":function(t,e){return function(t){if(TKt(t),mKt&&cKt){var e=t.detail.end,n=MKt(cKt);n?AKt(cKt,EKt(n,mKt.imageX+e.x-mKt.pointerX,mKt.imageY+e.y-mKt.pointerY)):CKt()}}(e)}};function vKt(t,e){var n=t.state.zoom,o=e.detail,r=o.end,a=o.originalEvent;n&&(mKt={pointerX:r.x,pointerY:r.y,imageX:n.x,imageY:n.y},cKt=t,"mousedown"===a.type&&e.preventDefault())}function hKt(t){var e=t.refs.image,n=t.props.maxScale,o=wKt(t,e);n&&(o.maxScale=n),clearTimeout(t.state._loaderTimer),t.setState({zoom:o,interactive:!0,loading:!1,showLoader:!1,_loaderTimer:null})}function CKt(){mKt=cKt=null}function kKt(t){var e=t.state.pendingZoom;t.setState({animated:!1,pendingZoom:null}),e&&AKt(t,e,!0)}function bKt(t,e){TKt(e);var n=MKt(t);if(n){var o=Math.floor((n.scale+pKt)/pKt)*pKt;n.scale<n.fitScale&&o>n.fitScale&&(o=n.fitScale),AKt(t,xKt(n,o),!0)}}function yKt(t,e){TKt(e);var n=MKt(t);if(n){var o=Math.round((n.scale-pKt)/pKt)*pKt;n.scale>n.fitScale&&o<n.fitScale&&(o=n.fitScale),AKt(t,xKt(n,o),!0)}}function SKt(t,e,n){TKt(n);var o=MKt(e);if(o)if(1!==o.fitScale){var r=1===o.scale?o.fitScale:1;if(t)AKt(e,xKt(o,r),!0);else{var a=n.detail.end;AKt(e,xKt(o,r,a.x,a.y),!0)}}else 1!==o.scale&&AKt(e,xKt(o,1),!0)}function wKt(t,e){var n=t.offsetWidth,o=t.offsetHeight,r=e.naturalWidth||e.clientWidth,a=e.naturalHeight||e.clientHeight,i=n/r,s=o/a,u=Math.min(1,i,s),c=Math.round(r*u),p=Math.round(a*u);return{scale:u,fitScale:u,minScale:u/2,maxScale:Math.min(3,lKt/Math.max(r,a)),width:c,height:p,vpWidth:n,vpHeight:o,imgWidth:r,imgHeight:a,x:.5*(n-c),y:.5*(o-p)}}function EKt(t,e,n){return t.x=e,t.y=n,BKt(t)}function xKt(t,e,n,o){void 0===n&&(n=.5*t.vpWidth),void 0===o&&(o=.5*t.vpHeight);var r=t.width>t.vpWidth?(n-t.x)/t.width:n/t.vpWidth,a=t.height>t.vpHeight?(o-t.y)/t.height:o/t.vpHeight,i=t.width,s=t.height;return IKt(t,e),EKt(t,t.x+(i-t.width)*r,t.y+(s-t.height)*a)}function IKt(t,e){return t.scale=Tn(e,t.minScale,t.maxScale),t.width=Math.round(t.imgWidth*t.scale),t.height=Math.round(t.imgHeight*t.scale),t}function BKt(t){var e=(t.vpWidth-t.width)/2,n=(t.vpHeight-t.height)/2,o=Math.min(t.vpWidth-t.width,e),r=Math.max(0,e),a=Math.min(t.vpHeight-t.height,n),i=Math.max(0,n);return t.x=Tn(t.x,o,r),t.y=Tn(t.y,a,i),t}function MKt(t){var e=t.state,o=e.zoom,r=e.pendingZoom||o;return e.interactive&&r?n.__assign({},r):null}function AKt(t,e,n){void 0===n&&(n=!1),n&&t.state.animated&&dKt?t.setState({pendingZoom:e}):t.setState({zoom:e,pendingZoom:null,animated:n&&!Nw(e,t.state.zoom)})}function TKt(t){t&&(t.stopPropagation(),t.preventDefault())}var jKt="eh4avfj";function PKt(t,e,o){!o._6&&function(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{size:48,radius:20,thickness:2,spin:!0,indeterminate:!0}))}(t,e,o),n.animate(o._6,n.createAnimation("global:msg-pop-in 0.15s ease-out",jKt))}function RKt(t){return t.state.showLoader||!t.props.src?PKt:null}function LKt(t,e,o){n.updateAttribute(t,e,"style",o.state.zoom?"transform: translate("+n.get(o.state.zoom,"x")+"px, "+n.get(o.state.zoom,"y")+"px) scale("+n.get(o.state.zoom,"scale")+")":void 0),n.updateClass(t,e,(o.state.loading?"hidden-okmsg":"")+(o.state.animated?" animated-okmsg":"")+(o.state.interactive&&(n.get(o.state.zoom,"vpWidth")<n.get(o.state.zoom,"width")||n.get(o.state.zoom,"vpHeight")<n.get(o.state.zoom,"height"))?" draggable-okmsg":""))}function OKt(t,e,o){n.updateClass(t,e,"controls-okmsg"+(o.state.controls?"":" invisible-okmsg"))}function zKt(t,e){e.stopPropagation()}function DKt(t,e){e.stopPropagation()}function UKt(t,e,o){e.title=n.call(o.store.data.l10n,"key",["photo.zoom-out",{shortcut:"Cmd+-"}])}function NKt(t,e,n){SKt(!0,t,e)}function qKt(t,e,n){SKt(!0,t,e)}function HKt(t,e,o){e.title=n.call(o.store.data.l10n,"key",["photo.zoom-in",{shortcut:"Cmd++"}])}function FKt(t,e){var o=t.componentView,r=n.createInjector(o);e._1=n.mountBlock(t,r,RKt);var a=e._9=n.insert(r,n.elem("img",jKt));n.setRef(t,"image",a),LKt(a,e._a=n.obj(),t),e._b=n.mountUse(t,a,fo,t.props.src),e._c=n.addEvent(a,"load-success",hKt,t,e),e._d=n.addEvent(a,"transitionend",kKt,t,e);var i=n.insert(r,n.elem("footer",jKt)),s=e._f=n.appendChild(i,n.elem("div",jKt));OKt(s,e._g=n.obj(),t),e._h=n.addEvent(s,"touchstart",zKt,t,e),e._i=n.addEvent(s,"mousedown",DKt,t,e);var u=e._j=n.appendChild(s,n.createComponent("msg-button",fe,t)),c=u.componentModel.input,p=e._k=n.propsSet(u,{class:"zoom-out-okmsg"});UKt(0,p,t),e._l=n.addEvent(u,"touchstart",yKt,t,e),e._m=n.addEvent(u,"mousedown",yKt,t,e),n.insert(c,n.text("—")),n.mountComponent(u,p);var l=n.appendChild(s,n.elem("span",jKt));n.setClass(l,"label-okmsg"),e._q=n.addEvent(l,"mousedown",NKt,t,e),e._r=n.addEvent(l,"touchstart",qKt,t,e),e._s=n.appendChild(l,n.text(t.state.zoom?Math.round(100*n.get(t.state.zoom,"scale"))+"%":""));var m=e._t=n.appendChild(s,n.createComponent("msg-button",fe,t)),d=m.componentModel.input,_=e._u=n.propsSet(m,{class:"zoom-in-okmsg"});return HKt(0,_,t),e._v=n.addEvent(m,"touchstart",bKt,t,e),e._w=n.addEvent(m,"mousedown",bKt,t,e),n.insert(d,n.text("+")),n.mountComponent(m,_),n.subscribeStore(t,["l10n"]),VKt}function VKt(t,e){var o=e._j,r=e._k,a=e._t,i=e._u;n.updateBlock(e._1),LKt(e._9,e._a,t),n.updateUse(e._b,t.props.src),OKt(e._f,e._g,t),UKt(0,r,t),n.updateComponent(o,r),n.updateText(e._s,t.state.zoom?Math.round(100*n.get(t.state.zoom,"scale"))+"%":""),HKt(0,i,t),n.updateComponent(a,i)}PKt.dispose=function(t,e){n.animate(t._6,n.createAnimation("global:msg-pop-out 0.15s ease-out",jKt),(function(){return function(t){var e=t._6;t._6=n.unmountComponent(e),n.domRemove(e)}(t)}))},FKt.dispose=function(t){t._1=n.clearBlock(t._1),t._b=n.unmountUse(t._b),t._c=n.removeEvent("load-success",t._c),t._d=n.removeEvent("transitionend",t._d),t._h=n.removeEvent("touchstart",t._h),t._i=n.removeEvent("mousedown",t._i),t._l=n.removeEvent("touchstart",t._l),t._m=n.removeEvent("mousedown",t._m),t._j=n.unmountComponent(t._j),t._q=n.removeEvent("mousedown",t._q),t._r=n.removeEvent("touchstart",t._r),t._v=n.removeEvent("touchstart",t._v),t._w=n.removeEvent("mousedown",t._w),t._t=n.unmountComponent(t._t)};var KKt={__proto__:null,cssScope:jKt,default:FKt,imageOnline:fo,extend:fKt,events:gKt,plugins:function(){return[zS(document,"mouseup",(function(){return CKt})),zS(document,"touchend",(function(){return CKt})),zS(window,"resize",(function(t){return function(){var e=MKt(t);if(e){e.vpWidth=t.offsetWidth,e.vpHeight=t.offsetHeight;var n=e.vpWidth/e.imgWidth,o=e.vpHeight/e.imgHeight,r=Math.min(1,n,o);e.fitScale=r,e.minScale=r/2,AKt(t,BKt(IKt(e,e.scale)))}}})),DS({"CMD+PLUS":bKt,"CMD+MINUS":yKt,"CMD+0":function(t){return SKt(!0,t)}}),sr()]},willMount:function(t){dKt=void 0!==t.ontransitionend;var e=US(t,(function(){return t.setState({controls:!0})}),(function(){return t.setState({controls:!1})}),2e3);t.setState({controls:!0,controlsHover:e}),e.restart(),t.addEventListener("pointer:start",(function(){return e.restart()})),function(t){var e=!1,n=0,o=1,r=0,a=0,i=function(t,n){sKt=Date.now(),e=!1,r=t,a=n},s=function(){e=!0},u=function(e){var n=t.getBoundingClientRect();o=1,i(e.pageX-n.left,e.pageY-n.top),d(e,e.scale-o,!0)},c=function(t){var e=t.scale-o;o=t.scale,d(t,e)},p=function(e){if(2===e.touches.length){var o=e.touches[0],r=e.touches[1],a=t.getBoundingClientRect();n=Math.hypot(o.pageX-r.pageX,o.pageY-r.pageY),i(o.pageX-a.left,o.pageY-a.top),d(e,0,!0)}},l=function(t){if(2===t.touches.length){var e=t.touches[0],o=t.touches[1],r=Math.hypot(e.pageX-o.pageX,e.pageY-o.pageY),a=1-n/r;n=r,d(t,a)}},m=function(e){if(e.ctrlKey||e.metaKey){var n=Date.now(),o=!1;if(n-uKt>iKt){var r=t.getBoundingClientRect();i(e.pageX-r.left,e.pageY-r.top),o=!0}uKt=n,d(e,e.deltaY*aKt,o)}},d=function(n,o,i){if(void 0===i&&(i=!1),e)n.preventDefault();else{var u=new CustomEvent("zoom",{cancelable:!0,bubbles:!0,detail:{id:sKt,x:r,y:a,start:i,scale:o}});u.cancelZoom=s,t.dispatchEvent(u),(u.defaultPrevented||e)&&n.preventDefault()}};"ongesturestart"in window?(t.addEventListener("gesturestart",u),t.addEventListener("gesturechange",c)):(t.addEventListener("touchstart",p),t.addEventListener("touchmove",l)),t.addEventListener("wheel",m,{passive:!1})}(t)},didChange:function(t,e){var n=e.src,o=e.maxScale;if(n&&t.setState({interactive:!1,loading:!0,_loaderTimer:window.setTimeout((function(){t.setState({showLoader:!0})}),300)}),o){var r=MKt(t);r&&(r.maxScale=o.current,AKt(t,r))}},willUnmount:function(t){cKt===t&&CKt(),clearTimeout(t.state._loaderTimer)},onDragStart:vKt,onImageLoad:hKt,onTransitionEnd:kKt,zoomIn:bKt,zoomOut:yKt,toggleZoom:SKt},WKt=320,GKt=[zS(window,"resize",(function(t){return o.throttle((function(){var e=t.props.media;e&&YKt(t,XKt(e))}),200)}))];function YKt(t,e){var n=t.clientWidth,o=t.clientHeight,r=0,a=0,i=1;if(e&&(i=Math.min(1,n/e.width,o/e.height),r=Math.round(e.width*i),a=Math.round(e.height*i),"VIDEO"===e._type&&r<WKt)){var s=Math.round(a/r*WKt);s<o&&WKt<n&&(r=WKt,a=s)}t.setState({maxWidth:n,maxHeight:o,width:r,height:a,ratio:i})}function XKt(t){return"FILE"===t._type?t.preview:t}var QKt="e-5rosq0";function JKt(t,e){e.media="FILE"===n.get(t.props.media,"_type")&&n.get(t.props.media,"preview")?n.get(t.props.media,"preview"):t.props.media}function $Kt(t,e,o,r){e.key="video-preview-after-"+("processing"===n.get(r.media,"status")?"processing":"upload")}function ZKt(t,e,o){var r=o._7=n.insert(e,n.createComponent("msg-l10n",ae,t)),a=o._8=n.propsSet(r,{class:"video-stub-okmsg"});return $Kt(0,a,0,o),n.mountComponent(r,a),tWt}function tWt(t,e){var o=e._7,r=e._8;$Kt(0,r,0,e),n.updateComponent(o,r)}function eWt(t,e,o,r){e.src=n.get(r.media,"previewData"),e.height=n.get(r.media,"height"),e.width=n.get(r.media,"width"),e.style="height: "+n.get(r.media,"height")+"px; width: "+n.get(r.media,"width")+"px"}function nWt(t,e){e.stopPropagation()}function oWt(t,e){e.stopPropagation(),e.preventDefault(),n.call(n.get(t.store,"chat"),"uncensor",[t.props.media])}function rWt(t,e){var o=e._g,r=e._h;eWt(0,r,0,e),n.updateComponent(o,r)}function aWt(t,e,o){return o._g?rWt(0,o):function(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-img-censor",$e,t)),a=o._h=n.propsSet(r);eWt(0,a,0,o),o._i=n.addEvent(r,"mousedown",nWt,t,o),o._j=n.addEvent(r,"click",oWt,t,o),n.mountComponent(r,a)}(t,e,o),n.stopAnimation(o._g,!0),iWt}function iWt(t,e){rWt(0,e)}function sWt(t){return t.props.censored?aWt:null}function uWt(t,e,n){e.video=n.props.media,e.autoplay=!n.props.censored&&n.props.autoplay,e.width=n.state.width,e.height=n.state.height,e.maxHeight=n.state.maxHeight,e.style="width: "+n.state.width+"px",e.class=n.props.censored?"censored-okmsg":""}function cWt(t,e){e.stopPropagation()}function pWt(t){Zt(t,"close")}function lWt(t,e,o){var r=o._n=n.insert(e,n.createComponent("msg-video-player",Xc,t)),a=o._o=n.propsSet(r);return uWt(0,a,t),o._p=n.addEvent(r,"mousedown",cWt,t,o),o._q=n.addEvent(r,"enter-pip",pWt,t,o),n.mountComponent(r,a),mWt}function mWt(t,e){var o=e._n,r=e._o;uWt(0,r,t),n.updateComponent(o,r)}function dWt(t,e,o){e.src=n.get(o.props.media,"url")||$t(0,n.get(o.props.media,"preview","baseUrl")||n.get(o.props.media,"baseUrl"),1440,!1)||n.get(o.props.media,"preview","url"),e.class=o.props.censored?"censored-okmsg":""}function _Wt(t,e,o){var r=o._t=n.insert(e,n.createComponent("msg-photo-zoom",KKt,t));n.setPendingRef(o._1,"zoom",r);var a=o._u=n.propsSet(r);return dWt(0,a,t),n.mountComponent(r,a),fWt}function fWt(t,e){var o=e._t,r=e._u;n.setPendingRef(e._1,"zoom",o),dWt(0,r,t),n.updateComponent(o,r)}function gWt(t){return"VIDEO"===n.get(t.props.media,"_type")||"VIDEO"===n.get(t.props.media,"preview","_type")?lWt:_Wt}function vWt(t,e,o){return o._b=n.mountBlock(t,e,sWt),o._k=n.mountBlock(t,e,gWt),hWt}function hWt(t,e){n.updateBlock(e._b),n.updateBlock(e._k)}function CWt(t,e){return"VIDEO"!==n.get(e.media,"_type")||n.get(e.media,"width")?vWt:ZKt}function kWt(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj();return JKt(t,e),e._4=n.mountBlock(t,r,CWt),n.finalizePendingRefs(t,a),bWt}function bWt(t,e){JKt(t,e),n.updateBlock(e._4),n.finalizePendingRefs(t,e._1)}ZKt.dispose=function(t){t._7=n.unmountComponent(t._7),t._8=null},aWt.dispose=function(t,e){n.animate(t._g,n.createAnimation("global:msg-fade-out 0.9s",QKt),(function(){return function(t){var e=t._g;t._i=n.removeEvent("mousedown",t._i),t._j=n.removeEvent("click",t._j),t._g=n.unmountComponent(e),n.domRemove(e),t._h=null}(t)}))},lWt.dispose=function(t){t._p=n.removeEvent("mousedown",t._p),t._q=n.removeEvent("enter-pip",t._q),t._n=n.unmountComponent(t._n),t._o=null},_Wt.dispose=function(t){t._t=n.unmountComponent(t._t),t._u=null},vWt.dispose=function(t){t._b=n.unmountBlock(t._b),t._k=n.unmountBlock(t._k)},kWt.dispose=function(t){t._4=n.clearBlock(t._4)};var yWt={__proto__:null,cssScope:QKt,default:kWt,plugins:GKt,didChange:function(t,e){var n=e.media;n&&requestAnimationFrame((function(){YKt(t,XKt(n.current))}))}},SWt={get src(){return this.state.src}},wWt=[DS({ESC:function(t,e){e.stopPropagation(),e.preventDefault(),Zt(t,"close")},LEFT:IWt,RIGHT:xWt})];function EWt(t,e){if(void 0===e&&(e=t.props.src),"string"!=typeof e){var n=t.state.src;n&&URL.revokeObjectURL(n)}}function xWt(t){t.props.next&&te(t,"next")}function IWt(t){t.props.previous&&te(t,"previous")}var BWt="e-cyvztn";function MWt(t,e){e.preventDefault(),Zt(t,"close")}function AWt(t,e){e.preventDefault(),Zt(t,"close")}function TWt(t,e,n){e.stopPropagation(),IWt(t)}function jWt(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._e=n.addEvent(r,"mousedown",TWt,t,o);var i=o._f=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"arrow-prev"})),n.mountComponent(r,n.propsSet(r,{viewType:"arrow",class:"prev-okmsg"}))}function PWt(t){return t.props.previous?jWt:null}function RWt(t,e,n){e.stopPropagation(),xWt(t)}function LWt(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._o=n.addEvent(r,"mousedown",RWt,t,o);var i=o._p=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"arrow-next"})),n.mountComponent(r,n.propsSet(r,{viewType:"arrow",class:"next-okmsg"}))}function OWt(t){return t.props.next?LWt:null}function zWt(t,e,n){e.src=n.state.src}function DWt(t,e,o){var r=o._v=n.insert(e,n.createComponent("msg-photo-zoom",KKt,t),""),a=o._w=n.propsSet(r);return zWt(0,a,t),n.mountComponent(r,a),UWt}function UWt(t,e){var o=e._v,r=e._w;zWt(0,r,t),n.updateComponent(o,r)}function NWt(t,e){var o=t.componentView,r=n.appendChild(o,n.elem("div",BWt)),a=n.createInjector(r);n.setClass(r,"main-okmsg");var i=e._2=n.insert(a,n.createComponent("msg-button",fe,t)),s=i.componentModel.input;e._4=n.addEvent(i,"mousedown",MWt,t,e),e._5=n.addEvent(i,"touchstart",AWt,t,e);var u=e._6=n.insert(s,n.createComponent("msg-icon",xe,t),"");n.mountComponent(u,n.propsSet(u,{icon:"close"})),n.mountComponent(i,n.propsSet(i,{class:"close-okmsg"})),e._9=n.mountBlock(t,a,PWt),e._j=n.mountBlock(t,a,OWt),n.insert(a,n.createSlot(t,"",BWt)),e._x=n.mountSlot(t,"",DWt);var c=n.appendChild(o,n.elem("footer",BWt)),p=n.appendChild(c,n.elem("section",BWt));n.appendChild(p,n.createSlot(t,"image",BWt)),e._11=n.mountSlot(t,"image");var l=n.appendChild(p,n.elem("div",BWt));n.setClass(l,"description-okmsg");var m=n.appendChild(l,n.elem("h4",BWt));n.appendChild(m,n.createSlot(t,"title",BWt)),e._15=n.mountSlot(t,"title"),n.appendChild(l,n.createSlot(t,"comment",BWt)),e._17=n.mountSlot(t,"comment");var d=n.appendChild(c,n.elem("aside",BWt));return n.appendChild(d,n.createSlot(t,"controls",BWt)),e._1a=n.mountSlot(t,"controls"),qWt}function qWt(t,e){n.updateBlock(e._9),n.updateBlock(e._j),n.updateDefaultSlot(e._x)}jWt.dispose=function(t){t._e=n.removeEvent("mousedown",t._e),t._f=n.unmountComponent(t._f),t._c=n.unmountComponent(t._c)},LWt.dispose=function(t){t._o=n.removeEvent("mousedown",t._o),t._p=n.unmountComponent(t._p),t._m=n.unmountComponent(t._m)},DWt.dispose=function(t){t._v=n.unmountComponent(t._v),t._w=null},NWt.dispose=function(t){t._4=n.removeEvent("mousedown",t._4),t._5=n.removeEvent("touchstart",t._5),t._6=n.unmountComponent(t._6),t._2=n.unmountComponent(t._2),t._9=n.unmountBlock(t._9),t._j=n.unmountBlock(t._j),t._x=n.unmountSlot(t._x),t._11=n.unmountSlot(t._11),t._15=n.unmountSlot(t._15),t._17=n.unmountSlot(t._17),t._1a=n.unmountSlot(t._1a)};var HWt={__proto__:null,cssScope:BWt,default:NWt,extend:SWt,plugins:wWt,didChange:function(t,e){var n=e.src;n&&(n.prev&&EWt(t,n.prev),n.current?t.setState({src:"string"==typeof n.current?n.current:URL.createObjectURL(n.current)}):t.setState({src:""}))},willUnmount:function(t){EWt(t)},next:xWt,previous:IWt};function FWt(t){switch(t){case"image/jpeg":case"image/webp":return".jpg";case"image/png":return".png";case"image/gif":return".gif";default:return""}}function VWt(t){return(t<10?"0":"")+t}function KWt(){var t=new Date,e=VWt(t.getHours())+"-"+VWt(t.getMinutes())+"-"+VWt(t.getSeconds());return t.getFullYear()+"-"+VWt(t.getMonth()+1)+"-"+VWt(t.getDate())+" "+e}function WWt(t,e){return"image"+(e||"")+FWt(t)}function GWt(t){!function(t){var e=t.props,n=e.url;if(!n)return;"undefined"!=typeof fetch&&"undefined"!=typeof File?fetch(n).then((function(t){return t.blob()})).then((function(e){var n=WWt(e.type,KWt());if(navigator.msSaveBlob)navigator.msSaveBlob(e,n);else{var o=new Blob([e],{type:e.type});o.name=n,Zt(t,"download-url",{url:URL.createObjectURL(o),name:n})}})):Zt(t,"download-url",{url:n,name:WWt("image/jpeg",KWt())})}(t),o.isDesktopVersion()&&Zt(t,"show-toast",V("image-saved"))}var YWt="ethp513";function XWt(t,e){var o=t.componentView,r=n.appendChild(o,n.createSlot(t,"",YWt));e._2=n.addEvent(r,"click",GWt,t,e),e._3=n.mountSlot(t,"")}XWt.dispose=function(t){t._2=n.removeEvent("click",t._2),t._3=n.unmountSlot(t._3)};var QWt={__proto__:null,cssScope:YWt,default:XWt,props:function(){return{url:null}},getFileExtension:FWt,onDownload:GWt};function JWt(t){var e=t.props,n=e.chat,o=e.messageTime;n&&o&&(!function(t){Zt(t,"close")}(t),$p(n.id,{messagesTime:o}))}var $Wt=[0],ZWt=[];function tGt(){ZWt.push($Wt),$Wt=[0]}function eGt(){$Wt=ZWt.pop()}function nGt(t,e){e.chooseExpr=n.get(t.props.download,"_type")?0:t.props.download?1:-1,e.caseExpr=0===e.chooseExpr,e.download=e.caseExpr?n.get(t.store.data.download,n.get(t.props.download,"fileId")):void 0,e.progress=e.caseExpr?n.get(e.download,"progress"):void 0}function oGt(t,e,o){e.title=n.call(o.store.data.l10n,"key",["to-message"])}function rGt(t,e,o){var r=o._9=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._a=n.propsSet(r,{role:"inverted"});oGt(0,i,t),o._b=n.addEvent(r,"click",JWt,t,o);var s=o._c=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(s,n.propsSet(s,{icon:"to-message",size:"medium"}));var u=o._e=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(u,n.propsSet(u,{key:"to-message"})),n.mountComponent(r,i),aGt}function aGt(t,e){var o=e._9,r=e._a;oGt(0,r,t),n.updateComponent(o,r)}function iGt(t){return t.props.messageTime?rGt:null}function sGt(t,e,n){e.attachment=n.props.download}function uGt(t,e){e.stopPropagation(),n.call(n.get(t.store,"download"),"cancel",[n.get(t.props.download,"fileId"),!0])}function cGt(t,e,o,r){e.progress=r.progress&&n.get(r.progress,"loaded")/n.get(r.progress,"total")}function pGt(t,e,o){o._t=n.addEvent(o._n,"click",uGt,t,o);var r=o._u=n.insert(e,n.createComponent("msg-progress",Ps,t),""),a=o._v=n.propsSet(r,{cancelable:!0,spin:!0,"data-l":"t,abort"});return cGt(0,a,0,o),n.mountComponent(r,a),$Wt[0]=1,lGt}function lGt(t,e){var o=e._u,r=e._v;cGt(0,r,0,e),n.updateComponent(o,r)}function mGt(t,e,o){var r=o._y=n.insert(e,n.createComponent("msg-icon",xe,t),"");n.mountComponent(r,n.propsSet(r,{icon:"download",size:"medium"})),$Wt[0]=1}function dGt(t,e){return"loading"===n.get(e.download,"status")?pGt:mGt}function _Gt(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-download-hook",ym,t)),a=r.componentModel.input,i=o._m=n.propsSet(r);sGt(0,i,t);var s=o._n=n.insert(a,n.createComponent("msg-button",fe,t),""),u=s.componentModel.input,c=o._o=n.pendingEvents(t,s);o._q=n.mountBlock(t,u,dGt);var p=o._11=n.insert(u,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(p,n.propsSet(p,{key:"download"})),n.finalizePendingEvents(c),n.mountComponent(s,n.propsSet(s,{role:"inverted"})),n.mountComponent(r,i),fGt}function fGt(t,e){var o=e._l,r=e._m;sGt(0,r,t),n.updateBlock(e._q),n.finalizePendingEvents(e._o),n.updateIncomingSlot(e._n,"",$Wt[0]),n.updateComponent(o,r)}function gGt(t,e,n){e.url=n.props.download,e.mime=n.props.mime}function vGt(t,e,o){e.title=n.call(o.store.data.l10n,"key",["download"])}function hGt(t,e,o){var r=o._16=n.insert(e,n.createComponent("msg-save-image-button",QWt,t)),a=r.componentModel.input,i=o._17=n.propsSet(r);gGt(0,i,t);var s=o._18=n.insert(a,n.createComponent("msg-button",fe,t),""),u=s.componentModel.input,c=o._19=n.propsSet(s,{role:"inverted"});vGt(0,c,t);var p=o._1a=n.insert(u,n.createComponent("msg-icon",xe,t),"");n.mountComponent(p,n.propsSet(p,{icon:"download",size:"medium"}));var l=o._1c=n.insert(u,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(l,n.propsSet(l,{key:"download"})),n.mountComponent(s,c),n.mountComponent(r,i),CGt}function CGt(t,e){var o=e._16,r=e._17,a=e._18,i=e._19;gGt(0,r,t),vGt(0,i,t),n.updateComponent(a,i),n.updateComponent(o,r)}function kGt(t,e){return[_Gt,hGt][e.chooseExpr]}function bGt(t,e){var o=t.componentView;tGt();var r=n.createInjector(o);return nGt(t,e),e._6=n.mountBlock(t,r,iGt),e._i=n.mountBlock(t,r,kGt),eGt(),n.subscribeStore(t,["download","l10n"]),yGt}function yGt(t,e){tGt(),nGt(t,e),n.updateBlock(e._6),n.updateBlock(e._i),eGt()}rGt.dispose=function(t){t._b=n.removeEvent("click",t._b),t._c=n.unmountComponent(t._c),t._e=n.unmountComponent(t._e),t._9=n.unmountComponent(t._9),t._a=null},pGt.dispose=function(t){t._t=n.removeEvent("click",t._t),t._u=n.unmountComponent(t._u),t._v=null,$Wt[0]=1},mGt.dispose=function(t){t._y=n.unmountComponent(t._y),$Wt[0]=1},_Gt.dispose=function(t){t._o=n.detachPendingEvents(t._o),t._q=n.unmountBlock(t._q),t._11=n.unmountComponent(t._11),t._n=n.unmountComponent(t._n),t._l=n.unmountComponent(t._l),t._m=null},hGt.dispose=function(t){t._1a=n.unmountComponent(t._1a),t._1c=n.unmountComponent(t._1c),t._18=n.unmountComponent(t._18),t._16=n.unmountComponent(t._16),t._17=t._19=null},bGt.dispose=function(t){tGt(),t._6=n.clearBlock(t._6),t._i=n.clearBlock(t._i),eGt()};var SGt={__proto__:null,cssScope:"e62xssj",default:bGt,onToMessageClick:JWt},wGt=[DS({LEFT:function(t){t.state.hasPrevious&&EGt(t)},RIGHT:function(t){t.state.hasNext&&xGt(t)},ALL:function(){return null}})];function EGt(t){IGt(t,t.props.reverse?"next":"previous")}function xGt(t){IGt(t,t.props.reverse?"previous":"next")}function IGt(t,e){var n=t.props.chat,o=BGt(t);if(-1!==o[e]){var r=o.items[o[e]];t.store.app.media.selectItem(n.id,t.props.sectionId,r.id)}}function BGt(t){return t.props.chat.media.get(t.props.sectionId)}function MGt(t){if(t){var e=t.attach;if(!e||"FILE"===e._type)return;Ct(e)||kt(e)}}function AGt(t){Zt(t,"close")}var TGt=[0,0],jGt=[];function PGt(){jGt.push(TGt),TGt=[0,0]}function RGt(){TGt=jGt.pop()}function LGt(t,e){e.mediaItem=n.get(t.state.section,"items",n.get(t.state.section,"current")),e.sender=n.get(t.store.data.contacts,n.get(e.mediaItem,"sender"))}function OGt(t,e,n){e.next=n.state.hasNext,e.previous=n.state.hasPrevious,e.sender=n.props.sender}function zGt(t,e,n){e.stopPropagation(),AGt(t)}function DGt(t,e,o,r){e.censored=(o.store.data.whiteList||[])&&n.call(n.get(o.store,"chat"),"isCensored",[n.get(r.mediaItem,"attach")]),e.media=n.get(r.mediaItem,"attach"),e.autoplay=o.state.autoplay}function UGt(t,e,n,o){e.user=o.sender}function NGt(t,e,o){var r=o._e=n.insert(e,n.createComponent("msg-user-card",Nh,t),"image"),a=o._f=n.propsSet(r,{slot:"image",size:"small",inverse:!0});return UGt(0,a,0,o),n.mountComponent(r,a),TGt[0]=1,qGt}function qGt(t,e){var o=e._e,r=e._f;UGt(0,r,0,e),n.updateComponent(o,r)}function HGt(t,e){return e.sender?NGt:null}function FGt(t,e,o,r){e.date=n.get(r.mediaItem,"time"),e.l10n=o.store.data.l10n}function VGt(t,e,o,r){e.chat=o.props.chat,e.messageTime=n.get(r.mediaItem,"time"),e.download=o.state.downloadUrl,e.mime="VIDEO"===n.get(r.mediaItem,"attach","_type")?"video/mp4":o.props.undefined}function KGt(t,e){var o=t.componentView;PGt(),LGt(t,e);var r=e._4=n.appendChild(o,n.createComponent("msg-media-viewer",HWt,t)),a=r.componentModel.input,i=e._5=n.propsSet(r);OGt(0,i,t),e._6=n.addEvent(r,"previous",EGt,t,e),e._7=n.addEvent(r,"next",xGt,t,e),e._8=n.addEvent(r,"close",zGt,t,e);var s=e._9=n.insert(a,n.createComponent("msg-media-layer-content",yWt,t),"");n.setRef(t,"content",s);var u=e._a=n.propsSet(s);DGt(0,u,t,e),n.mountComponent(s,u),e._b=n.mountBlock(t,a,HGt);var c=e._h=n.insert(a,n.createComponent("msg-parsed-text",ii,t),"title"),p=c.componentModel.input;e._j=n.insert(p,n.text(n.get(e.sender,"name"))),n.mountComponent(c,n.propsSet(c,{slot:"title"}));var l=e._l=n.insert(a,n.createComponent("msg-relative-date",Kb,t),"comment"),m=e._m=n.propsSet(l,{slot:"comment"});FGt(0,m,t,e),n.mountComponent(l,m);var d=e._n=n.insert(a,n.createComponent("msg-media-viewer-actions",SGt,t),"controls"),_=e._o=n.propsSet(d,{slot:"controls"});return VGt(0,_,t,e),n.mountComponent(d,_),n.mountComponent(r,i),RGt(),n.subscribeStore(t,["contacts","whiteList","l10n"]),WGt}function WGt(t,e){var o=e._4,r=e._5,a=e._9,i=e._a,s=e._l,u=e._m,c=e._n,p=e._o;PGt(),LGt(t,e),OGt(0,r,t),DGt(0,i,t,e),n.updateComponent(a,i),n.updateBlock(e._b),TGt[1]|=n.updateText(e._j,n.get(e.sender,"name")),n.updateIncomingSlot(e._h,"",TGt[1]),FGt(0,u,t,e),n.updateComponent(s,u),VGt(0,p,t,e),n.updateComponent(c,p),n.updateIncomingSlot(o,"image",TGt[0]),n.updateComponent(o,r),RGt()}NGt.dispose=function(t){t._e=n.unmountComponent(t._e),t._f=null,TGt[0]=1},KGt.dispose=function(t){PGt(),t._6=n.removeEvent("previous",t._6),t._7=n.removeEvent("next",t._7),t._8=n.removeEvent("close",t._8),t._9=n.unmountComponent(t._9),t._b=n.unmountBlock(t._b),t._h=n.unmountComponent(t._h),t._l=n.unmountComponent(t._l),t._n=n.unmountComponent(t._n),t._4=n.unmountComponent(t._4),RGt()};var GGt={__proto__:null,cssScope:"e-yt86x9",default:KGt,plugins:wGt,state:function(){return{autoplay:!0}},didChange:function(t,e){var n=e.chat;if(n&&n.current){var o=BGt(t);-1!==o.next&&MGt(o.items[o.next]),-1!==o.previous&&MGt(o.items[o.previous]);var r=t.props.reverse;t.setState({section:o,hasNext:r?-1!==o.previous:-1!==o.next,hasPrevious:r?-1!==o.next:-1!==o.previous}),function(t){t.setState({downloadUrl:null});var e=function(t){var e=BGt(t);if(e){var n=e.items[e.current];if(n&&"attach"in n)return n.attach}}(t);if(!e)return;"FILE"===e._type&&t.setState({downloadUrl:e});"VIDEO"===e._type||"baseUrl"in e&&t.setState({downloadUrl:xt(e.baseUrl,1440,!1,!0)})}(t)}},onInfoClick:function(t){var e=t.props.chat,n=BGt(t);if(-1!==n.current){var o=n.items[n.current],r=e.messages.get(o.messageId);"CHANNEL"!==r.type&&Zp(r.sender.id),function(t){Zt(t,"close")}(t)}},showPrevious:EGt,showNext:xGt,onMediaClose:AGt},YGt=[0],XGt=[];function QGt(){XGt.push(YGt),YGt=[0]}function JGt(){YGt=XGt.pop()}function $Gt(t,e){e.isParticipant=n.get(n.find(n.get(t.props.chat,"participants"),(function(t){return n.get(t,"user","current")})),"user"),e.isAdmin=n.get(n.find(n.get(t.props.chat,"admins"),(function(t){return n.get(t,"user","current")})),"user"),e.permissions=n.get(n.find(n.get(t.props.chat,"admins"),(function(t){return n.get(t,"user","current")})),"permissions"),e.editPermsChat="CHAT"==n.get(t.props.chat,"type")&&e.isParticipant&&(!n.get(t.props.chat,"options","ONLY_OWNER_CAN_CHANGE_ICON_TITLE")||n.get(e.permissions,"manageChat")),e.editPermsChannel="CHANNEL"==n.get(t.props.chat,"type")&&e.isAdmin&&n.get(e.permissions,"manageChat"),e.src=$t(0,n.get(t.props.chat,"fullIconUrl"),1440,!1,!0)}function ZGt(t,e,n,o){e.src=o.src}function tYt(t,e,n){e.chat=n.props.chat}function eYt(t,e,n){e.chat=n.props.chat}function nYt(t,e,n,o){e.url=o.src}function oYt(t,e){var o=t.componentView;QGt(),$Gt(t,e);var r=e._8=n.appendChild(o,n.createComponent("msg-media-viewer",HWt,t)),a=r.componentModel.input,i=e._9=n.propsSet(r);ZGt(0,i,0,e);var s=e._a=n.insert(a,n.createComponent("msg-chat-image",db,t),"image"),u=e._b=n.propsSet(s,{slot:"image",size:"small"});tYt(0,u,t),n.mountComponent(s,u);var c=e._c=n.insert(a,n.createComponent("msg-parsed-text",ii,t),"title"),p=c.componentModel.input;e._e=n.insert(p,n.text(Kt(t,t.props.chat))),n.mountComponent(c,n.propsSet(c,{slot:"title"}));var l=e._g=n.insert(a,n.createComponent("msg-chat-meta",xy,t),"comment"),m=e._h=n.propsSet(l,{slot:"comment"});eYt(0,m,t),n.mountComponent(l,m);var d=e._i=n.insert(a,n.createComponent("msg-save-image-button",QWt,t),"controls"),_=d.componentModel.input,f=e._j=n.propsSet(d,{slot:"controls"});nYt(0,f,0,e);var g=e._k=n.insert(_,n.createComponent("msg-button",fe,t),""),v=g.componentModel.input,h=e._m=n.insert(v,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(h,n.propsSet(h,{icon:"download",size:"medium"})),n.mountComponent(g,n.propsSet(g,{role:"inverted",shape:"circle"})),n.mountComponent(d,f),n.mountComponent(r,i),JGt(),rYt}function rYt(t,e){var o=e._8,r=e._9,a=e._a,i=e._b,s=e._g,u=e._h,c=e._i,p=e._j;QGt(),$Gt(t,e),ZGt(0,r,0,e),tYt(0,i,t),n.updateComponent(a,i),YGt[0]|=n.updateText(e._e,Kt(t,t.props.chat)),n.updateIncomingSlot(e._c,"",YGt[0]),eYt(0,u,t),n.updateComponent(s,u),nYt(0,p,0,e),n.updateComponent(c,p),n.updateComponent(o,r),JGt()}oYt.dispose=function(t){QGt(),t._a=n.unmountComponent(t._a),t._c=n.unmountComponent(t._c),t._g=n.unmountComponent(t._g),t._m=n.unmountComponent(t._m),t._k=n.unmountComponent(t._k),t._i=n.unmountComponent(t._i),t._8=n.unmountComponent(t._8),JGt()};var aYt={__proto__:null,cssScope:"epqvzx8",default:oYt},iYt=[0,0,0,0,0],sYt=[];function uYt(){sYt.push(iYt),iYt=[0,0,0,0,0]}function cYt(){iYt=sYt.pop()}function pYt(t,e,n){e.src=n.props.src}function lYt(t,e,n){e.chat=n.props.chat}function mYt(t,e,n){e.chat=n.props.chat}function dYt(t,e,n){e.url=n.props.src}function _Yt(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-chat-image",db,t),"image"),a=o._7=n.propsSet(r,{slot:"image",size:"small"});lYt(0,a,t),n.mountComponent(r,a);var i=o._8=n.insert(e,n.createComponent("msg-parsed-text",ii,t),"title"),s=i.componentModel.input;o._a=n.insert(s,n.text(n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder"))),n.mountComponent(i,n.propsSet(i,{slot:"title"}));var u=o._c=n.insert(e,n.createComponent("msg-chat-meta",xy,t),"comment"),c=o._d=n.propsSet(u,{slot:"comment"});mYt(0,c,t),n.mountComponent(u,c);var p=o._e=n.insert(e,n.createComponent("msg-save-image-button",QWt,t),"controls"),l=p.componentModel.input,m=o._f=n.propsSet(p,{slot:"controls"});dYt(0,m,t);var d=o._g=n.insert(l,n.createComponent("msg-button",fe,t),""),_=d.componentModel.input,f=o._i=n.insert(_,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(f,n.propsSet(f,{icon:"download",size:"medium"})),n.mountComponent(d,n.propsSet(d,{shape:"circle",class:"primary-okmsg"})),n.mountComponent(p,m),iYt[0]=iYt[1]=iYt[3]=iYt[4]=1,fYt}function fYt(t,e){var o=e._6,r=e._7,a=e._c,i=e._d,s=e._e,u=e._f;lYt(0,r,t),n.updateComponent(o,r),iYt[2]|=n.updateText(e._a,n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")),n.updateIncomingSlot(e._8,"",iYt[2]),mYt(0,i,t),n.updateComponent(a,i),dYt(0,u,t),n.updateComponent(s,u)}function gYt(t,e,o){var r=o._o=n.insert(e,n.createComponent("msg-l10n",ae,t),"comment");n.mountComponent(r,n.propsSet(r,{key:"preview-photo",slot:"comment"})),iYt[3]=1}function vYt(t){return t.props.chat?_Yt:gYt}function hYt(t,e){var o=t.componentView;uYt();var r=e._1=n.appendChild(o,n.createComponent("msg-media-viewer",HWt,t)),a=r.componentModel.input,i=e._2=n.propsSet(r);return pYt(0,i,t),e._3=n.mountBlock(t,a,vYt),n.mountComponent(r,i),cYt(),CYt}function CYt(t,e){var o=e._1,r=e._2;uYt(),pYt(0,r,t),n.updateBlock(e._3),n.updateIncomingSlot(o,"image",iYt[0]),n.updateIncomingSlot(o,"title",iYt[1]),n.updateIncomingSlot(o,"comment",iYt[3]),n.updateIncomingSlot(o,"controls",iYt[4]),n.updateComponent(o,r),cYt()}_Yt.dispose=function(t){t._6=n.unmountComponent(t._6),t._8=n.unmountComponent(t._8),t._c=n.unmountComponent(t._c),t._i=n.unmountComponent(t._i),t._g=n.unmountComponent(t._g),t._e=n.unmountComponent(t._e),t._7=t._a=t._d=t._f=null,iYt[0]=iYt[1]=iYt[3]=iYt[4]=1},gYt.dispose=function(t){t._o=n.unmountComponent(t._o),iYt[3]=1},hYt.dispose=function(t){uYt(),t._3=n.unmountBlock(t._3),t._1=n.unmountComponent(t._1),cYt()};var kYt={__proto__:null,cssScope:"e-cbh71t",default:hYt};var bYt=[0,0],yYt=[];function SYt(){yYt.push(bYt),bYt=[0,0]}function wYt(){bYt=yYt.pop()}function EYt(t,e){e.total=n.get(t.props.contact,"photos","total")||0,e.data=n.get(t.props.contact,"photos","urls",t.state.index)}function xYt(t,e,o,r){e.src=n.get(r.data,"url"),e.next=r.total&&o.state.index<r.total-1,e.previous=r.total&&o.state.index>0}function IYt(t,e){t.setState({index:t.state.index+1})}function BYt(t,e){t.setState({index:t.state.index-1})}function MYt(t,e,n){e.user=n.props.contact}function AYt(t,e,n){e.user=n.props.contact}function TYt(t,e,o,r){e.url=n.get(r.data,"url")+"&ext=jpg"}function jYt(t,e,o){e.title=n.call(o.store.data.l10n,"key",["delete-photo"])}function PYt(t,e,o,r){n.call(n.get(t.store,"auth"),"removePhoto",[n.get(r.data,"id")])}function RYt(t,e,o){var r=o._r=n.insert(e,n.createComponent("msg-button",fe,t),"controls"),a=r.componentModel.input,i=o._s=n.propsSet(r,{role:"inverted",slot:"controls",shape:"circle",size:"big"});jYt(0,i,t),o._t=n.addEvent(r,"click",PYt,t,o);var s=o._u=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"delete",size:"medium"})),n.mountComponent(r,i),bYt[1]=1,LYt}function LYt(t,e){var o=e._r,r=e._s;jYt(0,r,t),n.updateComponent(o,r)}function OYt(t,e){return n.get(t.props.contact,"current")&&n.get(e.data,"id")?RYt:null}function zYt(t,e){var o=t.componentView;SYt(),EYt(t,e);var r=e._4=n.appendChild(o,n.createComponent("msg-media-viewer",HWt,t)),a=r.componentModel.input,i=e._5=n.propsSet(r);xYt(0,i,t,e),e._6=n.addEvent(r,"next",IYt,t,e),e._7=n.addEvent(r,"previous",BYt,t,e);var s=e._8=n.insert(a,n.createComponent("msg-user-card",Nh,t),"image"),u=e._9=n.propsSet(s,{slot:"image",size:"small",showStatus:!0,inverse:!0});MYt(0,u,t),n.mountComponent(s,u);var c=e._a=n.insert(a,n.createComponent("msg-parsed-text",ii,t),"title"),p=c.componentModel.input;e._c=n.insert(p,n.text(n.get(t.props.contact,"name"))),n.mountComponent(c,n.propsSet(c,{slot:"title"}));var l=e._e=n.insert(a,n.createComponent("msg-online-label",ay,t),"comment"),m=e._f=n.propsSet(l,{slot:"comment"});AYt(0,m,t),n.mountComponent(l,m);var d=e._g=n.insert(a,n.createComponent("msg-save-image-button",QWt,t),"controls"),_=d.componentModel.input,f=e._h=n.propsSet(d,{slot:"controls"});TYt(0,f,0,e);var g=e._i=n.insert(_,n.createComponent("msg-button",fe,t),""),v=g.componentModel.input,h=e._k=n.insert(v,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(h,n.propsSet(h,{icon:"download",size:"medium"})),n.mountComponent(g,n.propsSet(g,{role:"inverted",shape:"circle"})),n.mountComponent(d,f),e._o=n.mountBlock(t,a,OYt),n.mountComponent(r,i),wYt(),n.subscribeStore(t,["l10n"]),DYt}function DYt(t,e){var o=e._4,r=e._5,a=e._8,i=e._9,s=e._e,u=e._f,c=e._g,p=e._h;SYt(),EYt(t,e),xYt(0,r,t,e),MYt(0,i,t),n.updateComponent(a,i),bYt[0]|=n.updateText(e._c,n.get(t.props.contact,"name")),n.updateIncomingSlot(e._a,"",bYt[0]),AYt(0,u,t),n.updateComponent(s,u),TYt(0,p,0,e),n.updateComponent(c,p),n.updateBlock(e._o),n.updateIncomingSlot(o,"controls",bYt[1]),n.updateComponent(o,r),wYt()}RYt.dispose=function(t){t._t=n.removeEvent("click",t._t),t._u=n.unmountComponent(t._u),t._r=n.unmountComponent(t._r),t._s=null,bYt[1]=1},zYt.dispose=function(t){SYt(),t._6=n.removeEvent("next",t._6),t._7=n.removeEvent("previous",t._7),t._8=n.unmountComponent(t._8),t._a=n.unmountComponent(t._a),t._e=n.unmountComponent(t._e),t._k=n.unmountComponent(t._k),t._i=n.unmountComponent(t._i),t._g=n.unmountComponent(t._g),t._o=n.unmountBlock(t._o),t._4=n.unmountComponent(t._4),wYt()};var UYt={__proto__:null,cssScope:"e9ct9z2",default:zYt,state:function(){return{url:"",index:-1,contactId:null}},didChange:function(t,e){var o,r,a,i,s=e.contact;return n.__awaiter(this,void 0,void 0,(function(){var e,u,c,p;return n.__generator(this,(function(n){switch(n.label){case 0:if(!s||!s.current)return[3,6];if(e=(null===(o=s.current.photos)||void 0===o?void 0:o.total)!==(null===(a=null===(r=s.prev)||void 0===r?void 0:r.photos)||void 0===a?void 0:a.total),u=t.state.contactId!==s.current.id,e&&(c=t.store.get().contacts.get(s.current.id).photos,(null===(i=null==c?void 0:c.urls)||void 0===i?void 0:i.length)||Zt(t,"close")),!u)return[3,6];if(t.setState({contactId:s.current.id,index:-1}),!u)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t.store.app.contacts.loadPhotos(s.current.id)];case 2:return n.sent(),[3,4];case 3:return n.sent(),console.log("error network, but optimistic is ok"),[3,4];case 4:if(!qS(t))return[2];n.label=5;case 5:c=t.store.get().contacts.get(s.current.id).photos,p=Tn(t.state.index||0,0,(null==c?void 0:c.urls)?c.urls.length:0),t.setState({index:p}),n.label=6;case 6:return[2]}}))}))}},NYt="e-nx4pzk";function qYt(t,e){e.chat=t.props.chatId?n.get(t.store.data.chats,t.props.chatId):null,e.contact=t.props.contactId?n.get(t.store.data.contacts,t.props.contactId):null}function HYt(t,e,n,o){e.chat=o.chat}function FYt(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-chat-icon",aYt,t)),a=o._9=n.propsSet(r);return HYt(0,a,0,o),n.mountComponent(r,a),VYt}function VYt(t,e){var o=e._8,r=e._9;HYt(0,r,0,e),n.updateComponent(o,r)}function KYt(t,e,n,o){e.contact=o.contact}function WYt(t,e,o){var r=o._c=n.insert(e,n.createComponent("msg-contact-avatar",UYt,t)),a=o._d=n.propsSet(r);return KYt(0,a,0,o),n.mountComponent(r,a),GYt}function GYt(t,e){var o=e._c,r=e._d;KYt(0,r,0,e),n.updateComponent(o,r)}function YYt(t,e,n,o){e.chat=o.chat,e.sectionId=n.props.sectionId}function XYt(t,e,o){var r=o._g=n.insert(e,n.createComponent("msg-chat-media",GGt,t)),a=o._h=n.propsSet(r,{reverse:!0});return YYt(0,a,t,o),n.mountComponent(r,a),QYt}function QYt(t,e){var o=e._g,r=e._h;YYt(0,r,t,e),n.updateComponent(o,r)}function JYt(t,e,n,o){e.src=n.props.src,e.chat=o.chat,e.messageId=n.props.messageId}function $Yt(t,e,o){var r=o._k=n.insert(e,n.createComponent("msg-photo-viewer",kYt,t)),a=o._l=n.propsSet(r);return JYt(0,a,t,o),n.mountComponent(r,a),ZYt}function ZYt(t,e){var o=e._k,r=e._l;JYt(0,r,t,e),n.updateComponent(o,r)}function tXt(t){return"chat-icon"===t.props.type?FYt:"contact"===t.props.type?WYt:"chat-media"===t.props.type?XYt:"image"===t.props.type?$Yt:null}function eXt(t,e){var o=t.componentView,r=n.createInjector(o);qYt(t,e);var a=n.insert(r,n.elem("div",NYt));return n.setClass(a,"bg-okmsg"),e._5=n.mountBlock(t,r,tXt),n.subscribeStore(t,["chats","contacts"]),nXt}function nXt(t,e){qYt(t,e),n.updateBlock(e._5)}FYt.dispose=function(t){t._8=n.unmountComponent(t._8),t._9=null},WYt.dispose=function(t){t._c=n.unmountComponent(t._c),t._d=null},XYt.dispose=function(t){t._g=n.unmountComponent(t._g),t._h=null},$Yt.dispose=function(t){t._k=n.unmountComponent(t._k),t._l=null},eXt.dispose=function(t){t._5=n.clearBlock(t._5)};var oXt={__proto__:null,cssScope:NYt,default:eXt};var rXt="e-qhzu5t";function aXt(t,e,n){e.icon=n.props.icon,e.size=n.props.size}function iXt(t,e,o){return o._a=n.insert(e,n.text(t.props.text),""),sXt}function sXt(t,e){n.updateText(e._a,t.props.text)}function uXt(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=e._3=n.insert(a,n.createComponent("msg-icon",xe,t),""),s=e._4=n.propsSet(i);aXt(0,s,t),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{shape:"circle"}));var u=n.appendChild(o,n.elem("div",rXt));return n.setClass(u,"text-okmsg"),n.appendChild(u,n.createSlot(t,"",rXt)),e._b=n.mountSlot(t,"",iXt),cXt}function cXt(t,e){var o=e._3,r=e._4;aXt(0,r,t),n.updateComponent(o,r),n.updateDefaultSlot(e._b)}iXt.dispose=function(t){t._a=null},uXt.dispose=function(t){t._3=n.unmountComponent(t._3),t._1=n.unmountComponent(t._1),t._b=n.unmountSlot(t._b)};var pXt={__proto__:null,cssScope:rXt,default:uXt,props:function(){return{icon:null,text:null,size:"medium"}}};var lXt="eltyd6h",mXt=[0],dXt=[];function _Xt(){dXt.push(mXt),mXt=[0]}function fXt(){mXt=dXt.pop()}function gXt(t,e,n){e.user=n.props.user,e.size=n.props.avatarSize}function vXt(t,e,o){e.official=n.get(o.props.user,"official"),e.highlights=o.props.highlights,e.bot=jt(0,n.get(o.props.user,"options"),"BOT")}function hXt(t,e){var o=t.componentView;_Xt();var r=e._1=n.appendChild(o,n.createComponent("msg-user-card",Nh,t)),a=e._2=n.propsSet(r);gXt(0,a,t),n.mountComponent(r,a);var i=n.appendChild(o,n.elem("span",lXt));n.setClass(i,"name-okmsg");var s=e._4=n.appendChild(i,n.createComponent("msg-name",Sh,t)),u=s.componentModel.input,c=e._5=n.propsSet(s);return vXt(0,c,t),e._6=n.insert(u,n.text(n.get(t.props.user,"name"))),n.mountComponent(s,c),fXt(),CXt}function CXt(t,e){var o=e._1,r=e._2,a=e._4,i=e._5;_Xt(),gXt(0,r,t),n.updateComponent(o,r),vXt(0,i,t),mXt[0]|=n.updateText(e._6,n.get(t.props.user,"name")),n.updateIncomingSlot(a,"",mXt[0]),n.updateComponent(a,i),fXt()}hXt.dispose=function(t){_Xt(),t._1=n.unmountComponent(t._1),t._4=n.unmountComponent(t._4),fXt()};var kXt={__proto__:null,cssScope:lXt,default:hXt,props:function(){return{user:null,highlights:null,selected:!1,disabled:!1,avatarSize:"medium"}}},bXt=[Ltt];var yXt={getItems:function(){return p(this.props.items).sort(_Ht)},updateList:function(t){var e=t.filter((function(t){return!t.deleted})),n=[];if(!this.query.isEmpty){var o=this.query.scoringSort(e,(function(t){return t.name+" "+Wn(t.link||"")}));e=o.sortedList,n=o.matchList}this.setState({highlights:n}),this._list.update(e,this.refs.scroller)}};function SXt(t,e){e.activate(t)}function wXt(t,e){e.deactivate(t)}var EXt="e-ws595v",xXt=[0],IXt=[];function BXt(){IXt.push(xXt),xXt=[0]}function MXt(){xXt=IXt.pop()}function AXt(t,e){e.value=void 0}function TXt(t,e,n){e.query=n.state.query,e.tokens=n.state.tokens,e.headerPlaceholder=n.props.headerPlaceholder,e.autofocus=n.props.autofocus}function jXt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function PXt(t){Zt(t,"new-contact-enter")}function RXt(t,e){t.setState({active:null})}function LXt(t,e,o){var r=o._b=n.insert(e,n.createComponent("msg-add-stub",pXt,t)),a=r.componentModel.input;o._d=n.addEvent(r,"click",PXt,t,o),o._e=n.addEvent(r,"mouseenter",RXt,t,o);var i=o._f=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"new-contact"})),n.mountComponent(r,n.propsSet(r,{icon:"add",size:"large"})),xXt[0]=1}function OXt(t){return t.props.addContact?LXt:null}function zXt(t){return n.get(t.state.scrollList,"items")}function DXt(t,e){return n.get(e.value,"value","id")}function UXt(t,e,o,r){e.user=n.get(r.value,"value"),e.avatarSize=o.props.avatarSize,e.highlights=o.state.highlights,e["data-picker-item"]=n.get(r.value,"value","id"),e.class=o.state.active==n.get(r.value,"value","id")?"active-okmsg":""}function NXt(t,e,o,r){SXt(n.get(r.value,"value","id"),t)}function qXt(t,e,o,r){wXt(n.get(r.value,"value","id"),t)}function HXt(t,e,o){var r=o._m=n.insert(e,n.createComponent("msg-contact-picker-item",kXt,t)),a=o._n=n.propsSet(r);return UXt(0,a,t,o),o._o=n.addEvent(r,"mouseenter",NXt,t,o),o._p=n.addEvent(r,"mouseleave",qXt,t,o),n.mountComponent(r,a),xXt[0]=1,FXt}function FXt(t,e){var o=e._m,r=e._n;UXt(0,r,t,e),n.updateComponent(o,r)}function VXt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px;")}function KXt(t,e){var o=t.componentView;BXt(),AXt(0,e);var r=e._3=n.appendChild(o,n.createComponent("msg-picker",ftt,t)),a=r.componentModel.input;n.setRef(t,"basePicker",r);var i=e._4=n.propsSet(r);TXt(0,i,t);var s=n.insert(a,n.elem("div",EXt),""),u=n.createInjector(s);return n.setRef(t,"scroller",s),n.setClass(s,"scroller-okmsg custom-scrollbar-okmsg"),jXt(e._6=n.insert(u,n.elem("div",EXt)),e._7=n.obj(),t),e._8=n.mountBlock(t,u,OXt),e._j=n.mountKeyIterator(t,u,zXt,DXt,HXt),VXt(e._q=n.insert(u,n.elem("div",EXt)),e._r=n.obj(),t),n.mountComponent(r,i),MXt(),WXt}function WXt(t,e){var o=e._3,r=e._4;BXt(),AXt(0,e),TXt(0,r,t),jXt(e._6,e._7,t),n.updateBlock(e._8),n.updateKeyIterator(e._j),VXt(e._q,e._r,t),n.updateIncomingSlot(o,"",xXt[0]),n.updateComponent(o,r),MXt()}LXt.dispose=function(t){t._d=n.removeEvent("click",t._d),t._e=n.removeEvent("mouseenter",t._e),t._f=n.unmountComponent(t._f),t._b=n.unmountComponent(t._b),xXt[0]=1},HXt.dispose=function(t){t._o=n.removeEvent("mouseenter",t._o),t._p=n.removeEvent("mouseleave",t._p),t._m=n.unmountComponent(t._m),t._n=null,xXt[0]=1},KXt.dispose=function(t){BXt(),t._8=n.unmountBlock(t._8),t._j=n.unmountKeyIterator(t._j),t._3=n.unmountComponent(t._3),MXt()};var GXt={__proto__:null,cssScope:EXt,default:KXt,plugins:bXt,props:function(){return{items:null,headerPlaceholder:null,avatarSize:"medium",autofocus:!1,addContact:!0}},state:function(t){return{listOptions:{itemHeight:62,initialItems:25,batchSize:10,onUpdate:function(e){return t.setState({scrollList:e})}}}},methods:yXt,onActivate:SXt,onDeactivate:wXt};var YXt="e-nrh23f",XXt=[0],QXt=[];function JXt(){QXt.push(XXt),XXt=[0]}function $Xt(){XXt=QXt.pop()}function ZXt(t,e,n){e.items=n.props.contacts,e.avatarSize=n.props.avatarSize,e.headerPlaceholder=n.store.data.l10n("contact-picker-placeholder"),e.addContact=n.props.addContact}function tQt(t,e){var o=t.componentView;JXt();var r=e._1=n.appendChild(o,n.createComponent("msg-info-sheet",Oet,t)),a=r.componentModel.input,i=n.insert(a,n.elem("div",YXt),"title");n.setAttribute(i,"slot","title"),e._4=n.appendChild(i,n.text(t.props.headerTitle));var s=e._5=n.insert(a,n.createComponent("msg-contact-picker",GXt,t),""),u=e._6=n.propsSet(s,{autofocus:!0});return ZXt(0,u,t),n.mountComponent(s,u),n.mountComponent(r,n.propsSet(r,{toolbar:!0})),$Xt(),n.subscribeStore(t,["l10n"]),eQt}function eQt(t,e){var o=e._5,r=e._6;JXt(),XXt[0]|=n.updateText(e._4,t.props.headerTitle),ZXt(0,r,t),n.updateComponent(o,r),n.updateIncomingSlot(e._1,"title",XXt[0]),$Xt()}tQt.dispose=function(t){JXt(),t._5=n.unmountComponent(t._5),t._1=n.unmountComponent(t._1),$Xt()};var nQt={__proto__:null,cssScope:YXt,default:tQt,props:function(){return{contacts:null,avatarSize:"medium",addContact:!1,headerTitle:null}}},oQt=3e3;function rQt(t,e){void 0===e&&(e={}),"string"==typeof e&&(e={type:e});var n=e.type;if("PHOTO"===e.type&&/^video\//.test(t.type)&&(n="VIDEO"),"PHOTO"===n||/^image\//.test(t.type))return aQt(t,e);if("VIDEO"===n||/^video\//.test(t.type))return iQt(t,e);if("application/octet-stream"===t.type){if(/\.(png|gif|jpe?g|webp)$/i.test(t.name))return aQt(t,e);if(/\.(avi|mov|mp4|webm)$/i.test(t.name))return iQt(t,e)}return Promise.resolve()}function aQt(t,e){return Promise.race([sQt(),new Promise((function(n){var o=new Image;o.onload=o.onerror=function(){var r;o.naturalWidth&&o.naturalHeight&&(r={width:o.naturalWidth,height:o.naturalHeight},e.keepResource&&(r.elem=o,r.dispose=function(){t.objectUrl||URL.revokeObjectURL(r.elem.src),r.elem=null})),o.onload=o.onerror=null,t.objectUrl||e.keepResource||URL.revokeObjectURL(o.src),n(r)},o.src=t.objectUrl||URL.createObjectURL(t)}))])}function iQt(t,e){return Promise.race([sQt(),new Promise((function(n){var o=document.createElement("video");o.autoplay=!1,o.preload="metadata";var r=function(){var a;o.videoWidth&&o.videoHeight&&(a={width:o.videoWidth,height:o.videoHeight},e.keepResource&&(a.elem=o,a.dispose=function(){a.elem=null,t.objectUrl||URL.revokeObjectURL(a.elem.src)})),o.removeEventListener("loadedmetadata",r),o.removeEventListener("loadeddata",r),o.removeEventListener("error",r),t.objectUrl||e.keepResource||URL.revokeObjectURL(o.src),n(a)};o.addEventListener("loadedmetadata",r),o.addEventListener("loadeddata",r),o.addEventListener("error",r),o.src=t.objectUrl||URL.createObjectURL(t)}))])}function sQt(t){return void 0===t&&(t=oQt),new Promise((function(e){return setTimeout(e,t)}))}var uQt={width:0,height:0,fit:"contain"};function cQt(t,e){return rQt(t,{type:e.type,keepResource:!0}).then((function(t){return"VIDEO"===e.type&&t?(n=t.elem,n.readyState>=2?Promise.resolve():new Promise((function(t,e){var o=setTimeout((function(){n.removeEventListener("loadeddata",r),e()}),1e3),r=function(){n.readyState>=2&&(n.removeEventListener("loadeddata",r),clearTimeout(o),t())};n.addEventListener("loadeddata",r),n.preload="auto"}))).then((function(){return t})):t;var n})).then((function(t){if(!t)return null;var n=function(t,e){e=Object.assign({},uQt,e);var n=t.width,o=t.height,r={};if(e.width&&e.height){var a=e.width/n,i=e.height/o,s="cover"===e.fit?Math.max(a,i):Math.min(a,i);r.dw=Math.ceil(n*s),r.dh=Math.ceil(o*s),r.width=e.width,r.height=e.height}else e.width?(r.width=r.dw=e.width,r.height=r.dh=Math.ceil(o*(e.width/n))):e.height?(r.height=r.dh=e.height,r.width=r.dw=Math.ceil(n*(e.height/o))):(r.width=r.dw=n,r.height=r.dh=o);return r.dx=Math.round((r.width-r.dw)/2),r.dy=Math.round((r.height-r.dh)/2),r}(t,e),o=document.createElement("canvas"),r=o.getContext("2d"),a=window.devicePixelRatio||1;return o.width=n.width*a,o.height=n.height*a,r.drawImage(t.elem,n.dx*a,n.dy*a,n.dw*a,n.dh*a),t.dispose(),new Promise((function(t){o.toBlob((function(e){return t({width:n.width,height:n.height,url:URL.createObjectURL(e)})}))}))}))}function pQt(t){var e=t.state.preview;e&&(URL.revokeObjectURL(e.url),t.setState({preview:null}))}var lQt="eaeb5qd";function mQt(t,e){e.ifExpr="VIDEO"===t.props.type}function dQt(t,e,n,o){e.icon=o.ifExpr?"video":"preview"}function _Qt(t,e,o){var r=o._7=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._9=n.insert(a,n.createComponent("msg-icon",xe,t),""),s=o._a=n.propsSet(i,{size:"medium"});return dQt(0,s,0,o),n.mountComponent(i,s),n.mountComponent(r,n.propsSet(r,{shape:"circle",class:"inverted-okmsg"})),fQt}function fQt(t,e){var o=e._9,r=e._a;dQt(0,r,0,e),n.updateComponent(o,r)}function gQt(t){return t.props.showIcon?_Qt:null}function vQt(t,e,o){n.updateAttribute(t,e,"src",n.get(o.state.preview,"url")),n.updateAttribute(t,e,"width",n.get(o.state.preview,"width")),n.updateAttribute(t,e,"height",n.get(o.state.preview,"height"))}function hQt(t,e,o){var r=o._g=n.insert(e,n.elem("img",lQt)),a=o._h=n.obj();return n.setAttribute(r,"alt",""),vQt(r,a,t),CQt}function CQt(t,e){vQt(e._g,e._h,t)}function kQt(t){return t.state.preview?hQt:null}function bQt(t,e){var o=t.componentView;mQt(t,e);var r=n.appendChild(o,n.elem("div",lQt)),a=n.createInjector(r);return n.setClass(r,"container-okmsg"),e._4=n.mountBlock(t,a,gQt),e._d=n.mountBlock(t,a,kQt),yQt}function yQt(t,e){mQt(t,e),n.updateBlock(e._4),n.updateBlock(e._d)}_Qt.dispose=function(t){t._9=n.unmountComponent(t._9),t._7=n.unmountComponent(t._7),t._a=null},hQt.dispose=function(t){t._h=t._g=null},bQt.dispose=function(t){t._4=n.unmountBlock(t._4),t._d=n.unmountBlock(t._d)};var SQt={__proto__:null,cssScope:lQt,default:bQt,props:function(){return{file:null,width:0,height:0,fit:"contain",type:"PHOTO",showIcon:!0}},willRender:function(t){var e,n,o=t.props,r=o.file,a={width:o.width,height:o.height,fit:o.fit,type:o.type};r?r===t._prevFile&&(e=a,n=t._prevOptions,e&&n&&Object.keys(e).every((function(t){return e[t]===n[t]})))||(t._prevFile=r,t._prevOptions=a,cQt(r,a).then((function(e){t.props.file===r?(pQt(t),t.setState({preview:e})):URL.revokeObjectURL(e.url)}))):pQt(t)},willUnmount:function(t){pQt(t),t._prevFile=t._prevOptions=null}};function wQt(t,e){var n=e.detail.text;t.setState({length:n.length}),(null==n?void 0:n.length)>t.props.maxLength?(t.setState({hasError:!0}),Zt(t,"switch-title-error",{hasError:!0})):t.state.hasError&&(t.setState({hasError:!1}),Zt(t,"switch-title-error",{hasError:!1}))}var EQt="ez9qs4y";function xQt(t,e,o){e.placeholder=o.store.data.l10n("chat-title"),e.replaceTextEmoji=!n.get(o.store.data.config,"user","NO_TEXT_EMOJI")}function IQt(t,e,o){n.updateClass(t,e,"additional-info-okmsg"+(o.state.hasError?" __error-okmsg":""))}function BQt(t,e,o){e.max=n.get(o.store.data.config,"server","max-theme-length"),e.current=o.state.length,e.threshold=o.state.showLengthThreshold}function MQt(t,e,o){var r=o._7=n.insert(e,n.elem("div",EQt));IQt(r,o._8=n.obj(),t);var a=o._9=n.appendChild(r,n.createComponent("msg-l10n",ae,t));n.mountComponent(a,n.propsSet(a,{class:"additional-info-tx-okmsg",key:"chat-theme-too-long"}));var i=o._b=n.appendChild(r,n.createComponent("msg-counter",mJ,t)),s=o._c=n.propsSet(i);return BQt(0,s,t),n.mountComponent(i,s),AQt}function AQt(t,e){var o=e._b,r=e._c;IQt(e._7,e._8,t),BQt(0,r,t),n.updateComponent(o,r)}function TQt(t){return t.state.length>t.state.showLengthThreshold?MQt:null}function jQt(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.insert(r,n.createComponent("msg-input",a$,t));n.setRef(t,"title",a);var i=e._2=n.propsSet(a,{name:"title",multiline:!0,"data-tsid":"chat-theme"});return xQt(0,i,t),e._3=n.addEvent(a,"update",wQt,t,e),n.mountComponent(a,i),e._4=n.mountBlock(t,r,TQt),n.subscribeStore(t,["l10n","config"]),PQt}function PQt(t,e){var o=e._1,r=e._2;xQt(0,r,t),n.updateComponent(o,r),n.updateBlock(e._4)}MQt.dispose=function(t){t._9=n.unmountComponent(t._9),t._b=n.unmountComponent(t._b),t._8=t._c=t._7=null},jQt.dispose=function(t){t._3=n.removeEvent("update",t._3),t._1=n.unmountComponent(t._1),t._4=n.clearBlock(t._4)};var RQt={__proto__:null,cssScope:EQt,default:jQt,state:function(){return{hasError:!1,length:0,showLengthThreshold:1}},willMount:function(t){t.setState({showLengthThreshold:.9*t.props.maxLength})},props:function(){return{maxLength:0}},onChange:wQt};function LQt(t,e){var n=Number(e.detail),o=t.state.selected;n&&!o.includes(n)&&t.setState({selected:o.concat(n)})}function OQt(t,e){var n=Number(e.detail),o=t.state.selected;n&&o.includes(n)&&t.setState({selected:o.filter((function(t){return t!==n}))})}function zQt(t){var e=t.state,n=e.selected;te(t,"submit",{selected:n,theme:e.theme}),0===n.length?UQt("submit-empty"):1===n.length?UQt("submit-dialog"):UQt("submit-multiple")}function DQt(t,e){var n=t.state.selected,o=n.length,r=1===o&&Number(t.props.withId)===n[0];if(o&&!r){var a=t.store;L(t,"confirm").show({header:a.l10n("chat-creation"),body:a.l10n("chat-creation-text"),buttons:[{label:a.l10n("quit"),action:function(){te(t,"cancel"),UQt("cancel-confirm")}},{label:a.l10n("cancel")}]})}else te(t,"cancel"),UQt("cancel");e.stopPropagation()}function UQt(t){OK.logger.success("messagesLayer","tt-new-chat",t)}function NQt(t,e){var o=e.target,r=o.files&&o.files[0];if(r&&/^image\//.test(r.type)){e.preventDefault();var a=t.refs.avatarInput;Zt(t,"preview-photo",{file:r,options:{crop:{square:!0},horizontalFlip:!0,rotate:!0,actionRequired:!1,action:function(e){var o=t.store,r=o.get().newChat||{invited:[]};o.set({newChat:n.__assign(n.__assign({},r),{icon:e.file})})},onClose:function(){a.value=""}}})}}function qQt(t,e){e.stopPropagation()}var HQt="e-q79jzf",FQt=[0,0,0,0],VQt=[];function KQt(){VQt.push(FQt),FQt=[0,0,0,0]}function WQt(){FQt=VQt.pop()}function GQt(t,e,o){var r=o._6=n.insert(e,n.createComponent("button",fe,t),"controls"),a=r.componentModel.input;o._8=n.addEvent(r,"click",DQt,t,o);var i=o._9=n.insert(a,n.createComponent("msg-icon",xe,t),"");n.mountComponent(i,n.propsSet(i,{icon:"back"})),n.mountComponent(r,n.propsSet(r,{slot:"controls",shape:"circle",class:"secondary-okmsg"})),FQt[0]=1}function YQt(t,e,o){var r=o._e=n.insert(e,n.createComponent("button",fe,t),"controls"),a=r.componentModel.input;o._g=n.addEvent(r,"click",DQt,t,o);var i=o._h=n.insert(a,n.createComponent("msg-tico",rc,t),""),s=i.componentModel.input,u=o._j=n.insert(s,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(u,n.propsSet(u,{key:"back"})),n.mountComponent(i,n.propsSet(i,{icon:"back",size:"medium"})),n.mountComponent(r,n.propsSet(r,{slot:"controls",class:"back-okmsg",shape:"square"})),FQt[0]=1}function XQt(t){return t.store.data.isMobile?GQt:YQt}function QQt(t,e,o){e.file=n.get(o.store.data.newChat,"icon")}function JQt(t,e,o){var r=o._11=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{class:"new-chat-details-avatar_edit-ic-okmsg",icon:"edit"}));var a=o._13=n.insert(e,n.createComponent("msg-preview-media",SQt,t)),i=o._14=n.propsSet(a,{width:64,height:64,fit:"cover",showIcon:!1,"data-tsid":"avatar_preview"});return QQt(0,i,t),n.mountComponent(a,i),$Qt}function $Qt(t,e){var o=e._13,r=e._14;QQt(0,r,t),n.updateComponent(o,r)}function ZQt(t){return n.get(t.store.data.newChat,"icon")?JQt:null}function tJt(t,e,o){var r=n.insert(e,n.elem("div",HQt));n.setClass(r,"new-chat-details-avatar_placeholder-okmsg");var a=o._1a=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{class:"new-chat-details-avatar_placeholder_icon-okmsg",icon:"photo-add",size:"large"}))}function eJt(t){return n.get(t.store.data.newChat,"icon")?null:tJt}function nJt(t,e,o){var r=n.insert(e,n.elem("label",HQt)),a=n.createInjector(r);n.setClass(r,"new-chat-details-avatar-okmsg"),o._y=n.mountBlock(t,a,ZQt),o._16=n.mountBlock(t,a,eJt);var i=o._1c=n.insert(a,n.elem("input",HQt));return n.setPendingRef(o._1,"avatarInput",i),n.setAttribute(i,"type","file"),n.setAttribute(i,"accept","image/png, image/jpeg"),n.setAttribute(i,"data-tsid","avatar_input"),o._1d=n.addEvent(i,"change",NQt,t,o),o._1e=n.addEvent(i,"cancel",qQt,t,o),oJt}function oJt(t,e){n.updateBlock(e._y),n.updateBlock(e._16),n.setPendingRef(e._1,"avatarInput",e._1c)}function rJt(t){Zt(t,"pick-new-chat-icon")}function aJt(t,e,o){e.url=n.get(o.store.data.newChat,"icon","url"),e.cropInfo=n.get(o.store.data.newChat,"icon")}function iJt(t,e,o){var r=o._1m=n.insert(e,n.createComponent("msg-icon",xe,t));n.mountComponent(r,n.propsSet(r,{class:"new-chat-details-avatar_edit-ic-okmsg",icon:"edit"}));var a=o._1o=n.insert(e,n.createComponent("msg-avatar",Hp,t)),i=o._1p=n.propsSet(a,{size:"normal"});return aJt(0,i,t),n.mountComponent(a,i),sJt}function sJt(t,e){var o=e._1o,r=e._1p;aJt(0,r,t),n.updateComponent(o,r)}function uJt(t){return n.get(t.store.data.newChat,"icon")?iJt:null}function cJt(t,e,o){var r=n.insert(e,n.elem("div",HQt));n.setClass(r,"new-chat-details-avatar_placeholder-okmsg");var a=o._1v=n.appendChild(r,n.createComponent("msg-icon",xe,t));n.mountComponent(a,n.propsSet(a,{class:"new-chat-details-avatar_placeholder_icon-okmsg",icon:"photo-add",size:"large"}))}function pJt(t){return n.get(t.store.data.newChat,"icon")?null:cJt}function lJt(t,e,o){var r=n.insert(e,n.elem("div",HQt)),a=n.createInjector(r);return n.setClass(r,"new-chat-details-avatar-okmsg"),o._1i=n.addEvent(r,"click",rJt,t,o),o._1j=n.mountBlock(t,a,uJt),o._1r=n.mountBlock(t,a,pJt),mJt}function mJt(t,e){n.updateBlock(e._1j),n.updateBlock(e._1r)}function dJt(t){return t.store.data.isMobile?nJt:lJt}function _Jt(t,e,o){e.maxLength=n.get(o.store.data.config,"server","max-theme-length")}function fJt(t,e,o){var r=n.insert(e,n.elem("div",HQt)),a=n.createInjector(r);n.setClass(r,"new-chat-details-okmsg"),o._u=n.mountBlock(t,a,dJt);var i=o._1y=n.insert(a,n.createComponent("msg-new-chat-input",RQt,t)),s=o._1z=n.propsSet(i);return _Jt(0,s,t),n.mountComponent(i,s),gJt}function gJt(t,e){var o=e._1y,r=e._1z;n.updateBlock(e._u),_Jt(0,r,t),n.updateComponent(o,r)}function vJt(t){return n.get(t.store.data.config,"server","new-chat-info")?fJt:null}function hJt(t,e,n){e.users=n.state.users,e.selected=n.state.selected,e.autofocus=n.props.autofocus}function CJt(t,e,n){e.disabled=n.state.hasError}function kJt(t,e){var o=t.componentView;KQt();var r=n.createInjector(o),a=e._1=n.obj(),i=e._2=n.insert(r,n.createComponent("msg-toolbar",qk,t)),s=i.componentModel.input;e._3=n.mountBlock(t,s,XQt);var u=n.insert(s,n.elem("h2",HQt),"");n.setAttribute(u,"data-tsid","header_block"),e._p=n.appendChild(u,n.text(t.store.data.l10n("create-new-chat",{type:"CHAT"}))),n.mountComponent(i),e._q=n.mountBlock(t,r,vJt);var c=e._21=n.insert(r,n.createComponent("msg-user-picker",gat,t)),p=e._22=n.propsSet(c,{label:!0,multiple:!0,avatarSize:"small","data-l":"t,user-picker"});hJt(0,p,t),e._23=n.addEvent(c,"select-item",LQt,t,e),e._24=n.addEvent(c,"unselect-item",OQt,t,e),e._25=n.addEvent(c,"submit-items",zQt,t,e),n.mountComponent(c,p);var l=n.insert(r,n.elem("footer",HQt)),m=e._27=n.appendChild(l,n.createComponent("button",fe,t)),d=m.componentModel.input,_=e._28=n.propsSet(m,{class:"primary-okmsg","data-tsid":"finish_create_chat_button"});CJt(0,_,t),e._29=n.addEvent(m,"click",zQt,t,e),e._2a=n.insert(d,n.text(t.store.data.l10n(Tt(0,t.state.selected)?"create-chat":"create-empty-chat",{type:"CHAT"}))),n.mountComponent(m,_);var f=e._2c=n.appendChild(l,n.createComponent("button",fe,t)),g=f.componentModel.input;return e._2e=n.addEvent(f,"click",DQt,t,e),e._2f=n.insert(g,n.text(t.store.data.l10n("cancel"))),n.mountComponent(f,n.propsSet(f,{class:"secondary-okmsg","data-tsid":"cancel-in-create-chat"})),WQt(),n.subscribeStore(t,["isMobile","l10n","newChat","config"]),n.finalizePendingRefs(t,a),bJt}function bJt(t,e){var o=e._2,r=e._21,a=e._22,i=e._27,s=e._28;KQt(),n.updateBlock(e._3),FQt[1]|=n.updateText(e._p,t.store.data.l10n("create-new-chat",{type:"CHAT"})),n.updateIncomingSlot(o,"controls",FQt[0]),n.updateIncomingSlot(o,"",FQt[1]),n.updateBlock(e._q),hJt(0,a,t),n.updateComponent(r,a),CJt(0,s,t),FQt[2]|=n.updateText(e._2a,t.store.data.l10n(Tt(0,t.state.selected)?"create-chat":"create-empty-chat",{type:"CHAT"})),n.updateIncomingSlot(i,"",FQt[2]),n.updateComponent(i,s),FQt[3]|=n.updateText(e._2f,t.store.data.l10n("cancel")),n.updateIncomingSlot(e._2c,"",FQt[3]),WQt(),n.finalizePendingRefs(t,e._1)}GQt.dispose=function(t){t._8=n.removeEvent("click",t._8),t._9=n.unmountComponent(t._9),t._6=n.unmountComponent(t._6),FQt[0]=1},YQt.dispose=function(t){t._g=n.removeEvent("click",t._g),t._j=n.unmountComponent(t._j),t._h=n.unmountComponent(t._h),t._e=n.unmountComponent(t._e),FQt[0]=1},JQt.dispose=function(t){t._11=n.unmountComponent(t._11),t._13=n.unmountComponent(t._13),t._14=null},tJt.dispose=function(t){t._1a=n.unmountComponent(t._1a)},nJt.dispose=function(t){t._y=n.unmountBlock(t._y),t._16=n.unmountBlock(t._16),t._1d=n.removeEvent("change",t._1d),t._1e=n.removeEvent("cancel",t._1e),t._1c=null},iJt.dispose=function(t){t._1m=n.unmountComponent(t._1m),t._1o=n.unmountComponent(t._1o),t._1p=null},cJt.dispose=function(t){t._1v=n.unmountComponent(t._1v)},lJt.dispose=function(t){t._1i=n.removeEvent("click",t._1i),t._1j=n.unmountBlock(t._1j),t._1r=n.unmountBlock(t._1r)},fJt.dispose=function(t){t._u=n.unmountBlock(t._u),t._1y=n.unmountComponent(t._1y),t._1z=null},kJt.dispose=function(t){KQt(),t._3=n.unmountBlock(t._3),t._2=n.unmountComponent(t._2),t._q=n.clearBlock(t._q),t._23=n.removeEvent("select-item",t._23),t._24=n.removeEvent("unselect-item",t._24),t._25=n.removeEvent("submit-items",t._25),t._21=n.unmountComponent(t._21),t._29=n.removeEvent("click",t._29),t._27=n.unmountComponent(t._27),t._2e=n.removeEvent("click",t._2e),t._2c=n.unmountComponent(t._2c),WQt()};var yJt={__proto__:null,cssScope:HQt,default:kJt,plugins:function(){return[DS({ESC:DQt})]},state:function(){return{selected:[],hasError:!1,theme:"",_sorter:m((function(t){return t.id}))}},init:function(t){L(t,"log").screen("CHAT_CREATE"),UQt("open")},events:{"switch-title-error":function(t,e){t.setState({hasError:e.detail.hasError})},update:function(t,e){t.setState({theme:e.detail.text})}},didChange:function(t,e){var n;if(e.chats||e.contacts){var o=t.props,r=o.chats,a=o.contacts,s=[],u=new i;r&&r.forEach((function(t){if("DIALOG"===t.type){var e=FS(t);e&&(u.add(e.id),s.push(e))}})),a&&a.forEach((function(t){u.has(t.id)||s.push(t)})),t.setState({users:t.state._sorter(s)})}(null===(n=e.withId)||void 0===n?void 0:n.current)&&t.setState({selected:[Number(e.withId.current)]})},willUnmount:function(t){t.store.set({newChat:{invited:[]}})},onSelectUser:LQt,onUnselectUser:OQt,onSubmit:zQt,onUpdateText:function(t,e){t.setState({theme:e.detail.text})},onCancel:DQt,onIconChange:NQt,onBack:qQt};function SJt(t){var e=t.value;if("checkbox"===t.type||"radio"===t.type||"MSG-CHECKBOX"===t.nodeName)if(e){var n=e.split("|");n.length>1?e=t.checked?n[0]:n[1]:t.checked||(e=null)}else e=t.checked;return"string"==typeof e?function(t){if("true"===t)return!0;if("false"===t)return!1;if(t){var e=Number(t);if(!isNaN(e))return e}return t}(e):e}function wJt(t,e){"change"!==e.type&&"update"!==e.type||(e.stopPropagation(),IJt(t,e.target.name,SJt(e.target)))}var EJt={change:wJt,update:wJt};function xJt(t,e){void 0===e&&(e=t.props.config);var n=e&&e.user&&e.user.DONT_DISTURB_UNTIL||0;t.setState({allowNotifications:u(n),browserNotifEnabled:aDt(e.user.UI_NOTIFICATIONS,e.server["browser-notif-fix"]),soundEnabled:iDt(e.user.PUSH_SOUND)})}function IJt(t,e,n){if("UI_NOTIFICATIONS"===e&&TJt()&&"granted"!==Notification.permission){var o=function(o){if(BJt(t),"granted"===o)IJt(t,e,n);else{var r=t.refs[e];r&&(r.checked=!1)}},r=Notification.requestPermission(o);r&&r.then&&r.then(o)}else/^app\./.test(e)?Zt(t,"update-app-config",{name:e.slice(4),value:n}):e&&Zt(t,"update-user-settings",{name:e,value:n})}function BJt(t){TJt()&&t.setState({notificationPermission:Notification.permission})}function MJt(t){Zt(t,"open-feedback-layer")}function AJt(){Qp("/")}function TJt(){return"undefined"!=typeof Notification}var jJt="e-n0xvw7",PJt=[0,0,0],RJt=[];function LJt(){RJt.push(PJt),PJt=[0,0,0]}function OJt(){PJt=RJt.pop()}function zJt(t,e){e.uiNotifications=t.state.allowNotifications&&"granted"===t.state.notificationPermission&&t.state.browserNotifEnabled,e.detailsDisabled=!e.uiNotifications&&!n.get(t.props.config,"user","GROWL")}function DJt(t,e,o,r){e.checked=n.get(o.props.config,"user","PUSH_DETAILS")&&!r.detailsDisabled,e.disabled=r.detailsDisabled,e["data-tsid"]=n.get(o.props.config,"user","PUSH_DETAILS")&&!r.detailsDisabled?"text-on":"text-off"}function UJt(t,e,n,o){e.checked=o.uiNotifications,e.disabled="denied"===n.state.notificationPermission}function NJt(t,e,o){var r=n.insert(e,n.elem("div",jJt));n.setClass(r,"subsection-okmsg");var a=o._s=n.appendChild(r,n.createComponent("msg-tico",rc,t)),i=a.componentModel.input,s=o._u=n.insert(i,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(s,n.propsSet(s,{key:"notifications-permissions-required"})),n.mountComponent(a,n.propsSet(a,{size:"medium",icon:"info",class:"warning-okmsg"})),PJt[0]=1}function qJt(t){return"denied"===t.state.notificationPermission?NJt:null}function HJt(t,e,o){e.checked=n.get(o.props.config,"user","GROWL"),e["data-tsid"]=n.get(o.props.config,"user","GROWL")?"growl-on":"growl-off"}function FJt(t,e,n){e.checked=n.state.allowNotifications&&n.state.soundEnabled}function VJt(t,e,o){e.checked=!n.get(o.props.config,"user","ALT_KEYBOARD")}function KJt(t,e,o){e.checked=n.get(o.props.config,"user","ALT_KEYBOARD")}function WJt(t,e){var o=t.componentView;LJt(),zJt(t,e);var r=e._4=n.appendChild(o,n.createComponent("msg-info-sheet",Oet,t)),a=r.componentModel.input,i=e._6=n.insert(a,n.createComponent("msg-l10n",ae,t),"title");n.mountComponent(i,n.propsSet(i,{slot:"title",key:"settings"}));var s=n.insert(a,n.elem("section",jJt),""),u=n.appendChild(s,n.elem("dl",jJt)),c=n.appendChild(u,n.elem("dt",jJt)),p=e._b=n.appendChild(c,n.createComponent("msg-l10n",ae,t));n.mountComponent(p,n.propsSet(p,{key:"notifications"}));var l=n.appendChild(u,n.elem("dd",jJt)),m=n.createInjector(l),d=e._e=n.insert(m,n.createComponent("msg-checkbox",hS,t)),_=d.componentModel.input;n.setRef(t,"PUSH_DETAILS",d);var f=e._f=n.propsSet(d,{shape:"square",name:"PUSH_DETAILS"});DJt(0,f,t,e);var g=e._g=n.insert(_,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(g,n.propsSet(g,{key:"notifications-preview"})),n.mountComponent(d,f);var v=e._j=n.insert(m,n.createComponent("msg-checkbox",hS,t)),h=v.componentModel.input;n.setRef(t,"UI_NOTIFICATIONS",v);var C=e._k=n.propsSet(v,{shape:"square",name:"UI_NOTIFICATIONS"});UJt(0,C,t,e);var k=e._l=n.insert(h,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(k,n.propsSet(k,{key:"display-notifications"})),n.mountComponent(v,C),e._o=n.mountBlock(t,m,qJt);var b=e._y=n.insert(m,n.createComponent("msg-checkbox",hS,t)),y=b.componentModel.input;n.setRef(t,"GfROWL",b);var S=e._z=n.propsSet(b,{shape:"square",name:"GROWL"});HJt(0,S,t);var w=e._10=n.insert(y,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(w,n.propsSet(w,{key:"show-growl"})),n.mountComponent(b,S);var E=e._13=n.insert(m,n.createComponent("msg-checkbox",hS,t)),x=E.componentModel.input;n.setRef(t,"PUSH_SOUND",E);var I=e._14=n.propsSet(E,{shape:"square",name:"PUSH_SOUND",value:"DEFAULT|_NONE_"});FJt(0,I,t);var B=e._15=n.insert(x,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(B,n.propsSet(B,{key:"sound-notifications"})),n.mountComponent(E,I);var M=n.appendChild(s,n.elem("dl",jJt)),A=n.appendChild(M,n.elem("dt",jJt)),T=e._1a=n.appendChild(A,n.createComponent("msg-l10n",ae,t));n.mountComponent(T,n.propsSet(T,{key:"text-typing"}));var j=n.appendChild(M,n.elem("dd",jJt)),P=e._1d=n.appendChild(j,n.createComponent("msg-radio",ant,t)),R=P.componentModel.input,L=e._1e=n.propsSet(P,{name:"ALT_KEYBOARD",value:"false"});VJt(0,L,t);var O=e._1f=n.insert(R,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(O,n.propsSet(O,{key:"settings-text-typing-1"})),e._1h=n.insert(R,n.text(" "));var z=n.insert(R,n.elemWithText("span","Enter",jJt),"");n.setClass(z,"emphasis-okmsg");var D=n.insert(R,n.elem("div",jJt),"");n.setClass(D,"fine-okmsg");var U=e._1k=n.appendChild(D,n.createComponent("msg-l10n",ae,t));n.mountComponent(U,n.propsSet(U,{key:"settings-text-typing-2"})),e._1m=n.appendChild(D,n.text(" "));var N=n.appendChild(D,n.elemWithText("span","Shift/Ctrl/Alt + Enter",jJt));n.setClass(N,"emphasis-okmsg"),n.mountComponent(P,L);var q=e._1p=n.appendChild(j,n.createComponent("msg-radio",ant,t)),H=q.componentModel.input,F=e._1q=n.propsSet(q,{name:"ALT_KEYBOARD",value:"true"});KJt(0,F,t);var V=e._1r=n.insert(H,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(V,n.propsSet(V,{key:"settings-text-typing-1"})),e._1t=n.insert(H,n.text(" "));var K=n.insert(H,n.elemWithText("span","Shift/Ctrl/Alt + Enter",jJt),"");n.setClass(K,"emphasis-okmsg");var W=n.insert(H,n.elem("div",jJt),"");n.setClass(W,"fine-okmsg");var G=e._1w=n.appendChild(W,n.createComponent("msg-l10n",ae,t));n.mountComponent(G,n.propsSet(G,{key:"settings-text-typing-2"})),e._1y=n.appendChild(W,n.text(" "));var Y=n.appendChild(W,n.elemWithText("span","Enter",jJt));n.setClass(Y,"emphasis-okmsg"),n.mountComponent(q,F);var X=n.insert(a,n.elem("section",jJt),"");n.setClass(X,"footer-okmsg");var Q=e._22=n.appendChild(X,n.createComponent("msg-tico",rc,t)),J=Q.componentModel.input;e._24=n.addEvent(Q,"click",MJt,t,e);var $=e._25=n.insert(J,n.createComponent("msg-l10n",ae,t),"");n.mountComponent($,n.propsSet($,{key:"support"})),n.mountComponent(Q,n.propsSet(Q,{size:"medium",icon:"help",class:"link-okmsg","data-l":"t,support"}));var Z=n.appendChild(X,n.elem("div",jJt));n.setClass(Z,"buttons-okmsg");var tt=e._29=n.appendChild(Z,n.createComponent("msg-button",fe,t)),et=tt.componentModel.input;e._2b=n.addEvent(tt,"click",AJt,t,e);var nt=e._2c=n.insert(et,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(nt,n.propsSet(nt,{key:"close"})),n.mountComponent(tt,n.propsSet(tt,{class:"secondary-okmsg",shape:"square"})),n.mountComponent(r,n.propsSet(r,{toolbar:!0,scrollable:!0})),OJt(),GJt}function GJt(t,e){var o=e._e,r=e._f,a=e._j,i=e._k,s=e._y,u=e._z,c=e._13,p=e._14,l=e._1d,m=e._1e,d=e._1p,_=e._1q;LJt(),zJt(t,e),DJt(0,r,t,e),n.updateComponent(o,r),UJt(0,i,t,e),n.updateComponent(a,i),n.updateBlock(e._o),HJt(0,u,t),n.updateComponent(s,u),FJt(0,p,t),n.updateComponent(c,p),VJt(0,m,t),PJt[1]|=n.updateText(e._1h," "),PJt[1]|=n.updateText(e._1m," "),n.updateIncomingSlot(l,"",PJt[1]),n.updateComponent(l,m),KJt(0,_,t),PJt[2]|=n.updateText(e._1t," "),PJt[2]|=n.updateText(e._1y," "),n.updateIncomingSlot(d,"",PJt[2]),n.updateComponent(d,_),n.updateIncomingSlot(e._4,"",PJt[0]),OJt()}NJt.dispose=function(t){t._u=n.unmountComponent(t._u),t._s=n.unmountComponent(t._s),PJt[0]=1},WJt.dispose=function(t){LJt(),t._6=n.unmountComponent(t._6),t._b=n.unmountComponent(t._b),t._g=n.unmountComponent(t._g),t._e=n.unmountComponent(t._e),t._l=n.unmountComponent(t._l),t._j=n.unmountComponent(t._j),t._o=n.unmountBlock(t._o),t._10=n.unmountComponent(t._10),t._y=n.unmountComponent(t._y),t._15=n.unmountComponent(t._15),t._13=n.unmountComponent(t._13),t._1a=n.unmountComponent(t._1a),t._1f=n.unmountComponent(t._1f),t._1k=n.unmountComponent(t._1k),t._1d=n.unmountComponent(t._1d),t._1r=n.unmountComponent(t._1r),t._1w=n.unmountComponent(t._1w),t._1p=n.unmountComponent(t._1p),t._24=n.removeEvent("click",t._24),t._25=n.unmountComponent(t._25),t._22=n.unmountComponent(t._22),t._2b=n.removeEvent("click",t._2b),t._2c=n.unmountComponent(t._2c),t._29=n.unmountComponent(t._29),t._4=n.unmountComponent(t._4),OJt()};var YJt,XJt={__proto__:null,cssScope:jJt,default:WJt,events:EJt,props:function(){return{config:null}},willMount:function(t){Zt(t,"log-screen","SETTINGS"),xJt(t);var e=function(){BJt(t),t._pollPermissionsTimer=setTimeout(e,3e3)};e()},willInmount:function(t){clearTimeout(t._pollPermissionsTimer)},willRender:function(t){BJt(t)},didChange:function(t,e){"config"in e&&xJt(t,e.config.current)},update:IJt,onFeedback:MJt,onClose:AJt};function QJt(t){OK.logger.success("messagesLayer","tt-upload",t)}function JJt(t){OK.logger.success("messagesLayer","tt-photo",t)}function $Jt(t){if("PHOTO"===t._type)return!0;var e="";return t.type&&(e=t.type.split("/")[0]),"image"===e||"video"===e&&!!t._photo}function ZJt(t){return t.attaches&&t.attaches.length?t.attaches.filter((function(t){return"PHOTO"===t._type})).length:0}var t$t=function(t,e){var n,o,r=this;this._controller=t,this._toast=e,this.app=t.props.app,o=(n=t).props.app.chat.getPostingService().file,ee(n,"attach-files",(function(t){var e=t.detail.files;e&&e.forEach((function(t){if(t._type)QJt("pick-ok-"+t._type);else{var e="";t.type&&(e=t.type.split("/")[0]),"video"===e&&t._photo&&(e="photo-video"),QJt("pick-file-"+(e||"unknown"))}}))})),o.on("issue-url",(function(t){return QJt("issue-url-"+(t||"").toLowerCase())})),o.on("upload-start",(function(){return QJt("upload-start")})),o.on("upload-complete",(function(){return QJt("upload-complete")})),o.on("upload-abort",(function(){return QJt("upload-abort")})),o.on("upload-retry",(function(t){return QJt("upload-retry-"+t)})),o.on("upload-error",(function(t){QJt("upload-error"),t.code&&QJt("upload-error.".concat(t.code))})),function(t){var e=t.props.app.chat.getPostingService();ee(t,"attach-button-click",(function(t){JJt("click"),t.detail&&"show"in t.detail&&JJt("click.".concat(t.detail.show?"show":"hide"))})),ee(t,"attach-menu-click",(function(t){return JJt("click.".concat(t.detail&&t.detail.menuId))})),ee(t,"attach-files",(function(t){var e=t.detail.files;if(e&&(!t.detail.type||"media"===t.detail.type)){var n=e.filter((function(t){if($Jt(t))return JJt("pick"),t._type&&JJt("pick-ok"),!0}));n.length&&(JJt("count"),t.detail.fromChatList&&JJt("count.chat-list"),t.detail.external&&JJt("count.external"),JJt("count.".concat(n.length)))}})),ee(t,"remove-attach",(function(t){var e=t.detail.file;e&&$Jt(e)&&JJt("remove")})),ee(t,"dnd-files",(function(t){var e=t.detail&&t.detail.files,n=t.detail.attachType;if(JJt("dnd"),JJt("dnd.".concat(n)),e){var o=e.filter($Jt);o.length&&("guess"!==n&&"media"!==n||JJt("dnd.photo"),JJt("dnd.".concat(n,".").concat(o.length)))}})),ee(t,"paste",(function(t){var e=t.clipboardData||window.clipboardData;if(e&&e.files){var n=e.files;if(n&&n.length){for(var o=0,r=0;r<n.length;r++)$Jt(n.item(r))&&o++;o&&JJt("paste")}}})),e.on("commit",(function(t){var e=ZJt(t);e>0&&(JJt("commit"),JJt("commit.".concat(e)))})),e.on("confirm",(function(t){var e=ZJt(t.message);e>0&&(JJt("confirm"),JJt("confirm.".concat(e)))}))}(t),ee(t,"update-posting-message",(function(t){r.update(t.detail.chatId,t.detail)})),ee(t,"commit-posting-message",(function(t){t.defaultPrevented||r.commit(t.detail.chatId,t.detail.chunks)})),ee(t,"attach-ids",(function(t){var e=t.detail,n=e.chatId,o=e.attaches;r.sendAttaches(n,o)})),ee(t,"attach-files",(function(t){var e=t.detail,n=e.chatId,o=e.files,a=e.type,i=e.autoUpload;r.attachFiles(n,o,a,i)})),ee(t,"replace-attach",(function(t){var e=t.detail,n=e.chatId,o=e.from,a=e.to,i=e.autoUpload;r.replaceAttach(n,o,a,i)})),ee(t,"remove-attach",(function(t){r.removeAttach(t.detail.chatId,t.detail.file)})),ee(t,"reset-posting-link",(function(t){r.resetLink(t.detail.chatId)})),ee(t,"reset-posting",(function(t){r.resetPosting(t.detail.chatId)})),ee(t,"select-share-preview",(function(t){r.selectShare(t.detail.chatId,t.detail.selected)})),ee(t,"remove-share-preview",(function(t){r.removeShares(t.detail.chatId)})),ee(t,"send-sticker",(function(t){r.sendSticker(t.detail)})),ee(t,"resend-sticker",(function(){r.resendSticker()})),ee(t,"set-notify-typing",(function(t){t.detail.active?r.app.chat.startTyping(t.detail.chatId,t.detail.type):r.app.chat.stopTyping(t.detail.chatId)}))};function e$t(t){switch(t){case"error.money.not.enough":return 22;case"payment.required.vip":return 33;case"payment.required.sticker":return 19;default:return null}}t$t.prototype.update=function(t,e){this.app.chat.posting(t,e)},t$t.prototype.commit=function(t,e){var n=this,o=this.app.chat.getChat(t).posting;o&&!o.forward&&this.resetSelectedMessages(t);var r=xm(o,["shares","items",0,"_type"]);!o.urls||1!==o.urls.length||o.urls[0]!==(o.text||"").trim()||xm(o,"shares.disabled")||1!==xm(o,"shares.items.length")||"PHOTO"!==r&&"VIDEO"!==r||this.app.chat.posting(t,{text:""}),this.app.chat.commitPosting(t,e).catch((function(t){if(!t||"EABORT"!==t.code&&"ECANCEL"!==t.code){var e=t.localizedMessage||V("unknown-error");n._toast.show(e)}}))},t$t.prototype.sendAttaches=function(t,e){return this.app.chat.sendAttaches(t,e)},t$t.prototype.attachFiles=function(t,e,n,o){var r=this,a={type:n,autoUpload:o};this._preprocessFiles(e).then((function(e){return r.app.chat.addFiles(t,e,a)})).catch((function(t){var e=t.message;"file-upload-max-size-error"===t.code?e=V(t.code,{name:t.file.name,maxSize:Em(t.maxSize)}):"file-upload-unsupported-types-error"===t.code&&(e=V(t.code,{extAmount:t.unsupportedTypes.length,ext:t.unsupportedTypes.map((function(t){return"."+t})).join(", ")})),console.warn(t),r._toast.show(e)}))},t$t.prototype.replaceAttach=function(t,e,n,o){this.app.chat.replaceFile(t,e,n,o)},t$t.prototype.removeAttach=function(t,e){this.app.chat.removeFile(t,e)},t$t.prototype.resetLink=function(t){this.app.chat.resetPostingLink(t)},t$t.prototype.selectShare=function(t,e){this.app.chat.selectShare(t,e)},t$t.prototype.removeShares=function(t){this.app.chat.removeShares(t)},t$t.prototype.resetSelectedMessages=function(t){this.app.chat.resetSelectedMessages(t)},t$t.prototype.sendSticker=function(t){var e=this,n=t.chatId,o=t.stickerId,r=t.friendId,a=t.stickerHash,i=t.source,s=t.height,u=t.width,c=t.stickerOrigin,p={stickerId:o,height:s,width:u,stickerOrigin:c};this.resetSelectedMessages(n),this.app.chat.sendSticker(n,p).catch((function(t){var p=e$t(t.code);if(p){var l=e,m={serviceId:p,callback:"sendStickerTTCb"};Bm(m,"friendId",r),Bm(m,"sticker",a),Bm(m,"source",i),Zt(e._controller,"open-payment-layer",m),YJt=function(){l.sendSticker({chatId:n,stickerId:o,friendId:r,stickerHash:a,source:i,height:s,width:u,stickerOrigin:c})}}}))},t$t.prototype.resendSticker=function(){YJt&&(YJt.call(),YJt=null)},t$t.prototype.chatsWithPositing=function(){var t=this.app.getState().chats,e=[];return t.forEach((function(t,n){t.posting&&e.push(n)})),e},t$t.prototype._preprocessFiles=function(t){var e=this;return Promise.all(t.map((function(t){if(t._type)return t;t.objectUrl=URL.createObjectURL(t);var n=e.app.chat.getFileType(t);return"PHOTO"===n||"VIDEO"===n?function(t,e){return rQt(t,e).then((function(e){return Object.assign(t,e)})).catch((function(e){return console.warn(e),t}))}(t,n):t})))},t$t.prototype.resetPosting=function(t){this.app.chat.resetPosting(t)};var n$t=240,o$t={"pointer:swipe":function(t,e){!("direction"in e.detail)||"left"!==e.detail.direction&&"right"!==e.detail.direction||i$t(t,e.detail.direction)}},r$t=[sr()];function a$t(t,e){var n=e.state.active;n!==t&&i$t(e,n<t?"left":"right")}function i$t(t,e){var n=t.refs.slider,o=t.state.active,r=t.props.items.length-1,a=Tn("right"===e?o-1:o+1,0,r);a>r-1&&t.store.app.congrats.getMoreStickers(t.props.contact,t.props.marker),n.style.transform="translateX(-".concat(a*n$t+n$t/2,"px)"),t.setState({active:a})}function s$t(t){return OTt(t,(function(e){return t.setVisabily(e)})),{destroy:function(){zTt(t)}}}function u$t(t,e){var n=e.state,o=n.active,r=n.loadState;if("send"!==r&&"close"!==r){var a=e.store,i=e.props,s=i.contact,u=i.items[o].stickerId;e.setState({loadState:t}),"send"===t?a.app.chat.getDialog(s).then((function(t){a.app.chat.sendSticker(t.id,{stickerId:u}).then((function(){KTt("postcard-send"),Zt(e,"close-card"),e.store.app.congrats.processCongratulation(s)})).catch((function(t){e$t(t.code)?Zt(e,"open-payment-layer"):(KTt("error-postcard-send",t),e.setState({loadState:"idle"}))}))})):e.store.app.congrats.processCongratulation(s).then((function(){return Zt(e,"close-card")})).catch((function(t){return e.setState({loadState:"idle"})}))}}var c$t="enpvwg2",p$t=[0,0],l$t=[];function m$t(){l$t.push(p$t),p$t=[0,0]}function d$t(){p$t=l$t.pop()}function _$t(t,e){e.contact=n.get(t.store.data.contacts,t.props.contact)}function f$t(t,e,o){!o._8&&function(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{class:"close-load-okmsg",size:"32",thickness:"4",spin:!0,indeterminate:!0}))}(t,e,o),n.animate(o._8,n.createAnimation("global:msg-pop-in 0.15s",c$t))}function g$t(t){return"close"===t.state.loadState?f$t:null}function v$t(t,e,o){n.updateClass(t,e,"container-okmsg"+("close"===o.state.loadState?" blured-okmsg":""))}function h$t(t,e,o,r){e.id=n.get(r.contact,"id"),e.url=n.get(r.contact,"avatarUrl"),e.caption=n.get(r.contact,"name")}function C$t(t,e,n,o){e.user=o.contact}function k$t(t,e,n){u$t("close",t)}function b$t(t){return t.props.items}function y$t(t,e){e.prev=e.index===t.state.active-1,e.next=e.index===t.state.active+1,e.active=e.index===t.state.active,e.sticker=n.get(t.store.data.stickers,n.get(e.value,"stickerId"))}function S$t(t,e,o,r){n.updateClass(t,e,"slider-item-okmsg"+(r.prev?" prev-okmsg":"")+(r.next?" next-okmsg":"")+(r.active?" active-okmsg":""))}function w$t(t,e,n,o){e.sticker=o.sticker,e.hideVideo=!o.active,e.autoplay=o.index===n.state.active}function E$t(t,e,n,o){e.stopPropagation(),a$t(o.index,t)}function x$t(t,e){p$t[1]|=n.updateText(e._1g,n.get(e.sticker,"price")||0)}function I$t(t,e,o){return o._1e?x$t(0,o):function(t,e,o){var r=o._1e=n.insert(e,n.elem("div",c$t),"");n.setClass(r,"price-okmsg"),n.setAttribute(r,"data-tsid","price");var a=n.appendChild(r,n.elem("span",c$t));n.setClass(a,"label-okmsg"),o._1g=n.appendChild(a,n.text(n.get(o.sticker,"price")||0)),n.appendChild(a,n.text(" OK")),p$t[1]=1}(0,e,o),n.animate(o._1e,n.createAnimation("global:msg-fade-in 1s",c$t)),B$t}function B$t(t,e){x$t(0,e)}function M$t(t,e){return e.prev||e.next||e.active?I$t:null}function A$t(t,e,o){y$t(t,o);var r=o._13=n.insert(e,n.elem("div",c$t));S$t(r,o._14=n.obj(),0,o);var a=o._15=n.appendChild(r,n.createComponent("msg-sticker",Uu,t)),i=a.componentModel.input,s=o._16=n.propsSet(a,{size:"parent",loop:!0});return w$t(0,s,t,o),o._17=n.mountUse(t,a,s$t),o._18=n.addEvent(a,"click",E$t,t,o),o._19=n.mountBlock(t,i,M$t),n.mountComponent(a,s),T$t}function T$t(t,e){var o=e._15,r=e._16;y$t(t,e),S$t(e._13,e._14,0,e),w$t(0,r,t,e),n.updateBlock(e._19),n.updateIncomingSlot(o,"",p$t[1]),n.updateComponent(o,r)}function j$t(t,e,o){!o._1q&&function(t,e,o){var r=o._1q=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{size:"32",spin:!0,indeterminate:!0}))}(t,e,o),n.animate(o._1q,n.createAnimation("global:msg-pop-in 0.15s",c$t))}function P$t(t,e,n){e.stopPropagation(),u$t("send",t)}function R$t(t,e,o){var r=o._1u=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input;o._1w=n.addEvent(r,"click",P$t,t,o);var i=o._1x=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"generator.mob.send.button"})),n.mountComponent(r,n.propsSet(r,{class:"primary-okmsg"}))}function L$t(t){return"send"===t.state.loadState?j$t:R$t}function O$t(t,e){var o=t.componentView;m$t();var r=n.createInjector(o);_$t(t,e),e._3=n.mountBlock(t,r,g$t);var a=e._b=n.insert(r,n.elem("div",c$t));v$t(a,e._c=n.obj(),t);var i=n.appendChild(a,n.elem("div",c$t));n.setClass(i,"header-okmsg");var s=n.appendChild(i,n.elem("div",c$t));n.setClass(s,"user-okmsg");var u=e._f=n.appendChild(s,n.createComponent("msg-avatar",Hp,t)),c=e._g=n.propsSet(u,{size:"medium"});h$t(0,c,0,e),n.mountComponent(u,c);var p=n.appendChild(s,n.elem("div",c$t));n.setClass(p,"user-info-okmsg");var l=e._i=n.appendChild(p,n.createComponent("msg-parsed-text",ii,t)),m=l.componentModel.input;e._k=n.insert(m,n.text(n.get(e.contact,"name"))),n.mountComponent(l,n.propsSet(l,{class:"name-okmsg"}));var d=e._m=n.appendChild(p,n.createComponent("msg-online-label",ay,t)),_=e._n=n.propsSet(d);C$t(0,_,0,e),n.mountComponent(d,_);var f=e._o=n.appendChild(i,n.createComponent("msg-button",fe,t)),g=f.componentModel.input;e._q=n.addEvent(f,"click",k$t,t,e);var v=e._r=n.insert(g,n.createComponent("msg-icon",xe,t),"");n.mountComponent(v,n.propsSet(v,{icon:"clear"})),n.mountComponent(f,n.propsSet(f,{class:"close-okmsg",shape:"circle"}));var h=n.appendChild(a,n.elem("div",c$t)),C=n.createInjector(h);n.setRef(t,"slider",h),n.setClass(h,"slider-okmsg"),e._v=n.mountIterator(t,C,b$t,A$t);var k=n.appendChild(a,n.elem("div",c$t)),b=n.createInjector(k);return n.setClass(k,"send-okmsg"),e._1l=n.mountBlock(t,b,L$t),d$t(),n.subscribeStore(t,["contacts","stickers"]),z$t}function z$t(t,e){var o=e._f,r=e._g,a=e._m,i=e._n;m$t(),_$t(t,e),n.updateBlock(e._3),v$t(e._b,e._c,t),h$t(0,r,0,e),n.updateComponent(o,r),p$t[0]|=n.updateText(e._k,n.get(e.contact,"name")),n.updateIncomingSlot(e._i,"",p$t[0]),C$t(0,i,0,e),n.updateComponent(a,i),n.updateIterator(e._v),n.updateBlock(e._1l),d$t()}f$t.dispose=function(t,e){n.animate(t._8,n.createAnimation("global:msg-pop-out 0.15s",c$t),(function(){return function(t){var e=t._8;t._8=n.unmountComponent(e),n.domRemove(e)}(t)}))},I$t.dispose=function(t,e){n.animate(t._1e,n.createAnimation("global:msg-fade-out 1s",c$t),(function(){m$t(),function(t){t._1e=n.domRemove(t._1e),t._1g=null,p$t[1]=1}(t),n.updateIncomingSlot(t._15,"",p$t[1]),d$t()}))},A$t.dispose=function(t){t._17=n.unmountUse(t._17),t._18=n.removeEvent("click",t._18),t._19=n.unmountBlock(t._19),t._15=n.unmountComponent(t._15),t._14=t._16=t._13=null},j$t.dispose=function(t,e){n.animate(t._1q,n.createAnimation("global:msg-pop-out 0.15s",c$t),(function(){return function(t){var e=t._1q;t._1q=n.unmountComponent(e),n.domRemove(e)}(t)}))},R$t.dispose=function(t){t._1w=n.removeEvent("click",t._1w),t._1x=n.unmountComponent(t._1x),t._1u=n.unmountComponent(t._1u)},O$t.dispose=function(t){m$t(),t._3=n.clearBlock(t._3),t._f=n.unmountComponent(t._f),t._i=n.unmountComponent(t._i),t._m=n.unmountComponent(t._m),t._q=n.removeEvent("click",t._q),t._r=n.unmountComponent(t._r),t._o=n.unmountComponent(t._o),t._v=n.unmountIterator(t._v),t._1l=n.unmountBlock(t._1l),d$t()};var D$t={__proto__:null,cssScope:c$t,default:O$t,events:o$t,plugins:r$t,state:function(){return{active:0}},onStickerClick:a$t,registerSticker:s$t,processCongratulation:u$t},U$t="e-yotg3p";function N$t(t,e){e.counter=n.get(t.props.data,"info","counter"),e.value=void 0}function q$t(t,e,o){n.updateAttribute(t,e,"src",n.get(o.props.data,"info","listBannerUrl"))}function H$t(t,e,o){var r=n.insert(e,n.elem("div",U$t));n.setClass(r,"placeholder-okmsg");var a=n.appendChild(r,n.elem("div",U$t));n.setClass(a,"placeholder_header-okmsg");var i=o._n=n.appendChild(a,n.createComponent("msg-l10n",ae,t));n.mountComponent(i,n.propsSet(i,{key:"generator.finish.title"}));var s=n.appendChild(r,n.elem("div",U$t));n.setClass(s,"placeholder_text-okmsg");var u=o._q=n.appendChild(s,n.createComponent("msg-l10n",ae,t));n.mountComponent(u,n.propsSet(u,{key:"generator.finish.text"}))}function F$t(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"before")||0)+"px;")}function V$t(t){return n.get(t.state.scrollList,"items")}function K$t(t,e){return n.get(e.value,"value","userId")}function W$t(t,e,o,r){e.contact=n.get(r.value,"value","userId"),e.items=n.get(r.value,"value","list"),e.marker=n.get(r.value,"value","marker")}function G$t(t,e,o,r){FTt(n.get(r.value,"value","userId"),t)}function Y$t(t,e){var o=e._16,r=e._17;W$t(0,r,0,e),n.updateComponent(o,r)}function X$t(t,e,o){return o._16?Y$t(0,o):function(t,e,o){var r=o._16=n.insert(e,n.createComponent("msg-congratulation-card",D$t,t)),a=o._17=n.propsSet(r);W$t(0,a,0,o),o._18=n.addEvent(r,"close-card",G$t,t,o),n.mountComponent(r,a)}(t,e,o),n.stopAnimation(o._16,!0),Q$t}function Q$t(t,e){Y$t(0,e)}function J$t(t,e,o){var r=n.insert(e,n.elem("div",U$t)),a=n.createInjector(r);return n.setClass(r,"list-okmsg"),o._11=n.mountKeyIterator(t,a,V$t,K$t,X$t),$$t}function $$t(t,e){n.updateKeyIterator(e._11)}function Z$t(t){return n.get(t.props.data,"list","list")?J$t:null}function tZt(t,e,o){n.updateAttribute(t,e,"style","height: "+(n.get(o.state.scrollList,"after")||0)+"px")}function eZt(t,e,o){var r=n.insert(e,n.elem("div",U$t)),a=n.createInjector(r);n.setClass(r,"wrapper-okmsg"),F$t(o._v=n.insert(a,n.elem("div",U$t)),o._w=n.obj(),t),o._x=n.mountBlock(t,a,Z$t);var i=o._1b=n.insert(a,n.elem("div",U$t)),s=o._1c=n.obj();return n.setClass(i,"after-okmsg"),tZt(i,s,t),nZt}function nZt(t,e){F$t(e._v,e._w,t),n.updateBlock(e._x),tZt(e._1b,e._1c,t)}function oZt(t,e){return n.get(e.counter,"processed")===n.get(e.counter,"total")?H$t:eZt}function rZt(t,e){var o=t.componentView;N$t(t,e);var r=n.appendChild(o,n.elem("div",U$t));n.setClass(r,"header-okmsg");var a=e._5=n.appendChild(r,n.createComponent("msg-button",fe,t)),i=a.componentModel.input;e._7=n.addEvent(a,"click",qTt,t,e);var s=e._8=n.insert(i,n.createComponent("msg-icon",xe,t),"");n.mountComponent(s,n.propsSet(s,{icon:"back"})),n.mountComponent(a,n.propsSet(a,{class:"hello-close-okmsg",shape:"circle","data-l":"t,close"}));var u=n.appendChild(r,n.elem("div",U$t));n.setClass(u,"header_text-okmsg"),e._c=n.appendChild(u,n.text(n.get(t.props.data,"info","listTitle")));var c=n.appendChild(o,n.elem("div",U$t)),p=n.createInjector(c);n.setRef(t,"scroller",c),n.setClass(c,"content-okmsg custom-scrollbar-okmsg"),e._e=n.addEvent(c,"scroll",HTt,t,e);var l=n.insert(p,n.elem("div",U$t));n.setClass(l,"list-header-okmsg");var m=e._g=n.appendChild(l,n.elem("img",U$t)),d=e._h=n.obj();return n.setClass(m,"image-okmsg"),n.setAttribute(m,"alt",""),q$t(m,d,t),e._i=n.mountBlock(t,p,oZt),aZt}function aZt(t,e){N$t(t,e),n.updateText(e._c,n.get(t.props.data,"info","listTitle")),q$t(e._g,e._h,t),n.updateBlock(e._i)}H$t.dispose=function(t){t._n=n.unmountComponent(t._n),t._q=n.unmountComponent(t._q)},X$t.dispose=function(t,e){var o=t._16;n.animate(o,VTt(0,e,n.get(t.value,"value","userId")),(function(){return function(t){var e=t._16;t._18=n.removeEvent("close-card",t._18),t._16=n.unmountComponent(e),n.domRemove(e),t._17=null}(t)}))},J$t.dispose=function(t){t._11=n.unmountKeyIterator(t._11)},eZt.dispose=function(t){t._x=n.unmountBlock(t._x),t._w=t._v=t._1c=t._1b=null},rZt.dispose=function(t){t._7=n.removeEvent("click",t._7),t._8=n.unmountComponent(t._8),t._5=n.unmountComponent(t._5),t._e=n.removeEvent("scroll",t._e),t._i=n.unmountBlock(t._i)};var iZt={__proto__:null,cssScope:U$t,default:rZt,register:OTt,unregister:zTt,create:DTt,destroy:UTt,init:function(t){t.setState({_list:new YL({itemHeight:289,initialItems:Math.ceil(window.innerHeight/289),maxDisplayItems:4,onUpdate:function(e){return t.setState({scrollList:e})}}),closedItems:new i}),t.store.app.congrats.getCongratsList()},plugins:function(){return[DS({ESC:qTt})]},willMount:function(t){t.props.data.list&&t.state._list.update(t.props.data.list.list)},didMount:function(t){KTt("generator-rendered"),DTt(t.refs.scroller)},didChange:function(t,e){var n=e.data,o=n.current.info.counter;n.current.list&&t.state._list.update(n.current.list.list,t.refs.scroller),o.total===o.processed&&KTt("final-screen-rendered")},onExit:qTt,handleScroll:HTt,onCloseCard:FTt,onAnimateOut:VTt,logMobGenerator:KTt};function sZt(t){Zt(t,"exit-modal")}function uZt(t,e){e.preventDefault(),Zt(t,"send-contact",{toChatIds:t.props.data.toChatIds,contactId:Number(e.detail)}),sZt(t)}function cZt(t,e){var n,o=t.store.get().config,r=e.detail.selected||[],a=e.detail.theme,i=null===(n=t.store.get().newChat)||void 0===n?void 0:n.icon,s=t.props.data,u=Boolean((null==s?void 0:s.withId)||o.server["one-participant-multichat"]);t.store.app.chat.create(r,{title:a,icon:i,createMultichat:u}).then((function(e){sZt(t),e&&$p(e.id)}))}function pZt(t){sZt(t),tl()}var lZt="ep84c7v";function mZt(t,e){e.showPanel="show-panel 0.45s cubic-bezier(0.19, 1, 0.22, 1)",e.hidePanel="hide-panel 0.2s ease-out",e.animation=t.store.data.isMobile?"show-panel-mob":"show-panel"}function dZt(t,e){t.store.data.isMobile&&n.setPendingEvent(e._b,"click",sZt,e)}function _Zt(t,e){var o=e._b;n.setPendingEvent(o,"click",pZt,e),dZt(t,e),n.finalizePendingEvents(o)}function fZt(t,e,o){return o._a?_Zt(t,o):function(t,e,o){var r=o._a=n.insert(e,n.elem("div",lZt)),a=o._b=n.pendingEvents(t,r);n.setClass(r,"overlay-okmsg"),n.setPendingEvent(a,"click",pZt,o),dZt(t,o),n.finalizePendingEvents(a)}(t,e,o),n.animate(o._a,n.createAnimation("show-overlay 0.4s",lZt)),gZt}function gZt(t,e){_Zt(t,e)}function vZt(t){return t.props.name?fZt:null}function hZt(t,e,o){e.chats=n.get(o.store.data.config,"server","dialog-priority")?o.store.data.chatList:null,e.contacts=Nt(0,o.store.data.contacts),e.withId=n.get(o.props.data,"withId"),e.autofocus=o.state.autofocus}function CZt(t,e){t.setState({autofocus:!0})}function kZt(t,e){var o=e._l,r=e._m;hZt(0,r,t),n.updateComponent(o,r)}function bZt(t,e,o){return o._l?kZt(t,o):function(t,e,o){var r=o._l=n.insert(e,n.createComponent("msg-new-chat",yJt,t)),a=o._m=n.propsSet(r,{class:"panel-okmsg",role:"dialog","aria-modal":"true"});hZt(0,a,t),o._n=n.addEvent(r,"submit",cZt,t,o),o._o=n.addEvent(r,"cancel",pZt,t,o),o._p=n.addEvent(r,"animate-end",CZt,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._l,n.createAnimation(o.showPanel,lZt)),yZt}function yZt(t,e){kZt(t,e)}function SZt(t,e,o){e.contacts=n.filter(o.store.data.contacts,(function(t){return n.get(t,"own")&&!n.get(t,"current")}))}function wZt(t,e){var o=e._u,r=e._v;SZt(0,r,t),n.updateComponent(o,r)}function EZt(t,e,o){return o._u?wZt(t,o):function(t,e,o){var r=o._u=n.insert(e,n.createComponent("msg-contacts",nQt,t)),a=r.componentModel.input,i=o._v=n.propsSet(r,{toolbar:!0,class:"panel-okmsg","data-tsid":"contacts_root"});SZt(0,i,t),o._w=n.addEvent(r,"info-sheet-close",sZt,t,o),o._x=n.addEvent(r,"select-item",uZt,t,o);var s=o._y=n.insert(a,n.createComponent("msg-l10n",ae,t),"title");n.mountComponent(s,n.propsSet(s,{key:"send-contact",slot:"title"})),n.mountComponent(r,i)}(t,e,o),n.animate(o._u,n.createAnimation(o.showPanel,lZt)),xZt}function xZt(t,e){wZt(t,e)}function IZt(t,e,n){e.config=n.store.data.config}function BZt(t,e){var o=e._15,r=e._16;IZt(0,r,t),n.updateComponent(o,r)}function MZt(t,e,o){return o._15?BZt(t,o):function(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-settings",XJt,t)),a=o._16=n.propsSet(r,{class:"panel-okmsg","data-tsid":"settings_root"});IZt(0,a,t),o._17=n.addEvent(r,"info-sheet-close",pZt,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._15,n.createAnimation(o.animation+" 0.45s cubic-bezier(0.19, 1, 0.22, 1)",lZt)),AZt}function AZt(t,e){BZt(t,e)}function TZt(t,e,n){e.data=n.store.data.congrats}function jZt(t,e){var o=e._1c,r=e._1d;TZt(0,r,t),n.updateComponent(o,r)}function PZt(t,e,o){return o._1c?jZt(t,o):function(t,e,o){var r=o._1c=n.insert(e,n.createComponent("msg-congratulation",iZt,t)),a=o._1d=n.propsSet(r,{class:"panel-okmsg"});TZt(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._1c,n.createAnimation(o.showPanel,lZt)),RZt}function RZt(t,e){jZt(t,e)}function LZt(t){return"new-chat"===t.props.name?bZt:"send-contact"===t.props.name?EZt:"view-settings"===t.props.name?MZt:"random-congrats"===t.props.name?PZt:null}function OZt(t,e){var o=t.componentView,r=n.createInjector(o);return mZt(t,e),e._5=n.mountBlock(t,r,vZt),e._g=n.mountBlock(t,r,LZt),n.subscribeStore(t,["isMobile","config","chatList","contacts","congrats"]),zZt}function zZt(t,e){mZt(t,e),n.updateBlock(e._5),n.updateBlock(e._g)}fZt.dispose=function(t,e){n.animate(t._a,n.createAnimation("hide-overlay 0.2s",lZt),(function(){return function(t){t._b=n.detachPendingEvents(t._b),t._a=n.domRemove(t._a)}(t)}))},bZt.dispose=function(t,e){n.animate(t._l,n.createAnimation(t.hidePanel,lZt),(function(){return function(t){var e=t._l;t._n=n.removeEvent("submit",t._n),t._o=n.removeEvent("cancel",t._o),t._p=n.removeEvent("animate-end",t._p),t._l=n.unmountComponent(e),n.domRemove(e),t._m=null}(t)}))},EZt.dispose=function(t,e){n.animate(t._u,n.createAnimation(t.hidePanel,lZt),(function(){return function(t){var e=t._u;t._w=n.removeEvent("info-sheet-close",t._w),t._x=n.removeEvent("select-item",t._x),t._y=n.unmountComponent(t._y),t._u=n.unmountComponent(e),n.domRemove(e),t._v=null}(t)}))},MZt.dispose=function(t,e){n.animate(t._15,n.createAnimation(t.animation+" 0.2s ease-out reverse",lZt),(function(){return function(t){var e=t._15;t._17=n.removeEvent("info-sheet-close",t._17),t._15=n.unmountComponent(e),n.domRemove(e),t._16=null}(t)}))},PZt.dispose=function(t,e){n.animate(t._1c,n.createAnimation(t.hidePanel,lZt),(function(){return function(t){var e=t._1c;t._1c=n.unmountComponent(e),n.domRemove(e),t._1d=null}(t)}))},OZt.dispose=function(t){t._5=n.clearBlock(t._5),t._g=n.clearBlock(t._g)};var DZt,UZt={__proto__:null,cssScope:lZt,default:OZt,didChange:function(t,e){e.name&&t.setState({autofocus:!1})},onClose:sZt,onSelectContactForSend:uZt,onCreateNewChat:cZt,onBack:pZt},NZt=!1,qZt=!1,HZt=!1;var FZt={focus:function(){$Zt(this)},hasModal:function(){return this.state.chatReadParticipants},showParticipants:function(t){this.setState({chatReadParticipants:t})},showAllReactions:function(t){this.setState({showAllReactions:t})},postingInsert:function(t,e){if(this.state.selectedChat){var n=this.state.selectedChat.id;switch(e){case"files":Zt(this,"attach-files",{chatId:n,files:Array.isArray(t)?t:[t],autoUpload:!0,external:!0});break;case"attaches":QZt(this).attachesSelected(t);break;default:QZt(this).insertText(t)}}},sendSticker:function(t){if(this.state.selectedChat){var e=this.state.selectedChat;if(e){var n="DIALOG"===e.type?e.participants.find((function(t){return!t.user.current})).user:{},o=t.code,r=t.stickerOrigin,a=parseInt(function(t){if(t&&0===t.indexOf("#u")){var e=/[a-fA-F0-9]+/g,n=t.match(e);return n&&n[0]}return t}(o),16);Zt(this,"send-sticker",{chatId:e.id,stickerId:a,friendId:n.id,source:"DIALOG"===e.type?"messages":"multichat",stickerOrigin:r})}}},chatAvatarSelected:function(t){Zt(this,"set-new-chat-avatar",{avatar:t})},hideCongrats:function(){QZt(this).hideCongrats()}};var VZt={"open-chat-read-participants":function(t,e){(0,t.setState)({chatReadParticipants:e.detail})},"close-chat-read-participants":function(t){(0,t.setState)({chatReadParticipants:null})},"chat-search-touch":function(t,e){"MSG-CHATS-PANEL"===e.target.nodeName&&Zt(t,"add-left-col-reason","search")},"chat-search-blur":function(t,e){"MSG-CHATS-PANEL"===e.target.nodeName&&Zt(t,"remove-left-col-reason","search")},click:function(t,e){var n=e.target.closest("a, .hashtag, .mention");if(n){if(n.classList.contains("hashtag")){e.preventDefault(),e.stopPropagation();var o=t.state.selectedChat;if(!o)return;Zt(t,"message-search",{chatId:o.id,query:n.innerText})}var r=Wn(n.href);if(n.classList.contains("mention")){e.preventDefault(),e.stopPropagation();var a=r.split("?")[0];a&&$p(a,{useBack:!0})}else if(r&&!e.defaultPrevented){if(e.preventDefault(),e.stopPropagation(),Gn(r))return void Qp("/"+r);!function(t){var e=t.replace(/^c(\d+)$/,"-$1");if(An(e)){var n=Number(e);if(n>0)return Zp(n,{useBack:!0})}$p(e,{useBack:!0})}(r)}}},"hide-boost":function(t,e){!function(t,e){var n=e.chatId,o=e.mode,r=t.state.hiddenBoost||{},a={};a[n]=o,t.setState({hiddenBoost:Object.assign({},r,a)})}(t,e.detail)},"show-assets":function(t,e){e.stopPropagation(),QZt(t).showAssets(e.detail)},dragover:function(t,e){var n=t.setState;e.preventDefault(),e.stopPropagation(),n({dndMode:!0})},dragleave:function(t,e){var n=t.setState;e.preventDefault(),e.stopPropagation(),n({dndMode:null})},drop:function(t,e){e.preventDefault(),e.stopPropagation()},transitionend:function(t,e){"MAIN"===e.target.nodeName&&"margin-right"===e.propertyName&&t.setState({animate:!1})},animationend:function(t,e){if(_r(e,"show")||_r(e,"hide")){t.setState({animate:!1});var n=QZt(t);n&&n.updateSize()}},"close-reactions-layer":function(t){(0,t.setState)({showAllReactions:null})}};function KZt(t){var e=t.state,n=e.clearChat,o=e.clearForAll;Zt(t,"clear-chat",{chatId:n.id,forAll:o||"CHANNEL"===n.type}),WZt(t)}function WZt(t){t.setState({clearChatModal:null,clearForAll:null,clearChat:null})}function GZt(t){t.refs.overlay.close()}function YZt(t,e){t.setState({clearForAll:e.target.checked})}function XZt(t){L(t,"showMedia").resetShowMedia()}function QZt(t){var e=t.refs.chat;return e&&e.refs.postingForm}function JZt(t){return t.store.get().isMobile?"mobile":"messenger"}function $Zt(t){var e=t.refs,n=e.chat,o=e.chatsPanel;n&&n.focusPostingForm()||o.focusSearchInput()}var ZZt="e-v2qcf3",t1t=[0,0],e1t=[];function n1t(){e1t.push(t1t),t1t=[0,0]}function o1t(){t1t=e1t.pop()}function r1t(t,e){e.redesign=t.state.chatReadParticipants?n.get(t.store.data.config,"server","react-permission"):void 0,e.messageId=t.state.chatReadParticipants?n.get(t.state.chatReadParticipants,"messageId"):void 0,e.message=t.state.chatReadParticipants?n.find(n.get(t.store.data.selectedChat,"messages"),(function(t){return n.get(t,"id")==e.messageId})):void 0}function a1t(t,e){var o=n.insert(e,n.elem("div",ZZt));n.setClass(o,"resize-overlay-okmsg")}function i1t(t){return t.state.resizingMode?a1t:null}function s1t(t,e,o){n.updateClass(t,e,"messenger_side-okmsg"+(Tt(0,o.store.data.asideActive)?" active-okmsg":""))}function u1t(t,e,o){e.search=o.store.data.search,e.chats=o.store.data.chatList,e.selected=n.get(o.store.data.selectedChat,"id"),e.groupIdFilter=o.props.groupIdFilter,e.next=o.store.data.chatMarker,e.loading="chats-loading"===o.store.data.state}function c1t(t,e,o){!o._k&&function(t,e,o){var r=o._k=n.insert(e,n.elem("div",ZZt),"header");n.setClass(r,"notification-okmsg"),n.setAttribute(r,"slot","header");var a=o._l=n.appendChild(r,n.createComponent("msg-connecting-indicator",tHt,t));n.mountComponent(a),t1t[0]=1}(t,e,o),n.animate(o._k,$U(o._k,{duration:300,easing:oN}))}function p1t(t){return t.state.offline?c1t:null}function l1t(t,e,o){e.additional=n.get(o.store.data.okWeb,"chatAdditional"),e.chat=o.store.data.selectedChat,e.config=o.store.data.config,e.hiddenBoost=o.state.hiddenBoost}function m1t(t,e){var o=e._t,r=e._u;n.setPendingRef(e._1,"chat",o),l1t(0,r,t),n.updateComponent(o,r)}function d1t(t,e,o){return o._t?m1t(t,o):function(t,e,o){var r=o._t=n.insert(e,n.createComponent("msg-chat",qxt,t));n.setPendingRef(o._1,"chat",r);var a=o._u=n.propsSet(r,{"aria-labelledby":"msg-chat-title"});l1t(0,a,t),n.mountComponent(r,a)}(t,e,o),n.animate(o._t,n.createAnimation(t.store.data.isSmallScreen?"slide-in 0.3s ease-out":null,ZZt)),_1t}function _1t(t,e){m1t(t,e)}function f1t(t,e,n){e.model=n.props.model}function g1t(t,e,o){var r=o._x=n.insert(e,n.createComponent("msg-onboarding",Yqt,t)),a=o._y=n.propsSet(r);return f1t(0,a,t),n.mountComponent(r,a),v1t}function v1t(t,e){var o=e._x,r=e._y;f1t(0,r,t),n.updateComponent(o,r)}function h1t(t){return t.store.data.selectedChat?d1t:t.store.data.isMobile?null:g1t}function C1t(t,e,o){!o._15&&function(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-audio-player-float",rKt,t));n.mountComponent(r)}(t,e,o),n.animate(o._15,n.createAnimation("global:dialog-show 0.2s cubic-bezier(0.2, 0.94, 0.42, 1.1) backwards",ZZt))}function k1t(t){return n.get(t.store.data.audioPlayer,"message")&&n.get(t.store.data.audioPlayer,"float")?C1t:null}function b1t(t,e,o){e.name=n.get(o.props.modalMode,"name"),e.data=n.get(o.props.modalMode,"data")}function y1t(t,e,o){e.participants=n.get(o.state.chatReadParticipants,"participants"),e.total=n.get(o.state.chatReadParticipants,"total")}function S1t(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-chat-read-participants",RHt,t)),a=o._1f=n.propsSet(r);return y1t(0,a,t),n.mountComponent(r,a),w1t}function w1t(t,e){var o=e._1e,r=e._1f;y1t(0,r,t),n.updateComponent(o,r)}function E1t(t,e){return e.redesign?null:S1t}function x1t(t,e,o,r){e.chat=o.store.data.selectedChat,e.message=r.message,e.reactionsDetailed=n.get(r.message,"reactionsDetailed"),e.participants=n.get(o.store.data.selectedChat,"participants"),e.largeChat=n.get(o.store.data.selectedChat,"participantsCount")>n.get(o.store.data.config,"server","show-rm-limits",1),e.chatId=n.get(o.state.chatReadParticipants,"chatId"),e.messageId=r.messageId,e.tab=n.get(o.state.chatReadParticipants,"tab")}function I1t(t,e,o){var r=o._1j=n.insert(e,n.createComponent("msg-message-participants",zFt,t)),a=o._1k=n.propsSet(r,{"data-l":"t,message-participants"});return x1t(0,a,t,o),n.mountComponent(r,a),B1t}function B1t(t,e){var o=e._1j,r=e._1k;x1t(0,r,t,e),n.updateComponent(o,r)}function M1t(t,e){return e.redesign?I1t:null}function A1t(t,e,o){return o._1b=n.mountBlock(t,e,E1t),o._1g=n.mountBlock(t,e,M1t),T1t}function T1t(t,e){n.updateBlock(e._1b),n.updateBlock(e._1g)}function j1t(t){return t.state.chatReadParticipants?A1t:null}function P1t(t,e,o){e.messageId=n.get(o.state.showAllReactions,"messageId"),e.chatId=n.get(o.state.showAllReactions,"chatId"),e.mine=n.get(o.state.showAllReactions,"mine")}function R1t(t,e,o){var r=o._1o=n.insert(e,n.createComponent("msg-reactions-layer",KFt,t)),a=o._1p=n.propsSet(r);return P1t(0,a,t),n.mountComponent(r,a),L1t}function L1t(t,e){var o=e._1o,r=e._1p;P1t(0,r,t),n.updateComponent(o,r)}function O1t(t){return t.state.showAllReactions?R1t:null}function z1t(t,e,o){e.type=n.get(o.store.data.showMedia,"type"),e.src=n.get(o.store.data.showMedia,"src"),e.chatId=n.get(o.store.data.showMedia,"chatId"),e.contactId=n.get(o.store.data.showMedia,"contactId"),e.messageId=n.get(o.store.data.showMedia,"messageId"),e.sectionId=n.get(o.store.data.showMedia,"sectionId")}function D1t(t,e){e.preventDefault()}function U1t(t,e){var o=e._1v,r=e._1w;z1t(0,r,t),n.updateComponent(o,r)}function N1t(t,e,o){return o._1v?U1t(t,o):function(t,e,o){var r=o._1v=n.insert(e,n.createComponent("msg-media-layer",oXt,t)),a=o._1w=n.propsSet(r);z1t(0,a,t),o._1x=n.addEvent(r,"close",XZt,t,o),o._1y=n.addEvent(r,"zoom",D1t,t,o),n.mountComponent(r,a)}(t,e,o),n.animate(o._1v,n.createAnimation("global:msg-dialog-show 0.4s cubic-bezier(0.19, 1, 0.22, 1)",ZZt)),q1t}function q1t(t,e){U1t(t,e)}function H1t(t){return t.store.data.showMedia?N1t:null}function F1t(t,e,o){e["data-type"]=n.get(o.state.clearChat,"type")}function V1t(t,e,o){e["data-type"]=n.get(o.state.clearChat,"type"),e["data-title"]=n.get(o.state.clearChat,"title")||n.get(o.state.clearChat,"placeholder")||o.store.data.l10n("empty-chat-placeholder")}function K1t(t,e,o){var r=o._2d=n.insert(e,n.createComponent("msg-checkbox",hS,t),""),a=r.componentModel.input;o._2f=n.addEvent(r,"change",YZt,t,o);var i=o._2g=n.insert(a,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(i,n.propsSet(i,{key:"clear-chat-for-all"})),n.mountComponent(r,n.propsSet(r,{shape:"square",name:"clear-for-all"})),t1t[1]=1}function W1t(t){return n.get(t.state.clearChat,"owner","current")&&"CHAT"==n.get(t.state.clearChat,"type")?K1t:null}function G1t(t,e,o){var r=o._22=n.insert(e,n.createComponent("msg-overlay",U2,t)),a=r.componentModel.input;n.setPendingRef(o._1,"overlay",r),o._24=n.addEvent(r,"close",WZt,t,o);var i=o._25=n.insert(a,n.createComponent("msg-dialog",Q2,t),""),s=i.componentModel.input,u=o._26=n.insert(s,n.createComponent("msg-l10n",ae,t),"header"),c=o._27=n.propsSet(u,{slot:"header",key:"clear-chat"});F1t(0,c,t),n.mountComponent(u,c);var p=o._28=n.insert(s,n.createComponent("msg-l10n",ae,t),""),l=o._29=n.propsSet(p,{key:"clear-chat-text"});V1t(0,l,t),n.mountComponent(p,l),o._2a=n.mountBlock(t,s,W1t);var m=o._2k=n.insert(s,n.createComponent("msg-button",fe,t),"buttons"),d=m.componentModel.input;o._2m=n.addEvent(m,"click",KZt,t,o);var _=o._2n=n.insert(d,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(_,n.propsSet(_,{key:"clear"})),n.mountComponent(m,n.propsSet(m,{class:"primary-okmsg",slot:"buttons"}));var f=o._2q=n.insert(s,n.createComponent("msg-button",fe,t),"buttons"),g=f.componentModel.input;o._2s=n.addEvent(f,"click",GZt,t,o);var v=o._2t=n.insert(g,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(v,n.propsSet(v,{key:"confirm-cancel-button"})),n.mountComponent(f,n.propsSet(f,{class:"secondary-okmsg",slot:"buttons"})),n.mountComponent(i),n.mountComponent(r,n.propsSet(r,{class:"clear-chat-okmsg"})),Y1t}function Y1t(t,e){var o=e._26,r=e._27,a=e._28,i=e._29;n.setPendingRef(e._1,"overlay",e._22),F1t(0,r,t),n.updateComponent(o,r),V1t(0,i,t),n.updateComponent(a,i),n.updateBlock(e._2a),n.updateIncomingSlot(e._25,"",t1t[1])}function X1t(t){return t.state.clearChatModal?G1t:null}function Q1t(t,e){var o=t.componentView;n1t();var r=n.createInjector(o),a=e._1=n.obj();r1t(t,e),e._6=n.mountBlock(t,r,i1t);var i=e._b=n.insert(r,n.elem("div",ZZt));n.setRef(t,"sideColumn",i);var s=e._c=n.obj();n.setAttribute(i,"data-tsid","chats_list_root"),s1t(i,s,t);var u=e._d=n.appendChild(i,n.createComponent("msg-chats-panel",mNt,t)),c=u.componentModel.input;n.setRef(t,"chatsPanel",u);var p=e._e=n.propsSet(u);u1t(0,p,t),e._f=n.mountBlock(t,c,p1t),n.mountComponent(u,p);var l=n.insert(r,n.elem("div",ZZt)),m=n.createInjector(l);n.setRef(t,"mainColumn",l),n.setClass(l,"messenger_main-okmsg"),n.setAttribute(l,"data-tsid","chat_main"),e._o=n.mountBlock(t,m,h1t),e._10=n.mountBlock(t,r,k1t);var d=e._16=n.insert(r,n.createComponent("msg-page-modal",UZt,t));n.setRef(t,"modal",d);var _=e._17=n.propsSet(d);return b1t(0,_,t),n.mountComponent(d,_),e._18=n.mountBlock(t,r,j1t),e._1l=n.mountBlock(t,r,O1t),e._1q=n.mountBlock(t,r,H1t),e._1z=n.mountBlock(t,r,X1t),o1t(),n.subscribeStore(t,["config","selectedChat","asideActive","search","chatList","chatMarker","state","okWeb","isSmallScreen","isMobile","audioPlayer","showMedia","l10n"]),n.finalizePendingRefs(t,a),J1t}function J1t(t,e){var o=e._d,r=e._e,a=e._16,i=e._17;n1t(),r1t(t,e),n.updateBlock(e._6),s1t(e._b,e._c,t),u1t(0,r,t),n.updateBlock(e._f),n.updateIncomingSlot(o,"header",t1t[0]),n.updateComponent(o,r),n.updateBlock(e._o),n.updateBlock(e._10),b1t(0,i,t),n.updateComponent(a,i),n.updateBlock(e._18),n.updateBlock(e._1l),n.updateBlock(e._1q),n.updateBlock(e._1z),o1t(),n.finalizePendingRefs(t,e._1)}c1t.dispose=function(t,e){var o=t._k;n.animate(o,ZU(0,{duration:300,easing:oN}),(function(){n1t(),function(t){t._l=n.unmountComponent(t._l),t._k=n.domRemove(t._k),t1t[0]=1}(t),n.updateIncomingSlot(t._d,"header",t1t[0]),o1t()}))},d1t.dispose=function(t,e){n.animate(t._t,n.createAnimation(e.store.data.isSmallScreen?"slide-in 0.3s ease-out reverse":null,ZZt),(function(){return function(t){var e=t._t;t._t=n.unmountComponent(e),n.domRemove(e),t._u=null}(t)}))},g1t.dispose=function(t){t._x=n.unmountComponent(t._x),t._y=null},C1t.dispose=function(t,e){n.animate(t._15,n.createAnimation("global:dialog-hide 0.15s ease-out forwards",ZZt),(function(){return function(t){var e=t._15;t._15=n.unmountComponent(e),n.domRemove(e)}(t)}))},S1t.dispose=function(t){t._1e=n.unmountComponent(t._1e),t._1f=null},I1t.dispose=function(t){t._1j=n.unmountComponent(t._1j),t._1k=null},A1t.dispose=function(t){t._1b=n.unmountBlock(t._1b),t._1g=n.unmountBlock(t._1g)},R1t.dispose=function(t){t._1o=n.unmountComponent(t._1o),t._1p=null},N1t.dispose=function(t,e){n.animate(t._1v,n.createAnimation("global:msg-dialog-hide 0.2s ease-out",ZZt),(function(){return function(t){var e=t._1v;t._1x=n.removeEvent("close",t._1x),t._1y=n.removeEvent("zoom",t._1y),t._1v=n.unmountComponent(e),n.domRemove(e),t._1w=null}(t)}))},K1t.dispose=function(t){t._2f=n.removeEvent("change",t._2f),t._2g=n.unmountComponent(t._2g),t._2d=n.unmountComponent(t._2d),t1t[1]=1},G1t.dispose=function(t){t._24=n.removeEvent("close",t._24),t._26=n.unmountComponent(t._26),t._28=n.unmountComponent(t._28),t._2a=n.unmountBlock(t._2a),t._2m=n.removeEvent("click",t._2m),t._2n=n.unmountComponent(t._2n),t._2k=n.unmountComponent(t._2k),t._2s=n.removeEvent("click",t._2s),t._2t=n.unmountComponent(t._2t),t._2q=n.unmountComponent(t._2q),t._25=n.unmountComponent(t._25),t._22=n.unmountComponent(t._22),t._27=t._29=null},Q1t.dispose=function(t){n1t(),t._6=n.clearBlock(t._6),t._f=n.unmountBlock(t._f),t._d=n.unmountComponent(t._d),t._o=n.unmountBlock(t._o),t._10=n.clearBlock(t._10),t._16=n.unmountComponent(t._16),t._18=n.clearBlock(t._18),t._1l=n.clearBlock(t._1l),t._1q=n.clearBlock(t._1q),t._1z=n.clearBlock(t._1z),o1t()};var $1t={__proto__:null,cssScope:ZZt,default:Q1t,slideDown:$U,slideUp:ZU,easeInOutCubic:oN,props:function(){return{model:null,requiresUpdate:null,modalMode:null,groupIdFilter:null}},state:function(){return{asideActive:[],animate:!1,infoContent:"info",_time:o.logTime("msg-page")}},methods:FZt,willMount:function(t){t._shortcuts=OS({ESC:function(e){return function(t,e){var n=t.refs,o=n.chat,r=n.overlay;if(!o&&!r)return;(function(t,e){if(e.isSearchOpened())return e.toggleSearch(),!0;var n=t.state,o=n.selectedChat;if(o.selectedMessages&&o.selectedMessages.length)return Zt(t,"reset-selected-messages",{chatId:o.id}),!0;return!1})(t,o)&&(e.preventDefault(),e.stopPropagation())}(t,e)},"CMD+F":function(e,n){return function(t,e,n){e.preventDefault();var o=t.refs,r=o.chat;r?r.toggleSearch():n()}(t,e,n)},ALL:function(e,n){return KS(t,e)}}),document.body.classList.add(JZt(t)),document.body.classList.contains("toolbar-static")&&(NZt=!0,document.body.classList.remove("toolbar-static"),document.body.classList.add("toolbar-fixed"))},willUnmount:function(t){t._shortcuts.destroy(),clearTimeout(DZt),DZt=null,document.body.classList.remove(JZt(t)),NZt&&(NZt=!1,document.body.classList.add("toolbar-static"),document.body.classList.remove("toolbar-fixed"))},didChange:function(t,e){var n=e.model;if(n){n.prev&&n.prev.online!==n.current.online&&function(t,e){if(e)clearTimeout(DZt),DZt=null,qZt=!0,t.setState({offline:!1});else if(!DZt){DZt=setTimeout((function(){t.setState({offline:!0})}),qZt?5e3:1500)}}(t,n.current.online);var o=n.current.peekChat||p(n.current.chats).find((function(t){return t.selected})),r=t.state.selectedChat;if(r&&h6(r)!==h6(o)){var a=t.refs.chat;a&&a.closeSearch(),t.setState({animate:!0})}t.setState({selectedChat:o});var i=!n.prev&&n.current.chatsLoaded,s=n.prev&&!n.prev.chatsLoaded&&n.current.chatsLoaded;o&&!function(t){var e=Kn(document.location.pathname),n=Kn(Yp(t));return!(t&&!e||n!==e)}(o)&&(i||s)&&Xp()}},didMount:function(t){t.state._time(),HZt||(HZt=!0,o.log("render-page")),t.store.get().isTouchDevice||$Zt(t)},events:VZt,onClearChatConfirm:KZt,onClearChatClose:WZt,onClearChatCancel:GZt,onForAllStateChange:YZt,onMediaClose:XZt},Z1t="e-begvnn";function t0t(t,e){var o=t.componentView;n.appendChild(o,n.createSlot(t,"",Z1t)),e._2=n.mountSlot(t,"")}t0t.dispose=function(t){t._2=n.unmountSlot(t._2)};var e0t={__proto__:null,cssScope:Z1t,default:t0t};var n0t={"update-buttons":function(t){t.setState({buttons:a0t(t)})}};function o0t(t,e){i0t(t),r0t(e,!t||"function"!=typeof t.action)}function r0t(t,e){var n=t.props.callback;n&&Zt(t,n),Zt(t,"close-confirm",{cancel:e})}function a0t(t,e){return e||(e=t.props.buttons||[]),e.map((function(t,e){var n={idx:e,role:e>0?"secondary":"primary",isDisabled:!1};return"string"==typeof t?n.label=t:n=Object.assign({},n,t),n}))}function i0t(t){t&&"function"==typeof t.action&&t.action()}function s0t(t){t._shortcuts&&(t._shortcuts.destroy(),t._shortcuts=null)}function u0t(t){r0t(t,!0)}var c0t="eqxkoqr",p0t=[0,0,0,0],l0t=[];function m0t(){l0t.push(p0t),p0t=[0,0,0,0]}function d0t(){p0t=l0t.pop()}function _0t(t){return t.props.header}function f0t(t,e,o){return o._d=n.mountInnerHTML(t,e,_0t),p0t[0]=1,g0t}function g0t(t,e){p0t[0]|=n.updateInnerHTML(e._d)}function v0t(t,e,o){return o._g=n.insert(e,n.text(t.props.header)),p0t[0]=1,h0t}function h0t(t,e){p0t[0]|=n.updateText(e._g,t.props.header)}function C0t(t){return n.get(t.props.header,"nodeType")?f0t:v0t}function k0t(t){return t.props.body}function b0t(t,e,o){return o._m=n.mountInnerHTML(t,e,k0t),p0t[1]=1,y0t}function y0t(t,e){p0t[1]|=n.updateInnerHTML(e._m)}function S0t(t,e,o){return o._p=n.insert(e,n.text(t.props.body)),p0t[1]=1,w0t}function w0t(t,e){p0t[1]|=n.updateText(e._p,t.props.body)}function E0t(t){return n.get(t.props.body,"nodeType")?b0t:S0t}function x0t(t){return t.state.buttons}function I0t(t,e,o,r){e.class=n.get(r.value,"role"),e.disabled=n.get(r.value,"isDisabled"),e["data-tsid"]="confirm-"+n.get(r.value,"role")}function B0t(t,e,n,o){o0t(o.value,t)}function M0t(t,e,o){var r=o._v=n.insert(e,n.createComponent("button",fe,t)),a=r.componentModel.input,i=o._w=n.propsSet(r,{shape:"square"});return I0t(0,i,0,o),o._x=n.addEvent(r,"click",B0t,t,o),o._y=n.insert(a,n.text(n.get(o.value,"label"))),n.mountComponent(r,i),p0t[2]=1,A0t}function A0t(t,e){var o=e._v,r=e._w;I0t(0,r,0,e),p0t[3]|=n.updateText(e._y,n.get(e.value,"label")),n.updateIncomingSlot(o,"",p0t[3]),n.updateComponent(o,r)}function T0t(t,e){var o=e._6;n.updateBlock(e._a),n.updateBlock(e._j),n.updateIterator(e._s),n.updateIncomingSlot(o,"header",p0t[0]),n.updateIncomingSlot(o,"",p0t[1]),n.updateIncomingSlot(o,"buttons",p0t[2])}function j0t(t,e,o){return o._6?T0t(0,o):function(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-dialog",Q2,t)),a=r.componentModel.input;o._8=n.addEvent(r,"close",u0t,t,o);var i=n.insert(a,n.elem("h4",c0t),"header"),s=n.createInjector(i);n.setAttribute(i,"slot","header"),o._a=n.mountBlock(t,s,C0t);var u=n.insert(a,n.elem("div",c0t),""),c=n.createInjector(u);n.setClass(u,"body-okmsg"),o._j=n.mountBlock(t,c,E0t);var p=n.insert(a,n.elem("div",c0t),"buttons"),l=n.createInjector(p);n.setAttribute(p,"slot","buttons"),n.setAttribute(p,"data-tsid","buttons_in_confirmation_layer"),o._s=n.mountIterator(t,l,x0t,M0t),n.mountComponent(r,n.propsSet(r,{role:"dialog","aria-modal":"true"}))}(t,e,o),n.animate(o._6,n.createAnimation("global:msg-dialog-show 0.25s cubic-bezier(0.2, 0.94, 0.42, 1.25) backwards",c0t)),!o._14&&function(t,e,o){var r=o._14=n.insert(e,n.elem("div",c0t));n.setClass(r,"overlay-okmsg"),o._15=n.addEvent(r,"click",r0t,t,o)}(t,e,o),n.animate(o._14,n.createAnimation("overlay-show 0.2s linear backwards",c0t)),P0t}function P0t(t,e){T0t(0,e)}function R0t(t){return t.props.body?j0t:null}function L0t(t,e){var o=t.componentView;m0t();var r=n.createInjector(o);return e._1=n.mountBlock(t,r,R0t),d0t(),O0t}function O0t(t,e){m0t(),n.updateBlock(e._1),d0t()}f0t.dispose=function(t){t._d=n.unmountInnerHTML(t._d),p0t[0]=1},v0t.dispose=function(t){t._g=null,p0t[0]=1},b0t.dispose=function(t){t._m=n.unmountInnerHTML(t._m),p0t[1]=1},S0t.dispose=function(t){t._p=null,p0t[1]=1},M0t.dispose=function(t){t._x=n.removeEvent("click",t._x),t._v=n.unmountComponent(t._v),t._w=t._y=null,p0t[2]=1},j0t.dispose=function(t,e){n.animate(t._6,n.createAnimation("global:msg-dialog-hide 0.15s ease-out forwards",c0t),(function(){return function(t){var e=t._6;t._8=n.removeEvent("close",t._8),t._a=n.unmountBlock(t._a),t._j=n.unmountBlock(t._j),t._s=n.unmountIterator(t._s),t._6=n.unmountComponent(e),n.domRemove(e)}(t)})),n.animate(t._14,n.createAnimation("overlay-hide 0.15s linear forwards",c0t),(function(){return function(t){t._15=n.removeEvent("click",t._15),t._14=n.domRemove(t._14)}(t)}))},L0t.dispose=function(t){m0t(),t._1=n.clearBlock(t._1),d0t()};var z0t={__proto__:null,cssScope:c0t,default:L0t,props:function(){return{header:"",body:null,buttons:null,callback:""}},events:n0t,willUnmount:function(t){s0t(t)},didChange:function(t,e){var n=e.buttons,o=e.body;n&&n.current&&t.setState({buttons:a0t(t,n.current)}),o&&o.current?function(t){if(t._shortcuts)return;t._shortcuts=OS({ENTER:function(e){if(!Cr(e.target)){e.preventDefault(),e.stopPropagation();var n=t.state.buttons;i0t(n&&n.find((function(t){return"primary"===t.role}))),r0t(t)}},ESC:function(e){e.preventDefault(),e.stopPropagation(),r0t(t,!0)},ALL:function(){return null}})}(t):s0t(t)},onPerformAction:o0t,close:r0t,onClose:u0t},D0t="select",U0t="move",N0t="resize",q0t="nw",H0t="ne",F0t="se",V0t="sw";var K0t={startDefaultCrop:function(){if(!this.state.cropData){var t=this.props;W0t(this,$0t(t.width,t.height))}},resetCrop:function(){W0t(this,null)},cropImage:function(){var t=this.props.ratio;if(!t||!this.state.cropData)return null;var e=document.createElement("canvas"),n=this.state.cropData,o=Math.floor(n.t/t),r=Math.floor(n.l/t),a=Math.ceil(n.w/t),i=Math.ceil(n.h/t);return e.width=a,e.height=i,e.getContext("2d").drawImage(this.refs.image,r,o,a,i,0,0,a,i),e}};function W0t(t,e){t.setState({cropData:e}),Zt(t,"update-crop-data",e)}function G0t(t,e,n,o,r){void 0===o&&(o=0),void 0===r&&(r=0),W0t(t,"object"==typeof e?e:{t:e,l:n,w:o,h:r})}function Y0t(t){var e=t.state.cropData,n=e.w,o=e.h,r=t.store.get().config.server["min-image-side-size"]||64;(n<r||o<r)&&t.resetCrop()}function X0t(t,e,n,o,r){var a=J0t(t);return[Math.max(a.left,Math.min(e,a.right))-o,Math.max(a.top,Math.min(n,a.bottom))-r]}function Q0t(t){t._imgRect=null}function J0t(t){return t._imgRect||(t._imgRect=t.refs.image.getBoundingClientRect()),t._imgRect}function $0t(t,e){var n=Math.min(t,e);return{t:(e-n)/2,l:(t-n)/2,w:n,h:n}}function Z0t(t){var e=t.t,n=t.l,o=t.w,r=t.h;return r<0&&(e+=r,r=-r),o<0&&(n+=o,o=-o),{t:e,l:n,w:o,h:r}}var t2t="eghh56l",e2t="http://www.w3.org/2000/svg";function n2t(t,e,o){n.updateClass(t,e,"holder-okmsg"+(o.state.cropState?" __"+o.state.cropState:"")+(o.state.cropHandle?" __"+o.state.cropHandle:"")+(n.get(o.props.options,"square")?" __square-okmsg":"")+(o.state.cropData?" __crop-okmsg":"")),n.updateAttribute(t,e,"style","width:"+o.props.width+"px;height:"+o.props.height+"px;")}function o2t(t,e,o){n.updateAttribute(t,e,"src",o.state.src),n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height)}function r2t(t,e,o){n.updateAttribute(t,e,"style","top:"+n.get(o.state.cropData,"t")+"px;left:"+n.get(o.state.cropData,"l")+"px;width:"+n.get(o.state.cropData,"w")+"px;height:"+n.get(o.state.cropData,"h")+"px;")}function a2t(t,e,o){n.updateAttribute(t,e,"style","top:-"+n.get(o.state.cropData,"t")+"px;left:-"+n.get(o.state.cropData,"l")+"px;"),n.updateAttribute(t,e,"src",o.state.src),n.updateAttribute(t,e,"width",o.props.width),n.updateAttribute(t,e,"height",o.props.height)}function i2t(t,e){var o=n.insert(e,n.elemNS("svg",e2t,t2t));n.setAttribute(o,"class","preview_square-okmsg"),n.setAttribute(o,"xmlns","http://www.w3.org/2000/svg"),n.setAttribute(o,"viewBox","0 0 128 128");var r=n.appendChild(o,n.elemNS("path",e2t,t2t));n.setAttribute(r,"class","svg-fill-okmsg"),n.setAttribute(r,"d","M0,1.42108547e-14 L128,1.42108547e-14 L128,128 L0,128 L0,1.42108547e-14 Z M64,128 C99.346224,128 128,99.346224 128,64 C128,28.653776 99.346224,1.42108547e-14 64,1.42108547e-14 C28.653776,1.42108547e-14 0,28.653776 0,64 C0,99.346224 28.653776,128 64,128 Z")}function s2t(t){return n.get(t.props.options,"square")?i2t:null}function u2t(t,e){var o=t.componentView,r=e._1=n.appendChild(o,n.elem("div",t2t));n2t(r,e._2=n.obj(),t);var a=e._3=n.appendChild(r,n.elem("img",t2t));n.setRef(t,"image",a);var i=e._4=n.obj();n.setClass(a,"image-okmsg"),n.setAttribute(a,"crossorigin","anonymous"),n.setAttribute(a,"alt",""),o2t(a,i,t);var s=n.appendChild(r,n.elem("div",t2t));n.setRef(t,"tracker",s),n.setClass(s,"tracker-okmsg");var u=e._6=n.appendChild(r,n.elem("div",t2t)),c=e._7=n.obj();n.setClass(u,"frame-okmsg"),r2t(u,c,t);var p=n.appendChild(u,n.elem("div",t2t)),l=n.createInjector(p);n.setClass(p,"preview-okmsg");var m=e._9=n.insert(l,n.elem("img",t2t)),d=e._a=n.obj();n.setClass(m,"preview_img-okmsg"),n.setAttribute(m,"alt",""),a2t(m,d,t),e._b=n.mountBlock(t,l,s2t);var _=n.insert(l,n.elem("div",t2t));n.setClass(_,"preview_border-okmsg __top-okmsg");var f=n.insert(l,n.elem("div",t2t));n.setClass(f,"preview_border-okmsg __bottom-okmsg");var g=n.insert(l,n.elem("div",t2t));n.setClass(g,"preview_border-okmsg __left-okmsg");var v=n.insert(l,n.elem("div",t2t));n.setClass(v,"preview_border-okmsg __right-okmsg");var h=n.insert(l,n.elem("div",t2t));n.setRef(t,"previewMover",h),n.setClass(h,"preview_mover-okmsg");var C=n.appendChild(u,n.elem("div",t2t));n.setRef(t,"handles",C),n.setClass(C,"handles-okmsg");var k=n.appendChild(C,n.elem("div",t2t));n.setClass(k,"handle-okmsg js-handle"),n.setAttribute(k,"data-id","nw");var b=n.appendChild(C,n.elem("div",t2t));n.setClass(b,"handle-okmsg js-handle"),n.setAttribute(b,"data-id","ne");var y=n.appendChild(C,n.elem("div",t2t));n.setClass(y,"handle-okmsg js-handle"),n.setAttribute(y,"data-id","se");var S=n.appendChild(C,n.elem("div",t2t));return n.setClass(S,"handle-okmsg js-handle"),n.setAttribute(S,"data-id","sw"),c2t}function c2t(t,e){n2t(e._1,e._2,t),o2t(e._3,e._4,t),r2t(e._6,e._7,t),a2t(e._9,e._a,t),n.updateBlock(e._b)}u2t.dispose=function(t){t._b=n.unmountBlock(t._b)};var p2t={__proto__:null,cssScope:t2t,default:u2t,props:function(){return{photo:null,width:null,height:null,ratio:null,options:null,minSquareCropSide:128}},extend:K0t,init:function(t){var e=t.store.get().isMobile,n=o.getOSVersion(),r=e&&"Windows"!==n&&"Mac OS"!==n&&"Linux"!==n;t._pstart=r?"touchstart":"mousedown",t._pmove=r?"touchmove":"mousemove",t._pup=r?"touchend":"mouseup",t._isMobile=r,t.selectBeginListener=function(e){return function(t,e){var n=t.props,o=n.options;if(e.preventDefault(),o.square)return void e.stopPropagation();var r=t._isMobile?e.touches[0].clientX:e.x,a=t._isMobile?e.touches[0].clientY:e.y;Q0t(t);var i=J0t(t);t._data={x0:r,y0:a,t:a-i.top,l:r-i.left},G0t(t,t._data.t,t._data.l),t.setState({cropState:D0t}),window.addEventListener(t._pmove,t.handleMouseMove,{passive:!1}),window.addEventListener(t._pup,t.handleMouseUp)}(t,e)},t.moveBeginListener=function(e){return function(t,e){e.preventDefault(),Q0t(t);var n=t._isMobile?e.touches[0].clientX:e.x,o=t._isMobile?e.touches[0].clientY:e.y;t._data=Object.assign({},t.state.cropData,{x0:n,y0:o}),t.setState({cropState:U0t}),window.addEventListener(t._pmove,t.handleMouseMove,{passive:!1}),window.addEventListener(t._pup,t.handleMouseUp)}(t,e)},t.resizeBeginListener=function(e){return function(t,e){Q0t(t);var n=e.target.getAttribute("data-id"),o=J0t(t),r=t.state.cropData,a=function(t,e,n){var o=0,r=0;switch(n){case q0t:o=e.left+t.l,r=e.top+t.t;break;case H0t:o=e.left+t.l+t.w,r=e.top+t.t;break;case F0t:o=e.left+t.l+t.w,r=e.top+t.t+t.h;break;case V0t:o=e.left+t.l,r=e.top+t.t+t.h}return[o,r]}(r,o,n),i=a[0],s=a[1];t._data=Object.assign({},r,{x0:i,y0:s}),t.setState({cropState:N0t,cropHandle:n}),window.addEventListener(t._pmove,t.handleMouseMove,{passive:!1}),window.addEventListener(t._pup,t.handleMouseUp)}(t,e)},t.handleMouseMove=function(e){return function(t,e){switch(e.preventDefault(),t.state.cropState){case D0t:!function(t,e){var n=t._isMobile?e.touches[0].clientX:e.x,o=t._isMobile?e.touches[0].clientY:e.y,r=X0t(t,n,o,t._data.x0,t._data.y0),a=r[0],i=r[1],s={t:t._data.t,l:t._data.l,w:a,h:i};G0t(t,Z0t(s))}(t,e);break;case U0t:!function(t,e){var n=J0t(t),o=t._isMobile?e.touches[0].clientX:e.x,r=t._isMobile?e.touches[0].clientY:e.y,a=t._data,i=o-a.x0,s=r-a.y0,u=Math.max(0,Math.min(a.t+s,n.height-a.h)),c=Math.max(0,Math.min(a.l+i,n.width-a.w));G0t(t,u,c,a.w,a.h)}(t,e);break;case N0t:!function(t,e){var n=t.state.cropHandle,o=t.props.options.square,r=J0t(t),a=t._data,i=t._isMobile?e.touches[0].clientX:e.x,s=t._isMobile?e.touches[0].clientY:e.y,u=X0t(t,i,s,a.x0,a.y0);if(o){var c=function(t,e){var n=t[0],o=t[1],r=Math.abs(n);switch(e){case q0t:case F0t:n=o=n>0?r:-r;break;case H0t:case V0t:o=-(n=n>0?r:-r)}return[n,o]}(u,n),p=c[0],l=c[1],m=Math.max(r.left,Math.min(a.x0+p,r.right))-a.x0,d=Math.max(r.top,Math.min(a.y0+l,r.bottom))-a.y0,_=Math.max(Math.abs(m-p),Math.abs(d-l));u=[p=p>0?p-_:p+_,l=l>0?l-_:l+_]}if(a=function(t,e,n){var o=e[0],r=e[1],a=t.t,i=t.l,s=t.w,u=t.h;switch(n){case q0t:a+=r,u-=r,i+=o,s-=o;break;case H0t:a+=r,u-=r,s+=o;break;case F0t:u+=r,s+=o;break;case V0t:u+=r,i+=o,s-=o}return{t:a,l:i,w:s,h:u}}(a,u,n),o){a=function(t,e,n){var o=t.t,r=t.l,a=t.w,i=t.h,s=0,u=0;switch(n){case q0t:a<e&&(a+=s=e-a,r-=s),i<e&&(i+=u=e-i,o-=u);break;case H0t:a<e&&(a+=s=e-a),i<e&&(i+=u=e-i,o-=u);break;case F0t:a<e&&(a+=s=e-a),i<e&&(i+=u=e-i);break;case V0t:a<e&&(a+=s=e-a,r-=s),i<e&&(i+=u=e-i)}return{t:o,l:r,w:a,h:i}}(a,Math.min(t.props.minSquareCropSide,r.width,r.height),n)}else a=Z0t(a);G0t(t,a)}(t,e)}}(t,e)},t.handleMouseUp=function(e){return function(t){switch(t.state.cropState){case D0t:!function(t){window.removeEventListener(t._pmove,t.handleMouseMove,{passive:!1}),window.removeEventListener(t._pup,t.handleMouseUp),Y0t(t),t.setState({cropState:null})}(t);break;case U0t:!function(t){window.removeEventListener(t._pmove,t.handleMouseMove,{passive:!1}),window.removeEventListener(t._pup,t.handleMouseUp),t.setState({cropState:null})}(t);break;case N0t:!function(t){window.removeEventListener(t._pmove,t.handleMouseMove),window.removeEventListener(t._pup,t.handleMouseUp),Y0t(t),t.setState({cropState:null,cropHandle:null})}(t)}}(t)}},didChange:function(t,e){var n=e.photo;if(n&&n.current){var o=n.current.file;t.setState({src:o.objectUrl||yt({file:o})})}},willRender:function(t){var e=t.props,n=e.width,o=e.height,r=e.ratio,a=e.options,i=t.state.cropData||a.cropData;if(n&&o&&r){var s=i&&!function(t,e,n){var o=t.t,r=t.l,a=t.w,i=t.h;return e>=r+a&&n>=o+i}(i,n,o);(s||a.square&&!i&&(n!==o||a.initialCrop))&&(i=$0t(n,o)),W0t(t,i)}},didRender:function(t){var e=t.props.photo,n=t.state.src;e&&!e.file.objectUrl&&requestAnimationFrame((function(){return URL.revokeObjectURL(n)})),t._prevSrc!==n&&(t._prevSrc=n,t._imgRect=null,requestAnimationFrame((function(){return function(t){t.refs.tracker.addEventListener(t._pstart,t.selectBeginListener,{passive:!1}),t.refs.previewMover.addEventListener(t._pstart,t.moveBeginListener,{passive:!1}),function(t){return Array.from(t.refs.handles.querySelectorAll(".js-handle"))}(t).forEach((function(e){return e.addEventListener(t._pstart,t.resizeBeginListener,{passive:!1})}))}(t)})))}},l2t="resize",m2t=48,d2t=80,_2t=1024;var f2t={close:function(){Zt(this,"close-photo-layer")}};function g2t(t){t.close()}function v2t(t,e){t.setState({photo:e}),h2t(t)}function h2t(t){var e=t.state.photo;if(e){var n=Math.min(window.innerWidth-d2t,_2t),o=Math.min(window.innerHeight-2*m2t-d2t,_2t),r=Math.min(1,n/e.width,o/e.height);t.setState({width:Math.round(e.width*r),height:Math.round(e.height*r),ratio:r})}else t.setState({width:0,height:0})}function C2t(t,e){null==e?t.setState({loading:null}):t.setState("loading",{async:!0,loaded:!!e})}function k2t(t,e){return Object.assign({},{_type:"PHOTO",url:yt(t)},e)}var b2t="e80l4jj";function y2t(t,e,o){var r=o._4=n.insert(e,n.createComponent("msg-progress",Ps,t));n.mountComponent(r,n.propsSet(r,{spin:!0,indeterminate:!0,size:48,radius:20,thickness:2}))}function S2t(t){return t.state.loading?y2t:null}function w2t(t,e){e.stopPropagation()}function E2t(t,e,o){e.photo=o.state.photo,e.ratio=o.state.ratio,e.width=o.state.width,e.height=o.state.height,e.options=n.get(o.props.options,"crop")}function x2t(t,e){var o=t.componentView,r=n.createInjector(o);e._1=n.mountBlock(t,r,S2t);var a=n.insert(r,n.elem("div",b2t));n.setClass(a,"container-okmsg"),e._8=n.addEvent(a,"click",w2t,t,e);var i=e._9=n.appendChild(a,n.createComponent("msg-icon",xe,t));e._b=n.addEvent(i,"click",g2t,t,e),n.mountComponent(i,n.propsSet(i,{icon:"close","data-l":"t,close"}));var s=n.appendChild(a,n.elem("div",b2t));n.setRef(t,"photoW",s),n.setClass(s,"photo_w-okmsg");var u=e._d=n.appendChild(s,n.createComponent("msg-photo-crop",p2t,t));n.setRef(t,"photoCrop",u);var c=e._e=n.propsSet(u);E2t(0,c,t),n.mountComponent(u,c);var p=n.appendChild(a,n.elem("div",b2t));n.setClass(p,"footer_w-okmsg");var l=n.appendChild(p,n.elem("div",b2t));return n.setClass(l,"footer-okmsg"),n.appendChild(l,n.createSlot(t,"actions",b2t)),e._i=n.mountSlot(t,"actions"),I2t}function I2t(t,e){var o=e._d,r=e._e;n.updateBlock(e._1),E2t(0,r,t),n.updateComponent(o,r)}y2t.dispose=function(t){t._4=n.unmountComponent(t._4)},x2t.dispose=function(t){t._1=n.clearBlock(t._1),t._8=n.removeEvent("click",t._8),t._b=n.removeEvent("click",t._b),t._9=n.unmountComponent(t._9),t._d=n.unmountComponent(t._d),t._i=n.unmountSlot(t._i)};var B2t={__proto__:null,cssScope:b2t,default:x2t,props:function(){return{photo:null,autoplay:!1,options:null,index:null,total:null}},methods:f2t,willMount:function(t){t._resizeListener=o.throttle((function(){return h2t(t)}),100),t._shortcuts=OS({ESC:function(e){e.stopPropagation(),e.preventDefault(),t.close()},ALL:function(){return null}}),window.addEventListener(l2t,t._resizeListener)},didMount:function(t){h2t(t)},willUnmount:function(t){t._shortcuts.destroy(),window.removeEventListener(l2t,t._resizeListener)},didChange:function(t,e){var n=e.photo;if(n&&n.current)if(n.current.file instanceof Blob)v2t(t,n.current),C2t(t,null);else{var o=Ct(n.current);o?(C2t(t,null),v2t(t,k2t(n.current,Object.assign({},o,n.current)))):(C2t(t,!1),kt(n.current).then((function(e){yt(t.props.photo)===e.url&&(v2t(t,k2t(n.current,Object.assign({},e,n.current))),C2t(t,!0))})))}},onClose:g2t};var M2t={"close-photo-layer":function(t,e){e.stopPropagation(),j2t(t)},"update-crop-data":function(t,e){e.stopPropagation(),requestAnimationFrame((function(){return function(t,e){t.setState({cropModified:!(!e||!t._prevCropData),hasCrop:!!e}),t._prevCropData=e}(t,e.detail)}))}};function A2t(t){t.state.hasCrop?N2t(t).resetCrop():N2t(t).startDefaultCrop()}function T2t(t){N2t(t).resetCrop()}function j2t(t){var e=t.props.options,n=e&&e.onClose;"function"==typeof n&&n(),Zt(t,"close")}function P2t(t){var e=t.props,n=e.photo,o=e.options,r=t.state.changedPhoto||n,a=o&&o.action;r.file.width=r.width,r.file.height=r.height,t.state.changedPhoto&&(r.file.name=n.file.name,r.file.lastModified=n.file.lastModified),r&&"function"==typeof a&&a(Object.assign({},r,{originFile:n.file})),j2t(t)}function R2t(t){t.setState({changedPhoto:null})}function L2t(t){var e=N2t(t),n=e.cropImage();if(n)return n.toBlob((function(n){U2t(t,n).then((function(){return e.resetCrop()}))}))}function O2t(t,e){var n=e.state.changedPhoto||e.props.photo,o=document.createElement("canvas"),r=o.getContext("2d");o.width=n.width,o.height=n.height,"horizontal"===t&&(r.translate(n.width,0),r.scale(-1,1)),r.drawImage(D2t(e),0,0),o.toBlob((function(t){U2t(e,t),requestAnimationFrame((function(){N2t(e).resetCrop(),e.setState({cropModified:!1,flipped:!e.state.flipped}),e._prevCropData=null}))}))}function z2t(t,e){var n=e.state.changedPhoto||e.props.photo,o=document.createElement("canvas"),r=o.getContext("2d");o.width=n.height,o.height=n.width,"right"===t?(r.rotate(Math.PI/2),r.translate(0,-n.height)):(r.rotate(-Math.PI/2),r.translate(-n.width,0)),r.drawImage(D2t(e),0,0),o.toBlob((function(t){U2t(e,t),requestAnimationFrame((function(){N2t(e).resetCrop(),e.setState({cropModified:!1}),e._prevCropData=null}))}))}function D2t(t){return N2t(t).refs.image}function U2t(t,e){var n=t.props.photo;return rQt(e).then((function(o){var r=t.state.changedPhoto;r&&r.file&&r.file.objectUrl&&URL.revokeObjectURL(r.file.objectUrl),t.setState({changedPhoto:Object.assign({},n,o,{file:Object.assign(e,o,{objectUrl:URL.createObjectURL(e)})})})}))}function N2t(t){return t.refs.container.refs.photoCrop}var q2t="e-evzn2a",H2t=[0],F2t=[];function V2t(){F2t.push(H2t),H2t=[0]}function K2t(){H2t=F2t.pop()}function W2t(t,e){e.photo=t.state.changedPhoto||t.props.photo,e.showButtons=t.store.data.isMobile&&(t.state.hasCrop||n.get(t.props.options,"actionRequired")&&n.get(t.props.options,"action"))}function G2t(t,e,n,o){e.photo=o.photo,e.options=n.props.options,e.total=n.state.total,e.index=n.state.index,e.hasPrev=!!n.state.prevFile&&!n.state.changedPhoto&&!n.state.hasCrop,e.hasNext=!!n.state.nextFile&&!n.state.changedPhoto&&!n.state.hasCrop}function Y2t(t,e,o,r){n.updateClass(t,e,"buttons-okmsg"+(r.showButtons?" __more-okmsg":""))}function X2t(t,e,o){e.title=n.call(o.store.data.l10n,"key",["crop"]),e.class=o.state.hasCrop?"inverted":"secondary"}function Q2t(t,e,o){e.title=n.call(o.store.data.l10n,"key",["h-flip"])}function J2t(t,e,n){O2t("horizontal",t)}function $2t(t,e,o){e.title=n.call(o.store.data.l10n,"key",["rotate-l"])}function Z2t(t,e,n){z2t("left",t)}function t3t(t,e,o){e.title=n.call(o.store.data.l10n,"key",["reset"])}function e3t(t,e,o){var r=o._v=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._w=n.propsSet(r,{shape:"circle",class:"undo-okmsg","data-l":"t,undo"});t3t(0,i,t),o._x=n.addEvent(r,"click",R2t,t,o);var s=o._y=n.insert(a,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(s,n.propsSet(s,{icon:"undo",size:"medium"})),n.mountComponent(r,i),H2t[0]=1,n3t}function n3t(t,e){var o=e._v,r=e._w;t3t(0,r,t),n.updateComponent(o,r)}function o3t(t){return t.state.changedPhoto?e3t:null}function r3t(t,e,o){e.title=n.call(o.store.data.l10n,"key",["done"])}function a3t(t,e,o){e.title=n.call(o.store.data.l10n,"key",["cancel"])}function i3t(t,e,o){var r=o._1e=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._1f=n.propsSet(r,{"data-tsid":"photo_layer_cancel_button",shape:"square",class:"secondary-okmsg","data-l":"t,crop-cancel"});a3t(0,i,t),o._1g=n.addEvent(r,"click",T2t,t,o);var s=o._1h=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(s,n.propsSet(s,{key:"cancel"})),n.mountComponent(r,i),H2t[0]=1,s3t}function s3t(t,e){var o=e._1e,r=e._1f;a3t(0,r,t),n.updateComponent(o,r)}function u3t(t){return t.state.cropModified?i3t:null}function c3t(t,e,o){var r=o._15=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._16=n.propsSet(r,{"data-tsid":"photo_layer_done_button",shape:"square",class:"primary-okmsg","data-l":"t,crop-done"});r3t(0,i,t),o._17=n.addEvent(r,"click",L2t,t,o);var s=o._18=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(s,n.propsSet(s,{key:"done"})),n.mountComponent(r,i),o._1b=n.mountBlock(t,e,u3t),H2t[0]=1,p3t}function p3t(t,e){var o=e._15,r=e._16;r3t(0,r,t),n.updateComponent(o,r),n.updateBlock(e._1b)}function l3t(t,e,o){e.title=n.call(o.store.data.l10n,"key",["save"])}function m3t(t,e,o){var r=o._1m=n.insert(e,n.createComponent("msg-button",fe,t)),a=r.componentModel.input,i=o._1n=n.propsSet(r,{"data-tsid":"photo_layer_save_button",shape:"square",class:"primary-okmsg","data-l":"t,save"});l3t(0,i,t),o._1o=n.addEvent(r,"click",P2t,t,o);var s=o._1p=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(s,n.propsSet(s,{key:"save"})),n.mountComponent(r,i),H2t[0]=1,d3t}function d3t(t,e){var o=e._1m,r=e._1n;l3t(0,r,t),n.updateComponent(o,r)}function _3t(t){return t.state.hasCrop?c3t:n.get(t.props.options,"action")?m3t:null}function f3t(t,e){var o=t.componentView;V2t(),W2t(t,e);var r=e._4=n.appendChild(o,n.createComponent("msg-photo-layer-container",B2t,t)),a=r.componentModel.input;n.setRef(t,"container",r);var i=e._5=n.propsSet(r,{autoplay:!0,"data-l":"t,photo-preview","data-tsid":"photo_layer"});G2t(0,i,t,e),e._6=n.addEvent(r,"click",j2t,t,e);var s=n.insert(a,n.elem("div",q2t),"actions"),u=n.createInjector(s);n.setAttribute(s,"slot","actions"),n.setClass(s,"actions-okmsg");var c=e._8=n.insert(u,n.elem("div",q2t));Y2t(c,e._9=n.obj(),0,e);var p=e._a=n.appendChild(c,n.createComponent("msg-button",fe,t)),l=p.componentModel.input,m=e._b=n.propsSet(p,{shape:"circle","data-l":"t,crop"});X2t(0,m,t),e._c=n.addEvent(p,"click",A2t,t,e);var d=e._d=n.insert(l,n.createComponent("msg-icon",xe,t),"");n.mountComponent(d,n.propsSet(d,{icon:"crop",size:"medium"})),n.mountComponent(p,m);var _=e._g=n.appendChild(c,n.createComponent("msg-button",fe,t)),f=_.componentModel.input,g=e._h=n.propsSet(_,{shape:"circle",class:"secondary-okmsg","data-l":"t,flip"});Q2t(0,g,t),e._i=n.addEvent(_,"click",J2t,t,e);var v=e._j=n.insert(f,n.createComponent("msg-icon",xe,t),"");n.mountComponent(v,n.propsSet(v,{icon:"h-flip",size:"medium"})),n.mountComponent(_,g);var h=e._m=n.appendChild(c,n.createComponent("msg-button",fe,t)),C=h.componentModel.input,k=e._n=n.propsSet(h,{shape:"circle",class:"secondary-okmsg","data-l":"t,rotate"});$2t(0,k,t),e._o=n.addEvent(h,"click",Z2t,t,e);var b=e._p=n.insert(C,n.createComponent("msg-icon",xe,t),"");return n.mountComponent(b,n.propsSet(b,{icon:"rotate-l",size:"medium"})),n.mountComponent(h,k),e._s=n.mountBlock(t,u,o3t),e._12=n.mountBlock(t,u,_3t),n.mountComponent(r,i),K2t(),n.subscribeStore(t,["isMobile","l10n"]),g3t}function g3t(t,e){var o=e._4,r=e._5,a=e._a,i=e._b,s=e._g,u=e._h,c=e._m,p=e._n;V2t(),W2t(t,e),G2t(0,r,t,e),Y2t(e._8,e._9,0,e),X2t(0,i,t),n.updateComponent(a,i),Q2t(0,u,t),n.updateComponent(s,u),$2t(0,p,t),n.updateComponent(c,p),n.updateBlock(e._s),n.updateBlock(e._12),n.updateIncomingSlot(o,"actions",H2t[0]),n.updateComponent(o,r),K2t()}e3t.dispose=function(t){t._x=n.removeEvent("click",t._x),t._y=n.unmountComponent(t._y),t._v=n.unmountComponent(t._v),t._w=null,H2t[0]=1},i3t.dispose=function(t){t._1g=n.removeEvent("click",t._1g),t._1h=n.unmountComponent(t._1h),t._1e=n.unmountComponent(t._1e),t._1f=null,H2t[0]=1},c3t.dispose=function(t){t._17=n.removeEvent("click",t._17),t._18=n.unmountComponent(t._18),t._15=n.unmountComponent(t._15),t._1b=n.unmountBlock(t._1b),t._16=null,H2t[0]=1},m3t.dispose=function(t){t._1o=n.removeEvent("click",t._1o),t._1p=n.unmountComponent(t._1p),t._1m=n.unmountComponent(t._1m),t._1n=null,H2t[0]=1},f3t.dispose=function(t){V2t(),t._6=n.removeEvent("click",t._6),t._c=n.removeEvent("click",t._c),t._d=n.unmountComponent(t._d),t._a=n.unmountComponent(t._a),t._i=n.removeEvent("click",t._i),t._j=n.unmountComponent(t._j),t._g=n.unmountComponent(t._g),t._o=n.removeEvent("click",t._o),t._p=n.unmountComponent(t._p),t._m=n.unmountComponent(t._m),t._s=n.unmountBlock(t._s),t._12=n.unmountBlock(t._12),t._4=n.unmountComponent(t._4),K2t()};var v3t={__proto__:null,cssScope:q2t,default:f3t,props:function(){return{photo:null,options:null}},events:M2t,willMount:function(t){t._shortcuts=OS({ESC:function(e){e.stopPropagation(),e.preventDefault(),t.close()},ALL:function(){return null}})},didMount:function(t){var e=document.querySelector(".topPanel"),n=e&&e.clientHeight;n&&t.refs.container&&(t.refs.container.style.top=n+"px")},willUnmount:function(t){t._shortcuts.destroy()},didChange:function(t,e){var n=e.photo,o=e.options;if(n&&n.current){var r=n.current,i=r.file,s=r.files;if(i&&s){var u=s instanceof a?Array.from(s.keys()):s,c=u.indexOf(i);t.setState({total:u.length,index:c+1,prevFile:u[c-1],nextFile:u[c+1]})}else t.setState({total:null,index:null,prevFile:null,nextFile:null})}if(o&&o.current){var p=o.current.crop;p&&(p.cropData||p.square)&&t.setState({hasCrop:!0})}},onCropClick:A2t,onCancelCrop:T2t,close:j2t,save:P2t,restore:R2t,crop:L2t,flip:O2t,rotate:z2t},h3t=function(t){var e=this;this._controller=t,this.app=t.props.app,ee(t,"log-screen",(function(t){return e.screen(t.detail)})),ee(t,"log-action",(function(t){return e.action(t.detail)})),ee(t,"log-error",(function(t){return e.error(t.detail.message,t.detail.detail)}))};h3t.prototype.action=function(t){"object"!=typeof t?this.app.stats.action(t):this.app.stats.action(t.name,t.value)},h3t.prototype.screen=function(t){this.app.stats.screen(t)},h3t.prototype.error=function(t,e){this.app.stats.log.error(t,e)};var C3t=function(t){var e=this;this._controller=t,this._timer=null,ee(t,"show-toast",(function(t){return e.show(t.detail)})),ee(t,"hide-toast",(function(){return e.hide()})),ee(t,"close-toast",(function(){return e.hide()}))};C3t.prototype.show=function(t){var e=this;this._controller.setState({toast:t}),clearTimeout(this._timer),this._timer=setTimeout((function(){return e.hide()}),5e3)},C3t.prototype.hide=function(){this._controller.setState({toast:null})};var k3t="eaduaxl";function b3t(t,e,n){e["data-count"]=n.props.count,e["data-countPlural"]=n.props.count}function y3t(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-checkbox",hS,t)),a=r.componentModel.input;n.setPendingRef(o._1,"checkbox",r);var i=o._a=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(i,n.propsSet(i,{key:"remove-messages-confirm-checkbox"})),n.mountComponent(r,n.propsSet(r,{checked:!0,shape:"square","data-tsid":"checkbox_remove_all"})),S3t}function S3t(t,e){n.setPendingRef(e._1,"checkbox",e._8)}function w3t(t){return t.props.allowRemoveAll?y3t:null}function E3t(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj(),i=e._2=n.insert(r,n.createComponent("msg-l10n",ae,t)),s=e._3=n.propsSet(i,{key:"remove-messages-confirm-body"});return b3t(0,s,t),n.mountComponent(i,s),n.insert(r,n.elem("br",k3t)),e._5=n.mountBlock(t,r,w3t),n.finalizePendingRefs(t,a),x3t}function x3t(t,e){var o=e._2,r=e._3;b3t(0,r,t),n.updateComponent(o,r),n.updateBlock(e._5),n.finalizePendingRefs(t,e._1)}y3t.dispose=function(t){t._a=n.unmountComponent(t._a),t._8=n.unmountComponent(t._8)},E3t.dispose=function(t){t._2=n.unmountComponent(t._2),t._5=n.clearBlock(t._5)};var I3t={__proto__:null,cssScope:k3t,default:E3t,props:function(){return{allowRemoveAll:!1,count:null}},methods:{isRemoveAllChecked:function(){return this.refs.checkbox&&this.refs.checkbox.checked}}};var B3t="ejhfvkh";function M3t(t,e,o){var r=o._8=n.insert(e,n.createComponent("msg-checkbox",hS,t)),a=r.componentModel.input;n.setPendingRef(o._1,"checkbox",r);var i=o._a=n.insert(a,n.createComponent("msg-l10n",ae,t),"");return n.mountComponent(i,n.propsSet(i,{key:"clear-chat-history-confirm-checkbox"})),n.mountComponent(r,n.propsSet(r,{checked:!0,shape:"square","data-tsid":"checkbox_remove_all"})),A3t}function A3t(t,e){n.setPendingRef(e._1,"checkbox",e._8)}function T3t(t){return t.props.allowRemoveAll?M3t:null}function j3t(t,e){var o=t.componentView,r=n.createInjector(o),a=e._1=n.obj(),i=e._2=n.insert(r,n.createComponent("msg-l10n",ae,t));return n.mountComponent(i,n.propsSet(i,{key:"clear-chat-history-body"})),n.insert(r,n.elem("br",B3t)),e._5=n.mountBlock(t,r,T3t),n.finalizePendingRefs(t,a),P3t}function P3t(t,e){n.updateBlock(e._5),n.finalizePendingRefs(t,e._1)}M3t.dispose=function(t){t._a=n.unmountComponent(t._a),t._8=n.unmountComponent(t._8)},j3t.dispose=function(t){t._2=n.unmountComponent(t._2),t._5=n.clearBlock(t._5)};var R3t={__proto__:null,cssScope:B3t,default:j3t,props:function(){return{allowRemoveAll:!1}},methods:{isRemoveAllChecked:function(){return this.refs.checkbox&&this.refs.checkbox.checked}}},L3t="ele6vr0";function O3t(t,e){e.value=void 0}function z3t(t,e,o,r){e.gif=o.props.sticker,e["data-tsid-id"]=n.get(r.value,"id")}function D3t(t,e,o){var r=o._6=n.insert(e,n.createComponent("msg-assets-gif",xG,t)),a=o._7=n.propsSet(r,{width:"100",height:"100",preview:!0,icon:!0,"data-tsid":"recent_element","data-type":"gif"});return z3t(0,a,t,o),n.mountComponent(r,a),U3t}function U3t(t,e){var o=e._6,r=e._7;z3t(0,r,t,e),n.updateComponent(o,r)}function N3t(t,e,n){e.sticker=n.props.sticker}function q3t(t,e,o){var r=n.insert(e,n.elem("div",L3t));n.setClass(r,"price-okmsg"),n.setAttribute(r,"data-tsid","price");var a=n.appendChild(r,n.elem("span",L3t));return n.setClass(a,"label-okmsg"),o._h=n.appendChild(a,n.text(n.get(o.value,"price")||0)),n.appendChild(a,n.text(" OK")),H3t}function H3t(t,e){n.updateText(e._h,n.get(e.value,"price")||0)}function F3t(t){return t.props.postcard?q3t:null}function V3t(t,e,o){var r=o._a=n.insert(e,n.createComponent("msg-sticker",Uu,t)),a=o._b=n.propsSet(r,{size:"postcardPreview",autoplay:!0,loop:!0,"data-l":"t,sticker"});return N3t(0,a,t),n.mountComponent(r,a),o._c=n.mountBlock(t,e,F3t),K3t}function K3t(t,e){var o=e._a,r=e._b;N3t(0,r,t),n.updateComponent(o,r),n.updateBlock(e._c)}function W3t(t){return n.get(t.props.sticker,"gif")?D3t:V3t}function G3t(t,e){var o=t.componentView,r=n.createInjector(o);return O3t(0,e),e._3=n.mountBlock(t,r,W3t),Y3t}function Y3t(t,e){O3t(0,e),n.updateBlock(e._3)}D3t.dispose=function(t){t._6=n.unmountComponent(t._6),t._7=null},q3t.dispose=function(t){t._h=null},V3t.dispose=function(t){t._a=n.unmountComponent(t._a),t._c=n.unmountBlock(t._c),t._b=null},G3t.dispose=function(t){t._3=n.clearBlock(t._3)};var X3t={__proto__:null,cssScope:L3t,default:G3t},Q3t=function(t,e,n){var o=this;this._controller=t,this._toast=e,this._confirm=n,this.app=t.props.app,this.subscribedTimer,this.subscribedChatId;var r=function(e,n){return ee(t,e,n)};r("fetch-messages",(function(t){o.fetchMessages(t.detail.chatId,t.detail.options)})),r("select-message",(function(t){o.selectMessage(t.detail.chatId,t.detail.messageId);var e=o.get(t.detail.chatId);HS(e)&&e.selectedMessages&&"MESSAGES"===e.posting.forward.type&&o.addMessageToForward(e.id,t.detail.messageId)})),r("unselect-message",(function(t){var e=o.get(t.detail.chatId);HS(e)&&"MESSAGES"===e.posting.forward.type?e.selectedMessages&&e.selectedMessages.length>1?(o.unselectMessage(t.detail.chatId,t.detail.messageId,t.detail.group),o.removeMessageFromForward(e.id,t.detail.messageId)):o.resetPostingForward(e.id):o.unselectMessage(t.detail.chatId,t.detail.messageId)})),r("reset-selected-messages",(function(t){return o.resetSelectedMessages(t.detail.chatId)})),r("reset-focused-message",(function(t){return o.resetFocusedMessage(t.detail)})),r("edit-last-message",(function(t){return o.editLastMessage(t.detail.chatId)})),r("edit-message",(function(t){return o.editMessage(t.detail.chatId,t.detail.messageId)})),r("reply-message",(function(t){return o.replyMessage(t.detail.chatId,t.detail.messageId)})),r("remove-messages",(function(t){return o.removeMessages(t.detail.chatId,t.detail.messageIds)})),r("copy-messages",(function(t){return o.copyFormatMessages(t.detail.chatId,t.detail.messageIds)})),r("update-read-mark",(function(t){return o.updateReadMark(t.detail.chatId,t.detail.messageId,t.detail.mark)})),r("read-reaction",(function(t){return o.readReaction(t.detail.chatId,t.detail.messageId,t.detail.mark)})),r("join-chat",(function(t){return o.join(t.detail)})),r("leave-chat",(function(t){return o.leave(t.detail.chatId,t.detail.callback)})),r("hide-chat",(function(t){return o.hide(t.detail)})),r("remove-chat",(function(t){return o.remove(t.detail.chatId,!0)})),r("clear-chat-history",(function(t){return o.clear(t.detail.chatId)})),r("block-user-in-group",(function(t){return o.blockUserInGroup(t.detail)})),r("update-chat-icon",(function(t){return o.setIcon(t.detail.chatId,t.detail.file)})),r("update-chat",(function(t){return o.update(t.detail.chatId,t.detail)})),r("revoke-link",(function(t){return o.revokeLink(t.detail.chatId,t.detail.force)})),r("remove-link",(function(t){return o.removeLink(t.detail.chatId,t.detail.force)})),r("check-chat-link",(function(t){return o.updateNextLink(t.detail.chatId,t.detail.link)})),r("show-media",(function(t){return o.showMedia(t.detail.chatId,t.detail.mediaId)})),r("close-media",(function(t){return o.closeMedia(t.detail.chatId)})),r("append-media",(function(t){var e=t.detail,n=e.chatId,r=e.mediaType,a=e.mediaId;o.appendMedia(n,r,a)})),r("set-media-tab",(function(t){o.setMediaTab(t.detail.chatId,t.detail.mediaType)})),r("reset-media-tab",(function(t){o.setMediaTab(t.detail)})),r("update-media-time",(function(t){var e=t.detail,n=e.chatId,r=e.time;o.app.chat.updateMediaTime(n,r)})),r("create-chat-from-dialog",(function(t){o.createChatFromDialog(t.detail.chatId,t.detail.userIds)})),r("forward-commit",(function(t){o.commitForward(t.detail.chatId)})),r("forward-select-chat",(function(t){o.addChatToForward(t.detail.chatId,t.detail.targetChatId)})),r("forward-unselect-chat",(function(t){o.removeChatFromForward(t.detail.chatId,t.detail.targetChatId)})),r("forward-comment",(function(t){o.updateForwardComment(t.detail.chatId,t.detail.text)})),r("forward-init",(function(t){var e=t.detail,n=e.chatId,r=e.messageIds,a=e.type;"MESSAGES"===a&&r.forEach((function(e){return o.selectMessage(t.detail.chatId,e)})),o.initPostingForward(n,{chatId:n,type:a,messageIds:r})})),r("forward-reset",(function(t){var e=t.detail.chatId;o.resetPostingForward(e)})),r("send-contact",(function(t){var e=t.detail,n=e.toChatIds,r=e.contactId;o.sendContact(r,n)})),r("update-messages-stats",(function(t){o.updateMessagesStats(t.detail.chatId,t.detail.messageIds)})),r("get-video-url-data",(function(t){var e=t.detail,n=e.chatId,r=e.messageId,a=e.videoId,i=e.token;o.getVideoUrlData(n,r,a,i)})),r("get-music-url",(function(t){var e=t.detail,n=e.chatId,r=e.messageId,a=e.trackId,i=e.context;o.getMusicUrl(n,r,a,i)})),r("pin-message",(function(t){o.pinMessage(t.detail.chatId,t.detail.messageId)})),r("unpin-message",(function(t){o.unpinMessage(t.detail.chatId)})),r("show-pinned-message",(function(t){o.togglePinnedMessageDisplay(t.detail.chatId,!1)})),r("hide-pinned-message",(function(t){o.togglePinnedMessageDisplay(t.detail.chatId,!0)})),r("run-message-action",(function(t){o.runMessageAction(t.detail.action,t.detail.chatId,t.detail.messageId)})),r("message-react",(function(t){o.react(t.detail)})),r("chat-search",(function(t){o.search(t.detail.query)})),r("chat-search-touch",(function(t){o.searchTouch(t.detail&&t.detail.chatId)})),r("chat-search-more",(function(t){o.searchMore(t.detail.categories)})),r("chat-search-reset",(function(){o.resetSearch()})),r("message-search",(function(t){o.searchMessages(t.detail.chatId,t.detail.query)})),r("message-search-more",(function(t){o.searchMessagesMore(t.detail.chatId)})),r("message-search-select-result",(function(t){o.selectMessageSearchResult(t.detail)})),r("message-search-reset",(function(t){o.resetMessageSearch(t.detail.chatId)})),r("update-chat-settings",(function(t){o.updateSettings(t.detail.chatId,t.detail.settings)})),r("toggle-favorite",(function(t){o.toggleFavorite(t.detail.chatId)})),r("check-message-exists",(function(t){o.checkMessageExists(t.detail.chatId,t.detail.messageId,t.detail.callbackFn)})),r("posting-preview",(function(t){o.addPostingPreview(t.detail.chatId)})),r("reset-posting-preview",(function(t){o.resetPostingPreview(t.detail.chatId)})),r("clean-removed-message",(function(t){o.cleanRemovedMessage(t.detail.chatId,t.detail.messageId)})),r("voice-message-update",(function(t){o.voiceMessageUpdate(t.detail.chatId,t.detail)})),r("voice-message-reset",(function(t){o.voiceMessageReset(t.detail.chatId)})),r("report-chat",(function(t){o.report(t.detail.chatId)})),r("hide-alert-bar",(function(t){o.hideAlertBar(t.detail.chatId)})),r("hide-alert-bar-important",(function(t){o.hideAlertBarImportant(t.detail.chatId)})),r("bot-command",(function(t){o.sendBotCommand(t.detail)})),r("toggle-answered",(function(t){o.app.chat.toggleAnswered(t.detail.chatId)})),r("toggle-important",(function(t){o.app.chat.toggleImportant(t.detail.chatId)})),r("uncensor",(function(t){return o.uncensor(t.detail)})),r("show-read",(function(t){o.showMessageRead(t.detail.chatId,t.detail.messageId,t.detail.tab)})),r("show-more-reactions",(function(t){o.showMoreReactions(t.detail.message)})),r("enter-modal",(function(t){o._controller.enterModalMode(t.detail.name,t.detail.data)})),r("preview-sticker",(function(t){o.previewSendSticker(t.detail)})),r("add-left-col-reason",(function(t){o.addLeftColActiveReason(t.detail)})),r("remove-left-col-reason",(function(t){o.removeLeftColActiveReason(t.detail)}))},J3t={page:{configurable:!0}};function $3t(t){OK.logger.success("messagesLayer","censored",t)}function Z3t(t){return t._controller.store.get().config}function t5t(t){return Boolean(Z3t(t).server["react-permission"])}J3t.page.get=function(){return this._controller.refs.page},Q3t.prototype.get=function(t){return this.app.chat.getChat(t)},Q3t.prototype.findMessage=function(t,e){return this.app.chat.findMessage(t,e)},Q3t.prototype.select=function(t,e){this.app.chat.select(t,e),this.subscribe(t)},Q3t.prototype.resetSelected=function(){this.app.chat.resetSelectedChat(),this.unsubscribe()},Q3t.prototype.load=function(t){return this.app.chat.load([t])},Q3t.prototype.peek=function(t,e){this._controller.exitModalMode(),this.app.chat.peek(t,e),this.subscribe(t&&t.id)},Q3t.prototype.subscribe=function(t){var e=this;An(t)&&t5t(this)&&this.subscribedChatId!==t&&(this.unsubscribe(),this.app.chat.subscribe(t),this.subscribedChatId=t,this.subscribedTimer=setTimeout((function(){return e.app.chat.subscribe(t)}),1e3*(Z3t(this).server["subscription-timeout-seconds"]||60)))},Q3t.prototype.unsubscribe=function(){this.subscribedChatId&&t5t(this)&&(this.app.chat.unsubscribe(this.subscribedChatId),this.subscribedChatId=null,clearTimeout(this.subscribedTimer))},Q3t.prototype.fetchEntity=function(t){return this.app.chat.fetchEntity(t)},Q3t.prototype.runMessageAction=function(t,e,n){var o=this.get(e),r=this.findMessage(o,n);switch(o&&o.messages&&o.messages.has(n)&&(n=o.messages.get(n).id),t){case"reply":this.replyMessage(e,n);break;case"edit":this.editMessage(e,n);break;case"forward":this.initPostingForward(e,{chatId:e,type:"MESSAGES",messageIds:[n]}),this.selectMessage(e,n);break;case"unread":this.setMessageAsUnread(e,n);break;case"remove":this.removeMessages(e,[n]);break;case"pin":this.pinMessage(e,n);break;case"unpin":this.unpinMessage(e);break;case"showRead":this.showMessageRead(e,n);break;case"select":this.selectMessage(e,n);break;case"unselect":this.unselectMessage(e,n);break;case"copy":this.copyFormatMessages(e,[n]);break;case"url":mO(r.publicLink),this._toast.show(V("message-link-copied"));break;case"report":this.removeMessages(e,[n],!0)}},Q3t.prototype.react=function(t){var e=t.chatId,n=t.messageId,o=t.reaction,r=t.active,a=t.source;OK.logger.success("messagesLayer",r?"unreact":"react",o),OK.logger.success("messagesLayer",r?"source-unreact":"source-react",C0(a)),r?this.app.reactions.unreact(e,n):this.app.reactions.react(e,n,o)},Q3t.prototype.fetchMessages=function(t,e){return this.app.chat.fetchMessages(t,e)},Q3t.prototype.getMessageURL=function(t,e){return this.app.message.getMessageUrl(t,e)},Q3t.prototype.selectMessage=function(t,e){this.app.chat.selectMessage(t,e)},Q3t.prototype.unselectMessage=function(t,e){this.app.chat.unselectMessage(t,e)},Q3t.prototype.resetSelectedMessages=function(t){this.app.chat.resetSelectedMessages(t)},Q3t.prototype.resetFocusedMessage=function(t){this.app.chat.resetFocusedMessage(t)},Q3t.prototype.editLastMessage=function(t){this.app.chat.editLastMessage(t)},Q3t.prototype.editMessage=function(t,e){this.resetSelectedMessages(t),this.app.chat.editMessage(t,e)},Q3t.prototype.replyMessage=function(t,e){this.resetSelectedMessages(t),this.app.chat.resetPostingLink(t),this.app.chat.replyMessage(t,e)},Q3t.prototype.removeMessages=function(t,e,o){var r=this;void 0===o&&(o=!1);var a=this.isChannel(t),i=!a&&this.allowRemoveAll(t,e),s=a&&this.isAdmin(t),u=V(o?"report-messages-confirm-header":"remove-messages-confirm-header"),c=V(o?"report-messages-confirm-button":"remove-messages-confirm-button"),p=o?V("report-messages-confirm-body"):n.endorphin("msg-confirm-remove-body",I3t,{props:{allowRemoveAll:i,count:e.length},store:this._controller.store});this._confirm.show({header:u,body:p,buttons:[{label:c,action:function(){var n=!!o||!s&&!p.isRemoveAllChecked();r.app.chat.removeMessages(t,e,n,o),r.app.chat.resetSelectedMessages(t)}},V("confirm-cancel-button")]})},Q3t.prototype.copyFormatMessages=function(t,e){var n=this;OK.logger.success("messagesLayer","copy");var o,r,a,i=this.get(t),s=this._controller.store.get().config,u=iO(e.map((function(t){return n.findMessage(i,t)})).sort((function(t,e){return t.time-e.time})),s,i);this.app.chat.resetSelectedMessages(t),o=u,r=function(t){t.preventDefault(),dO(t,o)},(a=document.createElement("textarea")).setAttribute("style","width:1px;border:0;opacity:0;"),document.body.appendChild(a),a.value=o,a.select(),document.addEventListener("copy",r),document.execCommand("copy"),document.removeEventListener("copy",r),document.body.removeChild(a)},Q3t.prototype.voiceMessageUpdate=function(t,e){this.app.chat.voiceMessageUpdate(t,e)},Q3t.prototype.voiceMessageReset=function(t){this.app.chat.voiceMessageReset(t)},Q3t.prototype.updateReadMark=function(t,e,n,o){this.app.chat.updateReadMark(t,e,n,o)},Q3t.prototype.readReaction=function(t,e,n){this.app.reactions.updateReactionMark(t,e,n)},Q3t.prototype.setMessageAsUnread=function(t,e){this.app.chat.setMessageAsUnread(t,e)},Q3t.prototype.join=function(t){var e=this;return this.app.chat.join(t).catch((function(t){var n=t.localizedMessage||V("unknown-error");throw e._toast.show(n),t}))},Q3t.prototype.isChannel=function(t){var e=this.get(t);return e&&"CHANNEL"===e.type},Q3t.prototype.isAdmin=function(t){var e=this.get(t);return e.admins&&e.admins.some((function(t){return t.user.current}))},Q3t.prototype.isParticipant=function(t){if(!t.participants)return!1;var e=this._controller.store.get().auth.profile.id;return Array.isArray(t.participants)?t.participants.some((function(t){return t.user.current})):"object"==typeof t.participants?!!t.participants[e]:!!t.participants},Q3t.prototype.leave=function(t,e){var n=this,o=this.get(t);if(o){var r=this.isChannel(t);if(r&&!o.owner.current&&"PUBLIC"===o.access)return this.app.chat.leave(t),void Qp("/");var a,i,s=o.title||o.placeholder||V("empty-chat-placeholder");r?(a=V("leave-channel-confirm-body",{name:s}),i=V("leave-channel-confirm-button")):(a=V("leave-chat-confirm-body",{name:s}),i=V("leave-chat-confirm-button")),this._confirm.show({header:V("leave-chat",{type:o.type}),body:a,buttons:[{label:i,action:function(){var o=n.app.chat.getSelectedChat();o&&o.id===t&&Qp("/"),n.app.chat.leave(t),"function"==typeof e&&e(!0)}},{label:V("confirm-cancel-button"),action:function(){"function"==typeof e&&e(!1)}}]})}},Q3t.prototype.remove=function(t,e){var n=this;if(void 0===e&&(e=!1),this.get(t)){var o=e?"remove":"hide";this._confirm.show({header:V(o+"-chat"),body:V(o+"-chat-confirm-body"),buttons:[{label:V(o),action:function(){n.app.chat.remove(t),Qp("/")}},{label:V("confirm-cancel-button")}]})}},Q3t.prototype.hide=function(t){var e=this,n=t.chatId;this._confirm.show({header:V("hide-chat"),body:V("hide-chat-confirm-body"),buttons:[{label:V("hide"),action:function(){e.app.chat.hide(n),Qp("/")}},V("confirm-cancel-button")]})},Q3t.prototype.clear=function(t){var e=this,o=this.get(t);if(o){var r=o.owner.current&&"CHAT"===o.type,a=r?n.endorphin("msg-confirm-remove-body",R3t,{props:{allowRemoveAll:r},store:this._controller.store}):V("clear-chat-history-body");this._confirm.show({header:V("clear-chat-history-header"),body:a,buttons:[{label:V("clear-chat-history-button"),action:function(){var n=!!r&&a.isRemoveAllChecked();e.app.chat.clear(t,n)}},{label:V("confirm-cancel-button")}]})}},Q3t.prototype.blockUserInGroup=function(t){var e=this,n=t.chatId,o=t.userId,r=t.groupId,a=t.groupName,i=this.app.contacts.get(o);this._confirm.show({header:V("block-user-in-group-title"),body:V("block-user-in-group-text",{name:i.name,groupName:a}),buttons:[{label:V("block-and-hide"),action:function(){return e.app.okWeb.blockUser(o,r).catch((function(t){var n=t.localizedMessage||V("unknown-error");e._toast.show(n)})).then((function(){e.app.chat.hide(n),Qp("/")}))}},V("confirm-cancel-button")]})},Q3t.prototype.chatsLoaded=function(){return this.app.chat.chatsLoaded()},Q3t.prototype.setIcon=function(t,e){return this.app.chat.setIcon(t,e)},Q3t.prototype.update=function(t,e){return void 0===e&&(e={}),this.app.chat.updateChat(t,e)},Q3t.prototype.revokeLink=function(t,e){var n=this,o=this.get(t).type;if(e)return this.app.chat.revokeLink(t);this._confirm.show({header:V("changing-link"),body:V("changing-link-text",{type:o}),buttons:[{label:V("change"),action:function(){return n.app.chat.revokeLink(t)}},V("cancel")]})},Q3t.prototype.removeLink=function(t,e){var n=this;if(e)return this.update(t,{removeLink:!0});this._confirm.show({header:V("private-link-remove-dialog-title"),body:V("private-link-remove-dialog-text"),buttons:[{label:V("remove"),action:function(){return n.update(t,{removeLink:!0})}},V("confirm-cancel-button")]})},Q3t.prototype.updateNextLink=function(t,e){return this.app.chat.updateNextLink(t,e)},Q3t.prototype.showMedia=function(t,e){return this.app.chat.showMedia(t,e)},Q3t.prototype.closeMedia=function(t){return this.app.chat.closeMedia(t)},Q3t.prototype.appendMedia=function(t,e,n){return void 0===n&&(n=null),this.app.chat.appendMedia(t,e,n)},Q3t.prototype.setMediaTab=function(t,e){return void 0===e&&(e=null),this.app.chat.setMediaTab(t,e)},Q3t.prototype.createChatFromDialog=function(t,e){return this.app.chat.createMultiChatFromDialog(t,e)},Q3t.prototype.getDialog=function(t){return this.app.chat.getDialog(t)},Q3t.prototype.sendContact=function(t,e){return this._controller.exitModalMode(),this.app.chat.sendContact(t,e)},Q3t.prototype.updateMessagesStats=function(t,e){this.app.chat.updateMessagesStats(t,e)},Q3t.prototype.getVideoUrlData=function(t,e,n,o){var r=this;this.app.message.getVideoUrlData(t,e,n,o).catch((function(t){var e=t.localizedMessage||V("unknown-error");r._toast.show(e)}))},Q3t.prototype.getMusicUrl=function(t,e,n,o){var r=this;this.app.message.getMusicUrl(t,e,n,o).catch((function(t){var e=t.localizedMessage||V("unknown-error");r._toast.show(e)}))},Q3t.prototype.pinMessage=function(t,e){var n=this,o=this.get(t).pinnedMessage?V("pin-confirm-body-replace"):V("pin-confirm-body-add");this._confirm.show({header:V("pin-message"),body:o,buttons:[{label:V("pin"),action:function(){return n.app.chat.addPin(t,e)}},V("confirm-cancel-button")]})},Q3t.prototype.unpinMessage=function(t){var e=this,n=this.get(t);this._confirm.show({header:V("pinned-message"),body:V("unpin-confirm-body",{type:n.type}),buttons:[{label:V("unpin"),action:function(){return e.app.chat.removePin(t)}},V("confirm-cancel-button")]})},Q3t.prototype.togglePinnedMessageDisplay=function(t,e){this.app.chat.togglePin(t,e)},Q3t.prototype.search=function(t){return this.app.chat.search(t)},Q3t.prototype.searchTouch=function(t){this.app.chat.searchTouch(t)},Q3t.prototype.searchMore=function(t){return this.app.chat.loadMoreSearchResults(t)},Q3t.prototype.resetSearch=function(){this.app.chat.resetSearch()},Q3t.prototype.searchMessages=function(t,e){return this.app.chat.searchMessages(t,e)},Q3t.prototype.searchMessagesMore=function(t){return this.app.chat.loadMoreMessageSearchResults(t)},Q3t.prototype.selectMessageSearchResult=function(t){this.app.chat.selectMessageSearchResult(t)},Q3t.prototype.resetMessageSearch=function(t){this.app.chat.resetMessageSearch(t)},Q3t.prototype.updateSettings=function(t,e){this.app.config.setChatSettings(t,e)},Q3t.prototype.showMessageRead=function(t,e,n){var o=this.get(t),r=this.findMessage(o,e),a=this.page;if(r&&a){var i=t5t(this)?{chatId:t,messageId:e,tab:n}:{participants:o.participants.filter((function(t){return t.time>=r.time})),total:o.participants};a.showParticipants(i)}},Q3t.prototype.showMoreReactions=function(t){var e=t.chatId,n=t.id,o=t.reactionInfo,r=this.page;if(t5t(this)&&t&&r){var a={chatId:e,messageId:n,mine:o&&o.yourReaction};r.showAllReactions(a)}},Q3t.prototype.toggleFavorite=function(t){return this.app.chat.isFavorite(t)?this.removeFavorite(t):this.addFavorite(t)},Q3t.prototype.addFavorite=function(t){var e=this;return this.app.chat.addFavorite(t).catch((function(t){var n="max-favorite-limit-reached"===t.code?function(t){var e=Z3t(t).server["max-favorite-chats"];return V("max-favorite-limit-reached",{max:e})}(e):t.localizedMessage||V("unknown-error");e._toast.show(n)}))},Q3t.prototype.removeFavorite=function(t){return this.app.chat.removeFavorite(t)},Q3t.prototype.checkMessageExists=function(t,e,n){return void 0===n&&(n=function(){return null}),this.app.chat.getMessageIfExists(t,e).then((function(e){return n(t,e)}))},Q3t.prototype.markAsUnread=function(t){var e=this.get(t);this.app.stats.action("MARK_AS_UNREAD_CHAT"),e&&e.lastMessage&&this.app.chat.setMessageAsUnread(t,e.lastMessage.uid||e.lastMessage.id)},Q3t.prototype.markAsRead=function(t){var e=this.get(t);e&&e.lastMessage&&this.updateReadMark(e.id,e.lastMessage.id,e.lastMessage.time+1,!0)},Q3t.prototype.allowRemoveAll=function(t,e){return this.app.chat.allowRemoveAll(t,e)},Q3t.prototype.addChannelToForward=function(t,e){this.app.chat.addPostingForwardChannel(t,e)},Q3t.prototype.initPostingForward=function(t,e){this.app.chat.initPostingForward(t,e)},Q3t.prototype.addMessageToForward=function(t,e){this.app.chat.addPostingForwardMessage(t,e)},Q3t.prototype.removeMessageFromForward=function(t,e){this.app.chat.removePostingForwardMessage(t,e)},Q3t.prototype.resetPostingForward=function(t,e){var n=this,o=this.get(t);if(HS(o)){var r=o.posting.forward;r.text||r.targetChatIds&&r.targetChatIds.length?this._confirm.show({header:V("exit-action"),body:V("forward-messages-exit-confirm"),buttons:[{label:V("exit-action"),action:function(){n.app.chat.resetPostingForward(t),e&&e(!0)}},{label:V("confirm-continue-forwarding"),action:function(){e&&e(!1)}}]}):(this.app.chat.resetPostingForward(t),e&&e(!0))}else e&&e(!0)},Q3t.prototype.addChatToForward=function(t,e){this.app.chat.addPostingForwardChat(t,e)},Q3t.prototype.removeChatFromForward=function(t,e){this.app.chat.removePostingForwardChat(t,e)},Q3t.prototype.addPostingPreview=function(t){this.app.chat.addPostingPreview(t)},Q3t.prototype.resetPostingPreview=function(t){this.app.chat.resetPostingPreview(t)},Q3t.prototype.cleanRemovedMessage=function(t,e){this.app.chat.cleanRemovedMessage(t,e)},Q3t.prototype.commitForward=function(t){var e=this,n=this.get(t);n&&n.posting&&n.posting.forward&&this.app.chat.commitForward(t).then((function(){var t=n.posting.forward,o=1===t.targetChatIds.length;if("MESSAGES"===t.type&&!o){var r=t.messageIds.length;e._toast.show(V("forward-messages-commit",{count:r,countPlural:r}))}if("CHANNEL"!==t.type||o||e._toast.show(V("forward-share-commit")),o&&["MESSAGES","CHANNEL"].includes(t.type)){var a=e.get(t.targetChatIds[0]);a&&$p(a.id,{messagesTime:a.lastMessage.time,useBack:!0})}}))},Q3t.prototype.updateForwardComment=function(t,e){this.app.chat.updatePostingForwardComment(t,e)},Q3t.prototype.report=function(t){this.app.chat.report(t),this._toast.show(V("report-sent"))},Q3t.prototype.hideAlertBar=function(t){this.app.chat.hideAlert(t)},Q3t.prototype.hideAlertBarImportant=function(t){this.app.chat.hideAlertImportant(t)},Q3t.prototype.sendBotCommand=function(t){this.app.chat.sendBotCommand(t)},Q3t.prototype.uncensor=function(t){var e=t.chatId,n=t.messageId,o=t.mediaId,r=t.id,a=o||r,i=this.get(e),s=this.findMessage(i,n),u=s&&s.link&&s.link.message||s||{},c=u.sender&&u.sender.id;c&&a&&($3t("uncensor"),this.app.media.uncensor(c,a))},Q3t.prototype.isWhitelisted=function(t,e){var n=this.app.getState().whiteList;return void 0===n&&(n={}),(n[t]||[]).indexOf(e)>-1},Q3t.prototype.isCensored=function(t){if(!(t&&(t.sensitive||t.preview&&t.preview.sensitive)))return!1;var e=t.chatId,n=t.messageId,o=t.mediaId,r=this.get(e),a=this.findMessage(r,n),i=a&&a.sender;if(!i||i.current||i.own)return $3t(i?i.current?"sender-current":"sender-friend":"no-sender"),!1;var s=this.isWhitelisted(i.id,o);return $3t(s?"whitelisted":"sensitive"),!s},Q3t.prototype.addLeftColActiveReason=function(t){return this.app.chat.addLeftColActiveReason(t)},Q3t.prototype.removeLeftColActiveReason=function(t){return this.app.chat.removeLeftColActiveReason(t)},Q3t.prototype.setInfoActive=function(t){return this.app.chat.setInfoActive(t)},Q3t.prototype.previewSendSticker=function(t){var e=t.sticker,o=t.setName,r=t.postcard,a=t.callback,i=V("send-sticker-confirm-header"),s=V("send-sticker-confirm-label"),u=n.endorphin("msg-confirm-send-sticker",X3t,{props:{sticker:e,setName:o,postcard:r},store:this._controller.store});this._confirm.show({header:i,body:u,buttons:[{label:s,action:function(){return a()}},V("confirm-cancel-button")]})},Object.defineProperties(Q3t.prototype,J3t);var e5t=function(t){var e=this;this._controller=t,this._prevFocused=null,ee(t,"show-confirm",(function(t){return e.show(t.detail)})),ee(t,"close-confirm",(function(t){return e.hide(t.detail.cancel)}))};e5t.prototype.show=function(t){var e=hr(this._controller);e&&(this._prevFocused=Cr(e)||Number(e.getAttribute("tabindex"))>=0?e:null),this._controller.setState({confirmParams:t})},e5t.prototype.hide=function(t){if(this._controller.setState({confirmParams:null}),t){var e=this._prevFocused;e&&e.isConnected&&"function"==typeof e.focus&&(Cr(e)||e.setAttribute("tabindex","0"),e.focus())}};var n5t=function(t,e){var n=this;this.app=t.props.app,this._confirm=e,ee(t,"update-contact",(function(t){return n.update(t.detail.contactId,t.detail.action,t.detail.name)})),ee(t,"block-user",(function(t){return n.block(t.detail.userId)})),ee(t,"unblock-user",(function(t){return n.unblock(t.detail)}))};n5t.prototype.update=function(t,e,n){this.app.contacts.update(t,e,n)},n5t.prototype.block=function(t){var e=this,n=this.app.contacts.get(t);n&&this._confirm.show({header:V("block-user-title"),body:V("block-user-text",{name:n.name}),buttons:[{label:V("block"),action:function(){e.app.contacts.blockUser(t),e.app.media.removeFromWhiteList(t)}},V("cancel")]})},n5t.prototype.unblock=function(t){var e=this,n=t.userId,o=t.chatId;this.app.contacts.unblockUser(n).then((function(){return e.app.chat.select(o,Date.now())}))};var o5t=-1!==navigator.userAgent.indexOf("Trident"),r5t=function(t){var e=this;this._controller=t,this.app=t.props.app,this._requestedFiles=new a,this.app.subscribe((function(){var t=s5t(e.app);e._requestedFiles.size&&t&&e._requestedFiles.forEach((function(n,o){var r=t.get(o);r&&"complete"===r.status&&(e._requestedFiles.delete(o),i5t(r,n.open))}))})),ee(t,"download-file",(function(t){return e.download(t.detail)})),ee(t,"download-url",(function(t){return e.downloadUrl(t.detail)})),ee(t,"preload-file",(function(t){return e.preload(t.detail)})),ee(t,"prefetch-file",(function(t){return e.prefetch(t.detail)})),ee(t,"cancel-download-file",(function(t){return e.cancel(t.detail)}))},a5t={model:{configurable:!0}};function i5t(t){if(navigator.msSaveBlob&&t.file)navigator.msSaveBlob(t.file,t.file.name);else{var e=document.createElement("a");e.href=t.localUrl||t.url,t.file&&t.file.name&&(e.download=t.file.name),document.body.appendChild(e),requestAnimationFrame((function(){return document.body.removeChild(e)})),e.click()}}function s5t(t){return t.getState().download}a5t.model.get=function(){return s5t(this.app)},r5t.prototype.download=function(t){var e=this,n=t.fileId,o=t.chatId,r=t.messageId,a=t.open;if(o5t)this.app.download.prefetch(n,o,r).then((function(){return i5t(e.model.get(n))}));else{var i=this.model,s=i&&i.get(n);s&&"complete"===s.status?i5t(s):s&&"loading"===s.status||this._requestedFiles.has(n)||(this._requestedFiles.set(n,{open:a}),this.app.download.fetch(n,o,r))}},r5t.prototype.downloadUrl=function(t){var e=t.url,n=t.name;t.open;i5t({url:e,file:{name:n}})},r5t.prototype.preload=function(t){var e=t.fileId,n=t.chatId,o=t.messageId,r=this.model,a=r&&r.get(e);if(!a||"loading"!==a.status&&"complete"!==a.status)return this.app.download.fetch(e,n,o)},r5t.prototype.prefetch=function(t){var e=t.fileId,n=t.chatId,o=t.messageId;this.app.download.prefetch(e,n,o)},r5t.prototype.cancel=function(t){this._requestedFiles.delete(t),this.app.download.remove(t)},Object.defineProperties(r5t.prototype,a5t);var u5t="e-yqf0j2",c5t=[0],p5t=[];function l5t(){p5t.push(c5t),c5t=[0]}function m5t(){c5t=p5t.pop()}function d5t(t,e){e.chatTitle=n.get(t.props.chat,"title")||n.get(t.props.chat,"placeholder")||t.store.data.l10n("empty-chat-placeholder")}function _5t(t,e,o,r){e["data-type"]=n.get(o.props.chat,"type"),e["data-title"]=r.chatTitle}function f5t(t,e,n){e.user=n.props.user}function g5t(t,e){var o=t.componentView;l5t(),d5t(t,e);var r=e._3=n.appendChild(o,n.createComponent("msg-l10n",ae,t)),a=e._4=n.propsSet(r,{key:"transfer-own-to-text"});_5t(0,a,t,e),n.mountComponent(r,a);var i=e._5=n.appendChild(o,n.createComponent("msg-chat-item-container",eb,t)),s=i.componentModel.input,u=e._7=n.insert(s,n.createComponent("msg-user-card",Nh,t),"image"),c=e._8=n.propsSet(u,{slot:"image",size:"micro"});f5t(0,c,t),n.mountComponent(u,c);var p=e._9=n.insert(s,n.createComponent("msg-name",Sh,t),"title"),l=p.componentModel.input;e._b=n.insert(l,n.text(n.get(t.props.user,"name"))),n.mountComponent(p,n.propsSet(p,{slot:"title"})),n.mountComponent(i,n.propsSet(i,{size:"small"}));var m=n.appendChild(o,n.elem("div",u5t));n.setClass(m,"description-okmsg");var d=e._f=n.appendChild(m,n.createComponent("msg-l10n",ae,t));return n.mountComponent(d,n.propsSet(d,{key:"transfer-own-attention-text"})),m5t(),n.subscribeStore(t,["l10n"]),v5t}function v5t(t,e){var o=e._3,r=e._4,a=e._7,i=e._8;l5t(),d5t(t,e),_5t(0,r,t,e),n.updateComponent(o,r),f5t(0,i,t),n.updateComponent(a,i),c5t[0]|=n.updateText(e._b,n.get(t.props.user,"name")),n.updateIncomingSlot(e._9,"",c5t[0]),m5t()}g5t.dispose=function(t){l5t(),t._3=n.unmountComponent(t._3),t._7=n.unmountComponent(t._7),t._9=n.unmountComponent(t._9),t._5=n.unmountComponent(t._5),t._f=n.unmountComponent(t._f),m5t()};var h5t={__proto__:null,cssScope:u5t,default:g5t,props:function(){return{chat:null,user:null}}},C5t=function(t,e,n,o){var r=this;this._controller=t,this._toast=e,this._chatService=n,this._confirm=o,this.app=t.props.app,ee(t,"add-participants",(function(t){var e=t.detail,n=e.chatId,o=e.userIds,a=e.showHistory;r.add(n,o,a)})),ee(t,"remove-participant",(function(t){r.remove(t.detail.chatId,t.detail.userId,t.detail.cleanMsgPeriod)})),ee(t,"block-participant",(function(t){r.block(t.detail.chatId,t.detail.userId,t.detail.cleanMsgPeriod)})),ee(t,"unblock-participant",(function(t){r.unblock(t.detail.chatId,t.detail.userId)})),ee(t,"manage-admins",(function(t){r.manageAdmins(t.detail.chatId,t.detail.userIds,t.detail.permissions)})),ee(t,"transfer-ownership",(function(t){r.transferOwnership(t.detail)})),ee(t,"load-blocked-participants",(function(t){r.loadBlocked(t.detail.chatId)})),ee(t,"load-chat-members",(function(t){r.loadMembers(t.detail.chatId)})),ee(t,"search-participants",(function(t){var e=t.detail,n=e.chatId,o=e.query,a=e.type;r.search(n,o,a)})),ee(t,"reset-participants",(function(t){r.reset(t.detail.chatId)}))};C5t.prototype.add=function(t,e,n){var o=this;return this.app.participants.add(t,e,n).catch((function(t){var e=t.localizedMessage||V("unknown-error");return o._toast.show(e),Promise.reject(t)}))},C5t.prototype.remove=function(t,e,n){return this.app.participants.remove(t,e,n)},C5t.prototype.block=function(t,e,n){return this.app.participants.block(t,e,n)},C5t.prototype.unblock=function(t,e){return this.app.participants.unblock(t,e)},C5t.prototype.manageAdmins=function(t,e,n){var o=this;return this.app.participants.manageAdmins(t,e,n).catch((function(t){var e=t.localizedMessage||V("unknown-error");return o._toast.show(e),Promise.reject(t)}))},C5t.prototype.updateAdmin=function(t,e,n){var o=this;return this.app.participants.updateAdmin(t,e,n).catch((function(t){var e=t.localizedMessage||V("unknown-error");return o._toast.show(e),Promise.reject(t)}))},C5t.prototype.transferOwnership=function(t){var e=this,o=t.chatId,r=t.userId,a=this._chatService.get(o),i=this.app.contacts.get(r);if(a&&i){var s=n.endorphin("msg-transfer-ownership-body",h5t,{props:{chat:a,user:i},store:this._controller.store});this._confirm.show({header:V("participant-action-transfer-own",{type:a.type}),body:s,buttons:[{label:V("participant-action-transfer-own-button"),action:function(){e.app.chat.transferOwnership(o,r).then(e._toast.show(V("ownership-transfered")))}},V("confirm-cancel-button")]})}},C5t.prototype.loadBlocked=function(t){return this.app.participants.loadBlocked(t)},C5t.prototype.loadMembers=function(t){return this.app.participants.loadMembers(t)},C5t.prototype.search=function(t,e,n){this.app.participants.search(t,e,n)},C5t.prototype.reset=function(t){this.app.participants.reset(t)};function k5t(t,e){e.setState({reason:t})}var b5t=[0],y5t=[];function S5t(){y5t.push(b5t),b5t=[0]}function w5t(){b5t=y5t.pop()}function E5t(t){return t.state.reasons}function x5t(t,e,n,o){e.key="complaint_"+o.value}function I5t(t,e,n,o){k5t(o.index,t)}function B5t(t,e,o){var r=o._5=n.insert(e,n.createComponent("msg-menu-item",ES,t),""),a=r.componentModel.input,i=o._6=n.insert(a,n.createComponent("msg-radio",ant,t),""),s=i.componentModel.input,u=o._8=n.insert(s,n.createComponent("msg-l10n",ae,t),""),c=o._9=n.propsSet(u,{value:!1});return x5t(0,c,0,o),o._a=n.addEvent(u,"click",I5t,t,o),n.mountComponent(u,c),n.mountComponent(i,n.propsSet(i,{name:"report-reason"})),n.mountComponent(r),b5t[0]=1,M5t}function M5t(t,e){var o=e._8,r=e._9;x5t(0,r,0,e),n.updateComponent(o,r)}function A5t(t,e,n){e.title=n.store.data.l10n("addToBlackListHelp")}function T5t(t,e){var o=t.componentView;S5t();var r=e._1=n.appendChild(o,n.createComponent("msg-menu",bS,t)),a=r.componentModel.input;e._2=n.mountIterator(t,a,E5t,B5t);var i=e._e=n.insert(a,n.createComponent("msg-menu-item",ES,t),""),s=i.componentModel.input,u=e._f=n.insert(s,n.createComponent("msg-checkbox",hS,t),""),c=u.componentModel.input;n.setRef(t,"checkbox",u);var p=e._h=n.insert(c,n.createComponent("msg-l10n",ae,t),"");n.mountComponent(p,n.propsSet(p,{key:"addtoblacklist"}));var l=e._j=n.insert(c,n.createComponent("msg-icon",xe,t),""),m=e._k=n.propsSet(l,{icon:"help"});return A5t(0,m,t),n.mountComponent(l,m),n.mountComponent(u,n.propsSet(u,{checked:!0,shape:"square"})),n.mountComponent(i),n.mountComponent(r),w5t(),n.subscribeStore(t,["l10n"]),j5t}function j5t(t,e){var o=e._j,r=e._k;S5t(),n.updateIterator(e._2),A5t(0,r,t),n.updateComponent(o,r),n.updateIncomingSlot(e._1,"",b5t[0]),w5t()}B5t.dispose=function(t){t._a=n.removeEvent("click",t._a),t._8=n.unmountComponent(t._8),t._6=n.unmountComponent(t._6),t._5=n.unmountComponent(t._5),t._9=null,b5t[0]=1},T5t.dispose=function(t){S5t(),t._2=n.unmountIterator(t._2),t._h=n.unmountComponent(t._h),t._j=n.unmountComponent(t._j),t._f=n.unmountComponent(t._f),t._e=n.unmountComponent(t._e),t._1=n.unmountComponent(t._1),w5t()};var P5t={__proto__:null,cssScope:"eaqlmns",default:T5t,state:function(){return{reasons:["porno","advertising","extreme","fake"]}},methods:{addToBlackList:function(){return this.refs.checkbox&&this.refs.checkbox.checked},reason:function(){return this.state.reason}},onSelectReason:k5t},R5t=function(t,e){var n=this;this._controller=t,this._confirm=e,this.app=t.props.app,ee(t,"onboarding-additional-info",(function(){return n.onboardingAdditionalInfo()})),ee(t,"leftcol-additional-info",(function(){return n.leftColAdditionalInfo()})),ee(t,"add-friend",(function(t){return n.addFriend(t.detail.userId)})),ee(t,"report-user",(function(t){return n.reportUser(t.detail.userId)})),ee(t,"add-to-gifs",(function(t){return n.addToGifs(t.detail)}))};R5t.prototype.onboardingAdditionalInfo=function(){this.app.okWeb.onboardingAdditionalInfo()},R5t.prototype.leftColAdditionalInfo=function(){this.app.okWeb.leftColAdditionalInfo()},R5t.prototype.addFriend=function(t){this.app.okWeb.addFriend(t)},R5t.prototype.blockUser=function(t){this.app.okWeb.blockUser(t)},R5t.prototype.unblockUser=function(t){this.app.okWeb.unblockUser(t)},R5t.prototype.reportUser=function(t){var e=this,o=n.endorphin("msg-confirm-report-user",P5t,{store:this._controller.store});this._confirm.show({header:V("report"),body:o,buttons:[{label:V("report"),action:function(){var n={id:t,addToBlackList:o.addToBlackList()},r=o.reason();r&&(n.reason=r),e.app.okWeb.complain(n),n.hideAlertImportant&&e.app.chat.hideAlertImportant(t)}},V("cancel")]})},R5t.prototype.addToGifs=function(t){this.app.okWeb.addToGifs(t)};var L5t=function(){function t(t){var e=this;this.component=t,this.component=t,this.app=t.store.app,ee(t,"assets-fetch",(function(){return e.fetchAssets()})),ee(t,"stickers-fetch",(function(){e.fetchAssets(),e.fetchFavorites()})),ee(t,"post-user-sticker",(function(t){var n=t.detail,o=n.chatId,r=n.file;e.postUserSticker(o,r)})),ee(t,"sticker-remove",(function(t){var n=t.detail,o=n.type,r=n.id;e.app.stickers.remove(o,[r])}))}return t.prototype.fetchAssets=function(){var t=this.app.getState().assets,e=null==t?void 0:t.loadState;if(e!==o.LoadState.idle&&e!==o.LoadState.loading)return this.app.stickers.update()},t.prototype.fetchFavorites=function(){var t,e=this.app.getState().assets;if(!(null===(t=null==e?void 0:e.stickerSections)||void 0===t?void 0:t.FAVORITE_STICKERS))return this.app.stickers.update("FAVORITE_STICKER")},t.prototype.postUserSticker=function(t,e){return this.app.chat.sendUserSticker(t,e),this.app.chat.resetPosting(t)},t}(),O5t="e9zsmgm",z5t=[0],D5t=[];function U5t(){D5t.push(z5t),z5t=[0]}function N5t(){z5t=D5t.pop()}function q5t(t,e,o){e.url=Wt(0,o.props.item,"medium"),e.caption=n.get(o.props.item,"name")}function H5t(t,e){var o=t.componentView;U5t();var r=n.appendChild(o,n.elem("div",O5t));n.setClass(r,"wr-okmsg");var a=e._2=n.appendChild(r,n.createComponent("msg-avatar",Hp,t)),i=e._3=n.propsSet(a,{size:"medium"});q5t(0,i,t),n.mountComponent(a,i);var s=e._4=n.appendChild(r,n.createComponent("msg-parsed-text",ii,t)),u=s.componentModel.input;return e._6=n.insert(u,n.text(n.get(t.props.item,"name"))),n.mountComponent(s,n.propsSet(s,{disableLinks:!0})),N5t(),F5t}function F5t(t,e){var o=e._2,r=e._3;U5t(),q5t(0,r,t),n.updateComponent(o,r),z5t[0]|=n.updateText(e._6,n.get(t.props.item,"name")),n.updateIncomingSlot(e._4,"",z5t[0]),N5t()}H5t.dispose=function(t){U5t(),t._2=n.unmountComponent(t._2),t._4=n.unmountComponent(t._4),N5t()};var V5t={__proto__:null,cssScope:O5t,default:H5t};function K5t(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.round((t+Number.EPSILON)*n)/n}var W5t=function(){function t(t,e,n,r,i){var s=this;this.store=t,this.chat=e,this.download=n,this.toast=r,this.log=i,this.speeds=[1,1.5,2],this.musicCache=new a,this.restoreProgress=function(){var t=s.getBranch(),e=t.savedProgress[t.message.id];s.updateBranch({duration:s.audio.duration}),e&&s.seek(t.message.id,e)},this.playHandler=function(){s.updateBranch({paused:s.audio.paused}),s.startLoop()},this.endHandler=function(){s.playNextAttach()},this.timeUpdateHandler=function(){var t=s.audio,e=t.currentTime,n=t.duration,o=t.paused;if(n){var r=K5t(e/n,4);s.updateBranch({paused:o,currentTime:e,progress:r,duration:n})}},this.sourceElement=document.createElement("source"),this.audio=document.createElement("audio"),this.audio.addEventListener("onstalled",(function(){s.audio.load()})),this.reset(),this.useEmpty=o.getDeviceName().includes("Safari"),this.audio.appendChild(this.sourceElement),this.sourceElement.type="audio/mp3",this.audio.addEventListener("play",this.playHandler),this.audio.addEventListener("pause",this.playHandler),this.audio.addEventListener("ended",this.endHandler),this.audio.addEventListener("loadedmetadata",this.restoreProgress),this.setupMediaSessionControls()}return Object.defineProperty(t.prototype,"canStreamByCountry",{get:function(){var t=this.store.get().config;return!!(t&&t.server&&t.server["music-files-enabled"])},enumerable:!1,configurable:!0}),t.prototype.play=function(t){return this.setSrc(t),this.audio.paused&&this.audio.play()||Promise.resolve()},t.prototype.pause=function(){this.audio.paused||this.audio.pause()},t.prototype.togglePlaybackSpeed=function(){var t=this.audio.playbackRate,e=this.speeds.indexOf(t),n=this.speeds[e+1]||this.speeds[0];this.audio.playbackRate=n,this.updateBranch({playbackSpeed:n})},t.prototype.setSrc=function(t){this.sourceElement.src!==t&&(this.sourceElement.src=t,this.audio.load())},t.prototype.reset=function(){this.pause(),this.updateBranch({message:null,duration:0,currentTime:0,progress:0,playbackSpeed:1})},t.prototype.seek=function(t,e){var o,r,a=this.audio.duration*e,i=this.getBranch();if((null===(r=i.message)||void 0===r?void 0:r.id)===t)this.audio.currentTime=a,this.audio.paused&&this.timeUpdateHandler();else{var s=n.__assign(n.__assign({},i.savedProgress),((o={})[t]=e,o));this.updateBranch({savedProgress:s})}},t.prototype.floatingMode=function(t){this.updateBranch({float:t})},t.prototype.playAttach=function(t){var e,o;return n.__awaiter(this,void 0,void 0,(function(){var r,a,i,s,u,c,p,l,m,d,_,f,g,v=this;return n.__generator(this,(function(h){switch(h.label){case 0:return t.messageId?this.isMusic(t)||this.isVoice(t)||this.isFile(t)?(r=this.getBranch(),(null===(e=r.message)||void 0===e?void 0:e.id)!==t.messageId||r.loading?(a=this.getSection(t),this.store.app.media.selectItem(t.chatId,a,t),i=this.chat.get(t.chatId),s=i.media.get(a),u=s.current,c=-1!==s.previous,p=-1!==s.next,[4,this.store.app.chat.getMessageIfExists(t.chatId,t.messageId)]):[2,this.togglePlay()]):[2,Promise.resolve()]:[2,this.toast.show(this.store.l10n("audio-preview-after-upload"))];case 1:if(l=h.sent(),m=n.__assign({},r.savedProgress),d=m[l.id],_=this.getDuration(t),r.progress&&r.message&&delete m[r.message.id],this.updateBranch({chatId:t.chatId,section:a,hasNext:c,hasPrev:p,message:l,duration:_,progress:d,savedProgress:m}),f=this.getCachedAttachmentUrl(t))return[3,5];h.label=2;case 2:return h.trys.push([2,4,,5]),this.useEmpty&&this.play("data:audio/mpeg;base64,/+MYxAAAAANIAAAAAExBTUUzLjk4LjIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),[4,this.fetchAttachmentUrl(t)];case 3:return f=h.sent(),[3,5];case 4:return(g=h.sent()).localizedMessage?(this.toast.show(g.localizedMessage),"music.track.unavailable"===g.code&&(this.playNextAttach()||this.pause())):this.toast.show(this.store.l10n("error.audio.play")),[3,5];case 5:return f&&u===(null===(o=i.media.get(a))||void 0===o?void 0:o.current)?(this.getList(t),this.log.action("tt.play-attach"),[2,this.play(f).then((function(){v.audio.playbackRate="audio"===a&&r.playbackSpeed||1,v.updateMediaSession(l,t)}))]):[2]}}))}))},t.prototype.updateMediaSession=function(t,e){var n,o,r,a=[],i={sizes:"128x128",type:"image/jpeg",src:""};if(this.isVoice(e))if(n=this.store.l10n("voice-message"),t.sender)o=t.sender.name,i.src=xt(t.sender.baseUrl,"large",!0,!0);else{var s=this.chat.get(e.chatId);o=s.title,i.src=xt(s.fullIconUrl,"large",!0,!0)}else this.isMusic(e)&&(n=e.title,o=e.artistName,r=e.albumName,i.src=xt(e.baseUrl,"large",!0,!0));a.push(i),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:n,artist:o,album:r,artwork:a}))},t.prototype.togglePlay=function(){this.audio.paused?this.audio.play():this.audio.pause()},t.prototype.playNextAttach=function(){var t=this.getBranch();if(t.hasNext){var e=t.section,n=t.chatId,o=this.chat.get(n).media.get(e),r=o.items[o.previous];return this.playAttach(r.attach),this.log.action("tt.next-attach"),!0}},t.prototype.playPrevAttach=function(){var t=this.getBranch();if(t.hasPrev){var e=t.section,n=t.chatId,o=this.chat.get(n).media.get(e),r=o.items[o.next];return this.playAttach(r.attach),this.log.action("tt.next-attach"),!0}},t.prototype.isPlaying=function(t){var e;return(null===(e=this.getBranch().message)||void 0===e?void 0:e.id)===t.messageId},t.prototype.isMusic=function(t){return"MUSIC"===t._type},t.prototype.isVoice=function(t){return"AUDIO"===t._type},t.prototype.isFile=function(t){var e;return"FILE"===t._type&&"MUSIC"===(null===(e=t.preview)||void 0===e?void 0:e._type)},t.prototype.handleRemove=function(t,e){var n=e.audioPlayer;if(n&&n.message){var o=t.chats.get(n.message.chatId);if(o){var r=o.messages.get(n.message.id||n.message.cid);r&&"REMOVED"!==r.status||(t.audioPlayer=null,this.pause(),this.toast.show(this.store.l10n("playable-media-deleted")))}}return t},t.prototype.getPlayableType=function(t){return this.isMusic(t)||this.isFile(t)?"MUSIC":this.isVoice(t)?"AUDIO":void 0},t.prototype.getSection=function(t){return"MUSIC"===this.getPlayableType(t)?"music":"audio"},t.prototype.attachUrl=function(t){return xm(t,"url")||xm(t,"download.localUrl")||xm(t,"download.url")},t.prototype.getCachedAttachmentUrl=function(t){if(this.isVoice(t))return t.url;if(this.isMusic(t))return this.musicCache.get(t.trackId);if(this.isFile(t)){var e=this.store.app.download.get(t.fileId);return e?e.localUrl||e.url:void 0}},t.prototype.fetchAttachmentUrl=function(t){return n.__awaiter(this,void 0,void 0,(function(){var e,o,r,a,i,s,u,c;return n.__generator(this,(function(n){switch(n.label){case 0:this.updateBranch({loading:!0}),n.label=1;case 1:return n.trys.push([1,,8,9]),e=t.chatId,o=t.messageId,this.isVoice(t)?[2,t.url]:this.isMusic(t)?(r=t.trackId,a=t.context,[4,this.store.app.message.getMusicUrl(e,o,r,a)]):[3,3];case 2:return u=n.sent(),this.musicCache.set(r,u),[2,u];case 3:return this.isFile(t)?(i=t.fileId,s={fileId:i,chatId:e,messageId:o},this.canStreamByCountry?[4,this.store.app.download.prefetch(i,e,o)]:[3,5]):[3,7];case 4:return[2,u=n.sent()];case 5:return[4,this.download.preload(s)];case 6:return c=n.sent(),[2,this.getCachedAttachmentUrl(t)||URL.createObjectURL(c)];case 7:return[3,9];case 8:return this.updateBranch({loading:!1}),[7];case 9:return[2]}}))}))},t.prototype.isEqualAttach=function(t,e){if(!e||!t||t.messageId!==e.messageId)return!1;var n=t.mediaId===e.mediaId;return this.isMusic(t)&&this.isMusic(e)&&(n=n||t.trackId===e.trackId),this.isFile(t)&&this.isFile(e)&&(n=n||t.fileId===e.fileId),"token"in t&&"token"in e&&(n==n||(t.token,e.token)),n},t.prototype.getList=function(t){return n.__awaiter(this,void 0,void 0,(function(){var e,o;return n.__generator(this,(function(n){switch(n.label){case 0:return(e=this.chat.get(t.chatId))&&e.messages&&e.messages.size?(o=this.getSection(t),e.media.get(o).items.length?[3,2]:[4,this.store.app.media.prefetch(e.id,o)]):[2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.getBranch=function(){return this.store.get().audioPlayer||{}},t.prototype.updateBranch=function(t){var e=this.getBranch();this.store.set({audioPlayer:n.__assign(n.__assign({},e),t)})},t.prototype.chatUnavailableError=function(){var t=this.store.l10n,e="".concat(t("error.audio.play"),": ").concat(t("chat-or-channel-unavailable"));this.toast.show(e)},t.prototype.getDuration=function(t){return"duration"in t?t.duration:"preview"in t&&"duration"in t.preview?t.preview.duration:0},t.prototype.startLoop=function(){var t=this;if(!this.loopProgress){this.loopProgress=!0;var e=function(){t.timeUpdateHandler(),t.audio.paused?t.loopProgress=!1:requestAnimationFrame(e)};e()}},t.prototype.setupMediaSessionControls=function(){var t=this;"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",(function(){t.getBranch().message&&t.audio.play()})),navigator.mediaSession.setActionHandler("pause",(function(){t.getBranch().message&&t.audio.pause()})),navigator.mediaSession.setActionHandler("stop",(function(){t.getBranch().message&&t.reset()})),navigator.mediaSession.setActionHandler("seekbackward",(function(){var e=t.getBranch(),n=e.progress-.1;t.seek(e.message.id,n)})),navigator.mediaSession.setActionHandler("seekforward",(function(){var e=t.getBranch(),n=e.progress+.1;t.seek(e.message.id,n)})),navigator.mediaSession.setActionHandler("seekto",(function(e){var n=t.getBranch(),o=K5t(e.seekTime/t.audio.duration,4);t.seek(n.message.id,o)})),navigator.mediaSession.setActionHandler("previoustrack",(function(){t.playPrevAttach()})),navigator.mediaSession.setActionHandler("nexttrack",(function(){t.playNextAttach()})))},t}(),G5t={resolveURL:function(t){try{if(!t||!t.match(/^\/?messages/i)&&!t.match(/\/group\/.+?\/messages/)&&!t.match(/\/.+?\/messages/))throw new Error("incorrect route error: ".concat(t));Xp(t)}catch(t){this.state.service.log.error("ROUTE_ERROR",t.stack)}},openGroupchat:function(t){var e=this,o=t.groupId,r=t.subjectType,a=t.subjectId,i=t.startPayload;$5t("open"),this.store.app.chat.createGroupchat(o,r,a,i).then((function(t){$p(t.id,{replace:!0})})).catch((function(t){"errors.group.cannot_write_message"===(null==t?void 0:t.code)&&function(t,e){t.store.app.groups.fetchMissing([e]).then((function(){$5t("showJoinGroupToWriteConfirm");var o=t.state.model.groups.get(e),r=n.endorphin("msg-confirm-avatar-card",V5t,{props:{item:o}});t.state.service.confirm.show({header:r,body:V("join-group-to-start"),buttons:[{label:V("join-group-confirm-button"),action:function(){$5t("buttonJoinGroupToWriteConfirm"),$n(t,o,!0)}},{label:V("confirm-cancel-button")}]})}))}(e,o),Qp("/",{replace:!0})}))},enterModalMode:function(t,e){X5t(this,t,e)},exitModalMode:function(){Q5t(this)},isModalActive:function(){return!!this.state.modalMode},ok:function(t,e){t&&vr("AUTHCODE",t,30,"/"),e&&vr("JSESSIONID",e,30,"/")},minifyCall:function(){this.store.get().call&&null!=this.state.expandedCall&&this.setState({expandedCall:!1})},isOpen:function(){return!this.state.hidden},open:function(t){var e=this.isOpen();e||(this.store.app.ping.setActive(),this.setState({hidden:!1}),this.notifier.setLayerHidden(!1),IS=!1,AS.length>0&&PS(),t4t(!0),this.setAttribute("tabindex","0"),this.store.get().isTouchDevice||(this.focus(),this.state._focusTrap.update(!0))),te(this,"open",{wasOpened:e,url:t})},close:function(){var t=this.isOpen();t&&(this.store.app.ping.setInactive(),this.setState({hidden:!0}),this.notifier.setLayerHidden(!0),IS=!0,AS.length>0&&RS(),t4t(!1),this.removeAttribute("tabindex"),this.blur(),this.state._focusTrap.update(!1)),te(this,"close",{wasOpened:t})},postingInsert:function(t,e){var n=this.refs.page;return n&&n.postingInsert(t,e)},attachesSelected:function(t){var e=this.refs.page;if(e){var n=t.objectId;n&&0===n.indexOf("tt_")&&e.postingInsert({chatId:Number(n.substring(3)),attaches:t.attaches},"attaches")}},chatAvatarSelected:function(t){var e=this.store,o=e.get().newChat||{invited:[]};e.set({newChat:n.__assign(n.__assign({},o),{icon:t})})},updateParams:function(t){J5t(this,t)},sendSticker:function(t){var e=this.refs.page;return e&&e.sendSticker({code:t,stickerOrigin:"vitrine"})},buySmileyServiceCb:function(){},resendSticker:function(){return this.state.service.posting.resendSticker()},insertSmile:function(t){return this.postingInsert(t,"text")},hideSendActionMenu:function(){var t=this.refs.page;return t&&t.hideCongrats()}},Y5t={"exit-modal":Q5t,"settings-enter":function(t){t.store.get().config.server["portal-settings-only"]?(OK.Layers.unregisterLast(),Jn(t,"/settings/messaging")):Qp("/:settings")},"send-contact-enter":function(t,e){return X5t(t,"send-contact",{toChatIds:e.detail})},"random-congrats":function(t){return X5t(t,"random-congrats",{})},"update-user-settings":function(t,e){var n,o=e.detail,r=o.name,a=o.value;J5t(t,(n={},n[r]=a,n)),e.detail.settings=Ei(t)},"update-campaign-id":function(t,e){var n,o=t.store.app,r=e.detail,a=r.name,i=r.value;o.config.setCampaignIds((n={},n[a]=i,n))},"close-channel-settings":function(t,e){e.defaultPrevented||t.state.service.chat.updateNextLink(e.detail.chatId,null)},"open-photo-layer":function(t,e){t.state.service.log.action("PHOTOLAYER"),t.store.get().config.server["propagate-photo-event"]&&(e.detail.openOnWeb=!0)},"open-video-call-layer":function(t,e){t.store.get().config.server["call-confirm"]&&(e.detail.confirm=!0)},"leftcol-additional-info":function(t,e){t.state.leftcolAddInit||(e.stopImmediatePropagation(),t.setState({leftcolAddInit:!0}))},"onboarding-additional-info":function(t,e){t.state.onboardingAddInit||(e.stopImmediatePropagation(),t.setState({onboardingAddInit:!0}))},"log-external":function(t,e){"scalar"===e.detail.type&&(e.stopImmediatePropagation(),e.detail.now=performance.now(),requestAnimationFrame((function(){Zt(t,"log",e.detail)})))},"filter-groups":function(t,e){(0,t.setState)({groupIdFilter:e.detail})},"preview-photo":function(t,e){e.stopPropagation(),function(t,e){e.file?rQt(e.file,e.options).then((function(n){Object.assign(e,n),t.setState({previewPhoto:e})})):e.width&&e.height&&t.setState({previewPhoto:e})}(t,e.detail)},contextmenu:function(t,e){t.store.get().isTouchDevice&&!function(t){var e,n;return!!(null===(n=(e=t).closest)||void 0===n?void 0:n.call(e,"input, textarea, msg-input"))}(e.target)&&e.preventDefault()}};function X5t(t,e,n){t.setState({modalMode:{name:e,data:n}})}function Q5t(t){t.setState({modalMode:null})}function J5t(t,e){t.store.app.config.setUserSettings(e)}function $5t(t){OK.logger.success("messagesLayer","groupChat",t)}function Z5t(t){var e=document.documentElement;t.setState({isDarkThemeEnabled:e.classList.contains("dark-theme")||e.classList.contains("__ui-theme_dark")})}function t4t(t){var e=document.getElementById("msg_toolbar_button");e&&e.setAttribute("aria-expanded",String(t))}var e4t="elzlzvt",n4t=[0],o4t=[];function r4t(){o4t.push(n4t),n4t=[0]}function a4t(){n4t=o4t.pop()}function i4t(t,e){e.darkThemeEnabled=t.state.isDarkThemeSupported&&n.get(t.store.data.config,"server","dark-theme"),e.darkTheme=e.darkThemeEnabled&&"dark"===n.get(t.store.data.config,"user","THEME")}function s4t(t,e,o,r){n.updateClass(t,e,"js-overlays-host js-msg-theme-root"+(r.darkTheme||o.state.isDarkThemeEnabled?" __dark-okmsg":"")+(r.darkThemeEnabled?" __theming-enabled-okmsg":"")+(o.store.data.isMobile?" is-mobile-okmsg":"")),n.updateAttribute(t,e,"app",n.get(o.state.userAgent,"deviceType")),n.updateAttribute(t,e,"os",n.get(o.state.userAgent,"osVersion"))}function u4t(t,e,n){e.model=n.state.model,e.requiresUpdate=n.state.requiresUpdate,e.modalMode=n.state.modalMode,e.groupIdFilter=n.state.groupIdFilter}function c4t(t,e,o){e.header=n.get(o.state.confirmParams,"header"),e.body=n.get(o.state.confirmParams,"body"),e.buttons=n.get(o.state.confirmParams,"buttons"),e.callback=n.get(o.state.confirmParams,"callback")}function p4t(t,e){n4t[0]|=n.updateText(e._k,t.state.toast),n.updateIncomingSlot(e._j,"",n4t[0])}function l4t(t,e,o){return o._j?p4t(t,o):function(t,e,o){var r=o._j=n.insert(e,n.createComponent("msg-toast",e0t,t)),a=r.componentModel.input;o._k=n.insert(a,n.text(t.state.toast)),n.mountComponent(r)}(t,e,o),n.animate(o._j,n.createAnimation("show-toast 0.2s ease-out",e4t)),m4t}function m4t(t,e){p4t(t,e)}function d4t(t){return t.state.toast?l4t:null}function _4t(t,e,o){e.photo=o.state.previewPhoto,e.options=n.get(o.state.previewPhoto,"options")}function f4t(t,e){t.setState({previewPhoto:null})}function g4t(t,e,o){var r=o._q=n.insert(e,n.createComponent("msg-preview-photo-layer",v3t,t)),a=o._r=n.propsSet(r);return _4t(0,a,t),o._s=n.addEvent(r,"close",f4t,t,o),n.mountComponent(r,a),v4t}function v4t(t,e){var o=e._q,r=e._r;_4t(0,r,t),n.updateComponent(o,r)}function h4t(t){return t.state.previewPhoto?g4t:null}function C4t(t,e,o){var r=o._1,a=o._8=n.insert(e,n.elem("div",e4t)),i=n.createInjector(a);n.setPendingRef(r,"main",a);var s=o._9=n.obj();n.setAttribute(a,"data-l","t,msg"),s4t(a,s,t,o);var u=o._a=n.insert(i,n.createComponent("msg-page",$1t,t));n.setPendingRef(r,"page",u);var c=o._b=n.propsSet(u);u4t(0,c,t),n.mountComponent(u,c);var p=o._c=n.insert(i,n.createComponent("msg-confirm",z0t,t)),l=o._d=n.propsSet(p);return c4t(0,l,t),n.mountComponent(p,l),o._e=n.mountBlock(t,i,d4t),o._n=n.mountBlock(t,i,h4t),k4t}function k4t(t,e){var o=e._8,r=e._1,a=e._a,i=e._b,s=e._c,u=e._d;n.setPendingRef(r,"main",o),s4t(o,e._9,t,e),n.setPendingRef(r,"page",a),u4t(0,i,t),n.updateComponent(a,i),c4t(0,u,t),n.updateComponent(s,u),n.updateBlock(e._e),n.updateBlock(e._n)}function b4t(t){return t.state.hidden?null:C4t}function y4t(t,e){var o=t.componentView;r4t();var r=n.createInjector(o),a=e._1=n.obj();return i4t(t,e),e._5=n.mountBlock(t,r,b4t),a4t(),n.subscribeStore(t,["config","isMobile"]),n.finalizePendingRefs(t,a),S4t}function S4t(t,e){r4t(),i4t(t,e),n.updateBlock(e._5),a4t(),n.finalizePendingRefs(t,e._1)}l4t.dispose=function(t,e){n.animate(t._j,n.createAnimation("hide-toast 0.2s ease-out",e4t),(function(){return function(t){var e=t._j;t._j=n.unmountComponent(e),n.domRemove(e),t._k=null}(t)}))},g4t.dispose=function(t){t._s=n.removeEvent("close",t._s),t._q=n.unmountComponent(t._q),t._r=null},C4t.dispose=function(t){t._a=n.unmountComponent(t._a),t._c=n.unmountComponent(t._c),t._e=n.unmountBlock(t._e),t._n=n.unmountBlock(t._n),t._9=t._b=t._d=t._8=null},y4t.dispose=function(t){r4t(),t._5=n.clearBlock(t._5),a4t()};var w4t={__proto__:null,cssScope:e4t,default:y4t,extend:G5t,events:Y5t,state:function(){return{hidden:!0}},willMount:function(t){var e=t.setState,n=t.store.app,r=t.notifier=new eDt(t),a=new e5t(t),i=new h3t(t),s=new C3t(t),u=new Q3t(t,s,a),c=new t$t(t,s),p=new n5t(t,a),l=new C5t(t,s,u,a),m=new Wp(t,u,a,s),d=new r5t(t),_=new L5t(t),f=new R5t(t,a),g=new W5t(t.store,u,d,s,i),v=new Lj(t),h=function(t){var e=JSON.parse(t);143===e.opcode&&s.show(e.payload.text)},C=t.store.get().isMobile;Z5t(t),e({service:{confirm:a,log:i,toast:s,chat:u,posting:c,contacts:p,participants:l,router:m,download:d,sticker:_,okWeb:f,player:g,showMedia:v},model:n.getState(),userAgent:o.userAgent({},C),_unsubscribe:U(n,(function(n){n!==t.state.model&&(e({model:n}),r.update(n))})),_msgNotifier:h,isDarkThemeSupported:Mi(),_focusTrap:q2(t)}),t.version=t.store.get().version,n.transport.on("message",h)},didMount:function(t){var e=t.store.get().isMobile;if(o.log("render-app"),e&&t.state.service.chat.addLeftColActiveReason("mobile"),setTimeout((function(){t.offsetWidth&&t.offsetHeight&&!t.state.hidden||o.log("render-app-hidden")}),500),e&&"undefined"!=typeof MutationObserver){var n=new MutationObserver((function(){return Z5t(t)}));return n.observe(document.documentElement,{attributeFilter:["class"]}),function(){return n.disconnect()}}},willUnmount:function(t){var e=t.store.app,n=t.state,o=n._unsubscribe,r=n._msgNotifier;o&&o(),e.transport.on("message",r)}};function E4t(t){if(t.style.display="none","function"==typeof t.assignedNodes)for(var e=t.assignedNodes(),n=0;n<e.length;n++){var o=e[n];o.nodeType===o.ELEMENT_NODE&&(o.style.display="none")}}var x4t={__proto__:null,default:function(t,e,r){try{o.log("dom-start");var i=new W(e,r.pts,{staticRoot:(r.staticRoot||"").replace(/\/+$/g,""),emojiRoot:Ho,version:r.version,uid:r.uid,isMobile:r.isMobile,history:r.history}),s=n.endorphin("msg-app",w4t,{store:i,props:{app:e}});s.setAttribute("role","dialog"),s.setAttribute("aria-modal","true"),s.setAttribute("aria-label","Сообщения"),function(t){q=t}(i),t.appendChild(s),s.addEventListener("runtime-error",(function(t){var n=t.detail,o=n.error,i=n.host,s=n.chatId,u=n.messageId,c=new a;i&&c.set("Host",i.nodeName),s&&c.set("ChatID",s),u&&c.set("MessageID",u),r.version&&c.set("Version",r.version);var p=e.getState();p&&p._actionsLog&&c.set("Last actions",p._actionsLog.join(", "));var l="".concat(function(t){var e="";return t.forEach((function(t,n){return e+="\n".concat(n,": ").concat(t)})),e}(c),"\n\n").concat(o.stack);console.info("got runtime error",t.detail),e.stats.action("RUNTIME_ERROR",i&&i.nodeName),e.stats.log.error("RUNTIME_ERROR",l)}));for(var u=t.firstChild;u&&u!==s&&"LINK"!==u.nodeName;){var c=u.nextSibling;"SLOT"===u.nodeName?E4t(u):"LINK"!==u.nodeName&&t.removeChild(u),u=c}return function(t){if(Mi()&&t.store.get().config.server["dark-theme"]){var e=document.getElementsByClassName("js-msg-theme-toggle")[0],n=document.getElementById("hook_Block_MessagesLayer");e&&n&&(e.classList.remove("invisible"),e.addEventListener("click",(function(){ji(t)})),Pi(Ti(t)===Bi))}}(s),o.log("dom-ok"),function(t){var e,o,r=null===(o=null===(e=G())||void 0===e?void 0:e.get())||void 0===o?void 0:o.config,a=null==r?void 0:r.server["lottie-cache-frames"],i=null==r?void 0:r.server["lottie-max-render"];console.log("prepare lottie",t),t?n.re({workerUrl:t,cacheFrames:a,maxRender:i}):"undefined"!=typeof fetch?(console.log("worker url is",n.workerUrl),n.re({cacheFrames:a,maxRender:i,workerUrl:function(){return fetch(n.workerUrl,{mode:"cors"}).then((function(t){if(!t.ok)throw new Error("Error while loading Lottie worker: ".concat(t.statusText," (").concat(t.status,")"));return t.blob()})).then((function(t){return URL.createObjectURL(t)}))}})):n.re({workerUrl:n.workerUrl,cacheFrames:a,maxRender:i})}(r.lottieWorkerUrl),s}catch(t){throw o.log("dom-fail"),o.clob("[dom] Render failed:\\n".concat(t.message),r.uid),t}}};e.extractParams=function(t){var e={},n=t.indexOf("?");return-1!==n&&t.substr(n+1).split("&").forEach((function(t){if(-1!==t.indexOf("=")){var n=t.split("="),o=n[0],r=n[1];e[o]=decodeURIComponent(r.replace(/\+/g,"%20"))}})),e},e.getConversationId=C6,e.getUrlToken=k6,e.l10n=V,e.ui=x4t}));
//# sourceMappingURL=ui_b9aa768d.js.map
